<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module TSOMemLemmas</title>
<meta name="description" content="Documentation of Coq module TSOMemLemmas" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module TSOMemLemmas</h1>
<div class="coq">
<span class="id">From</span> <span class="id">mathcomp.ssreflect</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">fintype</span> <span class="id">ssrnat</span>.                  <br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Coqlib.html">Coqlib</a></span> <span class="id"><a href="Maps.html">Maps</a></span> <span class="id"><a href="Axioms.html">Axioms</a></span>.  <br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="AST.html">AST</a></span> <span class="id"><a href="Integers.html">Integers</a></span> <span class="id"><a href="Floats.html">Floats</a></span> <span class="id"><a href="Values.html">Values</a></span> <span class="id"><a href="Events.html">Events</a></span> <span class="id"><a href="Globalenvs.html">Globalenvs</a></span> <span class="id"><a href="Smallstep.html">Smallstep</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Locations.html">Locations</a></span> <span class="id"><a href="Stacklayout.html">Stacklayout</a></span> <span class="id"><a href="Conventions.html">Conventions</a></span>.<br/>
&nbsp;<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Asm.html">Asm</a></span>. <br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="CUAST.html">CUAST</a></span> <span class="id"><a href="FMemOpFP.html">FMemOpFP</a></span> <span class="id"><a href="ValFP.html">ValFP</a></span> <span class="id"><a href="Op_fp.html">Op_fp</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Strings.String.html">String</a></span> <span class="id"><a href="val_casted.html">val_casted</a></span> <span class="id"><a href="helpers.html">helpers</a></span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Memdata.html">Memdata</a></span> <span class="id"><a href="Memperm.html">Memperm</a></span> <span class="id"><a href="MemAux.html">MemAux</a></span> <span class="id"><a href="FMemLemmas.html">FMemLemmas</a></span> <span class="id"><a href="GMemory.html">GMemory</a></span> <span class="id"><a href="FMemory.html">FMemory</a></span> <span class="id"><a href="Footprint.html">Footprint</a></span> <span class="id"><a href="TSOMem.html">TSOMem</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="GAST.html">GAST</a></span> <span class="id"><a href="GlobDefs.html">GlobDefs</a></span> <span class="id"><a href="ETrace.html">ETrace</a></span> <span class="id"><a href="Blockset.html">Blockset</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="loadframe.html">loadframe</a></span>. <br/>
&nbsp;<br/>
<span class="kwd">Require</span> <span class="id"><a href="CminorLang.html">CminorLang</a></span>. <br/>
<span class="kwd">Require</span> <span class="id"><a href="SpecLang.html">SpecLang</a></span>. <br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="ASM_local.html">ASM_local</a></span> <span class="id"><a href="InteractionSemantics.html">InteractionSemantics</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="AsmLang.html">AsmLang</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="AsmTSO.html">AsmTSO</a></span> <span class="id"><a href="TSOMem.html">TSOMem</a></span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html">Coq.Lists.Streams</a></span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="RGRels.html">RGRels</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="LibTactics.html">LibTactics</a></span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="code.html">code</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="ObjectSim.html">ObjectSim</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="TSOGlobSem.html">TSOGlobSem</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="InvRG.html">InvRG</a></span>. <br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="AuxTacLemmas.html">AuxTacLemmas</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="FMemLemmas.html">FMemLemmas</a></span>.<br/>
<br/>
<h1> Lemmas about TSO memory </h1>
<br/>
<h2> Auxiliary Definitions </h2>
<span class="kwd">Fixpoint</span> <span class="id"><a name="remove_nth">remove_nth</a></span> {<span class="id">A</span> : <span class="kwd">Type</span>} <span class="id">n</span> (<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="TSOMemLemmas.html#A">A</a></span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="TSOMemLemmas.html#n">n</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| 0 =&gt; <span class="kwd">match</span> <span class="id"><a href="TSOMemLemmas.html#l">l</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; <span class="id"><a href="TSOMemLemmas.html#l">l</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">a</span> :: <span class="id">l</span>' =&gt; <span class="id">l</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span> <br/>
&nbsp;&nbsp;| <span class="id">n</span>'.+1 =&gt; <span class="kwd">match</span> <span class="id"><a href="TSOMemLemmas.html#l">l</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; <span class="id"><a href="TSOMemLemmas.html#l">l</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">a</span> :: <span class="id">l</span>' =&gt; <span class="id">a</span> :: <span class="id"><a href="TSOMemLemmas.html#remove_nth">remove_nth</a></span> <span class="id">n</span>' <span class="id">l</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>. <br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="get_nth">get_nth</a></span> {<span class="id">A</span> : <span class="kwd">Type</span>} <span class="id">n</span> (<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="TSOMemLemmas.html#A">A</a></span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="TSOMemLemmas.html#n">n</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| 0 =&gt; <span class="kwd">match</span> <span class="id"><a href="TSOMemLemmas.html#l">l</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">a</span> :: <span class="id">l</span>' =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">a</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;| <span class="id">n</span>'.+1 =&gt; <span class="kwd">match</span> <span class="id"><a href="TSOMemLemmas.html#l">l</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">a</span> :: <span class="id">l</span>' =&gt; <span class="id"><a href="TSOMemLemmas.html#get_nth">get_nth</a></span> <span class="id">n</span>' <span class="id">l</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="after_remove_nth_in_origin">after_remove_nth_in_origin</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span> : <span class="kwd">Type</span>} <span class="id">n</span> {<span class="id">l1</span> <span class="id">l2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="TSOMemLemmas.html#A">A</a></span>} <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#remove_nth">remove_nth</a></span> <span class="id"><a href="TSOMemLemmas.html#n">n</a></span> <span class="id"><a href="TSOMemLemmas.html#l2">l2</a></span> = <span class="id"><a href="TSOMemLemmas.html#l1">l1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#l1">l1</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#l2">l2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9532')">Proof.</div>
<div class="proofscript" id="proof9532">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">n</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l2</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>; <span class="tactic">subst</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l2</span>; <span class="id">simpls</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
&nbsp;&nbsp;<br/>
<h2> Auxiliary LTac </h2>
<span class="kwd">Local</span> <span class="id">Transparent</span> <span class="id"><a href="FMemory.html#Mem.load">Mem.load</a></span> <span class="id"><a href="FMemory.html#Mem.alloc">Mem.alloc</a></span> <span class="id"><a href="FMemory.html#Mem.store">Mem.store</a></span> <span class="id"><a href="FMemory.html#Mem.free">Mem.free</a></span>.<br/>
<span class="kwd">Ltac</span> <span class="id">memunfolds</span>:=<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#Mem.load">Mem.load</a></span>,<span class="id"><a href="FMemory.html#Mem.alloc">Mem.alloc</a></span>,<span class="id"><a href="FMemory.html#Mem.store">Mem.store</a></span>,<span class="id"><a href="FMemory.html#Mem.free">Mem.free</a></span>,<span class="id"><a href="TSOMem.html#load">load</a></span>,<span class="id"><a href="TSOMem.html#store">store</a></span>,<span class="id"><a href="TSOMem.html#free">free</a></span>,<span class="id"><a href="TSOMem.html#alloc">alloc</a></span>,<span class="id"><a href="FMemory.html#strip">strip</a></span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.valid_access">Mem.valid_access</a></span>,<span class="id"><a href="FMemory.html#Mem.range_perm">Mem.range_perm</a></span>,<span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span>,<span class="id"><a href="FMemory.html#Mem.perm">Mem.perm</a></span>,<span class="id"><a href="GMemory.html#GMem.perm">GMem.perm</a></span>,<span class="id"><a href="SpecLang.html#loadmax">SpecLang.loadmax</a></span>,<span class="id"><a href="SpecLang.html#storemax">SpecLang.storemax</a></span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">dis_if_else</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Heqe</span> := <span class="tactic">fresh</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="kwd">if</span> ?<span class="id">x</span> <span class="kwd">then</span> <span class="id">_</span> <span class="kwd">else</span> <span class="id">_</span>] |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span> <span class="id">eqn</span>:<span class="id">Heqe</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">idtac</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<h2> Auxiliary Lemmas </h2>
<span class="kwd">Lemma</span> <span class="id"><a name="remove_eq_b_neq_in_still">remove_eq_b_neq_in_still</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span> <span class="id">n</span> {<span class="id">l1</span> <span class="id">l2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="TSOMemLemmas.html#A">A</a></span>} <span class="id">b</span> <span class="id">b0</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#remove_nth">remove_nth</a></span> <span class="id"><a href="TSOMemLemmas.html#n">n</a></span> <span class="id"><a href="TSOMemLemmas.html#l2">l2</a></span> = <span class="id"><a href="TSOMemLemmas.html#l1">l1</a></span> -&gt; <span class="id"><a href="TSOMemLemmas.html#get_nth">get_nth</a></span> <span class="id"><a href="TSOMemLemmas.html#n">n</a></span> <span class="id"><a href="TSOMemLemmas.html#l2">l2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#b0">b0</a></span> -&gt; <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> &lt;&gt; <span class="id"><a href="TSOMemLemmas.html#b0">b0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#l2">l2</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#l1">l1</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9533')">Proof.</div>
<div class="proofscript" id="proof9533">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">n</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l2</span>; <span class="id">simpls</span>; <span class="id">tryfalse</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l2</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l1</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_or_app_rev">in_or_app_rev</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span> <span class="id">l</span> <span class="id">m</span> (<span class="id">a</span> : <span class="id"><a href="TSOMemLemmas.html#A">A</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#a">a</a></span> (<span class="id"><a href="TSOMemLemmas.html#l">l</a></span> ++ <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>) -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#a">a</a></span> <span class="id"><a href="TSOMemLemmas.html#l">l</a></span> \/ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#a">a</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9534')">Proof.</div>
<div class="proofscript" id="proof9534">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">A</span> <span class="id">l</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="PMap_set_same_Mem_eq">PMap_set_same_Mem_eq</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">p</span> <span class="id">a</span> (<span class="id">m</span> : <span class="id"><a href="Maps.html#ZMap.t">ZMap.t</a></span> <span class="id"><a href="Memdata.html#memval">memval</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>) ! <span class="id"><a href="TSOMemLemmas.html#p">p</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#a">a</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#PMap.set">PMap.set</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span> <span class="id"><a href="TSOMemLemmas.html#a">a</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> = <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9535')">Proof.</div>
<div class="proofscript" id="proof9535">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">p</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">p</span>; <span class="tactic">intros</span>; <span class="tactic">try</span> <span class="tactic">destruct</span> <span class="id">m</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">t</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHp</span> <span class="id">a</span> (<span class="id">m</span>, <span class="id">t2</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">IHp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHp</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">PMap.set</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PTree.set2">PTree.set2</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">t</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHp</span> <span class="id">a</span> (<span class="id">m</span>, <span class="id">t1</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">IHp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHp</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">PMap.set</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PTree.set2">PTree.set2</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">t</span>; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="PTree_set_not_leaf">PTree_set_not_leaf</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span> <span class="id">p</span> (<span class="id">a</span> : <span class="id"><a href="TSOMemLemmas.html#A">A</a></span>) <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#PTree.set">PTree.set</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span> <span class="id"><a href="TSOMemLemmas.html#a">a</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> = <span class="id"><a href="Maps.html#PTree.Leaf">PTree.Leaf</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9536')">Proof.</div>
<div class="proofscript" id="proof9536">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">A</span> <span class="id">p</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">p</span>; <span class="tactic">intros</span>; <span class="id">simpls</span>; <span class="tactic">destruct</span> <span class="id">m</span>; <span class="id">tryfalse</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="vl_not_null_not_leaf">vl_not_null_not_leaf</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">vl</span> <span class="id">p</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#vl">vl</a></span> &lt;&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="FMemory.html#Mem.setN">Mem.setN</a></span> <span class="id"><a href="TSOMemLemmas.html#vl">vl</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>) &lt;&gt; <span class="id"><a href="Maps.html#PTree.Leaf">PTree.Leaf</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9537')">Proof.</div>
<div class="proofscript" id="proof9537">
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">vl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">vl</span>; <span class="tactic">intros</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">vl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#PTree_set_not_leaf">PTree_set_not_leaf</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="id">tryfalse</span>. <br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="FMemory.html#Mem.setN">Mem.setN</a></span> (<span class="id">a</span> :: <span class="id">m0</span> :: <span class="id">vl</span>) <span class="id">p</span> <span class="id">m</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.setN">Mem.setN</a></span> (<span class="id">m0</span> :: <span class="id">vl</span>) (<span class="id">p</span> + 1)%<span class="id">Z</span> (<span class="id"><a href="Maps.html#ZMap.set">ZMap.set</a></span> <span class="id">p</span> <span class="id">a</span> <span class="id">m</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">m0</span> :: <span class="id">vl</span> &lt;&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>); <span class="tactic">intro</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHvl</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="vl_set_1_fisrt">vl_set_1_fisrt</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">vl</span> <span class="id">p</span> <span class="id">m</span> <span class="id">a</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">o</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(0 &lt; <span class="id"><a href="TSOMemLemmas.html#p">p</a></span>)%<span class="id">Z</span> -&gt; (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>) ! 1 = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#a">a</a></span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="FMemory.html#Mem.setN">Mem.setN</a></span> <span class="id"><a href="TSOMemLemmas.html#vl">vl</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>) = <span class="id"><a href="Maps.html#PTree.Node">PTree.Node</a></span> <span class="id"><a href="TSOMemLemmas.html#t1">t1</a></span> <span class="id"><a href="TSOMemLemmas.html#o">o</a></span> <span class="id"><a href="TSOMemLemmas.html#t2">t2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#o">o</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#a">a</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9538')">Proof.</div>
<div class="proofscript" id="proof9538">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">vl</span>; <span class="tactic">intros</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">t</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H1</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHvl</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Maps.html#ZMap.set">ZMap.set</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Maps.html#PMap.set">PMap.set</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">t</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#PTree_set_not_leaf">PTree_set_not_leaf</a></span> <span class="kwd">in</span> <span class="id">Hx</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">p</span>; <span class="id">simpls</span>; <span class="tactic">try</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hx</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hx</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="vl_set_p0_get_left">vl_set_p0_get_left</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">vl</span> <span class="id">p1</span> <span class="id">p</span> <span class="id">m</span> <span class="id">a</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">o</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.pos">Z.pos</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span> &lt; <span class="id"><a href="TSOMemLemmas.html#p1">p1</a></span>)%<span class="id">Z</span> -&gt; (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>) ! (<span class="id"><a href="TSOMemLemmas.html#p">p</a></span>~0) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#a">a</a></span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="FMemory.html#Mem.setN">Mem.setN</a></span> <span class="id"><a href="TSOMemLemmas.html#vl">vl</a></span> <span class="id"><a href="TSOMemLemmas.html#p1">p1</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>) = <span class="id"><a href="Maps.html#PTree.Node">PTree.Node</a></span> <span class="id"><a href="TSOMemLemmas.html#t1">t1</a></span> <span class="id"><a href="TSOMemLemmas.html#o">o</a></span> <span class="id"><a href="TSOMemLemmas.html#t2">t2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#t1">t1</a></span> ! <span class="id"><a href="TSOMemLemmas.html#p">p</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#a">a</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9539')">Proof.</div>
<div class="proofscript" id="proof9539">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">vl</span>; <span class="tactic">intros</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHvl</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span> <span class="id">H0</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">t</span>; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Maps.html#PTree.set">PTree.set</a></span> (<span class="id"><a href="Maps.html#ZIndexed.index">ZIndexed.index</a></span> <span class="id">p1</span>) <span class="id">a</span> (<span class="id"><a href="Maps.html#PTree.Node">PTree.Node</a></span> <span class="id">t1</span> <span class="id">o</span> <span class="id">t2</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#PTree_set_not_leaf">PTree_set_not_leaf</a></span> <span class="kwd">in</span> <span class="id">Heqt</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span> <span class="id">Heqt</span> <span class="id">H0</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Maps.html#ZIndexed.index">ZIndexed.index</a></span> <span class="id">p1</span>) <span class="id">eqn</span>:?; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Heqt</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Heqt</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Maps.html#PTree.set">PTree.set</a></span> <span class="id">p0</span> <span class="id">a</span> <span class="id">t1</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#PTree_set_not_leaf">PTree_set_not_leaf</a></span> <span class="kwd">in</span> <span class="id">Heqt0</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Heqt0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PTree.gso">PTree.gso</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span> <span class="id">Heqp0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">p1</span>; <span class="id">simpls</span>; <span class="tactic">try</span> <span class="tactic">omega</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Heqp0</span>; <span class="tactic">subst</span>; <span class="tactic">try</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Heqt</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="vl_set_p1_get_right">vl_set_p1_get_right</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">vl</span> <span class="id">p1</span> <span class="id">p</span> <span class="id">m</span> <span class="id">a</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">o</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.neg">Z.neg</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span> &lt; <span class="id"><a href="TSOMemLemmas.html#p1">p1</a></span>)%<span class="id">Z</span> -&gt; (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>) ! (<span class="id"><a href="TSOMemLemmas.html#p">p</a></span>~1) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#a">a</a></span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="FMemory.html#Mem.setN">Mem.setN</a></span> <span class="id"><a href="TSOMemLemmas.html#vl">vl</a></span> <span class="id"><a href="TSOMemLemmas.html#p1">p1</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>) = <span class="id"><a href="Maps.html#PTree.Node">PTree.Node</a></span> <span class="id"><a href="TSOMemLemmas.html#t1">t1</a></span> <span class="id"><a href="TSOMemLemmas.html#o">o</a></span> <span class="id"><a href="TSOMemLemmas.html#t2">t2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#t2">t2</a></span> ! <span class="id"><a href="TSOMemLemmas.html#p">p</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#a">a</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9540')">Proof.</div>
<div class="proofscript" id="proof9540">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">vl</span>; <span class="tactic">intros</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHvl</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span> <span class="id">H0</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">t</span>; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Maps.html#PTree.set">PTree.set</a></span> (<span class="id"><a href="Maps.html#ZIndexed.index">ZIndexed.index</a></span> <span class="id">p1</span>) <span class="id">a</span> (<span class="id"><a href="Maps.html#PTree.Node">PTree.Node</a></span> <span class="id">t1</span> <span class="id">o</span> <span class="id">t2</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#PTree_set_not_leaf">PTree_set_not_leaf</a></span> <span class="kwd">in</span> <span class="id">Heqt</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span> <span class="id">Heqt</span> <span class="id">H0</span>.  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Maps.html#ZIndexed.index">ZIndexed.index</a></span> <span class="id">p1</span>) <span class="id">eqn</span>:?; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Heqt</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PTree.gso">PTree.gso</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span> <span class="id">Heqp0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">p1</span>; <span class="id">simpls</span>; <span class="tactic">try</span> <span class="tactic">omega</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Heqp0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Heqt</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Heqt</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="le_setN_get_same">le_setN_get_same</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">p2</span> <span class="id">p1</span> <span class="id">vl</span> <span class="id">a</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOMemLemmas.html#p2">p2</a></span> &lt; <span class="id"><a href="TSOMemLemmas.html#p1">p1</a></span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="FMemory.html#Mem.setN">Mem.setN</a></span> <span class="id"><a href="TSOMemLemmas.html#vl">vl</a></span> <span class="id"><a href="TSOMemLemmas.html#p1">p1</a></span> (<span class="id"><a href="Maps.html#PMap.set">PMap.set</a></span> (<span class="id"><a href="Maps.html#ZIndexed.index">ZIndexed.index</a></span> <span class="id"><a href="TSOMemLemmas.html#p2">p2</a></span>) <span class="id"><a href="TSOMemLemmas.html#a">a</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;! (<span class="id"><a href="Maps.html#ZIndexed.index">ZIndexed.index</a></span> <span class="id"><a href="TSOMemLemmas.html#p2">p2</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#a">a</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9541')">Proof.</div>
<div class="proofscript" id="proof9541">
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">p2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">p2</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="FMemory.html#Mem.setN">Mem.setN</a></span> <span class="id">vl</span> <span class="id">p1</span> (<span class="id"><a href="Maps.html#PMap.set">PMap.set</a></span> 1 <span class="id">a</span> <span class="id">m</span>))) <span class="id">eqn</span>:<span class="id">Heqe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">vl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">t</span>; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#vl_not_null_not_leaf">vl_not_null_not_leaf</a></span> <span class="kwd">in</span> <span class="id">Heqe</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">vl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">t</span>; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Heqe</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Heqe</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#vl_set_1_fisrt">vl_set_1_fisrt</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Maps.html#PMap.set">PMap.set</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">t</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="FMemory.html#Mem.setN">Mem.setN</a></span> <span class="id">vl</span> <span class="id">p1</span> (<span class="id"><a href="Maps.html#PMap.set">PMap.set</a></span> <span class="id">p</span>~0 <span class="id">a</span> <span class="id">m</span>))) <span class="id">eqn</span>:<span class="id">Heqe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">vl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">t</span>; <span class="id">simpls</span>; <span class="id">tryfalse</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#vl_not_null_not_leaf">vl_not_null_not_leaf</a></span> <span class="kwd">in</span> <span class="id">Heqe</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#vl_set_p0_get_left">vl_set_p0_get_left</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">t</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PTree.gss">PTree.gss</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PTree.gss">PTree.gss</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="FMemory.html#Mem.setN">Mem.setN</a></span> <span class="id">vl</span> <span class="id">p1</span> (<span class="id"><a href="Maps.html#PMap.set">PMap.set</a></span> <span class="id">p</span>~1 <span class="id">a</span> <span class="id">m</span>))) <span class="id">eqn</span>:<span class="id">Heqe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">vl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">t</span>; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#vl_not_null_not_leaf">vl_not_null_not_leaf</a></span> <span class="kwd">in</span> <span class="id">Heqe</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#vl_set_p1_get_right">vl_set_p1_get_right</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">t</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PTree.gss">PTree.gss</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PTree.gss">PTree.gss</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="PTree_set_twice_not_same_reorder_eq">PTree_set_twice_not_same_reorder_eq</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span> <span class="id">b</span> <span class="id">b</span>' (<span class="id">a</span> <span class="id">a</span>' : <span class="id"><a href="TSOMemLemmas.html#A">A</a></span>) <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#b">b</a></span> &lt;&gt; <span class="id">b</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#PTree.set">PTree.set</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#a">a</a></span> (<span class="id"><a href="Maps.html#PTree.set">PTree.set</a></span> <span class="id">b</span>' <span class="id">a</span>' <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>) = <span class="id"><a href="Maps.html#PTree.set">PTree.set</a></span> <span class="id">b</span>' <span class="id">a</span>' (<span class="id"><a href="Maps.html#PTree.set">PTree.set</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#a">a</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9542')">Proof.</div>
<div class="proofscript" id="proof9542">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">b</span>; <span class="tactic">induction</span> <span class="id">b</span>'; <span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">simpl</span>; <span class="tactic">destruct</span> <span class="id">m</span>; <span class="id">simpls</span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">f_equal</span>; <span class="tactic">eauto</span>]].<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">b</span> &lt;&gt; <span class="id">b</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m</span>; <span class="id">simpls</span>; <span class="tactic">f_equal</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">b</span> &lt;&gt; <span class="id">b</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m</span>; <span class="id">simpls</span>; <span class="tactic">f_equal</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
&nbsp;&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="PMap_set_twice_not_same_reorder_eq">PMap_set_twice_not_same_reorder_eq</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span> <span class="id">b</span> <span class="id">b</span>' (<span class="id">a</span> <span class="id">a</span>' : <span class="id"><a href="TSOMemLemmas.html#A">A</a></span>) <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#b">b</a></span> &lt;&gt; <span class="id">b</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#PMap.set">PMap.set</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#a">a</a></span> (<span class="id"><a href="Maps.html#PMap.set">PMap.set</a></span> <span class="id">b</span>' <span class="id">a</span>' <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>) = <span class="id"><a href="Maps.html#PMap.set">PMap.set</a></span> <span class="id">b</span>' <span class="id">a</span>' (<span class="id"><a href="Maps.html#PMap.set">PMap.set</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#a">a</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9543')">Proof.</div>
<div class="proofscript" id="proof9543">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Maps.html#PMap.set">PMap.set</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#PTree_set_twice_not_same_reorder_eq">PTree_set_twice_not_same_reorder_eq</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Mem_setN_PMap_set_g_reorder_eq">Mem_setN_PMap_set_g_reorder_eq</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">vl</span> <span class="id">p1</span> <span class="id">p2</span> <span class="id">a</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOMemLemmas.html#p2">p2</a></span> &lt; <span class="id"><a href="TSOMemLemmas.html#p1">p1</a></span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.setN">Mem.setN</a></span> <span class="id"><a href="TSOMemLemmas.html#vl">vl</a></span> <span class="id"><a href="TSOMemLemmas.html#p1">p1</a></span> (<span class="id"><a href="Maps.html#PMap.set">PMap.set</a></span> (<span class="id"><a href="Maps.html#ZIndexed.index">ZIndexed.index</a></span> <span class="id"><a href="TSOMemLemmas.html#p2">p2</a></span>) <span class="id"><a href="TSOMemLemmas.html#a">a</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#PMap.set">PMap.set</a></span> (<span class="id"><a href="Maps.html#ZIndexed.index">ZIndexed.index</a></span> <span class="id"><a href="TSOMemLemmas.html#p2">p2</a></span>) <span class="id"><a href="TSOMemLemmas.html#a">a</a></span> (<span class="id"><a href="FMemory.html#Mem.setN">Mem.setN</a></span> <span class="id"><a href="TSOMemLemmas.html#vl">vl</a></span> <span class="id"><a href="TSOMemLemmas.html#p1">p1</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9544')">Proof.</div>
<div class="proofscript" id="proof9544">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">vl</span>; <span class="tactic">intros</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Maps.html#ZMap.set">ZMap.set</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">IHvl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#PMap_set_twice_not_same_reorder_eq">PMap_set_twice_not_same_reorder_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Maps.html#ZIndexed.index_inj">ZIndexed.index_inj</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Mem_setN_ZMap_set_g_reorder_eq">Mem_setN_ZMap_set_g_reorder_eq</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">vl</span> <span class="id">p1</span> <span class="id">p2</span> <span class="id">a</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOMemLemmas.html#p2">p2</a></span> &lt; <span class="id"><a href="TSOMemLemmas.html#p1">p1</a></span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.setN">Mem.setN</a></span> <span class="id"><a href="TSOMemLemmas.html#vl">vl</a></span> <span class="id"><a href="TSOMemLemmas.html#p1">p1</a></span> (<span class="id"><a href="Maps.html#ZMap.set">ZMap.set</a></span> <span class="id"><a href="TSOMemLemmas.html#p2">p2</a></span> <span class="id"><a href="TSOMemLemmas.html#a">a</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#ZMap.set">ZMap.set</a></span> <span class="id"><a href="TSOMemLemmas.html#p2">p2</a></span> <span class="id"><a href="TSOMemLemmas.html#a">a</a></span> (<span class="id"><a href="FMemory.html#Mem.setN">Mem.setN</a></span> <span class="id"><a href="TSOMemLemmas.html#vl">vl</a></span> <span class="id"><a href="TSOMemLemmas.html#p1">p1</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9545')">Proof.</div>
<div class="proofscript" id="proof9545">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">ZMap.set</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#Mem_setN_PMap_set_g_reorder_eq">Mem_setN_PMap_set_g_reorder_eq</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Mem_setN_twice_same_eq">Mem_setN_twice_same_eq</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">vl</span> <span class="id">p</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.setN">Mem.setN</a></span> <span class="id"><a href="TSOMemLemmas.html#vl">vl</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span> (<span class="id"><a href="FMemory.html#Mem.setN">Mem.setN</a></span> <span class="id"><a href="TSOMemLemmas.html#vl">vl</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>) = <span class="id"><a href="FMemory.html#Mem.setN">Mem.setN</a></span> <span class="id"><a href="TSOMemLemmas.html#vl">vl</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9546')">Proof.</div>
<div class="proofscript" id="proof9546">
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">vl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">vl</span>; <span class="tactic">intros</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHvl</span> (<span class="id">p</span>+1)%<span class="id">Z</span> (<span class="id"><a href="Maps.html#ZMap.set">ZMap.set</a></span> <span class="id">p</span> <span class="id">a</span> <span class="id">m</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">IHvl</span> <span class="tactic">at</span> 2.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Maps.html#ZMap.set">ZMap.set</a></span> <span class="id">p</span> <span class="id">a</span> (<span class="id"><a href="FMemory.html#Mem.setN">Mem.setN</a></span> <span class="id">vl</span> (<span class="id">p</span> + 1) (<span class="id"><a href="Maps.html#ZMap.set">ZMap.set</a></span> <span class="id">p</span> <span class="id">a</span> <span class="id">m</span>)) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.setN">Mem.setN</a></span> <span class="id">vl</span> (<span class="id">p</span> + 1) (<span class="id"><a href="Maps.html#ZMap.set">ZMap.set</a></span> <span class="id">p</span> <span class="id">a</span> <span class="id">m</span>)).<br/>
&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Maps.html#ZMap.set">ZMap.set</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#PMap_set_same_Mem_eq">PMap_set_same_Mem_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#le_setN_get_same">le_setN_get_same</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Mem_setN_same_place_eq_setN_once">Mem_setN_same_place_eq_setN_once</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">vl</span> <span class="id">vl</span>' : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Memdata.html#memval">memval</a></span>) <span class="id">p</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">Datatypes.length</a></span> <span class="id"><a href="TSOMemLemmas.html#vl">vl</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">Datatypes.length</a></span> <span class="id">vl</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.setN">Mem.setN</a></span> <span class="id"><a href="TSOMemLemmas.html#vl">vl</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span> (<span class="id"><a href="FMemory.html#Mem.setN">Mem.setN</a></span> <span class="id">vl</span>' <span class="id"><a href="TSOMemLemmas.html#p">p</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>) = <span class="id"><a href="FMemory.html#Mem.setN">Mem.setN</a></span> <span class="id"><a href="TSOMemLemmas.html#vl">vl</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9547')">Proof.</div>
<div class="proofscript" id="proof9547">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">vl</span>; <span class="tactic">induction</span> <span class="id">vl</span>'; <span class="tactic">intros</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="FMemory.html#Mem.setN">Mem.setN</a></span> <span class="id">vl</span>' (<span class="id">p</span> + 1) (<span class="id"><a href="Maps.html#ZMap.set">ZMap.set</a></span> <span class="id">p</span> <span class="id">a0</span> <span class="id">m</span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#ZMap.set">ZMap.set</a></span> <span class="id">p</span> <span class="id">a0</span> (<span class="id"><a href="FMemory.html#Mem.setN">Mem.setN</a></span> <span class="id">vl</span>' (<span class="id">p</span> + 1) <span class="id">m</span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Maps.html#ZMap.set">ZMap.set</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#Mem_setN_PMap_set_g_reorder_eq">Mem_setN_PMap_set_g_reorder_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#ZMap.set2">ZMap.set2</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#Mem_setN_ZMap_set_g_reorder_eq">Mem_setN_ZMap_set_g_reorder_eq</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IHvl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#Mem_setN_ZMap_set_g_reorder_eq">Mem_setN_ZMap_set_g_reorder_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="get_bi_block">get_bi_block</a></span> (<span class="id">bi</span> : <span class="id"><a href="TSOMem.html#buffer_item">buffer_item</a></span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id">b</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">b</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="TSOMem.html#BufferedFree">BufferedFree</a></span> <span class="id">b</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">b</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="TSOMem.html#BufferedStore">BufferedStore</a></span> <span class="id">_</span> <span class="id">b</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">b</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="block_not_in_bf_buffer_item_block_neq">block_not_in_bf_buffer_item_block_neq</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">L</span> <span class="id">tm</span> <span class="id">t</span> <span class="id">bi</span> <span class="id">rest</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">t</span>, ~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> (<span class="id"><a href="TSOMem.html#get_tsom_b">get_tsom_b</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> = <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> :: <span class="id"><a href="TSOMemLemmas.html#rest">rest</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOMemLemmas.html#get_bi_block">get_bi_block</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span>) &lt;&gt; <span class="id"><a href="TSOMemLemmas.html#L">L</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9548')">Proof.</div>
<div class="proofscript" id="proof9548">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">get_tsom_b</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H</span> <span class="id">t</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>; <span class="id">simpls</span>; <span class="tactic">intro</span>; <span class="tactic">subst</span>; <span class="id">contradiction</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="nat_add_nochange_zero">nat_add_nochange_zero</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#n">n</a></span>.+1 = 1 -&gt; <span class="id"><a href="TSOMemLemmas.html#n">n</a></span> = 0.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9549')">Proof.</div>
<div class="proofscript" id="proof9549">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<h2> GMemory and TSOMemory Lemmas </h2>
<span class="kwd">Lemma</span> <span class="id"><a name="next_block_not_in_validblock">next_block_not_in_validblock</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fm</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span>) (<span class="id"><a href="FMemory.html#Mem.validblocks">Mem.validblocks</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9550')">Proof.</div>
<div class="proofscript" id="proof9550">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fm</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.nextblock</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="MemAux.html#get_block">get_block</a></span> <span class="id">freelist</span> <span class="id">nextblockid</span> = <span class="id"><a href="MemAux.html#get_block">get_block</a></span> <span class="id">freelist</span> <span class="id">nextblockid</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="mem_strip_gm_vb_eq">mem_strip_gm_vb_eq</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.validblocks">Mem.validblocks</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> = (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9551')">Proof.</div>
<div class="proofscript" id="proof9551">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Mem_writable_imp_readable">Mem_writable_imp_readable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">k</span> <span class="id">sz</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.range_perm">Mem.range_perm</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#sz">sz</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> <span class="id"><a href="Memperm.html#Writable">Memperm.Writable</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.range_perm">Mem.range_perm</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#sz">sz</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> <span class="id"><a href="Memperm.html#Readable">Memperm.Readable</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9552')">Proof.</div>
<div class="proofscript" id="proof9552">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.range_perm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.perm</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.perm_order</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> ((<span class="id"><a href="FMemory.html#Mem.mem_access">Mem.mem_access</a></span> <span class="id">m</span>) !! <span class="id">b</span> <span class="id">ofs0</span> <span class="id">k</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="gmem_perm_strip_mem_perm_eq">gmem_perm_strip_mem_perm_eq</a></span> : <br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fm</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">k</span> <span class="id">p</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.perm">GMem.perm</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span>) <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span> &lt;-&gt; <span class="id"><a href="FMemory.html#Mem.perm">Mem.perm</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9553')">Proof.</div>
<div class="proofscript" id="proof9553">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span>; <span class="id">unfolds</span> <span class="id">GMem.perm</span>, <span class="id">Mem.perm</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">Mem_GMem_access_eq</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="store_succ_read_perm">store_succ_read_perm</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">b</span> <span class="id">ofs</span> <span class="id">c</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span>) <span class="id"><a href="Memperm.html#Max">Max</a></span> <span class="id"><a href="Memperm.html#Readable">Readable</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9554')">Proof.</div>
<div class="proofscript" id="proof9554">
&nbsp;&nbsp;<span class="tactic">intros</span>. <br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>. <br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m</span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>. <br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hrange_perm</span> : <span class="id">v0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hrange_perm</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">valid_access</span>, <span class="id">range_perm</span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hrange_perm</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.perm_order</span>'.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Memperm.html#perm_order_trans">perm_order_trans</a></span> <span class="kwd">with</span> (<span class="id">p2</span> := <span class="id"><a href="Memperm.html#Writable">Writable</a></span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="store_succ_write_perm">store_succ_write_perm</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">b</span> <span class="id">ofs</span> <span class="id">c</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span>) <span class="id"><a href="Memperm.html#Max">Max</a></span> <span class="id"><a href="Memperm.html#Writable">Writable</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9555')">Proof.</div>
<div class="proofscript" id="proof9555">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m</span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>. <br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hrange_perm</span> : <span class="id">v0</span>. <br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hrange_perm</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">valid_access</span>, <span class="id">range_perm</span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hrange_perm</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="GMem_writable_imp_readable">GMem_writable_imp_readable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">k</span> <span class="id">sz</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#sz">sz</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> <span class="id"><a href="Memperm.html#Writable">Memperm.Writable</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#sz">sz</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> <span class="id"><a href="Memperm.html#Readable">Memperm.Readable</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9556')">Proof.</div>
<div class="proofscript" id="proof9556">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">range_perm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.perm_order</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> ((<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m</span>) !! <span class="id">b</span> <span class="id">ofs0</span> <span class="id">k</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Mem_range_perm_cur_max">Mem_range_perm_cur_max</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fm</span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">p</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.range_perm">Mem.range_perm</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> <span class="id"><a href="Memperm.html#Cur">Memperm.Cur</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.range_perm">Mem.range_perm</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> <span class="id"><a href="Memperm.html#Max">Memperm.Max</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9557')">Proof.</div>
<div class="proofscript" id="proof9557">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.range_perm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="FMemory.html#Mem.perm_cur_max">Mem.perm_cur_max</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Mem_GMem_access_eq">Mem_GMem_access_eq</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fm</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.mem_access">Mem.mem_access</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span> = <span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9558')">Proof.</div>
<div class="proofscript" id="proof9558">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fm</span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Mem_GMem_contents_eq">Mem_GMem_contents_eq</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fm</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span>) = <span class="id"><a href="FMemory.html#Mem.mem_contents">Mem.mem_contents</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9559')">Proof.</div>
<div class="proofscript" id="proof9559">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Mem_store_mem_access_stable">Mem_store_mem_access_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fm</span> <span class="id">fm</span>' <span class="id">c</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.store">Mem.store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">fm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.mem_access">Mem.mem_access</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span> = <span class="id"><a href="FMemory.html#Mem.mem_access">Mem.mem_access</a></span> <span class="id">fm</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9560')">Proof.</div>
<div class="proofscript" id="proof9560">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.store</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="GMem_range_perm_Mem_range_perm">GMem_range_perm_Mem_range_perm</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fm</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">c</span> <span class="id">k</span> <span class="id">p</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span>) <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span>) <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.range_perm">Mem.range_perm</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span>) <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9561')">Proof.</div>
<div class="proofscript" id="proof9561">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">range_perm</span>, <span class="id">Mem.range_perm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#Mem.perm">Mem.perm</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#Mem_GMem_access_eq">Mem_GMem_access_eq</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Mem_range_perm_GMem_range_perm">Mem_range_perm_GMem_range_perm</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fm</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">c</span> <span class="id">k</span> <span class="id">p</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.range_perm">Mem.range_perm</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span>) <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span>) <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span>) <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9562')">Proof.</div>
<div class="proofscript" id="proof9562">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.range_perm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span>.<br/>
&nbsp;&nbsp;<span class="id">introv</span> <span class="id">Hrange</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Hrange</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.perm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="TSOMemLemmas.html#Mem_GMem_access_eq">Mem_GMem_access_eq</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="load_in_validblocks">load_in_validblocks</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9563')">Proof.</div>
<div class="proofscript" id="proof9563">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">load</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id">v0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">valid_access</span>, <span class="id">range_perm</span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ht</span> <span class="kwd">as</span> [<span class="id">Ht</span> <span class="id">Halign</span>].<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Ht</span> <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> ((<span class="id">ofs</span> &lt;= <span class="id">ofs</span> &lt; <span class="id">ofs</span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id">c</span>)%<span class="id">Z</span>).<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">destruct</span> <span class="id">c</span>; <span class="id">simpls</span>; <span class="tactic">try</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Ht</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">invalid_noaccess</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.perm_order</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">mem_access</span> !! <span class="id">b</span> <span class="id">ofs</span> <span class="id"><a href="Memperm.html#Max">Max</a></span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hcls</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">Classical_Prop.classic</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">b</span> <span class="id">validblocks</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hcls</span> <span class="kwd">as</span> [<span class="id">Hcls</span> | <span class="id">Hcls</span>]; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">invalid_noaccess</span> <span class="kwd">in</span> <span class="id">Hcls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqo</span> <span class="kwd">in</span> <span class="id">Hcls</span>; <span class="id">tryfalse</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="range_perm_alloc_still">range_perm_alloc_still</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fsm</span> <span class="id">fsm</span>' <span class="id">stk</span>' <span class="id">b</span> <span class="id">ofs</span> <span class="id">c</span> <span class="id">k</span> <span class="id">p</span> <span class="id">lo</span> <span class="id">hi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOMemLemmas.html#fsm">fsm</a></span>) <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span>) <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.alloc">Mem.alloc</a></span> <span class="id"><a href="TSOMemLemmas.html#fsm">fsm</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = (<span class="id">fsm</span>', <span class="id">stk</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fsm</span>') <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span>) <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9564')">Proof.</div>
<div class="proofscript" id="proof9564">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.alloc</span>. <br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>. <br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#strip">strip</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">range_perm</span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">introv</span> <span class="id">Hrange</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Hrange</span>.  <br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hrange</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fsm</span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.perm_order</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="MemAux.html#get_block">get_block</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">mem_access</span> !! <span class="id">b</span> <span class="id">ofs0</span> <span class="id">k</span>) <span class="id">eqn</span>:<span class="id">Hmem_access</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hmem_access</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="MemAux.html#get_block">get_block</a></span> <span class="id">freelist</span> <span class="id">nextblockid</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Str_nth">Str_nth</a></span> <span class="id">nextblockid</span> <span class="id">freelist</span>).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="MemAux.html#get_block">get_block</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : (<span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">Classical_Prop.classic</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Str_nth">Str_nth</a></span> <span class="id">nextblockid</span> <span class="id">freelist</span>) <span class="id">validblocks</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : (<span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">Classical_Prop.classic</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">b</span> <span class="id">validblocks</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span>; <span class="tactic">subst</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">invalid_noaccess</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hmem_access</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="id">tryfalse</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">range_perm_alloc_still</span>' :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">b</span> <span class="id">L</span> <span class="id">ofs</span> <span class="id">c</span> <span class="id">k</span> <span class="id">p</span> <span class="id">lo</span> <span class="id">hi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span>) <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt; <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> &lt;&gt; <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span>) <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9565')">Proof.</div>
<div class="proofscript" id="proof9565">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">range_perm</span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">range_perm_alloc_still</span>'<span class="id">_rev</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">b</span> <span class="id">L</span> <span class="id">ofs</span> <span class="id">c</span> <span class="id">k</span> <span class="id">p</span> <span class="id">lo</span> <span class="id">hi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span>) <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt; <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> &lt;&gt; <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span>) <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9566')">Proof.</div>
<div class="proofscript" id="proof9566">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">range_perm</span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">range_perm_free_still</span>' :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">b</span> <span class="id">L</span> <span class="id">ofs</span> <span class="id">c</span> <span class="id">k</span> <span class="id">p</span> <span class="id">lo</span> <span class="id">hi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span>) <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#free">free</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt; <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> &lt;&gt; <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span>) <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9567')">Proof.</div>
<div class="proofscript" id="proof9567">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">free</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">range_perm</span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">range_perm_free_still</span>'<span class="id">_rev</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">b</span> <span class="id">L</span> <span class="id">ofs</span> <span class="id">c</span> <span class="id">k</span> <span class="id">p</span> <span class="id">lo</span> <span class="id">hi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span>) <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#free">free</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt; <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> &lt;&gt; <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span>) <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9568')">Proof.</div>
<div class="proofscript" id="proof9568">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">free</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">range_perm</span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">range_perm_store_still</span>' :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">b</span> <span class="id">L</span> <span class="id">ofs</span> <span class="id">ofs</span>' <span class="id">v</span> <span class="id">c</span> <span class="id">c</span>' <span class="id">k</span> <span class="id">p</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span>) <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id">c</span>' <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id">ofs</span>' <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span>) <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9569')">Proof.</div>
<div class="proofscript" id="proof9569">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">range_perm_store_still</span>'<span class="id">_rev</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">b</span> <span class="id">L</span> <span class="id">ofs</span> <span class="id">ofs</span>' <span class="id">v</span> <span class="id">c</span> <span class="id">c</span>' <span class="id">k</span> <span class="id">p</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span>) <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id">c</span>' <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id">ofs</span>' <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span>) <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9570')">Proof.</div>
<div class="proofscript" id="proof9570">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">range_perm_store_still</span>'' :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">b</span> <span class="id">L</span> <span class="id">ofs</span>' <span class="id">v</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">c</span>' <span class="id">k</span> <span class="id">p</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id">c</span>' <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id">ofs</span>' <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9571')">Proof.</div>
<div class="proofscript" id="proof9571">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">range_perm_store_still</span>''<span class="id">_rev</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">b</span> <span class="id">L</span> <span class="id">ofs</span>' <span class="id">v</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">c</span>' <span class="id">k</span> <span class="id">p</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id">c</span>' <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id">ofs</span>' <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9572')">Proof.</div>
<div class="proofscript" id="proof9572">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Mem_valid_access_impl_GMem_valid_access">Mem_valid_access_impl_GMem_valid_access</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fm</span> <span class="id">c</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">k</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">HMem_valid_access</span> : <span class="id"><a href="FMemory.html#Mem.valid_access">Mem.valid_access</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span>) <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span>) <span class="id"><a href="Memperm.html#Max">Memperm.Max</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9573')">Proof.</div>
<div class="proofscript" id="proof9573">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.valid_access</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">HMem_valid_access</span> <span class="kwd">as</span> [<span class="id">HMem_range_perm</span> <span class="id">Halign</span>].<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.range_perm</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">range_perm</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.perm</span>.<br/>
&nbsp;&nbsp;<span class="id">introv</span> <span class="id">Hrange</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">HMem_range_perm</span> <span class="kwd">in</span> <span class="id">Hrange</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">InteractionSemantics.perm_order</span>'<span class="id">_</span>''.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#Mem_GMem_access_eq">Mem_GMem_access_eq</a></span> <span class="kwd">in</span> <span class="id">Hrange</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="GMem_contents_get_block_alloc_eq">GMem_contents_get_block_alloc_eq</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fsm</span> <span class="id">fsm</span>' <span class="id">stk</span>' <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.alloc">Mem.alloc</a></span> <span class="id"><a href="TSOMemLemmas.html#fsm">fsm</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = (<span class="id">fsm</span>', <span class="id">stk</span>') -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="FMemory.html#Mem.validblocks">Mem.validblocks</a></span> <span class="id"><a href="TSOMemLemmas.html#fsm">fsm</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOMemLemmas.html#fsm">fsm</a></span>)) !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fsm</span>')) !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9574')">Proof.</div>
<div class="proofscript" id="proof9574">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.alloc</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#strip">strip</a></span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fsm</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">introv</span> <span class="id">Hcontr</span>.<br/>
&nbsp;&nbsp;<span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">Hcontr</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd</span> <span class="kwd">in</span> <span class="id">Hcontr</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hcontr</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="range_perm_cur_max">range_perm_cur_max</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">p</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.range_perm">Mem.range_perm</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> <span class="id"><a href="Memperm.html#Cur">Memperm.Cur</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.range_perm">Mem.range_perm</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> <span class="id"><a href="Memperm.html#Max">Memperm.Max</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9575')">Proof.</div>
<div class="proofscript" id="proof9575">
&nbsp;&nbsp;<span class="id">memunfolds</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="FMemory.html#Mem.perm_cur_max">Mem.perm_cur_max</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="gmem_eq">gmem_eq</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m1</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9576')">Proof.</div>
<div class="proofscript" id="proof9576">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m1</span>,<span class="id">m2</span>;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Axioms.html#proof_irr">proof_irr</a></span> <span class="kwd">with</span>(<span class="id">a1</span>:=<span class="id">access_max</span>)(<span class="id">a2</span>:=<span class="id">access_max0</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Axioms.html#proof_irr">proof_irr</a></span> <span class="kwd">with</span>(<span class="id">a1</span>:=<span class="id">contents_default</span>)(<span class="id">a2</span>:=<span class="id">contents_default0</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Axioms.html#proof_irr">proof_irr</a></span> <span class="kwd">with</span>(<span class="id">a1</span>:=<span class="id">invalid_noaccess</span>)(<span class="id">a2</span>:=<span class="id">invalid_noaccess0</span>).<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="load_fm_eq_load_gm">load_fm_eq_load_gm</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">fm</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.load">Mem.load</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span>) <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9577')">Proof.</div>
<div class="proofscript" id="proof9577">
&nbsp;&nbsp;<span class="id">memunfolds</span>;<span class="tactic">intros</span>;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="FMemory.html#Mem.valid_access_dec">Mem.valid_access_dec</a></span>;<span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="TSOMem.html#valid_access_dec">TSOMem.valid_access_dec</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">contradict</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">v0</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#range_perm_cur_max">range_perm_cur_max</a></span>;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="load_gm_embed_load_fm">load_gm_embed_load_fm</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">fl</span> <span class="id">fm</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span> <span class="id">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">ofs</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> &lt;= <span class="id">ofs</span>' &lt; <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">p</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span>)) !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id">ofs</span>' <span class="id"><a href="Memperm.html#Cur">Memperm.Cur</a></span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">p</span> /\ <span class="id"><a href="Memperm.html#perm_order">Memperm.perm_order</a></span> <span class="id">p</span> <span class="id"><a href="Memperm.html#Writable">Memperm.Writable</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#fl">fl</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.load">Mem.load</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9578')">Proof.</div>
<div class="proofscript" id="proof9578">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">memunfolds</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>. <br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H2</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#Mem.valid_access">Mem.valid_access</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#Mem.range_perm">Mem.range_perm</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">p</span> [<span class="id">Hperm</span> <span class="id">Hperm_order</span>]].<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#Mem.perm">Mem.perm</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hperm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Mem.perm_order</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Memperm.html#perm_order_trans">perm_order_trans</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">v0</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">valid_access</span>.<br/>
&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">v0</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="store_fm_eq_store_gm">store_fm_eq_store_gm</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fm</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">c</span> <span class="id">v</span> <span class="id">fm</span>' ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.store">Mem.store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">fm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span>) <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm</span>'). <br/>
<div class="toggleproof" onclick="toggleDisplay('proof9579')">Proof.</div>
<div class="proofscript" id="proof9579">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.store</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#store">store</a></span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">HMem_valid_access</span> : <span class="id">v0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#Mem_valid_access_impl_GMem_valid_access">Mem_valid_access_impl_GMem_valid_access</a></span> <span class="kwd">in</span> <span class="id">HMem_valid_access</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#strip">strip</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fm</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#gmem_eq">gmem_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">v0</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.valid_access</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v0</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#valid_access">valid_access</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#range_perm_cur_max">range_perm_cur_max</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#Mem_range_perm_GMem_range_perm">Mem_range_perm_GMem_range_perm</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="gm_store_v_load_same">gm_store_v_load_same</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">n</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="TSOMemLemmas.html#n">n</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="TSOMemLemmas.html#n">n</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9580')">Proof.</div>
<div class="proofscript" id="proof9580">
&nbsp;&nbsp;<span class="tactic">intros</span>. <br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hrange_perm</span> : <span class="id"><a href="TSOMemLemmas.html#store_succ_read_perm">store_succ_read_perm</a></span> <span class="id">___</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#load">load</a></span>. <br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H0</span> <span class="id">to</span> <span class="id">Heqe</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>. <br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Memdata.html#size_chunk_nat">size_chunk_nat</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="id">nat_of_Z</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.to_nat">Pos.to_nat</a></span> 4 =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">Datatypes.length</a></span> (<span class="id"><a href="Memdata.html#inj_bytes">inj_bytes</a></span> (<span class="id"><a href="Memdata.html#encode_int">encode_int</a></span> 4 (<span class="id"><a href="Integers.html#Int.unsigned">Int.unsigned</a></span> <span class="id">n</span>)))).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Memdata.html#encode_int">encode_int</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Memdata.html#rev_if_be">rev_if_be</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Archi.html#big_endian">Archi.big_endian</a></span> <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="FMemory.html#Mem.getN_setN_same">Mem.getN_setN_same</a></span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="Memdata.html#decode_encode_val_general">decode_encode_val_general</a></span> (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id">n</span>) <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">n0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">v</span> <span class="id">Hrange_perm</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">valid_access</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="load_gm_load_spec_m">load_gm_load_spec_m</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sm</span> <span class="id">b</span> <span class="id">v</span> <span class="id">m</span> <span class="id">fl</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id"><a href="TSOMemLemmas.html#sm">sm</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> 0 = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id"><a href="TSOMemLemmas.html#sm">sm</a></span> <span class="id"><a href="TSOMemLemmas.html#fl">fl</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="SpecLang.html#loadmax">SpecLang.loadmax</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9581')">Proof.</div>
<div class="proofscript" id="proof9581">
&nbsp;&nbsp;<span class="id">memunfolds</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Hx0</span>;<span class="id">contradict</span> <span class="id">n</span>. <span class="tactic">inversion</span> <span class="id">v0</span>;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">memunfolds</span>. <span class="tactic">eauto</span>.<br/>
Qed.</div>
&nbsp;&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="load_spec_m_load_gm">load_spec_m_load_gm</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sm</span> <span class="id">b</span> <span class="id">v</span> <span class="id">m</span> <span class="id">fl</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="SpecLang.html#loadmax">SpecLang.loadmax</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id"><a href="TSOMemLemmas.html#sm">sm</a></span> <span class="id"><a href="TSOMemLemmas.html#fl">fl</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id"><a href="TSOMemLemmas.html#sm">sm</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> 0 = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9582')">Proof.</div>
<div class="proofscript" id="proof9582">
&nbsp;&nbsp;<span class="id">memunfolds</span>;<span class="tactic">inversion</span> 2;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">memunfolds</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Hx0</span>.<br/>
&nbsp;&nbsp;<span class="id">contradict</span> <span class="id">n</span>. <span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Znumtheory.html#Zmod_divide">Zmod_divide</a></span>;<span class="tactic">auto</span>;  <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="store_v_load_eq_spec_m">store_v_load_eq_spec_m</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">b</span> <span class="id">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="SpecLang.html#storemax">SpecLang.storemax</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="TSOMemLemmas.html#n">n</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="SpecLang.html#loadmax">SpecLang.loadmax</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="TSOMemLemmas.html#n">n</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9583')">Proof.</div>
<div class="proofscript" id="proof9583">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">SpecLang.storemax</span>. <br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="SpecLang.html#loadmax">SpecLang.loadmax</a></span>.   <br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="FMemory.html#Mem.range_perm_dec">Mem.range_perm_dec</a></span> <span class="id">m</span> <span class="id">b</span> 0 (<span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Memperm.html#Max">Memperm.Max</a></span> <span class="id"><a href="Memperm.html#Writable">Memperm.Writable</a></span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id"><a href="TSOMemLemmas.html#Mem_writable_imp_readable">Mem_writable_imp_readable</a></span> <span class="id">___</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="FMemory.html#Mem.range_perm_dec">Mem.range_perm_dec</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id"><a href="Memperm.html#Readable">Memperm.Readable</a></span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>. <br/>
&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">R</span>: <span class="id"><a href="FMemory.html#Mem.mem_contents">Mem.mem_contents</a></span> <span class="id">m</span>' =  <span class="id"><a href="Maps.html#PMap.set">PMap.set</a></span> <span class="id">b</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="FMemory.html#Mem.setN">Mem.setN</a></span> (<span class="id"><a href="Memdata.html#encode_val">encode_val</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id">n</span>)) 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="FMemory.html#Mem.mem_contents">Mem.mem_contents</a></span> <span class="id">m</span>) !! <span class="id">b</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="FMemory.html#Mem.mem_contents">Mem.mem_contents</a></span> <span class="id">m</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">R</span>. <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;<br/>
&nbsp;&nbsp;<span class="id">pose</span> <span class="id"><a href="FMemory.html#Mem.getN_setN_same">FMemory.Mem.getN_setN_same</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>;<span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">Datatypes.length</a></span> (<span class="id"><a href="Memdata.html#encode_val">encode_val</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id">n</span>)) = <span class="id"><a href="Memdata.html#size_chunk_nat">size_chunk_nat</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span>).<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Memdata.html#inj_bytes">inj_bytes</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="Memdata.html#encode_int">encode_int</a></span>, <span class="id"><a href="Memdata.html#size_chunk_nat">size_chunk_nat</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Memdata.html#rev_if_be">rev_if_be</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Archi.html#big_endian">Archi.big_endian</a></span> <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="FMemory.html#Mem.getN_setN_same">Mem.getN_setN_same</a></span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="Memdata.html#decode_encode_val_general">decode_encode_val_general</a></span> (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id">n</span>) <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H0</span>. <br/>
&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Heqs0</span>.<br/>
&nbsp;&nbsp;<span class="id">contradict</span> <span class="id">n0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#Mem.range_perm">Mem.range_perm</a></span>, <span class="id"><a href="FMemory.html#Mem.perm">Mem.perm</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="store_gm_embed_store_fm">store_gm_embed_store_fm</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">fl</span> <span class="id">fm</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span> <span class="id">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">ofs</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> &lt;= <span class="id">ofs</span>' &lt; <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">p</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span>)) !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id">ofs</span>' <span class="id"><a href="Memperm.html#Cur">Memperm.Cur</a></span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">p</span> /\ <span class="id"><a href="Memperm.html#perm_order">Memperm.perm_order</a></span> <span class="id">p</span> <span class="id"><a href="Memperm.html#Writable">Memperm.Writable</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#fl">fl</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">fm</span>', <span class="id"><a href="FMemory.html#Mem.store">Mem.store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">fm</span>' /\ <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#fl">fl</a></span> <span class="id">fm</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9584')">Proof.</div>
<div class="proofscript" id="proof9584">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H1</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#Mem.store">Mem.store</a></span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span> <span class="id">v0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#Mem.valid_access">Mem.valid_access</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#Mem.range_perm">Mem.range_perm</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#Mem.perm">Mem.perm</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">p</span> [<span class="id">Hperm</span> <span class="id">Hperm_order</span>]].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#Mem_GMem_access_eq">Mem_GMem_access_eq</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Mem.perm_order</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hperm</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">valid_access</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#strip">strip</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#gmem_eq">gmem_eq</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
&nbsp;&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="store_gm_store_spec_m">store_gm_store_spec_m</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sm</span> <span class="id">b</span> <span class="id">n</span> <span class="id">sm</span>' <span class="id">fl</span> <span class="id">fsm</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id"><a href="TSOMemLemmas.html#sm">sm</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> 0 (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="TSOMemLemmas.html#n">n</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">sm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id"><a href="TSOMemLemmas.html#sm">sm</a></span> <span class="id"><a href="TSOMemLemmas.html#fl">fl</a></span> <span class="id"><a href="TSOMemLemmas.html#fsm">fsm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">fsm</span>', <span class="id"><a href="SpecLang.html#storemax">SpecLang.storemax</a></span> <span class="id"><a href="TSOMemLemmas.html#fsm">fsm</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="TSOMemLemmas.html#n">n</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">fsm</span>' /\ <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">sm</span>' <span class="id"><a href="TSOMemLemmas.html#fl">fl</a></span> <span class="id">fsm</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9585')">Proof.</div>
<div class="proofscript" id="proof9585">
&nbsp;&nbsp;<span class="id">memunfolds</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>. <span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">memunfolds</span>;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOMemLemmas.html#gmem_eq">gmem_eq</a></span>;<span class="tactic">simpl</span>;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Hx0</span>.<br/>
&nbsp;&nbsp;<span class="id">contradict</span> <span class="id">n0</span>. <span class="tactic">inversion</span> <span class="id">v</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#strip">strip</a></span>,<span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="store_gm_embed_store_tsofmem">store_gm_embed_store_tsofmem</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">L</span> <span class="id">m</span>' <span class="id">fl</span> <span class="id">fm</span> <span class="id">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> 0 (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="TSOMemLemmas.html#n">n</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#fl">fl</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">tm</span>', <span class="id"><a href="TSOMem.html#tsostorev">tsostorev</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> {| <span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>; <span class="id">fmemory</span> := <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span> |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0)) (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="TSOMemLemmas.html#n">n</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">tm</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9586')">Proof.</div>
<div class="proofscript" id="proof9586">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsostorev">tsostorev</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsostore">tsostore</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="tsostorev_in_bf">tsostorev_in_bf</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tm</span> <span class="id">bm</span>' <span class="id">t</span> <span class="id">fm</span> <span class="id">fl</span> <span class="id">L</span> <span class="id">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span>) <span class="id"><a href="TSOMemLemmas.html#fl">fl</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tsostorev">tsostorev</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> {| <span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span> := <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span>; <span class="id">fmemory</span> := <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span> |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0)) (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="TSOMemLemmas.html#n">n</a></span>) = <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">bm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="TSOMem.html#BufferedStore">BufferedStore</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> 0 (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="TSOMemLemmas.html#n">n</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> (<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">bm</span>') (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span>) <span class="id"><a href="TSOMemLemmas.html#t">t</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9587')">Proof.</div>
<div class="proofscript" id="proof9587">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">tsostorev</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">tsostore</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="Integers.html#Ptrofs.unsigned">Ptrofs.unsigned</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0)) <span class="kwd">with</span> 0%<span class="id">Z</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_or_app">in_or_app</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">right</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Mem_alloc_gm_alloc">Mem_alloc_gm_alloc</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fsm</span> <span class="id">fsm</span>' <span class="id">stk</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.alloc">Mem.alloc</a></span> <span class="id"><a href="TSOMemLemmas.html#fsm">fsm</a></span> 0 0 = (<span class="id">fsm</span>', <span class="id">stk</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#alloc">alloc</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOMemLemmas.html#fsm">fsm</a></span>) <span class="id">stk</span>' 0 0 = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fsm</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9588')">Proof.</div>
<div class="proofscript" id="proof9588">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.alloc</span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#strip">strip</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fsm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#gmem_eq">gmem_eq</a></span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
&nbsp;&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="tso_store_not_imm">tso_store_not_imm</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tsofm</span> <span class="id">tsofm</span>' <span class="id">n</span> <span class="id">m</span> <span class="id">L</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id"><a href="TSOMemLemmas.html#tsofm">tsofm</a></span>)) <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> 0 = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tsostorev">tsostorev</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id"><a href="TSOMemLemmas.html#tsofm">tsofm</a></span> (<span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0)) (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="TSOMemLemmas.html#n">n</a></span>) = <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">tsofm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id">tsofm</span>')) <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> 0 = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9589')">Proof.</div>
<div class="proofscript" id="proof9589">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">tsostorev</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">tsostore</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="load_Mem_alloc_still">load_Mem_alloc_still</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">fsm</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">fsm</span>' <span class="id">stk</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOMemLemmas.html#fsm">fsm</a></span>) <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.alloc">Mem.alloc</a></span> <span class="id"><a href="TSOMemLemmas.html#fsm">fsm</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = (<span class="id">fsm</span>', <span class="id">stk</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fsm</span>') <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9590')">Proof.</div>
<div class="proofscript" id="proof9590">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">load</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.  <br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hrange_perm</span> : <span class="id">v0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#valid_access">valid_access</a></span> <span class="kwd">in</span> <span class="id">Hrange_perm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hrange_perm</span> <span class="kwd">as</span> [<span class="id">Hrange_perm</span> <span class="id">Halign</span>].<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#range_perm_alloc_still">range_perm_alloc_still</a></span> <span class="kwd">in</span> <span class="id">Hrange_perm</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOMemLemmas.html#GMem_contents_get_block_alloc_eq">GMem_contents_get_block_alloc_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id">v0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#valid_access">valid_access</a></span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ht</span> <span class="kwd">as</span> [<span class="id">Ht</span> <span class="id">Halign1</span>].<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">range_perm</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Ht</span> <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> ((<span class="id">ofs</span> &lt;= <span class="id">ofs</span> &lt; <span class="id">ofs</span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id">c</span>)%<span class="id">Z</span>).<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">c</span>; <span class="id">simpls</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Ht</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.perm_order</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> ((<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fsm</span>)) !! <span class="id">b</span> <span class="id">ofs</span> <span class="id"><a href="Memperm.html#Max">Max</a></span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fsm</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">Classical_Prop.classic</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">b</span> <span class="id">validblocks</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ht</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">invalid_noaccess</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqo</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hrange_perm</span> <span class="id">n</span> <span class="id">v0</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">valid_access</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v0</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="tsostorev_append_bf">tsostorev_append_bf</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">fm</span> <span class="id">fl</span> <span class="id">bfs</span> <span class="id">n</span> <span class="id">tsofm</span> <span class="id">L</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#fl">fl</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tsostorev">tsostorev</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> {| <span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span> := <span class="id"><a href="TSOMemLemmas.html#bfs">bfs</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span>; <span class="id">fmemory</span> := <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span> |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0)) (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="TSOMemLemmas.html#n">n</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#tsofm">tsofm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#append_t_buffer">append_t_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOMemLemmas.html#bfs">bfs</a></span>; <span class="id">memory</span> := <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOMem.html#BufferedStore">BufferedStore</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> 0 (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="TSOMemLemmas.html#n">n</a></span>)) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> (<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOMemLemmas.html#tsofm">tsofm</a></span>) <span class="id"><a href="TSOMemLemmas.html#bfs">bfs</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">memory</span> := <span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id"><a href="TSOMemLemmas.html#tsofm">tsofm</a></span>) |}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9591')">Proof.</div>
<div class="proofscript" id="proof9591">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">tsostorev</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">tsostore</span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#append_t_buffer">append_t_buffer</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="Integers.html#Ptrofs.unsigned">Ptrofs.unsigned</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0)) <span class="kwd">with</span> 0%<span class="id">Z</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="gm_store_succ_store_again">gm_store_succ_store_again</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sm</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">n</span> <span class="id">n</span>' <span class="id">sm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id"><a href="TSOMemLemmas.html#sm">sm</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="TSOMemLemmas.html#n">n</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">sm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">sm</span>'', <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id">sm</span>' <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id">n</span>') = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">sm</span>''.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9592')">Proof.</div>
<div class="proofscript" id="proof9592">
&nbsp;&nbsp;<span class="id">memunfolds</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Hx0</span>.<br/>
&nbsp;&nbsp;<span class="id">contradict</span> <span class="id">n0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">v</span>;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Mem_load_fm_load_tm_eq">Mem_load_fm_load_tm_eq</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tm</span> <span class="id">fl</span> <span class="id">fm</span> <span class="id">n</span> <span class="id">b</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span>) <span class="id"><a href="TSOMemLemmas.html#fl">fl</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span>) <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> 0 = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="TSOMemLemmas.html#n">n</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tsoloadv">tsoloadv</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> {| <span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>; <span class="id">fmemory</span> := <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span> |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0)) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="TSOMemLemmas.html#n">n</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9593')">Proof.</div>
<div class="proofscript" id="proof9593">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsoloadv">tsoloadv</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsoload">tsoload</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="Integers.html#Ptrofs.unsigned">Ptrofs.unsigned</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0)) <span class="kwd">with</span> 0%<span class="id">Z</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="tsoalloc_bf_nil_succ_sz0">tsoalloc_bf_nil_succ_sz0</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fm</span>,<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">tm</span> <span class="id">stk</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tsoalloc">tsoalloc</a></span> {| <span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>; <span class="id">fmemory</span> := <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span> |} 0 0 (<span class="id">tm</span>, <span class="id">stk</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9594')">Proof.</div>
<div class="proofscript" id="proof9594">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="id">eexists</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id">fm</span>).<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="embed_alloc_succ">embed_alloc_succ</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sm</span> <span class="id">fl</span> <span class="id">fsm</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id"><a href="TSOMemLemmas.html#sm">sm</a></span> <span class="id"><a href="TSOMemLemmas.html#fl">fl</a></span> <span class="id"><a href="TSOMemLemmas.html#fsm">fsm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">fsm</span>', <span class="id"><a href="FMemory.html#Mem.alloc">Mem.alloc</a></span> <span class="id"><a href="TSOMemLemmas.html#fsm">fsm</a></span> 0 0 = (<span class="id">fsm</span>', <span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id"><a href="TSOMemLemmas.html#fsm">fsm</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9595')">Proof.</div>
<div class="proofscript" id="proof9595">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">Transparent</span> <span class="id"><a href="FMemory.html#Mem.alloc">Mem.alloc</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#Mem.alloc">Mem.alloc</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="speclang_store_impl_obj_mem">speclang_store_impl_obj_mem</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fsm</span> <span class="id">L</span> <span class="id">fsm</span>' <span class="id">ofs</span> <span class="id">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html#obj_mem">obj_mem</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOMemLemmas.html#fsm">fsm</a></span>) <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="SpecLang.html#storemax">SpecLang.storemax</a></span> <span class="id"><a href="TSOMemLemmas.html#fsm">fsm</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="TSOMemLemmas.html#n">n</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">fsm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(0 &lt;= <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> &lt; 4)%<span class="id">Z</span> -&gt; <span class="id"><a href="RGRels.html#obj_mem">obj_mem</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fsm</span>') <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9596')">Proof.</div>
<div class="proofscript" id="proof9596">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">SpecLang.storemax</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="FMemory.html#Mem.range_perm_dec">Mem.range_perm_dec</a></span> <span class="id">fsm</span> <span class="id">L</span> 0 (<span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Memperm.html#Max">Memperm.Max</a></span> <span class="id"><a href="Memperm.html#Writable">Memperm.Writable</a></span>) <span class="id">eqn</span>:<span class="id">Heqe</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="RGRels.html#obj_mem">obj_mem</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">obj_mem</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="GMem_writeable_store_succ">GMem_writeable_store_succ</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fm</span> <span class="id">b</span> <span class="id">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.range_perm">Mem.range_perm</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> 0 4 <span class="id"><a href="Memperm.html#Cur">Memperm.Cur</a></span> <span class="id"><a href="Memperm.html#Writable">Memperm.Writable</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">fm</span>', <span class="id"><a href="FMemory.html#Mem.store">Mem.store</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> 0 (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="TSOMemLemmas.html#n">n</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">fm</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9597')">Proof.</div>
<div class="proofscript" id="proof9597">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span> <span class="id"><a href="FMemory.html#Mem.valid_access_store">Mem.valid_access_store</a></span>.<br/>
&nbsp;&nbsp;<span class="id">enough</span>(  <span class="id"><a href="FMemory.html#Mem.valid_access">Mem.valid_access</a></span> <span class="id">fm</span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id">b</span> 0 <span class="id"><a href="Memperm.html#Writable">Memperm.Writable</a></span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemory.html#Mem.valid_access_store">Mem.valid_access_store</a></span> <span class="kwd">with</span>(<span class="id">v</span>:=<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id">n</span>) <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Znumtheory.html#Zmod_divide">Zmod_divide</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="buffer_unchange">buffer_unchange</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">tm</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span>) (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span>) = <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9598')">Proof.</div>
<div class="proofscript" id="proof9598">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Axioms.html#functional_extensionality">functional_extensionality</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">x</span> <span class="id">t</span>) <span class="id">eqn</span> : <span class="id">Heqe</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">buffer_unchange</span>' :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">bfs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> (<span class="id"><a href="TSOMemLemmas.html#bfs">bfs</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span>) <span class="id"><a href="TSOMemLemmas.html#bfs">bfs</a></span> = <span class="id"><a href="TSOMemLemmas.html#bfs">bfs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9599')">Proof.</div>
<div class="proofscript" id="proof9599">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Axioms.html#functional_extensionality">functional_extensionality</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">x</span> <span class="id">t</span>) <span class="id">eqn</span> : <span class="id">Heqe</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_tbf_upd_oth_stillin">in_tbf_upd_oth_stillin</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">t</span>' <span class="id">bfs</span> <span class="id">bf</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#t">t</a></span> &lt;&gt; <span class="id">t</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id">t</span>' <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOMemLemmas.html#bfs">bfs</a></span>) <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> = <span class="id"><a href="TSOMemLemmas.html#bfs">bfs</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9600')">Proof.</div>
<div class="proofscript" id="proof9600">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t</span>') <span class="id">eqn</span>:?; <span class="id">tryfalse</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="buffer_unchange1">buffer_unchange1</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">tm</span> <span class="id">bf</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> = <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span>) = <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9601')">Proof.</div>
<div class="proofscript" id="proof9601">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#buffer_unchange">buffer_unchange</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
&nbsp;&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="tm_unchange">tm_unchange</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tm</span> <span class="id">fm</span> <span class="id">fl</span> <span class="id">t</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hembed</span> : <span class="id"><a href="FMemory.html#embed">embed</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span>) <span class="id"><a href="TSOMemLemmas.html#fl">fl</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span>) (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">memory</span> := <span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span> |} = <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9602')">Proof.</div>
<div class="proofscript" id="proof9602">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#buffer_unchange">buffer_unchange</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="tm_unchange1">tm_unchange1</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tm</span> <span class="id">fm</span> <span class="id">fl</span> <span class="id">t</span> <span class="id">bf</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hembed</span> : <span class="id"><a href="FMemory.html#embed">embed</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span>) <span class="id"><a href="TSOMemLemmas.html#fl">fl</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ht_bf</span> : <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> = <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">memory</span> := <span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span> |} = <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9603')">Proof.</div>
<div class="proofscript" id="proof9603">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#tm_unchange">tm_unchange</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="get_buffer_b_app">get_buffer_b_app</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l1</span> <span class="id">l2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> (<span class="id"><a href="TSOMemLemmas.html#l1">l1</a></span> ++ <span class="id"><a href="TSOMemLemmas.html#l2">l2</a></span>) = <span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> <span class="id"><a href="TSOMemLemmas.html#l1">l1</a></span> ++ <span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> <span class="id"><a href="TSOMemLemmas.html#l2">l2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9604')">Proof.</div>
<div class="proofscript" id="proof9604">
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">l1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l1</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IHl1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="count_occ_app">count_occ_app</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span> (<span class="id">eq_dec</span> : <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> : <span class="id"><a href="TSOMemLemmas.html#A">A</a></span>, {<span class="id"><a href="TSOMemLemmas.html#x">x</a></span> = <span class="id"><a href="TSOMemLemmas.html#y">y</a></span>} + {<span class="id"><a href="TSOMemLemmas.html#x">x</a></span> &lt;&gt; <span class="id"><a href="TSOMemLemmas.html#y">y</a></span>}) (<span class="id">l1</span> <span class="id">l2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="TSOMemLemmas.html#A">A</a></span>) (<span class="id">x</span> : <span class="id"><a href="TSOMemLemmas.html#A">A</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ">count_occ</a></span> <span class="id"><a href="TSOMemLemmas.html#eq_dec">eq_dec</a></span> (<span class="id"><a href="TSOMemLemmas.html#l1">l1</a></span> ++ <span class="id"><a href="TSOMemLemmas.html#l2">l2</a></span>) <span class="id"><a href="TSOMemLemmas.html#x">x</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ">count_occ</a></span> <span class="id"><a href="TSOMemLemmas.html#eq_dec">eq_dec</a></span> <span class="id"><a href="TSOMemLemmas.html#l1">l1</a></span> <span class="id"><a href="TSOMemLemmas.html#x">x</a></span> + <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ">count_occ</a></span> <span class="id"><a href="TSOMemLemmas.html#eq_dec">eq_dec</a></span> <span class="id"><a href="TSOMemLemmas.html#l2">l2</a></span> <span class="id"><a href="TSOMemLemmas.html#x">x</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9605')">Proof.</div>
<div class="proofscript" id="proof9605">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">A</span> <span class="id">eq_dec</span> <span class="id">l1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l1</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">eq_dec</span> <span class="id">a</span> <span class="id">x</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IHl1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IHl1</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="bf_not_in_add_count_one">bf_not_in_add_count_one</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">tm</span> <span class="id">L</span> <span class="id">fl</span> <span class="id">tsofm</span>' <span class="id">fm</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span>) <span class="id"><a href="TSOMemLemmas.html#fl">fl</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> (<span class="id"><a href="TSOMem.html#get_tsom_b">get_tsom_b</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tsostorev">tsostorev</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> {| <span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span> := <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span>; <span class="id">fmemory</span> := <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span> |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0)) (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="Integers.html#Int.one">Int.one</a></span>) = <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">tsofm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ">count_occ</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> (<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> (<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">tsofm</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span>) <span class="id"><a href="TSOMemLemmas.html#t">t</a></span>)) <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> = 1.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9606')">Proof.</div>
<div class="proofscript" id="proof9606">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">tsostore</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H1</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#get_buffer_b_app">get_buffer_b_app</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#count_occ_app">count_occ_app</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> <span class="id">L</span> <span class="id">L</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ_not_In">count_occ_not_In</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="GMem_store_alloc_store">GMem_store_alloc_store</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fm</span> <span class="id">fm</span>' <span class="id">stk</span>' <span class="id">c</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span> <span class="id">M</span> <span class="id">lo</span> <span class="id">hi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span>) <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#M">M</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.alloc">Mem.alloc</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = (<span class="id">fm</span>', <span class="id">stk</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">M</span>', <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm</span>') <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">M</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9607')">Proof.</div>
<div class="proofscript" id="proof9607">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#valid_access">valid_access</a></span> <span class="kwd">in</span> <span class="id">v0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v0</span> <span class="kwd">as</span> [<span class="id">Hrange_perm</span> <span class="id">Halign</span>].<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id"><a href="TSOMemLemmas.html#range_perm_alloc_still">range_perm_alloc_still</a></span> <span class="id">___</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Ht</span> <span class="id">Halign</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#valid_access">valid_access</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="SpecLang_store_store_gm">SpecLang_store_store_gm</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fsm</span> <span class="id">fsm</span>' <span class="id">b</span> <span class="id">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="SpecLang.html#storemax">SpecLang.storemax</a></span> <span class="id"><a href="TSOMemLemmas.html#fsm">fsm</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="TSOMemLemmas.html#n">n</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">fsm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOMemLemmas.html#fsm">fsm</a></span>) <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> 0 (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="TSOMemLemmas.html#n">n</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fsm</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9608')">Proof.</div>
<div class="proofscript" id="proof9608">
&nbsp;&nbsp;<span class="id">memunfolds</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#gmem_eq">gmem_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">n0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">r</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#valid_access">valid_access</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.divide_0_r">Z.divide_0_r</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="tsoalloc_append">tsoalloc_append</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fm</span> <span class="id">stk</span> <span class="id">tm</span> <span class="id">t</span> <span class="id">bm1</span> <span class="id">fl</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span>) <span class="id"><a href="TSOMemLemmas.html#fl">fl</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tsoalloc">tsoalloc</a></span> {| <span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span> := <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span>; <span class="id">fmemory</span> := <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span> |} 0 0 (<span class="id"><a href="TSOMemLemmas.html#bm1">bm1</a></span>, <span class="id"><a href="TSOMemLemmas.html#stk">stk</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#append_t_buffer">append_t_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span> (<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id"><a href="TSOMemLemmas.html#stk">stk</a></span> 0 0) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> (<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bm1">bm1</a></span>) (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">memory</span> := <span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id"><a href="TSOMemLemmas.html#bm1">bm1</a></span>) |}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9609')">Proof.</div>
<div class="proofscript" id="proof9609">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#append_t_buffer">append_t_buffer</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Ltac</span> <span class="id">solve_m_unchange_objinv</span> <span class="id">tm</span> <span class="id">Hobj_inv</span> :=<br/>
&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#buffer_unchange">buffer_unchange</a></span>;<br/>
&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>;<br/>
&nbsp;&nbsp;<span class="tactic">try</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">_</span> = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hobj_inv</span> <span class="id">H</span>; <span class="id">simpls</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">solve_m_unchange_objinv1</span> <span class="id">tm</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">tm</span>, <span class="id">H1</span> : <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">H1</span> <span class="id">into</span> <span class="id">Hembed</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_m_unchange_objinv</span> <span class="id">tm</span> <span class="id">H</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_buffer_item_in_validbloks_stable">apply_buffer_item_in_validbloks_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">bi</span> <span class="id">m</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9610')">Proof.</div>
<div class="proofscript" id="proof9610">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">free</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
&nbsp;&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_buffer_in_validblocks_stable">apply_buffer_in_validblocks_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9611')">Proof.</div>
<div class="proofscript" id="proof9611">
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">bf</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>; <span class="id">simpls</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#optbind">optbind</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf</span> <span class="kwd">with</span> (<span class="id">m</span> := <span class="id">g</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buffer_item_in_validbloks_stable">apply_buffer_item_in_validbloks_stable</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_bf_stable1">in_bf_stable1</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">L</span> <span class="id">t</span> <span class="id">b</span> <span class="id">bfs</span> <span class="id">bi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#bfs">bfs</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> = <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> :: <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> (<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#bfs">bfs</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> (<span class="id"><a href="TSOMemLemmas.html#bfs">bfs</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9612')">Proof.</div>
<div class="proofscript" id="proof9612">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">tupdate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_bf_stable2">in_bf_stable2</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">L</span> <span class="id">t</span> <span class="id">t0</span> <span class="id">b</span> <span class="id">bfs</span> <span class="id">bi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#bfs">bfs</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> = <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> :: <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> -&gt; <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> &lt;&gt; <span class="id"><a href="TSOMemLemmas.html#t0">t0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> (<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#bfs">bfs</a></span> <span class="id"><a href="TSOMemLemmas.html#t0">t0</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> (<span class="id"><a href="TSOMemLemmas.html#bfs">bfs</a></span> <span class="id"><a href="TSOMemLemmas.html#t0">t0</a></span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9613')">Proof.</div>
<div class="proofscript" id="proof9613">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">tupdate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t0</span> <span class="id">t</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="speclang_not_change_perm">speclang_not_change_perm</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fm</span> <span class="id">fm</span>' <span class="id">L</span> <span class="id">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="SpecLang.html#storemax">SpecLang.storemax</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="TSOMemLemmas.html#n">n</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">fm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.mem_access">Mem.mem_access</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span> = <span class="id"><a href="FMemory.html#Mem.mem_access">Mem.mem_access</a></span> <span class="id">fm</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9614')">Proof.</div>
<div class="proofscript" id="proof9614">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">SpecLang.storemax</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="store_vb_eq">store_vb_eq</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">c</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> = <span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9615')">Proof.</div>
<div class="proofscript" id="proof9615">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="speclang_store_vb_eq">speclang_store_vb_eq</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">b</span> <span class="id">n</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="SpecLang.html#storemax">SpecLang.storemax</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="TSOMemLemmas.html#n">n</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.validblocks">Mem.validblocks</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> = <span class="id"><a href="FMemory.html#Mem.validblocks">Mem.validblocks</a></span> <span class="id">m</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9616')">Proof.</div>
<div class="proofscript" id="proof9616">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">SpecLang.storemax</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="store_succ_load_succ">store_succ_load_succ</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">v</span>', <span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9617')">Proof.</div>
<div class="proofscript" id="proof9617">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H0</span> <span class="id">to</span> <span class="id">Heqe</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#load">load</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#valid_access">valid_access</a></span> <span class="kwd">in</span> <span class="id">v0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v0</span> <span class="kwd">as</span> [<span class="id">Hrange_perm</span> <span class="id">Halign</span>].<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Heqe</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#GMem_writable_imp_readable">GMem_writable_imp_readable</a></span> <span class="kwd">in</span> <span class="id">Hrange_perm</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#valid_access">valid_access</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="load_alloc_val_same">load_alloc_val_same</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">L</span> <span class="id">v</span> <span class="id">ofs</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt; <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> &lt;&gt; <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9618')">Proof.</div>
<div class="proofscript" id="proof9618">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">load</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>. <br/>
&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H2</span> <span class="id">to</span> <span class="id">Heqe</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Heqe</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#valid_access">valid_access</a></span> <span class="kwd">in</span> <span class="id">v0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v0</span> <span class="kwd">as</span> [<span class="id">Hrange_perm</span> <span class="id">Halign</span>].<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id">range_perm_alloc_still</span>' <span class="id">___</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span> <span class="id">H0</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#valid_access">valid_access</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="load_alloc_val_same_rev">load_alloc_val_same_rev</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">L</span> <span class="id">v</span> <span class="id">ofs</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt; <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> &lt;&gt; <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9619')">Proof.</div>
<div class="proofscript" id="proof9619">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">load</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H2</span> <span class="id">to</span> <span class="id">Heqe</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Heqe</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#valid_access">valid_access</a></span> <span class="kwd">in</span> <span class="id">v0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v0</span> <span class="kwd">as</span> [<span class="id">Hrange_perm</span> <span class="id">Halign</span>].<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id">range_perm_alloc_still</span>'<span class="id">_rev</span> <span class="id">___</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span> <span class="id">H0</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H0</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#valid_access">valid_access</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="store_alloc_still">store_alloc_still</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">m</span>'' <span class="id">L</span> <span class="id">ofs</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">b</span> <span class="id">c</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'' -&gt; <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> &lt;&gt; <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m</span>''', <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id">m</span>'' <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'''.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9620')">Proof.</div>
<div class="proofscript" id="proof9620">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H2</span> <span class="id">to</span> <span class="id">Heqe</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Heqe</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#valid_access">valid_access</a></span> <span class="kwd">in</span> <span class="id">v0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v0</span> <span class="kwd">as</span> [<span class="id">Hrange_perm</span> <span class="id">Halign</span>].<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id">range_perm_alloc_still</span>' <span class="id">___</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#valid_access">valid_access</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="load_free_other_val_same">load_free_other_val_same</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">v</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">L</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">lo</span> <span class="id">hi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#free">free</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt; <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> &lt;&gt; <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9621')">Proof.</div>
<div class="proofscript" id="proof9621">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">load</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H2</span> <span class="id">to</span> <span class="id">Heqe</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Heqe</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#valid_access">valid_access</a></span> <span class="kwd">in</span> <span class="id">v0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v0</span>.<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id">range_perm_free_still</span>' <span class="id">___</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span> <span class="id">H0</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">free</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#valid_access">valid_access</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="load_free_other_val_same_rev">load_free_other_val_same_rev</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">v</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">L</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">lo</span> <span class="id">hi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#free">free</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt; <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> &lt;&gt; <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9622')">Proof.</div>
<div class="proofscript" id="proof9622">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">load</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H2</span> <span class="id">to</span> <span class="id">Heqe</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Heqe</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#valid_access">valid_access</a></span> <span class="kwd">in</span> <span class="id">v0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v0</span> <span class="kwd">as</span> [<span class="id">Hrange_perm</span> <span class="id">Halign</span>].<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id">range_perm_free_still</span>'<span class="id">_rev</span> <span class="id">___</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span> <span class="id">H0</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">free</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#valid_access">valid_access</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="store_free_other_still">store_free_other_still</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">m</span>'' <span class="id">b</span> <span class="id">L</span> <span class="id">ofs</span> <span class="id">c</span> <span class="id">v</span> <span class="id">lo</span> <span class="id">hi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#free">free</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'' -&gt; <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> &lt;&gt; <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m</span>''', <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id">m</span>'' <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'''.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9623')">Proof.</div>
<div class="proofscript" id="proof9623">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H2</span> <span class="id">to</span> <span class="id">Heqe</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Heqe</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#valid_access">valid_access</a></span> <span class="kwd">in</span> <span class="id">v0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v0</span> <span class="kwd">as</span> [<span class="id">Hrange</span> <span class="id">Halign</span>].<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id">range_perm_free_still</span>' <span class="id">___</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#valid_access">valid_access</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="load_store_other_val_same">load_store_other_val_same</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">c1</span> <span class="id">c</span> <span class="id">b</span> <span class="id">L</span> <span class="id">ofs</span> <span class="id">ofs</span>' <span class="id">v</span> <span class="id">v1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="TSOMemLemmas.html#c1">c1</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#v1">v1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id">ofs</span>' <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt; <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> &lt;&gt; <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="TSOMemLemmas.html#c1">c1</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#v1">v1</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9624')">Proof.</div>
<div class="proofscript" id="proof9624">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">load</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H2</span> <span class="id">to</span> <span class="id">Heqe</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Heqe</span>; <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#valid_access">valid_access</a></span> <span class="kwd">in</span> <span class="id">v0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v0</span> <span class="kwd">as</span> [<span class="id">Hrange</span> <span class="id">Halign</span>].<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id">range_perm_store_still</span>' <span class="id">___</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span> <span class="id">H1</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#valid_access">valid_access</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="load_store_other_val_same_rev">load_store_other_val_same_rev</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">c1</span> <span class="id">c</span> <span class="id">b</span> <span class="id">L</span> <span class="id">ofs</span> <span class="id">ofs</span>' <span class="id">v</span> <span class="id">v1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="TSOMemLemmas.html#c1">c1</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#v1">v1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id">ofs</span>' <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt; <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> &lt;&gt; <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="TSOMemLemmas.html#c1">c1</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#v1">v1</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9625')">Proof.</div>
<div class="proofscript" id="proof9625">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">load</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H2</span> <span class="id">to</span> <span class="id">Heqe</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Heqe</span>; <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#valid_access">valid_access</a></span> <span class="kwd">in</span> <span class="id">v0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v0</span> <span class="kwd">as</span> [<span class="id">Hrange</span> <span class="id">Halign</span>].<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id">range_perm_store_still</span>'<span class="id">_rev</span> <span class="id">___</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span> <span class="id">H0</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#valid_access">valid_access</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="store_store_other_still">store_store_other_still</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">m</span>'' <span class="id">c</span> <span class="id">c1</span> <span class="id">L</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">ofs</span>' <span class="id">v</span> <span class="id">v1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c1">c1</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id">ofs</span>' <span class="id"><a href="TSOMemLemmas.html#v1">v1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m</span>''', <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id">m</span>'' <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'''.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9626')">Proof.</div>
<div class="proofscript" id="proof9626">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H1</span> <span class="id">to</span> <span class="id">Heqe</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#valid_access_dec">valid_access_dec</a></span> <span class="id">m</span> <span class="id">c</span> <span class="id">L</span> <span class="id">ofs</span> <span class="id"><a href="Memperm.html#Writable">Writable</a></span>) <span class="id">eqn</span>:?;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">n</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="alloc_store_still">alloc_store_still</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">v</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">m</span>' <span class="id">m</span>'' <span class="id">b0</span> <span class="id">lo</span> <span class="id">hi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b0">b0</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m</span>''', <span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#b0">b0</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'''.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9627')">Proof.</div>
<div class="proofscript" id="proof9627">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="alloc_store_still_rev">alloc_store_still_rev</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">v</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">m</span>' <span class="id">m</span>'' <span class="id">b0</span> <span class="id">lo</span> <span class="id">hi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#b0">b0</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m</span>''', <span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b0">b0</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'''.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9628')">Proof.</div>
<div class="proofscript" id="proof9628">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="free_store_still">free_store_still</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">v</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">m</span>'' <span class="id">b</span> <span class="id">ofs</span> <span class="id">b0</span> <span class="id">lo</span> <span class="id">hi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#free">free</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b0">b0</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m</span>''', <span class="id"><a href="TSOMem.html#free">free</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#b0">b0</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'''.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9629')">Proof.</div>
<div class="proofscript" id="proof9629">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">free</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H1</span> <span class="id">to</span> <span class="id">Heqe</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id">range_perm_store_still</span>'' <span class="id">___</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="free_store_still_rev">free_store_still_rev</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">v</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">m</span>'' <span class="id">b</span> <span class="id">b0</span> <span class="id">ofs</span> <span class="id">lo</span> <span class="id">hi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt; <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> &lt;&gt; <span class="id"><a href="TSOMemLemmas.html#b0">b0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#free">free</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#b0">b0</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m</span>''', <span class="id"><a href="TSOMem.html#free">free</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b0">b0</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'''.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9630')">Proof.</div>
<div class="proofscript" id="proof9630">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">free</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H2</span> <span class="id">to</span> <span class="id">Heqe</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H1</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id">range_perm_store_still</span>''<span class="id">_rev</span> <span class="id">___</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="store_store_still">store_store_still</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">m</span>'' <span class="id">c</span> <span class="id">c1</span> <span class="id">b</span> <span class="id">b0</span> <span class="id">ofs</span> <span class="id">ofs0</span> <span class="id">v</span> <span class="id">v1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c1">c1</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v1">v1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b0">b0</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs0">ofs0</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m</span>''', <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#b0">b0</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs0">ofs0</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'''.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9631')">Proof.</div>
<div class="proofscript" id="proof9631">
&nbsp;&nbsp;<span class="tactic">intros</span>.  <br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H1</span> <span class="id">to</span> <span class="id">Heqe</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#valid_access_dec">valid_access_dec</a></span> <span class="id">m</span> <span class="id">c</span> <span class="id">b0</span> <span class="id">ofs0</span> <span class="id"><a href="Memperm.html#Writable">Writable</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">n</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="store_store_still_rev">store_store_still_rev</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">m</span>'' <span class="id">c</span> <span class="id">c1</span> <span class="id">b</span> <span class="id">b0</span> <span class="id">ofs</span> <span class="id">ofs0</span> <span class="id">v</span> <span class="id">v1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c1">c1</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v1">v1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#b0">b0</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs0">ofs0</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m</span>''', <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b0">b0</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs0">ofs0</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'''.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9632')">Proof.</div>
<div class="proofscript" id="proof9632">
&nbsp;&nbsp;<span class="tactic">intros</span>.  <br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H1</span> <span class="id">to</span> <span class="id">Heqe</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>. <br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#valid_access_dec">valid_access_dec</a></span> <span class="id">m</span> <span class="id">c1</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id"><a href="Memperm.html#Writable">Writable</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H</span> <span class="id">Heqe</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">valid_access</span>, <span class="id">range_perm</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">v0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="store_store_other_val">store_store_other_val</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span> <span class="id">v</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m</span>'', <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id">v</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>''.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9633')">Proof.</div>
<div class="proofscript" id="proof9633">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="store_again_mem_eq">store_again_mem_eq</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9634')">Proof.</div>
<div class="proofscript" id="proof9634">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H0</span> <span class="id">to</span> <span class="id">Heqe</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">f_equal</span>. <br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#gmem_eq">gmem_eq</a></span>; <span class="tactic">eauto</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.set2">PMap.set2</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#Mem_setN_twice_same_eq">Mem_setN_twice_same_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">n</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="store_twice_eq_store_dir">store_twice_eq_store_dir</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span> <span class="id">v</span>' <span class="id">m</span> <span class="id">m</span>' <span class="id">m</span>'',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id">v</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id">v</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>''.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9635')">Proof.</div>
<div class="proofscript" id="proof9635">
&nbsp;&nbsp;<span class="id">memunfolds</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#gmem_eq">gmem_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#Mem_setN_same_place_eq_setN_once">Mem_setN_same_place_eq_setN_once</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.set2">PMap.set2</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span>.<br/>
&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id"><a href="Memdata.html#encode_val_length">encode_val_length</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="store_alloc_eq_alloc_store">store_alloc_eq_alloc_store</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">m1</span>' <span class="id">m2</span>' <span class="id">v</span> <span class="id">c</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">b1</span> <span class="id">lo</span> <span class="id">hi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> <span class="id"><a href="TSOMemLemmas.html#b1">b1</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b1">b1</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id">m1</span>' <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#b">b</a></span> &lt;&gt; <span class="id"><a href="TSOMemLemmas.html#b1">b1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> = <span class="id">m2</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9636')">Proof.</div>
<div class="proofscript" id="proof9636">
&nbsp;&nbsp;<span class="id">memunfolds</span>; <span class="tactic">intros</span>. <br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H2</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H1</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H1</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H0</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H3</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#gmem_eq">gmem_eq</a></span>; <span class="tactic">eauto</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#PMap_set_twice_not_same_reorder_eq">PMap_set_twice_not_same_reorder_eq</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="store_free_eq_free_store">store_free_eq_free_store</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m1</span> <span class="id">m1</span>' <span class="id">m2</span> <span class="id">m2</span>' <span class="id">c</span> <span class="id">b</span> <span class="id">b1</span> <span class="id">ofs</span> <span class="id">v</span> <span class="id">lo</span> <span class="id">hi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#free">free</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> <span class="id"><a href="TSOMemLemmas.html#b1">b1</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#free">free</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b1">b1</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id">m1</span>' <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#b">b</a></span> &lt;&gt; <span class="id"><a href="TSOMemLemmas.html#b1">b1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> = <span class="id">m2</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9637')">Proof.</div>
<div class="proofscript" id="proof9637">
&nbsp;&nbsp;<span class="id">memunfolds</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H2</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H1</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H1</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H0</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H3</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unchecked_free">unchecked_free</a></span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#gmem_eq">gmem_eq</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="store_store_eq_store_store">store_store_eq_store_store</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">c0</span> <span class="id">m</span> <span class="id">m1</span> <span class="id">m1</span>' <span class="id">m2</span> <span class="id">m2</span>' <span class="id">b</span> <span class="id">ofs</span> <span class="id">b</span>' <span class="id">ofs</span>' <span class="id">v</span> <span class="id">v</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c0">c0</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> <span class="id">b</span>' <span class="id">ofs</span>' <span class="id">v</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c0">c0</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id">b</span>' <span class="id">ofs</span>' <span class="id">v</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id">m1</span>' <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#b">b</a></span> &lt;&gt; <span class="id">b</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> = <span class="id">m2</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9638')">Proof.</div>
<div class="proofscript" id="proof9638">
&nbsp;&nbsp;<span class="id">memunfolds</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H2</span>; <span class="tactic">eauto</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H1</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H1</span>; <span class="tactic">eauto</span>; <span class="id">simpls</span>. <br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H0</span>; <span class="tactic">eauto</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span>; <span class="tactic">eauto</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H3</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#gmem_eq">gmem_eq</a></span>; <span class="tactic">eauto</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">do</span> 2 (<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#PMap_set_twice_not_same_reorder_eq">PMap_set_twice_not_same_reorder_eq</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_buffer_item_store_still">apply_buffer_item_store_still</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">b</span> <span class="id">bi</span> <span class="id">ofs</span> <span class="id">m</span>' <span class="id">m</span>'' <span class="id">c</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m</span>''', <span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="id">m</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'''.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9639')">Proof.</div>
<div class="proofscript" id="proof9639">
&nbsp;&nbsp;<span class="tactic">intros</span>. <br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">apply_buffer_item</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#alloc_store_still">alloc_store_still</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#free_store_still">free_store_still</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#store_store_still">store_store_still</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="not_in_apply_buffer_load_eq">not_in_apply_buffer_load_eq</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">c</span> <span class="id">gm</span> <span class="id">gm</span>' <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOMemLemmas.html#gm">gm</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">gm</span>' -&gt; ~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id">gm</span>' <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#gm">gm</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9640')">Proof.</div>
<div class="proofscript" id="proof9640">
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">bf</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">optbind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">gm</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H0</span> <span class="id">Heqo</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">apply_buffer_item</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">b</span> &lt;&gt; <span class="id">b0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#load_alloc_val_same_rev">load_alloc_val_same_rev</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">b</span> &lt;&gt; <span class="id">b0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#load_free_other_val_same_rev">load_free_other_val_same_rev</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">b</span> &lt;&gt; <span class="id">b0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#load_store_other_val_same_rev">load_store_other_val_same_rev</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="not_in_apply_buffer_load_eq_rev">not_in_apply_buffer_load_eq_rev</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">c</span> <span class="id">gm</span> <span class="id">gm</span>' <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOMemLemmas.html#gm">gm</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">gm</span>' -&gt; ~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#gm">gm</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id">gm</span>' <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9641')">Proof.</div>
<div class="proofscript" id="proof9641">
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">bf</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">optbind</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">gm</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H0</span> <span class="id">Heqo</span> <span class="id">H1</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">apply_buffer_item</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">b</span> &lt;&gt; <span class="id">b0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#load_alloc_val_same">load_alloc_val_same</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">b</span> &lt;&gt; <span class="id">b0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#load_free_other_val_same">load_free_other_val_same</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">b</span> &lt;&gt; <span class="id">b0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#load_store_other_val_same">load_store_other_val_same</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">block_not_in_bf_bi_block_neq</span>' :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bfs</span> (<span class="id">t</span> : <span class="id"><a href="GlobDefs.html#tid">tid</a></span>) <span class="id">bi</span> <span class="id">rest</span> <span class="id">L</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#bfs">bfs</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> = <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> :: <span class="id"><a href="TSOMemLemmas.html#rest">rest</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> (<span class="id"><a href="TSOMemLemmas.html#bfs">bfs</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#get_bi_block">get_bi_block</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> &lt;&gt; <span class="id"><a href="TSOMemLemmas.html#L">L</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9642')">Proof.</div>
<div class="proofscript" id="proof9642">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="alloc_apply_buf_block_neq_reorder_succ">alloc_apply_buf_block_neq_reorder_succ</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">bi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#get_bi_block">get_bi_block</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> &lt;&gt; <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m</span>' <span class="id">m</span>'', <span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>''.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9643')">Proof.</div>
<div class="proofscript" id="proof9643">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>; <span class="id">unfolds</span> <span class="id">free</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">unchecked_free</span>; <span class="id">simpls</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H1</span> <span class="id">r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="id">eexists</span>; <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">range_perm</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">r</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>; <span class="id">unfolds</span> <span class="id">store</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="id">eexists</span>; <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">v0</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">valid_access</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">range_perm</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_buf_mem_cont_access_eq_stable">apply_buf_mem_cont_access_eq_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">m1</span>' <span class="id">bi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m2</span>', <span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9644')">Proof.</div>
<div class="proofscript" id="proof9644">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">free</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H1</span> <span class="id">r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">range_perm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">r</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">v0</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">valid_access</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">range_perm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_same_buf_item_cont_access_eq_preserve">apply_same_buf_item_cont_access_eq_preserve</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">m1</span>' <span class="id">m2</span>' <span class="id">bi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id">m1</span>' = <span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id">m2</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m1</span>' = <span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m2</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9645')">Proof.</div>
<div class="proofscript" id="proof9645">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span> <span class="id">H0</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span>; <span class="tactic">rewrite</span> <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">free</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span> <span class="id">H0</span> <span class="id">H1</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="id">unfolds</span> <span class="id">unchecked_free</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span>; <span class="tactic">rewrite</span> <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span>; <span class="tactic">rewrite</span> <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="unbuffer_safe_cont_access_eq_stable">unbuffer_safe_cont_access_eq_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bfs</span> <span class="id">m1</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOMemLemmas.html#bfs">bfs</a></span>; <span class="id">memory</span> := <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> |} -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOMemLemmas.html#bfs">bfs</a></span>; <span class="id">memory</span> := <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> |}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9646')">Proof.</div>
<div class="proofscript" id="proof9646">
&nbsp;&nbsp;<span class="id">introv</span> <span class="id">Hunbuffer_safe</span>.<br/>
&nbsp;&nbsp;<span class="id">remember</span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id">bfs</span>; <span class="id">memory</span> := <span class="id">m1</span> |} <span class="kwd">as</span> <span class="id">bm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">bfs</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">m1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">m2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hunbuffer_safe</span>; <span class="tactic">intros</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ABIS</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> [<span class="id">m1</span>' <span class="id">Happly_buffer</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buf_mem_cont_access_eq_stable">apply_buf_mem_cont_access_eq_stable</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hcons</span> : <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Happly_buffer</span> : <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buf_mem_cont_access_eq_stable">apply_buf_mem_cont_access_eq_stable</a></span> <span class="kwd">with</span> (<span class="id">m2</span> := <span class="id">m1</span>) <span class="kwd">in</span> <span class="id">Happly_buffer</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Happly_buffer</span> <span class="kwd">as</span> [<span class="id">m1</span>' <span class="id">Happly_buffer</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hmem_cont_access_eq</span> : <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#apply_same_buf_item_cont_access_eq_preserve">apply_same_buf_item_cont_access_eq_preserve</a></span> <span class="kwd">in</span> <span class="id">Hmem_cont_access_eq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hmem_cont_access_eq</span> <span class="kwd">as</span> [<span class="id">Hmem_cont_eq</span> <span class="id">Hmem_access_eq</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Hcons</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="block_not_in_bf_bi_block_neq">block_not_in_bf_bi_block_neq</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tm</span> <span class="id">t</span> <span class="id">bi</span> <span class="id">rest</span> <span class="id">L</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> = <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> :: <span class="id"><a href="TSOMemLemmas.html#rest">rest</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> (<span class="id"><a href="TSOMem.html#get_tsom_b">get_tsom_b</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#get_bi_block">get_bi_block</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> &lt;&gt; <span class="id"><a href="TSOMemLemmas.html#L">L</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9647')">Proof.</div>
<div class="proofscript" id="proof9647">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">get_tsom_b</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">block_not_in_bf_bi_block_neq</span>'; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="tupdate_same_tid_eq">tupdate_same_tid_eq</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">b1</span> <span class="id">b2</span> <span class="id">bfs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> <span class="id"><a href="TSOMemLemmas.html#b1">b1</a></span> (<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> <span class="id"><a href="TSOMemLemmas.html#b2">b2</a></span> <span class="id"><a href="TSOMemLemmas.html#bfs">bfs</a></span>) = <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> <span class="id"><a href="TSOMemLemmas.html#b1">b1</a></span> <span class="id"><a href="TSOMemLemmas.html#bfs">bfs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9648')">Proof.</div>
<div class="proofscript" id="proof9648">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Axioms.html#functional_extensionality">functional_extensionality</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">x</span> <span class="id">t</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="tupdate_same_eq">tupdate_same_eq</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bfs</span> <span class="id">t</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#bfs">bfs</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> = <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#bfs">bfs</a></span> = <span class="id"><a href="TSOMemLemmas.html#bfs">bfs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9649')">Proof.</div>
<div class="proofscript" id="proof9649">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Axioms.html#functional_extensionality">functional_extensionality</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">x</span> <span class="id">t</span>); <span class="id">tryfalse</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="tupdate_b_get">tupdate_b_get</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">b</span> <span class="id">bfs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#bfs">bfs</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> = <span class="id"><a href="TSOMemLemmas.html#b">b</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9650')">Proof.</div>
<div class="proofscript" id="proof9650">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t</span>); <span class="id">tryfalse</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="tupdate_not_eq_get">tupdate_not_eq_get</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t0</span> <span class="id">b</span> <span class="id">bfs</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#t">t</a></span> &lt;&gt; <span class="id"><a href="TSOMemLemmas.html#t0">t0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="TSOMemLemmas.html#t0">t0</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#bfs">bfs</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> = <span class="id"><a href="TSOMemLemmas.html#bfs">bfs</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9651')">Proof.</div>
<div class="proofscript" id="proof9651">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t0</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="tupdate_tid_neq_twice_rev">tupdate_tid_neq_twice_rev</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">t0</span> <span class="id">b0</span> <span class="id">b</span> <span class="id">bfs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#t0">t0</a></span> &lt;&gt; <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="TSOMemLemmas.html#t0">t0</a></span> <span class="id"><a href="TSOMemLemmas.html#b0">b0</a></span> (<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#bfs">bfs</a></span>) = <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="TSOMemLemmas.html#t0">t0</a></span> <span class="id"><a href="TSOMemLemmas.html#b0">b0</a></span> <span class="id"><a href="TSOMemLemmas.html#bfs">bfs</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9652')">Proof.</div>
<div class="proofscript" id="proof9652">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Axioms.html#functional_extensionality">functional_extensionality</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">x</span> <span class="id">t0</span>); <span class="id">tryfalse</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t0</span> <span class="id">t</span>); <span class="id">tryfalse</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_buf_item_alloc_b_neq_still">apply_buf_item_alloc_b_neq_still</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">m1</span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">bi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt; <span class="id"><a href="TSOMemLemmas.html#get_bi_block">get_bi_block</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> &lt;&gt; <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m2</span>, <span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="id">m</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9653')">Proof.</div>
<div class="proofscript" id="proof9653">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H1</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>, <span class="id">free</span>, <span class="id">unchecked_free</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H1</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span> <span class="id">H1</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">r</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">range_perm</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">r</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>, <span class="id">store</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H1</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span> <span class="id">H1</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">v0</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">valid_access</span>, <span class="id">range_perm</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_valid_block_not_in_free_list_cons_still">in_valid_block_not_in_free_list_cons_still</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">b</span> <span class="id">b0</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">m1</span>' <span class="id">m2</span>' <span class="id">fl</span> <span class="id">n</span> <span class="id">n</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">n</span>, <span class="id"><a href="TSOMemLemmas.html#b0">b0</a></span> &lt;&gt; <span class="id"><a href="MemAux.html#get_block">get_block</a></span> <span class="id"><a href="TSOMemLemmas.html#fl">fl</a></span> <span class="id"><a href="TSOMemLemmas.html#n">n</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#remove_nth">remove_nth</a></span> <span class="id">n</span>' (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span>) = <span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#get_nth">get_nth</a></span> <span class="id">n</span>'(<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#b0">b0</a></span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="MemAux.html#get_block">get_block</a></span> <span class="id"><a href="TSOMemLemmas.html#fl">fl</a></span> <span class="id"><a href="TSOMemLemmas.html#n">n</a></span> = <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m2</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m1</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9654')">Proof.</div>
<div class="proofscript" id="proof9654">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span> <span class="id">m1</span>'; <span class="tactic">inversion</span> <span class="id">H1</span>; <span class="tactic">subst</span> <span class="id">m2</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#remove_eq_b_neq_in_still">remove_eq_b_neq_in_still</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H</span> <span class="id">n</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>, <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">exists</span> <span class="id">m1</span>'', <span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m1</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>'').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m1</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H6</span> <span class="kwd">as</span> [<span class="id">m1</span>'' <span class="id">H6</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">exists</span> <span class="id">m2</span>'', <span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m2</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>'').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m2</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H7</span> <span class="kwd">as</span> [<span class="id">m2</span>'' <span class="id">H7</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H6</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">rewrite</span> <span class="id">H7</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>, <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H6</span>; <span class="tactic">inversion</span> <span class="id">H7</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H6</span> <span class="id">H7</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf</span> <span class="kwd">with</span> (<span class="id">n</span>' := <span class="id">n</span>'.+1); <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">rewrite</span> <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">free</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H6</span>; <span class="tactic">inversion</span> <span class="id">H7</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H6</span> <span class="id">H7</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H9</span>; <span class="tactic">inversion</span> <span class="id">H10</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H9</span> <span class="id">H10</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf</span> <span class="kwd">with</span> (<span class="id">n</span>' := <span class="id">n</span>'); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.      <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H6</span>; <span class="tactic">inversion</span> <span class="id">H7</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H6</span> <span class="id">H7</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf</span> <span class="kwd">with</span> (<span class="id">n</span>' := <span class="id">n</span>'); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_valid_block_cons_still">in_valid_block_cons_still</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">b</span> <span class="id">b0</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">m1</span>' <span class="id">m2</span>' <span class="id">n</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#remove_nth">remove_nth</a></span> <span class="id">n</span>' (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span>) = <span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#get_nth">get_nth</a></span> <span class="id">n</span>' (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#b0">b0</a></span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m1</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m2</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9655')">Proof.</div>
<div class="proofscript" id="proof9655">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>; <span class="tactic">intros</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#after_remove_nth_in_origin">after_remove_nth_in_origin</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">exists</span> <span class="id">m1</span>'', <span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m1</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>'').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m1</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H4</span> <span class="kwd">as</span> [<span class="id">m1</span>'' <span class="id">H4</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">exists</span> <span class="id">m2</span>'', <span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m2</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>'').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m2</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H5</span> <span class="kwd">as</span> [<span class="id">m2</span>'' <span class="id">H5</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H4</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">rewrite</span> <span class="id">H5</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H4</span>; <span class="tactic">inversion</span> <span class="id">H5</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H4</span> <span class="id">H5</span>; <span class="id">simpls</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf</span> <span class="kwd">with</span> (<span class="id">m1</span>' := <span class="id">m1</span>') (<span class="id">n</span>' := <span class="id">n</span>'.+1); <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">free</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H4</span>; <span class="tactic">inversion</span> <span class="id">H5</span>; <span class="tactic">clear</span> <span class="id">H4</span> <span class="id">H5</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">unchecked_free</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H9</span>; <span class="tactic">inversion</span> <span class="id">H10</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H4</span>; <span class="tactic">inversion</span> <span class="id">H5</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H4</span> <span class="id">H5</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf</span> <span class="kwd">with</span> (<span class="id">m1</span>' := <span class="id">m1</span>') (<span class="id">n</span>' := <span class="id">n</span>'); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_valid_block_eq_apply_same_buf_item_still">in_valid_block_eq_apply_same_buf_item_still</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">m1</span>' <span class="id">m2</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m1</span>' = <span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m2</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9656')">Proof.</div>
<div class="proofscript" id="proof9656">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span> <span class="id">H0</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">free</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span> <span class="id">H0</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span> <span class="id">H0</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
&nbsp;&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_valid_block_eq_apply_same_buf_still">in_valid_block_eq_apply_same_buf_still</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">m1</span>' <span class="id">m2</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m1</span>' = <span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m2</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9657')">Proof.</div>
<div class="proofscript" id="proof9657">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>; <span class="tactic">intros</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">exists</span> <span class="id">m1</span>'', <span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m1</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>'').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m1</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> [<span class="id">m1</span>'' <span class="id">H2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">exists</span> <span class="id">m2</span>'', <span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m2</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>'').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m2</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H3</span> <span class="kwd">as</span> [<span class="id">m2</span>'' <span class="id">H3</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">rewrite</span> <span class="id">H3</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>, <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#in_valid_block_eq_apply_same_buf_item_still">in_valid_block_eq_apply_same_buf_item_still</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_valid_block_not_in_free_list_still_rev">in_valid_block_not_in_free_list_still_rev</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">m1</span> <span class="id">m2</span> <span class="id">fl</span> <span class="id">n</span> <span class="id">b</span> <span class="id">bf</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">n</span>, <span class="id"><a href="TSOMemLemmas.html#get_bi_block">get_bi_block</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> &lt;&gt; <span class="id"><a href="MemAux.html#get_block">get_block</a></span> <span class="id"><a href="TSOMemLemmas.html#fl">fl</a></span> <span class="id"><a href="TSOMemLemmas.html#n">n</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id">m</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="MemAux.html#get_block">get_block</a></span> <span class="id"><a href="TSOMemLemmas.html#fl">fl</a></span> <span class="id"><a href="TSOMemLemmas.html#n">n</a></span> = <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9658')">Proof.</div>
<div class="proofscript" id="proof9658">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H0</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#in_valid_block_not_in_free_list_cons_still">in_valid_block_not_in_free_list_cons_still</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> (<span class="id">m2</span>' := <span class="id">m2</span>); <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1 := 0); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#in_valid_block_eq_apply_same_buf_still">in_valid_block_eq_apply_same_buf_still</a></span> <span class="kwd">with</span> (<span class="id">m2</span>' := <span class="id">m2</span>) <span class="kwd">in</span> <span class="id">Ht</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ht</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">free</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unchecked_free">unchecked_free</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#in_valid_block_eq_apply_same_buf_still">in_valid_block_eq_apply_same_buf_still</a></span> <span class="kwd">with</span> (<span class="id">m2</span>' := <span class="id">m2</span>) <span class="kwd">in</span> <span class="id">Ht</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ht</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_valid_block_update_still">in_valid_block_update_still</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">m1</span> <span class="id">m2</span> <span class="id">bf</span> <span class="id">bi</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id">m</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9659')">Proof.</div>
<div class="proofscript" id="proof9659">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>; <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#in_valid_block_cons_still">in_valid_block_cons_still</a></span> <span class="kwd">with</span> (<span class="id">m1</span>' := <span class="id">m1</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1 := 0); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id">b0</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#in_valid_block_eq_apply_same_buf_still">in_valid_block_eq_apply_same_buf_still</a></span> <span class="kwd">with</span> (<span class="id">m2</span> := <span class="id">m</span>') <span class="kwd">in</span> <span class="id">Ht</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Ht</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">free</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unchecked_free">unchecked_free</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#in_valid_block_eq_apply_same_buf_still">in_valid_block_eq_apply_same_buf_still</a></span> <span class="kwd">with</span> (<span class="id">m2</span> := <span class="id">m</span>') <span class="kwd">in</span> <span class="id">Ht</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Ht</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="embed_appply_buffer_update_not_in_freelist_stable">embed_appply_buffer_update_not_in_freelist_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">bi</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">m1</span> <span class="id">m2</span> <span class="id">fm1</span> <span class="id">fl</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">n</span>, <span class="id"><a href="TSOMemLemmas.html#get_bi_block">get_bi_block</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> &lt;&gt; <span class="id"><a href="MemAux.html#get_block">get_block</a></span> <span class="id"><a href="TSOMemLemmas.html#fl">fl</a></span> <span class="id"><a href="TSOMemLemmas.html#n">n</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> -&gt; <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> <span class="id"><a href="TSOMemLemmas.html#fl">fl</a></span> <span class="id"><a href="TSOMemLemmas.html#fm1">fm1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id">m</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">fm2</span>, <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> <span class="id"><a href="TSOMemLemmas.html#fl">fl</a></span> <span class="id">fm2</span> /\ <span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id"><a href="TSOMemLemmas.html#fm1">fm1</a></span> = <span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id">fm2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9660')">Proof.</div>
<div class="proofscript" id="proof9660">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;<span class="id">instantiate</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(1 :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.mkmem">Mem.mkmem</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id">m2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="FMemory.html#Mem.freelist">Mem.freelist</a></span> <span class="id">fm1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="FMemory.html#Mem.nextblockid">Mem.nextblockid</a></span> <span class="id">fm1</span>) <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;).<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">simpl</span>; <span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#strip">strip</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#gmem_eq">gmem_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">Unshelve</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fm1</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">freelist_wd</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fm1</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.mk_gmem">GMem.mem_contents</a></span> := <span class="id">mem_contents</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">GMem.mem_access</span> := <span class="id">mem_access</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">GMem.validblocks</span> := <span class="id">validblocks</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">GMem.access_max</span> := <span class="id">access_max</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">GMem.invalid_noaccess</span> := <span class="id">invalid_noaccess</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">GMem.contents_default</span> := <span class="id">contents_default</span> |} <span class="kwd">as</span> <span class="id">m1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hvalidblocks</span> : <span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m1</span> = <span class="id">validblocks</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="tactic">eauto</span>.  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">valid_wd</span> <span class="id">H</span> <span class="id">H0</span> <span class="id">H3</span> <span class="id">H1</span> <span class="id">Hvalidblocks</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">Classical_Prop.classic</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">b</span> <span class="id">validblocks</span>)); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#in_valid_block_not_in_free_list_still_rev">in_valid_block_not_in_free_list_still_rev</a></span> <span class="kwd">in</span> <span class="id">H4</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hvalidblocks</span> <span class="kwd">in</span> <span class="id">H4</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#in_valid_block_update_still">in_valid_block_update_still</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hvalidblocks</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m2</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m2</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m2</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="unbuffer_safe_apply_buffer">unbuffer_safe_apply_buffer</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bfs</span> <span class="id">t</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOMemLemmas.html#bfs">bfs</a></span>; <span class="id">memory</span> := <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> |} -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m</span>', <span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> (<span class="id"><a href="TSOMemLemmas.html#bfs">bfs</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span>) <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9661')">Proof.</div>
<div class="proofscript" id="proof9661">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">bfs</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">bfs</span> <span class="id">t</span>) <span class="kwd">as</span> <span class="id">bf</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">bfs</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Happly_buffer</span> : <span class="id">Heqbf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">Happly_buffer</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ABIS</span> <span class="kwd">in</span> <span class="id">Happly_buffer</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Happly_buffer</span> <span class="kwd">as</span> [<span class="id">m</span>' <span class="id">Happly_buffer</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Happly_buffer</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHbf</span> <span class="id">t</span> (<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id">t</span> <span class="id">bf</span> <span class="id">bfs</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
&nbsp;&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="unbuffer_safe_apply_buffer_stable">unbuffer_safe_apply_buffer_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bfs</span> <span class="id">t0</span> <span class="id">t</span> <span class="id">bi</span> <span class="id">b</span> <span class="id">m</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOMemLemmas.html#bfs">bfs</a></span>; <span class="id">memory</span> := <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> |} -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#bfs">bfs</a></span> <span class="id"><a href="TSOMemLemmas.html#t0">t0</a></span> = <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> :: <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> -&gt; <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> &lt;&gt; <span class="id"><a href="TSOMemLemmas.html#t0">t0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m</span>'', <span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> (<span class="id"><a href="TSOMemLemmas.html#bfs">bfs</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span>) <span class="id">m</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>''.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9662')">Proof.</div>
<div class="proofscript" id="proof9662">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">UNBS</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H0</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">bfs</span> <span class="id">t</span> = <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id">t0</span> <span class="id">b</span> <span class="id">bfs</span> <span class="id">t</span>).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_not_eq_get">tupdate_not_eq_get</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#unbuffer_safe_apply_buffer">unbuffer_safe_apply_buffer</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="alloc_apply_buf_block_neq_mem_cont_access_eq">alloc_apply_buf_block_neq_mem_cont_access_eq</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">m1</span>' <span class="id">m2</span>' <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">bi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="id">m1</span>' <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#get_bi_block">get_bi_block</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> &lt;&gt; <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> = <span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id">m2</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> = <span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m2</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9663')">Proof.</div>
<div class="proofscript" id="proof9663">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">inversion</span> <span class="id">H1</span>; <span class="tactic">inversion</span> <span class="id">H2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span> <span class="id">H0</span> <span class="id">H1</span> <span class="id">H2</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#PMap_set_twice_not_same_reorder_eq">PMap_set_twice_not_same_reorder_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#PMap_set_twice_not_same_reorder_eq">PMap_set_twice_not_same_reorder_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>; <span class="id">unfolds</span> <span class="id">free</span>; <span class="id">unfolds</span> <span class="id">unchecked_free</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">inversion</span> <span class="id">H1</span>; <span class="tactic">inversion</span> <span class="id">H2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span> <span class="id">H0</span> <span class="id">H1</span> <span class="id">H2</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#PMap_set_twice_not_same_reorder_eq">PMap_set_twice_not_same_reorder_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>; <span class="id">unfolds</span> <span class="id">store</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">inversion</span> <span class="id">H1</span>; <span class="tactic">inversion</span> <span class="id">H2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span> <span class="id">H0</span> <span class="id">H1</span> <span class="id">H2</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#PMap_set_twice_not_same_reorder_eq">PMap_set_twice_not_same_reorder_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="unbuffer_safe_alloc_preserve">unbuffer_safe_alloc_preserve</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">fl</span> <span class="id">bfs</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">idx</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOMemLemmas.html#bfs">bfs</a></span>; <span class="id">memory</span> := <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> |} -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt; <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> = <span class="id"><a href="MemAux.html#get_block">get_block</a></span> <span class="id"><a href="TSOMemLemmas.html#fl">fl</a></span> <span class="id"><a href="TSOMemLemmas.html#idx">idx</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">t</span>, ~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> (<span class="id"><a href="TSOMemLemmas.html#bfs">bfs</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span>))) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOMemLemmas.html#bfs">bfs</a></span>; <span class="id">memory</span> := <span class="id">m</span>' |}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9664')">Proof.</div>
<div class="proofscript" id="proof9664">
&nbsp;&nbsp;<span class="id">introv</span> <span class="id">Hp</span>.<br/>
&nbsp;&nbsp;<span class="id">remember</span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id">bfs</span>; <span class="id">memory</span> := <span class="id">m</span> |} <span class="kwd">as</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">m</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">m</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">fl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">bfs</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">lo</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">hi</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">idx</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">b</span>.<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id">Hp</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hp</span>; <span class="tactic">intros</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>. <br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">intros</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hbfs_t</span> : <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ABIS</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H0</span> <span class="id">H2</span> <span class="id">H1</span> <span class="id">Hbfs_t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">m</span>'' <span class="id">H1</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="TSOMemLemmas.html#get_bi_block">get_bi_block</a></span> <span class="id">bi</span> &lt;&gt; <span class="id"><a href="MemAux.html#get_block">get_block</a></span> <span class="id">fl</span> <span class="id">idx</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H2</span> <span class="id">Hbfs_t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H2</span> <span class="id">t</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hbfs_t</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>; <span class="id">simpls</span>; <span class="tactic">subst</span>; <span class="id">tryfalse</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buf_item_alloc_b_neq_still">apply_buf_item_alloc_b_neq_still</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hb_neq</span> : <span class="id"><a href="TSOMemLemmas.html#get_bi_block">get_bi_block</a></span> <span class="id">bi</span> &lt;&gt; <span class="id"><a href="MemAux.html#get_block">get_block</a></span> <span class="id">fl</span> <span class="id">idx</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H2</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H2</span> <span class="id">t</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>; <span class="id">simpls</span>; <span class="tactic">subst</span>; <span class="id">tryfalse</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Halloc_apply_buf</span> : <span class="id"><a href="TSOMemLemmas.html#alloc_apply_buf_block_neq_reorder_succ">alloc_apply_buf_block_neq_reorder_succ</a></span> <span class="id">___</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Halloc_apply_buf</span> <span class="kwd">as</span> [<span class="id">m1</span> [<span class="id">m2</span> [<span class="id">Happly_buf</span> <span class="id">Halloc</span>]]].    <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hcons</span> : <span class="id">H1</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Hcons</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2 : <span class="id">instantiate</span> (1 := <span class="id">m1</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Focus</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">UNBS</span> <span class="id">H1</span> <span class="id">Happly_buf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">UNBS</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2 : <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2 : <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2 : <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Focus</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H2</span> <span class="id">H1</span> .<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H2</span> <span class="id">t0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t0</span>) <span class="id">eqn</span>:?; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span>; <span class="tactic">destruct</span> <span class="id">bi</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#in_tbf_upd_oth_stillin">in_tbf_upd_oth_stillin</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht1</span> : <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#alloc_apply_buf_block_neq_mem_cont_access_eq">alloc_apply_buf_block_neq_mem_cont_access_eq</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> (<span class="id">m1</span> := <span class="id">m</span>') (<span class="id">m2</span> := <span class="id">m</span>'0) (<span class="id">m1</span>' := <span class="id">m1</span>) <span class="kwd">in</span> <span class="id">Ht1</span>; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ht1</span> <span class="kwd">as</span> [<span class="id">Hcont_eq</span> <span class="id">Haccess_eq</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#unbuffer_safe_cont_access_eq_stable">unbuffer_safe_cont_access_eq_stable</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="store_perm_nochange">store_perm_nochange</a></span> :<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">L</span> <span class="id">ofs</span> <span class="id">p</span> <span class="id">k</span> <span class="id">c</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>) !! <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> 0 <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m</span>') !! <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9665')">Proof.</div>
<div class="proofscript" id="proof9665">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="alloc_nochange_orig_perm">alloc_nochange_orig_perm</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">L</span> <span class="id">ofs</span> <span class="id">m</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">m</span>' <span class="id">p</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>) !! <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt; <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> &lt;&gt; <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m</span>') !! <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9666')">Proof.</div>
<div class="proofscript" id="proof9666">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="free_not_eq_nochange_orig_perm">free_not_eq_nochange_orig_perm</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">L</span> <span class="id">ofs</span> <span class="id">m</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">m</span>' <span class="id">p</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>) !! <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#free">free</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt; <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> &lt;&gt; <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m</span>') !! <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9667')">Proof.</div>
<div class="proofscript" id="proof9667">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">free</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unchecked_free">unchecked_free</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="store_not_eq_nochange_orig_perm">store_not_eq_nochange_orig_perm</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">b</span> <span class="id">L</span> <span class="id">ofs</span> <span class="id">ofs1</span> <span class="id">v</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">k</span> <span class="id">p</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>) !! <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs1">ofs1</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m</span>') !! <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9668')">Proof.</div>
<div class="proofscript" id="proof9668">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="id">simpls</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Mem_alloc_nochange_orig_perm">Mem_alloc_nochange_orig_perm</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">L</span> <span class="id">ofs</span> <span class="id">m</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">m</span>' <span class="id">k</span> <span class="id">p</span> <span class="id">stk</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>)) !! <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.alloc">Mem.alloc</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = (<span class="id">m</span>', <span class="id">stk</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">m</span>')) !! <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9669')">Proof.</div>
<div class="proofscript" id="proof9669">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.alloc</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">Classical_Prop.classic</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">L</span> <span class="id">validblocks</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ht</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">invalid_noaccess</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">tryfalse</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">Mem_alloc_nochange_orig_perm</span>' :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">L</span> <span class="id">ofs</span> <span class="id">m</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">m</span>' <span class="id">k</span> <span class="id">stk</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>)) !! <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> &lt;&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.alloc">Mem.alloc</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = (<span class="id">m</span>', <span class="id">stk</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">m</span>')) !! <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> &lt;&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9670')">Proof.</div>
<div class="proofscript" id="proof9670">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.alloc</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">Classical_Prop.classic</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">L</span> <span class="id">validblocks</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ht</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">invalid_noaccess</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">tryfalse</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="mem_perm_max_alloc_cur_none_stable">mem_perm_max_alloc_cur_none_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fm</span> <span class="id">fm</span>' <span class="id">stk</span>' <span class="id">b</span> <span class="id">ofs</span> <span class="id">lo</span> <span class="id">hi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span>)) !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="Memperm.html#Max">Max</a></span> &lt;&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span>)) !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="Memperm.html#Cur">Cur</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.alloc">Mem.alloc</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = (<span class="id">fm</span>', <span class="id">stk</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm</span>')) !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="Memperm.html#Cur">Cur</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9671')">Proof.</div>
<div class="proofscript" id="proof9671">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.alloc</span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H1</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fm</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">Classical_Prop.classic</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">b</span> <span class="id">validblocks</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ht</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="obj_mem_alloc_stable">obj_mem_alloc_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fm</span> <span class="id">fm</span>' <span class="id">b</span> <span class="id">ofs</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">stk</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html#obj_mem">obj_mem</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span>) <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.alloc">Mem.alloc</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = (<span class="id">fm</span>', <span class="id">stk</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html#obj_mem">obj_mem</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm</span>') <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9672')">Proof.</div>
<div class="proofscript" id="proof9672">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">obj_mem</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem_alloc_nochange_orig_perm</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#mem_perm_max_alloc_cur_none_stable">mem_perm_max_alloc_cur_none_stable</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="b_in_gmvb_in_apply_bf_m_vb">b_in_gmvb_in_apply_bf_m_vb</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">b</span> <span class="id">m</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9673')">Proof.</div>
<div class="proofscript" id="proof9673">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>; <span class="tactic">intros</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">exists</span> <span class="id">m</span>'', <span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'').<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">m</span>'' <span class="id">H1</span>].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buffer_item_in_validbloks_stable">apply_buffer_item_in_validbloks_stable</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="b_in_bf_alloc_in_apply_bf_m_vb">b_in_bf_alloc_in_apply_bf_m_vb</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">m</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span>) <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9674')">Proof.</div>
<div class="proofscript" id="proof9674">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>; <span class="tactic">intros</span>; <span class="id">simpls</span>; <span class="id">tryfalse</span>.  <br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">exists</span> <span class="id">m</span>'', <span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'').<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">m</span>'' <span class="id">H1</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#b_in_gmvb_in_apply_bf_m_vb">b_in_gmvb_in_apply_bf_m_vb</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H1</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">m</span>'' <span class="id">H1</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_apply_bf_item_mvb_in_origin_or_item">in_apply_bf_item_mvb_in_origin_or_item</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">a</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#a">a</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>) \/ (<span class="id">exists</span> <span class="id">lo</span> <span class="id">hi</span>, <span class="id"><a href="TSOMemLemmas.html#a">a</a></span> = <span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id">lo</span> <span class="id">hi</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9675')">Proof.</div>
<div class="proofscript" id="proof9675">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>; <span class="tactic">clear</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">free</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">unchecked_free</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>; <span class="tactic">clear</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
&nbsp;&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_apply_bf_mvb_in_orgin_m_or_bf_alloc">in_apply_bf_mvb_in_orgin_m_or_bf_alloc</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">b</span> <span class="id">m</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> <span class="id">lo</span> <span class="id">hi</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id">lo</span> <span class="id">hi</span>) <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9676')">Proof.</div>
<div class="proofscript" id="proof9676">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>; <span class="tactic">intros</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">exists</span> <span class="id">m</span>'', <span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">m</span>'' <span class="id">H1</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#in_apply_bf_item_mvb_in_origin_or_item">in_apply_bf_item_mvb_in_origin_or_item</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">lo</span> [<span class="id">hi</span> <span class="id">H0</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="id">eexists</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">lo</span> [<span class="id">hi</span> <span class="id">H0</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">lo</span> <span class="id">hi</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="rel_tm_gm_vb_impl_alloc_same_block">rel_tm_gm_vb_impl_alloc_same_block</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tm</span> <span class="id">sm</span> <span class="id">fl</span> <span class="id">t</span> <span class="id">gm</span>' <span class="id">fm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html#rel_tm_gm_vb">rel_tm_gm_vb</a></span> <span class="id"><a href="TSOMemLemmas.html#sm">sm</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span> <span class="id"><a href="TSOMemLemmas.html#fl">fl</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span>) (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">gm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">gm</span>' <span class="id"><a href="TSOMemLemmas.html#fl">fl</a></span> <span class="id">fm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">fsm</span>, <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id"><a href="TSOMemLemmas.html#sm">sm</a></span> <span class="id"><a href="TSOMemLemmas.html#fl">fl</a></span> <span class="id">fsm</span> /\ <span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id">fm</span>' = <span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id">fsm</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9677')">Proof.</div>
<div class="proofscript" id="proof9677">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">rel_tm_gm_vb</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">sm</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H1</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">eexists</span> (<span class="id"><a href="FMemory.html#Mem.mkmem">Mem.mkmem</a></span> <span class="id">mem_contents</span> <span class="id">mem_access</span> <span class="id">validblocks</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="FMemory.html#Mem.freelist">Mem.freelist</a></span> <span class="id">fm</span>') (<span class="id"><a href="FMemory.html#Mem.nextblockid">Mem.nextblockid</a></span> <span class="id">fm</span>') <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>).<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#strip">strip</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#gmem_eq">gmem_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">Unshelve</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="FMemory.html#Mem.freelist_wd">Mem.freelist_wd</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Heq_vb</span> : <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Heq_vb</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="FMemory.html#Mem.valid_wd">Mem.valid_wd</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#mem_strip_gm_vb_eq">mem_strip_gm_vb_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Heq_vb</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="FMemory.html#Mem.valid_wd">Mem.valid_wd</a></span> <span class="kwd">in</span> <span class="id">H3</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#mem_strip_gm_vb_eq">mem_strip_gm_vb_eq</a></span> <span class="kwd">in</span> <span class="id">H3</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Heq_vb</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<h2> Additional Memory Lemmas </h2>
<h3> Auxiliary Lemmas </h3>
<span class="kwd">Lemma</span> <span class="id"><a name="inrange_or_not">inrange_or_not</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span> <span class="id">ofs</span> <span class="id">i</span> (<span class="id">v</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="TSOMemLemmas.html#A">A</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOMemLemmas.html#i">i</a></span> &lt;= <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> &lt; <span class="id"><a href="TSOMemLemmas.html#i">i</a></span> + <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.of_nat">Z.of_nat</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">Datatypes.length</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span>))%<span class="id">Z</span> \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> &lt; <span class="id"><a href="TSOMemLemmas.html#i">i</a></span>)%<span class="id">Z</span> \/ (<span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> &gt;= <span class="id"><a href="TSOMemLemmas.html#i">i</a></span> + <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.of_nat">Z.of_nat</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">Datatypes.length</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span>))%<span class="id">Z</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9678')">Proof.</div>
<div class="proofscript" id="proof9678">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="inrange_or_not1">inrange_or_not1</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ofs</span> <span class="id">i</span> <span class="id">sz</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOMemLemmas.html#i">i</a></span> &lt;= <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> &lt; <span class="id"><a href="TSOMemLemmas.html#i">i</a></span> + <span class="id"><a href="TSOMemLemmas.html#sz">sz</a></span>)%<span class="id">Z</span> \/ ((<span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> &lt; <span class="id"><a href="TSOMemLemmas.html#i">i</a></span>)%<span class="id">Z</span> \/ (<span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> &gt;= <span class="id"><a href="TSOMemLemmas.html#i">i</a></span> + <span class="id"><a href="TSOMemLemmas.html#sz">sz</a></span>)%<span class="id">Z</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9679')">Proof.</div>
<div class="proofscript" id="proof9679">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">unbuffer_safe_apply_buffer</span>' :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tm</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m</span>', <span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span>) (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9680')">Proof.</div>
<div class="proofscript" id="proof9680">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#unbuffer_safe_apply_buffer">unbuffer_safe_apply_buffer</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_same_item_perm_eq_stable">apply_same_item_perm_eq_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">m1</span>' <span class="id">m2</span>' <span class="id">b</span> <span class="id">ofs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span>) !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> = (<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span>) !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m1</span>') !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> = (<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m2</span>') !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9681')">Proof.</div>
<div class="proofscript" id="proof9681">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span> <span class="id">H0</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">b</span> <span class="id">b0</span>); <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 (<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">free</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unchecked_free">unchecked_free</a></span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">b</span> <span class="id">b0</span>); <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 (<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_buf_item_not_b_contents_stable">apply_buf_item_not_b_contents_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">a</span> <span class="id">m1</span> <span class="id">m1</span>' <span class="id">m2</span> <span class="id">m2</span>' <span class="id">b</span> <span class="id">ofs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#a">a</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#a">a</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#ZMap.get">ZMap.get</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span>) !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#ZMap.get">ZMap.get</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span>) !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#ZMap.get">ZMap.get</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id">m1</span>') !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#ZMap.get">ZMap.get</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id">m2</span>') !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9682')">Proof.</div>
<div class="proofscript" id="proof9682">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span> <span class="id">H0</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">b</span> <span class="id">b0</span>); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 (<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 (<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">free</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span> <span class="id">H0</span> <span class="id">H1</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="id">unfolds</span> <span class="id">unchecked_free</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">b</span> <span class="id">b0</span>); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 (<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMemLemmas.html#inrange_or_not">inrange_or_not</a></span> <span class="id"><a href="Memdata.html#memval">memval</a></span> <span class="id">ofs</span> <span class="id">z</span> (<span class="id"><a href="Memdata.html#encode_val">encode_val</a></span> <span class="id">m</span> <span class="id">v</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="FMemLemmas.html#setN_geteq2">setN_geteq2</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 (<span class="tactic">rewrite</span> <span class="id"><a href="FMemory.html#Mem.setN_outside">Mem.setN_outside</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 (<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">apply_same_item_perm_eq_stable</span>' :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">m1</span>' <span class="id">m2</span>' <span class="id">b</span> <span class="id">ofs</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span>) !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> = (<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span>) !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m1</span>') !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> = (<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m2</span>') !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9683')">Proof.</div>
<div class="proofscript" id="proof9683">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span> <span class="id">H0</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">b</span> <span class="id">b0</span>); <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 (<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">free</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unchecked_free">unchecked_free</a></span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">b</span> <span class="id">b0</span>); <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 (<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_same_bf_perm_eq_stable">apply_same_bf_perm_eq_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">m1</span>' <span class="id">m2</span>' <span class="id">b</span> <span class="id">ofs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span>) !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> = (<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span>) !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m1</span>') !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> = (<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m2</span>') !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9684')">Proof.</div>
<div class="proofscript" id="proof9684">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>; <span class="tactic">intros</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m1</span>) <span class="id">eqn</span>:?; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m2</span>) <span class="id">eqn</span>:?; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#apply_same_item_perm_eq_stable">apply_same_item_perm_eq_stable</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_buf_item_maccess_eq_still">apply_buf_item_maccess_eq_still</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">a</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">m1</span>' <span class="id">m2</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#a">a</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#a">a</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m1</span>' = <span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m2</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9685')">Proof.</div>
<div class="proofscript" id="proof9685">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">clear</span> <span class="id">H</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">free</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unchecked_free">unchecked_free</a></span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
&nbsp;&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_buf_maccess_eq_still">apply_buf_maccess_eq_still</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">m1</span>' <span class="id">m2</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m1</span>' = <span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m2</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9686')">Proof.</div>
<div class="proofscript" id="proof9686">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>; <span class="tactic">intros</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m1</span>) <span class="id">eqn</span>:?; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m2</span>) <span class="id">eqn</span>:?; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buf_item_maccess_eq_still">apply_buf_item_maccess_eq_still</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="gm_cont_eq_apply_same_buf_stable">gm_cont_eq_apply_same_buf_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">m1</span>' <span class="id">m2</span>' <span class="id">b</span> <span class="id">ofs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#ZMap.get">ZMap.get</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span>) !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#ZMap.get">ZMap.get</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span>) !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#ZMap.get">ZMap.get</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id">m1</span>') !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#ZMap.get">ZMap.get</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id">m2</span>') !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9687')">Proof.</div>
<div class="proofscript" id="proof9687">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>; <span class="tactic">intros</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m1</span>) <span class="id">eqn</span>:?; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m2</span>) <span class="id">eqn</span>:?; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buf_item_not_b_contents_stable">apply_buf_item_not_b_contents_stable</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;} <br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="gm_cont_eq_apply_buf_not_alloc_stable">gm_cont_eq_apply_buf_not_alloc_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">m1</span>' <span class="id">m2</span>' <span class="id">b</span> <span class="id">ofs</span> <span class="id">stk</span> <span class="id">lo</span> <span class="id">hi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> (<span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> ++ (<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id"><a href="TSOMemLemmas.html#stk">stk</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span>) :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#stk">stk</a></span> &lt;&gt; <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#ZMap.get">ZMap.get</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span>) !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#ZMap.get">ZMap.get</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span>) !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#ZMap.get">ZMap.get</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id">m1</span>') !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#ZMap.get">ZMap.get</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id">m2</span>') !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9688')">Proof.</div>
<div class="proofscript" id="proof9688">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>; <span class="tactic">intros</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span> <span class="id">H0</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m1</span>) <span class="id">eqn</span>:?; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m2</span>) <span class="id">eqn</span>:?; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buf_item_not_b_contents_stable">apply_buf_item_not_b_contents_stable</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="not_in_apply_bf_vb_not_in_orign">not_in_apply_bf_vb_not_in_orign</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">b</span> <span class="id">m</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9689')">Proof.</div>
<div class="proofscript" id="proof9689">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buffer_in_validblocks_stable">apply_buffer_in_validblocks_stable</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_buffer_not_in_vb_not_alloc_in_bf">apply_buffer_not_in_vb_not_alloc_in_bf</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ (<span class="id">exists</span> <span class="id">lo</span> <span class="id">hi</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id">lo</span> <span class="id">hi</span>) <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9690')">Proof.</div>
<div class="proofscript" id="proof9690">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">H1</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m</span>) <span class="id">eqn</span>:?; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Happly_buf</span> : <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">lo</span> [<span class="id">hi</span> <span class="id">H1</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span>; <span class="tactic">subst</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#not_in_apply_bf_vb_not_in_orign">not_in_apply_bf_vb_not_in_orign</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Heqo</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H0</span>; <span class="tactic">clear</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Heqo</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_buffer_app_or">in_buffer_app_or</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf1</span> <span class="id">bf2</span> <span class="id">b</span> <span class="id">ofs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#in_buffer">in_buffer</a></span> (<span class="id"><a href="TSOMemLemmas.html#bf1">bf1</a></span> ++ <span class="id"><a href="TSOMemLemmas.html#bf2">bf2</a></span>) <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#in_buffer">in_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf1">bf1</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> \/ <span class="id"><a href="TSOMem.html#in_buffer">in_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf2">bf2</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9691')">Proof.</div>
<div class="proofscript" id="proof9691">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#in_or_app_rev">in_or_app_rev</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">left</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">right</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_buffer_app_or_rev">in_buffer_app_or_rev</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf1</span> <span class="id">bf2</span> <span class="id">b</span> <span class="id">ofs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#in_buffer">in_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf1">bf1</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> \/ <span class="id"><a href="TSOMem.html#in_buffer">in_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf2">bf2</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#in_buffer">in_buffer</a></span> (<span class="id"><a href="TSOMemLemmas.html#bf1">bf1</a></span> ++ <span class="id"><a href="TSOMemLemmas.html#bf2">bf2</a></span>) <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9692')">Proof.</div>
<div class="proofscript" id="proof9692">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_or_app">in_or_app</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_or_app">in_or_app</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
&nbsp;&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_buffer_item_get_bi_blk_b">in_buffer_item_get_bi_blk_b</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span> <span class="id">b</span> <span class="id">ofs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#in_buffer_item">in_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#get_bi_block">get_bi_block</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> = <span class="id"><a href="TSOMemLemmas.html#b">b</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9693')">Proof.</div>
<div class="proofscript" id="proof9693">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="bi_in_bf_b_in_getbf_block">bi_in_bf_b_in_getbf_block</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">bi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="TSOMemLemmas.html#get_bi_block">get_bi_block</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span>) (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9694')">Proof.</div>
<div class="proofscript" id="proof9694">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>; <span class="tactic">intros</span>; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="alloc_in_buf_apply_buf_in_vb">alloc_in_buf_apply_buf_in_vb</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">m</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span>) <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9695')">Proof.</div>
<div class="proofscript" id="proof9695">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>; <span class="id">simpls</span>; <span class="tactic">intros</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> (<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span>) <span class="id">m</span>) <span class="id">eqn</span>:?; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buffer_in_validblocks_stable">apply_buffer_in_validblocks_stable</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Heqo</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>; <span class="tactic">inversion</span> <span class="id">Heqo</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m</span>) <span class="id">eqn</span>:?; <span class="id">simpls</span>; <span class="id">tryfalse</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_sub_bf_orign_b_impl_stable">apply_sub_bf_orign_b_impl_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf1</span> <span class="id">bf2</span> <span class="id">m1</span> <span class="id">m1</span>' <span class="id">m2</span> <span class="id">m2</span>' <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> (<span class="id"><a href="TSOMemLemmas.html#bf1">bf1</a></span> ++ <span class="id"><a href="TSOMemLemmas.html#bf2">bf2</a></span>) <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf1">bf1</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m2</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m1</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9696')">Proof.</div>
<div class="proofscript" id="proof9696">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf1</span>; <span class="tactic">intros</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buffer_in_validblocks_stable">apply_buffer_in_validblocks_stable</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m1</span>) <span class="id">eqn</span>:?; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m2</span>) <span class="id">eqn</span>:?; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#in_valid_block_eq_apply_same_buf_item_still">in_valid_block_eq_apply_same_buf_item_still</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_buf_alloc_mem_access_b_not_new_access_eq">apply_buf_alloc_mem_access_b_not_new_access_eq</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">stk</span> <span class="id">b</span> <span class="id">m1</span> <span class="id">m1</span>' <span class="id">m2</span> <span class="id">m2</span>' <span class="id">lo</span> <span class="id">hi</span> <span class="id">ofs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> (<span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> ++ <span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id"><a href="TSOMemLemmas.html#stk">stk</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span>) !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> = (<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span>) !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#b">b</a></span> &lt;&gt; <span class="id"><a href="TSOMemLemmas.html#stk">stk</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m1</span>') !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> = (<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m2</span>') !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9697')">Proof.</div>
<div class="proofscript" id="proof9697">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>; <span class="id">simpls</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span> <span class="id">H0</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m1</span>) <span class="id">eqn</span>:?; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m2</span>) <span class="id">eqn</span>:?; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#apply_same_item_perm_eq_stable">apply_same_item_perm_eq_stable</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_buf_alloc_mem_access_b_not_new_contents_eq">apply_buf_alloc_mem_access_b_not_new_contents_eq</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">stk</span> <span class="id">b</span> <span class="id">m1</span> <span class="id">m1</span>' <span class="id">m2</span> <span class="id">m2</span>' <span class="id">lo</span> <span class="id">hi</span> <span class="id">ofs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> (<span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> ++ <span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id"><a href="TSOMemLemmas.html#stk">stk</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#ZMap.get">ZMap.get</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span>) !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span>  =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#ZMap.get">ZMap.get</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span>) !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#b">b</a></span> &lt;&gt; <span class="id"><a href="TSOMemLemmas.html#stk">stk</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#ZMap.get">ZMap.get</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id">m1</span>') !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#ZMap.get">ZMap.get</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id">m2</span>') !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9698')">Proof.</div>
<div class="proofscript" id="proof9698">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>; <span class="tactic">intros</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>; <span class="id">simpls</span>; <span class="tactic">clear</span> <span class="id">H</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m1</span>) <span class="id">eqn</span>:?; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m2</span>) <span class="id">eqn</span>:?; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buf_item_not_b_contents_stable">apply_buf_item_not_b_contents_stable</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="alloc_add_new_vb">alloc_add_new_vb</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#b">b</a></span> :: (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>) = <span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9699')">Proof.</div>
<div class="proofscript" id="proof9699">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="alloc_nb_access">alloc_nb_access</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">ofs</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m</span>') !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">if</span> <span class="id"><a href="Coqlib.html#zle">zle</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> &amp;&amp; <span class="id"><a href="Coqlib.html#zlt">zlt</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> <span class="kwd">then</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="Memperm.html#Freeable">Freeable</a></span> <span class="kwd">else</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9700')">Proof.</div>
<div class="proofscript" id="proof9700">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>; <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="alloc_nb_content">alloc_nb_content</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">ofs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#ZMap.get">ZMap.get</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id">m</span>') !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> = <span class="id"><a href="Memdata.html#Undef">Undef</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9701')">Proof.</div>
<div class="proofscript" id="proof9701">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>; <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#ZMap.gi">ZMap.gi</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_buf_tail_alloc_nb_access">apply_buf_tail_alloc_nb_access</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">ofs</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> (<span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> ++ (<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span>) :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m</span>') !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">if</span> <span class="id"><a href="Coqlib.html#zle">zle</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> &amp;&amp; <span class="id"><a href="Coqlib.html#zlt">zlt</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> <span class="kwd">then</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="Memperm.html#Freeable">Freeable</a></span> <span class="kwd">else</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9702')">Proof.</div>
<div class="proofscript" id="proof9702">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>; <span class="tactic">intros</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>; <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m</span>); <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_buf_tail_alloc_nb_contents">apply_buf_tail_alloc_nb_contents</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">ofs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> (<span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> ++ (<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span>) :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#ZMap.get">ZMap.get</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id">m</span>') !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> = <span class="id"><a href="Memdata.html#Undef">Undef</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9703')">Proof.</div>
<div class="proofscript" id="proof9703">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>; <span class="tactic">intros</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>; <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#ZMap.gi">ZMap.gi</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m</span>); <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_buf_not_b_access_stable">apply_buf_not_b_access_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">stk</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">m1</span> <span class="id">m1</span>' <span class="id">m2</span> <span class="id">m2</span>' <span class="id">b</span> <span class="id">ofs</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> (<span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> ++ (<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id"><a href="TSOMemLemmas.html#stk">stk</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span>) :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>' -&gt; <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> &lt;&gt; <span class="id"><a href="TSOMemLemmas.html#stk">stk</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span>) !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> = (<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span>) !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m1</span>') !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> = (<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m2</span>') !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9704')">Proof.</div>
<div class="proofscript" id="proof9704">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>; <span class="tactic">intros</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>; <span class="tactic">clear</span> <span class="id">H</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m1</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m2</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">apply_same_item_perm_eq_stable</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="access_eq_apply_same_buf_item_still">access_eq_apply_same_buf_item_still</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">m1</span>' <span class="id">m2</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m1</span>' = <span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m2</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9705')">Proof.</div>
<div class="proofscript" id="proof9705">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span> <span class="id">H0</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">free</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span> <span class="id">H0</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span> <span class="id">H0</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
&nbsp;&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_buf_not_b_contents_stable">apply_buf_not_b_contents_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">stk</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">m1</span> <span class="id">m1</span>' <span class="id">m2</span> <span class="id">m2</span>' <span class="id">b</span> <span class="id">ofs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> (<span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> ++ (<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id"><a href="TSOMemLemmas.html#stk">stk</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span>) :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>' -&gt; <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> &lt;&gt; <span class="id"><a href="TSOMemLemmas.html#stk">stk</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#ZMap.get">ZMap.get</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span>) !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#ZMap.get">ZMap.get</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span>) !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#ZMap.get">ZMap.get</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id">m1</span>') !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#ZMap.get">ZMap.get</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id">m2</span>') !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9706')">Proof.</div>
<div class="proofscript" id="proof9706">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>; <span class="tactic">intros</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>; <span class="tactic">clear</span> <span class="id">H</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m1</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m2</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buf_item_not_b_contents_stable">apply_buf_item_not_b_contents_stable</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="alloc_not_nb_access_stable">alloc_not_nb_access_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">stk</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">b</span> <span class="id">k</span> <span class="id">ofs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#stk">stk</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#b">b</a></span> &lt;&gt; <span class="id"><a href="TSOMemLemmas.html#stk">stk</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>) !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> = (<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m</span>') !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9707')">Proof.</div>
<div class="proofscript" id="proof9707">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_buf_prefix_in_apply_more_still">apply_buf_prefix_in_apply_more_still</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf1</span> <span class="id">bf2</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">m1</span>' <span class="id">m2</span>' <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf1">bf1</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> (<span class="id"><a href="TSOMemLemmas.html#bf1">bf1</a></span> ++ <span class="id"><a href="TSOMemLemmas.html#bf2">bf2</a></span>) <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m1</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m2</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9708')">Proof.</div>
<div class="proofscript" id="proof9708">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf1</span>; <span class="id">simpls</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buffer_in_validblocks_stable">apply_buffer_in_validblocks_stable</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m1</span>) <span class="id">eqn</span>:?; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m2</span>) <span class="id">eqn</span>:?; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H1</span> <span class="id">Heqo</span> <span class="id">Heqo0</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#in_valid_block_eq_apply_same_buf_item_still">in_valid_block_eq_apply_same_buf_item_still</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_buf_orign_vb_eq_add_store_item_vb_eq_still">apply_buf_orign_vb_eq_add_store_item_vb_eq_still</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">m1</span>' <span class="id">m2</span>' <span class="id">c</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> (<span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> ++ <span class="id"><a href="TSOMem.html#BufferedStore">BufferedStore</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m1</span>' = <span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m2</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9709')">Proof.</div>
<div class="proofscript" id="proof9709">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>; <span class="tactic">intros</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id">c</span> <span class="id">m2</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span>) <span class="id">eqn</span>:?; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Heqo</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Heqo</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m1</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m2</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H1</span> <span class="id">Heqo</span> <span class="id">Heqo0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#in_valid_block_eq_apply_same_buf_item_still">in_valid_block_eq_apply_same_buf_item_still</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_buf_orign_access_eq_add_store_item_access_eq_still">apply_buf_orign_access_eq_add_store_item_access_eq_still</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">m1</span>' <span class="id">m2</span>' <span class="id">c</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> (<span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> ++ <span class="id"><a href="TSOMem.html#BufferedStore">BufferedStore</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m1</span>' = <span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m2</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9710')">Proof.</div>
<div class="proofscript" id="proof9710">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>; <span class="tactic">intros</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id">c</span> <span class="id">m2</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span>) <span class="id">eqn</span>:?; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Heqo</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Heqo</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m1</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m2</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H1</span> <span class="id">Heqo</span> <span class="id">Heqo0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#access_eq_apply_same_buf_item_still">access_eq_apply_same_buf_item_still</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_bf_tail_store_not_same_block_cont_stable">apply_bf_tail_store_not_same_block_cont_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">m1</span>' <span class="id">m2</span>' <span class="id">b</span> <span class="id">ofs</span> <span class="id">b0</span> <span class="id">ofs0</span> <span class="id">v</span> <span class="id">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> (<span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> ++ <span class="id"><a href="TSOMem.html#BufferedStore">BufferedStore</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#ZMap.get">ZMap.get</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs0">ofs0</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span>) !! <span class="id"><a href="TSOMemLemmas.html#b0">b0</a></span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#ZMap.get">ZMap.get</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs0">ofs0</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span>) !! <span class="id"><a href="TSOMemLemmas.html#b0">b0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#b0">b0</a></span> &lt;&gt; <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#ZMap.get">ZMap.get</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs0">ofs0</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id">m1</span>') !! <span class="id"><a href="TSOMemLemmas.html#b0">b0</a></span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#ZMap.get">ZMap.get</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs0">ofs0</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id">m2</span>') !! <span class="id"><a href="TSOMemLemmas.html#b0">b0</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9711')">Proof.</div>
<div class="proofscript" id="proof9711">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>; <span class="tactic">intros</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id">c</span> <span class="id">m2</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span>) <span class="id">eqn</span>:?; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Heqo</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Heqo</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">Heqo</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m1</span>) <span class="id">eqn</span>:?; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m2</span>) <span class="id">eqn</span>:?; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Heqo</span> <span class="id">Heqo0</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buf_item_not_b_contents_stable">apply_buf_item_not_b_contents_stable</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_bf_tail_store_not_same_range_cont_stable">apply_bf_tail_store_not_same_range_cont_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">m1</span>' <span class="id">m2</span>' <span class="id">b</span> <span class="id">ofs</span> <span class="id">ofs0</span> <span class="id">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> (<span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> ++ <span class="id"><a href="TSOMem.html#BufferedStore">BufferedStore</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="TSOMemLemmas.html#n">n</a></span>) :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#ZMap.get">ZMap.get</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs0">ofs0</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span>) !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#ZMap.get">ZMap.get</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs0">ofs0</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span>) !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id"><a href="TSOMemLemmas.html#ofs0">ofs0</a></span> &lt; <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span>)%<span class="id">Z</span> \/ (<span class="id"><a href="TSOMemLemmas.html#ofs0">ofs0</a></span> &gt;= <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span>)%<span class="id">Z</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#ZMap.get">ZMap.get</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs0">ofs0</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id">m1</span>') !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#ZMap.get">ZMap.get</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs0">ofs0</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id">m2</span>') !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9712')">Proof.</div>
<div class="proofscript" id="proof9712">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>; <span class="tactic">intros</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id">m2</span> <span class="id">b</span> <span class="id">ofs</span> (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id">n</span>)) <span class="id">eqn</span>:?; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Heqo</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Heqo</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">Heqo</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="FMemory.html#Mem.setN_outside">Mem.setN_outside</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m1</span>) <span class="id">eqn</span>:?; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m2</span>) <span class="id">eqn</span>:?; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Heqo</span> <span class="id">Heqo0</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buf_item_not_b_contents_stable">apply_buf_item_not_b_contents_stable</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="loc_stable_valid_access_stable">loc_stable_valid_access_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">b</span> <span class="id">c</span> <span class="id">p</span> <span class="id">z</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">ofs</span>, (<span class="id"><a href="TSOMemLemmas.html#z">z</a></span> &lt;= <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> &lt; <span class="id"><a href="TSOMemLemmas.html#z">z</a></span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span>)%<span class="id">Z</span> -&gt; <span class="id"><a href="ObjectSim.html#loc_stable">loc_stable</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#valid_access">valid_access</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#z">z</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#valid_access">valid_access</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#z">z</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9713')">Proof.</div>
<div class="proofscript" id="proof9713">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">valid_access</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">range_perm</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">loc_stable</span>; <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H3</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="not_obj_mem_upd_obj_mem_loc_stable">not_obj_mem_upd_obj_mem_loc_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">L</span> <span class="id">z</span> <span class="id">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">ofs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>, (<span class="id"><a href="TSOMemLemmas.html#z">z</a></span> &lt;= <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> &lt; <span class="id"><a href="TSOMemLemmas.html#z">z</a></span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span>)%<span class="id">Z</span> -&gt; <span class="id"><a href="RGRels.html#obj_mem">obj_mem</a></span> <span class="id"><a href="TSOMemLemmas.html#M">M</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="RGRels.html#obj_mem">obj_mem</a></span> <span class="id"><a href="TSOMemLemmas.html#M">M</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#b">b</a></span> &lt;&gt; <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOMemLemmas.html#b">b</a></span> = <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> /\ ((<span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> &lt; <span class="id"><a href="TSOMemLemmas.html#z">z</a></span>)%<span class="id">Z</span> \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> &gt;= <span class="id"><a href="TSOMemLemmas.html#z">z</a></span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span>)%<span class="id">Z</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9714')">Proof.</div>
<div class="proofscript" id="proof9714">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">b</span> <span class="id">L</span>); <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id"><a href="TSOMemLemmas.html#inrange_or_not1">inrange_or_not1</a></span> <span class="id">ofs</span> <span class="id">z</span> (<span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id">c</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ht</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="loc_stable_cont_stable">loc_stable_cont_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">b</span> <span class="id">ofs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ObjectSim.html#loc_stable">loc_stable</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#ZMap.get">ZMap.get</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>) !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#ZMap.get">ZMap.get</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id">m</span>') !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9715')">Proof.</div>
<div class="proofscript" id="proof9715">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">loc_stable</span>.<br/>
&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="loc_stable_load_same">loc_stable_load_same</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">b</span> <span class="id">v</span> <span class="id">c</span> <span class="id">z</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">ofs</span>, (<span class="id"><a href="TSOMemLemmas.html#z">z</a></span> &lt;= <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> &lt; <span class="id"><a href="TSOMemLemmas.html#z">z</a></span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span>)%<span class="id">Z</span> -&gt; <span class="id"><a href="ObjectSim.html#loc_stable">loc_stable</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#z">z</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#z">z</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9716')">Proof.</div>
<div class="proofscript" id="proof9716">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">load</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht1</span> : <span class="id">v0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#loc_stable_valid_access_stable">loc_stable_valid_access_stable</a></span> <span class="kwd">in</span> <span class="id">Ht1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="FMemLemmas.html#get_eq_getN_eq">get_eq_getN_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="Memdata.html#size_chunk_conv">size_chunk_conv</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#loc_stable_cont_stable">loc_stable_cont_stable</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="store_succ_invb">store_succ_invb</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9717')">Proof.</div>
<div class="proofscript" id="proof9717">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">valid_access</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v0</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">range_perm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> ((<span class="id">ofs</span> &lt;= <span class="id">ofs</span> &lt; <span class="id">ofs</span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id">c</span>)%<span class="id">Z</span>).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">c</span>; <span class="id">simpls</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">Classical_Prop.classic</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">b</span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m</span>))); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="GMemory.html#GMem.invalid_noaccess">GMem.invalid_noaccess</a></span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="loc_stable_store_still">loc_stable_store_still</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">m</span>'' <span class="id">b</span> <span class="id">z</span> <span class="id">v</span> <span class="id">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#z">z</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">ofs</span>, (<span class="id"><a href="TSOMemLemmas.html#z">z</a></span> &lt;= <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> &lt; <span class="id"><a href="TSOMemLemmas.html#z">z</a></span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span>)%<span class="id">Z</span> -&gt; <span class="id"><a href="ObjectSim.html#loc_stable">loc_stable</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m0</span>, <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#z">z</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m0</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9718')">Proof.</div>
<div class="proofscript" id="proof9718">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">v0</span> <span class="id">n</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">valid_access</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v0</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">range_perm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hrange_perm</span> : <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">Hrange_perm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H2</span> <span class="id">Hrange_perm</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">loc_stable</span>.<br/>
&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">Hrange_perm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_bf_after_unbuffer_in_orign_bf">in_bf_after_unbuffer_in_orign_bf</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span>' <span class="id">tm</span> <span class="id">tm</span>' <span class="id">b</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="TSOMem.html#get_tsom_b">get_tsom_b</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> <span class="id">tm</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer">unbuffer</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span> <span class="id">t</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">tm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="TSOMem.html#get_tsom_b">get_tsom_b</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9719')">Proof.</div>
<div class="proofscript" id="proof9719">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">t</span>' <span class="id">tm</span>.<br/>
&nbsp;&nbsp;<span class="id">remember</span> ((<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span>) <span class="id">t</span>') <span class="kwd">as</span> <span class="id">bf</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">t</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bf</span>; <span class="id">simpls</span>; <span class="tactic">intros</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">get_tsom_b</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>, <span class="id">tm</span>'; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">unbuffer</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Heqbf</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t</span>'); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>, <span class="id">tm</span>'; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">unbuffer</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Heqbf</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Heqbf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">destruct</span> <span class="id">b</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>, <span class="id">tm</span>'; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">unbuffer</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Heqbf</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#in_tbf_upd_oth_stillin">in_tbf_upd_oth_stillin</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="wfbis_in_loc_in_buffer">wfbis_in_loc_in_buffer</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span>) -&gt; <span class="id"><a href="TSOMem.html#wfbis">wfbis</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">ofs</span>, <span class="id"><a href="TSOMem.html#in_buffer">in_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id">ofs</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9720')">Proof.</div>
<div class="proofscript" id="proof9720">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>; <span class="tactic">intros</span>; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">z</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">wfbis</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>) (<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span> :: <span class="id">bf</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">ofs</span> <span class="id">H</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">ofs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">wfbis</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">z</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">wfbis</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="TSOMem.html#BufferedFree">BufferedFree</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>) (<span class="id"><a href="TSOMem.html#BufferedFree">BufferedFree</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span> :: <span class="id">bf</span>)); <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">ofs</span> <span class="id">H</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">ofs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">wfbis</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">z</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m</span>; <span class="id">simpls</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">ofs</span> <span class="id">H</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">ofs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">wfbis</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="obj_mem_other_ofs_not_touch">obj_mem_other_ofs_not_touch</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bis</span> <span class="id">L</span> <span class="id">M</span> <span class="id">M</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.forward">GMem.forward</a></span> <span class="id"><a href="TSOMemLemmas.html#M">M</a></span> <span class="id">M</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> <span class="id"><a href="TSOMemLemmas.html#bis">bis</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">ofs</span>, (0 &lt;= <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> &lt; 4)%<span class="id">Z</span> -&gt; <span class="id"><a href="RGRels.html#obj_mem">obj_mem</a></span> <span class="id"><a href="TSOMemLemmas.html#M">M</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">ofs</span> <span class="id">k</span> <span class="id">p</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> &gt;= 4)%<span class="id">Z</span> \/ (<span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> &lt; 0)%<span class="id">Z</span> -&gt; ~ <span class="id"><a href="GMemory.html#GMem.perm">GMem.perm</a></span> <span class="id"><a href="TSOMemLemmas.html#M">M</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#in_buffer">in_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bis">bis</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="RGRels.html#obj_mem">obj_mem</a></span> <span class="id"><a href="TSOMemLemmas.html#M">M</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> /\ (<span class="id">exists</span> <span class="id">k</span> <span class="id">p</span>, <span class="id"><a href="GMemory.html#GMem.perm">GMem.perm</a></span> <span class="id">M</span>' <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id">k</span> <span class="id">p</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#wfbis">wfbis</a></span> <span class="id"><a href="TSOMemLemmas.html#bis">bis</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOMemLemmas.html#M">M</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> <span class="id"><a href="TSOMemLemmas.html#bis">bis</a></span>) -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9721')">Proof.</div>
<div class="proofscript" id="proof9721">
&nbsp;&nbsp;<span class="id">introv</span> <span class="id">Hgm_forward</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#wfbis_in_loc_in_buffer">wfbis_in_loc_in_buffer</a></span> <span class="kwd">in</span> <span class="id">H5</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H5</span> <span class="kwd">as</span> [<span class="id">ofs</span> <span class="id">H5</span>].<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H5</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="TSOMemLemmas.html#inrange_or_not1">inrange_or_not1</a></span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H7</span> <span class="id">ofs</span> 0%<span class="id">Z</span> 4%<span class="id">Z</span>); <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H7</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H7</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> ((<span class="id">ofs</span> &gt;= 4)%<span class="id">Z</span> \/ (<span class="id">ofs</span> &lt; 0)%<span class="id">Z</span>); <span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">destruct</span> <span class="id">H7</span>; <span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H6</span> <span class="kwd">as</span> [<span class="id">k</span> [<span class="id">p</span> <span class="id">H6</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H1</span> <span class="kwd">with</span> (<span class="id">k</span> := <span class="id">k</span>) (<span class="id">p</span> := <span class="id">p</span>) <span class="kwd">in</span> <span class="id">H8</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hgm_forward</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H8</span> <span class="id">H4</span> <span class="id">alloc_forward</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">GMem.perm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">alloc_forward</span> <span class="kwd">in</span> <span class="id">H4</span>; <span class="tactic">eauto</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="store_diff_block_loc_stable">store_diff_block_loc_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">v</span> <span class="id">b</span> <span class="id">z</span> <span class="id">ofs</span> <span class="id">L</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#z">z</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#b">b</a></span> &lt;&gt; <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ObjectSim.html#loc_stable">loc_stable</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9722')">Proof.</div>
<div class="proofscript" id="proof9722">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="ObjectSim.html#loc_stable">loc_stable</a></span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="store_ofs_not_inrange_loc_stable">store_ofs_not_inrange_loc_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">b</span> <span class="id">ofs</span> <span class="id">c</span> <span class="id">z</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#z">z</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> &lt; <span class="id"><a href="TSOMemLemmas.html#z">z</a></span>)%<span class="id">Z</span> \/ (<span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> &gt;= <span class="id"><a href="TSOMemLemmas.html#z">z</a></span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span>)%<span class="id">Z</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ObjectSim.html#loc_stable">loc_stable</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9723')">Proof.</div>
<div class="proofscript" id="proof9723">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;<span class="id">dis_if_else</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">loc_stable</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="FMemory.html#Mem.setN_outside">Mem.setN_outside</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Memdata.html#encode_val_length">encode_val_length</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="Memdata.html#size_chunk_conv">size_chunk_conv</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="inrange_loc_belongsto">inrange_loc_belongsto</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">ofs0</span> <span class="id">sz</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> &lt;= <span class="id"><a href="TSOMemLemmas.html#ofs0">ofs0</a></span> &lt; <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> + <span class="id"><a href="TSOMemLemmas.html#sz">sz</a></span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Footprint.html#Locs.belongsto">Locs.belongsto</a></span> (<span class="id"><a href="TSOMem.html#inrange">inrange</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#sz">sz</a></span>) <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs0">ofs0</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9724')">Proof.</div>
<div class="proofscript" id="proof9724">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Locs.belongsto</span>, <span class="id">inrange</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zle">zle</a></span> <span class="id">ofs</span> <span class="id">ofs0</span>); <span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zlt">zlt</a></span> <span class="id">ofs0</span> (<span class="id">ofs</span> + <span class="id">sz</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>; <span class="id">tryfalse</span>; <span class="tactic">try</span> <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="inrange_loc_belongsto_rev">inrange_loc_belongsto_rev</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">ofs0</span> <span class="id">sz</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Footprint.html#Locs.belongsto">Locs.belongsto</a></span> (<span class="id"><a href="TSOMem.html#inrange">inrange</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#sz">sz</a></span>) <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs0">ofs0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> &lt;= <span class="id"><a href="TSOMemLemmas.html#ofs0">ofs0</a></span> &lt; <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> + <span class="id"><a href="TSOMemLemmas.html#sz">sz</a></span>)%<span class="id">Z</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9725')">Proof.</div>
<div class="proofscript" id="proof9725">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Locs.belongsto</span>, <span class="id">inrange</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zle">zle</a></span> <span class="id">ofs</span> <span class="id">ofs0</span>); <span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zlt">zlt</a></span> <span class="id">ofs0</span> (<span class="id">ofs</span> + <span class="id">sz</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>; <span class="id">tryfalse</span>; <span class="tactic">try</span> <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="not_in_buffer_apply_buf_item_loc_eq">not_in_buffer_apply_buf_item_loc_eq</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">b</span> <span class="id">ofs</span> <span class="id">sz</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ (<span class="id">exists</span> <span class="id">ofs</span>, <span class="id"><a href="TSOMem.html#in_buffer_item">in_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#gmem_loc_eq">gmem_loc_eq</a></span> (<span class="id"><a href="TSOMem.html#inrange">inrange</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#sz">sz</a></span>) <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id">m</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9726')">Proof.</div>
<div class="proofscript" id="proof9726">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#gmem_loc_eq">gmem_loc_eq</a></span>. <br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#gmem_loc_content_eq">gmem_loc_content_eq</a></span>, <span class="id"><a href="TSOMem.html#gmem_loc_perm_eq">gmem_loc_perm_eq</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>; <span class="id">simpls</span>.<br/>
<div class="doc">alloc </div>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>; <span class="id">inv</span> <span class="id">H</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">b</span> &lt;&gt; <span class="id">b0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H0</span>; <span class="tactic">clear</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">z</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">b1</span> = <span class="id">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Locs.belongsto</span>, <span class="id">inrange</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">b1</span> = <span class="id">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Locs.belongsto</span>, <span class="id">inrange</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
<div class="doc">free </div>
&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">free</span>, <span class="id">unchecked_free</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">b</span> = <span class="id">b1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Locs.belongsto</span>, <span class="id">inrange</span>; <span class="id">simpls</span>; <span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">b0</span> <span class="id">b1</span>); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> ((<span class="id">z</span> &lt;= <span class="id">ofs0</span> &lt; <span class="id">z0</span>)%<span class="id">Z</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hx0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zle">zle</a></span> <span class="id">z</span> <span class="id">ofs0</span>); <span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zlt">zlt</a></span> <span class="id">ofs0</span> <span class="id">z0</span>); <span class="id">simpls</span>; <span class="tactic">eauto</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">ofs0</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
<div class="doc">store </div>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">b</span> = <span class="id">b1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Locs.belongsto</span>, <span class="id">inrange</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">b</span> <span class="id">b0</span>); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="FMemory.html#Mem.setN_outside">Mem.setN_outside</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="TSOMemLemmas.html#inrange_or_not1">inrange_or_not1</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Memdata.html#encode_val_length">encode_val_length</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="Memdata.html#size_chunk_conv">size_chunk_conv</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H1</span> <span class="id">ofs0</span> <span class="id">z</span> (<span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id">m0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H0</span>; <span class="tactic">clear</span> - <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">ofs0</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
&nbsp;&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="gmem_load_loc_eq_load_same_val">gmem_load_loc_eq_load_same_val</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">c</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#gmem_loc_eq">gmem_loc_eq</a></span> (<span class="id"><a href="TSOMem.html#inrange">inrange</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span>)) <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9727')">Proof.</div>
<div class="proofscript" id="proof9727">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">gmem_loc_eq</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">load</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="FMemLemmas.html#get_eq_getN_eq">get_eq_getN_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">gmem_loc_content_eq</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#inrange_loc_belongsto">inrange_loc_belongsto</a></span> <span class="kwd">with</span> (<span class="id">b</span> := <span class="id">b</span>) <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="Memdata.html#size_chunk_conv">size_chunk_conv</a></span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H1</span> <span class="id">v0</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">valid_access</span>, <span class="id">range_perm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v0</span>; <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hrange</span> : <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">gmem_loc_perm_eq</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#inrange_loc_belongsto">inrange_loc_belongsto</a></span> <span class="kwd">with</span> (<span class="id">b</span> := <span class="id">b</span>) <span class="kwd">in</span> <span class="id">Hrange</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H1</span> <span class="kwd">with</span> (<span class="id">k</span> := <span class="id"><a href="Memperm.html#Max">Max</a></span>) <span class="kwd">in</span> <span class="id">Hrange</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H2</span> <span class="id">Hrange</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.perm_order</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hrange</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="not_in_buf_item_apply_load_stable">not_in_buf_item_apply_load_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">c</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ (<span class="id">exists</span> <span class="id">ofs</span>, <span class="id"><a href="TSOMem.html#in_buffer_item">in_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9728')">Proof.</div>
<div class="proofscript" id="proof9728">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#gmem_load_loc_eq_load_same_val">gmem_load_loc_eq_load_same_val</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#not_in_buffer_apply_buf_item_loc_eq">not_in_buffer_apply_buf_item_loc_eq</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
&nbsp;&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="load_orignal_loc_not_in_bf_apply_buf_same_val">load_orignal_loc_not_in_bf_apply_buf_same_val</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">c</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">ofs</span>, ~ <span class="id"><a href="TSOMem.html#in_buffer">in_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9729')">Proof.</div>
<div class="proofscript" id="proof9729">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>; <span class="tactic">intros</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m</span>) <span class="id">eqn</span>:?; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf</span> <span class="kwd">with</span> (<span class="id">m</span> := <span class="id">g</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#not_in_buf_item_apply_load_stable">not_in_buf_item_apply_load_stable</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">ofs</span> <span class="id">H</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H0</span> <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H0</span>; <span class="id">econstructor</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H0</span> <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="gmem_load_loc_perm_eq_store_still">gmem_load_loc_perm_eq_store_still</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">c</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">m1</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#gmem_loc_perm_eq">gmem_loc_perm_eq</a></span> (<span class="id"><a href="TSOMem.html#inrange">inrange</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span>)) <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m2</span>, <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9730')">Proof.</div>
<div class="proofscript" id="proof9730">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">gmem_loc_perm_eq</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">n</span>; <span class="tactic">clear</span> - <span class="id">H</span> <span class="id">v0</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">valid_access</span>, <span class="id">range_perm</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v0</span>; <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hrange</span> : <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#inrange_loc_belongsto">inrange_loc_belongsto</a></span> <span class="kwd">in</span> <span class="id">Hrange</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Hrange</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hrange</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="store_outrange_stable">store_outrange_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">c</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#gmem_loc_eq">gmem_loc_eq</a></span> (<span class="id"><a href="TSOMem.html#outrange">outrange</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span>)) <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id">m</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9731')">Proof.</div>
<div class="proofscript" id="proof9731">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#gmem_loc_eq">gmem_loc_eq</a></span>, <span class="id"><a href="TSOMem.html#gmem_loc_content_eq">gmem_loc_content_eq</a></span>, <span class="id"><a href="TSOMem.html#gmem_loc_perm_eq">gmem_loc_perm_eq</a></span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Locs.belongsto</span>, <span class="id">outrange</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="FMemory.html#Mem.setN_outside">Mem.setN_outside</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zle">zle</a></span> <span class="id">ofs</span> <span class="id">ofs0</span>); <span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zlt">zlt</a></span> <span class="id">ofs0</span> (<span class="id">ofs</span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id">c</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>; <span class="id">tryfalse</span>; <span class="tactic">try</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Memdata.html#encode_val_length">encode_val_length</a></span>; <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="Memdata.html#size_chunk_conv">size_chunk_conv</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="not_in_buf_item_apply_store_stable">not_in_buf_item_apply_store_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">m1</span> <span class="id">c</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ (<span class="id">exists</span> <span class="id">ofs</span>, <span class="id"><a href="TSOMem.html#in_buffer_item">in_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m2</span>, <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9732')">Proof.</div>
<div class="proofscript" id="proof9732">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#gmem_load_loc_perm_eq_store_still">gmem_load_loc_perm_eq_store_still</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#not_in_buffer_apply_buf_item_loc_eq">not_in_buffer_apply_buf_item_loc_eq</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="not_in_buf_item_apply_perm_stable">not_in_buf_item_apply_perm_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">b</span> <span class="id">ofs</span> <span class="id">k</span> <span class="id">p</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span>) !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ (<span class="id">exists</span> <span class="id">ofs</span>, <span class="id"><a href="TSOMem.html#in_buffer_item">in_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m</span>') !! <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9733')">Proof.</div>
<div class="proofscript" id="proof9733">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>; <span class="id">inv</span> <span class="id">H0</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">b0</span> &lt;&gt; <span class="id">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H1</span>; <span class="id">exists</span> <span class="id">z</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">free</span>, <span class="id">unchecked_free</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">b0</span> <span class="id">b</span>); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H1</span>; <span class="tactic">clear</span> - <span class="id">Hx0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">ofs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zle">zle</a></span> <span class="id">z</span> <span class="id">ofs</span>); <span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zlt">zlt</a></span> <span class="id">ofs</span> <span class="id">z0</span>); <span class="id">simpls</span>; <span class="id">tryfalse</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="obj_mem_loc_stable_still">obj_mem_loc_stable_still</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M</span> <span class="id">M</span>' <span class="id">L</span> <span class="id">ofs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html#obj_mem">obj_mem</a></span> <span class="id"><a href="TSOMemLemmas.html#M">M</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> -&gt; <span class="id"><a href="ObjectSim.html#loc_stable">loc_stable</a></span> <span class="id"><a href="TSOMemLemmas.html#M">M</a></span> <span class="id">M</span>' <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> -&gt; <span class="id"><a href="RGRels.html#obj_mem">obj_mem</a></span> <span class="id">M</span>' <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9734')">Proof.</div>
<div class="proofscript" id="proof9734">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">loc_stable</span>. <br/>
&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">obj_mem</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">not_in_buf_item_apply_perm_stable</span>' :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">bi</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">k</span> <span class="id">p</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="GMemory.html#GMem.perm">GMem.perm</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ (<span class="id">exists</span> <span class="id">ofs</span>, <span class="id"><a href="TSOMem.html#in_buffer_item">in_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="GMemory.html#GMem.perm">GMem.perm</a></span> <span class="id">m</span>' <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9735')">Proof.</div>
<div class="proofscript" id="proof9735">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>; <span class="id">unfolds</span> <span class="id">GMem.perm</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">b0</span> <span class="id">b</span>); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span> 0%<span class="id">Z</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">free</span>, <span class="id">unchecked_free</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>; <span class="id">unfolds</span> <span class="id">GMem.perm</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">b0</span> <span class="id">b</span>); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>; <span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>; <span class="id">unfolds</span> <span class="id">GMem.perm</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_buffer_cons_split">in_buffer_cons_split</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span> <span class="id">bf</span> <span class="id">b</span> <span class="id">ofs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#in_buffer">in_buffer</a></span> (<span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> :: <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span>) <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#in_buffer_item">in_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> \/ <span class="id"><a href="TSOMem.html#in_buffer">in_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9736')">Proof.</div>
<div class="proofscript" id="proof9736">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">right</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="unbuffer_safe_block_not_alloc_and_invb_not_in_buffer">unbuffer_safe_block_not_alloc_and_invb_not_in_buffer</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tm</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">t</span> <span class="id">lo</span> <span class="id">hi</span>, ~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span>) (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#in_buffer">in_buffer</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span>) <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9737')">Proof.</div>
<div class="proofscript" id="proof9737">
&nbsp;&nbsp;<span class="id">introv</span> <span class="id">Hunb_safe</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">b</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">ofs</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hunb_safe</span>; <span class="id">simpls</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tso</span> <span class="id">t</span>) <span class="id">eqn</span>:?; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>; <span class="tactic">simpl</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#in_buffer_cons_split">in_buffer_cons_split</a></span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>.<br/>
<div class="doc">alloc </div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H1</span> <span class="id">t</span> <span class="id">lo</span> <span class="id">hi</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqb0</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<div class="doc">free </div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ABIS</span> <span class="kwd">in</span> <span class="id">Heqb0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Heqb0</span> <span class="kwd">as</span> [<span class="id">m</span>' <span class="id">Heqb0</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Heqb0</span> <span class="id">H3</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">free</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H0</span> <span class="id">r</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">range_perm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">r</span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H0</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="GMemory.html#GMem.invalid_noaccess">GMem.invalid_noaccess</a></span> <span class="kwd">with</span> (<span class="id">ofs</span> := <span class="id">ofs</span>) (<span class="id">k</span> := <span class="id"><a href="Memperm.html#Max">Max</a></span>) <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.perm_order</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H3</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<div class="doc">store </div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ABIS</span> <span class="kwd">in</span> <span class="id">Heqb0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Heqb0</span> <span class="kwd">as</span> [<span class="id">m</span>' <span class="id">Heqb0</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H0</span> <span class="id">Heqb0</span> <span class="id">H3</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">v0</span> <span class="id">H0</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">valid_access</span>, <span class="id">range_perm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="GMemory.html#GMem.invalid_noaccess">GMem.invalid_noaccess</a></span> <span class="kwd">with</span> (<span class="id">ofs</span> := <span class="id">ofs</span>) (<span class="id">k</span> := <span class="id"><a href="Memperm.html#Max">Max</a></span>) <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H0</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.perm_order</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H3</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Happly_buf_item</span> : <span class="id">Heqb0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ABIS</span> <span class="kwd">in</span> <span class="id">Happly_buf_item</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Happly_buf_item</span> <span class="kwd">as</span> [<span class="id">m</span>' <span class="id">Happly_buf_item</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Heqb0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H0</span> <span class="id">Heqb0</span> <span class="id">Happly_buf_item</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">b0</span>; <span class="id">simpls</span>.<br/>
<div class="doc">alloc </div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Happly_buf_item</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H1</span> <span class="id">t</span> <span class="id">z</span> <span class="id">z0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqb0</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H1</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<div class="doc">free </div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">free</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Happly_buf_item</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">unchecked_free</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<div class="doc">store </div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Happly_buf_item</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H1</span> <span class="id">Heqb0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">intro</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H1</span> <span class="id">t0</span> <span class="id">lo</span> <span class="id">hi</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">tupdate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqb0</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (2 := <span class="id">t</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_bf_after_unbuffer_in_orign_bf1">in_bf_after_unbuffer_in_orign_bf1</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span>' <span class="id">tm</span> <span class="id">tm</span>' <span class="id">b</span> <span class="id">ofs</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#in_buffer">in_buffer</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span>' <span class="id"><a href="TSOMemLemmas.html#t">t</a></span>) <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer">unbuffer</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span> <span class="id">t</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">tm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#in_buffer">in_buffer</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span>) <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9738')">Proof.</div>
<div class="proofscript" id="proof9738">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">unbuffer</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span> <span class="id">t</span>') <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">tupdate</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqb0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="id">econstructor</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_buffer_split">apply_buffer_split</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf1</span> <span class="id">bf2</span> <span class="id">m</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> (<span class="id"><a href="TSOMemLemmas.html#bf1">bf1</a></span> ++ <span class="id"><a href="TSOMemLemmas.html#bf2">bf2</a></span>) <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m</span>'', <span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf1">bf1</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'' /\ <span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf2">bf2</a></span> <span class="id">m</span>'' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9739')">Proof.</div>
<div class="proofscript" id="proof9739">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf1</span>; <span class="tactic">intros</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m</span>) <span class="id">eqn</span>:?; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf1</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">tryfalse</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="mem_access_eq_apply_buf_item_stable">mem_access_eq_apply_buf_item_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">m1</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m2</span>', <span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9740')">Proof.</div>
<div class="proofscript" id="proof9740">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">free</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">r</span> <span class="id">n</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">n</span>; <span class="tactic">clear</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">range_perm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">v0</span> <span class="id">n</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">n</span>; <span class="tactic">clear</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">valid_access</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v0</span>; <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">range_perm</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H0</span>; <span class="tactic">intros</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="unbuffer_safe_mem_access_same_stable">unbuffer_safe_mem_access_same_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bfs</span> <span class="id">m1</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOMemLemmas.html#bfs">bfs</a></span>; <span class="id">memory</span> := <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> |} -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> = <span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOMemLemmas.html#bfs">bfs</a></span>; <span class="id">memory</span> := <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> |}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9741')">Proof.</div>
<div class="proofscript" id="proof9741">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">remember</span> ({| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id">bfs</span>; <span class="id">memory</span> := <span class="id">m1</span> |}) <span class="kwd">as</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">m1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">m2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">bfs</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">H</span>; <span class="id">simpls</span>; <span class="tactic">intros</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">intros</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ABIS</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">m1</span>' <span class="id">H1</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#mem_access_eq_apply_buf_item_stable">mem_access_eq_apply_buf_item_stable</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ABIS</span> <span class="kwd">in</span> <span class="id">Ht</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ht</span> <span class="kwd">as</span> [<span class="id">m</span>'' <span class="id">Ht</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">m</span>' <span class="id">to</span> <span class="id">m2</span>', <span class="id">m</span>'' <span class="id">to</span> <span class="id">m1</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hmem_access</span> : <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buf_item_maccess_eq_still">apply_buf_item_maccess_eq_still</a></span> <span class="kwd">in</span> <span class="id">Hmem_access</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">unbuffer_safe_storev_still</span>' :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tm</span> <span class="id">t</span> <span class="id">c</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span>' <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">t</span>, ~ (<span class="id">exists</span> <span class="id">ofs</span>, <span class="id"><a href="TSOMem.html#in_buffer">in_buffer</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span>) <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> <span class="id">m</span>', <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span>) <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id">v</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#BufferedStore">BufferedStore</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">memory</span> := <span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span> |}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9742')">Proof.</div>
<div class="proofscript" id="proof9742">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">H1</span>; <span class="id">simpls</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">intros</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t0</span>); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tso</span> <span class="id">t0</span>) <span class="id">eqn</span>:?; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#store_store_other_val">store_store_other_val</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ABIS</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#in_tbf_upd_oth_stillin">in_tbf_upd_oth_stillin</a></span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t0</span>); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tso</span> <span class="id">t0</span>) <span class="id">eqn</span>:?; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_tid_eq">tupdate_same_tid_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_eq">tupdate_same_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tso</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">memory</span> := <span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">tso</span> |}).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#unbuffer_safe_mem_access_same_stable">unbuffer_safe_mem_access_same_stable</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H3</span>; <span class="id">unfolds</span> <span class="id">store</span>; <span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H3</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_tid_eq">tupdate_same_tid_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">Heqb1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span> <span class="kwd">in</span> <span class="id">Heqb1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_tid_eq">tupdate_same_tid_eq</a></span> <span class="kwd">in</span> <span class="id">Heqb1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 : <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span> <span class="id">Heqb1</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">ofs</span> <span class="id">H0</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H</span> <span class="id">t</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">ofs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">tupdate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqb1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>; <span class="id">econstructor</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span> <span class="id">H3</span> <span class="id">H0</span> <span class="id">Heqb1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">m</span>'' <span class="id">H0</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#not_in_buf_item_apply_store_stable">not_in_buf_item_apply_store_stable</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H</span> <span class="id">t0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqb1</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">clear</span> - <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">ofs</span> <span class="id">H0</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">ofs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#in_tbf_upd_oth_stillin">in_tbf_upd_oth_stillin</a></span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#in_tbf_upd_oth_stillin">in_tbf_upd_oth_stillin</a></span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_tid_neq_twice_rev">tupdate_tid_neq_twice_rev</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span> <span class="id">H2</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">ofs</span> <span class="id">H0</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">tupdate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H</span> <span class="id">t0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">ofs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>; <span class="id">econstructor</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H</span> <span class="id">t1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">ofs</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">m</span>'' <span class="id">H0</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#not_in_buf_item_apply_store_stable">not_in_buf_item_apply_store_stable</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H</span> <span class="id">t0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">ofs</span> <span class="id">H0</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">ofs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
&nbsp;&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="unbuffer_safe_storev_still">unbuffer_safe_storev_still</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tm</span> <span class="id">fm</span> <span class="id">c</span> <span class="id">t</span> <span class="id">fl</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span> <span class="id">bm</span> <span class="id">v</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">t</span>, ~ (<span class="id">exists</span> <span class="id">ofs</span>, <span class="id"><a href="TSOMem.html#in_buffer">in_buffer</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span>) <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span>) <span class="id"><a href="TSOMemLemmas.html#fl">fl</a></span> <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> <span class="id">m</span>', <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span>) <span class="id"><a href="TSOMemLemmas.html#b">b</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Integers.html#Ptrofs.unsigned">Ptrofs.unsigned</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span>)) <span class="id">v</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tsostorev">tsostorev</a></span> <span class="id"><a href="TSOMemLemmas.html#c">c</a></span> {| <span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span> := <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span>; <span class="id">fmemory</span> := <span class="id"><a href="TSOMemLemmas.html#fm">fm</a></span> |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span>)) <span class="id"><a href="TSOMemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#bm">bm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span> (<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bm">bm</a></span>) (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">memory</span> := <span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id"><a href="TSOMemLemmas.html#bm">bm</a></span>) |}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9743')">Proof.</div>
<div class="proofscript" id="proof9743">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">tsostorev</span>, <span class="id">tsostore</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">unbuffer_safe_storev_still</span>'; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">embed_appply_buffer_update_not_in_freelist_stable</span>' :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">bi</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">m1</span> <span class="id">m2</span> <span class="id">fm1</span> <span class="id">fl</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">n</span>, <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> = <span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> <span class="id"><a href="TSOMemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOMemLemmas.html#hi">hi</a></span> -&gt; <span class="id"><a href="TSOMemLemmas.html#b">b</a></span> &lt;&gt; <span class="id"><a href="MemAux.html#get_block">get_block</a></span> <span class="id"><a href="TSOMemLemmas.html#fl">fl</a></span> <span class="id"><a href="TSOMemLemmas.html#n">n</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOMemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> -&gt; <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id"><a href="TSOMemLemmas.html#m1">m1</a></span> <span class="id"><a href="TSOMemLemmas.html#fl">fl</a></span> <span class="id"><a href="TSOMemLemmas.html#fm1">fm1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMemLemmas.html#bf">bf</a></span> <span class="id">m</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">fm2</span>, <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id"><a href="TSOMemLemmas.html#m2">m2</a></span> <span class="id"><a href="TSOMemLemmas.html#fl">fl</a></span> <span class="id">fm2</span> /\ <span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id"><a href="TSOMemLemmas.html#fm1">fm1</a></span> = <span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id">fm2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9744')">Proof.</div>
<div class="proofscript" id="proof9744">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>; <span class="id">simpls</span>.<br/>
<div class="doc">alloc </div>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="kwd">forall</span> <span class="id">n</span>, <span class="id">b</span> &lt;&gt; <span class="id"><a href="MemAux.html#get_block">get_block</a></span> <span class="id">fl</span> <span class="id"><a href="TSOMemLemmas.html#n">n</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="FMemory.html#Mem.mkmem">Mem.mkmem</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id">m2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="FMemory.html#Mem.freelist">Mem.freelist</a></span> <span class="id">fm1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="FMemory.html#Mem.nextblockid">Mem.nextblockid</a></span> <span class="id">fm1</span>) <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#strip">strip</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#gmem_eq">gmem_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Unshelve</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fm1</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fm1</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd</span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Ht</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#in_valid_block_not_in_free_list_cons_still">in_valid_block_not_in_free_list_cons_still</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> (<span class="id">b0</span> := <span class="id">b</span>) (<span class="id">m1</span> := <span class="id">m</span>) <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">eauto</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1 := 0); <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd</span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Ht</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#in_valid_block_cons_still">in_valid_block_cons_still</a></span> <span class="kwd">with</span> (<span class="id">m1</span> := <span class="id">m</span>); <span class="tactic">eauto</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1 := 0); <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m2</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m2</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m2</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
<div class="doc">store </div>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">free</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">unchecked_free</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="FMemory.html#Mem.mkmem">Mem.mkmem</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id">m2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="FMemory.html#Mem.freelist">Mem.freelist</a></span> <span class="id">fm1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="FMemory.html#Mem.nextblockid">Mem.nextblockid</a></span> <span class="id">fm1</span>) <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#strip">strip</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#gmem_eq">gmem_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Unshelve</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">destruct</span> <span class="id">fm1</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">destruct</span> <span class="id">fm1</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd</span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#in_valid_block_eq_apply_same_buf_still">in_valid_block_eq_apply_same_buf_still</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd</span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Ht</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#in_valid_block_eq_apply_same_buf_still">in_valid_block_eq_apply_same_buf_still</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m2</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m2</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m2</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
<div class="doc">free </div>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="FMemory.html#Mem.mkmem">Mem.mkmem</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id">m2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="FMemory.html#Mem.freelist">Mem.freelist</a></span> <span class="id">fm1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="FMemory.html#Mem.nextblockid">Mem.nextblockid</a></span> <span class="id">fm1</span>) <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#strip">strip</a></span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#gmem_eq">gmem_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Unshelve</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">destruct</span> <span class="id">fm1</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">destruct</span> <span class="id">fm1</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd</span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#in_valid_block_eq_apply_same_buf_still">in_valid_block_eq_apply_same_buf_still</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd</span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Ht</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#in_valid_block_eq_apply_same_buf_still">in_valid_block_eq_apply_same_buf_still</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m2</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m2</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m2</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="unbuffer_safe_noalloc_noperm_not_inbuffer">unbuffer_safe_noalloc_noperm_not_inbuffer</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tm</span> <span class="id">L</span> <span class="id">ofs</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">t</span>, ~ (<span class="id">exists</span> <span class="id">lo</span> <span class="id">hi</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id">lo</span> <span class="id">hi</span>) (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span>))) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">p</span> <span class="id">k</span>, ~ <span class="id"><a href="GMemory.html#GMem.perm">GMem.perm</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span>) <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOMemLemmas.html#k">k</a></span> <span class="id"><a href="TSOMemLemmas.html#p">p</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="TSOMem.html#in_buffer">in_buffer</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOMemLemmas.html#tm">tm</a></span> <span class="id"><a href="TSOMemLemmas.html#t">t</a></span>) <span class="id"><a href="TSOMemLemmas.html#L">L</a></span> <span class="id"><a href="TSOMemLemmas.html#ofs">ofs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9745')">Proof.</div>
<div class="proofscript" id="proof9745">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">L</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">ofs</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">H</span>; <span class="id">simpls</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tso</span> <span class="id">t</span>) <span class="id">eqn</span>:?; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Happly_buf</span> : <span class="id">Heqb</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ABIS</span> <span class="kwd">in</span> <span class="id">Happly_buf</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Happly_buf</span> <span class="kwd">as</span> [<span class="id">m</span>' <span class="id">Happly_buf</span>].<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hcons</span> : <span class="id">Heqb</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Hcons</span>.<br/>
&nbsp;&nbsp;2 : <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">Focus</span> 2.<br/>
&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id">L</span>). <br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H0</span> <span class="id">Heqb</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">lo</span> &amp; <span class="id">hi</span> &amp; <span class="id">H</span>).<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">tupdate</span>. <br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H0</span> <span class="id">t</span>).<br/>
&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqb</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H0</span> <span class="id">t0</span>).<br/>
&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">Hcons</span>.<br/>
&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id">t</span>). <br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Heqb</span> <span class="id">H2</span> <span class="id">Happly_buf</span> <span class="id">H1</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> ((<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">tso</span>)) !! <span class="id">L</span> <span class="id">ofs</span> <span class="id"><a href="Memperm.html#Max">Max</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>).<br/>
&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">GMem.perm</span>, <span class="id">perm_order</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H1</span> <span class="id"><a href="Memperm.html#Nonempty">Nonempty</a></span> <span class="id"><a href="Memperm.html#Max">Max</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}  <br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>; <span class="id">simpls</span>. <br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H0</span> <span class="id">t</span>).<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqb</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">free</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">range_perm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">r</span> <span class="kwd">in</span> <span class="id">H8</span>.  <br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H8</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H8</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Happly_buf</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">valid_access</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v0</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">range_perm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">r</span> <span class="kwd">in</span> <span class="id">H9</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H9</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.perm_order</span>'.<br/>
&nbsp;&nbsp;<span class="id">tryfalse</span>.<br/>
&nbsp;<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">b</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">b</span> &lt;&gt; <span class="id">L</span>).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H0</span> <span class="id">t</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hcons</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H1</span> <span class="id">Happly_buf</span> <span class="id">H3</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Happly_buf</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H1</span> <span class="id">p</span> <span class="id">k</span>).<br/>
&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H3</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">GMem.perm</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span> <span class="kwd">in</span> <span class="id">H3</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Happly_buf</span> <span class="id">H1</span> <span class="id">Happly_buf</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">free</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Happly_buf</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">range_perm</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">unchecked_free</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">GMem.perm</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> <span class="id">b</span> <span class="id">L</span>); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span> <span class="kwd">in</span> <span class="id">H3</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Happly_buf</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">GMem.perm</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
</div>
<div class="footer"><hr/>Generated by coq2html</div>
</body>
</html>
