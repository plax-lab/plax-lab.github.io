<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module TSOSemLemmas</title>
<meta name="description" content="Documentation of Coq module TSOSemLemmas" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module TSOSemLemmas</h1>
<div class="coq">
<span class="id">From</span> <span class="id">mathcomp.ssreflect</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">fintype</span> <span class="id">ssrnat</span>.    <br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Coqlib.html">Coqlib</a></span> <span class="id"><a href="Maps.html">Maps</a></span> <span class="id"><a href="Axioms.html">Axioms</a></span> <span class="id"><a href="LibTactics.html">LibTactics</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="AST.html">AST</a></span> <span class="id"><a href="Integers.html">Integers</a></span> <span class="id"><a href="Floats.html">Floats</a></span> <span class="id"><a href="Values.html">Values</a></span> <span class="id"><a href="Events.html">Events</a></span> <span class="id"><a href="Globalenvs.html">Globalenvs</a></span> <span class="id"><a href="Smallstep.html">Smallstep</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Locations.html">Locations</a></span> <span class="id"><a href="Stacklayout.html">Stacklayout</a></span> <span class="id"><a href="Conventions.html">Conventions</a></span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="CUAST.html">CUAST</a></span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Footprint.html">Footprint</a></span> <span class="id"><a href="GMemory.html">GMemory</a></span> <span class="id"><a href="FMemory.html">FMemory</a></span> <span class="id"><a href="TSOMem.html">TSOMem</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="GAST.html">GAST</a></span> <span class="id"><a href="GlobDefs.html">GlobDefs</a></span> <span class="id"><a href="ETrace.html">ETrace</a></span> <span class="id"><a href="Blockset.html">Blockset</a></span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Languages.html">Languages</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="GlobSemantics.html">GlobSemantics</a></span> <span class="id"><a href="TSOGlobSem.html">TSOGlobSem</a></span> <span class="id"><a href="RGRels.html">RGRels</a></span> <span class="id"><a href="ClientSim.html">ClientSim</a></span> <span class="id"><a href="ObjectSim.html">ObjectSim</a></span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="ASM_local.html">ASM_local</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="AsmLang.html">AsmLang</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="AsmTSO.html">AsmTSO</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="InteractionSemantics.html">InteractionSemantics</a></span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="FMemLemmas.html">FMemLemmas</a></span> <span class="id"><a href="TSOMemLemmas.html">TSOMemLemmas</a></span> <span class="id"><a href="TSOAuxDefs.html">TSOAuxDefs</a></span> <span class="id"><a href="TSOStepAuxLemmas.html">TSOStepAuxLemmas</a></span>.<br/>
<br/>
<span class="kwd">Local</span> <span class="id">Transparent</span> <span class="id"><a href="FMemory.html#Mem.load">Mem.load</a></span> <span class="id"><a href="FMemory.html#Mem.alloc">Mem.alloc</a></span> <span class="id"><a href="FMemory.html#Mem.store">Mem.store</a></span> <span class="id"><a href="FMemory.html#Mem.free">Mem.free</a></span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="BUFFER">BUFFER</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="fconflict">fconflict</a></span> <span class="id">bi1</span> <span class="id">bi2</span>:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">fp1</span> := <span class="id"><a href="TSOMem.html#bi_footprint">bi_footprint</a></span> <span class="id"><a href="TSOSemLemmas.html#bi1">bi1</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">fp2</span> := <span class="id"><a href="TSOMem.html#bi_footprint">bi_footprint</a></span> <span class="id"><a href="TSOSemLemmas.html#bi2">bi2</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="TSOSemLemmas.html#bi1">bi1</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="TSOMem.html#BufferedStore">BufferedStore</a></span> <span class="id">chunk</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">_</span> =&gt; <span class="kwd">match</span> <span class="id"><a href="TSOSemLemmas.html#bi2">bi2</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id">b2</span> <span class="id">lo</span> <span class="id">hi</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Footprint.html#FP.conflict">FP.conflict</a></span> <span class="id"><a href="TSOSemLemmas.html#fp1">fp1</a></span> <span class="id"><a href="TSOSemLemmas.html#fp2">fp2</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="Footprint.html#Locs.subset">Locs.subset</a></span> (<span class="id"><a href="FMemOpFP.html#range_locset">FMemOpFP.range_locset</a></span> <span class="id">b</span> <span class="id">ofs</span> (<span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id">chunk</span>))(<span class="id"><a href="FMemOpFP.html#range_locset">FMemOpFP.range_locset</a></span> <span class="id">b2</span> <span class="id">lo</span> (<span class="id">hi</span> - <span class="id">lo</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="TSOMem.html#BufferedFree">BufferedFree</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id"><a href="Footprint.html#FP.conflict">FP.conflict</a></span> <span class="id"><a href="TSOSemLemmas.html#fp1">fp1</a></span> <span class="id"><a href="TSOSemLemmas.html#fp2">fp2</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="TSOMem.html#BufferedFree">BufferedFree</a></span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span> =&gt; <span class="id"><a href="Footprint.html#FP.conflict">FP.conflict</a></span> <span class="id"><a href="TSOSemLemmas.html#fp1">fp1</a></span> <span class="id"><a href="TSOSemLemmas.html#fp2">fp2</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="TSOSemLemmas.html#bi2">bi2</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id">b2</span> <span class="id">lo2</span> <span class="id">hi2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="Footprint.html#Locs.subset">Locs.subset</a></span> (<span class="id"><a href="FMemOpFP.html#range_locset">FMemOpFP.range_locset</a></span> <span class="id">b</span> <span class="id">lo</span> (<span class="id">hi</span> - <span class="id">lo</span>))(<span class="id"><a href="FMemOpFP.html#range_locset">FMemOpFP.range_locset</a></span> <span class="id">b2</span> <span class="id">lo2</span> (<span class="id">hi2</span>-<span class="id">lo2</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span> =&gt; <span class="kwd">match</span> <span class="id"><a href="TSOSemLemmas.html#bi2">bi2</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="TSOMem.html#BufferedFree">BufferedFree</a></span> <span class="id">b2</span> <span class="id">lo2</span> <span class="id">hi2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Footprint.html#FP.conflict">FP.conflict</a></span> <span class="id"><a href="TSOSemLemmas.html#fp1">fp1</a></span> <span class="id"><a href="TSOSemLemmas.html#fp2">fp2</a></span> /\ ~ <span class="id"><a href="Footprint.html#Locs.subset">Locs.subset</a></span> (<span class="id"><a href="FMemOpFP.html#range_locset">FMemOpFP.range_locset</a></span> <span class="id">b2</span> <span class="id">lo2</span> (<span class="id">hi2</span>-<span class="id">lo2</span>))(<span class="id"><a href="FMemOpFP.html#range_locset">FMemOpFP.range_locset</a></span> <span class="id">b</span> <span class="id">lo</span> (<span class="id">hi</span>-<span class="id">lo</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="TSOMem.html#BufferedStore">BufferedStore</a></span> <span class="id">chunk</span> <span class="id">b2</span> <span class="id">ofs</span> <span class="id">_</span> =&gt; <span class="id"><a href="Footprint.html#FP.conflict">FP.conflict</a></span> <span class="id"><a href="TSOSemLemmas.html#fp1">fp1</a></span> <span class="id"><a href="TSOSemLemmas.html#fp2">fp2</a></span> /\ ~ <span class="id"><a href="Footprint.html#Locs.subset">Locs.subset</a></span> (<span class="id"><a href="FMemOpFP.html#range_locset">FMemOpFP.range_locset</a></span> <span class="id">b2</span> <span class="id">ofs</span> (<span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id">chunk</span>))(<span class="id"><a href="FMemOpFP.html#range_locset">FMemOpFP.range_locset</a></span> <span class="id">b</span> <span class="id">lo</span> (<span class="id">hi</span>-<span class="id">lo</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="fpsmile_nfconflict">fpsmile_nfconflict</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi1</span> <span class="id">bi2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Footprint.html#FP.smile">FP.smile</a></span> (<span class="id"><a href="TSOMem.html#bi_footprint">bi_footprint</a></span> <span class="id"><a href="TSOSemLemmas.html#bi1">bi1</a></span>)(<span class="id"><a href="TSOMem.html#bi_footprint">bi_footprint</a></span> <span class="id"><a href="TSOSemLemmas.html#bi2">bi2</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="TSOSemLemmas.html#fconflict">fconflict</a></span> <span class="id"><a href="TSOSemLemmas.html#bi1">bi1</a></span> <span class="id"><a href="TSOSemLemmas.html#bi2">bi2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10020')">Proof.</div>
<div class="proofscript" id="proof10020">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Footprint.html#FP.smile_conflict_compat">FP.smile_conflict_compat</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>;<span class="id">contradict</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#fconflict">fconflict</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="id">Hsimpl</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="fpsmile_nfconflict_2">fpsmile_nfconflict_2</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span> <span class="id">bf</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Footprint.html#FP.smile">FP.smile</a></span> (<span class="id"><a href="TSOMem.html#bi_footprint">bi_footprint</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span>)(<span class="id"><a href="TSOAuxDefs.html#bf_footprint">bf_footprint</a></span> <span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">bi</span>' <span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="TSOSemLemmas.html#fconflict">fconflict</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id">bi</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10021')">Proof.</div>
<div class="proofscript" id="proof10021">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#fpsmile_nfconflict">fpsmile_nfconflict</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">eapply</span> <span class="id"><a href="FPLemmas.html#fpsmile_union_elim">FPLemmas.fpsmile_union_elim</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">eapply</span> <span class="id">IHbf</span>;<span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="FPLemmas.html#fpsmile_union_elim2">FPLemmas.fpsmile_union_elim2</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="fpsmile_nfconflict_3">fpsmile_nfconflict_3</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf1</span> <span class="id">bf2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Footprint.html#FP.smile">FP.smile</a></span> (<span class="id"><a href="TSOAuxDefs.html#bf_footprint">bf_footprint</a></span> <span class="id"><a href="TSOSemLemmas.html#bf1">bf1</a></span>)(<span class="id"><a href="TSOAuxDefs.html#bf_footprint">bf_footprint</a></span> <span class="id"><a href="TSOSemLemmas.html#bf2">bf2</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span> <span class="id">bi</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#bf1">bf1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">bi</span>' <span class="id"><a href="TSOSemLemmas.html#bf2">bf2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="TSOSemLemmas.html#fconflict">fconflict</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id">bi</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10022')">Proof.</div>
<div class="proofscript" id="proof10022">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf1</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#fpsmile_nfconflict_2">fpsmile_nfconflict_2</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FPLemmas.html#fpsmile_sym">FPLemmas.fpsmile_sym</a></span>. <span class="tactic">apply</span> <span class="id"><a href="FPLemmas.html#fpsmile_sym">FPLemmas.fpsmile_sym</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="FPLemmas.html#fpsmile_union_elim">FPLemmas.fpsmile_union_elim</a></span>;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf1</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FPLemmas.html#fpsmile_sym">FPLemmas.fpsmile_sym</a></span>. <span class="tactic">apply</span> <span class="id"><a href="FPLemmas.html#fpsmile_sym">FPLemmas.fpsmile_sym</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="FPLemmas.html#fpsmile_union_elim2">FPLemmas.fpsmile_union_elim2</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="fconflict_comm">fconflict_comm</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi1</span> <span class="id">bi2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#fconflict">fconflict</a></span> <span class="id"><a href="TSOSemLemmas.html#bi1">bi1</a></span> <span class="id"><a href="TSOSemLemmas.html#bi2">bi2</a></span> -&gt; <span class="id"><a href="TSOSemLemmas.html#fconflict">fconflict</a></span> <span class="id"><a href="TSOSemLemmas.html#bi2">bi2</a></span> <span class="id"><a href="TSOSemLemmas.html#bi1">bi1</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10023')">Proof.</div>
<div class="proofscript" id="proof10023">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#fconflict">fconflict</a></span>;<span class="tactic">intros</span>;<span class="id">ex_match2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="id">Hsimpl</span>;<span class="id">Esimpl</span>;<span class="tactic">auto</span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="Footprint.html#FP.conflict_sym">FP.conflict_sym</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="nfconflict_comm">nfconflict_comm</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi1</span> <span class="id">bi2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~<span class="id"><a href="TSOSemLemmas.html#fconflict">fconflict</a></span> <span class="id"><a href="TSOSemLemmas.html#bi1">bi1</a></span> <span class="id"><a href="TSOSemLemmas.html#bi2">bi2</a></span> -&gt; ~<span class="id"><a href="TSOSemLemmas.html#fconflict">fconflict</a></span> <span class="id"><a href="TSOSemLemmas.html#bi2">bi2</a></span> <span class="id"><a href="TSOSemLemmas.html#bi1">bi1</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10024')">Proof.</div>
<div class="proofscript" id="proof10024">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<span class="tactic">intro</span>;<span class="id">contradict</span> <span class="id">H</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#fconflict_comm">fconflict_comm</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="apply_buffer_item_fconflict">apply_buffer_item_fconflict</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi1</span> <span class="id">bi2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="TSOSemLemmas.html#fconflict">fconflict</a></span> <span class="id"><a href="TSOSemLemmas.html#bi1">bi1</a></span> <span class="id"><a href="TSOSemLemmas.html#bi2">bi2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m1</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOSemLemmas.html#bi1">bi1</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOSemLemmas.html#bi2">bi2</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m</span>', <span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOSemLemmas.html#bi2">bi2</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10025')">Proof.</div>
<div class="proofscript" id="proof10025">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi2</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#not_and_or">Classical_Prop.not_and_or</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Footprint.html#FP.smile_conflict_compat">FP.smile_conflict_compat</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#apply_buf_item_MemEffect">apply_buf_item_MemEffect</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#MemEffect_fpsmile_MemPre_Rule">MemEffect_fpsmile_MemPre_Rule</a></span> <span class="kwd">in</span> <span class="id">H0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#MemPre_comm">MemPre_comm</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#buf_item_unbuf_locality_1">buf_item_unbuf_locality_1</a></span> <span class="kwd">in</span> <span class="id">H0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#NNPP">Classical_Prop.NNPP</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#free">free</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Hx0</span> <span class="id">Hx</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradict</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">r</span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> ?;<span class="tactic">clear</span> <span class="id">r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">z</span>&lt;=<span class="id">ofs</span>&lt;<span class="id">z</span>+(<span class="id">z0</span>-<span class="id">z</span>)). <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="FMemLemmas.html#range_locset_belongsto2">range_locset_belongsto2</a></span> <span class="kwd">with</span>(<span class="id">b</span>:=<span class="id">b</span>) <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#belongsto">belongsto</a></span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#range_locset_belongsto">range_locset_belongsto</a></span> <span class="kwd">in</span> <span class="id">H2</span> <span class="kwd">as</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#zle">zle</a></span>,<span class="id"><a href="Coqlib.html#zlt">zlt</a></span>;<span class="tactic">try</span> <span class="tactic">omega</span>;<span class="tactic">simpl</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#not_and_or">Classical_Prop.not_and_or</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Footprint.html#FP.smile_conflict_compat">FP.smile_conflict_compat</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#apply_buf_item_MemEffect">apply_buf_item_MemEffect</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#MemEffect_fpsmile_MemPre_Rule">MemEffect_fpsmile_MemPre_Rule</a></span> <span class="kwd">in</span> <span class="id">H0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#MemPre_comm">MemPre_comm</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#buf_item_unbuf_locality_1">buf_item_unbuf_locality_1</a></span> <span class="kwd">in</span> <span class="id">H0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Footprint.html#FP.smile_conflict_compat">FP.smile_conflict_compat</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#apply_buf_item_MemEffect">apply_buf_item_MemEffect</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#MemEffect_fpsmile_MemPre_Rule">MemEffect_fpsmile_MemPre_Rule</a></span> <span class="kwd">in</span> <span class="id">H0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#MemPre_comm">MemPre_comm</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#buf_item_unbuf_locality_1">buf_item_unbuf_locality_1</a></span> <span class="kwd">in</span> <span class="id">H0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#not_and_or">Classical_Prop.not_and_or</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Footprint.html#FP.smile_conflict_compat">FP.smile_conflict_compat</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#apply_buf_item_MemEffect">apply_buf_item_MemEffect</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#MemEffect_fpsmile_MemPre_Rule">MemEffect_fpsmile_MemPre_Rule</a></span> <span class="kwd">in</span> <span class="id">H0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#MemPre_comm">MemPre_comm</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#buf_item_unbuf_locality_1">buf_item_unbuf_locality_1</a></span> <span class="kwd">in</span> <span class="id">H0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#NNPP">Classical_Prop.NNPP</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Hx0</span> <span class="id">Hx</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradict</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v0</span>;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> ?;<span class="tactic">clear</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">z</span>&lt;=<span class="id">ofs</span>&lt;<span class="id">z</span>+<span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id">m</span>). <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="FMemLemmas.html#range_locset_belongsto2">range_locset_belongsto2</a></span> <span class="kwd">with</span>(<span class="id">b</span>:=<span class="id">b</span>) <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#belongsto">belongsto</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#range_locset_belongsto">range_locset_belongsto</a></span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#zle">zle</a></span>,<span class="id"><a href="Coqlib.html#zlt">zlt</a></span>;<span class="tactic">try</span> <span class="tactic">omega</span>;<span class="tactic">simpl</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#not_and_or">Classical_Prop.not_and_or</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> [];<span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Footprint.html#FP.smile_conflict_compat">FP.smile_conflict_compat</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#apply_buf_item_MemEffect">apply_buf_item_MemEffect</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#MemEffect_fpsmile_MemPre_Rule">MemEffect_fpsmile_MemPre_Rule</a></span> <span class="kwd">in</span> <span class="id">H0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#MemPre_comm">MemPre_comm</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#buf_item_unbuf_locality_1">buf_item_unbuf_locality_1</a></span> <span class="kwd">in</span> <span class="id">H0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="kwd">in</span>*;<span class="id">ex_match2</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Hx</span> <span class="id">Hx1</span> <span class="id">Hx0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradict</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v1</span>,<span class="id">v2</span>. <span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> <span class="kwd">in</span> *;<span class="tactic">simpl</span>;<span class="tactic">intros</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="bi_bf_nfconflict_1">bi_bf_nfconflict_1</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span> <span class="id">bf</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">bi</span>', <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">bi</span>' <span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span> -&gt; ~<span class="id"><a href="TSOSemLemmas.html#fconflict">fconflict</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id">bi</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m1</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m</span>',<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10026')">Proof.</div>
<div class="proofscript" id="proof10026">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="id">inv_some</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#optbind">optbind</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#apply_buffer_item_fconflict">apply_buffer_item_fconflict</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> ?;<span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">Hx</span>;[|<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#nfconflict_comm">nfconflict_comm</a></span>;<span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf</span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H2</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="emp_intersect_locs">emp_intersect_locs</a></span>:<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l</span>, <span class="id"><a href="Footprint.html#Locs.intersect">Locs.intersect</a></span> <span class="id"><a href="Footprint.html#Locs.emp">Locs.emp</a></span> <span class="id"><a href="TSOSemLemmas.html#l">l</a></span> = <span class="id"><a href="Footprint.html#Locs.emp">Locs.emp</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10027')">Proof.</div>
<div class="proofscript" id="proof10027">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Footprint.html#Locs.locs_eq">Locs.locs_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Locs.unfolds</span>. <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">bool</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="add_minus_eq">add_minus_eq</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">a</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#b">b</a></span> = <span class="id"><a href="TSOSemLemmas.html#a">a</a></span> + ( <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> - <span class="id"><a href="TSOSemLemmas.html#a">a</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10028')">Proof.</div>
<div class="proofscript" id="proof10028">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="bi_eff">bi_eff</a></span> <span class="id">bi</span> <span class="id">m</span> <span class="id">m</span>':<span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="TSOMem.html#BufferedStore">BufferedStore</a></span> <span class="id">chunk</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span> =&gt; <span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> = <span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m</span>' /\ <span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> = <span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m</span>' /\ <span class="id"><a href="TSOMem.html#valid_access">valid_access</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id">chunk</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id"><a href="Memperm.html#Writable">Memperm.Writable</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="TSOMem.html#BufferedFree">BufferedFree</a></span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">locs</span>, <span class="id"><a href="Footprint.html#Locs.subset">Locs.subset</a></span> <span class="id">locs</span>  (<span class="id"><a href="FMemOpFP.html#range_locset">FMemOpFP.range_locset</a></span> <span class="id">b</span> <span class="id">lo</span> (<span class="id">hi</span>-<span class="id">lo</span>)) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#unchanged_perm">unchanged_perm</a></span> (<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> <span class="id">locs</span>) <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id">m</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id"><a href="Memperm.html#Max">Memperm.Max</a></span> <span class="id"><a href="Memperm.html#Freeable">Memperm.Freeable</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">b0</span> <span class="id">ofs</span> <span class="id">k</span> <span class="id">p</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="GMemory.html#GMem.perm">GMem.perm</a></span> <span class="id">m</span>' <span class="id"><a href="TSOSemLemmas.html#b0">b0</a></span> <span class="id"><a href="TSOSemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOSemLemmas.html#k">k</a></span> <span class="id"><a href="TSOSemLemmas.html#p">p</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.perm">GMem.perm</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id"><a href="TSOSemLemmas.html#b0">b0</a></span> <span class="id"><a href="TSOSemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOSemLemmas.html#k">k</a></span> <span class="id"><a href="TSOSemLemmas.html#p">p</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#b0">b0</a></span> = <span class="id">b</span> /\ (<span class="id">lo</span> &gt; <span class="id"><a href="TSOSemLemmas.html#ofs">ofs</a></span> \/ <span class="id"><a href="TSOSemLemmas.html#ofs">ofs</a></span> &gt;= <span class="id">hi</span>)) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( <span class="kwd">forall</span> <span class="id">b0</span> <span class="id">ofs</span> <span class="id">k</span> <span class="id">p</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.perm">GMem.perm</a></span> <span class="id">m</span>' <span class="id"><a href="TSOSemLemmas.html#b0">b0</a></span> <span class="id"><a href="TSOSemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOSemLemmas.html#k">k</a></span> <span class="id"><a href="TSOSemLemmas.html#p">p</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="GMemory.html#GMem.perm">GMem.perm</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id"><a href="TSOSemLemmas.html#b0">b0</a></span> <span class="id"><a href="TSOSemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOSemLemmas.html#k">k</a></span> <span class="id"><a href="TSOSemLemmas.html#p">p</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#b0">b0</a></span> = <span class="id">b</span> /\ (<span class="id">lo</span> &lt;= <span class="id"><a href="TSOSemLemmas.html#ofs">ofs</a></span>  &lt; <span class="id">hi</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="bi_eff_applyable">bi_eff_applyable</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span> <span class="id">m</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#bi_eff">bi_eff</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m1</span>, <span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10029')">Proof.</div>
<div class="proofscript" id="proof10029">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#free">free</a></span>;<span class="tactic">intros</span>. <span class="id">Hsimpl</span>. <span class="id">ex_match2</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#store">store</a></span>;<span class="tactic">intros</span>;<span class="id">Hsimpl</span>;<span class="id">ex_match2</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="bi_bi_eff">bi_bi_eff</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span> <span class="id">m</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#bi_eff">bi_eff</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id">m</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10030')">Proof.</div>
<div class="proofscript" id="proof10030">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>;<span class="tactic">simpl</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">inv_some</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.perm">GMem.perm</a></span> <span class="kwd">in</span> *. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">intros</span>; <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span> <span class="kwd">in</span> *;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradict</span> <span class="id">H</span>. <span class="id">constructor</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#zle">zle</a></span>,<span class="id"><a href="Coqlib.html#zlt">zlt</a></span>;<span class="tactic">auto</span>. <span class="id">inv</span> <span class="id">Hx0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#zle">zle</a></span>,<span class="id"><a href="Coqlib.html#zlt">zlt</a></span>;<span class="tactic">auto</span>; <span class="id">inv</span> <span class="id">Hx0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#free_eff">free_eff</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> ?;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>. <span class="tactic">apply</span> <span class="id"><a href="Footprint.html#Locs.subset_refl">Locs.subset_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#free">free</a></span> <span class="kwd">in</span> <span class="id">H</span>;<span class="id">ex_match2</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="kwd">in</span> <span class="id">H</span>;<span class="id">ex_match</span>;<span class="id">inv_some</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="bi_eff_progress">bi_eff_progress</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">bi</span>' <span class="id">m1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#bi_eff">bi_eff</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id">m</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~<span class="id"><a href="TSOSemLemmas.html#fconflict">fconflict</a></span> <span class="id">bi</span>' <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">bi</span>' <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">bi</span>' <span class="id">m</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#bi_eff">bi_eff</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> <span class="id">m2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10031')">Proof.</div>
<div class="proofscript" id="proof10031">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>,<span class="id">bi</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="kwd">in</span> *. <span class="id">inv_some</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.perm">GMem.perm</a></span> <span class="kwd">in</span> *. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>;<span class="tactic">simpl</span>;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span> <span class="kwd">in</span> <span class="id">H1</span>,<span class="id">H2</span>;<span class="id">ex_match2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>,<span class="id">H1</span>|-*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#free">free</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>; <span class="id">inv_some</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unchecked_free">unchecked_free</a></span>,<span class="id"><a href="GMemory.html#GMem.perm">GMem.perm</a></span>;<span class="tactic">simpl</span>;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span> <span class="kwd">in</span> *; <span class="id">ex_match2</span>;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Hx0</span> <span class="id">Hx</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> <span class="kwd">in</span> *;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradict</span> <span class="id">n</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#NNPP">Classical_Prop.NNPP</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">r</span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H2</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradict</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#free_fp">FMemOpFP.free_fp</a></span>,<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">FMemOpFP.uncheck_alloc_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Footprint.html#FP.conflict_ff">FP.conflict_ff</a></span>;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#range_locset">FMemOpFP.range_locset</a></span>;<span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">b</span> <span class="id">ofs</span>. <span class="id">ex_match2</span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#zle">zle</a></span>,<span class="id"><a href="Coqlib.html#zlt">zlt</a></span>;<span class="tactic">auto</span>;<span class="tactic">try</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#range_locset">FMemOpFP.range_locset</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;-!<span class="id"><a href="TSOSemLemmas.html#add_minus_eq">add_minus_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H0</span> <span class="id">b</span> <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>. <span class="tactic">destruct</span> <span class="id">H4</span>,<span class="id"><a href="Coqlib.html#zle">zle</a></span>,<span class="id"><a href="Coqlib.html#zlt">zlt</a></span>,<span class="id"><a href="Coqlib.html#zle">zle</a></span>,<span class="id"><a href="Coqlib.html#zlt">zlt</a></span>;<span class="tactic">try</span> <span class="tactic">omega</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<span class="id">exploit</span> <span class="id">H0</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>,<span class="id">H1</span>|- *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv_some</span>. <span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Hx0</span> <span class="id">Hx</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradict</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v0</span>;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">specialize</span> (<span class="id">H1</span> <span class="id">_</span> <span class="id">H3</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#NNPP">Classical_Prop.NNPP</a></span>;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H4</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradict</span> <span class="id">H0</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#store_fp">FMemOpFP.store_fp</a></span>,<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">FMemOpFP.uncheck_alloc_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Footprint.html#FP.conflict_wf">FP.conflict_wf</a></span>;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> !<span class="id"><a href="TSOSemLemmas.html#emp_intersect_locs">emp_intersect_locs</a></span>,!<span class="id"><a href="Footprint.html#Locs.locs_union_emp">Locs.locs_union_emp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Locs.unfolds</span>. <span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#range_locset">FMemOpFP.range_locset</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">b</span> <span class="id">ofs</span>. <span class="tactic">destruct</span> <span class="id">H5</span>;<span class="tactic">subst</span>. <span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#zle">zle</a></span>,<span class="id"><a href="Coqlib.html#zlt">zlt</a></span>;<span class="tactic">auto</span>;<span class="tactic">try</span> <span class="tactic">omega</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H5</span>;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#range_locset">FMemOpFP.range_locset</a></span> <span class="kwd">in</span> <span class="id">H0</span>;<span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H0</span> <span class="id">b</span> <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#zle">zle</a></span>,<span class="id"><a href="Coqlib.html#zlt">zlt</a></span>,<span class="id"><a href="Coqlib.html#zle">zle</a></span>,<span class="id"><a href="Coqlib.html#zlt">zlt</a></span>;<span class="tactic">try</span> <span class="tactic">omega</span>;<span class="id">exploit</span> <span class="id">H0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>|-*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="kwd">in</span> *;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">x</span>. <span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="id">inv_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span>,<span class="id"><a href="GMemory.html#GMem.perm">GMem.perm</a></span>;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">gmem_unfolds</span>. <span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H4</span>. <span class="tactic">split</span>;<span class="tactic">intros</span>[];<span class="tactic">auto</span>;<span class="id">right</span>;<span class="tactic">apply</span> <span class="id">H4</span>;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> !<span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span>. <span class="id">ex_match2</span>;<span class="tactic">try</span> <span class="tactic">tauto</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradict</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">FMemOpFP.uncheck_alloc_fp</a></span>,<span class="id"><a href="FMemOpFP.html#free_fp">FMemOpFP.free_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Footprint.html#FP.conflict_ff">FP.conflict_ff</a></span>;<span class="tactic">simpl</span>. <span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">b</span> <span class="id">ofs</span>. <span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#range_locset">FMemOpFP.range_locset</a></span>;<span class="id">ex_match2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;-<span class="id"><a href="TSOSemLemmas.html#add_minus_eq">add_minus_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#zle">zle</a></span>,<span class="id"><a href="Coqlib.html#zlt">zlt</a></span>,<span class="id"><a href="Coqlib.html#zle">zle</a></span>,<span class="id"><a href="Coqlib.html#zlt">zlt</a></span>;<span class="tactic">try</span> <span class="tactic">omega</span>;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#range_locset">FMemOpFP.range_locset</a></span>. <span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H0</span> <span class="id">b</span> <span class="id">ofs</span>). <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;-!<span class="id"><a href="TSOSemLemmas.html#add_minus_eq">add_minus_eq</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#zle">zle</a></span>,<span class="id"><a href="Coqlib.html#zlt">zlt</a></span>,<span class="id"><a href="Coqlib.html#zle">zle</a></span>,<span class="id"><a href="Coqlib.html#zlt">zlt</a></span>;<span class="tactic">try</span> <span class="tactic">omega</span>;<span class="id">exploit</span> <span class="id">H0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H3</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#free">free</a></span> <span class="kwd">in</span> *;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">gmem_unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span>! <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span>. <span class="id">ex_match2</span>;<span class="tactic">subst</span>;<span class="tactic">try</span> <span class="tactic">tauto</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unchecked_free">unchecked_free</a></span>,<span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span>. <span class="id">ex_match2</span>;<span class="tactic">eauto</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H3</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#zle">zle</a></span>,<span class="id"><a href="Coqlib.html#zlt">zlt</a></span>;<span class="tactic">try</span> <span class="tactic">omega</span>;<span class="id">inv</span> <span class="id">Hx2</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradict</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#free_fp">FMemOpFP.free_fp</a></span>;<span class="tactic">apply</span> <span class="id"><a href="Footprint.html#FP.conflict_ff">FP.conflict_ff</a></span>;<span class="tactic">simpl</span>;<span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">b0</span> <span class="id">ofs</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_iff">andb_true_iff</a></span>;<span class="tactic">split</span>;<span class="tactic">auto</span>;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#range_locset">FMemOpFP.range_locset</a></span>;<span class="id">ex_match2</span>;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="TSOSemLemmas.html#add_minus_eq">add_minus_eq</a></span>;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#zle">zle</a></span>,<span class="id"><a href="Coqlib.html#zlt">zlt</a></span>;<span class="tactic">try</span> <span class="tactic">omega</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Hx0</span> <span class="id">H1</span> <span class="id">Hx</span>. <span class="id">contradict</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> <span class="kwd">in</span> *. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">r</span> <span class="id">_</span> <span class="id">H1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H3</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span> <span class="id">eqn</span>:?;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradict</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Footprint.html#FP.conflict_ff">FP.conflict_ff</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#free_fp">FMemOpFP.free_fp</a></span>;<span class="tactic">simpl</span>;<span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Heqt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="id">eexists</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_iff">andb_true_iff</a></span>;<span class="tactic">split</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#range_locset">FMemOpFP.range_locset</a></span>;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="TSOSemLemmas.html#add_minus_eq">add_minus_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#zle">zle</a></span>,<span class="id"><a href="Coqlib.html#zlt">zlt</a></span>;<span class="tactic">try</span> <span class="tactic">omega</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Hx0</span> <span class="id">Hx</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradict</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">v0</span>;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H5</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H3</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span> <span class="id">eqn</span>:?;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradict</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#store_fp">FMemOpFP.store_fp</a></span>,<span class="id"><a href="FMemOpFP.html#free_fp">FMemOpFP.free_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Footprint.html#FP.conflict_wf">FP.conflict_wf</a></span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> !<span class="id"><a href="TSOSemLemmas.html#emp_intersect_locs">emp_intersect_locs</a></span>,<span class="id"><a href="Footprint.html#Locs.locs_union_emp">Locs.locs_union_emp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Locs.unfolds</span>. <span class="tactic">apply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Heqt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="id">eexists</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_iff">andb_true_iff</a></span>. <span class="tactic">split</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#range_locset">FMemOpFP.range_locset</a></span>;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#zle">zle</a></span>,<span class="id"><a href="Coqlib.html#zlt">zlt</a></span>;<span class="tactic">try</span> <span class="tactic">omega</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>;<span class="tactic">simpl</span>;<span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H3</span>;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span>;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H4</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span>. <span class="id">ex_match2</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="id">contradict</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">FMemOpFP.uncheck_alloc_fp</a></span>,<span class="id"><a href="FMemOpFP.html#store_fp">FMemOpFP.store_fp</a></span>;<span class="tactic">apply</span> <span class="id"><a href="Footprint.html#FP.conflict_wf">FP.conflict_wf</a></span>;<span class="tactic">simpl</span>;<span class="tactic">rewrite</span> !<span class="id"><a href="TSOSemLemmas.html#emp_intersect_locs">emp_intersect_locs</a></span>,!<span class="id"><a href="Footprint.html#Locs.emp_union_locs">Locs.emp_union_locs</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Locs.unfolds</span>. <span class="id">exists</span> <span class="id">b0</span> <span class="id">ofs</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_iff">andb_true_iff</a></span>;<span class="tactic">split</span>. <span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#range_locset">FMemOpFP.range_locset</a></span>. <span class="id">ex_match2</span>. <span class="tactic">clear</span> <span class="id">Hx0</span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#zle">zle</a></span>,<span class="id"><a href="Coqlib.html#zlt">zlt</a></span>;<span class="tactic">try</span> <span class="tactic">omega</span>;<span class="tactic">auto</span>. <span class="id">ex_match2</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#range_locset">FMemOpFP.range_locset</a></span>. <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Locs.unfolds</span>. <span class="id">specialize</span> (<span class="id">H0</span> <span class="id">b0</span> <span class="id">ofs</span>). <span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="TSOSemLemmas.html#add_minus_eq">add_minus_eq</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="Coqlib.html#zle">zle</a></span> <span class="id">z0</span> <span class="id">ofs</span> &amp;&amp; <span class="id"><a href="Coqlib.html#zlt">zlt</a></span> <span class="id">ofs</span> <span class="id">z1</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H0</span>. <span class="tactic">clear</span> <span class="id">H0</span> <span class="id">Hx0</span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#zle">zle</a></span>,<span class="id"><a href="Coqlib.html#zlt">zlt</a></span>;<span class="tactic">auto</span>;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#free">free</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unchecked_free">unchecked_free</a></span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">H</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H3</span>;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unchecked_free">unchecked_free</a></span>,<span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span>;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H4</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span>;<span class="id">ex_match2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="id">contradict</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Footprint.html#FP.conflict_wf">FP.conflict_wf</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#store_fp">FMemOpFP.store_fp</a></span>,<span class="id"><a href="FMemOpFP.html#free_fp">FMemOpFP.free_fp</a></span>,<span class="id"><a href="FMemOpFP.html#range_locset">FMemOpFP.range_locset</a></span>;<span class="tactic">simpl</span>;<span class="tactic">rewrite</span> !<span class="id"><a href="TSOSemLemmas.html#emp_intersect_locs">emp_intersect_locs</a></span>,!<span class="id"><a href="Footprint.html#Locs.emp_union_locs">Locs.emp_union_locs</a></span>. <span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">b0</span> <span class="id">ofs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>. <span class="tactic">rewrite</span> &lt;-<span class="id"><a href="TSOSemLemmas.html#add_minus_eq">add_minus_eq</a></span>,<span class="id">Hx2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Hx2</span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#zle">zle</a></span>,<span class="id"><a href="Coqlib.html#zlt">zlt</a></span>;<span class="tactic">auto</span>;<span class="tactic">try</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Hx</span> <span class="id">Hx0</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradict</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;-<span class="id">H</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="kwd">in</span> *. <span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv_some</span>. <span class="id">Esimpl</span>;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H1</span> <span class="id">Hx</span> <span class="id">Hx0</span>. <span class="id">contradict</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v1</span>;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> <span class="kwd">in</span> *;<span class="tactic">rewrite</span> &lt;- <span class="id">H</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="bi_eff_progress2">bi_eff_progress2</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">bi</span>' <span class="id">m1</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#bi_eff">bi_eff</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id">m</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~<span class="id"><a href="TSOSemLemmas.html#fconflict">fconflict</a></span> <span class="id">bi</span>' <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">bi</span>' <span class="id">m</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">bi</span>' <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#bi_eff">bi_eff</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10032')">Proof.</div>
<div class="proofscript" id="proof10032">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#bi_eff_progress">bi_eff_progress</a></span> <span class="kwd">in</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>. <span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H</span>;<span class="id">inv_some</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="bi_eff_star_progress">bi_eff_star_progress</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">bi</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">m1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#bi_eff">bi_eff</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">bi</span>', <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">bi</span>' <span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span> -&gt; ~<span class="id"><a href="TSOSemLemmas.html#fconflict">fconflict</a></span> <span class="id">bi</span>' <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m2</span>, <span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span> <span class="id">m</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#bi_eff">bi_eff</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> <span class="id">m2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10033')">Proof.</div>
<div class="proofscript" id="proof10033">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>;<span class="tactic">intros</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv_some</span>. <span class="id">Esimpl</span>;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#optbind">optbind</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#bi_eff_progress">bi_eff_progress</a></span> <span class="kwd">in</span> <span class="id">Hx</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf</span> <span class="kwd">in</span> <span class="id">H3</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="bi_bf_nfconflict_2">bi_bf_nfconflict_2</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span> <span class="id">bf</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">bi</span>', <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">bi</span>' <span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span> -&gt; ~<span class="id"><a href="TSOSemLemmas.html#fconflict">fconflict</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id">bi</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m1</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m</span>',<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10034')">Proof.</div>
<div class="proofscript" id="proof10034">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#bi_bi_eff">bi_bi_eff</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#bi_eff_star_progress">bi_eff_star_progress</a></span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#nfconflict_comm">nfconflict_comm</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="buffer_safe_exchangable_nfconflict">buffer_safe_exchangable_nfconflict</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">bi1</span> <span class="id">bi2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> (<span class="id"><a href="TSOSemLemmas.html#bi1">bi1</a></span>::<span class="id"><a href="TSOSemLemmas.html#bi2">bi2</a></span>::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> (<span class="id"><a href="TSOSemLemmas.html#bi2">bi2</a></span>::<span class="id"><a href="TSOSemLemmas.html#bi1">bi1</a></span>::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="TSOSemLemmas.html#fconflict">fconflict</a></span> <span class="id"><a href="TSOSemLemmas.html#bi1">bi1</a></span> <span class="id"><a href="TSOSemLemmas.html#bi2">bi2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10035')">Proof.</div>
<div class="proofscript" id="proof10035">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi1</span> <span class="id">eqn</span>:?,<span class="id">bi2</span> <span class="id">eqn</span>:?;<span class="tactic">simpl</span>;<span class="tactic">auto</span>;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span>,<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span>,<span class="id"><a href="TSOMem.html#optbind">optbind</a></span>;<span class="tactic">simpl</span>;<span class="tactic">intros</span>;<span class="id">ex_match2</span>;<span class="id">Hsimpl</span>;<span class="tactic">repeat</span> <span class="id">inv_some</span>;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#free">free</a></span>,<span class="id"><a href="TSOMem.html#store">store</a></span>,<span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="kwd">in</span> *;<span class="id">ex_match2</span>;<span class="tactic">repeat</span> <span class="id">inv_some</span>;<span class="tactic">try</span> <span class="tactic">clear</span> <span class="id">Hx1</span> <span class="id">Hx2</span>;<span class="tactic">intro</span>; <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> <span class="kwd">in</span> *;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">FMemOpFP.uncheck_alloc_fp</a></span>,<span class="id"><a href="FMemOpFP.html#free_fp">FMemOpFP.free_fp</a></span>,<span class="id"><a href="FMemOpFP.html#store_fp">FMemOpFP.store_fp</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="Footprint.html#Locs.locs_emp">Locs.locs_emp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<span class="tactic">try</span> <span class="tactic">rewrite</span> !<span class="id"><a href="TSOSemLemmas.html#emp_intersect_locs">emp_intersect_locs</a></span>,<span class="id"><a href="Footprint.html#Locs.locs_union_emp">Locs.locs_union_emp</a></span> <span class="kwd">in</span> *;<span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>. <span class="id">ex_match2</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#range_locset">FMemOpFP.range_locset</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">ex_match2</span>;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradict</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#range_locset_belongsto">range_locset_belongsto</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;-<span class="id"><a href="TSOSemLemmas.html#add_minus_eq">add_minus_eq</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">r</span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">r0</span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#range_locset">FMemOpFP.range_locset</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="TSOSemLemmas.html#add_minus_eq">add_minus_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v0</span> <span class="kwd">as</span> [? <span class="id">_</span>], <span class="id">v1</span> <span class="kwd">as</span> [? <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> <span class="kwd">in</span> *;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="Footprint.html#Locs.locs_emp">Locs.locs_emp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<span class="tactic">try</span> <span class="tactic">rewrite</span> !<span class="id"><a href="TSOSemLemmas.html#emp_intersect_locs">emp_intersect_locs</a></span>,!<span class="id"><a href="Footprint.html#Locs.locs_union_emp">Locs.locs_union_emp</a></span>,!<span class="id"><a href="Footprint.html#Locs.emp_union_locs">Locs.emp_union_locs</a></span>,!<span class="id"><a href="Footprint.html#Locs.locs_intersect_emp">Locs.locs_intersect_emp</a></span> <span class="kwd">in</span> *;<span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Focus</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> !<span class="id"><a href="Footprint.html#Locs.locs_intersect_emp">Locs.locs_intersect_emp</a></span> <span class="kwd">in</span> *;<span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#range_locset">FMemOpFP.range_locset</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>( <span class="id"><a href="Coqlib.html#zle">zle</a></span> <span class="id">z1</span> <span class="id">x0</span> &amp;&amp; <span class="id"><a href="Coqlib.html#zlt">zlt</a></span> <span class="id">x0</span> (<span class="id">z1</span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id">m0</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> /\ <span class="id">b0</span> = <span class="id">x</span> /\ <span class="id">b</span> = <span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="tactic">subst</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_iff">andb_true_iff</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> [];<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_iff">andb_true_iff</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> [];<span class="tactic">auto</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradict</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#range_locset_belongsto">range_locset_belongsto</a></span> <span class="kwd">in</span> <span class="id">H2</span> <span class="kwd">as</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H4</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H4</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#range_locset">FMemOpFP.range_locset</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="TSOSemLemmas.html#add_minus_eq">add_minus_eq</a></span>;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="Footprint.html#Locs.locs_emp">Locs.locs_emp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<span class="tactic">try</span> <span class="tactic">rewrite</span> !<span class="id"><a href="TSOSemLemmas.html#emp_intersect_locs">emp_intersect_locs</a></span>,<span class="id"><a href="Footprint.html#Locs.locs_union_emp">Locs.locs_union_emp</a></span> <span class="kwd">in</span> *;<span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>. <span class="id">ex_match2</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#range_locset">FMemOpFP.range_locset</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">ex_match2</span>;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradict</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#range_locset_belongsto">range_locset_belongsto</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;-<span class="id"><a href="TSOSemLemmas.html#add_minus_eq">add_minus_eq</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">r</span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">r0</span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#range_locset">FMemOpFP.range_locset</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="TSOSemLemmas.html#add_minus_eq">add_minus_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_iff">andb_true_iff</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> [];<span class="tactic">congruence</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="Footprint.html#Locs.locs_emp">Locs.locs_emp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<span class="tactic">try</span> <span class="tactic">rewrite</span> !<span class="id"><a href="TSOSemLemmas.html#emp_intersect_locs">emp_intersect_locs</a></span>,<span class="id"><a href="Footprint.html#Locs.locs_union_emp">Locs.locs_union_emp</a></span> <span class="kwd">in</span> *;<span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>. <span class="id">ex_match2</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_iff">andb_true_iff</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#range_locset_belongsto">range_locset_belongsto</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> [];<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#range_locset_belongsto">range_locset_belongsto</a></span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> [];<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;-!<span class="id"><a href="TSOSemLemmas.html#add_minus_eq">add_minus_eq</a></span> <span class="kwd">in</span> *.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">r1</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">r2</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">r</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">r0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> !<span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#zle">zle</a></span>,<span class="id"><a href="Coqlib.html#zlt">zlt</a></span>,<span class="id"><a href="Coqlib.html#zle">zle</a></span>,<span class="id"><a href="Coqlib.html#zlt">zlt</a></span>;<span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">bool</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Hx3</span> <span class="id">Hx4</span> <span class="id">Hx5</span> <span class="id">Hx6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v0</span> <span class="kwd">as</span> [? <span class="id">_</span>],<span class="id">v1</span> <span class="kwd">as</span> [? <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [? <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="Footprint.html#Locs.locs_emp">Locs.locs_emp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<span class="tactic">try</span> <span class="tactic">rewrite</span> !<span class="id"><a href="TSOSemLemmas.html#emp_intersect_locs">emp_intersect_locs</a></span>,!<span class="id"><a href="Footprint.html#Locs.locs_union_emp">Locs.locs_union_emp</a></span>,!<span class="id"><a href="Footprint.html#Locs.emp_union_locs">Locs.emp_union_locs</a></span>,!<span class="id"><a href="Footprint.html#Locs.locs_intersect_emp">Locs.locs_intersect_emp</a></span> <span class="kwd">in</span> *;<span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Focus</span> 2.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#Locs.locs_intersect_emp">Locs.locs_intersect_emp</a></span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="id">contradiction</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> !<span class="id"><a href="TSOSemLemmas.html#emp_intersect_locs">emp_intersect_locs</a></span>,<span class="id"><a href="Footprint.html#Locs.emp_union_locs">Locs.emp_union_locs</a></span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_iff">andb_true_iff</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#range_locset_belongsto">range_locset_belongsto</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#range_locset_belongsto">range_locset_belongsto</a></span> <span class="kwd">in</span> <span class="id">H2</span> <span class="kwd">as</span> [];<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="TSOSemLemmas.html#add_minus_eq">add_minus_eq</a></span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">r0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">r</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">H0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">H1</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<span class="tactic">clear</span> <span class="id">r</span> <span class="id">r0</span> <span class="id">H0</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unchecked_free">unchecked_free</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#zle">zle</a></span>,<span class="id"><a href="Coqlib.html#zlt">zlt</a></span>;<span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">bool</span>;<span class="tactic">try</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v0</span> <span class="kwd">as</span> [? <span class="id">_</span>],<span class="id">v1</span> <span class="kwd">as</span> [? <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [? <span class="id">R</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="Footprint.html#Locs.locs_emp">Locs.locs_emp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<span class="tactic">try</span> <span class="tactic">rewrite</span> !<span class="id"><a href="TSOSemLemmas.html#emp_intersect_locs">emp_intersect_locs</a></span>,!<span class="id"><a href="Footprint.html#Locs.locs_union_emp">Locs.locs_union_emp</a></span>,!<span class="id"><a href="Footprint.html#Locs.emp_union_locs">Locs.emp_union_locs</a></span>,!<span class="id"><a href="Footprint.html#Locs.locs_intersect_emp">Locs.locs_intersect_emp</a></span> <span class="kwd">in</span> *;<span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Focus</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#Locs.locs_intersect_emp">Locs.locs_intersect_emp</a></span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="id">contradiction</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> !<span class="id"><a href="TSOSemLemmas.html#emp_intersect_locs">emp_intersect_locs</a></span>,<span class="id"><a href="Footprint.html#Locs.locs_union_emp">Locs.locs_union_emp</a></span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_iff">andb_true_iff</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#range_locset_belongsto">range_locset_belongsto</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> []. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">H0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">H1</span>;<span class="tactic">eauto</span>;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span> <span class="kwd">in</span> <span class="id">H4</span>. <span class="id">ex_match2</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradict</span> <span class="id">R</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#range_locset_belongsto">range_locset_belongsto</a></span> <span class="kwd">in</span> <span class="id">H5</span> <span class="kwd">as</span> [];<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">H0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">H1</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span> <span class="kwd">in</span> <span class="id">H7</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#range_locset">FMemOpFP.range_locset</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="TSOSemLemmas.html#add_minus_eq">add_minus_eq</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Hx5</span> <span class="id">Hx4</span> <span class="id">Hx3</span> <span class="id">Hx6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v0</span> <span class="kwd">as</span> [? <span class="id">_</span> ],<span class="id">v1</span> <span class="kwd">as</span> [? <span class="id">_</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="Footprint.html#Locs.locs_emp">Locs.locs_emp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<span class="tactic">try</span> <span class="tactic">rewrite</span> !<span class="id"><a href="TSOSemLemmas.html#emp_intersect_locs">emp_intersect_locs</a></span>,!<span class="id"><a href="Footprint.html#Locs.locs_union_emp">Locs.locs_union_emp</a></span>,!<span class="id"><a href="Footprint.html#Locs.emp_union_locs">Locs.emp_union_locs</a></span>,!<span class="id"><a href="Footprint.html#Locs.locs_intersect_emp">Locs.locs_intersect_emp</a></span> <span class="kwd">in</span> *;<span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Focus</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#Locs.locs_intersect_emp">Locs.locs_intersect_emp</a></span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="id">contradiction</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> !<span class="id"><a href="TSOSemLemmas.html#emp_intersect_locs">emp_intersect_locs</a></span>,<span class="id"><a href="Footprint.html#Locs.locs_union_emp">Locs.locs_union_emp</a></span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Locs.unfolds</span>. <span class="id">Hsimpl</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_iff">andb_true_iff</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#range_locset_belongsto">range_locset_belongsto</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> [];<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#range_locset_belongsto">range_locset_belongsto</a></span> <span class="kwd">in</span> <span class="id">H2</span> <span class="kwd">as</span> [];<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="TSOSemLemmas.html#add_minus_eq">add_minus_eq</a></span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">r</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">H0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">H1</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<span class="tactic">clear</span> <span class="id">r</span> <span class="id">H0</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unchecked_free">unchecked_free</a></span> <span class="kwd">in</span> *. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span> <span class="kwd">in</span> <span class="id">H4</span>. <span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#zle">zle</a></span>,<span class="id"><a href="Coqlib.html#zlt">zlt</a></span>;<span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">bool</span>;<span class="tactic">try</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;<span class="kwd">Lemma</span> <span class="id">unbuffer_safe_apply_buffer</span>':<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">bf</span> <span class="id">ls</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span>++<span class="id"><a href="TSOSemLemmas.html#ls">ls</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> <span class="id">gm</span>, <span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> ) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">gm</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">gm</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOSemLemmas.html#gm">gm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> (<span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#ls">ls</a></span> <span class="id"><a href="TSOSemLemmas.html#gm">gm</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10036')">Proof.</div>
<div class="proofscript" id="proof10036">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#unbuffer_safe_apply_buffer">unbuffer_safe_apply_buffer</a></span> <span class="kwd">in</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buffer_split">apply_buffer_split</a></span> <span class="kwd">in</span> <span class="id">H</span>;<span class="id">Hsimpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">memory</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">tso_buffers</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">inv_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_eq">tupdate_same_eq</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#optbind">optbind</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="id">ex_match</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="tactic">eapply</span> <span class="id">UNBS</span> <span class="kwd">in</span> <span class="id">Hx</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">UNBS</span> <span class="id">ABIS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf</span> <span class="kwd">with</span>(<span class="id">t</span>:=<span class="id">t</span>) <span class="kwd">in</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="kwd">in</span> *;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_tid_eq">tupdate_same_tid_eq</a></span> <span class="kwd">in</span> <span class="id">H</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="unbuffer_safe_apply_buffer">unbuffer_safe_apply_buffer</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">bf</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> <span class="id">gm</span>, <span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> ) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">gm</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">gm</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOSemLemmas.html#gm">gm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> (<span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> <span class="id"><a href="TSOSemLemmas.html#gm">gm</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10037')">Proof.</div>
<div class="proofscript" id="proof10037">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="kwd">forall</span> <span class="id">A</span> (<span class="id">bf</span>:<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="TSOSemLemmas.html#A">A</a></span>),<span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span> = <span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span> ++ <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>;<span class="tactic">auto</span>. <span class="tactic">simpl</span>.  <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">unbuffer_safe_apply_buffer</span>';<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="unbuffer_safe_nfconflict">unbuffer_safe_nfconflict</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">bi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">t</span>' &lt;&gt; <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#bi2">bi2</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id">t</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="TSOSemLemmas.html#fconflict">fconflict</a></span> <span class="id"><a href="TSOSemLemmas.html#bi2">bi2</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10038')">Proof.</div>
<div class="proofscript" id="proof10038">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_split">in_split</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_split">in_split</a></span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">unbuffer_safe_apply_buffer</span>' <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H4</span> <span class="id">_</span> <span class="id">H3</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">unbuffer_safe_apply_buffer</span>' <span class="kwd">with</span>(<span class="id">t</span>:=<span class="id">t</span>') <span class="kwd">in</span> <span class="id">H4</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Focus</span> 2. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_not_eq_get">tupdate_not_eq_get</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H6</span> <span class="id">_</span> <span class="id">H5</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H4</span> <span class="id">H5</span> <span class="id">H3</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> (<span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="id">m</span> <span class="id">t</span> (<span class="id">bi</span> :: <span class="id">x2</span>) <span class="id">x3</span>) <span class="id">t</span>' (<span class="id">bi2</span> :: <span class="id">x0</span>) <span class="id">x4</span>) <span class="kwd">as</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span> <span class="id">t</span> = <span class="id">bi</span>::<span class="id">x2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqtm</span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_not_eq_get">tupdate_not_eq_get</a></span>,<span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span>;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span> <span class="id">t</span>' = <span class="id">bi2</span> :: <span class="id">x0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqtm</span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H0</span> <span class="id">H2</span> <span class="id">Heqtm</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span>  <span class="id"><a href="TSOSemLemmas.html#buffer_safe_exchangable_nfconflict">buffer_safe_exchangable_nfconflict</a></span>;<span class="tactic">try</span> <span class="id">instantiate</span>(1:=<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">tm</span>);<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span>;<span class="tactic">simpl</span>;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#optbind">optbind</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ABIS</span> <span class="kwd">in</span> <span class="id">H3</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>. <span class="id">Hsimpl</span>. <span class="id">ex_match3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">UNBS</span> <span class="kwd">in</span> <span class="id">H0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id">ABIS0</span>. <span class="id">instantiate</span>(3:=<span class="id">t</span>). <span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_not_eq_get">tupdate_not_eq_get</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match3</span>. <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ABIS</span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>. <span class="id">Hsimpl</span>. <span class="id">ex_match3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">UNBS</span> <span class="kwd">in</span> <span class="id">H0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id">ABIS0</span>. <span class="id">instantiate</span>(3:=<span class="id">t</span>'). <span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_not_eq_get">tupdate_not_eq_get</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match3</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="apply_buffer_split_2">apply_buffer_split_2</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span> <span class="id">bf</span> <span class="id">m</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> (<span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span>::<span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span>) <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m1</span>, <span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span> /\ <span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span> <span class="id">m1</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10039')">Proof.</div>
<div class="proofscript" id="proof10039">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>((<span class="id">bi</span>::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)++<span class="id">bf</span> = <span class="id">bi</span>::<span class="id">bf</span>). <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buffer_split">apply_buffer_split</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> [?[]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span>,<span class="id"><a href="TSOMem.html#optbind">optbind</a></span> <span class="kwd">in</span> <span class="id">H</span>;<span class="id">ex_match</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="buffer_safe_exchangable_nfconflict_2">buffer_safe_exchangable_nfconflict_2</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">bi1</span> <span class="id">bi2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> (<span class="id"><a href="TSOSemLemmas.html#bi1">bi1</a></span>::<span class="id"><a href="TSOSemLemmas.html#bi2">bi2</a></span>::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="TSOSemLemmas.html#fconflict">fconflict</a></span> <span class="id"><a href="TSOSemLemmas.html#bi1">bi1</a></span> <span class="id"><a href="TSOSemLemmas.html#bi2">bi2</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> (<span class="id"><a href="TSOSemLemmas.html#bi2">bi2</a></span>::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> (<span class="id"><a href="TSOSemLemmas.html#bi2">bi2</a></span>::<span class="id"><a href="TSOSemLemmas.html#bi1">bi1</a></span>::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id"><a href="TSOSemLemmas.html#m">m</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10040')">Proof.</div>
<div class="proofscript" id="proof10040">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#apply_buffer_split_2">apply_buffer_split_2</a></span> <span class="kwd">in</span> <span class="id">H</span>;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#optbind">optbind</a></span> <span class="kwd">in</span> <span class="id">H0</span>;<span class="id">ex_match</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#optbind">optbind</a></span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="id">ex_match</span>. <span class="id">inv_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#nfconflict_comm">nfconflict_comm</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#apply_buffer_item_fconflict">apply_buffer_item_fconflict</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">x2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#optbind">optbind</a></span>. <span class="tactic">do</span> 2 <span class="id">ex_match3</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Record</span> <span class="id"><a name="mem_sim">mem_sim</a></span> (<span class="id">R</span>:<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>-&gt;<span class="id"><a href="TSOMem.html#buffer_item">buffer_item</a></span>-&gt;<span class="id"><a href="GlobDefs.html#tid">tid</a></span>-&gt;<span class="id"><a href="TSOMem.html#tsomem">tsomem</a></span>-&gt;<span class="id"><a href="TSOMem.html#tsomem">tsomem</a></span>-&gt;<span class="kwd">Prop</span>):<span class="kwd">Prop</span>:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="match_buffer_1">match_buffer_1</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">bi</span> <span class="id">t</span> <span class="id">m1</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#R">R</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">t</span>' &lt;&gt; <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> <span class="id">t</span>' = <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> <span class="id">t</span>';<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="match_buffer_2">match_buffer_2</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">bi</span> <span class="id">t</span> <span class="id">m1</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#R">R</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#b">b</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="match_buffer_3">match_buffer_3</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">bi</span> <span class="id">t</span> <span class="id">m1</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#R">R</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#b">b</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>)++(<span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span>::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)=<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="match_apply_buffer_item">match_apply_buffer_item</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">bi</span> <span class="id">t</span> <span class="id">m1</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#R">R</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> &lt;&gt; <span class="id">t</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span>' <span class="id">ls</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> <span class="id">t</span>' = <span class="id">bi</span>'::<span class="id"><a href="TSOSemLemmas.html#ls">ls</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m1</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">bi</span>' (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m2</span>', <span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">bi</span>' (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#R">R</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>(<span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> <span class="id">t</span>' <span class="id"><a href="TSOSemLemmas.html#ls">ls</a></span> <span class="id">m1</span>')(<span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> <span class="id">t</span>' <span class="id"><a href="TSOSemLemmas.html#ls">ls</a></span> <span class="id">m2</span>');<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="match_apply_buffer_item_2">match_apply_buffer_item_2</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">bi</span> <span class="id">t</span> <span class="id">m1</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#R">R</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#b">b</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m2</span>', <span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#R">R</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> (<span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> <span class="id">m2</span>');<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="match_apply_buffer_item_3">match_apply_buffer_item_3</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">bi</span> <span class="id">t</span> <span class="id">m1</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#R">R</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#b">b</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi2</span> <span class="id">ls</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="TSOSemLemmas.html#bi2">bi2</a></span>::<span class="id"><a href="TSOSemLemmas.html#ls">ls</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m1</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOSemLemmas.html#bi2">bi2</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m2</span>', <span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOSemLemmas.html#bi2">bi2</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#R">R</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>(<span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#ls">ls</a></span> <span class="id">m1</span>')(<span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> (<span class="id"><a href="TSOSemLemmas.html#ls">ls</a></span>++(<span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span>::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)) <span class="id">m2</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="unbuffer_safe_preserve">unbuffer_safe_preserve</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span>' <span class="id">b</span> <span class="id">bi</span> <span class="id">t</span> (<span class="id">R</span>:<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>-&gt;<span class="id"><a href="TSOMem.html#buffer_item">buffer_item</a></span>-&gt;<span class="id"><a href="GlobDefs.html#tid">tid</a></span>-&gt;<span class="id"><a href="TSOMem.html#tsomem">tsomem</a></span>-&gt;<span class="id"><a href="TSOMem.html#tsomem">tsomem</a></span>-&gt;<span class="kwd">Prop</span>) (<span class="id">Rel</span>:<span class="id"><a href="TSOSemLemmas.html#R">R</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id">m</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SIM</span>:<span class="id"><a href="TSOSemLemmas.html#mem_sim">mem_sim</a></span> <span class="id"><a href="TSOSemLemmas.html#R">R</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> <span class="id">m</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10041')">Proof.</div>
<div class="proofscript" id="proof10041">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> 1;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span>  (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t0</span> <span class="id">t</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#match_buffer_2">match_buffer_2</a></span>;<span class="tactic">eauto</span>;<span class="tactic">intros</span>[].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#match_buffer_3">match_buffer_3</a></span>;<span class="tactic">eauto</span>;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H1</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tso</span> <span class="id">t</span>) <span class="id">eqn</span>:?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#match_apply_buffer_item_2">match_apply_buffer_item_2</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="id">Hsimpl</span>. <span class="id">inv</span> <span class="id">H0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ABIS</span> <span class="kwd">in</span> <span class="id">Heqb</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#match_apply_buffer_item_3">match_apply_buffer_item_3</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="id">Hsimpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#match_buffer_1">match_buffer_1</a></span>;<span class="tactic">eauto</span>. <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;-<span class="id">H1</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">ABIS</span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> ?. <span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#match_apply_buffer_item">match_apply_buffer_item</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<span class="id">Hsimpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">destruct</span> <span class="id">b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#match_buffer_2">match_buffer_2</a></span>;<span class="tactic">eauto</span>;<span class="tactic">intros</span>[].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#match_buffer_3">match_buffer_3</a></span>;<span class="tactic">eauto</span>;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H2</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tso</span> <span class="id">t0</span>) <span class="id">eqn</span>:?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#match_apply_buffer_item_2">match_apply_buffer_item_2</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>;<span class="tactic">simpl</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">H5</span>. <span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#match_buffer_1">match_buffer_1</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H6</span>.  <span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_not_eq_get">tupdate_not_eq_get</a></span> <span class="kwd">in</span> <span class="id">H6</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">ABIS</span>;<span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">H6</span>. <span class="tactic">simpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.  <span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#match_apply_buffer_item">match_apply_buffer_item</a></span>;<span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H4</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H6</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="id">Hsimpl</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H3</span>;<span class="id">inv_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">H5</span>. <span class="id">ex_match2</span>. <span class="tactic">clear</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#match_buffer_1">match_buffer_1</a></span>;<span class="tactic">eauto</span>;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">H0</span>;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H0</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">ABIS</span>;<span class="tactic">eauto</span>;<span class="tactic">intro</span>;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#match_apply_buffer_item">match_apply_buffer_item</a></span>;<span class="tactic">eauto</span>;<span class="tactic">intro</span>;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H3</span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="id">inv_some</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">H</span>. <span class="tactic">exact</span> <span class="id">H5</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H6</span> <span class="kwd">in</span> <span class="id">H8</span>;<span class="id">inv_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">ABIS</span>;<span class="tactic">eauto</span>;<span class="tactic">intros</span>;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#match_apply_buffer_item_3">match_apply_buffer_item_3</a></span>;<span class="tactic">eauto</span>;<span class="tactic">intro</span>;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H3</span>;<span class="id">inv_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">simpl</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">H3</span>;<span class="id">ex_match2</span>;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">b1</span> <span class="id">eqn</span>:?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#match_apply_buffer_item_2">match_apply_buffer_item_2</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<span class="id">inv</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">ABIS0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ABIS0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">UNBS</span>;<span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H1</span>;<span class="tactic">eauto</span>;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#match_buffer_1">match_buffer_1</a></span>;<span class="tactic">eauto</span>;<span class="tactic">intro</span>;<span class="id">Hsimpl</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H5</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">ABIS0</span>.  <span class="tactic">rewrite</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>;<span class="id">ex_match2</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#match_apply_buffer_item">match_apply_buffer_item</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H6</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>;<span class="id">ex_match2</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>;<span class="id">Hsimpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">H3</span>;<span class="id">ex_match2</span>;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">b1</span> <span class="id">eqn</span>:?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#match_apply_buffer_item_2">match_apply_buffer_item_2</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H3</span> <span class="kwd">in</span> <span class="id">H5</span>;<span class="id">inv_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<span class="id">inv</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">UNBS0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>. <span class="id">ex_match2</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H4</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="kwd">in</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">UNBS0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>. <span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#match_buffer_1">match_buffer_1</a></span>;<span class="tactic">eauto</span>;<span class="tactic">intro</span>;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H0</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">ABIS</span>;<span class="tactic">eauto</span>;<span class="tactic">intro</span>;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#match_apply_buffer_item">match_apply_buffer_item</a></span>;<span class="tactic">eauto</span>;<span class="tactic">intro</span>;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H4</span>;<span class="id">inv_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="inv_bi">inv_bi</a></span> <span class="id">bi</span> <span class="id">t</span> <span class="id">m</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">t</span>' &lt;&gt; <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">bi</span>' (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id">t</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="TSOSemLemmas.html#fconflict">fconflict</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id">bi</span>'.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="match_mem">match_mem</a></span> :<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>-&gt;<span class="id"><a href="TSOMem.html#buffer_item">buffer_item</a></span>-&gt;<span class="id"><a href="GlobDefs.html#tid">tid</a></span>-&gt;<span class="id"><a href="TSOMem.html#tsomem">tsomem</a></span>-&gt;<span class="id"><a href="TSOMem.html#tsomem">tsomem</a></span>-&gt;<span class="kwd">Prop</span>:=<br/>
&nbsp;&nbsp;| <span class="id"><a name="bi_exists">bi_exists</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">bi</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#inv_bi">inv_bi</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> ((<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>)++(<span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span>::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)) (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span>)-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#match_mem">match_mem</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> (<span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> ((<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>)++(<span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span>::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)) (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span>))<br/>
&nbsp;&nbsp;| <span class="id"><a name="bi_use">bi_use</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">bi</span> <span class="id">t</span> <span class="id">m</span>' <span class="id">m</span>'',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#match_mem">match_mem</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id">m</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">m</span>' <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span>::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">m</span>') = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>''-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#match_mem">match_mem</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> (<span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="id">m</span>' <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> <span class="id">m</span>'')<br/>
&nbsp;&nbsp;| <span class="id"><a name="matched_progress">matched_progress</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">m</span> <span class="id">bi</span> <span class="id">t</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#match_mem">match_mem</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span>' <span class="id">bi2</span> <span class="id">ls</span> <span class="id">m1</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">t</span>' &lt;&gt; <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id">t</span>' = <span class="id"><a href="TSOSemLemmas.html#bi2">bi2</a></span>::<span class="id"><a href="TSOSemLemmas.html#ls">ls</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOSemLemmas.html#bi2">bi2</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOSemLemmas.html#bi2">bi2</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">m</span>') = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#match_mem">match_mem</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> (<span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id">t</span>' <span class="id"><a href="TSOSemLemmas.html#ls">ls</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span>)(<span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="id">m</span>' <span class="id">t</span>' <span class="id"><a href="TSOSemLemmas.html#ls">ls</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="matched_progress2">matched_progress2</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">m</span> <span class="id">bi</span> <span class="id">bi2</span> <span class="id">ls</span> <span class="id">t</span> <span class="id">m</span>' <span class="id">m1</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#match_mem">match_mem</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#b">b</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="TSOSemLemmas.html#bi2">bi2</a></span>::<span class="id"><a href="TSOSemLemmas.html#ls">ls</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOSemLemmas.html#bi2">bi2</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOSemLemmas.html#bi2">bi2</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">m</span>') = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#match_mem">match_mem</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> (<span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#ls">ls</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span>)(<span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="id">m</span>' <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> (<span class="id"><a href="TSOSemLemmas.html#ls">ls</a></span>++(<span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span>::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)) <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span>).<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="match_mem_match_buffer1">match_mem_match_buffer1</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">bi</span> <span class="id">t</span> <span class="id">m1</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#match_mem">match_mem</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">t</span>' &lt;&gt; <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> <span class="id">t</span>' = <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> <span class="id">t</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10042')">Proof.</div>
<div class="proofscript" id="proof10042">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> 1;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_not_eq_get">tupdate_not_eq_get</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_not_eq_get">tupdate_not_eq_get</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>;<span class="id">ex_match2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span>! <span class="id"><a href="TSOMemLemmas.html#tupdate_not_eq_get">tupdate_not_eq_get</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="match_mem_match_buffer3">match_mem_match_buffer3</a></span>:       <br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">bi</span> <span class="id">t</span> <span class="id">m1</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#match_mem">match_mem</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#b">b</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>)++(<span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span>::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)=<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10043')">Proof.</div>
<div class="proofscript" id="proof10043">
&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> 1;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHmatch_mem</span> <span class="id">H4</span>).<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span>! <span class="id"><a href="TSOMemLemmas.html#tupdate_not_eq_get">tupdate_not_eq_get</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span>!<span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;Qed.</div>
&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="match_mem_match_buffer2">match_mem_match_buffer2</a></span>:<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">bi</span> <span class="id">t</span> <span class="id">m1</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#match_mem">match_mem</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#b">b</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10044')">Proof.</div>
<div class="proofscript" id="proof10044">
&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> 1;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#match_mem_match_buffer3">match_mem_match_buffer3</a></span> <span class="kwd">in</span> <span class="id">H</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">m</span> <span class="id">t</span>)<span class="id">eqn</span>:?.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">auto</span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_eq_nil">app_eq_nil</a></span> <span class="kwd">in</span> <span class="id">H5</span> <span class="kwd">as</span> [];<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="id">contradict</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nil_cons">nil_cons</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHmatch_mem</span> <span class="id">H4</span>) <span class="kwd">as</span> [].<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> ! <span class="id"><a href="TSOMemLemmas.html#tupdate_not_eq_get">tupdate_not_eq_get</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;Qed.</div>
&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="match_mem_false_memeq">match_mem_false_memeq</a></span>:<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span> <span class="id">b</span> <span class="id">t</span> <span class="id">m1</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#match_mem">match_mem</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#b">b</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> = <span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10045')">Proof.</div>
<div class="proofscript" id="proof10045">
&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> 1;<span class="tactic">intros</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">IHmatch_mem</span> <span class="kwd">in</span> <span class="id">H2</span>;<span class="tactic">auto</span>. <span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H3</span>;<span class="id">inv_some</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id">IHmatch_mem</span> <span class="kwd">in</span> <span class="id">H4</span>. <span class="tactic">rewrite</span> <span class="id">H4</span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H3</span>;<span class="id">inv_some</span>;<span class="tactic">auto</span>.<br/>
&nbsp;Qed.</div>
&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="match_mem_inv_bi">match_mem_inv_bi</a></span>:<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span> <span class="id">b</span> <span class="id">t</span> <span class="id">m1</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#match_mem">match_mem</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#inv_bi">inv_bi</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10046')">Proof.</div>
<div class="proofscript" id="proof10046">
&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> 1;<span class="tactic">intros</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#inv_bi">inv_bi</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">H5</span>;<span class="id">ex_match2</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHmatch_mem</span>;<span class="tactic">eauto</span>. <span class="tactic">subst</span>. <span class="tactic">rewrite</span> <span class="id">H1</span>;<span class="id">right</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#inv_bi">inv_bi</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">H5</span>;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHmatch_mem</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;Qed.</div>
&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="match_mem_unbuffer_safe_1">match_mem_unbuffer_safe_1</a></span>:<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span> <span class="id">b</span> <span class="id">t</span> <span class="id">m1</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#match_mem">match_mem</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10047')">Proof.</div>
<div class="proofscript" id="proof10047">
&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> 1;<span class="tactic">intros</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">IHmatch_mem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">UNBS</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">IHmatch_mem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">UNBS</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;Qed.</div>
&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="match_mem_true_buffers_t_nil">match_mem_true_buffers_t_nil</a></span>:<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span> <span class="id">b</span> <span class="id">t</span> <span class="id">m1</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#match_mem">match_mem</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#b">b</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> /\ <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10048')">Proof.</div>
<div class="proofscript" id="proof10048">
&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> 1;<span class="tactic">intros</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#match_mem_match_buffer3">match_mem_match_buffer3</a></span> <span class="kwd">in</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">m</span> <span class="id">t</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>). <span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">m</span> <span class="id">t</span>);<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_eq_nil">app_eq_nil</a></span> <span class="kwd">in</span> <span class="id">H5</span> <span class="kwd">as</span> [].<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="id">contradict</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nil_cons">nil_cons</a></span>. <span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span>;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHmatch_mem</span> <span class="kwd">in</span> <span class="id">H4</span> <span class="kwd">as</span> ?;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span>! <span class="id"><a href="TSOMemLemmas.html#tupdate_not_eq_get">tupdate_not_eq_get</a></span>;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">apply</span> <span class="id">IHmatch_mem</span> <span class="kwd">in</span> <span class="id">H4</span>. <span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;Qed.</div>
<br/>
&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="in_app_or">in_app_or</a></span>:<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">A</span> : <span class="kwd">Type</span>) (<span class="id">l</span> <span class="id">m</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="TSOSemLemmas.html#A">A</a></span>) (<span class="id">a</span> : <span class="id"><a href="TSOSemLemmas.html#A">A</a></span>),<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#a">a</a></span> (<span class="id"><a href="TSOSemLemmas.html#l">l</a></span>++<span class="id"><a href="TSOSemLemmas.html#m">m</a></span>) -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#a">a</a></span> <span class="id"><a href="TSOSemLemmas.html#l">l</a></span> \/ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#a">a</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10049')">Proof.</div>
<div class="proofscript" id="proof10049">
&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">destruct</span> <span class="id">H</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHl</span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> [];<span class="tactic">auto</span>.<br/>
&nbsp;Qed.</div>
&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="match_mem_buffer_safe_1">match_mem_buffer_safe_1</a></span>:<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span> <span class="id">b</span> <span class="id">t</span> <span class="id">m1</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#match_mem">match_mem</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>) (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10050')">Proof.</div>
<div class="proofscript" id="proof10050">
&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> 1;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span>. <span class="id">eexists</span>;<span class="tactic">simpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_not_eq_get">tupdate_not_eq_get</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">b</span>.<br/>
&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#match_mem_true_buffers_t_nil">match_mem_true_buffers_t_nil</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> ?;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H5</span>. <span class="id">eexists</span>;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#match_mem_false_memeq">match_mem_false_memeq</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> ?;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H4</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H3</span>;<span class="id">inv_some</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#match_mem_inv_bi">match_mem_inv_bi</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H4</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#match_mem_unbuffer_safe_1">match_mem_unbuffer_safe_1</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#match_mem_match_buffer3">match_mem_match_buffer3</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> ?;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H6</span> <span class="kwd">in</span> *.<br/>
<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">IHmatch_mem</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#bi_bf_nfconflict_2">bi_bf_nfconflict_2</a></span> <span class="kwd">in</span> <span class="id">H2</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#match_mem_inv_bi">match_mem_inv_bi</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#inv_bi">inv_bi</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H</span> <span class="id">t</span>' <span class="id">H0</span>).<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#in_app_or">in_app_or</a></span> <span class="kwd">in</span> <span class="id">H8</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H8</span>.<br/>
&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#unbuffer_safe_nfconflict">unbuffer_safe_nfconflict</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span>. <span class="id">left</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H8</span>. <span class="tactic">destruct</span> <span class="id">H8</span>;<span class="tactic">try</span> <span class="id">contradiction</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#nfconflict_comm">nfconflict_comm</a></span>. <span class="tactic">apply</span> <span class="id">H</span>. <span class="tactic">rewrite</span> <span class="id">H1</span>;<span class="id">left</span>;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span>.   <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#match_mem_match_buffer3">match_mem_match_buffer3</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> ?;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;-<span class="id">H0</span> <span class="kwd">in</span> <span class="id">IHmatch_mem</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">IHmatch_mem</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#apply_buffer_split_2">apply_buffer_split_2</a></span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>. <span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H4</span>. <span class="id">inv_some</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;Qed.</div>
&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="match_mem_match_apply_buffer_item1_false">match_mem_match_apply_buffer_item1_false</a></span>:<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">bi</span> <span class="id">t</span> <span class="id">m1</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#match_mem">match_mem</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#b">b</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span>' : <span class="id"><a href="GlobDefs.html#tid">tid</a></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> &lt;&gt; <span class="id">t</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">bi</span>' : <span class="id"><a href="TSOMem.html#buffer_item">buffer_item</a></span>) (<span class="id">ls</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="TSOMem.html#buffer_item">buffer_item</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> <span class="id">t</span>' = <span class="id">bi</span>' :: <span class="id"><a href="TSOSemLemmas.html#ls">ls</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m1</span>' : <span class="id"><a href="GMemory.html#gmem">gmem</a></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">bi</span>' (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m2</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">bi</span>' (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#match_mem">match_mem</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> (<span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> <span class="id">t</span>' <span class="id"><a href="TSOSemLemmas.html#ls">ls</a></span> <span class="id">m1</span>') (<span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> <span class="id">t</span>' <span class="id"><a href="TSOSemLemmas.html#ls">ls</a></span> <span class="id">m2</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10051')">Proof.</div>
<div class="proofscript" id="proof10051">
&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> 1;<span class="tactic">simpl</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#match_mem_false_memeq">match_mem_false_memeq</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> ?;<span class="tactic">auto</span>. <span class="tactic">rewrite</span> <span class="id">H4</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H3</span>;<span class="id">inv_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">H6</span>. <span class="id">ex_match2</span>;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">IHmatch_mem</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H3</span>;<span class="id">inv_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>. <span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_not_eq_get">tupdate_not_eq_get</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#match_mem_false_memeq">match_mem_false_memeq</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> ?;<span class="tactic">auto</span>. <span class="tactic">rewrite</span> <span class="id">H8</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="id">inv_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">H6</span>;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>. <span class="id">econstructor</span>;<span class="tactic">eauto</span>. <span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_not_eq_get">tupdate_not_eq_get</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;Qed.</div>
<br/>
&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="match_mem_true_bi_eff">match_mem_true_bi_eff</a></span>:<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">bi</span> <span class="id">t</span> <span class="id">m1</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#match_mem">match_mem</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#b">b</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#bi_eff">bi_eff</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span>)(<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10052')">Proof.</div>
<div class="proofscript" id="proof10052">
&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> 1;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#bi_bi_eff">bi_bi_eff</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#match_mem_false_memeq">match_mem_false_memeq</a></span> <span class="kwd">in</span> <span class="id">H</span>;<span class="tactic">auto</span>. <span class="tactic">congruence</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHmatch_mem</span> <span class="id">H4</span>).<br/>
&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#bi_eff_progress">bi_eff_progress</a></span> <span class="kwd">in</span> <span class="id">IHmatch_mem</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>. <span class="tactic">rewrite</span> <span class="id">H3</span> <span class="kwd">in</span> <span class="id">H5</span>. <span class="id">inv_some</span>. <span class="tactic">simpl</span>. <span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#match_mem_inv_bi">match_mem_inv_bi</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#inv_bi">inv_bi</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#nfconflict_comm">nfconflict_comm</a></span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span>. <span class="id">left</span>;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;Qed.</div>
&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="match_mem_match_apply_buffer_item1_true">match_mem_match_apply_buffer_item1_true</a></span>:<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">bi</span> <span class="id">t</span> <span class="id">m1</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#match_mem">match_mem</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#b">b</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span>' : <span class="id"><a href="GlobDefs.html#tid">tid</a></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> &lt;&gt; <span class="id">t</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">bi</span>' : <span class="id"><a href="TSOMem.html#buffer_item">buffer_item</a></span>) (<span class="id">ls</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="TSOMem.html#buffer_item">buffer_item</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> <span class="id">t</span>' = <span class="id">bi</span>' :: <span class="id"><a href="TSOSemLemmas.html#ls">ls</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m1</span>' : <span class="id"><a href="GMemory.html#gmem">gmem</a></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">bi</span>' (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m2</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">bi</span>' (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#match_mem">match_mem</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> (<span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> <span class="id">t</span>' <span class="id"><a href="TSOSemLemmas.html#ls">ls</a></span> <span class="id">m1</span>') (<span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> <span class="id">t</span>' <span class="id"><a href="TSOSemLemmas.html#ls">ls</a></span> <span class="id">m2</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10053')">Proof.</div>
<div class="proofscript" id="proof10053">
&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#match_mem_true_bi_eff">match_mem_true_bi_eff</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> ?;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#bi_eff_progress">bi_eff_progress</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>. <span class="id">Esimpl</span>;<span class="tactic">eauto</span>. <span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#match_mem_inv_bi">match_mem_inv_bi</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#inv_bi">inv_bi</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#nfconflict_comm">nfconflict_comm</a></span>. <span class="tactic">eapply</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span>;<span class="id">left</span>;<span class="tactic">auto</span>.<br/>
&nbsp;Qed.</div>
<br/>
&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="match_mem_sim">match_mem_sim</a></span>:<br/>
&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#mem_sim">mem_sim</a></span> <span class="id"><a href="TSOSemLemmas.html#match_mem">match_mem</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10054')">Proof.</div>
<div class="proofscript" id="proof10054">
&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#match_mem_match_buffer1">match_mem_match_buffer1</a></span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#match_mem_match_buffer2">match_mem_match_buffer2</a></span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#match_mem_match_buffer3">match_mem_match_buffer3</a></span>.<br/>
&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">b</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#match_mem_match_apply_buffer_item1_true">match_mem_match_apply_buffer_item1_true</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#match_mem_match_apply_buffer_item1_false">match_mem_match_apply_buffer_item1_false</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#match_mem_buffer_safe_1">match_mem_buffer_safe_1</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#match_mem_match_buffer3">match_mem_match_buffer3</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> ?;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#optbind">optbind</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">ex_match</span>. <span class="id">inv_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#match_mem_false_memeq">match_mem_false_memeq</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> ?;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H0</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>. <span class="id">econstructor</span> 2;<span class="tactic">eauto</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#match_mem_false_memeq">match_mem_false_memeq</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> ?;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H0</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span> 4;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;Qed.</div>
<br/>
&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="unbuffer_safe_append_preserve">unbuffer_safe_append_preserve</a></span>:<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">bi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>++<span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span>::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#inv_bi">inv_bi</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> (<span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> ++ <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span>::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10055')">Proof.</div>
<div class="proofscript" id="proof10055">
&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="TSOSemLemmas.html#match_mem_sim">match_mem_sim</a></span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#unbuffer_safe_preserve">unbuffer_safe_preserve</a></span> <span class="kwd">with</span>(<span class="id">R</span>:=<span class="id"><a href="TSOSemLemmas.html#match_mem">match_mem</a></span>);<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span> 1;<span class="tactic">eauto</span>.<br/>
&nbsp;Qed.</div>
<br/>
&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="unbuffer_safe_append_bf_preserve">unbuffer_safe_append_bf_preserve</a></span>:<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">t</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> ++ <span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span>) (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">bi</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span> -&gt; <span class="id"><a href="TSOSemLemmas.html#inv_bi">inv_bi</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> (<span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>++<span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span>) (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10056')">Proof.</div>
<div class="proofscript" id="proof10056">
&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_eq">tupdate_same_eq</a></span>;<span class="tactic">auto</span>. <span class="tactic">destruct</span> <span class="id">m</span>;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id">H0</span> <span class="kwd">as</span> <span class="id">R</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buffer_split">apply_buffer_split</a></span> <span class="kwd">in</span> <span class="id">H0</span>;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#apply_buffer_split_2">apply_buffer_split_2</a></span> <span class="kwd">in</span> <span class="id">H2</span>;<span class="id">Hsimpl</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> ((<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">m</span> <span class="id">t</span>)++(<span class="id">a</span>::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>))(<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">m</span>)).<br/>
&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>. <span class="id">erewrite</span> <span class="id"><a href="TSOAuxDefs.html#apply_buffer_app_eq">apply_buffer_app_eq</a></span>;<span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#optbind">optbind</a></span>. <span class="tactic">rewrite</span> <span class="id">H2</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#unbuffer_safe_append_preserve">unbuffer_safe_append_preserve</a></span> <span class="kwd">in</span> <span class="id">H4</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id">Focus</span> 2. <span class="tactic">eapply</span> <span class="id">H1</span>;<span class="tactic">eauto</span>. <span class="id">left</span>;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">R2</span>:<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">m</span> <span class="id">t</span> ++ <span class="id">a</span>::<span class="id">bf</span> = (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">m</span> <span class="id">t</span> ++ <span class="id">a</span>::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)++<span class="id">bf</span>).<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">generalize</span> <span class="tactic">dependent</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">m</span> <span class="id">t</span>).<br/>
&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">bf</span> <span class="id">a</span>. <span class="tactic">induction</span> <span class="id">b</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="id">m</span> <span class="id">t</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">m</span> <span class="id">t</span> ++ <span class="id">a</span>::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)(<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">m</span>)) <span class="kwd">as</span> <span class="id">m</span>'.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf</span> <span class="kwd">with</span>(<span class="id">t</span>:=<span class="id">t</span>) <span class="kwd">in</span> <span class="id">H4</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqm</span>' <span class="kwd">in</span> <span class="id">H4</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="kwd">in</span> <span class="id">H4</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_tid_eq">tupdate_same_tid_eq</a></span>,<span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqm</span>'. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span>.  <span class="tactic">congruence</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#inv_bi">inv_bi</a></span> <span class="kwd">in</span> *;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqm</span>' <span class="kwd">in</span> <span class="id">H7</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H7</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_not_eq_get">tupdate_not_eq_get</a></span> <span class="kwd">in</span> <span class="id">H7</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H1</span>;<span class="tactic">eauto</span>. <span class="id">right</span>;<span class="tactic">auto</span>.<br/>
&nbsp;Qed.</div>
<br/>
&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="unbuffer_safe_globstep_preserve">unbuffer_safe_globstep_preserve</a></span>:<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tge</span> <span class="id">pc</span> <span class="id">l</span> <span class="id">fp</span> <span class="id">pc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tge">tge</a></span> <span class="id"><a href="TSOSemLemmas.html#pc">pc</a></span> <span class="id"><a href="TSOSemLemmas.html#l">l</a></span> <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> <span class="id">pc</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#pc">pc</a></span>)-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">pc</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10057')">Proof.</div>
<div class="proofscript" id="proof10057">
&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> 1;<span class="tactic">subst</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> 1;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unbuffer">unbuffer</a></span> <span class="kwd">in</span> <span class="id">H_unbuf</span>;<span class="id">ex_match</span>;<span class="id">inv_some</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">UNBS</span> <span class="kwd">in</span> <span class="id">Hx0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;Qed.</div>
<br/>
&nbsp;<span class="kwd">Lemma</span> <span class="id">non_conflict_access_unbuffer_safe</span>':<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tm</span> <span class="id">ge</span> <span class="id">fl</span> <span class="id">tc</span> <span class="id">t</span> <span class="id">fp</span> <span class="id">tc</span>' <span class="id">b</span>' <span class="id">m</span>' <span class="id">m</span>'',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> <span class="id"><a href="TSOSemLemmas.html#tm">tm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#tsostep">tsostep</a></span> <span class="id"><a href="TSOSemLemmas.html#ge">ge</a></span> <span class="id"><a href="TSOSemLemmas.html#fl">fl</a></span> <span class="id"><a href="TSOSemLemmas.html#tc">tc</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>, <span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOSemLemmas.html#tm">tm</a></span>) <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> <span class="id">tc</span>' (<span class="id">b</span>', <span class="id">m</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id">b</span>' <span class="id">m</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="ClientSim.html#conflictc">conflictc</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#tm">tm</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> (<span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="id"><a href="TSOSemLemmas.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id">b</span>' <span class="id">m</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10058')">Proof.</div>
<div class="proofscript" id="proof10058">
&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#TSO_eff">TSO_eff</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> <span class="id">EFF1</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">EFF1</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOAuxDefs.html#eff_chg">eff_chg</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span> <span class="id">t</span>) <span class="id">b</span>') <span class="id">eqn</span>:?.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_chg_t">eff_chg_t</a></span> <span class="kwd">in</span> <span class="id">Heqb</span> <span class="kwd">as</span> [];<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_eq">tupdate_same_eq</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#unbuffer_safe_mem_access_same_stable">unbuffer_safe_mem_access_same_stable</a></span> <span class="kwd">with</span>(<span class="id">m1</span>:=<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">tm</span>);<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#TSO_step_access_validity_preserve">TSO_step_access_validity_preserve</a></span> <span class="kwd">in</span> <span class="id">H0</span>;<span class="id">Hsimpl</span>;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_chg_f">eff_chg_f</a></span> <span class="kwd">in</span> <span class="id">Heqb</span>. <span class="tactic">clear</span> <span class="id">bf_chg</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#BufferEff">BufferEff</a></span> <span class="kwd">in</span> <span class="id">bf_eff</span>. <span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#unbuffer_safe_append_bf_preserve">unbuffer_safe_append_bf_preserve</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H4</span> <span class="id">H2</span>. <span class="tactic">clear</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#inv_bi">inv_bi</a></span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#fpsmile_nfconflict">fpsmile_nfconflict</a></span>.   <br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Footprint.html#FP.smile_conflict_compat">FP.smile_conflict_compat</a></span>;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="Footprint.html#FP.conflict">FP.conflict</a></span> <span class="id">fp</span> (<span class="id"><a href="TSOMem.html#bi_footprint">bi_footprint</a></span> <span class="id">bi</span>')).<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="kwd">forall</span> <span class="id">bi</span> <span class="id">bf</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span> -&gt; <span class="id"><a href="Footprint.html#FP.subset">FP.subset</a></span> (<span class="id"><a href="TSOMem.html#bi_footprint">bi_footprint</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span>)(<span class="id"><a href="TSOAuxDefs.html#bf_footprint">bf_footprint</a></span> <span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span>)).<br/>
&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>;<span class="tactic">induction</span> <span class="id">bf</span>;<span class="tactic">intros</span>;<span class="id">inv</span> <span class="id">H</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="Footprint.html#FP.union_subset">FP.union_subset</a></span>. <span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#FP.union_comm_eq">FP.union_comm_eq</a></span>.  <span class="tactic">apply</span> <span class="id"><a href="Footprint.html#FP.subset_union_subset">FP.subset_union_subset</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H5</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span>).<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="USimDRF.html#smile_conflict">USimDRF.smile_conflict</a></span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="USimDRF.html#smile_conflict">USimDRF.smile_conflict</a></span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="id">contradict</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FPLemmas.html#fpsmile_sym">FPLemmas.fpsmile_sym</a></span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="FPLemmas.html#fpsmile_subset">FPLemmas.fpsmile_subset</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FPLemmas.html#fpsmile_sym">FPLemmas.fpsmile_sym</a></span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#fpsmile_eff_eq_trans">fpsmile_eff_eq_trans</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H4</span>;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#bf_footprint_reads_emp">bf_footprint_reads_emp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#bf_footprint_cmps_emp">bf_footprint_cmps_emp</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id">contradict</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;Qed.</div>
<span class="kwd">End</span> <span class="id"><a href="TSOSemLemmas.html#BUFFER">BUFFER</a></span>.<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="fmem_eq">fmem_eq</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m1</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.mem_contents">Mem.mem_contents</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> = <span class="id"><a href="FMemory.html#Mem.mem_contents">Mem.mem_contents</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.mem_access">Mem.mem_access</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> = <span class="id"><a href="FMemory.html#Mem.mem_access">Mem.mem_access</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.validblocks">Mem.validblocks</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> = <span class="id"><a href="FMemory.html#Mem.validblocks">Mem.validblocks</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.freelist">Mem.freelist</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> = <span class="id"><a href="FMemory.html#Mem.freelist">Mem.freelist</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.nextblockid">Mem.nextblockid</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> = <span class="id"><a href="FMemory.html#Mem.nextblockid">Mem.nextblockid</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> = <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10059')">Proof.</div>
<div class="proofscript" id="proof10059">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m1</span>,<span class="id">m2</span>;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Axioms.html#proof_irr">proof_irr</a></span> <span class="kwd">with</span>(<span class="id">a1</span>:=<span class="id">valid_wd</span>)(<span class="id">a2</span>:=<span class="id">valid_wd0</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Axioms.html#proof_irr">proof_irr</a></span> <span class="kwd">with</span>(<span class="id">a1</span>:=<span class="id">access_max</span>)(<span class="id">a2</span>:=<span class="id">access_max0</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Axioms.html#proof_irr">proof_irr</a></span> <span class="kwd">with</span>(<span class="id">a1</span>:=<span class="id">contents_default</span>)(<span class="id">a2</span>:=<span class="id">contents_default0</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Axioms.html#proof_irr">proof_irr</a></span> <span class="kwd">with</span>(<span class="id">a1</span>:=<span class="id">invalid_noaccess</span>)(<span class="id">a2</span>:=<span class="id">invalid_noaccess0</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Axioms.html#proof_irr">proof_irr</a></span> <span class="kwd">with</span>(<span class="id">a1</span>:=<span class="id">freelist_wd</span>)(<span class="id">a2</span>:=<span class="id">freelist_wd0</span>).<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="getblock_always_success">getblock_always_success</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">fl</span>,<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">b</span>, <span class="id"><a href="MemAux.html#get_block">MemAux.get_block</a></span> <span class="id"><a href="TSOSemLemmas.html#fl">fl</a></span> <span class="id"><a href="TSOSemLemmas.html#n">n</a></span> = <span class="id">b</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10060')">Proof.</div>
<div class="proofscript" id="proof10060">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">n</span>; <span class="tactic">intros</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
&nbsp;&nbsp;<br/>
<h1> Reordering Lemmas </h1>
<span class="kwd">Section</span> <span class="id"><a name="Reordering">Reordering</a></span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Variable</span> <span class="id"><a name="Reordering.TGE">TGE</a></span>: <span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.t">TSOGlobEnv.t</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="normal_tsoglabel">normal_tsoglabel</a></span> (<span class="id">l</span>: <span class="id"><a href="TSOGlobSem.html#tsoglabel">tsoglabel</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="TSOSemLemmas.html#l">l</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="TSOGlobSem.html#tau">tau</a></span> | <span class="id"><a href="TSOGlobSem.html#evt">evt</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="ub_star">ub_star</a></span> (<span class="id">t</span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span>) : @<span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> <span class="id"><a href="TSOSemLemmas.html#Reordering.TGE">TGE</a></span> -&gt; @<span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> <span class="id"><a href="TSOSemLemmas.html#Reordering.TGE">TGE</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="ub_star_refl">ub_star_refl</a></span>: <span class="kwd">forall</span> <span class="id">tpc</span>, <span class="id"><a href="TSOSemLemmas.html#ub_star">ub_star</a></span> <span class="id">t</span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a name="ub_star_cons">ub_star_cons</a></span>: <span class="kwd">forall</span> <span class="id">tpc</span> <span class="id">tpc</span>' <span class="id">tpc</span>'',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> (<span class="id"><a href="TSOGlobSem.html#ub">ub</a></span> <span class="id">t</span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#ub_star">ub_star</a></span> <span class="id">t</span> <span class="id">tpc</span>' <span class="id">tpc</span>'' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#ub_star">ub_star</a></span> <span class="id">t</span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id">tpc</span>''.<br/>
<br/>
<div class="doc">equivalence between configurations </div>
&nbsp;&nbsp;<span class="kwd">Record</span> <span class="id"><a name="eq_config">eq_config</a></span> (<span class="id">tpc1</span> <span class="id">tpc2</span>: @<span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> <span class="id"><a href="TSOSemLemmas.html#Reordering.TGE">TGE</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="eq_thrdpool">eq_thrdpool</a></span>: <span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> = <span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="eq_cid">eq_cid</a></span>: <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> = <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="eq_m">eq_m</a></span>: <span class="id"><a href="GMemory.html#GMem.eq">GMem.eq</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span>)) (<span class="id"><a href="TSOMem.html#memory">memory</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="eq_buffer">eq_buffer</a></span>: <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span>) = <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="eq_config_refl">eq_config_refl</a></span>: <span class="kwd">forall</span> <span class="id">tpc</span>, <span class="id"><a href="TSOSemLemmas.html#eq_config">eq_config</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10061')">Proof.</div>
<div class="proofscript" id="proof10061">
 <span class="id">constructor</span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="GMemory.html#GMem.eq_refl">GMem.eq_refl</a></span>. Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="eq_config_trans">eq_config_trans</a></span>: <span class="kwd">forall</span> <span class="id">tpc1</span> <span class="id">tpc2</span> <span class="id">tpc3</span>, <span class="id"><a href="TSOSemLemmas.html#eq_config">eq_config</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span> -&gt; <span class="id"><a href="TSOSemLemmas.html#eq_config">eq_config</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc3">tpc3</a></span> -&gt; <span class="id"><a href="TSOSemLemmas.html#eq_config">eq_config</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc3">tpc3</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10062')">Proof.</div>
<div class="proofscript" id="proof10062">
 <span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H0</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="GMemory.html#GMem.eq_trans">GMem.eq_trans</a></span>; <span class="tactic">congruence</span>. Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="eq_config_sym">eq_config_sym</a></span>: <span class="kwd">forall</span> <span class="id">tpc1</span> <span class="id">tpc2</span>, <span class="id"><a href="TSOSemLemmas.html#eq_config">eq_config</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span> -&gt; <span class="id"><a href="TSOSemLemmas.html#eq_config">eq_config</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10063')">Proof.</div>
<div class="proofscript" id="proof10063">
 <span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="id">constructor</span>; <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="GMemory.html#GMem.eq_sym">GMem.eq_sym</a></span>. Qed.</div>
<br/>
<div class="doc">equivalence between configurations but current tid </div>
&nbsp;&nbsp;<span class="kwd">Record</span> <span class="id"><a name="eq_config_but_cid">eq_config_but_cid</a></span> (<span class="id">tpc1</span> <span class="id">tpc2</span>: @<span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> <span class="id"><a href="TSOSemLemmas.html#Reordering.TGE">TGE</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eq_thrdpool</span>': <span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> = <span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eq_m</span>': <span class="id"><a href="GMemory.html#GMem.eq">GMem.eq</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span>)) (<span class="id"><a href="TSOMem.html#memory">memory</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eq_buffer</span>': <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span>) = <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="eq_config_but_cid_refl">eq_config_but_cid_refl</a></span>: <span class="kwd">forall</span> <span class="id">tpc</span>, <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid">eq_config_but_cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10064')">Proof.</div>
<div class="proofscript" id="proof10064">
 <span class="id">constructor</span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="GMemory.html#GMem.eq_refl">GMem.eq_refl</a></span>. Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="eq_config_but_cid_trans">eq_config_but_cid_trans</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tpc1</span> <span class="id">tpc2</span> <span class="id">tpc3</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid">eq_config_but_cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid">eq_config_but_cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc3">tpc3</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid">eq_config_but_cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc3">tpc3</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10065')">Proof.</div>
<div class="proofscript" id="proof10065">
 <span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H0</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="GMemory.html#GMem.eq_trans">GMem.eq_trans</a></span>; <span class="tactic">congruence</span>. Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="eq_config_but_cid_sym">eq_config_but_cid_sym</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tpc1</span> <span class="id">tpc2</span>, <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid">eq_config_but_cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span> -&gt; <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid">eq_config_but_cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10066')">Proof.</div>
<div class="proofscript" id="proof10066">
 <span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="id">constructor</span>; <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="GMemory.html#GMem.eq_sym">GMem.eq_sym</a></span>. Qed.</div>
<br/>
<div class="doc">eq_config_but_cid could switch to eq_config </div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="eq_config_eq_config_but_cid">eq_config_eq_config_but_cid</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tpc</span> <span class="id">tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_config">eq_config</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid">eq_config_but_cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id">tpc</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10067')">Proof.</div>
<div class="proofscript" id="proof10067">
 <span class="tactic">clear</span>; <span class="tactic">intros</span>; <span class="id">inv</span> <span class="id">H</span>; <span class="id">constructor</span>; <span class="tactic">auto</span>. Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="eq_config_eq_step">eq_config_eq_step</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">tpc1</span> <span class="id">tpc2</span>: @<span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> <span class="id"><a href="TSOSemLemmas.html#Reordering.TGE">TGE</a></span>) <span class="id">l</span> <span class="id">fp</span> <span class="id">tpc1</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_config">eq_config</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> <span class="id"><a href="TSOSemLemmas.html#l">l</a></span> <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> <span class="id">tpc1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">tpc2</span>', <span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span> <span class="id"><a href="TSOSemLemmas.html#l">l</a></span> <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> <span class="id">tpc2</span>' /\ <span class="id"><a href="TSOSemLemmas.html#eq_config">eq_config</a></span> <span class="id">tpc1</span>' <span class="id">tpc2</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10068')">Proof.</div>
<div class="proofscript" id="proof10068">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">tpc1</span>, <span class="id">tpc2</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;core&nbsp;step&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOStepAuxLemmas.html#gmem_buffer_eq_corestep_eq">gmem_buffer_eq_corestep_eq</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">gm2</span>' &amp; <span class="id">Hcorestep</span> &amp; <span class="id">Heq</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>. <span class="tactic">split</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Corestep">TSOGlobSem.Corestep</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">eq_buffer0</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> &lt;- <span class="id">eq_buffer0</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#gmem_eq_ub_safe_eq">gmem_eq_ub_safe_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">eq_buffer0</span>; <span class="tactic">auto</span>.<br/>
&nbsp;ub&nbsp;step&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>, <span class="id">tm</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOStepAuxLemmas.html#gmem_eq_ub_gmem_eq">gmem_eq_ub_gmem_eq</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">gm2</span>' &amp; <span class="id">Hub</span> &amp; <span class="id">Heq</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>; <span class="tactic">split</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Unbuffer">TSOGlobSem.Unbuffer</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm0</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> &lt;- <span class="id">eq_buffer0</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;call&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>. <span class="tactic">split</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Call">TSOGlobSem.Call</a></span>; <span class="tactic">eauto</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;return&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>. <span class="tactic">split</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Return">TSOGlobSem.Return</a></span>; <span class="tactic">eauto</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;halt&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>. <span class="tactic">split</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Halt">TSOGlobSem.Halt</a></span>; <span class="tactic">eauto</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;print&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>. <span class="tactic">split</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#EF_Print">TSOGlobSem.EF_Print</a></span>; <span class="tactic">eauto</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;sw&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>. <span class="tactic">split</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Switch">TSOGlobSem.Switch</a></span>; <span class="tactic">eauto</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="merge_sw_steps">merge_sw_steps</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">tpc</span> <span class="id">tpc</span>' <span class="id">tpc</span>'': @<span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> <span class="id"><a href="TSOSemLemmas.html#Reordering.TGE">TGE</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id">tpc</span>' <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">tpc</span>'' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">tpc</span>''.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10069')">Proof.</div>
<div class="proofscript" id="proof10069">
 <span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">H0</span>. <span class="id">constructor</span>; <span class="tactic">auto</span>. Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="unbuffer_sw_step_reorder">unbuffer_sw_step_reorder</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">tpc</span> <span class="id">tpc</span>' <span class="id">tpc</span>'': @<span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> <span class="id"><a href="TSOSemLemmas.html#Reordering.TGE">TGE</a></span>) <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id">tpc</span>' (<span class="id"><a href="TSOGlobSem.html#ub">ub</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">tpc</span>'' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">tpc0</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> (<span class="id"><a href="TSOGlobSem.html#ub">ub</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">tpc0</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id">tpc0</span> <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">tpc</span>''.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10070')">Proof.</div>
<div class="proofscript" id="proof10070">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Unbuffer">TSOGlobSem.Unbuffer</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Switch">TSOGlobSem.Switch</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="same_thrd_normal_unbuffer_step_reorder">same_thrd_normal_unbuffer_step_reorder</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">tpc</span> <span class="id">tpc</span>' <span class="id">tpc</span>'': @<span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> <span class="id"><a href="TSOSemLemmas.html#Reordering.TGE">TGE</a></span>) <span class="id">l</span> <span class="id">fp</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOStepAuxLemmas.html#FLs_embed">FLs_embed</a></span> (<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.freelists">TSOGlobEnv.freelists</a></span> <span class="id"><a href="TSOSemLemmas.html#Reordering.TGE">TGE</a></span>) (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">t</span> := <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>) <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> &lt;&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#normal_tsoglabel">normal_tsoglabel</a></span> <span class="id"><a href="TSOSemLemmas.html#l">l</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id"><a href="TSOSemLemmas.html#l">l</a></span> <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id">tpc</span>' (<span class="id"><a href="TSOGlobSem.html#ub">ub</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">tpc</span>'' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">tpc0</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> (<span class="id"><a href="TSOGlobSem.html#ub">ub</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">tpc0</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id">tpc0</span> <span class="id"><a href="TSOSemLemmas.html#l">l</a></span> <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> <span class="id">tpc</span>''.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10071')">Proof.</div>
<div class="proofscript" id="proof10071">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">introv</span> <span class="id">Hfls_embed</span>; <span class="tactic">intros</span>; <span class="tactic">subst</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>; <span class="id">inv</span> <span class="id">H2</span>; <span class="id">simpls</span>; <span class="id">tryfalse</span>; <span class="tactic">subst</span> <span class="id">t</span>.<br/>
<div class="doc">Corestep </div>
&nbsp;&nbsp;&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hbuf</span>' : <span class="id">H_core_step</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#tso_step_buf_add">tso_step_buf_add</a></span> <span class="kwd">in</span> <span class="id">Hbuf</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hgm</span>' : <span class="id">H_core_step</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#tso_step_buf_not_empty_gm_stable">tso_step_buf_not_empty_gm_stable</a></span> <span class="kwd">in</span> <span class="id">Hgm</span>'; <span class="tactic">eauto</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hbuf</span>' <span class="kwd">as</span> [<span class="id">buf</span>'' <span class="id">Hbuf</span>']; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">H_unbuf_safe</span>' : <span class="id">H_unbuf_safe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#unbuffer_safe_addition_original_still">unbuffer_safe_addition_original_still</a></span> <span class="kwd">in</span> <span class="id">H_unbuf_safe</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">H_unbuf</span>' : <span class="id">H_unbuf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#unbuffer_upd_original_still">unbuffer_upd_original_still</a></span> <span class="kwd">in</span> <span class="id">H_unbuf</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_unbuf</span>' <span class="kwd">as</span> [<span class="id">tm</span>'' [<span class="id">H_unbuf</span>' [<span class="id">Hmem</span> <span class="id">Hbuf</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#thrdpool_tupdate_valid_original_valid">thrdpool_tupdate_valid_original_valid</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Corestep">TSOGlobSem.Corestep</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#tsostep_unbuffer_still">tsostep_unbuffer_still</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hmem</span> <span class="id">Hbuf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>', <span class="id">tm</span>''; <span class="id">simpls</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#unbuffer_safe_unbuffer_still">unbuffer_safe_unbuffer_still</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tm</span> := <span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="id">tm</span> <span class="id">t0</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span> <span class="id">t0</span> ++ <span class="id">buf</span>'') (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">tm</span>)); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<div class="doc">Call </div>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#thrdpool_push_valid_original_valid">thrdpool_push_valid_original_valid</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Call">TSOGlobSem.Call</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<div class="doc">Return </div>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#thrdpool_pop_valid_original_valid">thrdpool_pop_valid_original_valid</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#thrdpool_tupdate_valid_original_valid">thrdpool_tupdate_valid_original_valid</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Return">TSOGlobSem.Return</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<div class="doc">Halt </div>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#thrdpool_pop_valid_original_valid">thrdpool_pop_valid_original_valid</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Halt">TSOGlobSem.Halt</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<div class="doc">Print </div>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#thrdpool_tupdate_valid_original_valid">thrdpool_tupdate_valid_original_valid</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#EF_Print">TSOGlobSem.EF_Print</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="TSOSemLemmas.html#Reordering">Reordering</a></span>.<br/>
<br/>
<br/>
<br/>
<br/>
<h1> Prog config eq on individual thread </h1>
<span class="kwd">Definition</span> <span class="id"><a name="eq_thrdp_tm">eq_thrdp_tm</a></span> <span class="id">TGE</span> <span class="id">t</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tpc</span>: @<span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span>) <span class="id">tpc</span>' : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.next_tid">TSOThrdPool.next_tid</a></span> (<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>) = <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.next_tid">TSOThrdPool.next_tid</a></span> (<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id">tpc</span>'))<br/>
&nbsp;&nbsp;/\<br/>
&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.next_fmap">TSOThrdPool.next_fmap</a></span> (<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>) <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.next_fmap">TSOThrdPool.next_fmap</a></span> (<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id">tpc</span>') <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>)<br/>
&nbsp;&nbsp;/\<br/>
&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> (<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>)) !! <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = (<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> (<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id">tpc</span>')) !! <span class="id"><a href="TSOSemLemmas.html#t">t</a></span><br/>
&nbsp;&nbsp;/\<br/>
&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#memory">memory</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>) = <span class="id"><a href="TSOMem.html#memory">memory</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">tpc</span>')<br/>
&nbsp;&nbsp;/\<br/>
&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>) <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">tpc</span>') <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="eq_thrdp_tm_refl">eq_thrdp_tm_refl</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">t</span> <span class="id">tpc</span>, <span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm">eq_thrdp_tm</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10072')">Proof.</div>
<div class="proofscript" id="proof10072">
 <span class="tactic">clear</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm">eq_thrdp_tm</a></span>. <span class="tactic">intuition</span>. Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="eq_thrdp_tm_sym">eq_thrdp_tm_sym</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">t</span> <span class="id">tpc</span> <span class="id">tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm">eq_thrdp_tm</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm">eq_thrdp_tm</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id">tpc</span>' <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10073')">Proof.</div>
<div class="proofscript" id="proof10073">
 <span class="tactic">clear</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm">eq_thrdp_tm</a></span>. <span class="tactic">intuition</span>. Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="eq_thrdp_tm_trans">eq_thrdp_tm_trans</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">t</span> <span class="id">tpc1</span> <span class="id">tpc2</span> <span class="id">tpc3</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm">eq_thrdp_tm</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm">eq_thrdp_tm</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc3">tpc3</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm">eq_thrdp_tm</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc3">tpc3</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10074')">Proof.</div>
<div class="proofscript" id="proof10074">
 <span class="tactic">clear</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm">eq_thrdp_tm</a></span>. <span class="tactic">firstorder</span>; <span class="tactic">congruence</span>. Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="eq_thrdp_tm_tau_step_sim">eq_thrdp_tm_tau_step_sim</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc0</span> <span class="id">fp</span> <span class="id">_tpc0</span> <span class="id">tpc1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc0">tpc0</a></span> = <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#_tpc0">_tpc0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">t</span>', <span class="id">t</span>' &lt;&gt; <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc0">tpc0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> <span class="id">bis</span>, <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc0">tpc0</a></span>) <span class="id">t</span>' = <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#_tpc0">_tpc0</a></span>) <span class="id">t</span>' ++ <span class="id">bis</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm">eq_thrdp_tm</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc0">tpc0</a></span>) <span class="id"><a href="TSOSemLemmas.html#tpc0">tpc0</a></span> <span class="id"><a href="TSOSemLemmas.html#_tpc0">_tpc0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc0">tpc0</a></span> <span class="id"><a href="TSOGlobSem.html#tau">tau</a></span> <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">_tpc1</span>, <span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#_tpc0">_tpc0</a></span> <span class="id"><a href="TSOGlobSem.html#tau">tau</a></span> <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> <span class="id">_tpc1</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">t</span>, <span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm">eq_thrdp_tm</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc0">tpc0</a></span> <span class="id"><a href="TSOSemLemmas.html#_tpc0">_tpc0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm">eq_thrdp_tm</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> <span class="id">_tpc1</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10075')">Proof.</div>
<div class="proofscript" id="proof10075">
&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm">eq_thrdp_tm</a></span>; <span class="tactic">firstorder</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>; <span class="tactic">destruct</span> <span class="id">_tpc0</span>; <span class="id">simpls</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>; <span class="id">simpls</span>. <br/>
<div class="doc">Corestep </div>
&nbsp;&nbsp;<span class="id">eexists</span>. <span class="tactic">split</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H4</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H6</span>, &lt;- <span class="id">H5</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H4</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H0</span> <span class="id">H_unbuf_safe</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#unbuffer_safe_addition_multi_thread_original_still">unbuffer_safe_addition_multi_thread_original_still</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}  <br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">Hnxt_tid_eq</span> &amp; <span class="id">Hnxt_map_eq</span> &amp; <span class="id">Hcontent_eq</span> &amp; <span class="id">Hmem_eq</span> &amp; <span class="id">Ht_buf_eq</span>).<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_upd</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t0</span>); <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">do</span> 2 (<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">do</span> 2 (<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
<div class="doc">At external </div>
&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Call">TSOGlobSem.Call</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H4</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">TSOThrdPool.push</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">H_tp_push</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_push</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H4</span>, <span class="id">H_tp_core</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">Hnxt_tid_eq</span> &amp; <span class="id">Hnxt_map_eq</span> &amp; <span class="id">Hcontent_eq</span> &amp; <span class="id">Hmem_eq</span> &amp; <span class="id">Ht_buf_eq</span>).<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">TSOThrdPool.push</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">H_tp_push</span>; <span class="id">inv</span> <span class="id">H_tp_push</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t0</span>); <span class="id">simpls</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">do</span> 2 (<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hnxt_map_eq</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">do</span> 2 (<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>).<br/>
<div class="doc">Return </div>
&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Return">TSOGlobSem.Return</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H4</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">TSOThrdPool.pop</span>. <br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">H_tp_pop</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_pop</span>. <br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H4</span>, <span class="id">H_tp_core</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">TSOThrdPool.pop</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">H_tp_pop</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_pop</span>; <span class="id">inv</span> <span class="id">H_tp_upd</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">Hnxt_tid_eq</span> &amp; <span class="id">Hnxt_map_eq</span> &amp; <span class="id">Hcontent_eq</span> &amp; <span class="id">Hmem_eq</span> &amp; <span class="id">Ht_buf_eq</span>).<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">TSOThrdPool.pop</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">H_tp_pop</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_pop</span>; <span class="id">inv</span> <span class="id">H_tp_upd</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">simpls</span>; <span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.set2">PMap.set2</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t0</span>); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">do</span> 2 (<span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>).<br/>
<div class="doc">Halt </div>
&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Halt">TSOGlobSem.Halt</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H4</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">TSOThrdPool.pop</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">H_tp_pop</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H4</span>, <span class="id">H_tp_core</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_pop</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">Hnxt_tid_eq</span> &amp; <span class="id">Hnxt_map_eq</span> &amp; <span class="id">Hcontent_eq</span> &amp; <span class="id">Hmem_eq</span> &amp; <span class="id">Ht_buf_eq</span>).<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">TSOThrdPool.pop</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">H_tp_pop</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_pop</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t0</span>); <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">do</span> 2 (<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;<span class="tactic">do</span> 2 (<span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>).<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="eq_thrdp_tm_ub_step_sim">eq_thrdp_tm_ub_step_sim</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc</span> <span class="id">tpc</span>' <span class="id">t</span> <span class="id">_tpc</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> (<span class="id"><a href="TSOGlobSem.html#ub">ub</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm">eq_thrdp_tm</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id"><a href="TSOSemLemmas.html#_tpc">_tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">_tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#_tpc">_tpc</a></span> (<span class="id"><a href="TSOGlobSem.html#ub">ub</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">_tpc</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">t</span>', <span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm">eq_thrdp_tm</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id">t</span>' <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id"><a href="TSOSemLemmas.html#_tpc">_tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm">eq_thrdp_tm</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id">t</span>' <span class="id">tpc</span>' <span class="id">_tpc</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10076')">Proof.</div>
<div class="proofscript" id="proof10076">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H0</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">_tpc</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> (<span class="id">Hnxt_map_eq</span> &amp; <span class="id">Hcontent_eq</span> &amp; <span class="id">Hmem_eq</span> &amp; <span class="id">Ht_buf_eq</span>).<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">unbuffer</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="id">simpls</span>; <span class="id">tryfalse</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_unbuf</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">TSOThrdPool.valid_tid</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unbuffer">unbuffer</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Ht_buf_eq</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hmem_eq</span>, <span class="id">Hx0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">eq_thrdp_tm</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hnxt_tid_eq</span>' &amp; <span class="id">Hnxt_map_eq</span>' &amp; <span class="id">Hcontent_eq</span>' &amp; <span class="id">Hmem_eq</span>' &amp; <span class="id">Ht_buf_eq</span>').<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="eq_thrdp_tm_print_step_sim">eq_thrdp_tm_print_step_sim</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc0</span> <span class="id">v</span> <span class="id">_tpc0</span> <span class="id">tpc1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc0">tpc0</a></span> = <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#_tpc0">_tpc0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm">eq_thrdp_tm</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc0">tpc0</a></span>) <span class="id"><a href="TSOSemLemmas.html#tpc0">tpc0</a></span> <span class="id"><a href="TSOSemLemmas.html#_tpc0">_tpc0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc0">tpc0</a></span> (<span class="id"><a href="TSOGlobSem.html#evt">evt</a></span> <span class="id"><a href="TSOSemLemmas.html#v">v</a></span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">_tpc1</span>, <span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#_tpc0">_tpc0</a></span> (<span class="id"><a href="TSOGlobSem.html#evt">evt</a></span> <span class="id"><a href="TSOSemLemmas.html#v">v</a></span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">_tpc1</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">t</span>, <span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm">eq_thrdp_tm</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc0">tpc0</a></span> <span class="id"><a href="TSOSemLemmas.html#_tpc0">_tpc0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm">eq_thrdp_tm</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> <span class="id">_tpc1</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10077')">Proof.</div>
<div class="proofscript" id="proof10077">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>; <span class="id">inv</span> <span class="id">H1</span>; <span class="id">simpls</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H3</span> <span class="kwd">as</span> (<span class="id">Hnxt_map_eq</span> &amp; <span class="id">Hcontent_eq</span> &amp; <span class="id">Hmem_eq</span> &amp; <span class="id">Ht_buf_eq</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">_tpc0</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_upd</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.  <br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#EF_Print">TSOGlobSem.EF_Print</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hcontent_eq</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hcontent_eq</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">eq_thrdp_tm</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hnxt_tid_eq</span>' &amp; <span class="id">Hnxt_map_eq</span>' &amp; <span class="id">Hcontent_eq</span>' &amp; <span class="id">Hmem_eq</span>' &amp; <span class="id">Ht_buf_eq</span>').<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">cid</span> <span class="id">t</span>); <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">do</span> 2 (<span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>).<br/>
Qed.</div>
&nbsp;&nbsp;<br/>
<span class="kwd">Definition</span> <span class="id"><a name="thrd_valid">thrd_valid</a></span> {<span class="id">TGE</span>: <span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.t">TSOGlobEnv.t</a></span>} (<span class="id">tpc</span>: @<span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span>) (<span class="id">t</span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.valid_tid">TSOThrdPool.valid_tid</a></span> (<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>) <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>.<br/>
&nbsp;&nbsp;<br/>
<span class="kwd">Definition</span> <span class="id"><a name="thrd_not_halted">thrd_not_halted</a></span> {<span class="id">TGE</span>: <span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.t">TSOGlobEnv.t</a></span>} (<span class="id">tpc</span>: @<span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span>) (<span class="id">t</span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;~ <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.halted">TSOThrdPool.halted</a></span> (<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>) <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="switchable">switchable</a></span> {<span class="id">TGE</span>: <span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.t">TSOGlobEnv.t</a></span>} (<span class="id">tpc</span>: @<span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span>) (<span class="id">t</span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#thrd_valid">thrd_valid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> /\ <span class="id"><a href="TSOSemLemmas.html#thrd_not_halted">thrd_not_halted</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="eq_thrdp_tm_valid">eq_thrdp_tm_valid</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">t</span> <span class="id">tpc</span> <span class="id">tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm">eq_thrdp_tm</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#thrd_valid">thrd_valid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#thrd_valid">thrd_valid</a></span> <span class="id">tpc</span>' <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10078')">Proof.</div>
<div class="proofscript" id="proof10078">
&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#thrd_valid">thrd_valid</a></span>. <span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="eq_thrdp_tm_halted">eq_thrdp_tm_halted</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">t</span> <span class="id">tpc</span> <span class="id">tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm">eq_thrdp_tm</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#thrd_not_halted">thrd_not_halted</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#thrd_not_halted">thrd_not_halted</a></span> <span class="id">tpc</span>' <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10079')">Proof.</div>
<div class="proofscript" id="proof10079">
&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#thrd_not_halted">thrd_not_halted</a></span>. <span class="tactic">intros</span> <span class="id">TGE</span> <span class="id">t</span> <span class="id">tpc</span> <span class="id">tpc</span>' <span class="id">H</span> <span class="id">A</span> <span class="id">C</span>; <span class="tactic">apply</span> <span class="id">A</span>; <span class="tactic">clear</span> <span class="id">A</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>. <span class="tactic">intuition</span>. <span class="id">inv</span> <span class="id">C</span>; <span class="id">constructor</span>. <span class="tactic">congruence</span>.<br/>
Qed.</div>
&nbsp;&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="eq_thrdp_tm_sw_step_sim">eq_thrdp_tm_sw_step_sim</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc0</span> <span class="id">fp</span> <span class="id">_tpc0</span> <span class="id">tpc1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc0">tpc0</a></span> = <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#_tpc0">_tpc0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">t</span>, <span class="id"><a href="TSOSemLemmas.html#switchable">switchable</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc0">tpc0</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> -&gt; <span class="id"><a href="TSOSemLemmas.html#switchable">switchable</a></span> <span class="id"><a href="TSOSemLemmas.html#_tpc0">_tpc0</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc0">tpc0</a></span> <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">_tpc1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> = <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">_tpc1</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#_tpc0">_tpc0</a></span> <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> <span class="id">_tpc1</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">t</span>, <span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm">eq_thrdp_tm</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc0">tpc0</a></span> <span class="id"><a href="TSOSemLemmas.html#_tpc0">_tpc0</a></span> -&gt; <span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm">eq_thrdp_tm</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> <span class="id">_tpc1</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10080')">Proof.</div>
<div class="proofscript" id="proof10080">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>; <span class="id">simpls</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">_tpc0</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">switchable</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">thrd_valid</span>, <span class="id">thrd_not_halted</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.valid_tid">TSOThrdPool.valid_tid</a></span> <span class="id">thdp</span> <span class="id">t</span>' /\ ~ <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.halted">TSOThrdPool.halted</a></span> <span class="id">thdp</span> <span class="id">t</span>').<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="id">Focus</span> 2.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H4</span> <span class="kwd">as</span> (<span class="id">Hnxt_map_eq</span>' &amp; <span class="id">Hcontent_eq</span>' &amp; <span class="id">Hmem_eq</span>' &amp; <span class="id">Ht_buf_eq</span>').<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="buffer_insert_cid_label">buffer_insert_cid_label</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc0</span> <span class="id">tpc1</span> <span class="id">l0</span> <span class="id">fp0</span> <span class="id">t0</span> <span class="id">bis</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc0">tpc0</a></span> <span class="id"><a href="TSOSemLemmas.html#l0">l0</a></span> <span class="id"><a href="TSOSemLemmas.html#fp0">fp0</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span>) <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc0">tpc0</a></span>) <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> ++ <span class="id"><a href="TSOSemLemmas.html#bis">bis</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#bis">bis</a></span> &lt;&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc0">tpc0</a></span> /\ <span class="id"><a href="TSOSemLemmas.html#l0">l0</a></span> = <span class="id"><a href="TSOGlobSem.html#tau">tau</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10081')">Proof.</div>
<div class="proofscript" id="proof10081">
&nbsp;&nbsp;<span class="kwd">Ltac</span> <span class="id">bis_nil</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : ?<span class="id">A</span> = ?<span class="id">A</span> ++ ?<span class="id">B</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#append_ls_still_nil">append_ls_still_nil</a></span> <span class="kwd">in</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="id">simpls</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="id">bis_nil</span>; <span class="id">tryfalse</span>].<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">tupdate</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">bis_nil</span>; <span class="id">tryfalse</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">unbuffer</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_unbuf</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">tupdate</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span> <span class="id">t</span>') = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id">b</span> :: <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span> <span class="id">t</span>' ++ <span class="id">bis</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hx</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_length">app_length</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span> <span class="id">t0</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span> <span class="id">t0</span> ++ <span class="id">bis</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_length">app_length</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bis</span>; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="subset_intersect_full_intersect">subset_intersect_full_intersect</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fp</span> <span class="id">fp</span>' <span class="id">fp0</span> <span class="id">b</span> <span class="id">ofs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Footprint.html#Locs.subset">Locs.subset</a></span> <span class="id">fp</span>' <span class="id"><a href="TSOSemLemmas.html#fp0">fp0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Footprint.html#Locs.intersect">Locs.intersect</a></span> <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> <span class="id">fp</span>' <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> <span class="id"><a href="TSOSemLemmas.html#ofs">ofs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Footprint.html#Locs.intersect">Locs.intersect</a></span> <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> <span class="id"><a href="TSOSemLemmas.html#fp0">fp0</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> <span class="id"><a href="TSOSemLemmas.html#ofs">ofs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10082')">Proof.</div>
<div class="proofscript" id="proof10082">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Locs.subset</span>, <span class="id">Locs.intersect</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H</span> <span class="id">b</span> <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Locs.belongsto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">fp</span> <span class="id">b</span> <span class="id">ofs</span>) <span class="id">eqn</span>:?; <span class="tactic">destruct</span> (<span class="id">fp</span>' <span class="id">b</span> <span class="id">ofs</span>) <span class="id">eqn</span>:?; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="fp_subset_conflict_full_conflict">fp_subset_conflict_full_conflict</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fp</span> <span class="id">fp</span>' <span class="id">fp0</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Footprint.html#FP.conflict">FP.conflict</a></span> <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> <span class="id">fp</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Footprint.html#FP.subset">FP.subset</a></span> <span class="id">fp</span>' <span class="id"><a href="TSOSemLemmas.html#fp0">fp0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Footprint.html#FP.conflict">FP.conflict</a></span> <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> <span class="id"><a href="TSOSemLemmas.html#fp0">fp0</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10083')">Proof.</div>
<div class="proofscript" id="proof10083">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="USimDRF.html#smile_conflict">USimDRF.smile_conflict</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="USimDRF.html#smile_conflict">USimDRF.smile_conflict</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="FPLemmas.html#fpsmile_subset">FPLemmas.fpsmile_subset</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="conflict_bi_subset_fp_conflict">conflict_bi_subset_fp_conflict</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span> <span class="id">fp</span> <span class="id">fp0</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#conflict_bi">conflict_bi</a></span> <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Footprint.html#FP.subset">FP.subset</a></span> (<span class="id"><a href="TSOMem.html#bi_footprint">bi_footprint</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span>) <span class="id"><a href="TSOSemLemmas.html#fp0">fp0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Footprint.html#FP.conflict">FP.conflict</a></span> <span class="id"><a href="TSOSemLemmas.html#fp0">fp0</a></span> <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10084')">Proof.</div>
<div class="proofscript" id="proof10084">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">conflict_bi</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Footprint.html#FP.conflict_sym">FP.conflict_sym</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#fp_subset_conflict_full_conflict">fp_subset_conflict_full_conflict</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="exec_store_TSO_bf_additional_subst_fp">exec_store_TSO_bf_additional_subst_fp</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ge</span> <span class="id">rs</span> <span class="id">bm</span> <span class="id">rs</span>' <span class="id">bm</span>' <span class="id">bis</span> <span class="id">bi</span> <span class="id">c</span> <span class="id">a</span> <span class="id">rd</span> <span class="id">ls</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#exec_store_TSO">exec_store_TSO</a></span> <span class="id"><a href="TSOSemLemmas.html#ge">ge</a></span> <span class="id"><a href="TSOSemLemmas.html#c">c</a></span> <span class="id"><a href="TSOSemLemmas.html#bm">bm</a></span> <span class="id"><a href="TSOSemLemmas.html#a">a</a></span> <span class="id"><a href="TSOSemLemmas.html#rs">rs</a></span> <span class="id"><a href="TSOSemLemmas.html#rd">rd</a></span> <span class="id"><a href="TSOSemLemmas.html#ls">ls</a></span> = <span class="kwd">Next</span> <span class="id">rs</span>' <span class="id">bm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">bm</span>' = <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOSemLemmas.html#bm">bm</a></span> ++ <span class="id"><a href="TSOSemLemmas.html#bis">bis</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#bis">bis</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Footprint.html#FP.subset">FP.subset</a></span> (<span class="id"><a href="TSOMem.html#bi_footprint">bi_footprint</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span>) (<span class="id"><a href="AsmLang.html#exec_store_fp">exec_store_fp</a></span> <span class="id"><a href="TSOSemLemmas.html#ge">ge</a></span> <span class="id"><a href="TSOSemLemmas.html#c">c</a></span> <span class="id"><a href="TSOSemLemmas.html#a">a</a></span> <span class="id"><a href="TSOSemLemmas.html#rs">rs</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10085')">Proof.</div>
<div class="proofscript" id="proof10085">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">exec_store_TSO</span>, <span class="id">tsostorev</span>, <span class="id">tsostore</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hx</span>; <span class="id">inv_next</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">buffer_insert</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_inv_head">app_inv_head</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span>; <span class="tactic">subst</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmLang.html#exec_store_fp">exec_store_fp</a></span>, <span class="id"><a href="FMemOpFP.html#storev_fp">FMemOpFP.storev_fp</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hx0</span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Footprint.html#FP.subset_refl">FP.subset_refl</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
&nbsp;&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="exec_instr_TSO_bf_additional_subst_fp">exec_instr_TSO_bf_additional_subst_fp</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ge</span> <span class="id">f</span> <span class="id">i</span> <span class="id">rs</span> <span class="id">bm</span> <span class="id">rs</span>' <span class="id">bm</span>' <span class="id">bis</span> <span class="id">bi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#exec_instr_TSO">exec_instr_TSO</a></span> <span class="id"><a href="TSOSemLemmas.html#ge">ge</a></span> <span class="id"><a href="TSOSemLemmas.html#f">f</a></span> <span class="id"><a href="TSOSemLemmas.html#i">i</a></span> <span class="id"><a href="TSOSemLemmas.html#rs">rs</a></span> <span class="id"><a href="TSOSemLemmas.html#bm">bm</a></span> = <span class="kwd">Next</span> <span class="id">rs</span>' <span class="id">bm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">bm</span>' = <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOSemLemmas.html#bm">bm</a></span> ++ <span class="id"><a href="TSOSemLemmas.html#bis">bis</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#bis">bis</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Footprint.html#FP.subset">FP.subset</a></span> (<span class="id"><a href="TSOMem.html#bi_footprint">bi_footprint</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span>) (<span class="id"><a href="AsmTSO.html#exec_instr_TSO_fp">exec_instr_TSO_fp</a></span> <span class="id"><a href="TSOSemLemmas.html#ge">ge</a></span> <span class="id"><a href="TSOSemLemmas.html#f">f</a></span> <span class="id"><a href="TSOSemLemmas.html#i">i</a></span> <span class="id"><a href="TSOSemLemmas.html#rs">rs</a></span> <span class="id"><a href="TSOSemLemmas.html#bm">bm</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10086')">Proof.</div>
<div class="proofscript" id="proof10086">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">i</span>; <span class="id">simpls</span>; <span class="id">ex_match2</span>; <span class="tactic">try</span> <span class="id">inv_next</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#append_ls_still_nil">append_ls_still_nil</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="id">simpls</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>; <span class="id">tryfalse</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="id">unfolds</span> <span class="id">exec_load_TSO</span>, <span class="id">tsoloadv</span>; <span class="id">ex_match2</span>; <span class="tactic">try</span> <span class="id">inv_next</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#append_ls_still_nil">append_ls_still_nil</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="id">simpls</span>; <span class="tactic">subst</span>; <span class="id">tryfalse</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#exec_store_TSO_bf_additional_subst_fp">exec_store_TSO_bf_additional_subst_fp</a></span>; <span class="tactic">eauto</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="id">unfolds</span> <span class="id">tso_goto_label</span>; <span class="id">ex_match2</span>; <span class="id">inv_next</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#append_ls_still_nil">append_ls_still_nil</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="id">simpls</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>; <span class="id">tryfalse</span>].<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">tsoloadv</span>, <span class="id">tsoload</span>; <span class="id">ex_match2</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_inv_head">app_inv_head</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span>; <span class="tactic">subst</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#FP.union_comm_eq">FP.union_comm_eq</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Footprint.html#FP.union_subset">FP.union_subset</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="store_args_rec_fmem_apply_buf_subst">store_args_rec_fmem_apply_buf_subst</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">args</span> <span class="id">bm</span> <span class="id">bm</span>' <span class="id">stk</span> <span class="id">tys</span> <span class="id">z</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#store_args_rec_fmem">store_args_rec_fmem</a></span> <span class="id"><a href="TSOSemLemmas.html#bm">bm</a></span> (<span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id"><a href="TSOSemLemmas.html#stk">stk</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0)) <span class="id"><a href="TSOSemLemmas.html#z">z</a></span> <span class="id"><a href="TSOSemLemmas.html#args">args</a></span> <span class="id"><a href="TSOSemLemmas.html#tys">tys</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">bm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">bis</span>, <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">bm</span>' = <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOSemLemmas.html#bm">bm</a></span> ++ <span class="id">bis</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">bi</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id">bis</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Footprint.html#FP.subset">FP.subset</a></span> (<span class="id"><a href="TSOMem.html#bi_footprint">bi_footprint</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="loadframe.html#store_args_rec_fp">loadframe.store_args_rec_fp</a></span> <span class="id"><a href="TSOSemLemmas.html#stk">stk</a></span> <span class="id"><a href="TSOSemLemmas.html#z">z</a></span> <span class="id"><a href="TSOSemLemmas.html#tys">tys</a></span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10087')">Proof.</div>
<div class="proofscript" id="proof10087">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">args</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tys</span>; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tys</span>; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">t</span>; <span class="id">simpls</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id">IHargs</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">unfolds</span> <span class="id">buffer_insert</span>; <span class="id">simpls</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">bis</span> &amp; <span class="id">Htbuf</span> &amp; <span class="id">Hbi_subset_fp</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc_reverse">app_assoc_reverse</a></span> <span class="kwd">in</span> <span class="id">Htbuf</span>; <span class="id">simpls</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Htbuf</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>; <span class="tactic">split</span>; <span class="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="id">simpls</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">unfold</span> <span class="id"><a href="loadframe.html#store_stack_fp">loadframe.store_stack_fp</a></span>; <span class="id">simpls</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Footprint.html#FP.union_subset">FP.union_subset</a></span>; <span class="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hbi_subset_fp</span> <span class="kwd">in</span> <span class="id">H</span> | <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#FP.union_comm_eq">FP.union_comm_eq</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Footprint.html#FP.subset_union_subset">FP.subset_union_subset</a></span>; <span class="tactic">eauto</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="id">simpls</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHargs</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">bis</span> &amp; <span class="id">Htbuf</span> &amp; <span class="id">Hbi_subset_fp</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc_reverse">app_assoc_reverse</a></span> <span class="kwd">in</span> <span class="id">Htbuf</span>); <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Htbuf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="GDefLemmas.html#fp_union_comm">GDefLemmas.fp_union_comm</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="loadframe.html#store_stack_fp">loadframe.store_stack_fp</a></span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#FP.union_comm_eq">FP.union_comm_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="GDefLemmas.html#fp_union_comm">GDefLemmas.fp_union_comm</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Footprint.html#FP.union_subset">FP.union_subset</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="GDefLemmas.html#fp_union_comm">GDefLemmas.fp_union_comm</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">loadframe.store_stack_fp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Footprint.html#FP.union_subset">FP.union_subset</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hbi_subset_fp</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#FP.union_comm_eq">FP.union_comm_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Footprint.html#FP.subset_union_subset">FP.subset_union_subset</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="tsofstep_bf_addition_subst_fp">tsofstep_bf_addition_subst_fp</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ge</span> <span class="id">c</span> <span class="id">bm</span> <span class="id">c</span>' <span class="id">bm</span>' <span class="id">fp</span> <span class="id">bi</span> <span class="id">bis</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span> <span class="id"><a href="TSOSemLemmas.html#ge">ge</a></span> <span class="id"><a href="TSOSemLemmas.html#c">c</a></span> <span class="id"><a href="TSOSemLemmas.html#bm">bm</a></span> <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> <span class="id">c</span>' <span class="id">bm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">bm</span>' = <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOSemLemmas.html#bm">bm</a></span> ++ <span class="id"><a href="TSOSemLemmas.html#bis">bis</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#bis">bis</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Footprint.html#FP.subset">FP.subset</a></span> (<span class="id"><a href="TSOMem.html#bi_footprint">bi_footprint</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span>) <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10088')">Proof.</div>
<div class="proofscript" id="proof10088">
&nbsp;&nbsp;<span class="tactic">intros</span>. <br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#append_ls_still_nil">append_ls_still_nil</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="id">simpls</span>; <span class="tactic">subst</span>; <span class="id">tryfalse</span>].<br/>
<div class="doc">internal step </div>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#exec_instr_TSO_bf_additional_subst_fp">exec_instr_TSO_bf_additional_subst_fp</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
<div class="doc">alloc step </div>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">tsostorev</span>, <span class="id">tsostore</span>, <span class="id">buffer_insert</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H7</span>; <span class="id">inv</span> <span class="id">H8</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc_reverse">app_assoc_reverse</a></span> <span class="kwd">in</span> <span class="id">H0</span>); <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_inv_head">app_inv_head</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Footprint.html#FP.union_subset">FP.union_subset</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#FP.union_comm_eq">FP.union_comm_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="Footprint.html#FP.fp_union_assoc">FP.fp_union_assoc</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Footprint.html#FP.union_subset">FP.union_subset</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>; <span class="id">tryfalse</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#FP.fp_union_assoc">FP.fp_union_assoc</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#FP.union_comm_eq">FP.union_comm_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Footprint.html#FP.union_subset">FP.union_subset</a></span>.<br/>
&nbsp;&nbsp;}<br/>
<div class="doc">initialization </div>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H3</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store_args_fmem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="loadframe.html#store_args_fp">loadframe.store_args_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#store_args_rec_fmem_apply_buf_subst">store_args_rec_fmem_apply_buf_subst</a></span> <span class="kwd">in</span> <span class="id">H5</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H5</span> <span class="kwd">as</span> [<span class="id">bis</span>' [<span class="id">Hbuf</span> <span class="id">Hsubset</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hbuf</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc_reverse">app_assoc_reverse</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_inv_head">app_inv_head</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span>; <span class="tactic">subst</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#tsoalloc_fp">tsoalloc_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Footprint.html#FP.union_subset">FP.union_subset</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#FP.union_comm_eq">FP.union_comm_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Footprint.html#FP.subset_union_subset">FP.subset_union_subset</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hsubset</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="bis_subst_fp">bis_subst_fp</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc0</span> <span class="id">tpc1</span> <span class="id">l</span> <span class="id">fp</span> <span class="id">bi</span> <span class="id">bis</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc0">tpc0</a></span> <span class="id"><a href="TSOSemLemmas.html#l">l</a></span> <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">t0</span> := <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc0">tpc0</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span>) <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc0">tpc0</a></span>) <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> ++ <span class="id"><a href="TSOSemLemmas.html#bis">bis</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#bis">bis</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Footprint.html#FP.subset">FP.subset</a></span> (<span class="id"><a href="TSOMem.html#bi_footprint">bi_footprint</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span>) <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10089')">Proof.</div>
<div class="proofscript" id="proof10089">
&nbsp;&nbsp;<span class="tactic">intros</span>. <br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="id">simpls</span>; <span class="tactic">subst</span> <span class="id">t0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#append_ls_still_nil">append_ls_still_nil</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="id">tryfalse</span>].<br/>
<div class="doc">Core Step </div>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_core_step</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#tsofstep_bf_addition_subst_fp">tsofstep_bf_addition_subst_fp</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
<div class="doc">Unbuffer </div>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">unbuffer</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_unbuf</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">tupdate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span> <span class="id">t</span>') = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id">b</span> :: <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span> <span class="id">t</span>' ++ <span class="id">bis</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hx</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_length">app_length</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#append_ls_still_nil">append_ls_still_nil</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="conflict_bi_conflict_fp">conflict_bi_conflict_fp</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc0</span> <span class="id">tpc1</span> <span class="id">l0</span> <span class="id">fp0</span> <span class="id">bi</span> <span class="id">bis</span> <span class="id">fp</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc0">tpc0</a></span> <span class="id"><a href="TSOSemLemmas.html#l0">l0</a></span> <span class="id"><a href="TSOSemLemmas.html#fp0">fp0</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">t0</span> := <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc0">tpc0</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span>) <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc0">tpc0</a></span>) <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> ++ <span class="id"><a href="TSOSemLemmas.html#bis">bis</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#bis">bis</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#conflict_bi">conflict_bi</a></span> <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Footprint.html#FP.conflict">FP.conflict</a></span> <span class="id"><a href="TSOSemLemmas.html#fp0">fp0</a></span> <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10090')">Proof.</div>
<div class="proofscript" id="proof10090">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">subst</span> <span class="id">t0</span>.<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hfp_subst</span> : <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#bis_subst_fp">bis_subst_fp</a></span> <span class="kwd">in</span> <span class="id">Hfp_subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#conflict_bi_subset_fp_conflict">conflict_bi_subset_fp_conflict</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="less_buffer_item_not_unbuffered_ub_sim">less_buffer_item_not_unbuffered_ub_sim</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc</span> <span class="id">tpc</span>' <span class="id">t</span> <span class="id">head</span> <span class="id">bi</span> <span class="id">tail</span> <span class="id">head</span>' <span class="id">_tpc</span> <span class="id">_tail</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#memory">memory</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>) = <span class="id"><a href="TSOMem.html#memory">memory</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#_tpc">_tpc</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> (<span class="id"><a href="TSOGlobSem.html#ub">ub</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>) <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="TSOSemLemmas.html#head">head</a></span> ++ <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> :: <span class="id"><a href="TSOSemLemmas.html#tail">tail</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">tpc</span>') <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id">head</span>' ++ <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> :: <span class="id"><a href="TSOSemLemmas.html#tail">tail</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#_tpc">_tpc</a></span>) <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="TSOSemLemmas.html#head">head</a></span> ++ <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> :: <span class="id"><a href="TSOSemLemmas.html#_tail">_tail</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOSemLemmas.html#thrd_valid">thrd_valid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> -&gt; <span class="id"><a href="TSOSemLemmas.html#thrd_valid">thrd_valid</a></span> <span class="id"><a href="TSOSemLemmas.html#_tpc">_tpc</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">_tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#_tpc">_tpc</a></span> (<span class="id"><a href="TSOGlobSem.html#ub">ub</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">_tpc</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">_tpc</span>') <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id">head</span>' ++ <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> :: <span class="id"><a href="TSOSemLemmas.html#_tail">_tail</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10091')">Proof.</div>
<div class="proofscript" id="proof10091">
&nbsp;&nbsp;<span class="id">introv</span> <span class="id">Hmem_eq</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">thrd_valid</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">_tpc</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">unbuffer</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">head</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H_unbuf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_unbuf</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unbuffer">unbuffer</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hmem_eq</span>, <span class="id">Hx</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">tail</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id">head</span>' ++ <span class="id">bi</span> :: <span class="id">tail</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_length">app_length</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H_unbuf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_unbuf</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unbuffer">unbuffer</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span>, &lt;- <span class="id">Hmem_eq</span>, <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_inv_tail">app_inv_tail</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="ub_star_thdp_cid_unchg">ub_star_thdp_cid_unchg</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">t</span> <span class="id">tpc</span> <span class="id">tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#ub_star">ub_star</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id">tpc</span>' = <span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> /\ <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc</span>' = <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10092')">Proof.</div>
<div class="proofscript" id="proof10092">
 <span class="tactic">clear</span>. <span class="tactic">induction</span> 1; <span class="tactic">auto</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span>. Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="glob_step_fp_smile_conflictc_preserve">glob_step_fp_smile_conflictc_preserve</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc</span> <span class="id">l</span> <span class="id">fp</span> <span class="id">tpc</span>' <span class="id">t0</span> <span class="id">fp0</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id"><a href="TSOSemLemmas.html#l">l</a></span> <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Footprint.html#FP.smile">FP.smile</a></span> <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> <span class="id"><a href="TSOSemLemmas.html#fp0">fp0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="ClientSim.html#conflictc">conflictc</a></span> <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> <span class="id"><a href="TSOSemLemmas.html#fp0">fp0</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="ClientSim.html#conflictc">conflictc</a></span> <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> <span class="id"><a href="TSOSemLemmas.html#fp0">fp0</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">tpc</span>')).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10093')">Proof.</div>
<div class="proofscript" id="proof10093">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hglob_step</span> : <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
<div class="doc">CoreStep </div>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H1</span>; <span class="tactic">clear</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hbf</span> : <span class="id">H_core_step</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#tso_step_buf_add">tso_step_buf_add</a></span> <span class="kwd">in</span> <span class="id">Hbf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hbf</span> <span class="kwd">as</span> [<span class="id">buf</span>'' <span class="id">Hbf</span>]; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#in_or_app_rev">in_or_app_rev</a></span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">conflict_bi</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hfp_bf_item_subset</span> : <span class="id">Hglob_step</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#bis_subst_fp">bis_subst_fp</a></span> <span class="kwd">in</span> <span class="id">Hfp_bf_item_subset</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Focus</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#conflict_bi_subset_fp_conflict">conflict_bi_subset_fp_conflict</a></span> <span class="kwd">in</span> <span class="id">H3</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Footprint.html#FP.smile_conflict_compat">FP.smile_conflict_compat</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;}<br/>
<div class="doc">Unbuffer </div>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H1</span>; <span class="tactic">clear</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">unbuffer</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_unbuf</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">eauto</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hx</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="step_diff_tid_thrdp_eq">step_diff_tid_thrdp_eq</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc</span> <span class="id">l</span> <span class="id">fp</span> <span class="id">tpc</span>' <span class="id">t</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> &lt;&gt; <span class="id">t</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id"><a href="TSOSemLemmas.html#l">l</a></span> <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> (<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id">tpc</span>')) !! <span class="id">t</span>' =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> (<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>)) !! <span class="id">t</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10094')">Proof.</div>
<div class="proofscript" id="proof10094">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="id">inv</span> <span class="id">H_tp_upd</span>; <span class="id">simpls</span>; <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>].<br/>
<div class="doc">ext call </div>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">TSOThrdPool.push</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">H_tp_push</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_push</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>. <br/>
<div class="doc">return </div>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">TSOThrdPool.pop</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">H_tp_pop</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_pop</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_upd</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">do</span> 2 (<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>).<br/>
<div class="doc">halt </div>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">TSOThrdPool.pop</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">H_tp_pop</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_pop</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
&nbsp;&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="smile_sym">smile_sym</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fp1</span> <span class="id">fp2</span>, <span class="id"><a href="Footprint.html#FP.smile">FP.smile</a></span> <span class="id"><a href="TSOSemLemmas.html#fp1">fp1</a></span> <span class="id"><a href="TSOSemLemmas.html#fp2">fp2</a></span> -&gt; <span class="id"><a href="Footprint.html#FP.smile">FP.smile</a></span> <span class="id"><a href="TSOSemLemmas.html#fp2">fp2</a></span> <span class="id"><a href="TSOSemLemmas.html#fp1">fp1</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10095')">Proof.</div>
<div class="proofscript" id="proof10095">
 <span class="tactic">eapply</span> <span class="id"><a href="FPLemmas.html#fpsmile_sym">FPLemmas.fpsmile_sym</a></span>; <span class="tactic">eauto</span>. Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="evt_step_emp_fp">evt_step_emp_fp</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc</span> <span class="id">v</span> <span class="id">fp</span> <span class="id">tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> (<span class="id"><a href="TSOGlobSem.html#evt">evt</a></span> <span class="id"><a href="TSOSemLemmas.html#v">v</a></span>) <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> = <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10096')">Proof.</div>
<div class="proofscript" id="proof10096">
 <span class="tactic">clear</span>. <span class="tactic">inversion</span> 1; <span class="tactic">auto</span>. Qed.</div>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="sw_step_eq_config_but_cid">sw_step_eq_config_but_cid</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc</span> <span class="id">tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid">eq_config_but_cid</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id">tpc</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10097')">Proof.</div>
<div class="proofscript" id="proof10097">
 <span class="tactic">clear</span>. <span class="tactic">inversion</span> 1; <span class="id">constructor</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="GMemory.html#GMem.eq_refl">GMem.eq_refl</a></span>. Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="ub_step_buffer_pop">ub_step_buffer_pop</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc</span> <span class="id">t</span> <span class="id">tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> (<span class="id"><a href="TSOGlobSem.html#ub">ub</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">bi</span>, <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>) <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id">bi</span> :: <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">tpc</span>') <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10098')">Proof.</div>
<div class="proofscript" id="proof10098">
&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">inversion</span> 1. <span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unbuffer">unbuffer</a></span> <span class="kwd">in</span> *. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span> <span class="id">t</span>). <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span>; <span class="id">inv</span> <span class="id">H_unbuf</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>. <span class="tactic">eauto</span>. <span class="id">contradiction</span>.<br/>
Qed.</div>
&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="eq_config_eq_ub_star">eq_config_eq_ub_star</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc0</span> <span class="id">tpc1</span> <span class="id">tpc0</span>' <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_config">eq_config</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc0">tpc0</a></span> <span class="id">tpc0</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#ub_star">ub_star</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc0">tpc0</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">tpc1</span>', <span class="id"><a href="TSOSemLemmas.html#ub_star">ub_star</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id">tpc0</span>' <span class="id">tpc1</span>' /\ <span class="id"><a href="TSOSemLemmas.html#eq_config">eq_config</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> <span class="id">tpc1</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10099')">Proof.</div>
<div class="proofscript" id="proof10099">
&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span>. <span class="id">revert</span> <span class="id">tpc0</span>' <span class="id">H</span>. <span class="tactic">induction</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">exists</span> <span class="id">tpc0</span>'. <span class="tactic">split</span>; [<span class="id">constructor</span> | <span class="tactic">auto</span>].<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_eq_step">eq_config_eq_step</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">tpc1</span>' &amp; <span class="id">Hub0</span>' &amp; <span class="id">Heq</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHub_star</span> <span class="kwd">in</span> <span class="id">Heq</span>. <span class="tactic">destruct</span> <span class="id">Heq</span> <span class="kwd">as</span> (<span class="id">tpc2</span>' &amp; <span class="id">Hubstar</span>' &amp; <span class="id">Heq</span>).<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">tpc2</span>'. <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="non_conflicting_tau_step_buffer_fp_smile">non_conflicting_tau_step_buffer_fp_smile</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc</span> <span class="id">fp</span> <span class="id">tpc</span>' <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id"><a href="TSOGlobSem.html#tau">tau</a></span> <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>) (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="ClientSim.html#conflictc">conflictc</a></span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>) <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> &lt;&gt; <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span> <span class="id">bi</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">tpc</span>') (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">bi</span>' (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">tpc</span>') <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Footprint.html#FP.smile">FP.smile</a></span> (<span class="id"><a href="TSOMem.html#bi_footprint">bi_footprint</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span>) (<span class="id"><a href="TSOMem.html#bi_footprint">bi_footprint</a></span> <span class="id">bi</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10100')">Proof.</div>
<div class="proofscript" id="proof10100">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Footprint.html#FP.smile_conflict_compat">FP.smile_conflict_compat</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H1</span>; <span class="tactic">clear</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id">bi</span>').<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H4</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">tupdate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hglob_step</span> : <span class="id">H</span>. <br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">eauto</span>; <span class="id">simpls</span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H3</span>; <span class="id">simpls</span>; <span class="id">tryfalse</span>].<br/>
<div class="doc">Core Step </div>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hbf</span> : <span class="id">H_core_step</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#tso_step_buf_add">tso_step_buf_add</a></span> <span class="kwd">in</span> <span class="id">Hbf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hbf</span> <span class="kwd">as</span> [<span class="id">buf</span>'' <span class="id">Hbf</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">Hbf</span>; <span class="id">simpls</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hfp_buf_subset</span> : <span class="id">Hglob_step</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#bis_subst_fp">bis_subst_fp</a></span> <span class="kwd">in</span> <span class="id">Hfp_buf_subset</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Focus</span> 2. <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Focus</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id">bi</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">tupdate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H5</span> <span class="id">Hfp_buf_subset</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Footprint.html#FP.conflict_sym">FP.conflict_sym</a></span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#fp_subset_conflict_full_conflict">fp_subset_conflict_full_conflict</a></span> <span class="kwd">in</span> <span class="id">H5</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="ClientSim.html#conflict_bi">conflict_bi</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Footprint.html#FP.conflict_sym">FP.conflict_sym</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="ub_steps_reorder">ub_steps_reorder</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc1</span> <span class="id">tpc2</span> <span class="id">tpc3</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">bi1</span> <span class="id">bi2</span> <span class="id">tail1</span> <span class="id">tail2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> (<span class="id"><a href="TSOGlobSem.html#ub">ub</a></span> <span class="id"><a href="TSOSemLemmas.html#t1">t1</a></span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span> (<span class="id"><a href="TSOGlobSem.html#ub">ub</a></span> <span class="id"><a href="TSOSemLemmas.html#t2">t2</a></span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc3">tpc3</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#t1">t1</a></span> &lt;&gt; <span class="id"><a href="TSOSemLemmas.html#t2">t2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span>) <span class="id"><a href="TSOSemLemmas.html#t1">t1</a></span> = <span class="id"><a href="TSOSemLemmas.html#bi1">bi1</a></span> :: <span class="id"><a href="TSOSemLemmas.html#tail1">tail1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span>) <span class="id"><a href="TSOSemLemmas.html#t2">t2</a></span> = <span class="id"><a href="TSOSemLemmas.html#bi2">bi2</a></span> :: <span class="id"><a href="TSOSemLemmas.html#tail2">tail2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Footprint.html#FP.smile">FP.smile</a></span> (<span class="id"><a href="TSOMem.html#bi_footprint">bi_footprint</a></span> <span class="id"><a href="TSOSemLemmas.html#bi1">bi1</a></span>) (<span class="id"><a href="TSOMem.html#bi_footprint">bi_footprint</a></span> <span class="id"><a href="TSOSemLemmas.html#bi2">bi2</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">tpc2</span>' <span class="id">tpc3</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> (<span class="id"><a href="TSOGlobSem.html#ub">ub</a></span> <span class="id"><a href="TSOSemLemmas.html#t2">t2</a></span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">tpc2</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id">tpc2</span>' (<span class="id"><a href="TSOGlobSem.html#ub">ub</a></span> <span class="id"><a href="TSOSemLemmas.html#t1">t1</a></span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">tpc3</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_config">eq_config</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc3">tpc3</a></span> <span class="id">tpc3</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10101')">Proof.</div>
<div class="proofscript" id="proof10101">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H0</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">unbuffer</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H_unbuf</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">bi1</span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">tm</span>)) <span class="id">eqn</span>:<span class="id">Happly_buf1</span>; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_unbuf</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#in_tbf_upd_oth_stillin">in_tbf_upd_oth_stillin</a></span> <span class="kwd">in</span> <span class="id">H_unbuf0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H3</span> <span class="kwd">in</span> <span class="id">H_unbuf0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">bi2</span> <span class="id">g</span>) <span class="id">eqn</span>:<span class="id">Happly_buf2</span>; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_unbuf0</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Happly_buf1</span>' : <span class="id">Happly_buf1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#buf_item_unbuf_locality_1">buf_item_unbuf_locality_1</a></span> <span class="kwd">in</span> <span class="id">Happly_buf1</span>'.<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Happly_buf2</span>' : <span class="id">Happly_buf2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#buf_item_unbuf_locality_1">buf_item_unbuf_locality_1</a></span> <span class="kwd">in</span> <span class="id">Happly_buf2</span>'. <br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="InteractionSemantics.html#MemPre">MemPre</a></span> <span class="id">g</span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">tm</span>) (<span class="id"><a href="TSOMem.html#bi_footprint">bi_footprint</a></span> <span class="id">bi2</span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#MemPre_comm">MemPre_comm</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#apply_buf_item_outside_stable">apply_buf_item_outside_stable</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Happly_buf2</span>' <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">gm1</span> [<span class="id">Happly_buf2</span>'' <span class="id">HMemPost2</span>]].<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="InteractionSemantics.html#MemPre">MemPre</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">tm</span>) <span class="id">gm1</span> (<span class="id"><a href="TSOMem.html#bi_footprint">bi_footprint</a></span> <span class="id">bi1</span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#apply_buf_item_outside_stable">apply_buf_item_outside_stable</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="FPLemmas.html#fpsmile_sym">FPLemmas.fpsmile_sym</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Happly_buf1</span>' <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">gm2</span> [<span class="id">Happly_buf1</span>'' <span class="id">HMemPost1</span>]].<br/>
&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="id">eexists</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unbuffer">unbuffer</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H3</span>; <span class="tactic">rewrite</span> <span class="id">Happly_buf2</span>''; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unbuffer">unbuffer</a></span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_not_eq_get">tupdate_not_eq_get</a></span>, <span class="id">H2</span>, <span class="id">Happly_buf1</span>''; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#GMem_eq">GMem_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="FPLemmas.html#MemEffect_MemPost_fpsmile_memeq">FPLemmas.MemEffect_MemPost_fpsmile_memeq</a></span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;3 : <span class="tactic">eapply</span> <span class="id"><a href="FPLemmas.html#fpsmile_sym">FPLemmas.fpsmile_sym</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;4 : <span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#unchanged_content_comm">unchanged_content_comm</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;5 : <span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#unchanged_content_comm">unchanged_content_comm</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#apply_buf_item_MemEffect">apply_buf_item_MemEffect</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#apply_buf_item_MemEffect">apply_buf_item_MemEffect</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#apply_buf_item_MemEffect">apply_buf_item_MemEffect</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#apply_buf_item_MemEffect">apply_buf_item_MemEffect</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_tid_neq_twice_rev">tupdate_tid_neq_twice_rev</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="ub_step_buffer_eq">ub_step_buffer_eq</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc</span> <span class="id">t</span> <span class="id">tpc</span>' <span class="id">t</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> (<span class="id"><a href="TSOGlobSem.html#ub">ub</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">t</span>' &lt;&gt; <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">tpc</span>') <span class="id">t</span>' = <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>) <span class="id">t</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10102')">Proof.</div>
<div class="proofscript" id="proof10102">
&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">inversion</span> 1. <span class="tactic">subst</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unbuffer">unbuffer</a></span> <span class="kwd">in</span> *. <span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span> <span class="id">t</span>); <span class="id">inv</span> <span class="id">H_unbuf</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span>; <span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>; <span class="tactic">subst</span>; <span class="tactic">auto</span>. <span class="id">contradiction</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="ub_star_ub_step_reorder">ub_star_ub_step_reorder</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc1</span> <span class="id">tpc2</span> <span class="id">tpc3</span> <span class="id">t1</span> <span class="id">t2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#ub_star">ub_star</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#t1">t1</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span> (<span class="id"><a href="TSOGlobSem.html#ub">ub</a></span> <span class="id"><a href="TSOSemLemmas.html#t2">t2</a></span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc3">tpc3</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#t1">t1</a></span> &lt;&gt; <span class="id"><a href="TSOSemLemmas.html#t2">t2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">bi1</span> <span class="id">bi2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#bi1">bi1</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span>) <span class="id"><a href="TSOSemLemmas.html#t1">t1</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#bi2">bi2</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span>) <span class="id"><a href="TSOSemLemmas.html#t2">t2</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Footprint.html#FP.smile">FP.smile</a></span> (<span class="id"><a href="TSOMem.html#bi_footprint">bi_footprint</a></span> <span class="id"><a href="TSOSemLemmas.html#bi1">bi1</a></span>) (<span class="id"><a href="TSOMem.html#bi_footprint">bi_footprint</a></span> <span class="id"><a href="TSOSemLemmas.html#bi2">bi2</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">tpc2</span>' <span class="id">tpc3</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> (<span class="id"><a href="TSOGlobSem.html#ub">ub</a></span> <span class="id"><a href="TSOSemLemmas.html#t2">t2</a></span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">tpc2</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#ub_star">ub_star</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#t1">t1</a></span> <span class="id">tpc2</span>' <span class="id">tpc3</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_config">eq_config</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc3">tpc3</a></span> <span class="id">tpc3</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10103')">Proof.</div>
<div class="proofscript" id="proof10103">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">revert</span> <span class="id">tpc3</span> <span class="id">H0</span> <span class="id">H2</span>. <span class="tactic">induction</span> <span class="id">H</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">tpc3</span> <span class="id">tpc3</span>. <span class="tactic">split</span>. <span class="tactic">auto</span>. <span class="tactic">split</span>. <span class="id">constructor</span>. <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_refl">eq_config_refl</a></span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">IHub_star</span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOSemLemmas.html#ub_step_buffer_eq">ub_step_buffer_eq</a></span> <span class="kwd">in</span> <span class="id">H5</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#ub_step_buffer_pop">ub_step_buffer_pop</a></span>. <span class="tactic">exact</span> <span class="id">H</span>. <span class="tactic">intros</span> [<span class="id">bi1</span>' <span class="id">Hbuffer</span>].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hbuffer</span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="tactic">apply</span> <span class="id">H3</span>; <span class="tactic">auto</span>. <span class="tactic">simpl</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">tpc2</span>' &amp; <span class="id">tpc3</span>' &amp; <span class="id">Hub2</span> &amp; <span class="id">Hubstar1</span> &amp; <span class="id">Heq</span>).<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#ub_step_buffer_pop">ub_step_buffer_pop</a></span>. <span class="tactic">exact</span> <span class="id">H</span>. <span class="tactic">intros</span> [<span class="id">bi1</span>' <span class="id">Hbuffer1</span>].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#ub_step_buffer_pop">ub_step_buffer_pop</a></span>. <span class="tactic">exact</span> <span class="id">Hub2</span>. <span class="tactic">intros</span> [<span class="id">bi2</span>' <span class="id">Hbuffer2</span>].<br/>
&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOSemLemmas.html#ub_step_buffer_eq">ub_step_buffer_eq</a></span> <span class="kwd">in</span> <span class="id">Hbuffer2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#ub_steps_reorder">ub_steps_reorder</a></span>. <span class="tactic">exact</span> <span class="id">H</span>. <span class="tactic">exact</span> <span class="id">Hub2</span>. <span class="tactic">auto</span>. <span class="tactic">exact</span> <span class="id">Hbuffer1</span>. <span class="tactic">exact</span> <span class="id">Hbuffer2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H3</span>. <span class="tactic">rewrite</span> <span class="id">Hbuffer1</span>. <span class="tactic">simpl</span>; <span class="tactic">auto</span>. <span class="tactic">rewrite</span> <span class="id">Hbuffer2</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">tpc2</span>'' &amp; <span class="id">tpc3</span>'' &amp; <span class="id">Hub2</span>' &amp; <span class="id">Hub1</span>' &amp; <span class="id">Heq</span>').<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_eq_ub_star">eq_config_eq_ub_star</a></span>. <span class="tactic">exact</span> <span class="id">Heq</span>'. <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">tpc3</span>''' &amp; <span class="id">Hubstar</span>' &amp; <span class="id">Heq</span>'').<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">tpc2</span>'' <span class="id">tpc3</span>'''. <span class="tactic">split</span>. <span class="tactic">auto</span>. <span class="tactic">split</span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_trans">eq_config_trans</a></span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="ub_evt_reorder">ub_evt_reorder</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> (<span class="id">tpc0</span> <span class="id">tpc1</span> <span class="id">tpc2</span> <span class="id">tpc3</span>: @<span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span>) <span class="id">t</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc0">tpc0</a></span> (<span class="id"><a href="TSOGlobSem.html#ub">ub</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span> (<span class="id"><a href="TSOGlobSem.html#evt">evt</a></span> <span class="id"><a href="TSOSemLemmas.html#v">v</a></span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc3">tpc3</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">_tpc1</span> <span class="id">_tpc2</span> <span class="id">_tpc3</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc0">tpc0</a></span> <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">_tpc1</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">_tpc1</span> = <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id">_tpc1</span> (<span class="id"><a href="TSOGlobSem.html#evt">evt</a></span> <span class="id"><a href="TSOSemLemmas.html#v">v</a></span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">_tpc2</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id">_tpc2</span> (<span class="id"><a href="TSOGlobSem.html#ub">ub</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">_tpc3</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid">eq_config_but_cid</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc3">tpc3</a></span> <span class="id">_tpc3</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10104')">Proof.</div>
<div class="proofscript" id="proof10104">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H0</span>; <span class="id">inv</span> <span class="id">H1</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">do</span> 3 <span class="id">eexists</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id">t</span>'); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#thrdpool_tupdate_valid_still_valid">thrdpool_tupdate_valid_still_valid</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="GMemory.html#GMem.eq_refl">GMem.eq_refl</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="eq_config_but_cid_ub">eq_config_but_cid_ub</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc</span> <span class="id">t</span> <span class="id">tpc</span>' <span class="id">_tpc</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid">eq_config_but_cid</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id"><a href="TSOSemLemmas.html#_tpc">_tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> (<span class="id"><a href="TSOGlobSem.html#ub">ub</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">_tpc</span>', <span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#_tpc">_tpc</a></span> (<span class="id"><a href="TSOGlobSem.html#ub">ub</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">_tpc</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid">eq_config_but_cid</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id">tpc</span>' <span class="id">_tpc</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10105')">Proof.</div>
<div class="proofscript" id="proof10105">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>; <span class="id">inv</span> <span class="id">H</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">_tpc</span>; <span class="id">simpls</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>, <span class="id">tm</span>'; <span class="id">simpls</span>. <br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hunbuf</span> : <span class="id">eq_m</span>'0; <span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#gmem_eq_ub_gmem_eq">gmem_eq_ub_gmem_eq</a></span> <span class="kwd">in</span> <span class="id">Hunbuf</span>; <span class="tactic">eauto</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hunbuf</span> <span class="kwd">as</span> [<span class="id">gm2</span>' [<span class="id">Hunbuf</span>' <span class="id">Hgmem_eq</span>']].<br/>
&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">instantiate</span> (1 := {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id">tso_buffers0</span>; <span class="id">memory</span> := <span class="id">gm2</span>' |}).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm0</span>; <span class="id">simpls</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="eq_config_but_cid_ub_star">eq_config_but_cid_ub_star</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc</span> <span class="id">t</span> <span class="id">tpc</span>' <span class="id">_tpc</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid">eq_config_but_cid</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id"><a href="TSOSemLemmas.html#_tpc">_tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#ub_star">ub_star</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">_tpc</span>', <span class="id"><a href="TSOSemLemmas.html#ub_star">ub_star</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#_tpc">_tpc</a></span> <span class="id">_tpc</span>' /\ <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid">eq_config_but_cid</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id">tpc</span>' <span class="id">_tpc</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10106')">Proof.</div>
<div class="proofscript" id="proof10106">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">_tpc</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">H0</span>; <span class="id">simpls</span>; <span class="tactic">intros</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">_tpc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#ub_star_refl">ub_star_refl</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_ub">eq_config_but_cid_ub</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> (<span class="id">_tpc</span>' &amp; <span class="id">Hub_step</span> &amp; <span class="id">Heq_config</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHub_star</span> <span class="kwd">in</span> <span class="id">Heq_config</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Heq_config</span> <span class="kwd">as</span> [<span class="id">_tpc</span>'0 [<span class="id">Hub_star</span>' <span class="id">Heq_config</span>']].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">_tpc</span>'0. <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#ub_star_cons">ub_star_cons</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="ub_star_evt_reorder">ub_star_evt_reorder</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> (<span class="id">tpc0</span> <span class="id">tpc1</span> <span class="id">tpc2</span> <span class="id">tpc3</span>: @<span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span>) <span class="id">t</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#ub_star">ub_star</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc0">tpc0</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span> (<span class="id"><a href="TSOGlobSem.html#evt">evt</a></span> <span class="id"><a href="TSOSemLemmas.html#v">v</a></span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc3">tpc3</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">_tpc1</span> <span class="id">_tpc2</span> <span class="id">_tpc3</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc0">tpc0</a></span> <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">_tpc1</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">_tpc1</span> = <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id">_tpc1</span> (<span class="id"><a href="TSOGlobSem.html#evt">evt</a></span> <span class="id"><a href="TSOSemLemmas.html#v">v</a></span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">_tpc2</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#ub_star">ub_star</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id">_tpc2</span> <span class="id">_tpc3</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid">eq_config_but_cid</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc3">tpc3</a></span> <span class="id">_tpc3</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10107')">Proof.</div>
<div class="proofscript" id="proof10107">
&nbsp;&nbsp;<span class="id">introv</span> <span class="id">Hub_star</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">tpc2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">tpc3</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">v</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hub_star</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H0</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 <span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#ub_star_refl">ub_star_refl</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="GMemory.html#GMem.eq_refl">GMem.eq_refl</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hreorder</span> : <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHHub_star</span> <span class="kwd">in</span> <span class="id">Hreorder</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hreorder</span> <span class="kwd">as</span> [<span class="id">_tcp1</span> [<span class="id">_tcp2</span> [<span class="id">_tcp3</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">Hsw</span> [<span class="id">Htid_eq</span> [<span class="id">Hevt</span> [<span class="id">Hub_star</span>' <span class="id">Heq_config</span>]]]]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#ub_evt_reorder">ub_evt_reorder</a></span> <span class="kwd">with</span> (<span class="id">v</span> := <span class="id">v</span>) <span class="kwd">in</span> <span class="id">Ht</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ht</span> <span class="kwd">as</span> [<span class="id">_tcp1</span>' [<span class="id">_tcp2</span>' [<span class="id">_tcp3</span>' [<span class="id">Hsw1</span> [<span class="id">Htid_eq1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">Hevt1</span> [<span class="id">Hub_step1</span> <span class="id">Heq_config1</span>]]]]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Heq_config1</span>' : <span class="id">Heq_config1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_ub_star">eq_config_but_cid_ub_star</a></span> <span class="kwd">with</span> (<span class="id">t</span> := <span class="id">t</span>) (<span class="id">tpc</span>' := <span class="id">_tcp3</span>) <span class="kwd">in</span> <span class="id">Heq_config1</span>';<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Heq_config1</span>' <span class="kwd">as</span> [<span class="id">_tcp</span>'' [<span class="id">Hub_star</span>'' <span class="id">Heq_config</span>']].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">_tcp1</span>' <span class="id">_tcp2</span>' <span class="id">_tcp</span>''.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Htid_eq</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hub_step1</span> <span class="id">Hub_star</span>''.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#ub_star_cons">ub_star_cons</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_trans">eq_config_but_cid_trans</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<span class="kwd">Require</span> <span class="id"><a href="ConflictReorder.html">ConflictReorder</a></span> <span class="id"><a href="SmileReorder.html">SmileReorder</a></span>.<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="adjacent_sc_conflicting_step_race">adjacent_sc_conflicting_step_race</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">SGE</span> <span class="id">spc0</span> <span class="id">fp0</span> <span class="id">spc1</span> <span class="id">spc2</span> <span class="id">fp2</span> <span class="id">spc3</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">ix</span>, <span class="id"><a href="InteractionSemantics.html#mod_wd">mod_wd</a></span> (<span class="id"><a href="GlobDefs.html#GlobEnv.modules">GlobEnv.modules</a></span> <span class="id"><a href="TSOSemLemmas.html#SGE">SGE</a></span> <span class="id"><a href="TSOSemLemmas.html#ix">ix</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#GlobEnv.wd">GlobEnv.wd</a></span> <span class="id"><a href="TSOSemLemmas.html#SGE">SGE</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#ThreadPool.inv">ThreadPool.inv</a></span> <span class="id"><a href="TSOSemLemmas.html#spc0">spc0</a></span>.(<span class="id"><a href="GlobDefs.html#thread_pool">thread_pool</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ETrace.html#safe_state">safe_state</a></span> <span class="id"><a href="GlobSemantics.html#glob_step">glob_step</a></span> <span class="id"><a href="GlobSemantics.html#abort">GlobSemantics.abort</a></span> <span class="id"><a href="TSOSemLemmas.html#spc0">spc0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="GlobSemantics.html#glob_step">glob_step</a></span> <span class="id"><a href="TSOSemLemmas.html#SGE">SGE</a></span> <span class="id"><a href="TSOSemLemmas.html#spc0">spc0</a></span> <span class="id"><a href="ETrace.html#tau">ETrace.tau</a></span> <span class="id"><a href="TSOSemLemmas.html#fp0">fp0</a></span> <span class="id"><a href="TSOSemLemmas.html#spc1">spc1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="GlobSemantics.html#glob_step">glob_step</a></span> <span class="id"><a href="TSOSemLemmas.html#SGE">SGE</a></span> <span class="id"><a href="TSOSemLemmas.html#spc1">spc1</a></span> <span class="id"><a href="ETrace.html#sw">ETrace.sw</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id"><a href="TSOSemLemmas.html#spc2">spc2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="GlobSemantics.html#glob_step">glob_step</a></span> <span class="id"><a href="TSOSemLemmas.html#SGE">SGE</a></span> <span class="id"><a href="TSOSemLemmas.html#spc2">spc2</a></span> <span class="id"><a href="ETrace.html#tau">ETrace.tau</a></span> <span class="id"><a href="TSOSemLemmas.html#fp2">fp2</a></span> <span class="id"><a href="TSOSemLemmas.html#spc3">spc3</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#cur_tid">cur_tid</a></span> <span class="id"><a href="TSOSemLemmas.html#spc0">spc0</a></span> &lt;&gt; <span class="id"><a href="GlobDefs.html#cur_tid">cur_tid</a></span> <span class="id"><a href="TSOSemLemmas.html#spc2">spc2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Footprint.html#FP.conflict">FP.conflict</a></span> <span class="id"><a href="TSOSemLemmas.html#fp0">fp0</a></span> <span class="id"><a href="TSOSemLemmas.html#fp2">fp2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="DRF.html#star_race_config">DRF.star_race_config</a></span> <span class="id"><a href="TSOSemLemmas.html#spc0">spc0</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10108')">Proof.</div>
<div class="proofscript" id="proof10108">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Footprint.html#FP.emp_never_conflict">FP.emp_never_conflict</a></span> <span class="kwd">in</span> <span class="id">H7</span> <span class="kwd">as</span> ?;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TypedSemantics.html#type_glob_step_exists">TypedSemantics.type_glob_step_exists</a></span> <span class="kwd">in</span> <span class="id">H3</span> <span class="kwd">as</span> [].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>;<span class="tactic">try</span>(<span class="id">inv</span> <span class="id">H3</span>;<span class="id">contradiction</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TypedSemantics.html#type_glob_step_exists">TypedSemantics.type_glob_step_exists</a></span> <span class="kwd">in</span> <span class="id">H5</span> <span class="kwd">as</span> [].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>;<span class="tactic">try</span>(<span class="id">inv</span> <span class="id">H5</span>;<span class="id">contradiction</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="ConflictReorder.html#pc_valid_tid">ConflictReorder.pc_valid_tid</a></span> <span class="id">spc1</span> (<span class="id"><a href="GlobDefs.html#cur_tid">cur_tid</a></span> <span class="id">spc2</span>)).<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H4</span>. <span class="id">constructor</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="ConflictReorder.html#npnswstep_pc_valid_tid_backwards_preservation">ConflictReorder.npnswstep_pc_valid_tid_backwards_preservation</a></span>.<br/>
&nbsp;&nbsp;<span class="id">left</span>. <span class="tactic">apply</span> <span class="id">H3</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="GlobSemantics.html#glob_step">glob_step</a></span> <span class="id">spc0</span> <span class="id"><a href="ETrace.html#sw">ETrace.sw</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> ({|<span class="id"><a href="GlobDefs.html#Build_ProgConfig">thread_pool</a></span>:= <span class="id"><a href="GlobDefs.html#thread_pool">thread_pool</a></span> <span class="id">spc0</span>;<span class="id">cur_tid</span> := <span class="id"><a href="GlobDefs.html#cur_tid">cur_tid</a></span> <span class="id">spc2</span>;<span class="id">gm</span> := <span class="id"><a href="GlobDefs.html#gm">gm</a></span> <span class="id">spc0</span>;<span class="id">atom_bit</span> := <span class="id"><a href="GlobDefs.html#atom_bit">atom_bit</a></span> <span class="id">spc0</span> |})).<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H4</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H3</span>. <span class="id">inv</span> <span class="id">H11</span>. <span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="ConflictReorder.html#corestep_conflict">ConflictReorder.corestep_conflict</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="SmileReorder.html#pc_cur_tid">SmileReorder.pc_cur_tid</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">contradict</span> <span class="id">H4</span>. <span class="tactic">eapply</span> <span class="id">H2</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span> 2. <span class="tactic">eauto</span>. <span class="id">constructor</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;<span class="id">Hsimpl</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="DRF.html#star_race_config">DRF.star_race_config</a></span>.<br/>
&nbsp;&nbsp;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>. <span class="id">econstructor</span> 2;<span class="tactic">eauto</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H6</span>. <span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H3</span>. <span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">right</span>;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_not_alloc_item_vb_eq">apply_not_alloc_item_vb_eq</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span> <span class="id">m</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ (<span class="id">exists</span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span>, <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> = <span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> = <span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10109')">Proof.</div>
<div class="proofscript" id="proof10109">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">free</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">unchecked_free</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_buffer_cons">apply_buffer_cons</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf1</span> <span class="id">bf2</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">m</span>'',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOSemLemmas.html#bf1">bf1</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'' -&gt; <span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOSemLemmas.html#bf2">bf2</a></span> <span class="id">m</span>'' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> (<span class="id"><a href="TSOSemLemmas.html#bf1">bf1</a></span> ++ <span class="id"><a href="TSOSemLemmas.html#bf2">bf2</a></span>) <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10110')">Proof.</div>
<div class="proofscript" id="proof10110">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf1</span>; <span class="tactic">intros</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m</span>) <span class="id">eqn</span>:?; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf1</span> <span class="kwd">with</span> (<span class="id">bf2</span> := <span class="id">bf2</span>) <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_apply_bf_mvb_in_orgin_m_or_bf_alloc_rev">in_apply_bf_mvb_in_orgin_m_or_bf_alloc_rev</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">b</span> <span class="id">m</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span>) \/ (<span class="id">exists</span> <span class="id">lo</span> <span class="id">hi</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> <span class="id">lo</span> <span class="id">hi</span>) <span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10111')">Proof.</div>
<div class="proofscript" id="proof10111">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>; <span class="tactic">intros</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">lo</span> &amp; <span class="id">hi</span> &amp; <span class="id">contr</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m</span>) <span class="id">eqn</span>:?; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">left</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buffer_item_in_validbloks_stable">apply_buffer_item_in_validbloks_stable</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">lo</span> &amp; <span class="id">hi</span> &amp; <span class="id">H</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Heqo</span>; <span class="id">left</span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Heqo</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
&nbsp;&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="valid_block_stable_embed_stable">valid_block_stable_embed_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">fm1</span> <span class="id">fl</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> = <span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> <span class="id"><a href="TSOSemLemmas.html#fl">fl</a></span> <span class="id"><a href="TSOSemLemmas.html#fm1">fm1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">fm2</span>, <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> <span class="id"><a href="TSOSemLemmas.html#fl">fl</a></span> <span class="id">fm2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10112')">Proof.</div>
<div class="proofscript" id="proof10112">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">eexists</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="FMemory.html#Mem.mkmem">Mem.mkmem</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id">m2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="FMemory.html#Mem.freelist">Mem.freelist</a></span> <span class="id">fm1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="FMemory.html#Mem.nextblockid">Mem.nextblockid</a></span> <span class="id">fm1</span>) <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>).<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#strip">strip</a></span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#gmem_eq">gmem_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">Unshelve</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fm1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fm1</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m2</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">access_max</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m2</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m2</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">store_args_rec_fmem_add_store_buf_item</span>' :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">args</span> <span class="id">bm</span> <span class="id">bm</span>' <span class="id">sp</span> <span class="id">ofs</span> <span class="id">tys</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#store_args_rec_fmem">store_args_rec_fmem</a></span> <span class="id"><a href="TSOSemLemmas.html#bm">bm</a></span> <span class="id"><a href="TSOSemLemmas.html#sp">sp</a></span> <span class="id"><a href="TSOSemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOSemLemmas.html#args">args</a></span> <span class="id"><a href="TSOSemLemmas.html#tys">tys</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">bm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">bis</span>, <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">bm</span>' = <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOSemLemmas.html#bm">bm</a></span> ++ <span class="id">bis</span> /\ <span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id"><a href="TSOSemLemmas.html#bm">bm</a></span> = <span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id">bm</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">bi</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id">bis</span> -&gt; (<span class="id">exists</span> <span class="id">c</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span>, <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> = <span class="id"><a href="TSOMem.html#BufferedStore">BufferedStore</a></span> <span class="id">c</span> <span class="id">b</span> <span class="id"><a href="TSOSemLemmas.html#ofs">ofs</a></span> <span class="id">v</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">ofs0</span>, <span class="id"><a href="TSOSemLemmas.html#sp">sp</a></span> = <span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id">b</span> <span class="id">ofs0</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10113')">Proof.</div>
<div class="proofscript" id="proof10113">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">args</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">eexists</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>;<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store_stack_fmem</span>, <span class="id">tsostorev</span>, <span class="id">tsostore</span>, <span class="id">buffer_insert</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="id">inv_some</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHargs</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>; <span class="id">simpls</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">sp</span>; <span class="id">simpls</span>; <span class="id">tryfalse</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id">_</span> <span class="id">_</span> = <span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="id">inv</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">idtac</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">bis</span> &amp; <span class="id">Hbuf</span> &amp; <span class="id">Hmem</span> &amp; <span class="id">store</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="id">eexists</span>; <span class="tactic">rewrite</span> <span class="id">Hbuf</span>; <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc_reverse">app_assoc_reverse</a></span>; <span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">eauto</span>); <span class="id">introv</span> <span class="id">Ht</span>; <span class="tactic">destruct</span> <span class="id">Ht</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">eexists</span>].<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hx2</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hbuf</span>, <span class="id">Hmem</span>.<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc_reverse">app_assoc_reverse</a></span>); <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hx5</span>. <br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">subst</span>).<br/>
&nbsp;&nbsp;<span class="tactic">do</span> 4 <span class="id">eexists</span>. <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">do</span> 4 <span class="id">eexists</span>. <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">store</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="store_args_rec_fmem_add_store_buf_item">store_args_rec_fmem_add_store_buf_item</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">args</span> <span class="id">bm</span> <span class="id">bm</span>' <span class="id">sp</span> <span class="id">ofs</span> <span class="id">tys</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#store_args_rec_fmem">store_args_rec_fmem</a></span> <span class="id"><a href="TSOSemLemmas.html#bm">bm</a></span> <span class="id"><a href="TSOSemLemmas.html#sp">sp</a></span> <span class="id"><a href="TSOSemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOSemLemmas.html#args">args</a></span> <span class="id"><a href="TSOSemLemmas.html#tys">tys</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">bm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">bis</span>, <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">bm</span>' = <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOSemLemmas.html#bm">bm</a></span> ++ <span class="id">bis</span> /\ <span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id"><a href="TSOSemLemmas.html#bm">bm</a></span> = <span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id">bm</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">bi</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id">bis</span> -&gt; (<span class="id">exists</span> <span class="id">c</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span>, <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> = <span class="id"><a href="TSOMem.html#BufferedStore">BufferedStore</a></span> <span class="id">c</span> <span class="id">b</span> <span class="id"><a href="TSOSemLemmas.html#ofs">ofs</a></span> <span class="id">v</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10114')">Proof.</div>
<div class="proofscript" id="proof10114">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">store_args_rec_fmem_add_store_buf_item</span>' <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">bis</span> &amp; <span class="id">Hbuf</span> &amp; <span class="id">Hmem</span> &amp; <span class="id">Hstore</span>).<br/>
&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hstore</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">c</span> &amp; <span class="id">b</span> &amp; <span class="id">ofs0</span> &amp; <span class="id">v</span> &amp; <span class="id">Hbi</span> &amp; <span class="id">Hsp</span>).<br/>
&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="vb_subset_apply_buf_item_still">vb_subset_apply_buf_item_still</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">m0</span> <span class="id">m</span>'0 <span class="id">b</span> <span class="id">bi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">b</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span>) -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m</span>')) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOSemLemmas.html#m0">m0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id">m</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOSemLemmas.html#m0">m0</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m</span>'0).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10115')">Proof.</div>
<div class="proofscript" id="proof10115">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>; <span class="id">inv</span> <span class="id">H1</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">free</span>, <span class="id">unchecked_free</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>; <span class="id">inv</span> <span class="id">H1</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>; <span class="id">inv</span> <span class="id">H1</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="vb_fl_apply_buf_item_still">vb_fl_apply_buf_item_still</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">m0</span> <span class="id">m</span>'0 <span class="id">b</span> <span class="id">bi</span> <span class="id">fl</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">b</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span>) -&gt; <span class="id">exists</span> <span class="id">n</span>', <span class="id"><a href="MemAux.html#get_block">MemAux.get_block</a></span> <span class="id"><a href="TSOSemLemmas.html#fl">fl</a></span> <span class="id">n</span>' = <span class="id"><a href="TSOSemLemmas.html#b">b</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOSemLemmas.html#m0">m0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id">m</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m</span>'0) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOSemLemmas.html#m0">m0</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">n</span>', <span class="id"><a href="MemAux.html#get_block">MemAux.get_block</a></span> <span class="id"><a href="TSOSemLemmas.html#fl">fl</a></span> <span class="id">n</span>' = <span class="id"><a href="TSOSemLemmas.html#b">b</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10116')">Proof.</div>
<div class="proofscript" id="proof10116">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>; <span class="id">simpls</span>.<br/>
&nbsp;alloc&nbsp;*)</span>&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>; <span class="id">inv</span> <span class="id">H1</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H3</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">Classical_Prop.classic</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">b</span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H3</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;free&nbsp;*)</span>&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">free</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">unchecked_free</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>; <span class="id">inv</span> <span class="id">H1</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;store&nbsp;*)</span>&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>; <span class="id">inv</span> <span class="id">H1</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="origin_embed_alloc_nextblock_embed_still">origin_embed_alloc_nextblock_embed_still</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">fl</span> <span class="id">fm</span> <span class="id">m</span>' <span class="id">lo</span> <span class="id">hi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id"><a href="TSOSemLemmas.html#fl">fl</a></span> <span class="id"><a href="TSOSemLemmas.html#fm">fm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> (<span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id"><a href="TSOSemLemmas.html#fm">fm</a></span>) <span class="id"><a href="TSOSemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOSemLemmas.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">fm</span>', <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">m</span>' <span class="id"><a href="TSOSemLemmas.html#fl">fl</a></span> <span class="id">fm</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10117')">Proof.</div>
<div class="proofscript" id="proof10117">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">eexists</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="FMemory.html#Mem.mkmem">Mem.mkmem</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id">m</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="FMemory.html#Mem.freelist">Mem.freelist</a></span> <span class="id">fm</span>) (<span class="id"><a href="FMemory.html#Mem.nextblockid">Mem.nextblockid</a></span> <span class="id">fm</span>+1)%<span class="id">coq_nat</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>).<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#strip">strip</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#gmem_eq">gmem_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">Unshelve</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fm</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fm</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eq_dec">Nat.eq_dec</a></span> <span class="id">nextblockid</span> <span class="id">n</span>); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id">n0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">freelist_wd</span> <span class="kwd">in</span> <span class="id">Ht</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.lt_exists_pred">Nat.lt_exists_pred</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">k</span> [<span class="id">Ht</span> <span class="id">Hle</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.add_1_r">Nat.add_1_r</a></span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.succ_inj">Nat.succ_inj</a></span> <span class="kwd">in</span> <span class="id">Ht</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.lt_eq_cases">Nat.lt_eq_cases</a></span> <span class="kwd">in</span> <span class="id">Hle</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hle</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m</span>'; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m</span>'; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m</span>'; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="embed_fl_disj_vb_ext_embed_still">embed_fl_disj_vb_ext_embed_still</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">fm1</span> <span class="id">fm2</span> <span class="id">fl1</span> <span class="id">fl2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">b</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span>) -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m</span>')) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">b</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m</span>') -&gt; ~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">n</span>', <span class="id"><a href="MemAux.html#get_block">MemAux.get_block</a></span> <span class="id"><a href="TSOSemLemmas.html#fl1">fl1</a></span> <span class="id">n</span>' = <span class="id"><a href="TSOSemLemmas.html#b">b</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="MemAux.html#disj">MemAux.disj</a></span> <span class="id"><a href="TSOSemLemmas.html#fl1">fl1</a></span> <span class="id"><a href="TSOSemLemmas.html#fl2">fl2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id"><a href="TSOSemLemmas.html#fl2">fl2</a></span> <span class="id"><a href="TSOSemLemmas.html#fm2">fm2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">m</span>' <span class="id"><a href="TSOSemLemmas.html#fl1">fl1</a></span> <span class="id"><a href="TSOSemLemmas.html#fm1">fm1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">fm</span>, <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">m</span>' <span class="id"><a href="TSOSemLemmas.html#fl2">fl2</a></span> <span class="id">fm</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10118')">Proof.</div>
<div class="proofscript" id="proof10118">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>; <span class="id">inv</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;<span class="id">eexists</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="FMemory.html#Mem.mkmem">Mem.mkmem</a></span> (<span class="id"><a href="FMemory.html#Mem.mem_contents">Mem.mem_contents</a></span> <span class="id">fm1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="FMemory.html#Mem.mem_access">Mem.mem_access</a></span> <span class="id">fm1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="FMemory.html#Mem.validblocks">Mem.validblocks</a></span> <span class="id">fm1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="FMemory.html#Mem.freelist">Mem.freelist</a></span> <span class="id">fm2</span>) (<span class="id"><a href="FMemory.html#Mem.nextblockid">Mem.nextblockid</a></span> <span class="id">fm2</span>) <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>).<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#strip">strip</a></span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#gmem_eq">gmem_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">Unshelve</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fm2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fm2</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">Classical_Prop.classic</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">b</span> <span class="id">validblocks</span>)); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H3</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H1</span> <span class="id">H2</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">MemAux.get_block</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H</span> <span class="id">x</span> <span class="id">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fm2</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd</span> <span class="kwd">in</span> <span class="id">H3</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="embed_alloc_embed_still_nextblockid">embed_alloc_embed_still_nextblockid</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">fl</span> <span class="id">fm</span> <span class="id">fm</span>' <span class="id">n</span> <span class="id">lo</span> <span class="id">hi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id"><a href="TSOSemLemmas.html#fl">fl</a></span> <span class="id"><a href="TSOSemLemmas.html#fm">fm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="MemAux.html#get_block">MemAux.get_block</a></span> <span class="id"><a href="TSOSemLemmas.html#fl">fl</a></span> <span class="id"><a href="TSOSemLemmas.html#n">n</a></span>) (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> (<span class="id"><a href="MemAux.html#get_block">MemAux.get_block</a></span> <span class="id"><a href="TSOSemLemmas.html#fl">fl</a></span> <span class="id"><a href="TSOSemLemmas.html#n">n</a></span>) <span class="id"><a href="TSOSemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOSemLemmas.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">m</span>' <span class="id"><a href="TSOSemLemmas.html#fl">fl</a></span> <span class="id">fm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#n">n</a></span> = <span class="id"><a href="FMemory.html#Mem.nextblockid">Mem.nextblockid</a></span> <span class="id"><a href="TSOSemLemmas.html#fm">fm</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10119')">Proof.</div>
<div class="proofscript" id="proof10119">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fm</span>, <span class="id">fm</span>'; <span class="tactic">subst</span>; <span class="id">simpls</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">access_max</span> <span class="id">invalid_noaccess</span> <span class="id">contents_default</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">access_max0</span> <span class="id">invalid_noaccess0</span> <span class="id">contents_default0</span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.lt_trichotomy">Nat.lt_trichotomy</a></span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H</span> <span class="id">n</span> <span class="id">nextblockid</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="MemAux.html#get_block">MemAux.get_block</a></span> <span class="id">freelist</span> <span class="id">n</span> = <span class="id"><a href="MemAux.html#get_block">MemAux.get_block</a></span> <span class="id">freelist</span> <span class="id">n</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.lt_trichotomy">Nat.lt_trichotomy</a></span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H1</span> <span class="id">nextblockid</span> <span class="id">nextblockid0</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="MemAux.html#get_block">MemAux.get_block</a></span> <span class="id">freelist</span> <span class="id">nextblockid</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="MemAux.html#get_block">MemAux.get_block</a></span> <span class="id">freelist</span> <span class="id">nextblockid</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd0</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">clear</span> <span class="id">H2</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eq_dec">Nat.eq_dec</a></span> <span class="id">n</span> <span class="id">nextblockid</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">freelist_wd</span> <span class="kwd">in</span> <span class="id">n0</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="MemAux.html#get_block">MemAux.get_block</a></span> <span class="id">freelist</span> <span class="id">n</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="MemAux.html#get_block">MemAux.get_block</a></span> <span class="id">freelist</span> <span class="id">n</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd0</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="MemAux.html#get_block">MemAux.get_block</a></span> <span class="id">freelist</span> <span class="id">n</span> = <span class="id"><a href="MemAux.html#get_block">MemAux.get_block</a></span> <span class="id">freelist</span> <span class="id">n</span> \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="MemAux.html#get_block">MemAux.get_block</a></span> <span class="id">freelist</span> <span class="id">n</span>) <span class="id">validblocks</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="MemAux.html#get_block">MemAux.get_block</a></span> <span class="id">freelist</span> <span class="id">n</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="MemAux.html#get_block">MemAux.get_block</a></span> <span class="id">freelist</span> <span class="id">nextblockid0</span> \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="MemAux.html#get_block">MemAux.get_block</a></span> <span class="id">freelist</span> <span class="id">nextblockid0</span>) <span class="id">validblocks</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd0</span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="vbeq_apply_buffer_embed_stable">vbeq_apply_buffer_embed_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">m1</span>' <span class="id">m2</span>' <span class="id">fm1</span>' <span class="id">fl</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> = <span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">m1</span>' <span class="id"><a href="TSOSemLemmas.html#fl">fl</a></span> <span class="id">fm1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">fm2</span>', <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">m2</span>' <span class="id"><a href="TSOSemLemmas.html#fl">fl</a></span> <span class="id">fm2</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10120')">Proof.</div>
<div class="proofscript" id="proof10120">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">eexists</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="FMemory.html#Mem.mkmem">Mem.mkmem</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id">m2</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m2</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m2</span>') <span class="id">fl</span> (<span class="id"><a href="FMemory.html#Mem.nextblockid">Mem.nextblockid</a></span> <span class="id">fm1</span>') <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>).<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#strip">strip</a></span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#gmem_eq">gmem_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">Unshelve</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fm1</span>'; <span class="id">inv</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#in_valid_block_eq_apply_same_buf_still">in_valid_block_eq_apply_same_buf_still</a></span> <span class="kwd">in</span> <span class="id">Ht</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Ht</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fm1</span>'; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fm1</span>'; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m2</span>'; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m2</span>'; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m2</span>'; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="vbmore_out_fl_apply_buffer_embed_stable">vbmore_out_fl_apply_buffer_embed_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">m1</span>' <span class="id">m2</span>' <span class="id">fm1</span>' <span class="id">fl</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">b</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span>) -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">b</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span>) -&gt; ~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ (<span class="id">exists</span> <span class="id">n</span>', <span class="id"><a href="MemAux.html#get_block">MemAux.get_block</a></span> <span class="id"><a href="TSOSemLemmas.html#fl">fl</a></span> <span class="id">n</span>' = <span class="id"><a href="TSOSemLemmas.html#b">b</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">m1</span>' <span class="id"><a href="TSOSemLemmas.html#fl">fl</a></span> <span class="id">fm1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOSemLemmas.html#m2">m2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">fm2</span>', <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">m2</span>' <span class="id"><a href="TSOSemLemmas.html#fl">fl</a></span> <span class="id">fm2</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10121')">Proof.</div>
<div class="proofscript" id="proof10121">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">eexists</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="FMemory.html#Mem.mkmem">Mem.mkmem</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id">m2</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m2</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m2</span>') <span class="id">fl</span> (<span class="id"><a href="FMemory.html#Mem.nextblockid">Mem.nextblockid</a></span> <span class="id">fm1</span>') <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>). <br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#strip">strip</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#gmem_eq">gmem_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">Unshelve</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fm1</span>'; <span class="id">inv</span> <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">Classical_Prop.classic</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">b</span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m1</span>'))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fm1</span>'; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht1</span> : <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#not_in_apply_bf_vb_not_in_orign">not_in_apply_bf_vb_not_in_orign</a></span> <span class="kwd">in</span> <span class="id">H6</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buffer_not_in_vb_not_alloc_in_bf">apply_buffer_not_in_vb_not_alloc_in_bf</a></span> <span class="kwd">in</span> <span class="id">Ht1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#in_apply_bf_mvb_in_orgin_m_or_bf_alloc">in_apply_bf_mvb_in_orgin_m_or_bf_alloc</a></span> <span class="kwd">in</span> <span class="id">H5</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H5</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H5</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">Ht1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fm1</span>'; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd</span> <span class="kwd">in</span> <span class="id">H5</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#in_apply_bf_mvb_in_orgin_m_or_bf_alloc">in_apply_bf_mvb_in_orgin_m_or_bf_alloc</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buffer_in_validblocks_stable">apply_buffer_in_validblocks_stable</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> (<span class="id">lo</span> &amp; <span class="id">hi</span> &amp; <span class="id">H1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#b_in_bf_alloc_in_apply_bf_m_vb">b_in_bf_alloc_in_apply_bf_m_vb</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m2</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m2</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m2</span>'; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="embed_gm_forward_embed_stable">embed_gm_forward_embed_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fl</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">fm</span> <span class="id">fm</span>' <span class="id">fm1</span> <span class="id">bi</span> <span class="id">m0</span> <span class="id">m0</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id"><a href="TSOSemLemmas.html#fl">fl</a></span> <span class="id"><a href="TSOSemLemmas.html#fm">fm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">b</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span>) -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m</span>')) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">b</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m</span>') -&gt; ~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">n</span>', <span class="id"><a href="MemAux.html#get_block">MemAux.get_block</a></span> <span class="id"><a href="TSOSemLemmas.html#fl">fl</a></span> <span class="id">n</span>' = <span class="id"><a href="TSOSemLemmas.html#b">b</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">m</span>' <span class="id"><a href="TSOSemLemmas.html#fl">fl</a></span> <span class="id">fm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOSemLemmas.html#m0">m0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id"><a href="TSOSemLemmas.html#m0">m0</a></span> <span class="id"><a href="TSOSemLemmas.html#fl">fl</a></span> <span class="id"><a href="TSOSemLemmas.html#fm1">fm1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id">m</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m0</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">fm2</span>, <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">m0</span>' <span class="id"><a href="TSOSemLemmas.html#fl">fl</a></span> <span class="id">fm2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10122')">Proof.</div>
<div class="proofscript" id="proof10122">
&nbsp;&nbsp;<span class="id">introv</span> <span class="id">Hembed</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>; <span class="id">inv</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">Classical_Prop.classic</a></span> (<span class="id">exists</span> <span class="id">b0</span> <span class="id">lo</span> <span class="id">hi</span>, <span class="id">bi</span> = <span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id">b0</span> <span class="id">lo</span> <span class="id">hi</span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H3</span> <span class="kwd">as</span> (<span class="id">b0</span> &amp; <span class="id">lo</span> &amp; <span class="id">hi</span> &amp; <span class="id">Hbi</span>); <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">Classical_Prop.classic</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> <span class="id">n</span>, <span class="id"><a href="MemAux.html#get_block">MemAux.get_block</a></span> (<span class="id"><a href="FMemory.html#Mem.freelist">Mem.freelist</a></span> <span class="id">fm1</span>) <span class="id">n</span> = <span class="id">b0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H3</span> <span class="kwd">as</span> [<span class="id">n</span> <span class="id">Hb0</span>]; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">Classical_Prop.classic</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="MemAux.html#get_block">MemAux.get_block</a></span> (<span class="id"><a href="FMemory.html#Mem.freelist">Mem.freelist</a></span> <span class="id">fm1</span>) <span class="id">n</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="FMemory.html#Mem.validblocks">Mem.validblocks</a></span> <span class="id">fm</span>'))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eexists</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="FMemory.html#Mem.mkmem">Mem.mkmem</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id">m0</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m0</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m0</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="FMemory.html#Mem.freelist">Mem.freelist</a></span> <span class="id">fm</span>') (<span class="id"><a href="FMemory.html#Mem.nextblockid">Mem.nextblockid</a></span> <span class="id">fm</span>') <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#strip">strip</a></span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#gmem_eq">gmem_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Unshelve</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fm</span>'; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fm</span>'; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hvb</span> : <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd</span> <span class="kwd">in</span> <span class="id">Hvb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hvb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H4</span> <span class="id">H3</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">strip</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H4</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H6</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fm</span>'; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hvb</span> : <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd</span> <span class="kwd">in</span> <span class="id">Hvb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hvb</span> <span class="kwd">in</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H4</span> <span class="id">H3</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>, <span class="id">strip</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H4</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m0</span>'; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m0</span>'; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m0</span>'; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">n</span> = <span class="id"><a href="FMemory.html#Mem.nextblockid">Mem.nextblockid</a></span> <span class="id">fm</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#embed_alloc_embed_still_nextblockid">embed_alloc_embed_still_nextblockid</a></span> <span class="kwd">with</span> (<span class="id">m</span>' := <span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm1</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H3</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id">fm1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="FMemory.html#Mem.nextblockid">Mem.nextblockid</a></span> <span class="id">fm</span> = <span class="id"><a href="FMemory.html#Mem.nextblockid">Mem.nextblockid</a></span> <span class="id">fm</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hembed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fm</span>, <span class="id">fm1</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>, <span class="id">strip</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>; <span class="id">inv</span> <span class="id">H4</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">invalid_noaccess0</span> <span class="id">access_max0</span> <span class="id">contents_default0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">invalid_noaccess</span> <span class="id">access_max</span> <span class="id">contents_default</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fm</span>'; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">invalid_noaccess</span> <span class="id">access_max</span> <span class="id">contents_default</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">freelist_wd</span> <span class="id">freelist_wd0</span> <span class="id">freelist_wd1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">valid_wd</span> <span class="id">valid_wd1</span> <span class="id">H</span> <span class="id">H0</span> <span class="id">valid_wd0</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> ((<span class="id">nextblockid0</span> = <span class="id">nextblockid</span> + 1)%<span class="id">coq_nat</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.lt_trichotomy">Nat.lt_trichotomy</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H1</span> <span class="id">nextblockid0</span> (<span class="id">nextblockid</span> + 1)%<span class="id">coq_nat</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="MemAux.html#get_block">MemAux.get_block</a></span> <span class="id">freelist</span> <span class="id">nextblockid</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="MemAux.html#get_block">MemAux.get_block</a></span> <span class="id">freelist</span> <span class="id">nextblockid</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd0</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="MemAux.html#get_block">MemAux.get_block</a></span> <span class="id">freelist</span> <span class="id">nextblockid</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="MemAux.html#get_block">MemAux.get_block</a></span> <span class="id">freelist</span> <span class="id">nextblockid</span> \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="MemAux.html#get_block">MemAux.get_block</a></span> <span class="id">freelist</span> <span class="id">nextblockid</span>) <span class="id">validblocks</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H1</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="TSOSemLemmas.html#getblock_always_success">getblock_always_success</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H2</span> (<span class="id">nextblockid</span> + 1)%<span class="id">coq_nat</span> <span class="id">freelist</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> [<span class="id">b</span>' <span class="id">H2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd0</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">clear</span> <span class="id">H2</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> ((<span class="id">nextblockid</span> + 1)%<span class="id">coq_nat</span> &lt;&gt; <span class="id">nextblockid</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">freelist_wd1</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd</span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Ht</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.lt_trichotomy">Nat.lt_trichotomy</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H1</span> <span class="id">nextblockid</span> <span class="id">nextblockid1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="MemAux.html#get_block">MemAux.get_block</a></span> <span class="id">freelist</span> <span class="id">nextblockid</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="MemAux.html#get_block">MemAux.get_block</a></span> <span class="id">freelist</span> <span class="id">nextblockid</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd1</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="MemAux.html#get_block">MemAux.get_block</a></span> <span class="id">freelist</span> <span class="id">nextblockid1</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="MemAux.html#get_block">MemAux.get_block</a></span> <span class="id">freelist</span> <span class="id">nextblockid1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd1</span> <span class="kwd">in</span> <span class="id">Ht</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#origin_embed_alloc_nextblock_embed_still">origin_embed_alloc_nextblock_embed_still</a></span> <span class="kwd">with</span> (<span class="id">m</span> := <span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm</span>'); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id">fm</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H1</span>, &lt;- <span class="id">H5</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="FMemory.html#Mem.mkmem">Mem.mkmem</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id">m0</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m0</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m0</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="FMemory.html#Mem.freelist">Mem.freelist</a></span> <span class="id">fm</span>') (<span class="id"><a href="FMemory.html#Mem.nextblockid">Mem.nextblockid</a></span> <span class="id">fm</span>') <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#strip">strip</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#gmem_eq">gmem_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Unshelve</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">destruct</span> <span class="id">fm</span>'; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fm</span>'; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">strip</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>; <span class="id">inv</span> <span class="id">H4</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H3</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m0</span>'; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m0</span>'; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m0</span>'; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="FMemory.html#Mem.mkmem">Mem.mkmem</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id">m0</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m0</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m0</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="FMemory.html#Mem.freelist">Mem.freelist</a></span> <span class="id">fm</span>') (<span class="id"><a href="FMemory.html#Mem.nextblockid">Mem.nextblockid</a></span> <span class="id">fm</span>') <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#strip">strip</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#gmem_eq">gmem_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Unshelve</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fm</span>'; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H3</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">free</span>, <span class="id">unchecked_free</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>; <span class="id">inv</span> <span class="id">H4</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fm</span>'; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>; <span class="id">inv</span> <span class="id">H4</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fm</span>'; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m0</span>'; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m0</span>'; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m0</span>'; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="embed_apply_buf_gm_forward_embed_stable">embed_apply_buf_gm_forward_embed_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">fl</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">fm</span> <span class="id">fm</span>' <span class="id">m0</span> <span class="id">m0</span>' <span class="id">fm0</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">b</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span>) -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOSemLemmas.html#m0">m0</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id"><a href="TSOSemLemmas.html#fl">fl</a></span> <span class="id"><a href="TSOSemLemmas.html#fm">fm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">m</span>' <span class="id"><a href="TSOSemLemmas.html#fl">fl</a></span> <span class="id">fm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id"><a href="TSOSemLemmas.html#m0">m0</a></span> <span class="id"><a href="TSOSemLemmas.html#fl">fl</a></span> <span class="id"><a href="TSOSemLemmas.html#fm0">fm0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOSemLemmas.html#m0">m0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m0</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">fm0</span>', <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">m0</span>' <span class="id"><a href="TSOSemLemmas.html#fl">fl</a></span> <span class="id">fm0</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10123')">Proof.</div>
<div class="proofscript" id="proof10123">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.le_gt_cases">Nat.le_gt_cases</a></span>. <br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H5</span> (<span class="id"><a href="FMemory.html#Mem.nextblockid">Mem.nextblockid</a></span> <span class="id">fm</span>') (<span class="id"><a href="FMemory.html#Mem.nextblockid">Mem.nextblockid</a></span> <span class="id">fm0</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="FMemory.html#Mem.mkmem">Mem.mkmem</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id">m0</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m0</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m0</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fl</span> (<span class="id"><a href="FMemory.html#Mem.nextblockid">Mem.nextblockid</a></span> <span class="id">fm0</span>) <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#strip">strip</a></span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#gmem_eq">gmem_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Unshelve</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fm</span>; <span class="id">inv</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>; <span class="id">inv</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fm</span>'; <span class="tactic">destruct</span> <span class="id">fm0</span>; <span class="id">simpls</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#in_apply_bf_mvb_in_orgin_m_or_bf_alloc">in_apply_bf_mvb_in_orgin_m_or_bf_alloc</a></span> <span class="kwd">in</span> <span class="id">H7</span>; <span class="tactic">eauto</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H7</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> (<span class="id">lo</span> &amp; <span class="id">hi</span> &amp; <span class="id">H2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#b_in_bf_alloc_in_apply_bf_m_vb">b_in_bf_alloc_in_apply_bf_m_vb</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">eauto</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H5</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>; <span class="id">inv</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fm</span>'; <span class="tactic">destruct</span> <span class="id">fm0</span>; <span class="id">simpls</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#in_apply_bf_mvb_in_orgin_m_or_bf_alloc_rev">in_apply_bf_mvb_in_orgin_m_or_bf_alloc_rev</a></span>; <span class="tactic">eauto</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd0</span> <span class="kwd">in</span> <span class="id">H7</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m0</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m0</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m0</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>; <span class="id">inv</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="FMemory.html#Mem.mkmem">Mem.mkmem</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id">m0</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m0</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m0</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="FMemory.html#Mem.freelist">Mem.freelist</a></span> <span class="id">fm</span>') (<span class="id"><a href="FMemory.html#Mem.nextblockid">Mem.nextblockid</a></span> <span class="id">fm</span>') <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#strip">strip</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#gmem_eq">gmem_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Unshelve</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fm</span>'; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fm0</span>; <span class="tactic">destruct</span> <span class="id">fm</span>'; <span class="id">simpls</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#in_apply_bf_mvb_in_orgin_m_or_bf_alloc">in_apply_bf_mvb_in_orgin_m_or_bf_alloc</a></span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">eauto</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd</span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> (<span class="id">lo</span> &amp; <span class="id">hi</span> &amp; <span class="id">H2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#b_in_bf_alloc_in_apply_bf_m_vb">b_in_bf_alloc_in_apply_bf_m_vb</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd0</span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#in_apply_bf_mvb_in_orgin_m_or_bf_alloc">in_apply_bf_mvb_in_orgin_m_or_bf_alloc</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buffer_in_validblocks_stable">apply_buffer_in_validblocks_stable</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> (<span class="id">lo</span> &amp; <span class="id">hi</span> &amp; <span class="id">H1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#alloc_in_buf_apply_buf_in_vb">alloc_in_buf_apply_buf_in_vb</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m0</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m0</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m0</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_buf_embed_apply_an_item_embed_apply_buf_embed_still">apply_buf_embed_apply_an_item_embed_apply_buf_embed_still</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">m0</span> <span class="id">m1</span> <span class="id">fl</span> <span class="id">bi</span> <span class="id">fm</span>' <span class="id">fm0</span> <span class="id">fm</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id"><a href="TSOSemLemmas.html#fl">fl</a></span> <span class="id"><a href="TSOSemLemmas.html#fm">fm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">m</span>' <span class="id"><a href="TSOSemLemmas.html#fl">fl</a></span> <span class="id">fm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOSemLemmas.html#m0">m0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id"><a href="TSOSemLemmas.html#m0">m0</a></span> <span class="id"><a href="TSOSemLemmas.html#fl">fl</a></span> <span class="id"><a href="TSOSemLemmas.html#fm0">fm0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOSemLemmas.html#m0">m0</a></span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">fm2</span>, <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> <span class="id"><a href="TSOSemLemmas.html#fl">fl</a></span> <span class="id">fm2</span>. <br/>
<div class="toggleproof" onclick="toggleDisplay('proof10124')">Proof.</div>
<div class="proofscript" id="proof10124">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m</span> = <span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m0</span> \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> <span class="id">b</span>, <span class="id">b</span> :: <span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m</span> = <span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m0</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">lo</span> <span class="id">hi</span>, <span class="id">bi</span> = <span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H2</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">free</span>, <span class="id">unchecked_free</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#vbeq_apply_buffer_embed_stable">vbeq_apply_buffer_embed_stable</a></span> <span class="kwd">with</span> (<span class="id">m1</span> := <span class="id">m</span>) (<span class="id">m2</span> := <span class="id">m0</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H5</span> <span class="kwd">as</span> (<span class="id">b</span> &amp; <span class="id">Hvb</span> &amp; <span class="id">lo</span>' &amp; <span class="id">hi</span>' &amp; <span class="id">Hbf_alloc</span>); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">Classical_Prop.classic</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> <span class="id">n</span>, <span class="id"><a href="MemAux.html#get_block">MemAux.get_block</a></span> <span class="id">fl</span> <span class="id">n</span> = <span class="id">b</span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#embed_apply_buf_gm_forward_embed_stable">embed_apply_buf_gm_forward_embed_stable</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> (<span class="id">m</span> := <span class="id">m</span>) (<span class="id">m0</span> := <span class="id">m0</span>) (<span class="id">bf</span> := <span class="id">bf</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hvb</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#vbmore_out_fl_apply_buffer_embed_stable">vbmore_out_fl_apply_buffer_embed_stable</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> (<span class="id">m1</span> := <span class="id">m</span>) (<span class="id">m1</span>' := <span class="id">m</span>') (<span class="id">m2</span> := <span class="id">m0</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hvb</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hvb</span> <span class="kwd">in</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H6</span>; <span class="tactic">subst</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H5</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="FLs_embed_gm_forward_FLs_embed_stable">FLs_embed_gm_forward_FLs_embed_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bfs</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">n</span> <span class="id">fls</span> <span class="id">fm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#FLists.wd">FLists.wd</a></span> <span class="id"><a href="TSOSemLemmas.html#fls">fls</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">b</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span>) -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m</span>')) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">b</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m</span>') -&gt; ~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">n</span>', <span class="id"><a href="MemAux.html#get_block">MemAux.get_block</a></span> (<span class="id"><a href="GlobDefs.html#FLists.get_fl">FLists.get_fl</a></span> <span class="id"><a href="TSOSemLemmas.html#fls">fls</a></span> <span class="id"><a href="TSOSemLemmas.html#n">n</a></span>) <span class="id">n</span>' = <span class="id"><a href="TSOSemLemmas.html#b">b</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">m</span>' (<span class="id"><a href="GlobDefs.html#FLists.get_fl">FLists.get_fl</a></span> <span class="id"><a href="TSOSemLemmas.html#fls">fls</a></span> <span class="id"><a href="TSOSemLemmas.html#n">n</a></span>) <span class="id">fm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOSemLemmas.html#bfs">bfs</a></span>; <span class="id">memory</span> := <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> |} -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOStepAuxLemmas.html#FLs_embed">FLs_embed</a></span> <span class="id"><a href="TSOSemLemmas.html#fls">fls</a></span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOSemLemmas.html#bfs">bfs</a></span>; <span class="id">memory</span> := <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> |} -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOStepAuxLemmas.html#FLs_embed">FLs_embed</a></span> <span class="id"><a href="TSOSemLemmas.html#fls">fls</a></span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOSemLemmas.html#bfs">bfs</a></span>; <span class="id">memory</span> := <span class="id">m</span>' |}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10125')">Proof.</div>
<div class="proofscript" id="proof10125">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">remember</span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id">bfs</span>; <span class="id">memory</span> := <span class="id">m</span> |} <span class="kwd">as</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">bfs</span>. <br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">m</span>'. <br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">m</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">fm</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">H4</span>; <span class="id">simpls</span>; <span class="tactic">intros</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">intros</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">fl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">n</span> <span class="id">flid</span>); <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Embed</span> <span class="id">flid</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Embed</span> <span class="kwd">as</span> [<span class="id">fm1</span> <span class="id">Embed</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#embed_fl_disj_vb_ext_embed_still">embed_fl_disj_vb_ext_embed_still</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span> <span class="id">n0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">flist_disj</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H3</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Happly_buf</span> : <span class="id">H5</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ABIS</span> <span class="kwd">in</span> <span class="id">Happly_buf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Happly_buf</span> <span class="kwd">as</span> [<span class="id">m0</span> <span class="id">Happly_buf</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hcons</span> : <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="TSOStepAuxLemmas.html#FLs_embed">FLs_embed</a></span> <span class="id">fls</span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id">bfs</span>; <span class="id">memory</span> := <span class="id">m</span> |}).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H3</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hembed</span> : <span class="id">Happly_buf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">UNBS1</span> <span class="kwd">in</span> <span class="id">Hembed</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hembed</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Embed1</span> <span class="id">n</span>). <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Embed1</span> <span class="kwd">as</span> [<span class="id">fm1</span> <span class="id">Embed1</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">exists</span> <span class="id">fm2</span>, <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">m</span>'0 (<span class="id"><a href="GlobDefs.html#FLists.flist_content">FLists.flist_content</a></span> <span class="id">fls</span> <span class="id">n</span>) <span class="id">fm2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Embed0</span> <span class="id">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Embed0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#embed_gm_forward_embed_stable">embed_gm_forward_embed_stable</a></span> <span class="kwd">with</span> (<span class="id">m</span>' := <span class="id">m</span>') (<span class="id">m</span> := <span class="id">m</span>); <span class="tactic">eauto</span>.      <br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H3</span> <span class="kwd">as</span> [<span class="id">fm2</span> <span class="id">H3</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">Hcons</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2 : <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Focus</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">UNBS0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;5 : <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Focus</span> 3.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (2 := <span class="id">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id">fm2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H1</span> <span class="id">H6</span> <span class="id">Happly_buf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#vb_subset_apply_buf_item_still">vb_subset_apply_buf_item_still</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H2</span> <span class="id">H1</span> <span class="id">H6</span> <span class="id">Happly_buf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#in_apply_bf_item_mvb_in_origin_or_item">in_apply_bf_item_mvb_in_origin_or_item</a></span> <span class="kwd">in</span> <span class="id">H6</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">Classical_Prop.classic</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">b</span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buffer_item_in_validbloks_stable">apply_buffer_item_in_validbloks_stable</a></span> <span class="kwd">in</span> <span class="id">H4</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H3</span> <span class="kwd">as</span> [<span class="id">lo</span> [<span class="id">hi</span> <span class="id">H3</span>]]; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Happly_buf</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Happly_buf</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">unbuffer_safe_additional_original_still</span>' :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bfs</span> <span class="id">t</span> <span class="id">bf</span> <span class="id">m</span> <span class="id">bf1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> (<span class="id"><a href="TSOSemLemmas.html#bf1">bf1</a></span> ++ <span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span>) <span class="id"><a href="TSOSemLemmas.html#bfs">bfs</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">memory</span> := <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> |} -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#bf1">bf1</a></span> <span class="id"><a href="TSOSemLemmas.html#bfs">bfs</a></span>; <span class="id">memory</span> := <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> |}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10126')">Proof.</div>
<div class="proofscript" id="proof10126">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#unbuffer_safe_addition_original_still">unbuffer_safe_addition_original_still</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_tid_eq">tupdate_same_tid_eq</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="FLs_embed_m_vbeq_ub_safe_FLs_embed_stable">FLs_embed_m_vbeq_ub_safe_FLs_embed_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fls</span> <span class="id">bfs</span> <span class="id">m</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOSemLemmas.html#bfs">bfs</a></span>; <span class="id">memory</span> := <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> |} -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOStepAuxLemmas.html#FLs_embed">FLs_embed</a></span> <span class="id"><a href="TSOSemLemmas.html#fls">fls</a></span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOSemLemmas.html#bfs">bfs</a></span>; <span class="id">memory</span> := <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> |} -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> = <span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOStepAuxLemmas.html#FLs_embed">FLs_embed</a></span> <span class="id"><a href="TSOSemLemmas.html#fls">fls</a></span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOSemLemmas.html#bfs">bfs</a></span>; <span class="id">memory</span> := <span class="id">m</span>' |}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10127')">Proof.</div>
<div class="proofscript" id="proof10127">
&nbsp;&nbsp;<span class="tactic">intros</span>. <br/>
&nbsp;&nbsp;<span class="id">remember</span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id">bfs</span>; <span class="id">memory</span> := <span class="id">m</span> |} <span class="kwd">as</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">bfs</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">m</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">m</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">H0</span>; <span class="id">simpls</span>; <span class="tactic">intros</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">intros</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">fl</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Embed</span> <span class="id">flid</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Embed</span> <span class="kwd">as</span> [<span class="id">fm</span> <span class="id">Embed</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#valid_block_stable_embed_stable">valid_block_stable_embed_stable</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Happly_buf</span> : <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ABIS</span> <span class="kwd">in</span> <span class="id">Happly_buf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Happly_buf</span> <span class="kwd">as</span> [<span class="id">m2</span> <span class="id">Happly_buf</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hcons</span> : <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">Hcons</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2 : <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;3 : <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">UNBS0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#in_valid_block_eq_apply_same_buf_item_still">in_valid_block_eq_apply_same_buf_item_still</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="FLs_embed_buf_tail_add_one_not_alloc_stable">FLs_embed_buf_tail_add_one_not_alloc_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fls</span> <span class="id">bfs</span> <span class="id">m</span> <span class="id">t</span> <span class="id">bi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> (<span class="id"><a href="TSOSemLemmas.html#bfs">bfs</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> ++ <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id"><a href="TSOSemLemmas.html#bfs">bfs</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">memory</span> := <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> |} -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOStepAuxLemmas.html#FLs_embed">FLs_embed</a></span> <span class="id"><a href="TSOSemLemmas.html#fls">fls</a></span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOSemLemmas.html#bfs">bfs</a></span>; <span class="id">memory</span> := <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> |} -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ (<span class="id">exists</span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span>, <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> = <span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOStepAuxLemmas.html#FLs_embed">FLs_embed</a></span> <span class="id"><a href="TSOSemLemmas.html#fls">fls</a></span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> (<span class="id"><a href="TSOSemLemmas.html#bfs">bfs</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> ++ <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id"><a href="TSOSemLemmas.html#bfs">bfs</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">memory</span> := <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> |}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10128')">Proof.</div>
<div class="proofscript" id="proof10128">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">remember</span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id">bfs</span>; <span class="id">memory</span> := <span class="id">m</span> |} <span class="kwd">as</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">bfs</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">m</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">bi</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">H0</span>; <span class="id">simpls</span>; <span class="tactic">intros</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">bfs</span> <span class="id">t</span>) <span class="id">eqn</span>:?; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_tid_eq">tupdate_same_tid_eq</a></span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_eq">tupdate_same_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="TSOStepAuxLemmas.html#FLs_embed">FLs_embed</a></span> <span class="id">fls</span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id">bfs</span>; <span class="id">memory</span> := <span class="id">m</span> |}).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#FLs_embed_m_vbeq_ub_safe_FLs_embed_stable">FLs_embed_m_vbeq_ub_safe_FLs_embed_stable</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id">bi0</span> :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="kwd">with</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> ++ <span class="id">bi0</span> :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">unbuffer_safe_additional_original_still</span>' <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_eq">tupdate_same_eq</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#apply_not_alloc_item_vb_eq">apply_not_alloc_item_vb_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hcons</span> : <span class="id">Heql</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Hcons</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 : <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4 : <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span> <span class="kwd">in</span> <span class="id">Hcons</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_tid_eq">tupdate_same_tid_eq</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_tid_eq">tupdate_same_tid_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H0</span> <span class="id">Heql</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">UNBS</span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_tid_eq">tupdate_same_tid_eq</a></span> <span class="kwd">in</span> <span class="id">H3</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">with</span> (<span class="id">t0</span> := <span class="id">t</span>) <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2 : <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;4 : <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_not_eq_get">tupdate_not_eq_get</a></span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_tid_neq_twice_rev">tupdate_tid_neq_twice_rev</a></span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_not_eq_get">tupdate_not_eq_get</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H0</span> <span class="id">n</span> <span class="id">H2</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_tid_neq_twice_rev">tupdate_tid_neq_twice_rev</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">UNBS</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_not_eq_get">tupdate_not_eq_get</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="FLs_embed_buf_tail_add_not_alloc_stable">FLs_embed_buf_tail_add_not_alloc_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bis</span> <span class="id">fls</span> <span class="id">bfs</span> <span class="id">m</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> (<span class="id"><a href="TSOSemLemmas.html#bfs">bfs</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> ++ <span class="id"><a href="TSOSemLemmas.html#bis">bis</a></span>) <span class="id"><a href="TSOSemLemmas.html#bfs">bfs</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">memory</span> := <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> |} -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOStepAuxLemmas.html#FLs_embed">FLs_embed</a></span> <span class="id"><a href="TSOSemLemmas.html#fls">fls</a></span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOSemLemmas.html#bfs">bfs</a></span>; <span class="id">memory</span> := <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> |} -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">bi</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#bis">bis</a></span> -&gt; ~ (<span class="id">exists</span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span>, <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> = <span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOStepAuxLemmas.html#FLs_embed">FLs_embed</a></span> <span class="id"><a href="TSOSemLemmas.html#fls">fls</a></span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> (<span class="id"><a href="TSOSemLemmas.html#bfs">bfs</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> ++ <span class="id"><a href="TSOSemLemmas.html#bis">bis</a></span>) <span class="id"><a href="TSOSemLemmas.html#bfs">bfs</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">memory</span> := <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> |}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10129')">Proof.</div>
<div class="proofscript" id="proof10129">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bis</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">buffer_unchange</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="TSOStepAuxLemmas.html#FLs_embed">FLs_embed</a></span> <span class="id">fls</span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id">t</span> (<span class="id">bfs</span> <span class="id">t</span> ++ <span class="id">a</span> :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id">bfs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">memory</span> := <span class="id">m</span> |}).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#FLs_embed_buf_tail_add_one_not_alloc_stable">FLs_embed_buf_tail_add_one_not_alloc_stable</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">bfs</span> <span class="id">t</span> ++ <span class="id">a</span> :: <span class="id">bis</span> = (<span class="id">bfs</span> <span class="id">t</span> ++ <span class="id">a</span> :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) ++ <span class="id">bis</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc_reverse">app_assoc_reverse</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">unbuffer_safe_additional_original_still</span>' <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H1</span> <span class="id">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">a</span> (<span class="id">a</span> :: <span class="id">bis</span>)); <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H3</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbis</span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_tid_eq">tupdate_same_tid_eq</a></span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc_reverse">app_assoc_reverse</a></span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_tid_eq">tupdate_same_tid_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc_reverse">app_assoc_reverse</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H1</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="FLs_embed_bf_tail_add_store_preserved">FLs_embed_bf_tail_add_store_preserved</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fls</span> <span class="id">bfs</span> <span class="id">m</span> <span class="id">c</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOSemLemmas.html#bfs">bfs</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> ++ <span class="id"><a href="TSOMem.html#BufferedStore">BufferedStore</a></span> <span class="id"><a href="TSOSemLemmas.html#c">c</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> <span class="id"><a href="TSOSemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOSemLemmas.html#v">v</a></span> :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id"><a href="TSOSemLemmas.html#bfs">bfs</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">memory</span> := <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> |} -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOStepAuxLemmas.html#FLs_embed">FLs_embed</a></span> <span class="id"><a href="TSOSemLemmas.html#fls">fls</a></span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOSemLemmas.html#bfs">bfs</a></span>; <span class="id">memory</span> := <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> |} -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOStepAuxLemmas.html#FLs_embed">FLs_embed</a></span> <span class="id"><a href="TSOSemLemmas.html#fls">fls</a></span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOSemLemmas.html#bfs">bfs</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> ++ <span class="id"><a href="TSOMem.html#BufferedStore">BufferedStore</a></span> <span class="id"><a href="TSOSemLemmas.html#c">c</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> <span class="id"><a href="TSOSemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="TSOSemLemmas.html#v">v</a></span> :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id"><a href="TSOSemLemmas.html#bfs">bfs</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">memory</span> := <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> |}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10130')">Proof.</div>
<div class="proofscript" id="proof10130">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#FLs_embed_buf_tail_add_not_alloc_stable">FLs_embed_buf_tail_add_not_alloc_stable</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span>; <span class="tactic">subst</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">b0</span> [<span class="id">lo</span> [<span class="id">hi</span> <span class="id">Hcontr</span>]]].<br/>
&nbsp;&nbsp;<span class="id">tryfalse</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="FLs_embed_bf_tail_add_alloc_preserved">FLs_embed_bf_tail_add_alloc_preserved</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fls</span> <span class="id">fl</span> <span class="id">bfs</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">fm</span>' <span class="id">t</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">n</span> <span class="id">n</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#FLists.wd">FLists.wd</a></span> <span class="id"><a href="TSOSemLemmas.html#fls">fls</a></span> -&gt; <span class="id"><a href="TSOSemLemmas.html#fl">fl</a></span> = <span class="id"><a href="GlobDefs.html#FLists.get_fl">FLists.get_fl</a></span> <span class="id"><a href="TSOSemLemmas.html#fls">fls</a></span> <span class="id"><a href="TSOSemLemmas.html#n">n</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOSemLemmas.html#bfs">bfs</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> ++ <span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> (<span class="id"><a href="MemAux.html#get_block">MemAux.get_block</a></span> <span class="id"><a href="TSOSemLemmas.html#fl">fl</a></span> <span class="id">n</span>') <span class="id"><a href="TSOSemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOSemLemmas.html#hi">hi</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id"><a href="TSOSemLemmas.html#bfs">bfs</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">memory</span> := <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> |} -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> (<span class="id"><a href="TSOSemLemmas.html#bfs">bfs</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> ++ <span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> (<span class="id"><a href="MemAux.html#get_block">MemAux.get_block</a></span> <span class="id"><a href="TSOSemLemmas.html#fl">fl</a></span> <span class="id">n</span>') <span class="id"><a href="TSOSemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOSemLemmas.html#hi">hi</a></span> :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id"><a href="TSOSemLemmas.html#m">m</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">m</span>' <span class="id"><a href="TSOSemLemmas.html#fl">fl</a></span> <span class="id">fm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOStepAuxLemmas.html#FLs_embed">FLs_embed</a></span> <span class="id"><a href="TSOSemLemmas.html#fls">fls</a></span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOSemLemmas.html#bfs">bfs</a></span>; <span class="id">memory</span> := <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> |} -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOStepAuxLemmas.html#FLs_embed">FLs_embed</a></span> <span class="id"><a href="TSOSemLemmas.html#fls">fls</a></span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOSemLemmas.html#bfs">bfs</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> ++ <span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> (<span class="id"><a href="MemAux.html#get_block">MemAux.get_block</a></span> <span class="id"><a href="TSOSemLemmas.html#fl">fl</a></span> <span class="id">n</span>') <span class="id"><a href="TSOSemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOSemLemmas.html#hi">hi</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id"><a href="TSOSemLemmas.html#bfs">bfs</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">memory</span> := <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> |}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10131')">Proof.</div>
<div class="proofscript" id="proof10131">
&nbsp;&nbsp;<span class="tactic">intros</span>. <br/>
&nbsp;&nbsp;<span class="id">remember</span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id">bfs</span>; <span class="id">memory</span> := <span class="id">m</span> |} <span class="kwd">as</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">fl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">bfs</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">m</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">m</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">lo</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">hi</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">n</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">fm</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">H4</span>; <span class="id">simpls</span>; <span class="tactic">intros</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>; <span class="id">simpls</span>; <span class="tactic">intros</span>.  <br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;{  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">bfs</span> <span class="id">t</span>) <span class="id">eqn</span>:?; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_tid_eq">tupdate_same_tid_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_eq">tupdate_same_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H3</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="TSOStepAuxLemmas.html#FLs_embed">FLs_embed</a></span> <span class="id">fls</span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id">bfs</span>; <span class="id">memory</span> := <span class="id">m</span> |}).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H5</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#FLs_embed_gm_forward_FLs_embed_stable">FLs_embed_gm_forward_FLs_embed_stable</a></span> <span class="kwd">with</span> (<span class="id">m</span> := <span class="id">m</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H5</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">n</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H5</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H3</span>; <span class="tactic">subst</span>; <span class="id">tryfalse</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id">fm</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H4</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H5</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="MemAux.html#get_block">MemAux.get_block</a></span> (<span class="id"><a href="GlobDefs.html#FLists.get_fl">FLists.get_fl</a></span> <span class="id">fls</span> <span class="id">n</span>) <span class="id">n</span>') <span class="id">lo</span> <span class="id">hi</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> ++ <span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="MemAux.html#get_block">MemAux.get_block</a></span> (<span class="id"><a href="GlobDefs.html#FLists.get_fl">FLists.get_fl</a></span> <span class="id">fls</span> <span class="id">n</span>) <span class="id">n</span>') <span class="id">lo</span> <span class="id">hi</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">unbuffer_safe_additional_original_still</span>' <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_eq">tupdate_same_eq</a></span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_tid_eq">tupdate_same_tid_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hcons</span> : <span class="id">Heql</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">Hcons</span>.  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3 : <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3 : <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 : <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Focus</span> 3.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H5</span> <span class="kwd">in</span> <span class="id">H3</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_tid_eq">tupdate_same_tid_eq</a></span> <span class="kwd">in</span> <span class="id">Hcons</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span> <span class="kwd">in</span> <span class="id">Hcons</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_tid_eq">tupdate_same_tid_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Heql</span> <span class="id">H2</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">UNBS</span> <span class="kwd">in</span> <span class="id">H5</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_tid_eq">tupdate_same_tid_eq</a></span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id">t0</span> <span class="id">b</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id">t</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">bfs</span> <span class="id">t</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="MemAux.html#get_block">MemAux.get_block</a></span> (<span class="id"><a href="GlobDefs.html#FLists.get_fl">FLists.get_fl</a></span> <span class="id">fls</span> <span class="id">n</span>) <span class="id">n</span>') <span class="id">lo</span> <span class="id">hi</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bfs</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">memory</span> := <span class="id">m</span>'0 |}).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H1</span> <span class="id">H2</span> <span class="id">H5</span> <span class="id">n0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">UNBS</span> <span class="kwd">in</span> <span class="id">H5</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_not_eq_get">tupdate_not_eq_get</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;} <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Happly_buf</span> : <span class="id">H6</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_tid_neq_twice_rev">tupdate_tid_neq_twice_rev</a></span> <span class="kwd">in</span> <span class="id">Happly_buf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#unbuffer_safe_apply_buffer">TSOMemLemmas.unbuffer_safe_apply_buffer</a></span> <span class="kwd">in</span> <span class="id">Happly_buf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span> <span class="kwd">in</span> <span class="id">Happly_buf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Happly_buf</span> <span class="kwd">as</span> [<span class="id">m</span>'1 <span class="id">Happly_buf</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Htmp</span> : <span class="id">exists</span> <span class="id">fm2</span>, <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">m</span>'1 (<span class="id"><a href="GlobDefs.html#FLists.get_fl">FLists.get_fl</a></span> <span class="id">fls</span> <span class="id">n</span>) <span class="id">fm2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Embed</span> <span class="id">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Embed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Htt</span> : <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">UNBS</span> <span class="kwd">in</span> <span class="id">H5</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H5</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Embed</span> <span class="id">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Embed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#apply_buf_embed_apply_an_item_embed_apply_buf_embed_still">apply_buf_embed_apply_an_item_embed_apply_buf_embed_still</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">bi</span> := <span class="id">bi</span>) (<span class="id">m0</span> := <span class="id">m</span>'0) (<span class="id">m</span> := <span class="id">m</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htmp</span> <span class="kwd">as</span> [<span class="id">fm2</span> <span class="id">Htmp</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hcons</span> : <span class="id">H1</span>.   <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">Hcons</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;3 : <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2 : <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2 : <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Focus</span> 3.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (6 := <span class="id">t</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#in_tbf_upd_oth_stillin">in_tbf_upd_oth_stillin</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_not_eq_get">tupdate_not_eq_get</a></span> <span class="kwd">in</span> <span class="id">Hcons</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_tid_neq_twice_rev">tupdate_tid_neq_twice_rev</a></span> <span class="kwd">in</span> <span class="id">Hcons</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_not_eq_get">tupdate_not_eq_get</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_tid_neq_twice_rev">tupdate_tid_neq_twice_rev</a></span>; <span class="tactic">eauto</span>.  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Embed</span> <span class="id">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Embed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">UNBS</span> <span class="kwd">in</span> <span class="id">H5</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="FLs_embed_exec_instr_TSO_preserved">FLs_embed_exec_instr_TSO_preserved</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ge</span> <span class="id">f</span> <span class="id">i</span> <span class="id">rs</span> <span class="id">tm</span> <span class="id">fm</span> <span class="id">rs</span>' <span class="id">bm</span>' <span class="id">fls</span> <span class="id">n</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> (<span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="id"><a href="TSOSemLemmas.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> (<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">bm</span>') (<span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id">bm</span>'))) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOStepAuxLemmas.html#FLs_embed">FLs_embed</a></span> <span class="id"><a href="TSOSemLemmas.html#fls">fls</a></span> <span class="id"><a href="TSOSemLemmas.html#tm">tm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.freelist">Mem.freelist</a></span> <span class="id"><a href="TSOSemLemmas.html#fm">fm</a></span> = <span class="id"><a href="GlobDefs.html#FLists.get_fl">FLists.get_fl</a></span> <span class="id"><a href="TSOSemLemmas.html#fls">fls</a></span> <span class="id"><a href="TSOSemLemmas.html#n">n</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOSemLemmas.html#fm">fm</a></span> = <span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOSemLemmas.html#tm">tm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#exec_instr_TSO">exec_instr_TSO</a></span> <span class="id"><a href="TSOSemLemmas.html#ge">ge</a></span> <span class="id"><a href="TSOSemLemmas.html#f">f</a></span> <span class="id"><a href="TSOSemLemmas.html#i">i</a></span> <span class="id"><a href="TSOSemLemmas.html#rs">rs</a></span> {| <span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span> := <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>; <span class="id">fmemory</span> := <span class="id"><a href="TSOSemLemmas.html#fm">fm</a></span> |} = <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Next</span> <span class="id">rs</span>' <span class="id">bm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOStepAuxLemmas.html#FLs_embed">FLs_embed</a></span> <span class="id"><a href="TSOSemLemmas.html#fls">fls</a></span> (<span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="id"><a href="TSOSemLemmas.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> (<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">bm</span>') (<span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id">bm</span>'))).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10132')">Proof.</div>
<div class="proofscript" id="proof10132">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">i</span>; <span class="id">simpls</span>; <span class="tactic">try</span> <span class="id">inv_next</span>; <span class="id">simpls</span>; <span class="id">unfolds</span> <span class="id">tsoupd</span>; <span class="id">simpls</span>; <span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">H2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_eq">tupdate_same_eq</a></span>; <span class="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="id">unfolds</span> <span class="id">exec_load_TSO</span>, <span class="id">tsoloadv</span>; <span class="id">ex_match2</span>; <span class="tactic">try</span> <span class="id">inv_next</span>; <span class="id">simpls</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_eq">tupdate_same_eq</a></span>; <span class="tactic">eauto</span>; <span class="tactic">destruct</span> <span class="id">tm</span>; <span class="id">simpls</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">H2</span>; <span class="tactic">eauto</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="id">unfolds</span> <span class="id">exec_store_TSO</span>, <span class="id">tsostorev</span>, <span class="id">tsostore</span>, <span class="id">buffer_insert</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">try</span> <span class="id">inv_next</span>; <span class="tactic">try</span> <span class="id">inv_some</span>; <span class="id">simpls</span>; <span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>; <span class="id">simpls</span>; <span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#FLs_embed_bf_tail_add_store_preserved">FLs_embed_bf_tail_add_store_preserved</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="id">unfolds</span> <span class="id">tso_goto_label</span>; <span class="id">ex_match2</span>; <span class="tactic">try</span> <span class="id">inv_next</span>; <span class="id">simpls</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> *; <span class="tactic">destruct</span> <span class="id">tm</span>; <span class="id">simpls</span>; <span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_eq">tupdate_same_eq</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">tsoloadv</span>, <span class="id">tsoload</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">try</span> <span class="id">inv_next</span>; <span class="id">unfolds</span> <span class="id">buffer_insert</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> *. <br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#FLs_embed_buf_tail_add_one_not_alloc_stable">FLs_embed_buf_tail_add_one_not_alloc_stable</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H3</span> <span class="kwd">as</span> (<span class="id">b0</span>' &amp; <span class="id">lo</span> &amp; <span class="id">hi</span> &amp; <span class="id">Hcontr</span>); <span class="id">tryfalse</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">try</span> <span class="id">inv_next</span>; <span class="id">simpls</span>; <span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_eq">tupdate_same_eq</a></span> <span class="kwd">in</span> *; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#FLs_embed_m_vbeq_ub_safe_FLs_embed_stable">FLs_embed_m_vbeq_ub_safe_FLs_embed_stable</a></span> <span class="kwd">with</span> (<span class="id">m</span> := <span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">tm</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#unbuffer_safe_mem_access_same_stable">unbuffer_safe_mem_access_same_stable</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.storev</span>, <span class="id">Mem.store</span>; <span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hx1</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#Mem_GMem_access_eq">Mem_GMem_access_eq</a></span>, <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.storev</span>, <span class="id">Mem.store</span>; <span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hx1</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#mem_strip_gm_vb_eq">mem_strip_gm_vb_eq</a></span>, <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">try</span> <span class="id">inv_next</span>; <span class="id">simpls</span>; <span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_eq">tupdate_same_eq</a></span> <span class="kwd">in</span> *; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#FLs_embed_m_vbeq_ub_safe_FLs_embed_stable">FLs_embed_m_vbeq_ub_safe_FLs_embed_stable</a></span> <span class="kwd">with</span> (<span class="id">m</span> := <span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">tm</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#unbuffer_safe_mem_access_same_stable">unbuffer_safe_mem_access_same_stable</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.storev</span>, <span class="id">Mem.store</span>; <span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hx3</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#Mem_GMem_access_eq">Mem_GMem_access_eq</a></span>, <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.storev</span>, <span class="id">Mem.store</span>; <span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hx3</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#mem_strip_gm_vb_eq">mem_strip_gm_vb_eq</a></span>, <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span>; <span class="tactic">destruct</span> <span class="id">tm</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">try</span> <span class="id">inv_next</span>; <span class="id">simpls</span>; <span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_eq">tupdate_same_eq</a></span> <span class="kwd">in</span> *; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#FLs_embed_m_vbeq_ub_safe_FLs_embed_stable">FLs_embed_m_vbeq_ub_safe_FLs_embed_stable</a></span> <span class="kwd">with</span> (<span class="id">m</span> := <span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">tm</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#unbuffer_safe_mem_access_same_stable">unbuffer_safe_mem_access_same_stable</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.storev</span>, <span class="id">Mem.store</span>; <span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hx2</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#Mem_GMem_access_eq">Mem_GMem_access_eq</a></span>, <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.storev</span>, <span class="id">Mem.store</span>; <span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hx2</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#mem_strip_gm_vb_eq">mem_strip_gm_vb_eq</a></span>, <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="FLs_embed_tau_step_preserved">FLs_embed_tau_step_preserved</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fls</span> <span class="id">ge</span> <span class="id">fl</span> <span class="id">c</span> <span class="id">c</span>' <span class="id">tm</span> <span class="id">b</span>' <span class="id">gm</span>' <span class="id">fp</span> <span class="id">t</span> <span class="id">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> (<span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="id"><a href="TSOSemLemmas.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id">b</span>' <span class="id">gm</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#FLists.wd">FLists.wd</a></span> <span class="id"><a href="TSOSemLemmas.html#fls">fls</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOStepAuxLemmas.html#FLs_embed">FLs_embed</a></span> <span class="id"><a href="TSOSemLemmas.html#fls">fls</a></span> <span class="id"><a href="TSOSemLemmas.html#tm">tm</a></span> -&gt; <span class="id"><a href="TSOSemLemmas.html#fl">fl</a></span> = <span class="id"><a href="GlobDefs.html#FLists.get_fl">FLists.get_fl</a></span> <span class="id"><a href="TSOSemLemmas.html#fls">fls</a></span> <span class="id"><a href="TSOSemLemmas.html#n">n</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#tsostep">tsostep</a></span> <span class="id"><a href="TSOSemLemmas.html#ge">ge</a></span> <span class="id"><a href="TSOSemLemmas.html#fl">fl</a></span> <span class="id"><a href="TSOSemLemmas.html#c">c</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>, <span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOSemLemmas.html#tm">tm</a></span>) <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> <span class="id">c</span>' (<span class="id">b</span>', <span class="id">gm</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOStepAuxLemmas.html#FLs_embed">FLs_embed</a></span> <span class="id"><a href="TSOSemLemmas.html#fls">fls</a></span> (<span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="id"><a href="TSOSemLemmas.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id">b</span>' <span class="id">gm</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10133')">Proof.</div>
<div class="proofscript" id="proof10133">
&nbsp;&nbsp;<span class="id">introv</span> <span class="id">Hub_safe</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H7</span>. <br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H10</span>; <span class="id">simpls</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">rewrite</span> <span class="id">H2</span>; <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span>; <span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_eq">tupdate_same_eq</a></span>; <span class="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>].<br/>
<div class="doc">normal step </div>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#FLs_embed_exec_instr_TSO_preserved">FLs_embed_exec_instr_TSO_preserved</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
<div class="doc">alloc frame </div>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">tsostore</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H8</span>; <span class="id">inv</span> <span class="id">H9</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#buffer_insert">buffer_insert</a></span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="TSOStepAuxLemmas.html#FLs_embed">FLs_embed</a></span> <span class="id">fls</span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">memory</span> := <span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">tm</span> |}).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H14</span>, <span class="id">Hub_safe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hub_safe1</span> : <span class="id">Hub_safe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="kwd">in</span> <span class="id">Hub_safe1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">unbuffer_safe_additional_original_still</span>' <span class="kwd">in</span> <span class="id">Hub_safe1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hub_safe2</span> : <span class="id">Hub_safe1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">unbuffer_safe_additional_original_still</span>' <span class="kwd">in</span> <span class="id">Hub_safe2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hub_safe3</span> : <span class="id">Hub_safe2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">unbuffer_safe_additional_original_still</span>' <span class="kwd">in</span> <span class="id">Hub_safe3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_eq">tupdate_same_eq</a></span> <span class="kwd">in</span> <span class="id">Hub_safe3</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Halloc</span> : <span class="id">exists</span> <span class="id">gm</span>'', <span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="id">gm</span>' (<span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id">fm</span>') 0 <span class="id">sz</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">gm</span>'').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hembed</span> : <span class="id">H16</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hembed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Halloc</span> <span class="kwd">as</span> [<span class="id">gm</span>'' <span class="id">Halloc</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hembed1</span> : <span class="id">Halloc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#origin_embed_alloc_nextblock_embed_still">origin_embed_alloc_nextblock_embed_still</a></span> <span class="kwd">in</span> <span class="id">Hembed1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hembed1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#FLs_embed_bf_tail_add_alloc_preserved">FLs_embed_bf_tail_add_alloc_preserved</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> (<span class="id">t</span> := <span class="id">t</span>) (<span class="id">lo</span> := 0%<span class="id">Z</span>) (<span class="id">hi</span> := <span class="id">sz</span>) (<span class="id">m</span>' := <span class="id">gm</span>'') <span class="kwd">in</span> <span class="id">H6</span>; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#FLs_embed_bf_tail_add_store_preserved">FLs_embed_bf_tail_add_store_preserved</a></span> <span class="kwd">with</span> (<span class="id">t</span> := <span class="id">t</span>) <span class="kwd">in</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#FLs_embed_bf_tail_add_store_preserved">FLs_embed_bf_tail_add_store_preserved</a></span> <span class="kwd">with</span> (<span class="id">t</span> := <span class="id">t</span>) <span class="kwd">in</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_tid_eq">tupdate_same_tid_eq</a></span> <span class="kwd">in</span> <span class="id">H6</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span> <span class="kwd">in</span> <span class="id">H6</span>).  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span>; <span class="tactic">rewrite</span> <span class="id">H7</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_tid_eq">tupdate_same_tid_eq</a></span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.nextblock</span>; <span class="tactic">rewrite</span> &lt;- <span class="id">H7</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_tid_eq">tupdate_same_tid_eq</a></span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.nextblock</span>; <span class="tactic">rewrite</span> &lt;- <span class="id">H7</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.nextblock</span>; <span class="tactic">rewrite</span> &lt;- <span class="id">H7</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#apply_buffer_cons">apply_buffer_cons</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span>, <span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.nextblock</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H7</span>; <span class="tactic">rewrite</span> <span class="id">Halloc</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
<div class="doc">initialization </div>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Halloc1</span> : <span class="id">exists</span> <span class="id">gm</span>'', <span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="id">gm</span>' (<span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id">fm</span>') 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">z</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| 0 =&gt; 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Z.pos</span> <span class="id">y</span>' =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.pos">Z.pos</a></span> <span class="id">y</span>'~0~0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Z.neg</span> <span class="id">y</span>' =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.neg">Z.neg</a></span> <span class="id">y</span>'~0~0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">gm</span>'').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Halloc1</span> <span class="kwd">as</span> [<span class="id">gm</span>'' <span class="id">Halloc1</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="TSOStepAuxLemmas.html#FLs_embed">FLs_embed</a></span> <span class="id">fls</span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">memory</span> := <span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">tm</span> |}).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">tsoupd</span>, <span class="id">store_args_fmem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#store_args_rec_fmem_add_store_buf_item">store_args_rec_fmem_add_store_buf_item</a></span> <span class="kwd">in</span> <span class="id">H6</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H6</span> <span class="kwd">as</span> (<span class="id">bis</span> &amp; <span class="id">Hbf</span> &amp; <span class="id">Hmem</span> &amp; <span class="id">Hstore_item</span>); <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hembed1</span> : <span class="id">Halloc1</span>.  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#origin_embed_alloc_nextblock_embed_still">origin_embed_alloc_nextblock_embed_still</a></span> <span class="kwd">in</span> <span class="id">Hembed1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hembed1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#FLs_embed_bf_tail_add_alloc_preserved">FLs_embed_bf_tail_add_alloc_preserved</a></span> <span class="kwd">with</span> (<span class="id">m</span>' := <span class="id">gm</span>'') <span class="kwd">in</span> <span class="id">H4</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#FLs_embed_buf_tail_add_not_alloc_stable">FLs_embed_buf_tail_add_not_alloc_stable</a></span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_tid_eq">tupdate_same_tid_eq</a></span> <span class="kwd">in</span> <span class="id">H4</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span> <span class="kwd">in</span> <span class="id">H4</span>). <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hbf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc_reverse">app_assoc_reverse</a></span> <span class="kwd">in</span> * ).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H13</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H6</span> <span class="kwd">in</span> <span class="id">H4</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hbf</span> <span class="kwd">in</span> <span class="id">Hub_safe</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">Hub_safe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_tid_eq">tupdate_same_tid_eq</a></span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.nextblock</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H13</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H6</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hstore_item</span> <span class="kwd">in</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H6</span> <span class="kwd">as</span> (<span class="id">c</span> &amp; <span class="id">b</span> &amp; <span class="id">ofs</span> &amp; <span class="id">v</span> &amp; <span class="id">Hstore_item</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H6</span> <span class="kwd">as</span> (<span class="id">b</span>' &amp; <span class="id">lo</span> &amp; <span class="id">hi</span> &amp; <span class="id">Halloc</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hbf</span> <span class="kwd">in</span> <span class="id">Hub_safe</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">Hub_safe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">unbuffer_safe_additional_original_still</span>' <span class="kwd">in</span> <span class="id">Hub_safe</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H13</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#apply_buffer_cons">apply_buffer_cons</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span>, <span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.nextblock</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H13</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H6</span>; <span class="tactic">rewrite</span> <span class="id">Halloc1</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="FLs_embed_preserved">FLs_embed_preserved</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc</span> <span class="id">l</span> <span class="id">fp</span> <span class="id">tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#FLists.wd">FLists.wd</a></span> (<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.freelists">TSOGlobEnv.freelists</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span>) -&gt;    <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOStepAuxLemmas.html#FLs_embed">FLs_embed</a></span> (<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.freelists">TSOGlobEnv.freelists</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span>) (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id"><a href="TSOSemLemmas.html#l">l</a></span> <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOStepAuxLemmas.html#FLs_embed">FLs_embed</a></span> (<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.freelists">TSOGlobEnv.freelists</a></span> <span class="id"><a href="TSOSemLemmas.html#TGE">TGE</a></span>) (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">tpc</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10134')">Proof.</div>
<div class="proofscript" id="proof10134">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
<div class="doc">Core Step </div>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hub_safe</span>' : <span class="id">H_core_step</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#unbuffer_safe_after_tsostep_unbuffer_safe_original">unbuffer_safe_after_tsostep_unbuffer_safe_original</a></span> <span class="kwd">in</span> <span class="id">Hub_safe</span>';<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#FLs_embed_tau_step_preserved">FLs_embed_tau_step_preserved</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
<div class="doc">Unbuffer </div>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">unbuffer</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_unbuf</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">UNBS</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
&nbsp;&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="tsostep_buffered_alloc_in_fl">tsostep_buffered_alloc_in_fl</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ge</span> <span class="id">fl</span> <span class="id">c</span> <span class="id">buf</span> <span class="id">gm</span> <span class="id">fp</span> <span class="id">c</span>' <span class="id">buf</span>' <span class="id">gm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#tsostep">tsostep</a></span> <span class="id"><a href="TSOSemLemmas.html#ge">ge</a></span> <span class="id"><a href="TSOSemLemmas.html#fl">fl</a></span> <span class="id"><a href="TSOSemLemmas.html#c">c</a></span> (<span class="id"><a href="TSOSemLemmas.html#buf">buf</a></span>, <span class="id"><a href="TSOSemLemmas.html#gm">gm</a></span>) <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> <span class="id">c</span>' (<span class="id">buf</span>', <span class="id">gm</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">tail</span>, <span class="id">buf</span>' = <span class="id"><a href="TSOSemLemmas.html#buf">buf</a></span> ++ <span class="id">tail</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> <span class="id"><a href="TSOSemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOSemLemmas.html#hi">hi</a></span>) <span class="id">tail</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">n</span>, <span class="id"><a href="GlobDefs.html#FLists.get_block">FLists.get_block</a></span> <span class="id"><a href="TSOSemLemmas.html#fl">fl</a></span> <span class="id">n</span> = <span class="id"><a href="TSOSemLemmas.html#b">b</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10135')">Proof.</div>
<div class="proofscript" id="proof10135">
&nbsp;&nbsp;<span class="tactic">clear</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#TSO_eff">TSO_eff</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> [].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bf_chg</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">x</span>;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">enough</span>(<span class="id">buf</span>&lt;&gt;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>\/<span class="id">buf</span>&lt;&gt;<span class="id">buf</span>'). <span class="tactic">apply</span> <span class="id">bf_eff</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#BufferEff">BufferEff</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_inv_head">app_inv_head</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#buffer_local_alloc">buffer_local_alloc</a></span>,<span class="id"><a href="TSOAuxDefs.html#buffer_item_local_alloc">buffer_item_local_alloc</a></span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H3</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">right</span>. <span class="tactic">rewrite</span> <span class="id">H</span>. <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">buf</span> ++ <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> = <span class="id">buf</span> ++ <span class="id">x</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;-<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_end">app_nil_end</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_inv_head">app_inv_head</a></span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="tactic">subst</span>. <span class="id">inv</span> <span class="id">H0</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="normal_reorder">normal_reorder</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Variable</span> <span class="id"><a name="normal_reorder.TGE">TGE</a></span>:<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.t">TSOGlobEnv.t</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Hypothesis</span> <span class="id"><a name="normal_reorder.FLISTWD">FLISTWD</a></span>: <span class="id"><a href="GlobDefs.html#FLists.wd">FLists.wd</a></span> (<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.freelists">TSOGlobEnv.freelists</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span>).<br/>
&nbsp;&nbsp;<span class="kwd">Local</span> <span class="kwd">Notation</span> "{ <span class="id">A</span> , <span class="id">B</span> , <span class="id">C</span>  }" := {|<span class="id"><a href="TSOGlobSem.html#Build_TSOProgConfig">thrdpool</a></span>:=<span class="id">A</span>;<span class="id">cid</span>:=<span class="id">B</span>;<span class="id">tm</span>:=<span class="id">C</span>|}(<span class="tactic">at</span> <span class="id">level</span> 70,<span class="id">right</span> <span class="id">associativity</span>).<br/>
&nbsp;&nbsp;<span class="kwd">Local</span> <span class="kwd">Notation</span> "{-| <span class="id">PC</span> , <span class="id">T</span> }" := ({|<span class="id"><a href="TSOGlobSem.html#Build_TSOProgConfig">thrdpool</a></span> := <span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id">PC</span>; <span class="id">cid</span> := <span class="id">T</span>;<span class="id">tm</span> := <span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">PC</span>;|}) (<span class="tactic">at</span> <span class="id">level</span> 70,<span class="id">right</span> <span class="id">associativity</span>).<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Ltac</span> <span class="id">clear_get</span>:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">Maps.PMap.gsspec</a></span> <span class="kwd">in</span> *;(<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">Coqlib.peq</a></span>;<span class="tactic">subst</span>;<span class="tactic">try</span> <span class="id">contradiction</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">subst</span>)).<br/>
&nbsp;&nbsp;<span class="kwd">Ltac</span> <span class="id">clear_set</span>:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.set2">Maps.PMap.set2</a></span> <span class="kwd">in</span> *;(<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">Coqlib.peq</a></span>;<span class="tactic">subst</span>;<span class="tactic">try</span> <span class="id">contradiction</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">subst</span>)).<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Ltac</span> <span class="id">solv_eq</span>:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H1</span>: ?<span class="id">P</span> = <span class="id">_</span>, <span class="id">H2</span>: ?<span class="id">P</span> = <span class="id">_</span> |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">clear</span> <span class="id">H1</span> <span class="id">H2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H1</span>: ?<span class="id">P</span> = <span class="id">_</span> , <span class="id">H2</span>: <span class="id">_</span> = ?<span class="id">P</span> |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">clear</span> <span class="id">H1</span> <span class="id">H2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H1</span>: <span class="id">_</span> = ?<span class="id">P</span>, <span class="id">H2</span>: <span class="id">_</span> = ?<span class="id">P</span> |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">clear</span> <span class="id">H1</span> <span class="id">H2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;); <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> (<span class="tactic">trivial</span>; <span class="tactic">fail</span>).<br/>
&nbsp;&nbsp;<span class="kwd">Ltac</span> <span class="id">solv_thread</span>:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>:<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.update">TSOThrdPool.update</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="id">inv</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>:<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.halted">TSOThrdPool.halted</a></span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="id">inv</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span>  <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span>,  <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.push">TSOThrdPool.push</a></span>, <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.valid_tid">TSOThrdPool.valid_tid</a></span>  <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">Maps.PMap.gsspec</a></span> <span class="kwd">in</span> *;(<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">Coqlib.peq</a></span>;<span class="tactic">subst</span>;<span class="tactic">try</span> <span class="id">contradiction</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">subst</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H</span>: <span class="id">context</span>[<span class="kwd">match</span> ?<span class="id">x</span> <span class="kwd">with</span> <span class="id">_</span> =&gt; <span class="id">_</span> <span class="kwd">end</span>] |- <span class="id">_</span> =&gt; <span class="tactic">destruct</span> <span class="id">x</span> <span class="id">eqn</span>:?; <span class="tactic">try</span> (<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">fail</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">_</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">clear</span> <span class="id">H</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>:?<span class="id">P</span> = ?<span class="id">Q</span>, <span class="id">H1</span>:<span class="id">context</span> [ ?<span class="id">P</span> ] |- <span class="id">_</span> =&gt; <span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>:?<span class="id">P</span> = ?<span class="id">Q</span> |- <span class="id">context</span> [ ?<span class="id">P</span> ] =&gt; <span class="tactic">rewrite</span> <span class="id">H</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solv_eq</span>; <span class="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_set</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="kwd">Record</span> <span class="id"><a name="inv_cs">inv_cs</a></span> (<span class="id">cs</span>:  (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (@<span class="id"><a href="TSOGlobSem.html#TSOCore.t">TSOCore.t</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span>))) (<span class="id">i</span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span>) (<span class="id">next</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="fid_belongsto">fid_belongsto</a></span>: <span class="kwd">forall</span> <span class="id">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#c">c</a></span> <span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#FLists.fbelongsto">FLists.fbelongsto</a></span> (<span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span>.(<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.freelists">TSOGlobEnv.freelists</a></span>)) <span class="id"><a href="TSOSemLemmas.html#i">i</a></span> <span class="id"><a href="TSOSemLemmas.html#c">c</a></span>.(<span class="id"><a href="TSOGlobSem.html#TSOCore.F">TSOCore.F</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="fid_valid">fid_valid</a></span>: <span class="kwd">forall</span> <span class="id">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#c">c</a></span> <span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">n</span>, (<span class="id">n</span> &lt; <span class="id"><a href="TSOSemLemmas.html#next">next</a></span>)%<span class="id">coq_nat</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#FLists.get_tfid">FLists.get_tfid</a></span> (<span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span>.(<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.freelists">TSOGlobEnv.freelists</a></span>)) <span class="id"><a href="TSOSemLemmas.html#i">i</a></span> <span class="id">n</span> = <span class="id"><a href="TSOSemLemmas.html#c">c</a></span>.(<span class="id"><a href="TSOGlobSem.html#TSOCore.F">TSOCore.F</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="fid_disjoint">fid_disjoint</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n1</span> <span class="id">n2</span> (<span class="id">core1</span> <span class="id">core2</span>: @<span class="id"><a href="TSOGlobSem.html#TSOCore.t">TSOCore.t</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span> <span class="id"><a href="TSOSemLemmas.html#n1">n1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOSemLemmas.html#core1">core1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span> <span class="id"><a href="TSOSemLemmas.html#n2">n2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOSemLemmas.html#core2">core2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOCore.F">TSOCore.F</a></span> <span class="id"><a href="TSOSemLemmas.html#core1">core1</a></span>) = (<span class="id"><a href="TSOGlobSem.html#TSOCore.F">TSOCore.F</a></span> <span class="id"><a href="TSOSemLemmas.html#core2">core2</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#n1">n1</a></span> = <span class="id"><a href="TSOSemLemmas.html#n2">n2</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="inv_cs_update">inv_cs_update</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">cs</span> <span class="id">cc</span> <span class="id">c</span>' <span class="id">i</span> <span class="id">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOCore.update">TSOCore.update</a></span> <span class="id"><a href="TSOSemLemmas.html#c">c</a></span> <span class="id"><a href="TSOSemLemmas.html#cc">cc</a></span> <span class="id">c</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#inv_cs">inv_cs</a></span> (<span class="id"><a href="TSOSemLemmas.html#c">c</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span>) <span class="id"><a href="TSOSemLemmas.html#i">i</a></span> <span class="id"><a href="TSOSemLemmas.html#n">n</a></span> &lt;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#inv_cs">inv_cs</a></span> (<span class="id">c</span>'::<span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span>) <span class="id"><a href="TSOSemLemmas.html#i">i</a></span> <span class="id"><a href="TSOSemLemmas.html#n">n</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10136')">Proof.</div>
<div class="proofscript" id="proof10136">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="id">inv</span> <span class="id">H0</span>. <span class="id">constructor</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inv</span> <span class="id">H0</span>; <span class="id">inv</span> <span class="id">H</span>;<span class="tactic">simpl</span>;<span class="tactic">auto</span>;<span class="tactic">eapply</span> <span class="id">fid_belongsto0</span>;<span class="tactic">eauto</span>;<span class="tactic">simpl</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inv</span> <span class="id">H0</span>; <span class="id">inv</span> <span class="id">H</span>;<span class="tactic">simpl</span>;<span class="tactic">auto</span>;<span class="tactic">eapply</span> <span class="id">fid_valid0</span>;<span class="tactic">eauto</span>;<span class="tactic">simpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">assert</span>(<span class="id">exists</span> <span class="id">core3</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id">c</span>::<span class="id">cs</span>) <span class="id">n1</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">core3</span> /\ <span class="id"><a href="TSOGlobSem.html#TSOCore.F">TSOCore.F</a></span> <span class="id">core1</span> = <span class="id"><a href="TSOGlobSem.html#TSOCore.F">TSOCore.F</a></span> <span class="id">core3</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n1</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">H0</span>. <span class="id">exists</span> <span class="id">c</span>;<span class="tactic">split</span>;<span class="tactic">auto</span>. <span class="id">inv</span> <span class="id">H</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">exists</span> <span class="id">core1</span>;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">exists</span> <span class="id">core4</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id">c</span>::<span class="id">cs</span>) <span class="id">n2</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">core4</span> /\ <span class="id"><a href="TSOGlobSem.html#TSOCore.F">TSOCore.F</a></span> <span class="id">core2</span> = <span class="id"><a href="TSOGlobSem.html#TSOCore.F">TSOCore.F</a></span> <span class="id">core4</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n2</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">H1</span>. <span class="id">exists</span> <span class="id">c</span>. <span class="tactic">split</span>;<span class="tactic">auto</span>.  <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">exists</span> <span class="id">core2</span>;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">fid_disjoint0</span>;<span class="tactic">eauto</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="id">constructor</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [? <span class="id">_</span> <span class="id">_</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">subst</span>. <span class="id">specialize</span> (<span class="id">fid_belongsto0</span> <span class="id">c</span>'). <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id">fid_belongsto0</span>;<span class="tactic">simpl</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">fid_belongsto0</span>. <span class="id">right</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">_</span> ? <span class="id">_</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">subst</span>. <span class="id">specialize</span> (<span class="id">fid_valid0</span> <span class="id">c</span>'). <span class="tactic">destruct</span> <span class="id">fid_valid0</span>. <span class="id">left</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">x</span>. <span class="tactic">destruct</span> <span class="id">H0</span>;<span class="tactic">split</span>;<span class="tactic">auto</span>. <span class="id">inv</span> <span class="id">H</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">fid_valid0</span>. <span class="id">right</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">_</span> <span class="id">_</span> ?].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">exists</span> <span class="id">core3</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id">c</span>'::<span class="id">cs</span>) <span class="id">n1</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">core3</span> /\ <span class="id"><a href="TSOGlobSem.html#TSOCore.F">TSOCore.F</a></span> <span class="id">core1</span> = <span class="id"><a href="TSOGlobSem.html#TSOCore.F">TSOCore.F</a></span> <span class="id">core3</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n1</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">H1</span>. <span class="id">exists</span> <span class="id">c</span>';<span class="tactic">split</span>;<span class="tactic">auto</span>. <span class="id">inv</span> <span class="id">H</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">exists</span> <span class="id">core1</span>;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">exists</span> <span class="id">core4</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id">c</span>'::<span class="id">cs</span>) <span class="id">n2</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">core4</span> /\ <span class="id"><a href="TSOGlobSem.html#TSOCore.F">TSOCore.F</a></span> <span class="id">core2</span> = <span class="id"><a href="TSOGlobSem.html#TSOCore.F">TSOCore.F</a></span> <span class="id">core4</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n2</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">H2</span>. <span class="id">exists</span> <span class="id">c</span>'. <span class="tactic">split</span>;<span class="tactic">auto</span>.  <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">exists</span> <span class="id">core2</span>;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">fid_disjoint0</span>;<span class="tactic">eauto</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="inv_cs_pop">inv_cs_pop</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">cs</span> <span class="id">i</span> <span class="id">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#inv_cs">inv_cs</a></span> (<span class="id"><a href="TSOSemLemmas.html#c">c</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span>) <span class="id"><a href="TSOSemLemmas.html#i">i</a></span> <span class="id"><a href="TSOSemLemmas.html#n">n</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#inv_cs">inv_cs</a></span> <span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span> <span class="id"><a href="TSOSemLemmas.html#i">i</a></span> <span class="id"><a href="TSOSemLemmas.html#n">n</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10137')">Proof.</div>
<div class="proofscript" id="proof10137">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">constructor</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="tactic">eapply</span> <span class="id">H</span>;<span class="id">right</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">enough</span>(<span class="id">n1</span>.+1=<span class="id">n2</span>.+1).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H3</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Record</span> <span class="id"><a name="inv">inv</a></span> (<span class="id">thdp</span>: <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.t">TSOThrdPool.t</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="tp_finite">tp_finite</a></span>: <span class="kwd">forall</span> <span class="id">i</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pge">Pge</a></span> <span class="id"><a href="TSOSemLemmas.html#i">i</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>.(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.next_tid">TSOThrdPool.next_tid</a></span>) -&gt; <span class="id"><a href="Maps.html#PMap.get">PMap.get</a></span> <span class="id"><a href="TSOSemLemmas.html#i">i</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>.(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="tp_valid">tp_valid</a></span>: <span class="kwd">forall</span> <span class="id">i</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Coqlib.html#Plt">Plt</a></span> <span class="id"><a href="TSOSemLemmas.html#i">i</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>.(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.next_tid">TSOThrdPool.next_tid</a></span>) -&gt; <span class="id">exists</span> <span class="id">cs</span>, <span class="id"><a href="Maps.html#PMap.get">PMap.get</a></span> <span class="id"><a href="TSOSemLemmas.html#i">i</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>.(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">cs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="thdp_default">thdp_default</a></span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>.(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="cs_inv">cs_inv</a></span>: <span class="kwd">forall</span> <span class="id">i</span> <span class="id">cs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#PMap.get">PMap.get</a></span> <span class="id"><a href="TSOSemLemmas.html#i">i</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>.(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#inv_cs">inv_cs</a></span> <span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span> <span class="id"><a href="TSOSemLemmas.html#i">i</a></span> (<span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>.(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.next_fmap">TSOThrdPool.next_fmap</a></span>) <span class="id"><a href="TSOSemLemmas.html#i">i</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="inv_update_preserve">inv_update_preserve</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">thdp</span> <span class="id">t</span> <span class="id">c</span> <span class="id">cs</span> <span class="id">cc</span> <span class="id">c</span>' <span class="id">thdp</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>)!!<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c">c</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span>)-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOCore.update">TSOCore.update</a></span> <span class="id"><a href="TSOSemLemmas.html#c">c</a></span> <span class="id"><a href="TSOSemLemmas.html#cc">cc</a></span> <span class="id">c</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.update">TSOThrdPool.update</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id">c</span>' <span class="id">thdp</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#inv">inv</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>&lt;-&gt;<span class="id"><a href="TSOSemLemmas.html#inv">inv</a></span> <span class="id">thdp</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10138')">Proof.</div>
<div class="proofscript" id="proof10138">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>;<span class="id">constructor</span>;<span class="tactic">simpl</span>;<span class="tactic">auto</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">tp_finite0</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>;<span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">tp_valid0</span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>;<span class="tactic">auto</span>. <span class="tactic">subst</span>. <span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_cs_update">inv_cs_update</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">apply</span> <span class="id">H0</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>;<span class="id">constructor</span>;<span class="tactic">simpl</span>;<span class="tactic">auto</span>;<span class="tactic">intros</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">tp_finite0</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="id">ex_match</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">tp_valid0</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="id">Hsimpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="id">ex_match</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>;<span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">i</span>). <span class="tactic">subst</span>. <span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_cs_update">inv_cs_update</a></span>;<span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">cs_inv0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">cs_inv0</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="inv_push_preserve">inv_push_preserve</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">thdp</span> <span class="id">t</span> <span class="id">m</span> <span class="id">sg</span> <span class="id">cc</span> <span class="id">thdp</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.push">TSOThrdPool.push</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id"><a href="TSOSemLemmas.html#cc">cc</a></span> <span class="id"><a href="TSOSemLemmas.html#sg">sg</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#inv">inv</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span> -&gt;<span class="id"><a href="TSOSemLemmas.html#inv">inv</a></span> <span class="id">thdp</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10139')">Proof.</div>
<div class="proofscript" id="proof10139">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>;<span class="tactic">simpl</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span>. <span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> []. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span>. <span class="id">ex_match2</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">subst</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">Heqo</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>. <span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#FLists.fbelongsto">FLists.fbelongsto</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>;<span class="tactic">simpl</span>. <span class="id">eexists</span>;<span class="tactic">split</span>;<span class="tactic">eauto</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#fid_valid">fid_valid</a></span> <span class="kwd">in</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [?[]]. <span class="id">exists</span> <span class="id">x</span>;<span class="tactic">split</span>;<span class="tactic">eauto</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n1</span>,<span class="id">n2</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id"><a href="TSOSemLemmas.html#fid_valid">fid_valid</a></span>. <span class="tactic">apply</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Coqlib.html#nth_error_in">nth_error_in</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H4</span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradict</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.FLISTWD">FLISTWD</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id"><a href="TSOSemLemmas.html#fid_valid">fid_valid</a></span>. <span class="tactic">apply</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Coqlib.html#nth_error_in">nth_error_in</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H4</span>. <span class="id">inv</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H5</span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradict</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.FLISTWD">FLISTWD</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">f_equal</span>. <span class="tactic">eapply</span> <span class="id">H0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span> <span class="kwd">in</span> <span class="id">H</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="inv_pop_preserve">inv_pop_preserve</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">thdp</span> <span class="id">t</span> <span class="id">thdp</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#inv">inv</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>-&gt;<span class="id"><a href="TSOSemLemmas.html#inv">inv</a></span> <span class="id">thdp</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10140')">Proof.</div>
<div class="proofscript" id="proof10140">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>;<span class="tactic">simpl</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span>;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span>;<span class="id">ex_match2</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span> <span class="kwd">in</span> <span class="id">H</span>;<span class="id">ex_match2</span>. <span class="tactic">subst</span>. <span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">Heqo</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_cs_pop">inv_cs_pop</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H0</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="glob_step_inv_preserve">glob_step_inv_preserve</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">pc</span> <span class="id">l</span> <span class="id">fp</span> <span class="id">pc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#pc">pc</a></span> <span class="id"><a href="TSOSemLemmas.html#l">l</a></span> <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> <span class="id">pc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#inv">inv</a></span> <span class="id"><a href="TSOSemLemmas.html#pc">pc</a></span>.(<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#inv">inv</a></span> <span class="id">pc</span>'.(<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10141')">Proof.</div>
<div class="proofscript" id="proof10141">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_update_preserve">inv_update_preserve</a></span> <span class="kwd">in</span> <span class="id">H_tp_upd</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H_tp_upd</span>;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_push_preserve">inv_push_preserve</a></span> <span class="kwd">in</span> <span class="id">H_tp_push</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_pop_preserve">inv_pop_preserve</a></span> <span class="kwd">in</span> <span class="id">H_tp_pop</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_update_preserve">inv_update_preserve</a></span> <span class="kwd">in</span> <span class="id">H_tp_upd</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H_tp_upd</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="id">solv_thread</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_pop_preserve">inv_pop_preserve</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_update_preserve">inv_update_preserve</a></span> <span class="kwd">in</span> <span class="id">H_tp_upd</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H_tp_upd</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="thdp_valid_tid">thdp_valid_tid</a></span> <span class="id">tp</span> <span class="id">t</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.valid_tid">TSOThrdPool.valid_tid</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#tp">tp</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> /\ ~ <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.halted">TSOThrdPool.halted</a></span> <span class="id"><a href="TSOSemLemmas.html#tp">tp</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="pc_valid_tid">pc_valid_tid</a></span> <span class="id">pc</span> <span class="id">t</span>:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">tp</span>:=<span class="id"><a href="TSOSemLemmas.html#pc">pc</a></span>.(<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#thdp_valid_tid">thdp_valid_tid</a></span> <span class="id"><a href="TSOSemLemmas.html#tp">tp</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">pc</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#pc_valid_tid">pc_valid_tid</a></span> <span class="id"><a href="TSOSemLemmas.html#pc">pc</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> &lt;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#pc">pc</a></span> <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> ({-|<span class="id"><a href="TSOSemLemmas.html#pc">pc</a></span>,<span class="id"><a href="TSOSemLemmas.html#t">t</a></span>}).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10142')">Proof.</div>
<div class="proofscript" id="proof10142">
 <span class="tactic">split</span>;<span class="tactic">inversion</span> 1;<span class="tactic">subst</span>. <span class="tactic">destruct</span> <span class="id">pc</span>;  <span class="id">econstructor</span>;<span class="tactic">auto</span>. <span class="tactic">split</span>;<span class="tactic">auto</span>. Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="thrd_valid_tid_preserve">thrd_valid_tid_preserve</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">pc</span> <span class="id">l</span> <span class="id">fp</span> <span class="id">pc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#pc">pc</a></span> <span class="id"><a href="TSOSemLemmas.html#l">l</a></span> <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> <span class="id">pc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.valid_tid">TSOThrdPool.valid_tid</a></span> (<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id">pc</span>') <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>&lt;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.valid_tid">TSOThrdPool.valid_tid</a></span> (<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id"><a href="TSOSemLemmas.html#pc">pc</a></span>) <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10143')">Proof.</div>
<div class="proofscript" id="proof10143">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">intros</span>;<span class="id">inv</span> <span class="id">H</span>;<span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="halted_preserve">halted_preserve</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">pc</span> <span class="id">l</span> <span class="id">fp</span> <span class="id">pc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#pc">pc</a></span> <span class="id"><a href="TSOSemLemmas.html#l">l</a></span> <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> <span class="id">pc</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.halted">TSOThrdPool.halted</a></span> (<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id"><a href="TSOSemLemmas.html#pc">pc</a></span>) <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.halted">TSOThrdPool.halted</a></span> (<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id">pc</span>') <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10144')">Proof.</div>
<div class="proofscript" id="proof10144">
 <span class="tactic">intros</span>;<span class="id">inv</span> <span class="id">H</span>;<span class="id">solv_thread</span>;<span class="id">econstructor</span>;<span class="tactic">eauto</span>;<span class="id">solv_thread</span>. Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="halted_preserve2">halted_preserve2</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">pc</span> <span class="id">l</span> <span class="id">fp</span> <span class="id">pc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#pc">pc</a></span> <span class="id"><a href="TSOSemLemmas.html#l">l</a></span> <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> <span class="id">pc</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> &lt;&gt; <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#pc">pc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.halted">TSOThrdPool.halted</a></span> (<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id"><a href="TSOSemLemmas.html#pc">pc</a></span>) <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> &lt;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.halted">TSOThrdPool.halted</a></span> (<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id">pc</span>') <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10145')">Proof.</div>
<div class="proofscript" id="proof10145">
 <span class="tactic">split</span>; <span class="tactic">intros</span>;<span class="id">inv</span> <span class="id">H</span>;<span class="id">solv_thread</span>;<span class="id">econstructor</span>;<span class="tactic">eauto</span>;<span class="id">solv_thread</span>. Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="pc_valid_tid_preserve">pc_valid_tid_preserve</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">pc</span> <span class="id">l</span> <span class="id">fp</span> <span class="id">pc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#pc">pc</a></span> <span class="id"><a href="TSOSemLemmas.html#l">l</a></span> <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> <span class="id">pc</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> &lt;&gt; <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#pc">pc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#pc_valid_tid">pc_valid_tid</a></span> <span class="id">pc</span>' <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> &lt;-&gt; <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid">pc_valid_tid</a></span> <span class="id"><a href="TSOSemLemmas.html#pc">pc</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10146')">Proof.</div>
<div class="proofscript" id="proof10146">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid">pc_valid_tid</a></span>,<span class="id"><a href="TSOSemLemmas.html#thdp_valid_tid">thdp_valid_tid</a></span>;<span class="tactic">split</span>;<span class="tactic">intro</span>;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;1,2 :<span class="tactic">split</span>;[<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#thrd_valid_tid_preserve">thrd_valid_tid_preserve</a></span> <span class="kwd">in</span> <span class="id">H</span>;<span class="tactic">eauto</span>;<span class="tactic">apply</span> <span class="id">H</span>;<span class="tactic">auto</span>|<span class="tactic">intro</span>;<span class="id">contradict</span> <span class="id">H2</span>; <span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#halted_preserve2">halted_preserve2</a></span> <span class="kwd">in</span> <span class="id">H</span>;<span class="tactic">eauto</span>;<span class="tactic">apply</span> <span class="id">H</span>;<span class="tactic">auto</span>].<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="pc_valid_tid_backwards_preserve">pc_valid_tid_backwards_preserve</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">pc</span> <span class="id">l</span> <span class="id">fp</span> <span class="id">pc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#pc">pc</a></span> <span class="id"><a href="TSOSemLemmas.html#l">l</a></span> <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> <span class="id">pc</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#pc_valid_tid">pc_valid_tid</a></span> <span class="id">pc</span>' <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> -&gt; <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid">pc_valid_tid</a></span> <span class="id"><a href="TSOSemLemmas.html#pc">pc</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10147')">Proof.</div>
<div class="proofscript" id="proof10147">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid">pc_valid_tid</a></span>;<span class="tactic">intros</span>;<span class="id">Hsimpl</span>;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#thrd_valid_tid_preserve">thrd_valid_tid_preserve</a></span> <span class="kwd">in</span> <span class="id">H</span>;<span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">H</span>;<span class="tactic">auto</span>. <span class="tactic">destruct</span> <span class="id">H0</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>;<span class="id">contradict</span> <span class="id">H1</span>.  <span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#halted_preserve">halted_preserve</a></span> <span class="kwd">in</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="coreupdate_exists">coreupdate_exists</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">cc</span>,<span class="id">exists</span> <span class="id">c</span>', @<span class="id"><a href="TSOGlobSem.html#TSOCore.update">TSOCore.update</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#c">c</a></span> <span class="id"><a href="TSOSemLemmas.html#cc">cc</a></span> <span class="id">c</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10148')">Proof.</div>
<div class="proofscript" id="proof10148">
 <span class="tactic">intros</span>. <span class="id">eexists</span>. <span class="id">econstructor</span>;<span class="tactic">eauto</span>. Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="thrdpool_update_exists">thrdpool_update_exists</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">thdp</span> <span class="id">t</span> <span class="id">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#inv">inv</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#thdp_valid_tid">thdp_valid_tid</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">thdp</span>', @<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.update">TSOThrdPool.update</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#c">c</a></span> <span class="id">thdp</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10149')">Proof.</div>
<div class="proofscript" id="proof10149">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#thdp_valid_tid">thdp_valid_tid</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">x</span> &lt;&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>). <span class="tactic">intro</span>;<span class="id">contradict</span> <span class="id">H1</span>;<span class="id">constructor</span>;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>;<span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>. <span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="thrdpool_get_update_preserve">thrdpool_get_update_preserve</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">thdp</span> <span class="id">t</span> <span class="id">c</span> <span class="id">thdp</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.update">TSOThrdPool.update</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#c">c</a></span> <span class="id">thdp</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> &lt;&gt; <span class="id">t</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>)!! <span class="id">t</span>' = (<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>') !!<span class="id">t</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10150')">Proof.</div>
<div class="proofscript" id="proof10150">
 <span class="tactic">intros</span>. <span class="id">solv_thread</span>. Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="inv_getable_valid">inv_getable_valid</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">thdp</span> <span class="id">t</span> <span class="id">c</span> <span class="id">cs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>)!!<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c">c</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#inv">inv</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#thdp_valid_tid">thdp_valid_tid</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10151')">Proof.</div>
<div class="proofscript" id="proof10151">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.valid_tid">TSOThrdPool.valid_tid</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#plt">plt</a></span> <span class="id">t</span> (<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.next_tid">TSOThrdPool.next_tid</a></span> <span class="id">thdp</span>));<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">tp_finite0</span> <span class="kwd">in</span> <span class="id">n</span>. <span class="tactic">rewrite</span> <span class="id">n</span> <span class="kwd">in</span> <span class="id">H</span>;<span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>. <span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="id">inv</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="tupdate_comm">tupdate_comm</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bfs</span> <span class="id">t</span> <span class="id">bf</span>' <span class="id">t</span>' <span class="id">bf</span>'',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> &lt;&gt; <span class="id">t</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id">bf</span>' (<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id">t</span>' <span class="id">bf</span>'' <span class="id"><a href="TSOSemLemmas.html#bfs">bfs</a></span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id">t</span>' <span class="id">bf</span>'' (<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id">bf</span>' <span class="id"><a href="TSOSemLemmas.html#bfs">bfs</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10152')">Proof.</div>
<div class="proofscript" id="proof10152">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Axioms.html#functional_extensionality">functional_extensionality</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="ptree_set_sym">ptree_set_sym</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span> <span class="id">i</span> <span class="id">j</span> <span class="id">m</span> (<span class="id">v1</span> <span class="id">v2</span>:<span class="id"><a href="TSOSemLemmas.html#A">A</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#i">i</a></span> &lt;&gt; <span class="id"><a href="TSOSemLemmas.html#j">j</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#PTree.set">Maps.PTree.set</a></span> <span class="id"><a href="TSOSemLemmas.html#i">i</a></span> <span class="id"><a href="TSOSemLemmas.html#v1">v1</a></span> (<span class="id"><a href="Maps.html#PTree.set">Maps.PTree.set</a></span> <span class="id"><a href="TSOSemLemmas.html#j">j</a></span> <span class="id"><a href="TSOSemLemmas.html#v2">v2</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#PTree.set">Maps.PTree.set</a></span> <span class="id"><a href="TSOSemLemmas.html#j">j</a></span> <span class="id"><a href="TSOSemLemmas.html#v2">v2</a></span> (<span class="id"><a href="Maps.html#PTree.set">Maps.PTree.set</a></span> <span class="id"><a href="TSOSemLemmas.html#i">i</a></span> <span class="id"><a href="TSOSemLemmas.html#v1">v1</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10153')">Proof.</div>
<div class="proofscript" id="proof10153">
 <span class="tactic">induction</span> <span class="id">i</span>;<span class="tactic">intros</span>;<span class="tactic">destruct</span> <span class="id">m</span>,<span class="id">j</span>;<span class="tactic">simpl</span>;<span class="tactic">auto</span>;<span class="tactic">try</span> (<span class="tactic">rewrite</span> <span class="id">IHi</span>;<span class="tactic">auto</span>;<span class="tactic">intro</span>;<span class="tactic">subst</span>);<span class="id">contradiction</span>. Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="pmap_set_sym">pmap_set_sym</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">A</span> : <span class="kwd">Type</span>) (<span class="id">i</span> <span class="id">j</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>) (<span class="id">m</span> : <span class="id"><a href="Maps.html#PMap.t">PMap.t</a></span> <span class="id"><a href="TSOSemLemmas.html#A">A</a></span>) (<span class="id">v1</span> <span class="id">v2</span> : <span class="id"><a href="TSOSemLemmas.html#A">A</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#i">i</a></span> &lt;&gt; <span class="id"><a href="TSOSemLemmas.html#j">j</a></span> -&gt; <span class="id"><a href="Maps.html#PMap.set">PMap.set</a></span> <span class="id"><a href="TSOSemLemmas.html#i">i</a></span> <span class="id"><a href="TSOSemLemmas.html#v1">v1</a></span> (<span class="id"><a href="Maps.html#PMap.set">PMap.set</a></span> <span class="id"><a href="TSOSemLemmas.html#j">j</a></span> <span class="id"><a href="TSOSemLemmas.html#v2">v2</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span>) = <span class="id"><a href="Maps.html#PMap.set">PMap.set</a></span> <span class="id"><a href="TSOSemLemmas.html#j">j</a></span> <span class="id"><a href="TSOSemLemmas.html#v2">v2</a></span> (<span class="id"><a href="Maps.html#PMap.set">PMap.set</a></span> <span class="id"><a href="TSOSemLemmas.html#i">i</a></span> <span class="id"><a href="TSOSemLemmas.html#v1">v1</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10154')">Proof.</div>
<div class="proofscript" id="proof10154">
 <span class="tactic">unfold</span> <span class="id"><a href="Maps.html#PMap.set">Maps.PMap.set</a></span>;<span class="tactic">simpl</span>;<span class="tactic">intros</span>;<span class="tactic">f_equal</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#ptree_set_sym">ptree_set_sym</a></span>;<span class="tactic">eauto</span>. Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="update_update_sym">update_update_sym</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">thdp</span> <span class="id">t</span> <span class="id">c</span> <span class="id">cs</span> <span class="id">cc</span> <span class="id">c</span>' <span class="id">thdp</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>)!!<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c">c</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span>)-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOCore.update">TSOCore.update</a></span> <span class="id"><a href="TSOSemLemmas.html#c">c</a></span> <span class="id"><a href="TSOSemLemmas.html#cc">cc</a></span> <span class="id">c</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.update">TSOThrdPool.update</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id">c</span>' <span class="id">thdp</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t0</span> <span class="id">c0</span> <span class="id">cs0</span> <span class="id">cc0</span> <span class="id">c0</span>' <span class="id">thdp</span>'',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> &lt;&gt; <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>')!!<span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c0">c0</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs0">cs0</a></span>)-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOCore.update">TSOCore.update</a></span> <span class="id"><a href="TSOSemLemmas.html#c0">c0</a></span> <span class="id"><a href="TSOSemLemmas.html#cc0">cc0</a></span> <span class="id">c0</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.update">TSOThrdPool.update</a></span> <span class="id">thdp</span>' <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> <span class="id">c0</span>' <span class="id">thdp</span>'' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>)!!<span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c0">c0</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs0">cs0</a></span>)/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">thdp1</span>, <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.update">TSOThrdPool.update</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span> <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> <span class="id">c0</span>' <span class="id">thdp1</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp1</span>)!!<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c">c</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.update">TSOThrdPool.update</a></span> <span class="id">thdp1</span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id">c</span>' <span class="id">thdp</span>''.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10155')">Proof.</div>
<div class="proofscript" id="proof10155">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<span class="id">Esimpl</span>;[|<span class="id">econstructor</span>;<span class="tactic">eauto</span>| |];<span class="id">solv_thread</span>;<span class="id">solv_thread</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">simpl</span>;<span class="tactic">eauto</span>. <span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOSemLemmas.html#pmap_set_sym">pmap_set_sym</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="update_push_sym">update_push_sym</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">thdp</span> <span class="id">t</span> <span class="id">c</span> <span class="id">cs</span> <span class="id">cc</span> <span class="id">c</span>' <span class="id">thdp</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>)!!<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c">c</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span>)-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOCore.update">TSOCore.update</a></span> <span class="id"><a href="TSOSemLemmas.html#c">c</a></span> <span class="id"><a href="TSOSemLemmas.html#cc">cc</a></span> <span class="id">c</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.update">TSOThrdPool.update</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id">c</span>' <span class="id">thdp</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t0</span> <span class="id">c0</span> <span class="id">cs0</span> <span class="id">new_ix</span> <span class="id">cc</span> <span class="id">sg</span> <span class="id">thdp</span>'',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> &lt;&gt; <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>')!!<span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c0">c0</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs0">cs0</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.push">TSOThrdPool.push</a></span> <span class="id">thdp</span>' <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> <span class="id"><a href="TSOSemLemmas.html#new_ix">new_ix</a></span> <span class="id"><a href="TSOSemLemmas.html#cc">cc</a></span> <span class="id"><a href="TSOSemLemmas.html#sg">sg</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp</span>''-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>)!!<span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c0">c0</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs0">cs0</a></span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">thdp1</span>, <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.push">TSOThrdPool.push</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span> <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> <span class="id"><a href="TSOSemLemmas.html#new_ix">new_ix</a></span> <span class="id"><a href="TSOSemLemmas.html#cc">cc</a></span> <span class="id"><a href="TSOSemLemmas.html#sg">sg</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp1</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp1</span>)!!<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c">c</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span>) /\ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.update">TSOThrdPool.update</a></span> <span class="id">thdp1</span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id">c</span>' <span class="id">thdp</span>''.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10156')">Proof.</div>
<div class="proofscript" id="proof10156">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>;<span class="id">solv_thread</span>;<span class="id">solv_thread</span>;<span class="tactic">eauto</span>. <span class="id">econstructor</span>;<span class="id">solv_thread</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOSemLemmas.html#pmap_set_sym">pmap_set_sym</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="update_pop_sym">update_pop_sym</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">thdp</span> <span class="id">t</span> <span class="id">c</span> <span class="id">cs</span> <span class="id">cc</span> <span class="id">c</span>' <span class="id">thdp</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>)!!<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c">c</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span>)-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOCore.update">TSOCore.update</a></span> <span class="id"><a href="TSOSemLemmas.html#c">c</a></span> <span class="id"><a href="TSOSemLemmas.html#cc">cc</a></span> <span class="id">c</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.update">TSOThrdPool.update</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id">c</span>' <span class="id">thdp</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t0</span> <span class="id">c0</span> <span class="id">cs0</span> <span class="id">thdp</span>'',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> &lt;&gt; <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>')!!<span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c0">c0</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs0">cs0</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="id">thdp</span>' <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp</span>''-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>)!!<span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c0">c0</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs0">cs0</a></span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">thdp1</span>, <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span> <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp1</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp1</span>)!!<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c">c</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span>) /\ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.update">TSOThrdPool.update</a></span> <span class="id">thdp1</span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id">c</span>' <span class="id">thdp</span>''.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10157')">Proof.</div>
<div class="proofscript" id="proof10157">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>;<span class="id">solv_thread</span>;<span class="id">solv_thread</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>;<span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOSemLemmas.html#pmap_set_sym">pmap_set_sym</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="update__pop_update_sym">update__pop_update_sym</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">thdp</span> <span class="id">t</span> <span class="id">c</span> <span class="id">cs</span> <span class="id">cc</span> <span class="id">c</span>' <span class="id">thdp</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>)!!<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c">c</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span>)-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOCore.update">TSOCore.update</a></span> <span class="id"><a href="TSOSemLemmas.html#c">c</a></span> <span class="id"><a href="TSOSemLemmas.html#cc">cc</a></span> <span class="id">c</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.update">TSOThrdPool.update</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id">c</span>' <span class="id">thdp</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t0</span> <span class="id">c0</span> <span class="id">c1</span> <span class="id">cs0</span> <span class="id">thdp</span>'',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> &lt;&gt; <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>')!!<span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c0">c0</a></span>::<span class="id"><a href="TSOSemLemmas.html#c1">c1</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs0">cs0</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="id">thdp</span>' <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp</span>''-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">cc1</span> <span class="id">c1</span>' <span class="id">thdp</span>''',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOCore.update">TSOCore.update</a></span> <span class="id"><a href="TSOSemLemmas.html#c1">c1</a></span> <span class="id"><a href="TSOSemLemmas.html#cc1">cc1</a></span> <span class="id">c1</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.update">TSOThrdPool.update</a></span> <span class="id">thdp</span>'' <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> <span class="id">c1</span>' <span class="id">thdp</span>'''-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>)!!<span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c0">c0</a></span>::<span class="id"><a href="TSOSemLemmas.html#c1">c1</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs0">cs0</a></span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">thdp1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span> <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp1</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">thdp2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.update">TSOThrdPool.update</a></span> <span class="id">thdp1</span> <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> <span class="id">c1</span>' <span class="id">thdp2</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp2</span>)!!<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c">c</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.update">TSOThrdPool.update</a></span> <span class="id">thdp2</span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id">c</span>' <span class="id">thdp</span>'''.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10158')">Proof.</div>
<div class="proofscript" id="proof10158">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#update_pop_sym">update_pop_sym</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> ?;<span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H4</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>((<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>'')!!<span class="id">t0</span>=<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">c1</span>::<span class="id">cs0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H3</span> <span class="id">H4</span>. <span class="tactic">clear</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solv_thread</span>. <span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#update_update_sym">update_update_sym</a></span> <span class="kwd">in</span> <span class="id">H6</span> <span class="kwd">as</span> ?;<span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H10</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="push_update_sym">push_update_sym</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">thdp</span> <span class="id">t</span> <span class="id">c</span> <span class="id">cs</span> <span class="id">new_ix</span> <span class="id">cc</span> <span class="id">sg</span> <span class="id">thdp</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>)!!<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c">c</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span>)-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.push">TSOThrdPool.push</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#new_ix">new_ix</a></span> <span class="id"><a href="TSOSemLemmas.html#cc">cc</a></span> <span class="id"><a href="TSOSemLemmas.html#sg">sg</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t0</span> <span class="id">c0</span> <span class="id">cs0</span> <span class="id">cc0</span> <span class="id">c0</span>' <span class="id">thdp</span>'',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> &lt;&gt; <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>')!!<span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c0">c0</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs0">cs0</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOCore.update">TSOCore.update</a></span> <span class="id"><a href="TSOSemLemmas.html#c0">c0</a></span> <span class="id"><a href="TSOSemLemmas.html#cc0">cc0</a></span> <span class="id">c0</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.update">TSOThrdPool.update</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> <span class="id">thdp</span>' <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> <span class="id">c0</span>' <span class="id">thdp</span>'' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>)!!<span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c0">c0</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs0">cs0</a></span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">thdp1</span>, <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.update">TSOThrdPool.update</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span> <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> <span class="id">c0</span>' <span class="id">thdp1</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp1</span>)!!<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c">c</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span>) /\ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.push">TSOThrdPool.push</a></span> <span class="id">thdp1</span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#new_ix">new_ix</a></span> <span class="id"><a href="TSOSemLemmas.html#cc">cc</a></span> <span class="id"><a href="TSOSemLemmas.html#sg">sg</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp</span>''.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10159')">Proof.</div>
<div class="proofscript" id="proof10159">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>;[|<span class="id">econstructor</span>;<span class="tactic">eauto</span>| |]; <span class="id">solv_thread</span>;<span class="tactic">eauto</span>; <span class="id">solv_thread</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOSemLemmas.html#pmap_set_sym">pmap_set_sym</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="push_push_sym">push_push_sym</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">thdp</span> <span class="id">t</span> <span class="id">c</span> <span class="id">cs</span> <span class="id">new_ix</span> <span class="id">cc</span> <span class="id">sg</span> <span class="id">thdp</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>)!!<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c">c</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span>)-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.push">TSOThrdPool.push</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#new_ix">new_ix</a></span> <span class="id"><a href="TSOSemLemmas.html#cc">cc</a></span> <span class="id"><a href="TSOSemLemmas.html#sg">sg</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t0</span> <span class="id">c0</span> <span class="id">cs0</span> <span class="id">new_ix0</span> <span class="id">cc0</span> <span class="id">sg0</span> <span class="id">thdp</span>'',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> &lt;&gt; <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>')!!<span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c0">c0</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs0">cs0</a></span>)-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.push">TSOThrdPool.push</a></span> <span class="id">thdp</span>' <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> <span class="id"><a href="TSOSemLemmas.html#new_ix0">new_ix0</a></span> <span class="id"><a href="TSOSemLemmas.html#cc0">cc0</a></span> <span class="id"><a href="TSOSemLemmas.html#sg0">sg0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp</span>''-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>)!!<span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c0">c0</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs0">cs0</a></span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">thdp1</span>, <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.push">TSOThrdPool.push</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span> <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> <span class="id"><a href="TSOSemLemmas.html#new_ix0">new_ix0</a></span> <span class="id"><a href="TSOSemLemmas.html#cc0">cc0</a></span> <span class="id"><a href="TSOSemLemmas.html#sg0">sg0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp1</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp1</span>)!!<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c">c</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span>)/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.push">TSOThrdPool.push</a></span> <span class="id">thdp1</span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#new_ix">new_ix</a></span> <span class="id"><a href="TSOSemLemmas.html#cc">cc</a></span> <span class="id"><a href="TSOSemLemmas.html#sg">sg</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp</span>''.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10160')">Proof.</div>
<div class="proofscript" id="proof10160">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="id">solv_thread</span>. <span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>. <span class="tactic">split</span>. <span class="id">solv_thread</span>;<span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">simpl</span>; <span class="id">solv_thread</span>. <span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="tactic">f_equal</span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>;<span class="tactic">try</span> <span class="id">contradiction</span>. <span class="tactic">rewrite</span> <span class="id"><a href="TSOSemLemmas.html#pmap_set_sym">pmap_set_sym</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Axioms.html#functional_extensionality">functional_extensionality</a></span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>. <span class="tactic">subst</span>. <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="push_pop_sym">push_pop_sym</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">thdp</span> <span class="id">t</span> <span class="id">c</span> <span class="id">cs</span> <span class="id">new_ix</span> <span class="id">cc</span> <span class="id">sg</span> <span class="id">thdp</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>)!!<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c">c</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span>)-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.push">TSOThrdPool.push</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#new_ix">new_ix</a></span> <span class="id"><a href="TSOSemLemmas.html#cc">cc</a></span> <span class="id"><a href="TSOSemLemmas.html#sg">sg</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t0</span> <span class="id">c0</span> <span class="id">cs0</span> <span class="id">thdp</span>'',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> &lt;&gt; <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>')!!<span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c0">c0</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs0">cs0</a></span>)-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="id">thdp</span>' <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp</span>''-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>)!!<span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span>=<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c0">c0</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs0">cs0</a></span>)/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">thdp1</span>, <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span> <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp1</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp1</span>)!!<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c">c</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.push">TSOThrdPool.push</a></span> <span class="id">thdp1</span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#new_ix">new_ix</a></span> <span class="id"><a href="TSOSemLemmas.html#cc">cc</a></span> <span class="id"><a href="TSOSemLemmas.html#sg">sg</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp</span>''.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10161')">Proof.</div>
<div class="proofscript" id="proof10161">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">do</span> 2 <span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>. <span class="tactic">do</span> 2 <span class="id">solv_thread</span>. <span class="tactic">simpl</span>. <span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOSemLemmas.html#pmap_set_sym">pmap_set_sym</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="pop_update_sym">pop_update_sym</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">thdp</span> <span class="id">t</span> <span class="id">c</span> <span class="id">cs</span> <span class="id">thdp</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>)!!<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c">c</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span>)-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t0</span> <span class="id">c0</span> <span class="id">cs0</span> <span class="id">cc0</span> <span class="id">c0</span>' <span class="id">thdp</span>'',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> &lt;&gt; <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>')!!<span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c0">c0</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs0">cs0</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOCore.update">TSOCore.update</a></span> <span class="id"><a href="TSOSemLemmas.html#c0">c0</a></span> <span class="id"><a href="TSOSemLemmas.html#cc0">cc0</a></span> <span class="id">c0</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.update">TSOThrdPool.update</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> <span class="id">thdp</span>' <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> <span class="id">c0</span>' <span class="id">thdp</span>'' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>)!!<span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c0">c0</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs0">cs0</a></span>)/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">thdp1</span>, <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.update">TSOThrdPool.update</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span> <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> <span class="id">c0</span>' <span class="id">thdp1</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp1</span>)!!<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c">c</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span>) /\ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="id">thdp1</span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp</span>''.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10162')">Proof.</div>
<div class="proofscript" id="proof10162">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>;[|<span class="id">econstructor</span>;<span class="tactic">eauto</span>| |];<span class="tactic">do</span> 2 <span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOSemLemmas.html#pmap_set_sym">pmap_set_sym</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="pop_push_sym">pop_push_sym</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">thdp</span> <span class="id">t</span> <span class="id">c</span> <span class="id">cs</span> <span class="id">thdp</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>)!!<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c">c</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span>)-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t0</span> <span class="id">c0</span> <span class="id">cs0</span> <span class="id">new_ix0</span> <span class="id">cc0</span> <span class="id">sg0</span> <span class="id">thdp</span>'',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> &lt;&gt; <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>')!!<span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c0">c0</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs0">cs0</a></span>)-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.push">TSOThrdPool.push</a></span> <span class="id">thdp</span>' <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> <span class="id"><a href="TSOSemLemmas.html#new_ix0">new_ix0</a></span> <span class="id"><a href="TSOSemLemmas.html#cc0">cc0</a></span> <span class="id"><a href="TSOSemLemmas.html#sg0">sg0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp</span>''-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>)!!<span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c0">c0</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs0">cs0</a></span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">thdp1</span>, <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.push">TSOThrdPool.push</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span> <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> <span class="id"><a href="TSOSemLemmas.html#new_ix0">new_ix0</a></span> <span class="id"><a href="TSOSemLemmas.html#cc0">cc0</a></span> <span class="id"><a href="TSOSemLemmas.html#sg0">sg0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp1</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp1</span>)!!<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c">c</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span>)/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="id">thdp1</span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp</span>''.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10163')">Proof.</div>
<div class="proofscript" id="proof10163">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>. <span class="tactic">do</span> 2 <span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="id">solv_thread</span>. <span class="tactic">simpl</span>. <span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solv_thread</span>. <span class="tactic">rewrite</span> <span class="id"><a href="TSOSemLemmas.html#pmap_set_sym">pmap_set_sym</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="pop_pop_sym">pop_pop_sym</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">thdp</span> <span class="id">t</span> <span class="id">c</span> <span class="id">cs</span> <span class="id">thdp</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>)!!<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c">c</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span>)-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t0</span> <span class="id">c0</span> <span class="id">cs0</span> <span class="id">thdp</span>'',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> &lt;&gt; <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>')!!<span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c0">c0</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs0">cs0</a></span>)-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="id">thdp</span>' <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp</span>''-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>)!!<span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span>=<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c0">c0</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs0">cs0</a></span>)/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">thdp1</span>, <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span> <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp1</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp1</span>)!!<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c">c</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="id">thdp1</span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp</span>''.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10164')">Proof.</div>
<div class="proofscript" id="proof10164">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>. <span class="tactic">do</span> 2 <span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="id">solv_thread</span>. <span class="tactic">simpl</span>. <span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solv_thread</span>. <span class="tactic">rewrite</span> <span class="id"><a href="TSOSemLemmas.html#pmap_set_sym">pmap_set_sym</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="push__pop_update_sym">push__pop_update_sym</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">thdp</span> <span class="id">t</span> <span class="id">c</span> <span class="id">cs</span> <span class="id">new_ix</span> <span class="id">cc</span> <span class="id">sg</span> <span class="id">thdp</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>)!!<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c">c</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span>)-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.push">TSOThrdPool.push</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#new_ix">new_ix</a></span> <span class="id"><a href="TSOSemLemmas.html#cc">cc</a></span> <span class="id"><a href="TSOSemLemmas.html#sg">sg</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t0</span> <span class="id">c0</span> <span class="id">c1</span> <span class="id">cs0</span> <span class="id">thdp</span>'',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> &lt;&gt; <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>')!!<span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c0">c0</a></span>::<span class="id"><a href="TSOSemLemmas.html#c1">c1</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs0">cs0</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="id">thdp</span>' <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp</span>''-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">cc1</span> <span class="id">c1</span>' <span class="id">thdp</span>''',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOCore.update">TSOCore.update</a></span> <span class="id"><a href="TSOSemLemmas.html#c1">c1</a></span> <span class="id"><a href="TSOSemLemmas.html#cc1">cc1</a></span> <span class="id">c1</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.update">TSOThrdPool.update</a></span> <span class="id">thdp</span>'' <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> <span class="id">c1</span>' <span class="id">thdp</span>'''-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>)!!<span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c0">c0</a></span>::<span class="id"><a href="TSOSemLemmas.html#c1">c1</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs0">cs0</a></span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">thdp1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span> <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp1</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">thdp2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.update">TSOThrdPool.update</a></span> <span class="id">thdp1</span> <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> <span class="id">c1</span>' <span class="id">thdp2</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp2</span>)!!<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c">c</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.push">TSOThrdPool.push</a></span> <span class="id">thdp2</span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#new_ix">new_ix</a></span> <span class="id"><a href="TSOSemLemmas.html#cc">cc</a></span> <span class="id"><a href="TSOSemLemmas.html#sg">sg</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp</span>'''.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10165')">Proof.</div>
<div class="proofscript" id="proof10165">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#push_pop_sym">push_pop_sym</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>( (<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>'') !! <span class="id">t0</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">c1</span> ::<span class="id">cs0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H2</span> <span class="id">H3</span>;<span class="tactic">clear</span>;<span class="tactic">intros</span>;<span class="tactic">do</span> 2 <span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#push_update_sym">push_update_sym</a></span> <span class="kwd">in</span> <span class="id">H9</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="pop__pop_update_sym">pop__pop_update_sym</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">thdp</span> <span class="id">t</span> <span class="id">c</span> <span class="id">cs</span> <span class="id">thdp</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>)!!<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c">c</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span>)-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t0</span> <span class="id">c0</span> <span class="id">c1</span> <span class="id">cs0</span> <span class="id">thdp</span>'',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> &lt;&gt; <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>')!!<span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c0">c0</a></span>::<span class="id"><a href="TSOSemLemmas.html#c1">c1</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs0">cs0</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="id">thdp</span>' <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp</span>''-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">cc1</span> <span class="id">c1</span>' <span class="id">thdp</span>''',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOCore.update">TSOCore.update</a></span> <span class="id"><a href="TSOSemLemmas.html#c1">c1</a></span> <span class="id"><a href="TSOSemLemmas.html#cc1">cc1</a></span> <span class="id">c1</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.update">TSOThrdPool.update</a></span> <span class="id">thdp</span>'' <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> <span class="id">c1</span>' <span class="id">thdp</span>'''-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>)!!<span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c0">c0</a></span>::<span class="id"><a href="TSOSemLemmas.html#c1">c1</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs0">cs0</a></span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">thdp1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span> <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp1</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">thdp2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.update">TSOThrdPool.update</a></span> <span class="id">thdp1</span> <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> <span class="id">c1</span>' <span class="id">thdp2</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp2</span>)!!<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c">c</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="id">thdp2</span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp</span>'''.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10166')">Proof.</div>
<div class="proofscript" id="proof10166">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#pop_pop_sym">pop_pop_sym</a></span> <span class="kwd">in</span> <span class="id">H3</span> <span class="kwd">as</span> ?;<span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>( (<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>'') !! <span class="id">t0</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">c1</span> ::<span class="id">cs0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H2</span> <span class="id">H3</span>;<span class="tactic">clear</span>;<span class="tactic">intros</span>;<span class="tactic">do</span> 2 <span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#pop_update_sym">pop_update_sym</a></span> <span class="kwd">in</span> <span class="id">H9</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="pop_update__update_sym">pop_update__update_sym</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">thdp</span> <span class="id">t</span> <span class="id">c0</span> <span class="id">c1</span> <span class="id">cs0</span> <span class="id">thdp</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>)!!<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c0">c0</a></span>::<span class="id"><a href="TSOSemLemmas.html#c1">c1</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs0">cs0</a></span>)-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">cc</span> <span class="id">c1</span>' <span class="id">thdp</span>'',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOCore.update">TSOCore.update</a></span> <span class="id"><a href="TSOSemLemmas.html#c1">c1</a></span> <span class="id"><a href="TSOSemLemmas.html#cc">cc</a></span> <span class="id">c1</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.update">TSOThrdPool.update</a></span> <span class="id">thdp</span>' <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id">c1</span>' <span class="id">thdp</span>''-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t0</span> <span class="id">cc0</span> <span class="id">c</span> <span class="id">cs</span> <span class="id">c</span>' <span class="id">thdp</span>''',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> &lt;&gt; <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>'')!!<span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c">c</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span>)-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOCore.update">TSOCore.update</a></span> <span class="id"><a href="TSOSemLemmas.html#c">c</a></span> <span class="id"><a href="TSOSemLemmas.html#cc0">cc0</a></span> <span class="id">c</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.update">TSOThrdPool.update</a></span> <span class="id">thdp</span>'' <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> <span class="id">c</span>' <span class="id">thdp</span>'''-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>)!!<span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c">c</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">thdp1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.update">TSOThrdPool.update</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span> <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> <span class="id">c</span>' <span class="id">thdp1</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp1</span>)!!<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span>(<span class="id"><a href="TSOSemLemmas.html#c0">c0</a></span>::<span class="id"><a href="TSOSemLemmas.html#c1">c1</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs0">cs0</a></span>)/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">thdp2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="id">thdp1</span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp2</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.update">TSOThrdPool.update</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> <span class="id">thdp2</span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id">c1</span>' <span class="id">thdp</span>'''.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10167')">Proof.</div>
<div class="proofscript" id="proof10167">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>((<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>')!!<span class="id">t</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">c1</span>::<span class="id">cs0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H</span> <span class="id">H0</span>;<span class="tactic">clear</span>;<span class="tactic">intros</span>;<span class="tactic">do</span> 2 <span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#update_update_sym">update_update_sym</a></span> <span class="kwd">in</span> <span class="id">H6</span> <span class="kwd">as</span> ?;<span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H2</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#pop_update_sym">pop_update_sym</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> ?;<span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H9</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="pop_update__push_sym">pop_update__push_sym</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">thdp</span> <span class="id">t</span> <span class="id">c0</span> <span class="id">c1</span> <span class="id">cs0</span> <span class="id">thdp</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>)!!<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c0">c0</a></span>::<span class="id"><a href="TSOSemLemmas.html#c1">c1</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs0">cs0</a></span>)-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">cc</span> <span class="id">c1</span>' <span class="id">thdp</span>'',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOCore.update">TSOCore.update</a></span> <span class="id"><a href="TSOSemLemmas.html#c1">c1</a></span> <span class="id"><a href="TSOSemLemmas.html#cc">cc</a></span> <span class="id">c1</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.update">TSOThrdPool.update</a></span> <span class="id">thdp</span>' <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id">c1</span>' <span class="id">thdp</span>''-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t0</span> <span class="id">cc0</span> <span class="id">c</span> <span class="id">cs</span> <span class="id">new_ix</span> <span class="id">sg</span> <span class="id">thdp</span>''',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> &lt;&gt; <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>'')!!<span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c">c</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span>)-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.push">TSOThrdPool.push</a></span> <span class="id">thdp</span>'' <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> <span class="id"><a href="TSOSemLemmas.html#new_ix">new_ix</a></span> <span class="id"><a href="TSOSemLemmas.html#cc0">cc0</a></span> <span class="id"><a href="TSOSemLemmas.html#sg">sg</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp</span>'''-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>)!!<span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c">c</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">thdp1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.push">TSOThrdPool.push</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span> <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> <span class="id"><a href="TSOSemLemmas.html#new_ix">new_ix</a></span> <span class="id"><a href="TSOSemLemmas.html#cc0">cc0</a></span> <span class="id"><a href="TSOSemLemmas.html#sg">sg</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp1</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp1</span>)!!<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span>(<span class="id"><a href="TSOSemLemmas.html#c0">c0</a></span>::<span class="id"><a href="TSOSemLemmas.html#c1">c1</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs0">cs0</a></span>)/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">thdp2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="id">thdp1</span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp2</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.update">TSOThrdPool.update</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> <span class="id">thdp2</span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id">c1</span>' <span class="id">thdp</span>'''.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10168')">Proof.</div>
<div class="proofscript" id="proof10168">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>((<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>')!!<span class="id">t</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">c1</span>::<span class="id">cs0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H</span> <span class="id">H0</span>;<span class="tactic">clear</span>;<span class="tactic">intros</span>;<span class="tactic">do</span> 2 <span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#update_push_sym">update_push_sym</a></span> <span class="kwd">in</span> <span class="id">H5</span> <span class="kwd">as</span> ?;<span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H2</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#pop_push_sym">pop_push_sym</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> ?;<span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H9</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="pop_update__pop_sym">pop_update__pop_sym</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">thdp</span> <span class="id">t</span> <span class="id">c0</span> <span class="id">c1</span> <span class="id">cs0</span> <span class="id">thdp</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>)!!<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c0">c0</a></span>::<span class="id"><a href="TSOSemLemmas.html#c1">c1</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs0">cs0</a></span>)-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">cc</span> <span class="id">c1</span>' <span class="id">thdp</span>'',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOCore.update">TSOCore.update</a></span> <span class="id"><a href="TSOSemLemmas.html#c1">c1</a></span> <span class="id"><a href="TSOSemLemmas.html#cc">cc</a></span> <span class="id">c1</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.update">TSOThrdPool.update</a></span> <span class="id">thdp</span>' <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id">c1</span>' <span class="id">thdp</span>''-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t0</span> <span class="id">c</span> <span class="id">cs</span> <span class="id">thdp</span>''',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> &lt;&gt; <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>'')!!<span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c">c</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span>)-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="id">thdp</span>'' <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp</span>'''-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>)!!<span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c">c</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">thdp1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span> <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp1</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp1</span>)!!<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span>(<span class="id"><a href="TSOSemLemmas.html#c0">c0</a></span>::<span class="id"><a href="TSOSemLemmas.html#c1">c1</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs0">cs0</a></span>)/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">thdp2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="id">thdp1</span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp2</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.update">TSOThrdPool.update</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> <span class="id">thdp2</span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id">c1</span>' <span class="id">thdp</span>'''.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10169')">Proof.</div>
<div class="proofscript" id="proof10169">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>((<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>')!!<span class="id">t</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">c1</span>::<span class="id">cs0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H</span> <span class="id">H0</span>;<span class="tactic">clear</span>;<span class="tactic">intros</span>;<span class="tactic">do</span> 2 <span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#update_pop_sym">update_pop_sym</a></span> <span class="kwd">in</span> <span class="id">H5</span> <span class="kwd">as</span> ?;<span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H2</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#pop_pop_sym">pop_pop_sym</a></span> <span class="kwd">in</span> <span class="id">H8</span> <span class="kwd">as</span> ?;<span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="pop_update__pop_update_sym">pop_update__pop_update_sym</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">thdp</span> <span class="id">t</span> <span class="id">c0</span> <span class="id">c1</span> <span class="id">cs0</span> <span class="id">thdp</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>)!!<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c0">c0</a></span>::<span class="id"><a href="TSOSemLemmas.html#c1">c1</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs0">cs0</a></span>)-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">cc</span> <span class="id">c1</span>' <span class="id">thdp</span>'',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOCore.update">TSOCore.update</a></span> <span class="id"><a href="TSOSemLemmas.html#c1">c1</a></span> <span class="id"><a href="TSOSemLemmas.html#cc">cc</a></span> <span class="id">c1</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.update">TSOThrdPool.update</a></span> <span class="id">thdp</span>' <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id">c1</span>' <span class="id">thdp</span>''-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t0</span> <span class="id">c2</span> <span class="id">c3</span> <span class="id">cs</span> <span class="id">thdp</span>''',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> &lt;&gt; <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>'')!!<span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c2">c2</a></span>::<span class="id"><a href="TSOSemLemmas.html#c3">c3</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span>)-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="id">thdp</span>'' <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp</span>'''-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">cc0</span> <span class="id">c3</span>' <span class="id">thdp</span>'''',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOCore.update">TSOCore.update</a></span> <span class="id"><a href="TSOSemLemmas.html#c3">c3</a></span> <span class="id"><a href="TSOSemLemmas.html#cc0">cc0</a></span> <span class="id">c3</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.update">TSOThrdPool.update</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> <span class="id">thdp</span>''' <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> <span class="id">c3</span>' <span class="id">thdp</span>''''-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>)!!<span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOSemLemmas.html#c2">c2</a></span>::<span class="id"><a href="TSOSemLemmas.html#c3">c3</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs">cs</a></span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">thdp1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span> <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp1</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">thdp2</span>, <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.update">TSOThrdPool.update</a></span> <span class="id">thdp1</span> <span class="id"><a href="TSOSemLemmas.html#t0">t0</a></span> <span class="id">c3</span>' <span class="id">thdp2</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp2</span>)!!<span class="id"><a href="TSOSemLemmas.html#t">t</a></span>=<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span>(<span class="id"><a href="TSOSemLemmas.html#c0">c0</a></span>::<span class="id"><a href="TSOSemLemmas.html#c1">c1</a></span>::<span class="id"><a href="TSOSemLemmas.html#cs0">cs0</a></span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">thdp3</span>,<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="id">thdp2</span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp3</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.update">TSOThrdPool.update</a></span> <span class="id">thdp3</span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id">c1</span>' <span class="id">thdp</span>''''.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10170')">Proof.</div>
<div class="proofscript" id="proof10170">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>((<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>')!!<span class="id">t</span>= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">c1</span>::<span class="id">cs0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H</span> <span class="id">H0</span>;<span class="tactic">clear</span>;<span class="tactic">intros</span>;<span class="tactic">do</span> 2 <span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>((<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>''')!!<span class="id">t0</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span>(<span class="id">c3</span>::<span class="id">cs</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H4</span> <span class="id">H5</span>;<span class="tactic">clear</span>;<span class="tactic">intros</span>;<span class="tactic">do</span> 2 <span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#update_pop_sym">update_pop_sym</a></span> <span class="kwd">in</span> <span class="id">H2</span> <span class="kwd">as</span> ?;<span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H5</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#update_update_sym">update_update_sym</a></span> <span class="kwd">in</span> <span class="id">H7</span> <span class="kwd">as</span> ?;<span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H12</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#pop_pop_sym">pop_pop_sym</a></span> <span class="kwd">in</span> <span class="id">H11</span> <span class="kwd">as</span> ?;<span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#pop_update_sym">pop_update_sym</a></span> <span class="kwd">in</span> <span class="id">H21</span> <span class="kwd">as</span> ?;<span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H15</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="eq_config_but_cid_idchange">eq_config_but_cid_idchange</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">pc</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid">eq_config_but_cid</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#pc">pc</a></span> ({-|<span class="id"><a href="TSOSemLemmas.html#pc">pc</a></span>,<span class="id"><a href="TSOSemLemmas.html#t">t</a></span>}).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10171')">Proof.</div>
<div class="proofscript" id="proof10171">
 <span class="id">constructor</span>;<span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="GMemory.html#GMem.eq_refl">GMem.eq_refl</a></span>. Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">diff_thrd_normal_step_reorder</span>':<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">tpc1</span> <span class="id">tpc1</span>' <span class="id">tpc2</span> <span class="id">tpc2</span>': @<span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span>) <span class="id">l1</span> <span class="id">fp1</span> <span class="id">l2</span> <span class="id">fp2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INVTHDP1</span>: <span class="id"><a href="TSOSemLemmas.html#inv">inv</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span>.(<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#normal_tsoglabel">normal_tsoglabel</a></span> <span class="id"><a href="TSOSemLemmas.html#l1">l1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> <span class="id"><a href="TSOSemLemmas.html#l1">l1</a></span> <span class="id"><a href="TSOSemLemmas.html#fp1">fp1</a></span> <span class="id">tpc1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc1</span>' &lt;&gt; <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id">tpc1</span>' <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#normal_tsoglabel">normal_tsoglabel</a></span> <span class="id"><a href="TSOSemLemmas.html#l2">l2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span> <span class="id"><a href="TSOSemLemmas.html#l2">l2</a></span> <span class="id"><a href="TSOSemLemmas.html#fp2">fp2</a></span> <span class="id">tpc2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Footprint.html#FP.smile">FP.smile</a></span> <span class="id"><a href="TSOSemLemmas.html#fp1">fp1</a></span> <span class="id"><a href="TSOSemLemmas.html#fp2">fp2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">_tpc2</span> <span class="id">_tpc2</span>' <span class="id">_tpc1</span> <span class="id">_tpc1</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">_tpc2</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">_tpc2</span> = <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id">_tpc2</span> <span class="id"><a href="TSOSemLemmas.html#l2">l2</a></span> <span class="id"><a href="TSOSemLemmas.html#fp2">fp2</a></span> <span class="id">_tpc2</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id">_tpc2</span>' <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">_tpc1</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">_tpc1</span> = <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id">_tpc1</span> <span class="id"><a href="TSOSemLemmas.html#l1">l1</a></span> <span class="id"><a href="TSOSemLemmas.html#fp1">fp1</a></span> <span class="id">_tpc1</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid">eq_config_but_cid</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> <span class="id">tpc2</span>'  <span class="id">_tpc1</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10172')">Proof.</div>
<div class="proofscript" id="proof10172">
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">fp2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">INVTHDP1</span> ? ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#glob_step_inv_preserve">glob_step_inv_preserve</a></span> <span class="kwd">in</span> <span class="id">INVTHDP1</span> <span class="kwd">as</span> <span class="id">INVTHDP2</span> ;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id">H0</span> <span class="kwd">as</span> <span class="id">STEP1</span>. <span class="id">pose</span> <span class="id">proof</span> <span class="id">H4</span> <span class="kwd">as</span> <span class="id">STEP2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>;<span class="id">inv</span> <span class="id">H2</span>;<span class="id">inv</span> <span class="id">H4</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
core&nbsp;step*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">TSO_one_step_reorder</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">H_core_step</span>. <span class="tactic">exact</span> <span class="id">H_core_step0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#unbuffer_safe_buffer_safe">unbuffer_safe_buffer_safe</a></span> <span class="kwd">with</span>(<span class="id">t</span>:=<span class="id">t</span>) <span class="kwd">in</span> <span class="id">H_unbuf_safe0</span> <span class="kwd">as</span> <span class="id">R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">R</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">R</span>. <span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#TSO_bf_add">TSO_bf_add</a></span> <span class="kwd">in</span> <span class="id">H_core_step</span> <span class="kwd">as</span> <span class="id">R1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">R1</span>. <span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">R</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buffer_split">apply_buffer_split</a></span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">x1</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOStepAuxLemmas.html#unbuffer_safe_after_tsostep_unbuffer_safe_original">unbuffer_safe_after_tsostep_unbuffer_safe_original</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H_core_step</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#unbuffer_safe_buffer_safe">unbuffer_safe_buffer_safe</a></span> <span class="kwd">with</span>(<span class="id">t</span>:=<span class="id">t</span>') <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>. <span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#fid_belongsto">fid_belongsto</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">INVTHDP1</span>;<span class="tactic">eauto</span>. <span class="tactic">simpl</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#fid_belongsto">fid_belongsto</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">INVTHDP2</span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#FLists.fbelongsto">FLists.fbelongsto</a></span> <span class="kwd">in</span> <span class="id">H0</span>,<span class="id">H2</span>. <span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.FLISTWD">FLISTWD</a></span>. <span class="tactic">rewrite</span> &lt;-<span class="id">H0</span>,&lt;-<span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.FLISTWD">FLISTWD</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="TSOSemLemmas.html#pc_valid_tid">pc_valid_tid</a></span>  ({<span class="id">thdp</span>', <span class="id">t</span>', <span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="id">tm</span> <span class="id">t</span> <span class="id">buf</span>' <span class="id">gm</span>' }) <span class="id">t</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_backwards_preserve">pc_valid_tid_backwards_preserve</a></span> <span class="kwd">in</span> <span class="id">STEP1</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="TSOSemLemmas.html#thrdpool_update_exists">thrdpool_update_exists</a></span> <span class="id">thdp</span> <span class="id">t</span>' <span class="id">c</span>'0 <span class="id">INVTHDP1</span> <span class="id">H7</span> <span class="kwd">as</span> [<span class="id">thdp1</span> <span class="id">UPD1</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> ({<span class="id">thdp</span>,<span class="id">t</span>',<span class="id">tm</span>}) <span class="kwd">as</span> <span class="id">_tpc0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> ({<span class="id">thdp1</span>, <span class="id">t</span>', <span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="id">tm</span> <span class="id">t</span>' <span class="id">buf</span>'0 <span class="id">x</span>}) <span class="kwd">as</span> <span class="id">_tpc0</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> ({<span class="id">thdp1</span>, <span class="id">t</span>, <span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="id">tm</span> <span class="id">t</span>' <span class="id">buf</span>'0 <span class="id">x</span>}) <span class="kwd">as</span> <span class="id">_tpc1</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="TSOSemLemmas.html#thrdpool_get_update_preserve">thrdpool_get_update_preserve</a></span> <span class="id">thdp</span> <span class="id">t</span>' <span class="id">c</span>'0 <span class="id">thdp1</span> <span class="id">UPD1</span> <span class="id">t</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">H8</span>. <span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">H8</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#inv_update_preserve">inv_update_preserve</a></span>;<span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">UPD1</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">R</span> <span class="kwd">in</span> <span class="id">INVTHDP1</span> <span class="kwd">as</span> <span class="id">INVTHDP3</span>.<br/>
need&nbsp;to&nbsp;construct&nbsp;the&nbsp;second&nbsp;step&nbsp;first&nbsp;to&nbsp;prove&nbsp;unbuffer-safe*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span> <span class="id">_</span>  <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H8</span> <span class="id">INVTHDP3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#thrdpool_update_exists">thrdpool_update_exists</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">INVTHDP3</span>. <span class="tactic">exact</span> <span class="id">H9</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span>(1:=<span class="id">c</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>[<span class="id">thdp2</span> <span class="id">UPD2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="TSOStepAuxLemmas.html#gmem_eq_ub_safe_eq">gmem_eq_ub_safe_eq</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H4</span> <span class="id">H_unbuf_safe0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H10</span>. <span class="tactic">rewrite</span> <span class="id"><a href="TSOSemLemmas.html#tupdate_comm">tupdate_comm</a></span> <span class="kwd">in</span> <span class="id">H10</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> (<span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="id">tm</span> <span class="id">t</span>' <span class="id">buf</span>'0 <span class="id">x</span>) <span class="id">t</span> <span class="id">buf</span>' <span class="id">x0</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id">t</span> <span class="id">buf</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id">t</span>' <span class="id">buf</span>'0 (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">memory</span> := <span class="id">x0</span> |}).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span>&lt;- <span class="id">H11</span> <span class="kwd">in</span> <span class="id">H10</span>. <span class="tactic">clear</span> <span class="id">H11</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> ( {<span class="id">thdp2</span>,<span class="id">t</span>,<span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> (<span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="id">tm</span> <span class="id">t</span>' <span class="id">buf</span>'0 <span class="id">x</span>) <span class="id">t</span> <span class="id">buf</span>' <span class="id">x0</span>}) <span class="kwd">as</span> <span class="id">_tpc2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id">_tpc1</span> <span class="id"><a href="TSOGlobSem.html#tau">tau</a></span> <span class="id">fp1</span> <span class="id">_tpc2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_not_eq_get">tupdate_not_eq_get</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOStepAuxLemmas.html#unbuffer_safe_after_tsostep_unbuffer_safe_original">unbuffer_safe_after_tsostep_unbuffer_safe_original</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2: <span class="tactic">exact</span> <span class="id">H10</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>. <span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t</span>');<span class="tactic">try</span> <span class="id">contradiction</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">_tpc0</span> <span class="id">_tpc0</span>' <span class="id">_tpc1</span> <span class="id">_tpc2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">unfold</span> <span class="id">_tpc0</span>. <span class="tactic">destruct</span> <span class="id">H7</span>; <span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">_tpc0</span>,<span class="id">_tpc0</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>. <span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">destruct</span> <span class="id">H9</span>;<span class="tactic">unfold</span> <span class="id">_tpc0</span>',<span class="id">_tpc1</span>;<span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">_tpc2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>;<span class="tactic">auto</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">UPD2</span> <span class="id">UPD1</span> <span class="id">H_tp_upd</span> <span class="id">H_tp_upd0</span> <span class="id">n</span>. <span class="tactic">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOSemLemmas.html#pmap_set_sym">pmap_set_sym</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="TSOSemLemmas.html#tupdate_comm">tupdate_comm</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#update_push_sym">update_push_sym</a></span>;<span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H_core_upd</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>. <span class="id">solv_thread</span>. <span class="tactic">intro</span>;<span class="id">contradict</span> <span class="id">H_not_halted</span>;<span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Call">Call</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span>(1:=<span class="id">t</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_push_preserve">inv_push_preserve</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_idchange">eq_config_but_cid_idchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#update__pop_update_sym">update__pop_update_sym</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">H_tp_core</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">try</span> <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>;<span class="id">Hsimpl</span>;<span class="id">Esimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>. <span class="id">solv_thread</span>. <span class="tactic">intro</span>;<span class="id">contradict</span> <span class="id">H_not_halted</span>;<span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Return">Return</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span>(1:=<span class="id">t</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>((<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">x</span>)!!<span class="id">t</span>'=<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">c</span>'0::<span class="id">cs0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H2</span> <span class="id">H0</span>. <span class="tactic">clear</span>. <span class="tactic">intros</span>. <span class="id">solv_thread</span>. <span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_update_preserve">inv_update_preserve</a></span> <span class="kwd">in</span> <span class="id">H4</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_pop_preserve">inv_pop_preserve</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_idchange">eq_config_but_cid_idchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#update_pop_sym">update_pop_sym</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">H_tp_core</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>:<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<span class="id">Hsimpl</span>;<span class="id">Esimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Halt">Halt</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_pop_preserve">inv_pop_preserve</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_idchange">eq_config_but_cid_idchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#update_update_sym">update_update_sym</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">H_tp_core</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>:<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<span class="id">Hsimpl</span>;<span class="id">Esimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#EF_Print">EF_Print</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_update_preserve">inv_update_preserve</a></span> <span class="kwd">in</span> <span class="id">H2</span>;<span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">H2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_idchange">eq_config_but_cid_idchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#push_update_sym">push_update_sym</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">H_tp_core</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>:<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<span class="id">Hsimpl</span>;<span class="id">Esimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_update_preserve">inv_update_preserve</a></span> <span class="kwd">in</span> <span class="id">H2</span>;<span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">H2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Call">Call</a></span>;<span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_idchange">eq_config_but_cid_idchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#push_push_sym">push_push_sym</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">H_tp_core</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>:<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<span class="id">Hsimpl</span>;<span class="id">Esimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Call">Call</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_push_preserve">inv_push_preserve</a></span> <span class="kwd">in</span> <span class="id">H2</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Call">Call</a></span>;<span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_idchange">eq_config_but_cid_idchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#push__pop_update_sym">push__pop_update_sym</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">H_tp_core</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>:<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<span class="id">Hsimpl</span>;<span class="id">Esimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Return">Return</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_pop_preserve">inv_pop_preserve</a></span> <span class="kwd">in</span> <span class="id">H2</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>((<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">x</span>)!!<span class="id">t</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">c</span>'::<span class="id">cs0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H0</span> <span class="id">H2</span>;<span class="tactic">clear</span>;<span class="tactic">intros</span>;<span class="tactic">do</span> 2 <span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_update_preserve">inv_update_preserve</a></span> <span class="kwd">in</span> <span class="id">H4</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H10</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Call">Call</a></span>;<span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_idchange">eq_config_but_cid_idchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#push_pop_sym">push_pop_sym</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">H_tp_core</span>. <span class="id">all</span>:<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<span class="id">Hsimpl</span>;<span class="id">Esimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Halt">Halt</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_pop_preserve">inv_pop_preserve</a></span> <span class="kwd">in</span> <span class="id">H2</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Call">Call</a></span>;<span class="tactic">eauto</span>. <span class="tactic">simpl</span>;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_idchange">eq_config_but_cid_idchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#push_update_sym">push_update_sym</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">H_tp_core</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>:<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<span class="id">Hsimpl</span>;<span class="id">Esimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_update_preserve">inv_update_preserve</a></span> <span class="kwd">in</span> <span class="id">H2</span>;<span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">H2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Call">Call</a></span>;<span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_idchange">eq_config_but_cid_idchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#pop_update__update_sym">pop_update__update_sym</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">H_tp_core</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>:<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<span class="id">Hsimpl</span>;<span class="id">Esimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_update_preserve">inv_update_preserve</a></span> <span class="kwd">in</span> <span class="id">H2</span>;<span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">H2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Return">Return</a></span>;<span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_idchange">eq_config_but_cid_idchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#pop_update__push_sym">pop_update__push_sym</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">H_tp_core</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>:<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<span class="id">Hsimpl</span>;<span class="id">Esimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Call">Call</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_push_preserve">inv_push_preserve</a></span> <span class="kwd">in</span> <span class="id">H2</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Return">Return</a></span>;<span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_idchange">eq_config_but_cid_idchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#pop_update__pop_update_sym">pop_update__pop_update_sym</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">H_tp_core</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>:<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<span class="id">Hsimpl</span>;<span class="id">Esimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Return">Return</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_pop_preserve">inv_pop_preserve</a></span> <span class="kwd">in</span> <span class="id">H2</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>((<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">x</span>)!!<span class="id">t</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">c</span>'0::<span class="id">cs0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H0</span> <span class="id">H2</span>;<span class="tactic">clear</span>;<span class="tactic">intros</span>;<span class="tactic">do</span> 2 <span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_update_preserve">inv_update_preserve</a></span> <span class="kwd">in</span> <span class="id">H4</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H11</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Return">Return</a></span>;<span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_idchange">eq_config_but_cid_idchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#pop_update__pop_sym">pop_update__pop_sym</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">H_tp_core</span>. <span class="id">all</span>:<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<span class="id">Hsimpl</span>;<span class="id">Esimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Halt">Halt</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_pop_preserve">inv_pop_preserve</a></span> <span class="kwd">in</span> <span class="id">H2</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Return">Return</a></span>;<span class="tactic">eauto</span>. <span class="tactic">simpl</span>;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_idchange">eq_config_but_cid_idchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#pop_update__update_sym">pop_update__update_sym</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">H_tp_core</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>:<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<span class="id">Hsimpl</span>;<span class="id">Esimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_update_preserve">inv_update_preserve</a></span> <span class="kwd">in</span> <span class="id">H2</span>;<span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">H2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Return">Return</a></span>;<span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_idchange">eq_config_but_cid_idchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#pop_update_sym">pop_update_sym</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">H_tp_core</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>:<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<span class="id">Hsimpl</span>;<span class="id">Esimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_update_preserve">inv_update_preserve</a></span> <span class="kwd">in</span> <span class="id">H2</span>;<span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">H2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Halt">Halt</a></span>;<span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_idchange">eq_config_but_cid_idchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#pop_push_sym">pop_push_sym</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">H_tp_core</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>:<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<span class="id">Hsimpl</span>;<span class="id">Esimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Call">Call</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_push_preserve">inv_push_preserve</a></span> <span class="kwd">in</span> <span class="id">H2</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Halt">Halt</a></span>;<span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_idchange">eq_config_but_cid_idchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#pop__pop_update_sym">pop__pop_update_sym</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">H_tp_core</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>:<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<span class="id">Hsimpl</span>;<span class="id">Esimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Return">Return</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_pop_preserve">inv_pop_preserve</a></span> <span class="kwd">in</span> <span class="id">H2</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>((<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">x</span>)!!<span class="id">t</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">c</span>'::<span class="id">cs</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H0</span> <span class="id">H2</span>;<span class="tactic">clear</span>;<span class="tactic">intros</span>;<span class="tactic">do</span> 2 <span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_update_preserve">inv_update_preserve</a></span> <span class="kwd">in</span> <span class="id">H4</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H10</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Halt">Halt</a></span>;<span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_idchange">eq_config_but_cid_idchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#pop_pop_sym">pop_pop_sym</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">H_tp_core</span>. <span class="id">all</span>:<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<span class="id">Hsimpl</span>;<span class="id">Esimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Halt">Halt</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_pop_preserve">inv_pop_preserve</a></span> <span class="kwd">in</span> <span class="id">H2</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Halt">Halt</a></span>;<span class="tactic">eauto</span>. <span class="tactic">simpl</span>;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_idchange">eq_config_but_cid_idchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#pop_update_sym">pop_update_sym</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">H_tp_core</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>:<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<span class="id">Hsimpl</span>;<span class="id">Esimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_update_preserve">inv_update_preserve</a></span> <span class="kwd">in</span> <span class="id">H2</span>;<span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">H2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Halt">Halt</a></span>;<span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_idchange">eq_config_but_cid_idchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#update_update_sym">update_update_sym</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">H_tp_core</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>:<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<span class="id">Hsimpl</span>;<span class="id">Esimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_update_preserve">inv_update_preserve</a></span> <span class="kwd">in</span> <span class="id">H2</span>;<span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">H2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#EF_Print">EF_Print</a></span>;<span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_idchange">eq_config_but_cid_idchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#update_push_sym">update_push_sym</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">H_tp_core</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>:<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<span class="id">Hsimpl</span>;<span class="id">Esimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Call">Call</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_push_preserve">inv_push_preserve</a></span> <span class="kwd">in</span> <span class="id">H2</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#EF_Print">EF_Print</a></span>;<span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_idchange">eq_config_but_cid_idchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#update__pop_update_sym">update__pop_update_sym</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">H_tp_core</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>:<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<span class="id">Hsimpl</span>;<span class="id">Esimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Return">Return</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_pop_preserve">inv_pop_preserve</a></span> <span class="kwd">in</span> <span class="id">H2</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>((<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">x</span>)!!<span class="id">t</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">c</span>'0::<span class="id">cs0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H0</span> <span class="id">H2</span>;<span class="tactic">clear</span>;<span class="tactic">intros</span>;<span class="tactic">do</span> 2 <span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_update_preserve">inv_update_preserve</a></span> <span class="kwd">in</span> <span class="id">H4</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H10</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#EF_Print">EF_Print</a></span>;<span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_idchange">eq_config_but_cid_idchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#update_pop_sym">update_pop_sym</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">H_tp_core</span>. <span class="id">all</span>:<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<span class="id">Hsimpl</span>;<span class="id">Esimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Halt">Halt</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_pop_preserve">inv_pop_preserve</a></span> <span class="kwd">in</span> <span class="id">H2</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#EF_Print">EF_Print</a></span>;<span class="tactic">eauto</span>. <span class="tactic">simpl</span>;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_idchange">eq_config_but_cid_idchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#update_update_sym">update_update_sym</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">H_tp_core</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>:<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<span class="id">Hsimpl</span>;<span class="id">Esimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#pc_valid_tid_switchable">pc_valid_tid_switchable</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_getable_valid">inv_getable_valid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#inv_update_preserve">inv_update_preserve</a></span> <span class="kwd">in</span> <span class="id">H2</span>;<span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">H2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#EF_Print">EF_Print</a></span>;<span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_idchange">eq_config_but_cid_idchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="FLs_embed_apply_buffer_preserve">FLs_embed_apply_buffer_preserve</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tm</span> <span class="id">fls</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOStepAuxLemmas.html#FLs_embed">FLs_embed</a></span> <span class="id"><a href="TSOSemLemmas.html#fls">fls</a></span> <span class="id"><a href="TSOSemLemmas.html#tm">tm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">t</span> <span class="id">gm</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> = <span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOSemLemmas.html#tm">tm</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOSemLemmas.html#gm">gm</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOStepAuxLemmas.html#FLs_embed">FLs_embed</a></span> <span class="id"><a href="TSOSemLemmas.html#fls">fls</a></span> (<span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="id"><a href="TSOSemLemmas.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> <span class="id"><a href="TSOSemLemmas.html#gm">gm</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10173')">Proof.</div>
<div class="proofscript" id="proof10173">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">t</span>. <span class="id">revert</span> <span class="id">tm</span> <span class="id">fls</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">inv_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="id">tm</span> <span class="id">t</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">tm</span>) = <span class="id">tm</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span>,<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>. <span class="tactic">destruct</span> <span class="id">tm</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Axioms.html#functional_extensionality">functional_extensionality</a></span>;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>. <span class="tactic">congruence</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#optbind">optbind</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="id">ex_match</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">UNBS</span> <span class="kwd">in</span> <span class="id">Hx</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> ({|<span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span>:=<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id">t</span> <span class="id">bf</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span>);<span class="id">memory</span>:=<span class="id">g</span>|}) <span class="id">t</span> = <span class="id">bf</span>). <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>;<span class="tactic">simpl</span>;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf</span> <span class="kwd">in</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="kwd">in</span> <span class="id">H</span>|-*. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_tid_eq">tupdate_same_tid_eq</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="buffer_local_alloc">buffer_local_alloc</a></span> (<span class="id">t</span>:<span class="id"><a href="GlobDefs.html#tid">tid</a></span>)(<span class="id">bf</span>:<span class="id"><a href="TSOMem.html#buffer">buffer</a></span>):=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> <span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span> -&gt; <span class="id">exists</span> <span class="id">n</span>, <span class="id"><a href="TSOAuxDefs.html#buffer_item_local_alloc">buffer_item_local_alloc</a></span> <span class="id"><a href="TSOSemLemmas.html#bi">bi</a></span> (<span class="id"><a href="GlobDefs.html#FLists.get_fl">FLists.get_fl</a></span> (<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.freelists">TSOGlobEnv.freelists</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span>)(<span class="id"><a href="GlobDefs.html#FLists.thread_flmap">FLists.thread_flmap</a></span> (<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.freelists">TSOGlobEnv.freelists</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span>) <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id">n</span>)).<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="thread_buffered_alloc_local_buffer_local_alloc">thread_buffered_alloc_local_buffer_local_alloc</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tm</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">t</span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id"><a href="TSOSemLemmas.html#b">b</a></span> <span class="id"><a href="TSOSemLemmas.html#lo">lo</a></span> <span class="id"><a href="TSOSemLemmas.html#hi">hi</a></span>) (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">fn</span> <span class="id">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">fl</span> := <span class="id"><a href="GlobDefs.html#FLists.get_tfl">FLists.get_tfl</a></span>  (<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.freelists">TSOGlobEnv.freelists</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span>) <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id">fn</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#b">b</a></span> = <span class="id"><a href="GlobDefs.html#FLists.get_block">FLists.get_block</a></span> <span class="id"><a href="TSOSemLemmas.html#fl">fl</a></span> <span class="id">n</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span>, <span class="id"><a href="TSOSemLemmas.html#buffer_local_alloc">buffer_local_alloc</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOSemLemmas.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10174')">Proof.</div>
<div class="proofscript" id="proof10174">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#buffer_local_alloc">buffer_local_alloc</a></span>,<span class="id"><a href="TSOAuxDefs.html#buffer_item_local_alloc">buffer_item_local_alloc</a></span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2,3: <span class="id">exists</span> 0%<span class="id">nat</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#buffer_item_local_alloc">buffer_item_local_alloc</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span>. <span class="id">exists</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#FLists.get_fl">FLists.get_fl</a></span>,<span class="id"><a href="GlobDefs.html#FLists.get_tfl">FLists.get_tfl</a></span>,<span class="id"><a href="GlobDefs.html#FLists.get_block">FLists.get_block</a></span>,<span class="id"><a href="MemAux.html#in_fl">MemAux.in_fl</a></span>. <span class="id">eexists</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="buffer_local_alloc_preserve">buffer_local_alloc_preserve</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">tpc</span> <span class="id">fp</span> <span class="id">tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id"><a href="TSOGlobSem.html#tau">tau</a></span> <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> <span class="id">tpc</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#buffer_local_alloc">buffer_local_alloc</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>) <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>)-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#inv">inv</a></span> (<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>)-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#FLists.wd">FLists.wd</a></span> (<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.freelists">TSOGlobEnv.freelists</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span>)-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#buffer_local_alloc">buffer_local_alloc</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">tpc</span>') <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10175')">Proof.</div>
<div class="proofscript" id="proof10175">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>;<span class="id">ex_match2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#TSO_eff">TSO_eff</a></span> <span class="kwd">in</span> <span class="id">H_core_step</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_core_step</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOAuxDefs.html#eff_chg">eff_chg</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span> <span class="id">t0</span>) <span class="id">buf</span>') <span class="id">eqn</span>:?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_chg_t">eff_chg_t</a></span> <span class="kwd">in</span> <span class="id">Heqb</span> <span class="kwd">as</span> [];<span class="tactic">subst</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_chg_f">eff_chg_f</a></span> <span class="kwd">in</span> <span class="id">Heqb</span>. <span class="tactic">clear</span> <span class="id">bf_chg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#BufferEff">BufferEff</a></span> <span class="kwd">in</span> <span class="id">bf_eff</span>;<span class="id">Hsimpl</span>;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H0</span> <span class="id">H4</span> <span class="id">H1</span> <span class="id">H_tp_core</span>;<span class="tactic">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#buffer_local_alloc">buffer_local_alloc</a></span>,<span class="id"><a href="TSOAuxDefs.html#buffer_local_alloc">TSOAuxDefs.buffer_local_alloc</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#in_app_or">in_app_or</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H4</span> <span class="id">_</span> <span class="id">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>. <span class="id">specialize</span> (<span class="id">cs_inv0</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H_tp_core</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">cs_inv0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id">fid_valid0</span>. <span class="id">left</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H4</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">diff_thrd_normal_unbuffer_step_reorder</span>':<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">tpc</span> <span class="id">tpc</span>' <span class="id">tpc</span>'': @<span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span>) <span class="id">l</span> <span class="id">fp</span> <span class="id">t</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FLEMBED</span>:<span class="id"><a href="TSOStepAuxLemmas.html#FLs_embed">FLs_embed</a></span> (<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.freelists">TSOGlobEnv.freelists</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span>) (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INVTHDP1</span>: <span class="id"><a href="TSOSemLemmas.html#inv">inv</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>.(<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">LALLOC</span>:<span class="id"><a href="TSOSemLemmas.html#buffer_local_alloc">buffer_local_alloc</a></span> <span class="id">t</span>' ((<span class="id">tpc</span>'.(<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span>).(<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span>) <span class="id">t</span>'))),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">t</span> := <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="ClientSim.html#conflictc">conflictc</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#normal_tsoglabel">normal_tsoglabel</a></span> <span class="id"><a href="TSOSemLemmas.html#l">l</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id"><a href="TSOSemLemmas.html#l">l</a></span> <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> &lt;&gt; <span class="id">t</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id">tpc</span>' (<span class="id"><a href="TSOGlobSem.html#ub">ub</a></span> <span class="id">t</span>') <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">tpc</span>'' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">tpc0</span> <span class="id">tpc1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> (<span class="id"><a href="TSOGlobSem.html#ub">ub</a></span> <span class="id">t</span>') <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">tpc0</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id">tpc0</span> <span class="id"><a href="TSOSemLemmas.html#l">l</a></span> <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> <span class="id">tpc1</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_config">eq_config</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> <span class="id">tpc</span>'' <span class="id">tpc1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10176')">Proof.</div>
<div class="proofscript" id="proof10176">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">t</span> <span class="kwd">in</span> *. <span class="tactic">clear</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id">H3</span> <span class="kwd">as</span> <span class="id">STEP2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id">H1</span> <span class="kwd">as</span> <span class="id">STEP1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H3</span>;<span class="id">inv</span> <span class="id">H1</span>;<span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unbuffer">unbuffer</a></span> <span class="kwd">in</span> <span class="id">H_unbuf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match</span>. <span class="id">inv_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">FPNCFLICT</span>:~ <span class="id"><a href="Footprint.html#FP.conflict">FP.conflict</a></span> <span class="id">fp</span> (<span class="id"><a href="TSOMem.html#bi_footprint">bi_footprint</a></span> <span class="id">b</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>;<span class="id">contradict</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">Hx</span>;<span class="id">left</span>;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id"><a href="GlobDefs.html#FLists.get_fl">FLists.get_fl</a></span> (<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.freelists">TSOGlobEnv.freelists</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span>)(<span class="id"><a href="TSOGlobSem.html#TSOCore.F">TSOCore.F</a></span> <span class="id">c</span>)) <span class="kwd">as</span> <span class="id">fl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.modules">TSOGlobEnv.modules</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> (<span class="id"><a href="TSOGlobSem.html#TSOCore.i">TSOCore.i</a></span> <span class="id">c</span>)) <span class="kwd">as</span> <span class="id">ge</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#tsostep_lock_or_notlock">tsostep_lock_or_notlock</a></span> <span class="kwd">in</span> <span class="id">H_core_step</span> <span class="kwd">as</span> <span class="id">R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm0</span> <span class="id">t</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> /\ <span class="id">buf</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>). <span class="id">inv</span> <span class="id">H1</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H3</span>;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H3</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#LEffect">LEffect</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">tm0</span>) <span class="id">gm</span>' <span class="id">fp</span> <span class="id">fl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#TSO_eff">TSO_eff</a></span> <span class="kwd">in</span> <span class="id">H_core_step</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H4</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H4</span> <span class="kwd">as</span> [<span class="id">EFF1</span> <span class="id">LOCALALLOC1</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#MemEffect_fpsmile_MemPre_Rule">MemEffect_fpsmile_MemPre_Rule</a></span> <span class="kwd">in</span> <span class="id">EFF1</span> <span class="kwd">as</span> <span class="id">PRE1</span>;[|<span class="tactic">apply</span> <span class="id"><a href="Footprint.html#FP.smile_conflict_compat">FP.smile_conflict_compat</a></span>;<span class="tactic">eauto</span>].<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#buf_item_unbuf_locality_1">buf_item_unbuf_locality_1</a></span> <span class="kwd">in</span> <span class="id">PRE1</span> <span class="kwd">as</span> <span class="id">UNBUF1</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">UNBUF1</span> <span class="kwd">as</span> [<span class="id">m1</span> [<span class="id">UB1</span> <span class="id">POST1</span>]].<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#apply_buf_item_MemEffect">apply_buf_item_MemEffect</a></span> <span class="kwd">in</span> <span class="id">UB1</span> <span class="kwd">as</span> <span class="id">EFF2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#MemEffect_fpsmile_MemPre_Rule">MemEffect_fpsmile_MemPre_Rule</a></span> <span class="kwd">in</span> <span class="id">EFF2</span> <span class="kwd">as</span> <span class="id">PRE2</span>;[|<span class="tactic">apply</span> <span class="id"><a href="FPLemmas.html#fpsmile_sym">FPLemmas.fpsmile_sym</a></span>;<span class="tactic">apply</span> <span class="id"><a href="Footprint.html#FP.smile_conflict_compat">FP.smile_conflict_compat</a></span>;<span class="tactic">eauto</span>].<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">exists</span> <span class="id">fm</span>,<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">m1</span> <span class="id">fl</span> <span class="id">fm</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">FLEMBED</span>;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">UNBS</span> <span class="kwd">in</span> <span class="id">UB1</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H4</span>. <span class="tactic">eapply</span> <span class="id">Embed0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id">LALLOC</span> <span class="kwd">as</span> [? <span class="id">ITEMALLOC</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>. <span class="id">ex_match2</span>. <span class="tactic">rewrite</span> <span class="id">Hx</span>. <span class="id">left</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span>  (<span class="id"><a href="GlobDefs.html#FLists.get_fl">FLists.get_fl</a></span> (<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.freelists">TSOGlobEnv.freelists</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span>)(<span class="id"><a href="GlobDefs.html#FLists.thread_flmap">FLists.thread_flmap</a></span> (<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.freelists">TSOGlobEnv.freelists</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span>)<span class="id">t</span>' <span class="id">x0</span>)) <span class="kwd">as</span> <span class="id">fl2</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">FLDISJ</span>:<span class="id"><a href="MemAux.html#disj">MemAux.disj</a></span> <span class="id">fl</span> <span class="id">fl2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.FLISTWD">FLISTWD</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">exists</span> <span class="id">n</span>,<span class="id"><a href="TSOGlobSem.html#TSOCore.F">TSOCore.F</a></span> <span class="id">c</span> = <span class="id"><a href="GlobDefs.html#FLists.thread_flmap">FLists.thread_flmap</a></span> (<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.freelists">TSOGlobEnv.freelists</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span>) <span class="id">t</span> <span class="id">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">INVTHDP1</span> <span class="kwd">in</span> <span class="id">H_tp_core</span>. <span class="id">inv</span> <span class="id">H_tp_core</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id">fid_valid0</span>. <span class="id">left</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H5</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H5</span>. <span class="tactic">rewrite</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.FLISTWD">FLISTWD</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">enough</span>(<span class="id">FLEQ</span>: <span class="id"><a href="InteractionSemantics.html#FreelistEq">FreelistEq</a></span> <span class="id">m1</span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">tm0</span>) <span class="id">fl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">LPRE</span>:<span class="id"><a href="InteractionSemantics.html#LPre">LPre</a></span> <span class="id">m1</span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">tm0</span>) <span class="id">fp</span> <span class="id">fl</span>). <span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#LPre_comm">LPre_comm</a></span> <span class="kwd">in</span> <span class="id">LPRE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tso_lock_step_locality">tso_lock_step_locality</a></span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#lock_step_tsostep">lock_step_tsostep</a></span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="GMemory.html#GMem.eq">GMem.eq</a></span> <span class="id">g</span> <span class="id">x1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="GMemory.html#GMem.eq_sym">GMem.eq_sym</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#GMem_eq">GMem_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="FPLemmas.html#LEffect_LPost_fpsmile_memeq">FPLemmas.LEffect_LPost_fpsmile_memeq</a></span> <span class="kwd">with</span>(<span class="id">m1</span>:=<span class="id">gm</span>')(<span class="id">m2</span>:=<span class="id">g</span>)(<span class="id">m1</span>':=<span class="id">m1</span>)(<span class="id">m2</span>':=<span class="id">x1</span>);<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">eauto</span>. <span class="tactic">split</span>;<span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#apply_buf_item_MemEffect">apply_buf_item_MemEffect</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#buffer_item_local_alloc_local_alloc">buffer_item_local_alloc_local_alloc</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Footprint.html#FP.smile_conflict_compat">FP.smile_conflict_compat</a></span>;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">auto</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#buffer_item_local_alloc_local_alloc">buffer_item_local_alloc_local_alloc</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">auto</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#Fleq_apply_buffer_item_preserve">Fleq_apply_buffer_item_preserve</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#FreelistEq_comm">FreelistEq_comm</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#disjoint_fl_memeq">disjoint_fl_memeq</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H1</span>;<span class="tactic">clear</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>.  <span class="id">inv</span> <span class="id">H4</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#notlock_instr">notlock_instr</a></span> <span class="kwd">in</span> <span class="id">H7</span>;<span class="id">ex_match</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<span class="id">ex_match</span>;<span class="id">inv_next</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">try</span> <span class="id">solve</span>[<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#Mem.storev">Mem.storev</a></span> <span class="kwd">in</span> *;<span class="id">ex_match</span>;<span class="tactic">eapply</span> <span class="id"><a href="FMemLemmas.html#store_forward">store_forward</a></span>;<span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H3</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#TSO_eff">TSO_eff</a></span> <span class="kwd">in</span> <span class="id">H5</span>. <span class="tactic">apply</span> <span class="id">H5</span>;<span class="tactic">auto</span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span>  {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id">t</span>' <span class="id">b0</span> (<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id">t</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm0</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">memory</span> := <span class="id">g</span> |}).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_unbuf_safe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">UNBS</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span>. <span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>. <span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#gmem_eq_ub_safe_eq">gmem_eq_ub_safe_eq</a></span> <span class="kwd">in</span> <span class="id">H8</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solv_thread</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unbuffer">unbuffer</a></span>. <span class="tactic">do</span> 2 <span class="id">ex_match3</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2: <span class="tactic">simpl</span>;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>; <span class="id">ex_match2</span>; <span class="tactic">rewrite</span> <span class="id">H3</span>; <span class="tactic">exact</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="TSOSemLemmas.html#tupdate_comm">tupdate_comm</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="TSOSemLemmas.html#tupdate_comm">tupdate_comm</a></span>;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FPLemmas.html#disj_comm">FPLemmas.disj_comm</a></span> <span class="kwd">in</span> <span class="id">FLDISJ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#FreelistEq_comm">FreelistEq_comm</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#disjoint_fl_memeq">disjoint_fl_memeq</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#buffer_item_local_alloc_local_alloc">buffer_item_local_alloc_local_alloc</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">UB1</span>;<span class="tactic">clear</span>;<span class="tactic">destruct</span> <span class="id">b</span>;<span class="tactic">simpl</span>;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span>,<span class="id"><a href="TSOMem.html#store">store</a></span>,<span class="id"><a href="TSOMem.html#free">free</a></span>;<span class="tactic">intros</span>;<span class="id">ex_match</span>;<span class="tactic">try</span> <span class="id">inv_some</span>;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>;<span class="tactic">simpl</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">tm0</span> = <span class="id">gm</span>'). <span class="id">inv</span> <span class="id">H1</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#not_lock_step_mem_ung">not_lock_step_mem_ung</a></span> <span class="kwd">in</span> <span class="id">H12</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H12</span>. <span class="id">inv</span> <span class="id">H9</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">exists</span> <span class="id">fm</span>,<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">g</span> <span class="id">fl</span> <span class="id">fm</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">FLEMBED</span>;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">UNBS</span> <span class="kwd">in</span> <span class="id">Hx0</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H3</span>. <span class="tactic">eapply</span> <span class="id">Embed0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id">LALLOC</span> <span class="kwd">as</span> [? <span class="id">ITEMALLOC</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>. <span class="id">ex_match2</span>. <span class="tactic">rewrite</span> <span class="id">Hx</span>. <span class="id">left</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span>  (<span class="id"><a href="GlobDefs.html#FLists.get_fl">FLists.get_fl</a></span> (<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.freelists">TSOGlobEnv.freelists</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span>)(<span class="id"><a href="GlobDefs.html#FLists.thread_flmap">FLists.thread_flmap</a></span> (<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.freelists">TSOGlobEnv.freelists</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span>)<span class="id">t</span>' <span class="id">x0</span>)) <span class="kwd">as</span> <span class="id">fl2</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">FLDISJ</span>:<span class="id"><a href="MemAux.html#disj">MemAux.disj</a></span> <span class="id">fl</span> <span class="id">fl2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.FLISTWD">FLISTWD</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">exists</span> <span class="id">n</span>,<span class="id"><a href="TSOGlobSem.html#TSOCore.F">TSOCore.F</a></span> <span class="id">c</span> = <span class="id"><a href="GlobDefs.html#FLists.thread_flmap">FLists.thread_flmap</a></span> (<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.freelists">TSOGlobEnv.freelists</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span>) <span class="id">t</span> <span class="id">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">INVTHDP1</span> <span class="kwd">in</span> <span class="id">H_tp_core</span>. <span class="id">inv</span> <span class="id">H_tp_core</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id">fid_valid0</span>. <span class="id">left</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H4</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H4</span>. <span class="tactic">rewrite</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.FLISTWD">FLISTWD</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#LPre">LPre</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">tm0</span>) <span class="id">g</span> <span class="id">fp</span> <span class="id">fl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#MemPre_comm">MemPre_comm</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#MemEffect_fpsmile_MemPre_Rule">MemEffect_fpsmile_MemPre_Rule</a></span>. <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#apply_buf_item_MemEffect">apply_buf_item_MemEffect</a></span>;<span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id"><a href="FPLemmas.html#fpsmile_sym">FPLemmas.fpsmile_sym</a></span>. <span class="tactic">apply</span> <span class="id"><a href="Footprint.html#FP.smile_conflict_compat">FP.smile_conflict_compat</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#disjoint_fl_memeq">disjoint_fl_memeq</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FPLemmas.html#disj_comm">FPLemmas.disj_comm</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#buffer_item_local_alloc_local_alloc">buffer_item_local_alloc_local_alloc</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Hx0</span>;<span class="tactic">clear</span>;<span class="tactic">destruct</span> <span class="id">b</span>;<span class="tactic">simpl</span>;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span>,<span class="id"><a href="TSOMem.html#store">store</a></span>,<span class="id"><a href="TSOMem.html#free">free</a></span>;<span class="tactic">intros</span>;<span class="id">ex_match</span>;<span class="tactic">try</span> <span class="id">inv_some</span>;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>;<span class="tactic">simpl</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(  <span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm0</span> <span class="id">t</span>) (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">tm0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#unbuffer_safe_buffer_safe">unbuffer_safe_buffer_safe</a></span> <span class="kwd">with</span>(<span class="id">t</span>:=<span class="id">t</span>) <span class="kwd">in</span> <span class="id">H_unbuf_safe</span> <span class="kwd">as</span> <span class="id">R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">R</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">R</span>. <span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#TSO_bf_add">TSO_bf_add</a></span> <span class="kwd">in</span> <span class="id">H_core_step</span> <span class="kwd">as</span>[];<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">R</span> <span class="kwd">as</span> [? <span class="id">R</span>]. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buffer_split">apply_buffer_split</a></span> <span class="kwd">in</span> <span class="id">R</span> <span class="kwd">as</span>[?[<span class="id">R1</span> <span class="id">R2</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(  <span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm0</span> <span class="id">t</span>) <span class="id">g</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_unbuf_safe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">UNBS</span> <span class="kwd">in</span> <span class="id">Hx0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Focus</span> 2. <span class="id">instantiate</span>(2:=<span class="id">t</span>'). <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span>,<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>;<span class="tactic">simpl</span>;<span class="id">ex_match2</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#unbuffer_safe_buffer_safe">unbuffer_safe_buffer_safe</a></span> <span class="kwd">with</span>(<span class="id">t</span>:=<span class="id">t</span>) <span class="kwd">in</span> <span class="id">Hx0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hx0</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">Hx0</span>. <span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#TSO_bf_add">TSO_bf_add</a></span> <span class="kwd">in</span> <span class="id">H_core_step</span> <span class="kwd">as</span>[];<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hx0</span> <span class="kwd">as</span> [? <span class="id">R</span>]. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buffer_split">apply_buffer_split</a></span> <span class="kwd">in</span> <span class="id">R</span> <span class="kwd">as</span>[?[<span class="id">R1</span> <span class="id">R2</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(  <span class="id"><a href="TSOAuxDefs.html#buffer_fl_embed">buffer_fl_embed</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm0</span> <span class="id">t</span>) <span class="id">fl</span> <span class="id">g</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>;<span class="tactic">split</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">FLEMBED</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">UNBS</span> <span class="kwd">in</span> <span class="id">Hx0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Embed</span> <span class="id">UNBS</span> <span class="id">Hx1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H6</span> <span class="id">Hx0</span> <span class="id">n</span>. <span class="tactic">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span>  {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id">t</span>' <span class="id">b0</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm0</span>); <span class="id">memory</span> := <span class="id">g</span> |} <span class="kwd">as</span> <span class="id">tm</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">tm</span> = <span class="id">g</span>). <span class="tactic">unfold</span> <span class="id"><a href="TSOGlobSem.html#tm">tm</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H</span> <span class="kwd">in</span> *;<span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#FLs_embed_apply_buffer_preserve">FLs_embed_apply_buffer_preserve</a></span> <span class="kwd">in</span> <span class="id">H6</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H6</span>. <span class="tactic">eapply</span> <span class="id">Embed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span>(1:=<span class="id">t</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOGlobSem.html#tm">tm</a></span>. <span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#not_lock_step_locality">not_lock_step_locality</a></span> <span class="kwd">in</span> <span class="id">H4</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#not_lock_step_tsostep">not_lock_step_tsostep</a></span> <span class="kwd">in</span> <span class="id">H4</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>. <span class="id">econstructor</span>;<span class="tactic">eauto</span>. <span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unbuffer">unbuffer</a></span>. <span class="tactic">do</span> 2 <span class="id">ex_match3</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>.  <span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>;<span class="id">ex_match2</span>. <span class="tactic">eauto</span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_unbuf_safe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">UNBS</span> <span class="kwd">in</span> <span class="id">Hx0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Focus</span> 2. <span class="id">instantiate</span>(2:=<span class="id">t</span>'). <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span>,<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>;<span class="tactic">simpl</span>.  <span class="id">ex_match2</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span>. <span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="kwd">in</span> <span class="id">Hx0</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hx0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOSemLemmas.html#tupdate_comm">tupdate_comm</a></span>;<span class="tactic">auto</span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="GMemory.html#GMem.eq_refl">GMem.eq_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="TSOSemLemmas.html#tupdate_comm">tupdate_comm</a></span>;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="id">eexists</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Call">Call</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_refl">eq_config_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="id">eexists</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>. <span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Return">Return</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_refl">eq_config_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="id">eexists</span>;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>. <span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Halt">Halt</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_refl">eq_config_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="id">eexists</span>;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>. <span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#EF_Print">EF_Print</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_refl">eq_config_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="lock_step_access_eq">lock_step_access_eq</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ge</span> <span class="id">fl</span> <span class="id">c</span> <span class="id">bf</span> <span class="id">m</span> <span class="id">fp</span> <span class="id">c</span>' <span class="id">bf</span>' <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOAuxDefs.html#tso_lock_step">tso_lock_step</a></span> <span class="id"><a href="TSOSemLemmas.html#ge">ge</a></span> <span class="id"><a href="TSOSemLemmas.html#fl">fl</a></span> <span class="id"><a href="TSOSemLemmas.html#c">c</a></span> (<span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span>,<span class="id"><a href="TSOSemLemmas.html#m">m</a></span>) <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> <span class="id">c</span>' (<span class="id">bf</span>',<span class="id">m</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span>) <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> = (<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span>) <span class="id">m</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10177')">Proof.</div>
<div class="proofscript" id="proof10177">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Local</span> <span class="id">Transparent</span> <span class="id"><a href="FMemory.html#Mem.store">Mem.store</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">H9</span>. <span class="id">inv</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#notlock_instr">notlock_instr</a></span> <span class="kwd">in</span> <span class="id">H3</span>;<span class="id">ex_match</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<span class="id">ex_match</span>;<span class="id">inv_next</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>:<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#Mem.storev">Mem.storev</a></span> <span class="kwd">in</span> *; <span class="id">ex_match</span>; <span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#Mem.store">Mem.store</a></span> <span class="kwd">in</span> *; <span class="id">ex_match</span>; <span class="id">inv_some</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="unbuf_locality">unbuf_locality</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">m</span> <span class="id">m1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#MemPre">MemPre</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> (<span class="id"><a href="TSOAuxDefs.html#bf_footprint">bf_footprint</a></span> <span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOSemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m1</span>', <span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span> <span class="id"><a href="TSOSemLemmas.html#m1">m1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#MemPost">MemPost</a></span> <span class="id">m</span>' <span class="id">m1</span>' (<span class="id"><a href="TSOAuxDefs.html#bf_footprint">bf_footprint</a></span> <span class="id"><a href="TSOSemLemmas.html#bf">bf</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10178')">Proof.</div>
<div class="proofscript" id="proof10178">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">inv_some</span>; <span class="id">Esimpl</span>;<span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#unchanged_content_emp">unchanged_content_emp</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#optbind">optbind</a></span> <span class="kwd">in</span> *. <span class="id">ex_match</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#MemPre_split">MemPre_split</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> ?. <span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#buf_item_unbuf_locality_1">buf_item_unbuf_locality_1</a></span> <span class="kwd">in</span> <span class="id">Hx</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H3</span> <span class="id">_</span> <span class="id">H1</span>). <span class="id">Hsimpl</span>. <span class="id">ex_match3</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#apply_buf_item_MemEffect">apply_buf_item_MemEffect</a></span> <span class="kwd">in</span> <span class="id">Hx</span> <span class="kwd">as</span> <span class="id">EFF1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#apply_buf_item_MemEffect">apply_buf_item_MemEffect</a></span> <span class="kwd">in</span> <span class="id">H3</span> <span class="kwd">as</span> <span class="id">EFF2</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">IHbf</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#MemPre_MemEffect_MemPost_Rule">MemPre_MemEffect_MemPost_Rule</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#MemPost_MemEffect_MemPost_Rule">MemPost_MemEffect_MemPost_Rule</a></span>;  <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#apply_buffer_eff">apply_buffer_eff</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#apply_buffer_eff">apply_buffer_eff</a></span>;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<span class="kwd">Definition</span> <span class="id"><a name="ub_footprint">ub_footprint</a></span> (<span class="id">t</span>:<span class="id"><a href="GlobDefs.html#tid">tid</a></span>)(<span class="id">pc</span>:@<span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span>):<span class="id"><a href="Footprint.html#FP.t">FP.t</a></span>:=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#pc">pc</a></span>) <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span><br/>
&nbsp;&nbsp;| <span class="id">b</span>::<span class="id">ls</span> =&gt; <span class="id"><a href="TSOMem.html#bi_footprint">bi_footprint</a></span> <span class="id">b</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<span class="kwd">Lemma</span> <span class="id">diff_thread_unbuffer_normal_step_reorder</span>':<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">tpc</span> <span class="id">tpc</span>' <span class="id">tpc</span>'': @<span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span>) <span class="id">l</span> <span class="id">fp</span> <span class="id">t</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">UBS1</span>:<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FLEMBED</span>:<span class="id"><a href="TSOStepAuxLemmas.html#FLs_embed">FLs_embed</a></span> (<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.freelists">TSOGlobEnv.freelists</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span>) (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INVTHDP1</span>: <span class="id"><a href="TSOSemLemmas.html#inv">inv</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>.(<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">LALLOC</span>:<span class="id"><a href="TSOSemLemmas.html#buffer_local_alloc">buffer_local_alloc</a></span> <span class="id">t</span>' ((<span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>.(<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span>).(<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span>) <span class="id">t</span>'))),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">t</span> := <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="Footprint.html#FP.conflict">FP.conflict</a></span> <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> (<span class="id"><a href="TSOSemLemmas.html#ub_footprint">ub_footprint</a></span> <span class="id">t</span>' <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#normal_tsoglabel">normal_tsoglabel</a></span> <span class="id"><a href="TSOSemLemmas.html#l">l</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> (<span class="id"><a href="TSOGlobSem.html#ub">ub</a></span> <span class="id">t</span>') <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> &lt;&gt; <span class="id">t</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id">tpc</span>' <span class="id"><a href="TSOSemLemmas.html#l">l</a></span> <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> <span class="id">tpc</span>'' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">tpc0</span> <span class="id">tpc1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id"><a href="TSOSemLemmas.html#l">l</a></span> <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> <span class="id">tpc0</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id">tpc0</span> (<span class="id"><a href="TSOGlobSem.html#ub">ub</a></span> <span class="id">t</span>') <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">tpc1</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_config">eq_config</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> <span class="id">tpc</span>'' <span class="id">tpc1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10179')">Proof.</div>
<div class="proofscript" id="proof10179">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">t</span> <span class="kwd">in</span> *. <span class="tactic">clear</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id">H3</span> <span class="kwd">as</span> <span class="id">STEP2</span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id">H1</span> <span class="kwd">as</span> <span class="id">STEP1</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H3</span>;<span class="id">inv</span> <span class="id">H1</span>;<span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unbuffer">unbuffer</a></span> <span class="kwd">in</span> <span class="id">H_unbuf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match</span>. <span class="id">inv_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">FPSMILE</span>:~ <span class="id"><a href="Footprint.html#FP.conflict">FP.conflict</a></span> <span class="id">fp</span> (<span class="id"><a href="TSOMem.html#bi_footprint">bi_footprint</a></span> <span class="id">b</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>;<span class="id">contradict</span> <span class="id">H</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#ub_footprint">ub_footprint</a></span>;<span class="tactic">simpl</span>. <span class="id">ex_match3</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Footprint.html#FP.smile_conflict_compat">FP.smile_conflict_compat</a></span> <span class="kwd">in</span> <span class="id">FPSMILE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id">LALLOC</span>. <span class="tactic">rewrite</span> <span class="id">Hx</span>;<span class="id">left</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id"><a href="GlobDefs.html#FLists.get_fl">FLists.get_fl</a></span> (<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.freelists">TSOGlobEnv.freelists</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span>)(<span class="id"><a href="GlobDefs.html#FLists.thread_flmap">FLists.thread_flmap</a></span> (<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.freelists">TSOGlobEnv.freelists</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span>) <span class="id">t</span>' <span class="id">x</span>)) <span class="kwd">as</span> <span class="id">fl0</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id"><a href="GlobDefs.html#FLists.get_fl">FLists.get_fl</a></span> (<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.freelists">TSOGlobEnv.freelists</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span>)(<span class="id"><a href="TSOGlobSem.html#TSOCore.F">TSOCore.F</a></span> <span class="id">c</span>)) <span class="kwd">as</span> <span class="id">fl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.modules">TSOGlobEnv.modules</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> (<span class="id"><a href="TSOGlobSem.html#TSOCore.i">TSOCore.i</a></span> <span class="id">c</span>)) <span class="kwd">as</span> <span class="id">ge</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">FLDISJ</span>:<span class="id"><a href="MemAux.html#disj">MemAux.disj</a></span> <span class="id">fl</span> <span class="id">fl0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.FLISTWD">FLISTWD</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">INVTHDP1</span> <span class="kwd">in</span> <span class="id">H_tp_core</span>. <span class="id">inv</span> <span class="id">H_tp_core</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id">fid_valid0</span>. <span class="id">left</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H3</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H4</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.FLISTWD">FLISTWD</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#apply_buf_item_MemEffect">apply_buf_item_MemEffect</a></span> <span class="kwd">in</span> <span class="id">Hx0</span> <span class="kwd">as</span> <span class="id">EFF1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#MemEffect_fpsmile_MemPre_Rule">MemEffect_fpsmile_MemPre_Rule</a></span> <span class="kwd">in</span> <span class="id">EFF1</span> <span class="kwd">as</span> <span class="id">PRE1</span>;[|<span class="tactic">apply</span> <span class="id"><a href="FPLemmas.html#fpsmile_sym">FPLemmas.fpsmile_sym</a></span>;<span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">FLEQ</span>:<span class="id"><a href="InteractionSemantics.html#FreelistEq">FreelistEq</a></span> <span class="id">g</span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">tm0</span>) <span class="id">fl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FPLemmas.html#disj_comm">FPLemmas.disj_comm</a></span> <span class="kwd">in</span> <span class="id">FLDISJ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#FreelistEq_comm">FreelistEq_comm</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#disjoint_fl_memeq">disjoint_fl_memeq</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#buffer_item_local_alloc_local_alloc">buffer_item_local_alloc_local_alloc</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">revert</span> <span class="id">Hx0</span>;<span class="tactic">clear</span>;<span class="tactic">destruct</span> <span class="id">b</span>;<span class="tactic">simpl</span>;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span>,<span class="id"><a href="TSOMem.html#store">store</a></span>,<span class="id"><a href="TSOMem.html#free">free</a></span>;<span class="tactic">intros</span>;<span class="id">ex_match</span>;<span class="tactic">try</span> <span class="id">inv_some</span>;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>;<span class="tactic">simpl</span>;<span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">PRE1</span>':<span class="id"><a href="InteractionSemantics.html#LPre">LPre</a></span> <span class="id">g</span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">tm0</span>) <span class="id">fp</span> <span class="id">fl</span>). <span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#tsostep_lock_or_notlock">tsostep_lock_or_notlock</a></span> <span class="kwd">in</span> <span class="id">H_core_step</span> <span class="kwd">as</span> <span class="id">R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">exists</span> <span class="id">fm</span>,<span class="id"><a href="FMemory.html#embed">embed</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">tm0</span>) <span class="id">fl</span> <span class="id">fm</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">FLEMBED</span>. <span class="tactic">eapply</span> <span class="id">Embed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H3</span> <span class="kwd">as</span> [<span class="id">fm</span> <span class="id">EMBED1</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">R</span> <span class="kwd">as</span> [|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id">t</span>' <span class="id">b0</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm0</span>) <span class="id">t</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> /\ <span class="id">buf</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">H3</span>;<span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H4</span>;<span class="tactic">subst</span>;<span class="tactic">rewrite</span> <span class="id">H4</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">H4</span>;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tso_lock_step_locality">tso_lock_step_locality</a></span> <span class="kwd">in</span> <span class="id">PRE1</span>';<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">EFF2</span>:<span class="id"><a href="InteractionSemantics.html#LEffect">LEffect</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">tm0</span>) <span class="id">x0</span> <span class="id">fp</span> <span class="id">fl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#lock_step_tsostep">lock_step_tsostep</a></span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#TSO_eff">TSO_eff</a></span> <span class="kwd">in</span> <span class="id">H5</span>;<span class="tactic">eapply</span> <span class="id">H5</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#LEffect_fpsmile_LPre_Rule">LEffect_fpsmile_LPre_Rule</a></span> <span class="kwd">in</span> <span class="id">EFF2</span> <span class="kwd">as</span> <span class="id">PRE2</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">PRE2</span> <span class="kwd">as</span> [<span class="id">MPRE2</span> <span class="id">ALL2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#MemPre_comm">MemPre_comm</a></span> <span class="kwd">in</span> <span class="id">MPRE2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#buf_item_unbuf_locality_1">buf_item_unbuf_locality_1</a></span> <span class="kwd">in</span> <span class="id">MPRE2</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#unbuffer_safe_after_tsostep_unbuffer_safe_original">unbuffer_safe_after_tsostep_unbuffer_safe_original</a></span> <span class="kwd">in</span> <span class="id">H_unbuf_safe</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Focus</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.  <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>. <span class="id">ex_match2</span>. <span class="tactic">rewrite</span> <span class="id">H4</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="GMemory.html#GMem.eq">GMem.eq</a></span> <span class="id">gm</span>' <span class="id">x1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="GMemory.html#GMem.eq_sym">GMem.eq_sym</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#GMem_eq">GMem_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="FPLemmas.html#LEffect_LPost_fpsmile_memeq">FPLemmas.LEffect_LPost_fpsmile_memeq</a></span> <span class="kwd">with</span>(<span class="id">m1</span>:=<span class="id">g</span>)(<span class="id">m2</span>:=<span class="id">gm</span>')(<span class="id">m1</span>':=<span class="id">x0</span>)(<span class="id">m2</span>':=<span class="id">x1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#buffer_item_local_alloc_local_alloc">buffer_item_local_alloc_local_alloc</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#TSO_eff">TSO_eff</a></span> <span class="kwd">in</span> <span class="id">H_core_step</span>. <span class="tactic">eapply</span> <span class="id">H_core_step</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FPLemmas.html#fpsmile_sym">FPLemmas.fpsmile_sym</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">auto</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#apply_buf_item_MemEffect">apply_buf_item_MemEffect</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#buffer_item_local_alloc_local_alloc">buffer_item_local_alloc_local_alloc</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">auto</span>. <span class="tactic">clear</span> <span class="id">ALL2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#Fleq_apply_buffer_item_preserve">Fleq_apply_buffer_item_preserve</a></span>;<span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H7</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">PRE2</span>. <span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#FreelistEq_comm">FreelistEq_comm</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#gmem_eq_ub_safe_eq">gmem_eq_ub_safe_eq</a></span> <span class="kwd">in</span> <span class="id">H10</span> <span class="kwd">as</span> <span class="id">UBS2</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">UBS2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">H4</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#lock_step_tsostep">lock_step_tsostep</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#lock_step_tsostep">lock_step_tsostep</a></span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#TSO_step_access_validity_preserve">TSO_step_access_validity_preserve</a></span> <span class="kwd">in</span> <span class="id">H5</span> <span class="kwd">as</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#unbuffer_safe_mem_access_same_stable">unbuffer_safe_mem_access_same_stable</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_eq">tupdate_same_eq</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm0</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>. <span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unbuffer">unbuffer</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_not_eq_get">tupdate_not_eq_get</a></span>;<span class="tactic">auto</span>. <span class="id">ex_match3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match3</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="TSOSemLemmas.html#tupdate_comm">tupdate_comm</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>( <span class="id">g</span> = <span class="id">gm</span>'). <span class="id">inv</span> <span class="id">H3</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#not_lock_step_mem_ung">not_lock_step_mem_ung</a></span> <span class="kwd">in</span> <span class="id">H13</span>;<span class="tactic">auto</span>. <span class="id">inv</span> <span class="id">H10</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#not_lock_step_locality">not_lock_step_locality</a></span> <span class="kwd">in</span> <span class="id">PRE1</span>' <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">H4</span>;<span class="id">ex_match2</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> ({| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id">t</span>' <span class="id">b0</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm0</span>); <span class="id">memory</span> := <span class="id">gm</span>' |}) <span class="kwd">as</span> <span class="id">m</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">m</span> = <span class="id">gm</span>'). <span class="tactic">unfold</span> <span class="id">m</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">m</span> <span class="id">t</span> = (<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id">t</span>' <span class="id">b0</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm0</span>) <span class="id">t</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">m</span>;<span class="tactic">simpl</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;-<span class="id">H5</span>,&lt;-<span class="id">H6</span> <span class="kwd">in</span> <span class="id">H_core_step</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#unbuffer_safe_after_tsostep_unbuffer_safe_original">unbuffer_safe_after_tsostep_unbuffer_safe_original</a></span> <span class="kwd">in</span> <span class="id">H_core_step</span> <span class="kwd">as</span> <span class="id">UBS0</span>;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tso_not_lock_step_bufeff">tso_not_lock_step_bufeff</a></span> <span class="kwd">in</span> <span class="id">H4</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H7</span>;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">buf</span>'.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="TSOAuxDefs.html#eff_eq">eff_eq</a></span> <span class="id">fp</span> (<span class="id"><a href="TSOAuxDefs.html#bf_footprint">bf_footprint</a></span> <span class="id">x0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H8</span>;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#fpsmile_eff_eq_trans">fpsmile_eff_eq_trans</a></span> <span class="kwd">in</span> <span class="id">H7</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2: <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#bf_footprint_reads_emp">bf_footprint_reads_emp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2: <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#bf_footprint_cmps_emp">bf_footprint_cmps_emp</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FPLemmas.html#fpsmile_sym">FPLemmas.fpsmile_sym</a></span> <span class="kwd">in</span> <span class="id">H10</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="TSOSemLemmas.html#fpsmile_nfconflict_2">fpsmile_nfconflict_2</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">H10</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#not_lock_step_tsostep">not_lock_step_tsostep</a></span> <span class="kwd">in</span> <span class="id">H4</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Focus</span> 2. <span class="id">econstructor</span>;<span class="tactic">eauto</span>. <span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">thdp</span>'. <span class="id">revert</span> <span class="id">H_tid_valid</span>. <span class="tactic">clear</span>;<span class="tactic">intros</span>. <span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unbuffer">unbuffer</a></span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_not_eq_get">tupdate_not_eq_get</a></span>;<span class="tactic">eauto</span>. <span class="tactic">do</span> 2  <span class="id">ex_match3</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Focus</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>;<span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="GMemory.html#GMem.eq_refl">GMem.eq_refl</a></span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOSemLemmas.html#tupdate_comm">tupdate_comm</a></span>;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#unbuffer_safe_append_bf_preserve">unbuffer_safe_append_bf_preserve</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Focus</span> 2. <span class="tactic">clear</span> <span class="id">Hx1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Hx</span> <span class="id">H_unbuf_safe</span> <span class="id">H11</span> <span class="id">UBS0</span> <span class="id">H6</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#inv_bi">inv_bi</a></span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="TSOSemLemmas.html#unbuffer_safe_nfconflict">unbuffer_safe_nfconflict</a></span> <span class="id">_</span> <span class="id">H_unbuf_safe</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span>'0 <span class="id">t</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hx</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#nfconflict_comm">nfconflict_comm</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H11</span>;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H2</span> <span class="kwd">with</span>(<span class="id">t0</span>:=<span class="id">t</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOSemLemmas.html#tupdate_comm">tupdate_comm</a></span>,<span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_or_app">List.in_or_app</a></span>. <span class="id">right</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span>(1:=<span class="id">t</span>'0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span>! <span class="id"><a href="TSOMemLemmas.html#tupdate_not_eq_get">tupdate_not_eq_get</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Focus</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span>;<span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_or_app">List.in_or_app</a></span>;<span class="id">right</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Unfocus</span>. <span class="tactic">clear</span> <span class="id">Hx1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">UBS1</span> <span class="id">UBS0</span> <span class="id">H_unbuf_safe</span> <span class="id">Hx</span> <span class="id">PRE1</span> <span class="id">n</span> <span class="id">H8</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#unbuffer_safe_buffer_safe">unbuffer_safe_buffer_safe</a></span> <span class="kwd">with</span>(<span class="id">t</span>:=<span class="id">t</span>) <span class="kwd">in</span> <span class="id">UBS0</span> <span class="kwd">as</span> <span class="id">R</span>;<span class="tactic">eauto</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_not_eq_get">tupdate_not_eq_get</a></span> <span class="kwd">in</span> <span class="id">R</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#unbuffer_safe_buffer_safe">unbuffer_safe_buffer_safe</a></span> <span class="kwd">with</span>(<span class="id">t</span>:=<span class="id">t</span>) <span class="kwd">in</span> <span class="id">UBS1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">UBS1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#MemPre_apply_buffer_preserve">MemPre_apply_buffer_preserve</a></span> <span class="kwd">in</span> <span class="id">PRE1</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#unbuffer_safe_buffer_safe">unbuffer_safe_buffer_safe</a></span> <span class="kwd">with</span>(<span class="id">t</span>:=<span class="id">t</span>) <span class="kwd">in</span> <span class="id">H_unbuf_safe</span> <span class="kwd">as</span> <span class="id">R</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">R</span>. <span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span> <span class="kwd">in</span> <span class="id">R</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">R</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buffer_split">apply_buffer_split</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H</span>;<span class="id">inv</span> <span class="id">H</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#MemPre">MemPre</a></span> <span class="id">x</span> <span class="id">x1</span> (<span class="id"><a href="TSOAuxDefs.html#bf_footprint">bf_footprint</a></span> <span class="id">x0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">rewrite</span> <span class="id"><a href="TSOAuxDefs.html#bf_footprint_reads_emp">bf_footprint_reads_emp</a></span>. <span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#unchanged_content_emp">unchanged_content_emp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOAuxDefs.html#bf_footprint_cmps_emp">bf_footprint_cmps_emp</a></span>. <span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#unchanged_perm_emp">unchanged_perm_emp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="kwd">forall</span> <span class="id">fp1</span> <span class="id">fp2</span>, <span class="id"><a href="TSOAuxDefs.html#eff_eq">eff_eq</a></span> <span class="id"><a href="TSOSemLemmas.html#fp1">fp1</a></span> <span class="id"><a href="TSOSemLemmas.html#fp2">fp2</a></span> -&gt; <span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> <span class="id"><a href="TSOSemLemmas.html#fp1">fp1</a></span> = <span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> <span class="id"><a href="TSOSemLemmas.html#fp2">fp2</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> 1. <span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id">H</span>;<span class="tactic">eauto</span>. <span class="tactic">destruct</span> <span class="id">PRE1</span>;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#unbuf_locality">unbuf_locality</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOAuxDefs.html#apply_buffer_app_eq">apply_buffer_app_eq</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_not_eq_get">tupdate_not_eq_get</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#unbuffer_safe_buffer_safe">unbuffer_safe_buffer_safe</a></span> <span class="kwd">with</span>(<span class="id">t</span>:=<span class="id">t</span>) <span class="kwd">in</span> <span class="id">H_unbuf_safe</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H_unbuf_safe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span> <span class="kwd">in</span> <span class="id">H_unbuf_safe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#tso_not_lock_step_bufeff">tso_not_lock_step_bufeff</a></span> <span class="kwd">in</span> <span class="id">H3</span> <span class="kwd">as</span> <span class="id">R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">R</span>;<span class="id">Hsimpl</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_not_eq_get">tupdate_not_eq_get</a></span> <span class="kwd">in</span> <span class="id">H_unbuf_safe</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_unbuf_safe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buffer_split">apply_buffer_split</a></span> <span class="kwd">in</span> <span class="id">H4</span>;<span class="id">Hsimpl</span>;<span class="id">eexists</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#buffer_fl_embed">buffer_fl_embed</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_not_eq_get">tupdate_not_eq_get</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">TSOMemLemmas.unbuffer_safe_apply_buffer</span>' <span class="kwd">with</span>(<span class="id">t</span>:=<span class="id">t</span>) <span class="kwd">in</span> <span class="id">UBS1</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>. <span class="id">eexists</span>;<span class="tactic">split</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#FLs_embed_apply_buffer_preserve">FLs_embed_apply_buffer_preserve</a></span> <span class="kwd">in</span> <span class="id">H4</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H4</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_not_eq_get">tupdate_not_eq_get</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">TSOMemLemmas.unbuffer_safe_apply_buffer</span>' <span class="kwd">with</span>(<span class="id">t</span>:=<span class="id">t</span>) <span class="kwd">in</span> <span class="id">UBS1</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>. <span class="id">esplit</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Call">Call</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>. <span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_refl">eq_config_refl</a></span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Return">Return</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>. <span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_refl">eq_config_refl</a></span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#Halt">Halt</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>. <span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_refl">eq_config_refl</a></span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#EF_Print">EF_Print</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>. <span class="id">solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_refl">eq_config_refl</a></span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<span class="kwd">Inductive</span> <span class="id"><a name="ubstarN">ubstarN</a></span> (<span class="id">t</span>:<span class="id"><a href="GlobDefs.html#tid">tid</a></span>) :<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>-&gt;@<span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span>-&gt;@<span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span>-&gt;<span class="kwd">Prop</span>:=<br/>
| <span class="id"><a name="ubstarN_refl">ubstarN_refl</a></span>: <span class="kwd">forall</span> <span class="id">tpc</span>, <span class="id"><a href="TSOSemLemmas.html#ubstarN">ubstarN</a></span> <span class="id">t</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#O">Datatypes.O</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span><br/>
| <span class="id"><a name="ubstarN_cons">ubstarN_cons</a></span>: <span class="kwd">forall</span> <span class="id">i</span> <span class="id">tpc</span> <span class="id">tpc</span>' <span class="id">tpc</span>'',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> (<span class="id"><a href="TSOGlobSem.html#ub">ub</a></span> <span class="id">t</span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#ubstarN">ubstarN</a></span> <span class="id">t</span> <span class="id"><a href="TSOSemLemmas.html#i">i</a></span> <span class="id">tpc</span>' <span class="id">tpc</span>'' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#ubstarN">ubstarN</a></span> <span class="id">t</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">Datatypes.S</a></span> <span class="id"><a href="TSOSemLemmas.html#i">i</a></span>) <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id">tpc</span>''.<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="ubstarN_ubstar_equiv">ubstarN_ubstar_equiv</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">tpc</span> <span class="id">tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#ub_star">ub_star</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id">tpc</span>' &lt;-&gt; <span class="id">exists</span> <span class="id">n</span>, <span class="id"><a href="TSOSemLemmas.html#ubstarN">ubstarN</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id">n</span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id">tpc</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10180')">Proof.</div>
<div class="proofscript" id="proof10180">
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> 1. <span class="id">eexists</span>;<span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;<span class="id">Hsimpl</span>. <span class="id">eexists</span>;<span class="id">econstructor</span> 2;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">Hsimpl</span>. <span class="tactic">induction</span> <span class="id">H</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="eq_config_eq_ub_starN">eq_config_eq_ub_starN</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">tpc0</span> <span class="id">tpc1</span> <span class="id">tpc0</span>' <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_config">eq_config</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc0">tpc0</a></span> <span class="id">tpc0</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#ubstarN">ubstarN</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#x">x</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc0">tpc0</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">tpc1</span>', <span class="id"><a href="TSOSemLemmas.html#ubstarN">ubstarN</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#x">x</a></span> <span class="id">tpc0</span>' <span class="id">tpc1</span>' /\ <span class="id"><a href="TSOSemLemmas.html#eq_config">eq_config</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> <span class="id">tpc1</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10181')">Proof.</div>
<div class="proofscript" id="proof10181">
&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span>. <span class="id">revert</span> <span class="id">tpc0</span>' <span class="id">H</span>. <span class="tactic">induction</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">exists</span> <span class="id">tpc0</span>'. <span class="tactic">split</span>; [<span class="id">constructor</span> | <span class="tactic">auto</span>].<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_eq_step">eq_config_eq_step</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">tpc1</span>' &amp; <span class="id">Hub0</span>' &amp; <span class="id">Heq</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHubstarN</span> <span class="kwd">in</span> <span class="id">Heq</span>. <span class="tactic">destruct</span> <span class="id">Heq</span> <span class="kwd">as</span> (<span class="id">tpc2</span>' &amp; <span class="id">Hubstar</span>' &amp; <span class="id">Heq</span>).<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">tpc2</span>'. <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="diff_thread_unbuffer_star_normal_step_reorder">diff_thread_unbuffer_star_normal_step_reorder</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">tpc</span> <span class="id">tpc</span>' <span class="id">tpc</span>'': @<span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span>) <span class="id">l</span> <span class="id">fp</span> <span class="id">t</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">UBS1</span>:<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FLEMBED</span>:<span class="id"><a href="TSOStepAuxLemmas.html#FLs_embed">FLs_embed</a></span> (<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.freelists">TSOGlobEnv.freelists</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span>) (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INVTHDP1</span>: <span class="id"><a href="TSOSemLemmas.html#inv">inv</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>.(<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">LALLOC</span>:<span class="id"><a href="TSOSemLemmas.html#buffer_local_alloc">buffer_local_alloc</a></span> <span class="id">t</span>' ((<span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>.(<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span>).(<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span>) <span class="id">t</span>'))),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">t</span> := <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="Footprint.html#FP.conflict">FP.conflict</a></span> <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> (<span class="id"><a href="TSOAuxDefs.html#bf_footprint">bf_footprint</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>) <span class="id">t</span>'))-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#normal_tsoglabel">normal_tsoglabel</a></span> <span class="id"><a href="TSOSemLemmas.html#l">l</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#ub_star">ub_star</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> <span class="id">t</span>' <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id">tpc</span>' -&gt;  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#t">t</a></span> &lt;&gt; <span class="id">t</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id">tpc</span>' <span class="id"><a href="TSOSemLemmas.html#l">l</a></span> <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> <span class="id">tpc</span>'' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">tpc0</span> <span class="id">tpc1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id"><a href="TSOSemLemmas.html#l">l</a></span> <span class="id"><a href="TSOSemLemmas.html#fp">fp</a></span> <span class="id">tpc0</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#ub_star">ub_star</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> <span class="id">t</span>' <span class="id">tpc0</span> <span class="id">tpc1</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_config">eq_config</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> <span class="id">tpc</span>'' <span class="id">tpc1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10182')">Proof.</div>
<div class="proofscript" id="proof10182">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#ubstarN_ubstar_equiv">ubstarN_ubstar_equiv</a></span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> [].<br/>
&nbsp;&nbsp;<span class="id">enough</span> (<span class="id">exists</span> <span class="id">tpc0</span> <span class="id">tpc1</span>, <span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id">tpc</span> <span class="id">l</span> <span class="id">fp</span> <span class="id">tpc0</span> /\ <span class="id"><a href="TSOSemLemmas.html#ubstarN">ubstarN</a></span> <span class="id">t</span>' <span class="id">x</span> <span class="id">tpc0</span> <span class="id">tpc1</span> /\ <span class="id"><a href="TSOSemLemmas.html#eq_config">eq_config</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> <span class="id">tpc</span>'' <span class="id">tpc1</span>).<br/>
&nbsp;&nbsp;<span class="id">Hsimpl</span>. <span class="id">Esimpl</span>;<span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#ubstarN_ubstar_equiv">ubstarN_ubstar_equiv</a></span>;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">revert</span> <span class="id">tpc</span> <span class="id">tpc</span>' <span class="id">tpc</span>'' <span class="id">l</span> <span class="id">fp</span> <span class="id">t</span>' <span class="id">t</span> <span class="id">UBS1</span> <span class="id">FLEMBED</span> <span class="id">INVTHDP1</span> <span class="id">LALLOC</span>  <span class="id">H</span> <span class="id">H0</span> <span class="id">H1</span> <span class="id">H2</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">x</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H1</span>;<span class="tactic">subst</span>. <span class="id">Esimpl</span>;<span class="tactic">eauto</span>. <span class="id">constructor</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_refl">eq_config_refl</a></span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">IHx</span>;<span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H6</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H5</span>; <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unbuffer">unbuffer</a></span> <span class="kwd">in</span> <span class="id">H_unbuf</span>;<span class="id">ex_match</span>;<span class="id">inv_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">UBS1</span>. <span class="tactic">eapply</span> <span class="id">UNBS</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H5</span>; <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unbuffer">unbuffer</a></span> <span class="kwd">in</span> <span class="id">H_unbuf</span>;<span class="id">ex_match</span>;<span class="id">inv_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">FLEMBED</span>. <span class="tactic">eapply</span> <span class="id">UNBS</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#glob_step_inv_preserve">glob_step_inv_preserve</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H5</span>; <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unbuffer">unbuffer</a></span> <span class="kwd">in</span> <span class="id">H_unbuf</span>;<span class="id">ex_match</span>;<span class="id">inv_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#buffer_local_alloc">buffer_local_alloc</a></span> <span class="kwd">in</span> *;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">eapply</span> <span class="id">LALLOC</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">Hx</span>. <span class="id">right</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H5</span>; <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unbuffer">unbuffer</a></span> <span class="kwd">in</span> <span class="id">H_unbuf</span>;<span class="id">ex_match</span>;<span class="id">inv_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>;<span class="id">contradict</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hx</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#FP.union_comm_eq">FP.union_comm_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="USimDRF.html#conflict_union_ano">USimDRF.conflict_union_ano</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H5</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H3</span> <span class="id">H6</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">diff_thread_unbuffer_normal_step_reorder</span>';<span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H5</span>;<span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H1</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>;<span class="id">contradict</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#ub_footprint">ub_footprint</a></span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="id">ex_match2</span>. <span class="tactic">simpl</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">eapply</span> <span class="id"><a href="USimDRF.html#conflict_union_ano">USimDRF.conflict_union_ano</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_eq_ub_starN">eq_config_eq_ub_starN</a></span> <span class="kwd">in</span> <span class="id">H8</span>;<span class="tactic">eauto</span>;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>. <span class="tactic">eauto</span>. <span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_trans">eq_config_trans</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="unbuffer_switchable">unbuffer_switchable</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">tpc</span> <span class="id">tpc1</span> <span class="id">tpc2</span>:@<span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span>) <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> (<span class="id"><a href="TSOGlobSem.html#ub">ub</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> ({-|<span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>,<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span>}) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span>  ({-|<span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>,<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span>}) (<span class="id"><a href="TSOGlobSem.html#ub">ub</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10183')">Proof.</div>
<div class="proofscript" id="proof10183">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>;<span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>;<span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="ubstar_swtichable">ubstar_swtichable</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">tpc</span> <span class="id">tpc1</span> <span class="id">tpc2</span>:@<span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span>) <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#ub_star">ub_star</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span> <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> ({-|<span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>,<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span>}) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#ub_star">ub_star</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> ({-|<span class="id"><a href="TSOSemLemmas.html#tpc">tpc</a></span>,<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span>}) <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10184')">Proof.</div>
<div class="proofscript" id="proof10184">
&nbsp;&nbsp;<span class="tactic">induction</span> 1;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="id">Esimpl</span>;<span class="tactic">eauto</span>; <span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">IHub_star</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id"><a href="TSOSemLemmas.html#unbuffer_switchable">unbuffer_switchable</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">auto</span>. <span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id">diff_thrd_normal_step_unbuffer_normal_step_reorder</span>':<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">tpc1</span> <span class="id">tpc1</span>' <span class="id">tpc1</span>'' <span class="id">tpc2</span> <span class="id">tpc2</span>': @<span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span>) <span class="id">l1</span> <span class="id">fp1</span> <span class="id">l2</span> <span class="id">fp2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FLEMBED</span>:<span class="id"><a href="TSOStepAuxLemmas.html#FLs_embed">FLs_embed</a></span> (<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.freelists">TSOGlobEnv.freelists</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span>) (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INVTHDP1</span>: <span class="id"><a href="TSOSemLemmas.html#inv">inv</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span>.(<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span>) (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#normal_tsoglabel">normal_tsoglabel</a></span> <span class="id"><a href="TSOSemLemmas.html#l1">l1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> <span class="id"><a href="TSOSemLemmas.html#l1">l1</a></span> <span class="id"><a href="TSOSemLemmas.html#fp1">fp1</a></span> <span class="id">tpc1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#ub_star">ub_star</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span>) <span class="id">tpc1</span>' <span class="id">tpc1</span>'' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> &lt;&gt; <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id">tpc1</span>'' <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#normal_tsoglabel">normal_tsoglabel</a></span> <span class="id"><a href="TSOSemLemmas.html#l2">l2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span> <span class="id"><a href="TSOSemLemmas.html#l2">l2</a></span> <span class="id"><a href="TSOSemLemmas.html#fp2">fp2</a></span> <span class="id">tpc2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Footprint.html#FP.smile">FP.smile</a></span> <span class="id"><a href="TSOSemLemmas.html#fp1">fp1</a></span> <span class="id"><a href="TSOSemLemmas.html#fp2">fp2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">_tpc2</span> <span class="id">_tpc2</span>' <span class="id">_tpc1</span> <span class="id">_tpc1</span>' <span class="id">_tpc1</span>'',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">_tpc2</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">_tpc2</span> = <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc2">tpc2</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id">_tpc2</span> <span class="id"><a href="TSOSemLemmas.html#l2">l2</a></span> <span class="id"><a href="TSOSemLemmas.html#fp2">fp2</a></span> <span class="id">_tpc2</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id">_tpc2</span>' <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">_tpc1</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">_tpc1</span> = <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id">_tpc1</span> <span class="id"><a href="TSOSemLemmas.html#l1">l1</a></span> <span class="id"><a href="TSOSemLemmas.html#fp1">fp1</a></span> <span class="id">_tpc1</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#ub_star">ub_star</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOSemLemmas.html#tpc1">tpc1</a></span>) <span class="id">_tpc1</span>' <span class="id">_tpc1</span>'' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid">eq_config_but_cid</a></span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder.TGE">TGE</a></span> <span class="id">tpc2</span>' <span class="id">_tpc1</span>''.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10185')">Proof.</div>
<div class="proofscript" id="proof10185">
&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">tpc1</span>')(<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc1</span>') = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> \/ <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">tpc1</span>')(<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc1</span>') &lt;&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>).<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">tpc1</span>')(<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc1</span>'));<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id">right</span>;<span class="tactic">intro</span>;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H8</span> <span class="kwd">as</span> [|<span class="id">R</span>].<br/>
&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc1</span> = <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc1</span>'). <span class="id">inv</span> <span class="id">H1</span>;<span class="tactic">auto</span>. <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">tpc1</span>' = <span class="id">tpc1</span>'').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H2</span> <span class="id">H8</span> <span class="id">H9</span>;<span class="tactic">clear</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>;<span class="tactic">auto</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unbuffer">unbuffer</a></span> <span class="kwd">in</span> <span class="id">H_unbuf</span>. <span class="id">ex_match2</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.     <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H2</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">diff_thrd_normal_step_reorder</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="tactic">exact</span> <span class="id">H0</span>. <span class="tactic">exact</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H9</span>.  <span class="tactic">exact</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;<span class="id">enough</span>(<span class="id">UBS1</span>:<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">tpc1</span>)).<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#unbuffer_safe_globstep_preserve">unbuffer_safe_globstep_preserve</a></span> <span class="kwd">in</span> <span class="id">UBS1</span> <span class="kwd">as</span> <span class="id">UBS2</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id"><a href="TSOSemLemmas.html#ubstar_swtichable">ubstar_swtichable</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H4</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#diff_thread_unbuffer_star_normal_step_reorder">diff_thread_unbuffer_star_normal_step_reorder</a></span>;<span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H9</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#FLs_embed_preserved">FLs_embed_preserved</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#glob_step_inv_preserve">glob_step_inv_preserve</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H</span> <span class="id">H1</span> <span class="id">INVTHDP1</span>;<span class="tactic">clear</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="kwd">forall</span> <span class="id">t</span>, <span class="id"><a href="TSOSemLemmas.html#buffer_local_alloc">buffer_local_alloc</a></span> <span class="id"><a href="TSOSemLemmas.html#t">t</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#buffer_local_alloc">buffer_local_alloc</a></span>;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H0</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>;<span class="tactic">try</span> <span class="id">solve</span>[<span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#tsostep_buffered_alloc_in_fl">tsostep_buffered_alloc_in_fl</a></span> <span class="kwd">in</span> <span class="id">H_core_step</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#buffer_local_alloc">buffer_local_alloc</a></span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span>,<span class="id">H</span>. <span class="tactic">intros</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#buffer_item_local_alloc">buffer_item_local_alloc</a></span>. <span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H3</span>;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#FLists.get_block">FLists.get_block</a></span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="tactic">unfold</span> <span class="id"><a href="MemAux.html#in_fl">MemAux.in_fl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#cs_inv">cs_inv</a></span> <span class="kwd">in</span> <span class="id">H_tp_core</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#fid_valid">fid_valid</a></span>;<span class="tactic">eauto</span>. <span class="id">left</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="id">Hsimpl</span>. <span class="id">exists</span> <span class="id">x1</span> <span class="id">x0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H6</span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#O">Datatypes.O</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#O">Datatypes.O</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unbuffer">unbuffer</a></span> <span class="kwd">in</span> <span class="id">H_unbuf</span>. <span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv_some</span>;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_not_eq_get">tupdate_not_eq_get</a></span>,<span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>;<span class="tactic">subst</span>;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H</span> <span class="id">H1</span> <span class="id">INVTHDP1</span> <span class="id">H7</span>;<span class="tactic">clear</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H_core_step</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">buf</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> \/ <span class="id">buf</span>' &lt;&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">buf</span>';<span class="tactic">auto</span>. <span class="id">right</span>;<span class="tactic">intro</span>;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span>;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">R</span>;<span class="tactic">apply</span> <span class="id"><a href="Footprint.html#FP.emp_never_conflict">FP.emp_never_conflict</a></span> <span class="kwd">in</span> <span class="id">R</span> <span class="kwd">as</span> [];<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOAuxDefs.html#bf_eff">bf_eff</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#TSO_eff">TSO_eff</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>;<span class="tactic">intro</span>;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#BufferEff">BufferEff</a></span>;<span class="tactic">intros</span>;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<span class="tactic">subst</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Footprint.html#FP.smile_conflict_compat">FP.smile_conflict_compat</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FPLemmas.html#fpsmile_sym">FPLemmas.fpsmile_sym</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#fpsmile_eff_eq_trans">fpsmile_eff_eq_trans</a></span> ;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span>;<span class="tactic">split</span>;<span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#bf_footprint_reads_emp">bf_footprint_reads_emp</a></span>. <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#bf_footprint_cmps_emp">bf_footprint_cmps_emp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unbuffer">unbuffer</a></span> <span class="kwd">in</span> <span class="id">H_unbuf</span>. <span class="id">ex_match2</span>;<span class="id">inv_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_not_eq_get">tupdate_not_eq_get</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>. <span class="tactic">simpl</span>. <span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id"><a href="Footprint.html#FP.emp_never_conflict">FP.emp_never_conflict</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> [];<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>;<span class="tactic">subst</span>;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>;<span class="tactic">intro</span> <span class="id">R</span>;<span class="tactic">apply</span> <span class="id"><a href="Footprint.html#FP.emp_never_conflict">FP.emp_never_conflict</a></span> <span class="kwd">in</span> <span class="id">R</span> <span class="kwd">as</span> [];<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>;<span class="tactic">intro</span> <span class="id">R</span>;<span class="tactic">apply</span> <span class="id"><a href="Footprint.html#FP.emp_never_conflict">FP.emp_never_conflict</a></span> <span class="kwd">in</span> <span class="id">R</span> <span class="kwd">as</span> [];<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>;<span class="tactic">intro</span> <span class="id">R</span>;<span class="tactic">apply</span> <span class="id"><a href="Footprint.html#FP.emp_never_conflict">FP.emp_never_conflict</a></span> <span class="kwd">in</span> <span class="id">R</span> <span class="kwd">as</span> [];<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>;<span class="tactic">intro</span> <span class="id">R</span>;<span class="tactic">apply</span> <span class="id"><a href="Footprint.html#FP.emp_never_conflict">FP.emp_never_conflict</a></span> <span class="kwd">in</span> <span class="id">R</span> <span class="kwd">as</span> [];<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>;<span class="tactic">intro</span> <span class="id">R</span>;<span class="tactic">apply</span> <span class="id"><a href="Footprint.html#FP.emp_never_conflict">FP.emp_never_conflict</a></span> <span class="kwd">in</span> <span class="id">R</span> <span class="kwd">as</span> [];<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;}<br/>
<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc1</span> = <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc1</span>'). <span class="id">inv</span> <span class="id">H1</span>;<span class="tactic">auto</span>. <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">diff_thrd_normal_step_reorder</span>'.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">INVTHDP1</span>. <span class="tactic">exact</span> <span class="id">H0</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;2: <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">intro</span>;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_ub_star">eq_config_but_cid_ub_star</a></span> <span class="kwd">in</span> <span class="id">H18</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_trans">eq_config_but_cid_trans</a></span> <span class="kwd">in</span> <span class="id">H20</span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_eq_config_but_cid">eq_config_eq_config_but_cid</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H</span> <span class="id">H0</span> <span class="id">H1</span> <span class="id">R</span>;<span class="tactic">clear</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOStepAuxLemmas.html#unbuffer_safe_after_tsostep_unbuffer_safe_original">unbuffer_safe_after_tsostep_unbuffer_safe_original</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;Qed.</div>
&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="spawn_inv">spawn_inv</a></span>:<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tp</span> <span class="id">mid</span> <span class="id">c</span> <span class="id">sg</span> <span class="id">tp</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.spawn">TSOThrdPool.spawn</a></span> <span class="id"><a href="TSOSemLemmas.html#tp">tp</a></span> <span class="id"><a href="TSOSemLemmas.html#mid">mid</a></span> <span class="id"><a href="TSOSemLemmas.html#c">c</a></span> <span class="id"><a href="TSOSemLemmas.html#sg">sg</a></span> = <span class="id">tp</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#inv">inv</a></span> <span class="id"><a href="TSOSemLemmas.html#tp">tp</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#inv">inv</a></span> <span class="id">tp</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10186')">Proof.</div>
<div class="proofscript" id="proof10186">
&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.spawn">TSOThrdPool.spawn</a></span>; <span class="tactic">simpl</span>. <br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">subst</span>. <span class="tactic">inversion</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">subst</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>; <span class="tactic">subst</span>. <span class="id">Lia.lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">tp_finite0</span>. <span class="id">Lia.lia</span>. }<br/>
&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">tp_valid0</span>. <span class="tactic">apply</span> <span class="id"><a href="Coqlib.html#Plt_succ_inv">Plt_succ_inv</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;&nbsp;{ <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>; <span class="tactic">subst</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="tactic">clear</span>. <span class="id">constructor</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#FLists.fbelongsto">FLists.fbelongsto</a></span>. <span class="tactic">eauto</span>. <span class="tactic">inversion</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#FLists.fbelongsto">FLists.fbelongsto</a></span>. <span class="tactic">eauto</span>. <span class="tactic">inversion</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="tactic">try</span> <span class="tactic">destruct</span> <span class="id">n1</span>; <span class="tactic">do</span> 2 <span class="tactic">try</span> <span class="tactic">destruct</span> <span class="id">n2</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">auto</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;Qed.</div>
&nbsp;<br/>
&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="init_inv">init_inv</a></span>:<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l</span> <span class="id">thdp</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.init">TSOThrdPool.init</a></span> <span class="id"><a href="TSOSemLemmas.html#l">l</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#inv">inv</a></span> <span class="id"><a href="TSOSemLemmas.html#thdp">thdp</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10187')">Proof.</div>
<div class="proofscript" id="proof10187">
&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="id">constructor</span>;<span class="tactic">simpl</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gi">PMap.gi</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">i</span>;<span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gi">PMap.gi</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHl</span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#spawn_inv">spawn_inv</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;}<br/>
Qed.</div>
&nbsp;&nbsp;&nbsp;<br/>
<span class="kwd">End</span> <span class="id"><a href="TSOSemLemmas.html#normal_reorder">normal_reorder</a></span>.</div>
<div class="footer"><hr/>Generated by coq2html</div>
</body>
</html>
