<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module Allocproof</title>
<meta name="description" content="Documentation of Coq module Allocproof" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module Allocproof</h1>
<div class="coq">
<br/>
<div class="doc">Correctness proof for the <span class="bracket"><span class="id">Allocation</span></span> pass (validated translation from
  RTL to LTL). </div>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">FSets</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Coqlib</span> <span class="id">Ordered</span> <span class="id">Maps</span> <span class="id">Errors</span> <span class="id">Integers</span> <span class="id">Floats</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">AST</span> <span class="id">Linking</span> <span class="id">Lattice</span> <span class="id">Kildall</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Values</span> <span class="id">Memory</span> <span class="id">Globalenvs</span> <span class="id">Events</span> <span class="id">Smallstep</span>.<br/>
<span class="kwd">Require</span> <span class="id">Archi</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Op</span> <span class="id">Registers</span> <span class="id">RTL</span> <span class="id">Locations</span> <span class="id">Conventions</span> <span class="id">RTLtyping</span> <span class="id">LTL</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Allocation</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">match_prog</span> (<span class="id">p</span>: <span class="id">RTL.program</span>) (<span class="id">tp</span>: <span class="id">LTL.program</span>) :=<br/>
&nbsp;&nbsp;<span class="id">match_program</span> (<span class="kwd">fun</span> <span class="id">_</span> <span class="id">f</span> <span class="id">tf</span> =&gt; <span class="id">transf_fundef</span> <span class="id">f</span> = <span class="id">OK</span> <span class="id">tf</span>) <span class="id">eq</span> <span class="id">p</span> <span class="id">tp</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">transf_program_match</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">p</span> <span class="id">tp</span>, <span class="id">transf_program</span> <span class="id">p</span> = <span class="id">OK</span> <span class="id">tp</span> -&gt; <span class="id">match_prog</span> <span class="id">p</span> <span class="id">tp</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3469')">Proof.</div>
<div class="proofscript" id="proof3469">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id">match_transform_partial_program</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<h1> Soundness of structural checks </h1>
<br/>
<span class="kwd">Definition</span> <span class="id">expand_move</span> (<span class="id">m</span>: <span class="tactic">move</span>) : <span class="id">instruction</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">m</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| (<span class="id">R</span> <span class="id">src</span>, <span class="id">R</span> <span class="id">dst</span>) =&gt; <span class="id">Lop</span> <span class="id">Omove</span> (<span class="id">src</span>::<span class="id">nil</span>) <span class="id">dst</span><br/>
&nbsp;&nbsp;| (<span class="id">S</span> <span class="id">sl</span> <span class="id">ofs</span> <span class="id">ty</span>, <span class="id">R</span> <span class="id">dst</span>) =&gt; <span class="id">Lgetstack</span> <span class="id">sl</span> <span class="id">ofs</span> <span class="id">ty</span> <span class="id">dst</span><br/>
&nbsp;&nbsp;| (<span class="id">R</span> <span class="id">src</span>, <span class="id">S</span> <span class="id">sl</span> <span class="id">ofs</span> <span class="id">ty</span>) =&gt; <span class="id">Lsetstack</span> <span class="id">src</span> <span class="id">sl</span> <span class="id">ofs</span> <span class="id">ty</span><br/>
&nbsp;&nbsp;| (<span class="id">S</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>, <span class="id">S</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>) =&gt; <span class="id">Lreturn</span>    <span class="docright">(* should never happen  *)</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">expand_moves</span> (<span class="id">mv</span>: <span class="id">moves</span>) (<span class="id">k</span>: <span class="id">bblock</span>) : <span class="id">bblock</span> :=<br/>
&nbsp;&nbsp;<span class="id">List.map</span> <span class="id">expand_move</span> <span class="id">mv</span> ++ <span class="id">k</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">wf_move</span> (<span class="id">m</span>: <span class="tactic">move</span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">m</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| (<span class="id">S</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>, <span class="id">S</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>) =&gt; <span class="id">False</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">True</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">wf_moves</span> (<span class="id">mv</span>: <span class="id">moves</span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id">List.Forall</span> <span class="id">wf_move</span> <span class="id">mv</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">expand_block_shape</span>: <span class="id">block_shape</span> -&gt; <span class="id">RTL.instruction</span> -&gt; <span class="id">LTL.bblock</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id">ebs_nop</span>: <span class="kwd">forall</span> <span class="id">mv</span> <span class="id">s</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_moves</span> <span class="id">mv</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">expand_block_shape</span> (<span class="id">BSnop</span> <span class="id">mv</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Inop</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">expand_moves</span> <span class="id">mv</span> (<span class="id">Lbranch</span> <span class="id">s</span> :: <span class="id">k</span>))<br/>
&nbsp;&nbsp;| <span class="id">ebs_move</span>: <span class="kwd">forall</span> <span class="id">src</span> <span class="id">dst</span> <span class="id">mv</span> <span class="id">s</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_moves</span> <span class="id">mv</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">expand_block_shape</span> (<span class="id">BSmove</span> <span class="id">src</span> <span class="id">dst</span> <span class="id">mv</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Iop</span> <span class="id">Omove</span> (<span class="id">src</span> :: <span class="id">nil</span>) <span class="id">dst</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">expand_moves</span> <span class="id">mv</span> (<span class="id">Lbranch</span> <span class="id">s</span> :: <span class="id">k</span>))<br/>
&nbsp;&nbsp;| <span class="id">ebs_makelong</span>: <span class="kwd">forall</span> <span class="id">src1</span> <span class="id">src2</span> <span class="id">dst</span> <span class="id">mv</span> <span class="id">s</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_moves</span> <span class="id">mv</span> -&gt; <span class="id">Archi.splitlong</span> = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">expand_block_shape</span> (<span class="id">BSmakelong</span> <span class="id">src1</span> <span class="id">src2</span> <span class="id">dst</span> <span class="id">mv</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Iop</span> <span class="id">Omakelong</span> (<span class="id">src1</span> :: <span class="id">src2</span> :: <span class="id">nil</span>) <span class="id">dst</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">expand_moves</span> <span class="id">mv</span> (<span class="id">Lbranch</span> <span class="id">s</span> :: <span class="id">k</span>))<br/>
&nbsp;&nbsp;| <span class="id">ebs_lowlong</span>: <span class="kwd">forall</span> <span class="id">src</span> <span class="id">dst</span> <span class="id">mv</span> <span class="id">s</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_moves</span> <span class="id">mv</span> -&gt; <span class="id">Archi.splitlong</span> = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">expand_block_shape</span> (<span class="id">BSlowlong</span> <span class="id">src</span> <span class="id">dst</span> <span class="id">mv</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Iop</span> <span class="id">Olowlong</span> (<span class="id">src</span> :: <span class="id">nil</span>) <span class="id">dst</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">expand_moves</span> <span class="id">mv</span> (<span class="id">Lbranch</span> <span class="id">s</span> :: <span class="id">k</span>))<br/>
&nbsp;&nbsp;| <span class="id">ebs_highlong</span>: <span class="kwd">forall</span> <span class="id">src</span> <span class="id">dst</span> <span class="id">mv</span> <span class="id">s</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_moves</span> <span class="id">mv</span> -&gt; <span class="id">Archi.splitlong</span> = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">expand_block_shape</span> (<span class="id">BShighlong</span> <span class="id">src</span> <span class="id">dst</span> <span class="id">mv</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Iop</span> <span class="id">Ohighlong</span> (<span class="id">src</span> :: <span class="id">nil</span>) <span class="id">dst</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">expand_moves</span> <span class="id">mv</span> (<span class="id">Lbranch</span> <span class="id">s</span> :: <span class="id">k</span>))<br/>
&nbsp;&nbsp;| <span class="id">ebs_op</span>: <span class="kwd">forall</span> <span class="id">op</span> <span class="id">args</span> <span class="id">res</span> <span class="id">mv1</span> <span class="id">args</span>' <span class="id">res</span>' <span class="id">mv2</span> <span class="id">s</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_moves</span> <span class="id">mv1</span> -&gt; <span class="id">wf_moves</span> <span class="id">mv2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">expand_block_shape</span> (<span class="id">BSop</span> <span class="id">op</span> <span class="id">args</span> <span class="id">res</span> <span class="id">mv1</span> <span class="id">args</span>' <span class="id">res</span>' <span class="id">mv2</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Iop</span> <span class="id">op</span> <span class="id">args</span> <span class="id">res</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">expand_moves</span> <span class="id">mv1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Lop</span> <span class="id">op</span> <span class="id">args</span>' <span class="id">res</span>' :: <span class="id">expand_moves</span> <span class="id">mv2</span> (<span class="id">Lbranch</span> <span class="id">s</span> :: <span class="id">k</span>)))<br/>
&nbsp;&nbsp;| <span class="id">ebs_op_dead</span>: <span class="kwd">forall</span> <span class="id">op</span> <span class="id">args</span> <span class="id">res</span> <span class="id">mv</span> <span class="id">s</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_moves</span> <span class="id">mv</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">expand_block_shape</span> (<span class="id">BSopdead</span> <span class="id">op</span> <span class="id">args</span> <span class="id">res</span> <span class="id">mv</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Iop</span> <span class="id">op</span> <span class="id">args</span> <span class="id">res</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">expand_moves</span> <span class="id">mv</span> (<span class="id">Lbranch</span> <span class="id">s</span> :: <span class="id">k</span>))<br/>
&nbsp;&nbsp;| <span class="id">ebs_load</span>: <span class="kwd">forall</span> <span class="id">chunk</span> <span class="id">addr</span> <span class="id">args</span> <span class="id">dst</span> <span class="id">mv1</span> <span class="id">args</span>' <span class="id">dst</span>' <span class="id">mv2</span> <span class="id">s</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_moves</span> <span class="id">mv1</span> -&gt; <span class="id">wf_moves</span> <span class="id">mv2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">expand_block_shape</span> (<span class="id">BSload</span> <span class="id">chunk</span> <span class="id">addr</span> <span class="id">args</span> <span class="id">dst</span> <span class="id">mv1</span> <span class="id">args</span>' <span class="id">dst</span>' <span class="id">mv2</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Iload</span> <span class="id">chunk</span> <span class="id">addr</span> <span class="id">args</span> <span class="id">dst</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">expand_moves</span> <span class="id">mv1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Lload</span> <span class="id">chunk</span> <span class="id">addr</span> <span class="id">args</span>' <span class="id">dst</span>' :: <span class="id">expand_moves</span> <span class="id">mv2</span> (<span class="id">Lbranch</span> <span class="id">s</span> :: <span class="id">k</span>)))<br/>
&nbsp;&nbsp;| <span class="id">ebs_load2</span>: <span class="kwd">forall</span> <span class="id">addr</span> <span class="id">addr2</span> <span class="id">args</span> <span class="id">dst</span> <span class="id">mv1</span> <span class="id">args1</span>' <span class="id">dst1</span>' <span class="id">mv2</span> <span class="id">args2</span>' <span class="id">dst2</span>' <span class="id">mv3</span> <span class="id">s</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_moves</span> <span class="id">mv1</span> -&gt; <span class="id">wf_moves</span> <span class="id">mv2</span> -&gt; <span class="id">wf_moves</span> <span class="id">mv3</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Archi.splitlong</span> = <span class="id">true</span> -&gt; <span class="id">offset_addressing</span> <span class="id">addr</span> 4 = <span class="id">Some</span> <span class="id">addr2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">expand_block_shape</span> (<span class="id">BSload2</span> <span class="id">addr</span> <span class="id">addr2</span> <span class="id">args</span> <span class="id">dst</span> <span class="id">mv1</span> <span class="id">args1</span>' <span class="id">dst1</span>' <span class="id">mv2</span> <span class="id">args2</span>' <span class="id">dst2</span>' <span class="id">mv3</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Iload</span> <span class="id">Mint64</span> <span class="id">addr</span> <span class="id">args</span> <span class="id">dst</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">expand_moves</span> <span class="id">mv1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Lload</span> <span class="id">Mint32</span> <span class="id">addr</span> <span class="id">args1</span>' <span class="id">dst1</span>' ::<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">expand_moves</span> <span class="id">mv2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Lload</span> <span class="id">Mint32</span> <span class="id">addr2</span> <span class="id">args2</span>' <span class="id">dst2</span>' ::<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">expand_moves</span> <span class="id">mv3</span> (<span class="id">Lbranch</span> <span class="id">s</span> :: <span class="id">k</span>))))<br/>
&nbsp;&nbsp;| <span class="id">ebs_load2_1</span>: <span class="kwd">forall</span> <span class="id">addr</span> <span class="id">args</span> <span class="id">dst</span> <span class="id">mv1</span> <span class="id">args</span>' <span class="id">dst</span>' <span class="id">mv2</span> <span class="id">s</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_moves</span> <span class="id">mv1</span> -&gt; <span class="id">wf_moves</span> <span class="id">mv2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Archi.splitlong</span> = <span class="id">true</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">expand_block_shape</span> (<span class="id">BSload2_1</span> <span class="id">addr</span> <span class="id">args</span> <span class="id">dst</span> <span class="id">mv1</span> <span class="id">args</span>' <span class="id">dst</span>' <span class="id">mv2</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Iload</span> <span class="id">Mint64</span> <span class="id">addr</span> <span class="id">args</span> <span class="id">dst</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">expand_moves</span> <span class="id">mv1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Lload</span> <span class="id">Mint32</span> <span class="id">addr</span> <span class="id">args</span>' <span class="id">dst</span>' ::<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">expand_moves</span> <span class="id">mv2</span> (<span class="id">Lbranch</span> <span class="id">s</span> :: <span class="id">k</span>)))<br/>
&nbsp;&nbsp;| <span class="id">ebs_load2_2</span>: <span class="kwd">forall</span> <span class="id">addr</span> <span class="id">addr2</span> <span class="id">args</span> <span class="id">dst</span> <span class="id">mv1</span> <span class="id">args</span>' <span class="id">dst</span>' <span class="id">mv2</span> <span class="id">s</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_moves</span> <span class="id">mv1</span> -&gt; <span class="id">wf_moves</span> <span class="id">mv2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Archi.splitlong</span> = <span class="id">true</span> -&gt; <span class="id">offset_addressing</span> <span class="id">addr</span> 4 = <span class="id">Some</span> <span class="id">addr2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">expand_block_shape</span> (<span class="id">BSload2_2</span> <span class="id">addr</span> <span class="id">addr2</span> <span class="id">args</span> <span class="id">dst</span> <span class="id">mv1</span> <span class="id">args</span>' <span class="id">dst</span>' <span class="id">mv2</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Iload</span> <span class="id">Mint64</span> <span class="id">addr</span> <span class="id">args</span> <span class="id">dst</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">expand_moves</span> <span class="id">mv1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Lload</span> <span class="id">Mint32</span> <span class="id">addr2</span> <span class="id">args</span>' <span class="id">dst</span>' ::<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">expand_moves</span> <span class="id">mv2</span> (<span class="id">Lbranch</span> <span class="id">s</span> :: <span class="id">k</span>)))<br/>
&nbsp;&nbsp;| <span class="id">ebs_load_dead</span>: <span class="kwd">forall</span> <span class="id">chunk</span> <span class="id">addr</span> <span class="id">args</span> <span class="id">dst</span> <span class="id">mv</span> <span class="id">s</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_moves</span> <span class="id">mv</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">expand_block_shape</span> (<span class="id">BSloaddead</span> <span class="id">chunk</span> <span class="id">addr</span> <span class="id">args</span> <span class="id">dst</span> <span class="id">mv</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Iload</span> <span class="id">chunk</span> <span class="id">addr</span> <span class="id">args</span> <span class="id">dst</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">expand_moves</span> <span class="id">mv</span> (<span class="id">Lbranch</span> <span class="id">s</span> :: <span class="id">k</span>))<br/>
&nbsp;&nbsp;| <span class="id">ebs_store</span>: <span class="kwd">forall</span> <span class="id">chunk</span> <span class="id">addr</span> <span class="id">args</span> <span class="id">src</span> <span class="id">mv1</span> <span class="id">args</span>' <span class="id">src</span>' <span class="id">s</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_moves</span> <span class="id">mv1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">expand_block_shape</span> (<span class="id">BSstore</span> <span class="id">chunk</span> <span class="id">addr</span> <span class="id">args</span> <span class="id">src</span> <span class="id">mv1</span> <span class="id">args</span>' <span class="id">src</span>' <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Istore</span> <span class="id">chunk</span> <span class="id">addr</span> <span class="id">args</span> <span class="id">src</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">expand_moves</span> <span class="id">mv1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Lstore</span> <span class="id">chunk</span> <span class="id">addr</span> <span class="id">args</span>' <span class="id">src</span>' :: <span class="id">Lbranch</span> <span class="id">s</span> :: <span class="id">k</span>))<br/>
&nbsp;&nbsp;| <span class="id">ebs_store2</span>: <span class="kwd">forall</span> <span class="id">addr</span> <span class="id">addr2</span> <span class="id">args</span> <span class="id">src</span> <span class="id">mv1</span> <span class="id">args1</span>' <span class="id">src1</span>' <span class="id">mv2</span> <span class="id">args2</span>' <span class="id">src2</span>' <span class="id">s</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_moves</span> <span class="id">mv1</span> -&gt; <span class="id">wf_moves</span> <span class="id">mv2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Archi.splitlong</span> = <span class="id">true</span> -&gt; <span class="id">offset_addressing</span> <span class="id">addr</span> 4 = <span class="id">Some</span> <span class="id">addr2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">expand_block_shape</span> (<span class="id">BSstore2</span> <span class="id">addr</span> <span class="id">addr2</span> <span class="id">args</span> <span class="id">src</span> <span class="id">mv1</span> <span class="id">args1</span>' <span class="id">src1</span>' <span class="id">mv2</span> <span class="id">args2</span>' <span class="id">src2</span>' <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Istore</span> <span class="id">Mint64</span> <span class="id">addr</span> <span class="id">args</span> <span class="id">src</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">expand_moves</span> <span class="id">mv1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Lstore</span> <span class="id">Mint32</span> <span class="id">addr</span> <span class="id">args1</span>' <span class="id">src1</span>' ::<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">expand_moves</span> <span class="id">mv2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Lstore</span> <span class="id">Mint32</span> <span class="id">addr2</span> <span class="id">args2</span>' <span class="id">src2</span>' ::<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Lbranch</span> <span class="id">s</span> :: <span class="id">k</span>)))<br/>
&nbsp;&nbsp;| <span class="id">ebs_call</span>: <span class="kwd">forall</span> <span class="id">sg</span> <span class="id">ros</span> <span class="id">args</span> <span class="id">res</span> <span class="id">mv1</span> <span class="id">ros</span>' <span class="id">mv2</span> <span class="id">s</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_moves</span> <span class="id">mv1</span> -&gt; <span class="id">wf_moves</span> <span class="id">mv2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">expand_block_shape</span> (<span class="id">BScall</span> <span class="id">sg</span> <span class="id">ros</span> <span class="id">args</span> <span class="id">res</span> <span class="id">mv1</span> <span class="id">ros</span>' <span class="id">mv2</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Icall</span> <span class="id">sg</span> <span class="id">ros</span> <span class="id">args</span> <span class="id">res</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">expand_moves</span> <span class="id">mv1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Lcall</span> <span class="id">sg</span> <span class="id">ros</span>' :: <span class="id">expand_moves</span> <span class="id">mv2</span> (<span class="id">Lbranch</span> <span class="id">s</span> :: <span class="id">k</span>)))<br/>
&nbsp;&nbsp;| <span class="id">ebs_tailcall</span>: <span class="kwd">forall</span> <span class="id">sg</span> <span class="id">ros</span> <span class="id">args</span> <span class="id">mv</span> <span class="id">ros</span>' <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_moves</span> <span class="id">mv</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">expand_block_shape</span> (<span class="id">BStailcall</span> <span class="id">sg</span> <span class="id">ros</span> <span class="id">args</span> <span class="id">mv</span> <span class="id">ros</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Itailcall</span> <span class="id">sg</span> <span class="id">ros</span> <span class="id">args</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">expand_moves</span> <span class="id">mv</span> (<span class="id">Ltailcall</span> <span class="id">sg</span> <span class="id">ros</span>' :: <span class="id">k</span>))<br/>
&nbsp;&nbsp;| <span class="id">ebs_builtin</span>: <span class="kwd">forall</span> <span class="id">ef</span> <span class="id">args</span> <span class="id">res</span> <span class="id">mv1</span> <span class="id">args</span>' <span class="id">res</span>' <span class="id">mv2</span> <span class="id">s</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_moves</span> <span class="id">mv1</span> -&gt; <span class="id">wf_moves</span> <span class="id">mv2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">expand_block_shape</span> (<span class="id">BSbuiltin</span> <span class="id">ef</span> <span class="id">args</span> <span class="id">res</span> <span class="id">mv1</span> <span class="id">args</span>' <span class="id">res</span>' <span class="id">mv2</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ibuiltin</span> <span class="id">ef</span> <span class="id">args</span> <span class="id">res</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">expand_moves</span> <span class="id">mv1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Lbuiltin</span> <span class="id">ef</span> <span class="id">args</span>' <span class="id">res</span>' :: <span class="id">expand_moves</span> <span class="id">mv2</span> (<span class="id">Lbranch</span> <span class="id">s</span> :: <span class="id">k</span>)))<br/>
&nbsp;&nbsp;| <span class="id">ebs_cond</span>: <span class="kwd">forall</span> <span class="id">cond</span> <span class="id">args</span> <span class="id">mv</span> <span class="id">args</span>' <span class="id">s1</span> <span class="id">s2</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_moves</span> <span class="id">mv</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">expand_block_shape</span> (<span class="id">BScond</span> <span class="id">cond</span> <span class="id">args</span> <span class="id">mv</span> <span class="id">args</span>' <span class="id">s1</span> <span class="id">s2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Icond</span> <span class="id">cond</span> <span class="id">args</span> <span class="id">s1</span> <span class="id">s2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">expand_moves</span> <span class="id">mv</span> (<span class="id">Lcond</span> <span class="id">cond</span> <span class="id">args</span>' <span class="id">s1</span> <span class="id">s2</span> :: <span class="id">k</span>))<br/>
&nbsp;&nbsp;| <span class="id">ebs_jumptable</span>: <span class="kwd">forall</span> <span class="id">arg</span> <span class="id">mv</span> <span class="id">arg</span>' <span class="id">tbl</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_moves</span> <span class="id">mv</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">expand_block_shape</span> (<span class="id">BSjumptable</span> <span class="id">arg</span> <span class="id">mv</span> <span class="id">arg</span>' <span class="id">tbl</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ijumptable</span> <span class="id">arg</span> <span class="id">tbl</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">expand_moves</span> <span class="id">mv</span> (<span class="id">Ljumptable</span> <span class="id">arg</span>' <span class="id">tbl</span> :: <span class="id">k</span>))<br/>
&nbsp;&nbsp;| <span class="id">ebs_return</span>: <span class="kwd">forall</span> <span class="id">optarg</span> <span class="id">mv</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_moves</span> <span class="id">mv</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">expand_block_shape</span> (<span class="id">BSreturn</span> <span class="id">optarg</span> <span class="id">mv</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ireturn</span> <span class="id">optarg</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">expand_moves</span> <span class="id">mv</span> (<span class="id">Lreturn</span> :: <span class="id">k</span>)).<br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">MonadInv</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [ <span class="id">H</span>: <span class="kwd">match</span> ?<span class="id">x</span> <span class="kwd">with</span> <span class="id">Some</span> <span class="id">_</span> =&gt; <span class="id">_</span> | <span class="id">None</span> =&gt; <span class="id">None</span> <span class="kwd">end</span> = <span class="id">Some</span> <span class="id">_</span> |- <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span> <span class="kwd">as</span> [] <span class="id">eqn</span>:? ; [<span class="id">MonadInv</span>|<span class="tactic">discriminate</span>]<br/>
&nbsp;&nbsp;| [ <span class="id">H</span>: <span class="kwd">match</span> ?<span class="id">x</span> <span class="kwd">with</span> <span class="id">left</span> <span class="id">_</span> =&gt; <span class="id">_</span> | <span class="id">right</span> <span class="id">_</span> =&gt; <span class="id">None</span> <span class="kwd">end</span> = <span class="id">Some</span> <span class="id">_</span> |- <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>; [<span class="id">MonadInv</span>|<span class="tactic">discriminate</span>]<br/>
&nbsp;&nbsp;| [ <span class="id">H</span>: <span class="kwd">match</span> <span class="id">negb</span> (<span class="id">proj_sumbool</span> ?<span class="id">x</span>) <span class="kwd">with</span> <span class="id">true</span> =&gt; <span class="id">_</span> | <span class="id">false</span> =&gt; <span class="id">None</span> <span class="kwd">end</span> = <span class="id">Some</span> <span class="id">_</span> |- <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>; [<span class="tactic">discriminate</span>|<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">MonadInv</span>]<br/>
&nbsp;&nbsp;| [ <span class="id">H</span>: <span class="kwd">match</span> <span class="id">negb</span> ?<span class="id">x</span> <span class="kwd">with</span> <span class="id">true</span> =&gt; <span class="id">_</span> | <span class="id">false</span> =&gt; <span class="id">None</span> <span class="kwd">end</span> = <span class="id">Some</span> <span class="id">_</span> |- <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>; [<span class="tactic">discriminate</span>|<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">MonadInv</span>]<br/>
&nbsp;&nbsp;| [ <span class="id">H</span>: <span class="kwd">match</span> ?<span class="id">x</span> <span class="kwd">with</span> <span class="id">true</span> =&gt; <span class="id">_</span> | <span class="id">false</span> =&gt; <span class="id">None</span> <span class="kwd">end</span> = <span class="id">Some</span> <span class="id">_</span> |- <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span> <span class="kwd">as</span> [] <span class="id">eqn</span>:? ; [<span class="id">MonadInv</span>|<span class="tactic">discriminate</span>]<br/>
&nbsp;&nbsp;| [ <span class="id">H</span>: <span class="kwd">match</span> ?<span class="id">x</span> <span class="kwd">with</span> (<span class="id">_</span>, <span class="id">_</span>) =&gt; <span class="id">_</span> <span class="kwd">end</span> = <span class="id">Some</span> <span class="id">_</span> |- <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span> <span class="kwd">as</span> [] <span class="id">eqn</span>:? ; <span class="id">MonadInv</span><br/>
&nbsp;&nbsp;| [ <span class="id">H</span>: <span class="id">Some</span> <span class="id">_</span> = <span class="id">Some</span> <span class="id">_</span> |- <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="id">MonadInv</span><br/>
&nbsp;&nbsp;| [ <span class="id">H</span>: <span class="id">None</span> = <span class="id">Some</span> <span class="id">_</span> |- <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">discriminate</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">idtac</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Remark</span> <span class="id">expand_moves_cons</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">accu</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;<span class="id">expand_moves</span> (<span class="id">rev</span> (<span class="id">m</span> :: <span class="id">accu</span>)) <span class="id">b</span> = <span class="id">expand_moves</span> (<span class="id">rev</span> <span class="id">accu</span>) (<span class="id">expand_move</span> <span class="id">m</span> :: <span class="id">b</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3470')">Proof.</div>
<div class="proofscript" id="proof3470">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">expand_moves</span>; <span class="tactic">intros</span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">map_app</span>. <span class="tactic">rewrite</span> <span class="id">app_ass</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">extract_moves_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">mv</span> <span class="id">b</span>',<br/>
&nbsp;&nbsp;<span class="id">extract_moves</span> <span class="id">nil</span> <span class="id">b</span> = (<span class="id">mv</span>, <span class="id">b</span>') -&gt;<br/>
&nbsp;&nbsp;<span class="id">wf_moves</span> <span class="id">mv</span> /\ <span class="id">b</span> = <span class="id">expand_moves</span> <span class="id">mv</span> <span class="id">b</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3471')">Proof.</div>
<div class="proofscript" id="proof3471">
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">BASE</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">accu</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_moves</span> <span class="id">accu</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_moves</span> (<span class="id">List.rev</span> <span class="id">accu</span>) /\ <span class="id">expand_moves</span> (<span class="id">List.rev</span> <span class="id">accu</span>) <span class="id">b</span> = <span class="id">expand_moves</span> (<span class="id">List.rev</span> <span class="id">accu</span>) <span class="id">b</span>).<br/>
&nbsp;&nbsp;&nbsp;{ <span class="tactic">intros</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">unfold</span> <span class="id">wf_moves</span> <span class="kwd">in</span> *; <span class="tactic">rewrite</span> <span class="id">Forall_forall</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">H</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">in_rev</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">auto</span>. }<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">IND</span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">accu</span> <span class="id">mv</span> <span class="id">b</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">extract_moves</span> <span class="id">accu</span> <span class="id">b</span> = (<span class="id">mv</span>, <span class="id">b</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_moves</span> <span class="id">accu</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_moves</span> <span class="id">mv</span> /\ <span class="id">expand_moves</span> (<span class="id">List.rev</span> <span class="id">accu</span>) <span class="id">b</span> = <span class="id">expand_moves</span> <span class="id">mv</span> <span class="id">b</span>').<br/>
&nbsp;&nbsp;{ <span class="tactic">induction</span> <span class="id">b</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">try</span> (<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">apply</span> <span class="id">BASE</span>; <span class="tactic">auto</span>; <span class="tactic">fail</span>).<br/>
&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id">is_move_operation</span> <span class="id">op</span> <span class="id">args</span>) <span class="kwd">as</span> [<span class="id">arg</span>|] <span class="id">eqn</span>:<span class="id">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">is_move_operation_correct</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">A</span> <span class="id">B</span>]; <span class="tactic">subst</span>.<br/>
&nbsp;reg-reg&nbsp;move&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">IHb</span>; <span class="tactic">eauto</span>. <span class="id">constructor</span>; <span class="tactic">auto</span>. <span class="tactic">exact</span> <span class="id">I</span>. <span class="tactic">rewrite</span> <span class="id">expand_moves_cons</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">apply</span> <span class="id">BASE</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;stack-reg&nbsp;move&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">IHb</span>; <span class="tactic">eauto</span>. <span class="id">constructor</span>; <span class="tactic">auto</span>. <span class="tactic">exact</span> <span class="id">I</span>. <span class="tactic">rewrite</span> <span class="id">expand_moves_cons</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;reg-stack&nbsp;move&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">IHb</span>; <span class="tactic">eauto</span>. <span class="id">constructor</span>; <span class="tactic">auto</span>. <span class="tactic">exact</span> <span class="id">I</span>. <span class="tactic">rewrite</span> <span class="id">expand_moves_cons</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id">IND</span>; <span class="tactic">eauto</span>. <span class="id">constructor</span>. <br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">check_succ_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">b</span>, <span class="id">check_succ</span> <span class="id">s</span> <span class="id">b</span> = <span class="id">true</span> -&gt; <span class="id">exists</span> <span class="id">k</span>, <span class="id">b</span> = <span class="id">Lbranch</span> <span class="id">s</span> :: <span class="id">k</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3472')">Proof.</div>
<div class="proofscript" id="proof3472">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">b</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">i</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">peq</span> <span class="id">s</span> <span class="id">s0</span>); <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H</span>. <span class="id">exists</span> <span class="id">b</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Ltac</span> <span class="id">UseParsingLemmas</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [ <span class="id">H</span>: <span class="id">extract_moves</span> <span class="id">nil</span> <span class="id">_</span> = (<span class="id">_</span>, <span class="id">_</span>) |- <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">extract_moves_sound</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span>); <span class="tactic">clear</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="id">UseParsingLemmas</span><br/>
&nbsp;&nbsp;| [ <span class="id">H</span>: <span class="id">check_succ</span> <span class="id">_</span> <span class="id">_</span> = <span class="id">true</span> |- <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> (<span class="tactic">discriminate</span> <span class="id">H</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">check_succ_sound</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span>); <span class="tactic">clear</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="id">UseParsingLemmas</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">idtac</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">pair_instr_block_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">i</span> <span class="id">b</span> <span class="id">bsh</span>,<br/>
&nbsp;&nbsp;<span class="id">pair_instr_block</span> <span class="id">i</span> <span class="id">b</span> = <span class="id">Some</span> <span class="id">bsh</span> -&gt; <span class="id">expand_block_shape</span> <span class="id">bsh</span> <span class="id">i</span> <span class="id">b</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3473')">Proof.</div>
<div class="proofscript" id="proof3473">
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">OP</span>: <span class="kwd">forall</span> <span class="id">op</span> <span class="id">args</span> <span class="id">res</span> <span class="id">s</span> <span class="id">b</span> <span class="id">bsh</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pair_Iop_block</span> <span class="id">op</span> <span class="id">args</span> <span class="id">res</span> <span class="id">s</span> <span class="id">b</span> = <span class="id">Some</span> <span class="id">bsh</span> -&gt; <span class="id">expand_block_shape</span> <span class="id">bsh</span> (<span class="id">Iop</span> <span class="id">op</span> <span class="id">args</span> <span class="id">res</span> <span class="id">s</span>) <span class="id">b</span>).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">pair_Iop_block</span>; <span class="tactic">intros</span>. <span class="id">MonadInv</span>. <span class="tactic">destruct</span> <span class="id">b0</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">MonadInv</span>; <span class="id">UseParsingLemmas</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">i</span>; <span class="id">MonadInv</span>; <span class="id">UseParsingLemmas</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ebs_op</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>. <span class="tactic">eapply</span> <span class="id">ebs_op_dead</span>; <span class="tactic">eauto</span>. }<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">destruct</span> <span class="id">i</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">MonadInv</span>; <span class="id">UseParsingLemmas</span>.<br/>
- <span class="comment">(*&nbsp;nop&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
- <span class="comment">(*&nbsp;op&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">classify_operation</span> <span class="id">o</span> <span class="id">l</span>).<br/>
+ <span class="comment">(*&nbsp;move&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">MonadInv</span>; <span class="id">UseParsingLemmas</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
+ <span class="comment">(*&nbsp;makelong&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Archi.splitlong</span> <span class="id">eqn</span>:<span class="id">SL</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">MonadInv</span>; <span class="id">UseParsingLemmas</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
+ <span class="comment">(*&nbsp;lowlong&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Archi.splitlong</span> <span class="id">eqn</span>:<span class="id">SL</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">MonadInv</span>; <span class="id">UseParsingLemmas</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
+ <span class="comment">(*&nbsp;highlong&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Archi.splitlong</span> <span class="id">eqn</span>:<span class="id">SL</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">MonadInv</span>; <span class="id">UseParsingLemmas</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
+ <span class="comment">(*&nbsp;other&nbsp;ops&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
- <span class="comment">(*&nbsp;load&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">b0</span> <span class="kwd">as</span> [ | [] <span class="id">b0</span>]; <span class="id">MonadInv</span>; <span class="id">UseParsingLemmas</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">chunk_eq</span> <span class="id">m</span> <span class="id">Mint64</span> &amp;&amp; <span class="id">Archi.splitlong</span>) <span class="id">eqn</span>:<span class="id">A</span>; <span class="id">MonadInv</span>; <span class="id">UseParsingLemmas</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">b</span> <span class="kwd">as</span> [ | [] <span class="id">b</span>]; <span class="id">MonadInv</span>; <span class="id">UseParsingLemmas</span>.<br/>
&nbsp;&nbsp;<span class="id">InvBooleans</span>. <span class="tactic">subst</span> <span class="id">m</span>. <span class="tactic">eapply</span> <span class="id">ebs_load2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">InvBooleans</span>. <span class="tactic">subst</span> <span class="id">m</span>. <br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">eq_addressing</span> <span class="id">a</span> <span class="id">addr</span>). <br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H2</span>. <span class="tactic">eapply</span> <span class="id">ebs_load2_1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">option_eq</span> <span class="id">eq_addressing</span> (<span class="id">offset_addressing</span> <span class="id">a</span> 4) (<span class="id">Some</span> <span class="id">addr</span>)).<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H2</span>. <span class="tactic">eapply</span> <span class="id">ebs_load2_2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ebs_load</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="tactic">eapply</span> <span class="id">ebs_load_dead</span>; <span class="tactic">eauto</span>.<br/>
- <span class="comment">(*&nbsp;store&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">b0</span>; <span class="id">MonadInv</span>. <span class="tactic">destruct</span> <span class="id">i</span>; <span class="id">MonadInv</span>; <span class="id">UseParsingLemmas</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">chunk_eq</span> <span class="id">m</span> <span class="id">Mint64</span> &amp;&amp; <span class="id">Archi.splitlong</span>) <span class="id">eqn</span>:<span class="id">A</span>; <span class="id">MonadInv</span>; <span class="id">UseParsingLemmas</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">b</span> <span class="kwd">as</span> [ | [] <span class="id">b</span>]; <span class="id">MonadInv</span>; <span class="id">UseParsingLemmas</span>.<br/>
&nbsp;&nbsp;<span class="id">InvBooleans</span>. <span class="tactic">subst</span> <span class="id">m</span>. <span class="tactic">eapply</span> <span class="id">ebs_store2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ebs_store</span>; <span class="tactic">eauto</span>.<br/>
- <span class="comment">(*&nbsp;call&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">b0</span> <span class="kwd">as</span> [|[] ]; <span class="id">MonadInv</span>; <span class="id">UseParsingLemmas</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
- <span class="comment">(*&nbsp;tailcall&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">b0</span> <span class="kwd">as</span> [|[] ]; <span class="id">MonadInv</span>; <span class="id">UseParsingLemmas</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
- <span class="comment">(*&nbsp;builtin&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">b1</span> <span class="kwd">as</span> [|[] ]; <span class="id">MonadInv</span>; <span class="id">UseParsingLemmas</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
- <span class="comment">(*&nbsp;cond&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">b0</span> <span class="kwd">as</span> [|[]]; <span class="id">MonadInv</span>; <span class="id">UseParsingLemmas</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
- <span class="comment">(*&nbsp;jumptable&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">b0</span> <span class="kwd">as</span> [|[]]; <span class="id">MonadInv</span>; <span class="id">UseParsingLemmas</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
- <span class="comment">(*&nbsp;return&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">b0</span> <span class="kwd">as</span> [|[]]; <span class="id">MonadInv</span>; <span class="id">UseParsingLemmas</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">matching_instr_block</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f1</span> <span class="id">f2</span> <span class="id">pc</span> <span class="id">bsh</span> <span class="id">i</span>,<br/>
&nbsp;&nbsp;(<span class="id">pair_codes</span> <span class="id">f1</span> <span class="id">f2</span>)!<span class="id">pc</span> = <span class="id">Some</span> <span class="id">bsh</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">RTL.fn_code</span> <span class="id">f1</span>)!<span class="id">pc</span> = <span class="id">Some</span> <span class="id">i</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">b</span>, (<span class="id">LTL.fn_code</span> <span class="id">f2</span>)!<span class="id">pc</span> = <span class="id">Some</span> <span class="id">b</span> /\ <span class="id">expand_block_shape</span> <span class="id">bsh</span> <span class="id">i</span> <span class="id">b</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3474')">Proof.</div>
<div class="proofscript" id="proof3474">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">pair_codes</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">rewrite</span> <span class="id">PTree.gcombine</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">auto</span>. <span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">LTL.fn_code</span> <span class="id">f2</span>)!<span class="id">pc</span> <span class="kwd">as</span> [<span class="id">b</span>|].<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">b</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">pair_instr_block_sound</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">discriminate</span>.<br/>
Qed.</div>
<br/>
<h1> Properties of equations </h1>
<br/>
<span class="kwd">Module</span> <span class="id">ESF</span> := <span class="id">FSetFacts.Facts</span>(<span class="id">EqSet</span>).<br/>
<span class="kwd">Module</span> <span class="id">ESP</span> := <span class="id">FSetProperties.Properties</span>(<span class="id">EqSet</span>).<br/>
<span class="kwd">Module</span> <span class="id">ESD</span> := <span class="id">FSetDecide.Decide</span>(<span class="id">EqSet</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">sel_val</span> (<span class="id">k</span>: <span class="id">equation_kind</span>) (<span class="id">v</span>: <span class="id">val</span>) : <span class="id">val</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">k</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Full</span> =&gt; <span class="id">v</span><br/>
&nbsp;&nbsp;| <span class="id">Low</span> =&gt; <span class="id">Val.loword</span> <span class="id">v</span><br/>
&nbsp;&nbsp;| <span class="id">High</span> =&gt; <span class="id">Val.hiword</span> <span class="id">v</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">A set of equations <span class="bracket"><span class="id">e</span></span> is satisfied in a RTL pseudoreg state <span class="bracket"><span class="id">rs</span></span>
  and an LTL location state <span class="bracket"><span class="id">ls</span></span> if, for every equation <span class="bracket"><span class="id">r</span> = <span class="id">l</span> [<span class="id">k</span>]</span> in <span class="bracket"><span class="id">e</span></span>,
  <span class="bracket"><span class="id">sel_val</span> <span class="id">k</span> (<span class="id">rs</span>#<span class="id">r</span>)</span> (the <span class="bracket"><span class="id">k</span></span> fragment of <span class="bracket"><span class="id">r</span></span>'s value in the RTL code)
  is less defined than <span class="bracket"><span class="id">ls</span> <span class="id">l</span></span> (the value of <span class="bracket"><span class="id">l</span></span> in the LTL code). </div>
<br/>
<span class="kwd">Definition</span> <span class="id">satisf</span> (<span class="id">rs</span>: <span class="id">regset</span>) (<span class="id">ls</span>: <span class="id">locset</span>) (<span class="id">e</span>: <span class="id">eqs</span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">q</span>, <span class="id">EqSet.In</span> <span class="id">q</span> <span class="id">e</span> -&gt; <span class="id">Val.lessdef</span> (<span class="id">sel_val</span> (<span class="id">ekind</span> <span class="id">q</span>) <span class="id">rs</span>#(<span class="id">ereg</span> <span class="id">q</span>)) (<span class="id">ls</span> (<span class="id">eloc</span> <span class="id">q</span>)).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">empty_eqs_satisf</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">rs</span> <span class="id">ls</span>, <span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">empty_eqs</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3475')">Proof.</div>
<div class="proofscript" id="proof3475">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">empty_eqs</span>; <span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="id">ESD.fsetdec</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">satisf_incr</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">rs</span> <span class="id">ls</span> (<span class="id">e1</span> <span class="id">e2</span>: <span class="id">eqs</span>),<br/>
&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e2</span> -&gt; <span class="id">EqSet.Subset</span> <span class="id">e1</span> <span class="id">e2</span> -&gt; <span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3476')">Proof.</div>
<div class="proofscript" id="proof3476">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">satisf</span>; <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">H</span>. <span class="id">ESD.fsetdec</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">satisf_undef_reg</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e</span> <span class="id">r</span>,<br/>
&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> (<span class="id">rs</span>#<span class="id">r</span> &lt;- <span class="id">Vundef</span>) <span class="id">ls</span> <span class="id">e</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3477')">Proof.</div>
<div class="proofscript" id="proof3477">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">Regmap.gsspec</span>. <span class="tactic">destruct</span> (<span class="id">peq</span> (<span class="id">ereg</span> <span class="id">q</span>) <span class="id">r</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">ekind</span> <span class="id">q</span>); <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">add_equation_lessdef</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">q</span> <span class="id">e</span>,<br/>
&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> (<span class="id">add_equation</span> <span class="id">q</span> <span class="id">e</span>) -&gt; <span class="id">Val.lessdef</span> (<span class="id">sel_val</span> (<span class="id">ekind</span> <span class="id">q</span>) <span class="id">rs</span>#(<span class="id">ereg</span> <span class="id">q</span>)) (<span class="id">ls</span> (<span class="id">eloc</span> <span class="id">q</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3478')">Proof.</div>
<div class="proofscript" id="proof3478">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">H</span>. <span class="tactic">unfold</span> <span class="id">add_equation</span>. <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id">EqSet.add_1</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">add_equation_satisf</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">q</span> <span class="id">e</span>,<br/>
&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> (<span class="id">add_equation</span> <span class="id">q</span> <span class="id">e</span>) -&gt; <span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3479')">Proof.</div>
<div class="proofscript" id="proof3479">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id">satisf_incr</span>; <span class="tactic">eauto</span>. <span class="tactic">unfold</span> <span class="id">add_equation</span>. <span class="tactic">simpl</span>. <span class="id">ESD.fsetdec</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">add_equations_satisf</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">rl</span> <span class="id">ml</span> <span class="id">e</span> <span class="id">e</span>',<br/>
&nbsp;&nbsp;<span class="id">add_equations</span> <span class="id">rl</span> <span class="id">ml</span> <span class="id">e</span> = <span class="id">Some</span> <span class="id">e</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e</span>' -&gt; <span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3480')">Proof.</div>
<div class="proofscript" id="proof3480">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">rl</span>; <span class="tactic">destruct</span> <span class="id">ml</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="id">MonadInv</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">add_equation_satisf</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">add_equations_lessdef</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">rl</span> <span class="id">ml</span> <span class="id">e</span> <span class="id">e</span>',<br/>
&nbsp;&nbsp;<span class="id">add_equations</span> <span class="id">rl</span> <span class="id">ml</span> <span class="id">e</span> = <span class="id">Some</span> <span class="id">e</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">Val.lessdef_list</span> (<span class="id">rs</span>##<span class="id">rl</span>) (<span class="id">reglist</span> <span class="id">ls</span> <span class="id">ml</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3481')">Proof.</div>
<div class="proofscript" id="proof3481">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">rl</span>; <span class="tactic">destruct</span> <span class="id">ml</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="id">MonadInv</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">add_equation_lessdef</span> <span class="kwd">with</span> (<span class="id">e</span> := <span class="id">e</span>) (<span class="id">q</span> := <span class="id">Eq</span> <span class="id">Full</span> <span class="id">a</span> (<span class="id">R</span> <span class="id">m</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">add_equations_satisf</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">add_equations_args_satisf</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">rl</span> <span class="id">tyl</span> <span class="id">ll</span> <span class="id">e</span> <span class="id">e</span>',<br/>
&nbsp;&nbsp;<span class="id">add_equations_args</span> <span class="id">rl</span> <span class="id">tyl</span> <span class="id">ll</span> <span class="id">e</span> = <span class="id">Some</span> <span class="id">e</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e</span>' -&gt; <span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3482')">Proof.</div>
<div class="proofscript" id="proof3482">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">e</span>'. <span class="id">functional</span> <span class="tactic">induction</span> (<span class="id">add_equations_args</span> <span class="id">rl</span> <span class="id">tyl</span> <span class="id">ll</span> <span class="id">e</span>); <span class="tactic">intros</span>.<br/>
- <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">eapply</span> <span class="id">add_equation_satisf</span>; <span class="tactic">eauto</span>.<br/>
- <span class="tactic">eapply</span> <span class="id">add_equation_satisf</span>. <span class="tactic">eapply</span> <span class="id">add_equation_satisf</span>. <span class="tactic">eauto</span>.<br/>
- <span class="tactic">congruence</span>.<br/>
- <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">val_longofwords_eq</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;<span class="id">Val.has_type</span> <span class="id">v</span> <span class="id">Tlong</span> -&gt; <span class="id">Archi.splitlong</span> = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">Val.longofwords</span> (<span class="id">Val.hiword</span> <span class="id">v</span>) (<span class="id">Val.loword</span> <span class="id">v</span>) = <span class="id">v</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3483')">Proof.</div>
<div class="proofscript" id="proof3483">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">red</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
- <span class="tactic">reflexivity</span>.<br/>
- <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">Int64.ofwords_recompose</span>. <span class="tactic">auto</span>.<br/>
- <span class="tactic">rewrite</span> <span class="id">Archi.splitlong_ptr32</span> <span class="kwd">in</span> <span class="id">H</span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">add_equations_args_lessdef</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">rl</span> <span class="id">tyl</span> <span class="id">ll</span> <span class="id">e</span> <span class="id">e</span>',<br/>
&nbsp;&nbsp;<span class="id">add_equations_args</span> <span class="id">rl</span> <span class="id">tyl</span> <span class="id">ll</span> <span class="id">e</span> = <span class="id">Some</span> <span class="id">e</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">Val.has_type_list</span> (<span class="id">rs</span>##<span class="id">rl</span>) <span class="id">tyl</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">Val.lessdef_list</span> (<span class="id">rs</span>##<span class="id">rl</span>) (<span class="id">map</span> (<span class="kwd">fun</span> <span class="id">p</span> =&gt; <span class="id">Locmap.getpair</span> <span class="id">p</span> <span class="id">ls</span>) <span class="id">ll</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3484')">Proof.</div>
<div class="proofscript" id="proof3484">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">e</span>'. <span class="id">functional</span> <span class="tactic">induction</span> (<span class="id">add_equations_args</span> <span class="id">rl</span> <span class="id">tyl</span> <span class="id">ll</span> <span class="id">e</span>); <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
- <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">H1</span>. <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">add_equation_lessdef</span> <span class="kwd">with</span> (<span class="id">q</span> := <span class="id">Eq</span> <span class="id">Full</span> <span class="id">r1</span> <span class="id">l1</span>). <span class="tactic">eapply</span> <span class="id">add_equations_args_satisf</span>; <span class="tactic">eauto</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">H1</span>. <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">val_longofwords_eq</span> (<span class="id">rs</span>#<span class="id">r1</span>)) <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">Val.longofwords_lessdef</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">add_equation_lessdef</span> <span class="kwd">with</span> (<span class="id">q</span> := <span class="id">Eq</span> <span class="id">High</span> <span class="id">r1</span> <span class="id">l1</span>).<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">add_equation_satisf</span>. <span class="tactic">eapply</span> <span class="id">add_equations_args_satisf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">add_equation_lessdef</span> <span class="kwd">with</span> (<span class="id">q</span> := <span class="id">Eq</span> <span class="id">Low</span> <span class="id">r1</span> <span class="id">l2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">add_equations_args_satisf</span>; <span class="tactic">eauto</span>.<br/>
- <span class="tactic">discriminate</span>.<br/>
- <span class="tactic">discriminate</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">add_equation_ros_satisf</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">ros</span> <span class="id">mos</span> <span class="id">e</span> <span class="id">e</span>',<br/>
&nbsp;&nbsp;<span class="id">add_equation_ros</span> <span class="id">ros</span> <span class="id">mos</span> <span class="id">e</span> = <span class="id">Some</span> <span class="id">e</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e</span>' -&gt; <span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3485')">Proof.</div>
<div class="proofscript" id="proof3485">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">add_equation_ros</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">ros</span>; <span class="tactic">destruct</span> <span class="id">mos</span>; <span class="id">MonadInv</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">add_equation_satisf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">remove_equation_satisf</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">q</span> <span class="id">e</span>,<br/>
&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e</span> -&gt; <span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> (<span class="id">remove_equation</span> <span class="id">q</span> <span class="id">e</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3486')">Proof.</div>
<div class="proofscript" id="proof3486">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id">satisf_incr</span>; <span class="tactic">eauto</span>. <span class="tactic">unfold</span> <span class="id">remove_equation</span>; <span class="tactic">simpl</span>. <span class="id">ESD.fsetdec</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">remove_equation_res_satisf</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">r</span> <span class="id">l</span> <span class="id">e</span> <span class="id">e</span>',<br/>
&nbsp;&nbsp;<span class="id">remove_equations_res</span> <span class="id">r</span> <span class="id">l</span> <span class="id">e</span> = <span class="id">Some</span> <span class="id">e</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e</span> -&gt; <span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3487')">Proof.</div>
<div class="proofscript" id="proof3487">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">functional</span> <span class="tactic">inversion</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">remove_equation_satisf</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">remove_equation_satisf</span>. <span class="tactic">apply</span> <span class="id">remove_equation_satisf</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id">select_reg_l_monotone</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r</span> <span class="id">q1</span> <span class="id">q2</span>,<br/>
&nbsp;&nbsp;<span class="id">OrderedEquation.eq</span> <span class="id">q1</span> <span class="id">q2</span> \/ <span class="id">OrderedEquation.lt</span> <span class="id">q1</span> <span class="id">q2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">select_reg_l</span> <span class="id">r</span> <span class="id">q1</span> = <span class="id">true</span> -&gt; <span class="id">select_reg_l</span> <span class="id">r</span> <span class="id">q2</span> = <span class="id">true</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3488')">Proof.</div>
<div class="proofscript" id="proof3488">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">select_reg_l</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">red</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Pos.leb_le</span> <span class="kwd">in</span> *. <span class="tactic">red</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">A</span> | [<span class="id">A</span> <span class="id">B</span>]].<br/>
&nbsp;&nbsp;<span class="tactic">red</span> <span class="kwd">in</span> <span class="id">A</span>. <span class="id">zify</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">A</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id">select_reg_h_monotone</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r</span> <span class="id">q1</span> <span class="id">q2</span>,<br/>
&nbsp;&nbsp;<span class="id">OrderedEquation.eq</span> <span class="id">q1</span> <span class="id">q2</span> \/ <span class="id">OrderedEquation.lt</span> <span class="id">q2</span> <span class="id">q1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">select_reg_h</span> <span class="id">r</span> <span class="id">q1</span> = <span class="id">true</span> -&gt; <span class="id">select_reg_h</span> <span class="id">r</span> <span class="id">q2</span> = <span class="id">true</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3489')">Proof.</div>
<div class="proofscript" id="proof3489">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">select_reg_h</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">red</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Pos.leb_le</span> <span class="kwd">in</span> *. <span class="tactic">red</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">A</span> | [<span class="id">A</span> <span class="id">B</span>]].<br/>
&nbsp;&nbsp;<span class="tactic">red</span> <span class="kwd">in</span> <span class="id">A</span>. <span class="id">zify</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">A</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id">select_reg_charact</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r</span> <span class="id">q</span>, <span class="id">select_reg_l</span> <span class="id">r</span> <span class="id">q</span> = <span class="id">true</span> /\ <span class="id">select_reg_h</span> <span class="id">r</span> <span class="id">q</span> = <span class="id">true</span> &lt;-&gt; <span class="id">ereg</span> <span class="id">q</span> = <span class="id">r</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3490')">Proof.</div>
<div class="proofscript" id="proof3490">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">select_reg_l</span>, <span class="id">select_reg_h</span>; <span class="tactic">intros</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> ! <span class="id">Pos.leb_le</span>. <span class="tactic">unfold</span> <span class="id">reg</span>; <span class="id">zify</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">H</span>. <span class="tactic">rewrite</span> ! <span class="id">Pos.leb_refl</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">reg_unconstrained_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r</span> <span class="id">e</span> <span class="id">q</span>,<br/>
&nbsp;&nbsp;<span class="id">reg_unconstrained</span> <span class="id">r</span> <span class="id">e</span> = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">EqSet.In</span> <span class="id">q</span> <span class="id">e</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">ereg</span> <span class="id">q</span> &lt;&gt; <span class="id">r</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3491')">Proof.</div>
<div class="proofscript" id="proof3491">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">reg_unconstrained</span>; <span class="tactic">intros</span>. <span class="tactic">red</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">select_reg_charact</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">EqSet.mem_between</span> (<span class="id">select_reg_l</span> <span class="id">r</span>) (<span class="id">select_reg_h</span> <span class="id">r</span>) <span class="id">e</span> = <span class="id">true</span>).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">EqSet.mem_between_2</span> <span class="kwd">with</span> <span class="id">q</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> (<span class="id">select_reg_l_monotone</span> <span class="id">r</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> (<span class="id">select_reg_h_monotone</span> <span class="id">r</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">discriminate</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">reg_unconstrained_satisf</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r</span> <span class="id">e</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;<span class="id">reg_unconstrained</span> <span class="id">r</span> <span class="id">e</span> = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> (<span class="id">rs</span>#<span class="id">r</span> &lt;- <span class="id">v</span>) <span class="id">ls</span> <span class="id">e</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3492')">Proof.</div>
<div class="proofscript" id="proof3492">
&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">PMap.gso</span>. <span class="tactic">auto</span>. <span class="tactic">eapply</span> <span class="id">reg_unconstrained_sound</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id">select_loc_l_monotone</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l</span> <span class="id">q1</span> <span class="id">q2</span>,<br/>
&nbsp;&nbsp;<span class="id">OrderedEquation</span>'.<span class="id">eq</span> <span class="id">q1</span> <span class="id">q2</span> \/ <span class="id">OrderedEquation</span>'.<span class="id">lt</span> <span class="id">q1</span> <span class="id">q2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">select_loc_l</span> <span class="id">l</span> <span class="id">q1</span> = <span class="id">true</span> -&gt; <span class="id">select_loc_l</span> <span class="id">l</span> <span class="id">q2</span> = <span class="id">true</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3493')">Proof.</div>
<div class="proofscript" id="proof3493">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">select_loc_l</span>; <span class="tactic">intros</span>. <span class="tactic">set</span> (<span class="id">lb</span> := <span class="id">OrderedLoc.diff_low_bound</span> <span class="id">l</span>) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">red</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">subst</span> <span class="id">q2</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">eloc</span> <span class="id">q1</span> = <span class="id">eloc</span> <span class="id">q2</span> \/ <span class="id">OrderedLoc.lt</span> (<span class="id">eloc</span> <span class="id">q1</span>) (<span class="id">eloc</span> <span class="id">q2</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H1</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">OrderedLoc.compare</span> (<span class="id">eloc</span> <span class="id">q2</span>) <span class="id">lb</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">OrderedLoc.lt</span> (<span class="id">eloc</span> <span class="id">q1</span>) <span class="id">lb</span>) <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id">OrderedLoc.lt_trans</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">OrderedLoc.compare</span> (<span class="id">eloc</span> <span class="id">q1</span>) <span class="id">lb</span>).<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">eelim</span> <span class="id">OrderedLoc.lt_not_eq</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">eelim</span> <span class="id">OrderedLoc.lt_not_eq</span>. <span class="tactic">eapply</span> <span class="id">OrderedLoc.lt_trans</span>. <span class="id">eexact</span> <span class="id">l1</span>. <span class="id">eexact</span> <span class="id">H2</span>. <span class="tactic">red</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id">select_loc_h_monotone</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l</span> <span class="id">q1</span> <span class="id">q2</span>,<br/>
&nbsp;&nbsp;<span class="id">OrderedEquation</span>'.<span class="id">eq</span> <span class="id">q1</span> <span class="id">q2</span> \/ <span class="id">OrderedEquation</span>'.<span class="id">lt</span> <span class="id">q2</span> <span class="id">q1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">select_loc_h</span> <span class="id">l</span> <span class="id">q1</span> = <span class="id">true</span> -&gt; <span class="id">select_loc_h</span> <span class="id">l</span> <span class="id">q2</span> = <span class="id">true</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3494')">Proof.</div>
<div class="proofscript" id="proof3494">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">select_loc_h</span>; <span class="tactic">intros</span>. <span class="tactic">set</span> (<span class="id">lb</span> := <span class="id">OrderedLoc.diff_high_bound</span> <span class="id">l</span>) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">red</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">subst</span> <span class="id">q2</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">eloc</span> <span class="id">q2</span> = <span class="id">eloc</span> <span class="id">q1</span> \/ <span class="id">OrderedLoc.lt</span> (<span class="id">eloc</span> <span class="id">q2</span>) (<span class="id">eloc</span> <span class="id">q1</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span>. <span class="tactic">rewrite</span> <span class="id">H1</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">OrderedLoc.compare</span> (<span class="id">eloc</span> <span class="id">q2</span>) <span class="id">lb</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">OrderedLoc.lt</span> <span class="id">lb</span> (<span class="id">eloc</span> <span class="id">q1</span>)) <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id">OrderedLoc.lt_trans</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">OrderedLoc.compare</span> (<span class="id">eloc</span> <span class="id">q1</span>) <span class="id">lb</span>).<br/>
&nbsp;&nbsp;<span class="id">eelim</span> <span class="id">OrderedLoc.lt_not_eq</span>. <span class="tactic">eapply</span> <span class="id">OrderedLoc.lt_trans</span>. <span class="id">eexact</span> <span class="id">l1</span>. <span class="id">eexact</span> <span class="id">H2</span>. <span class="tactic">red</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">eelim</span> <span class="id">OrderedLoc.lt_not_eq</span>. <span class="id">eexact</span> <span class="id">H2</span>. <span class="tactic">apply</span> <span class="id">OrderedLoc.eq_sym</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id">select_loc_charact</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l</span> <span class="id">q</span>,<br/>
&nbsp;&nbsp;<span class="id">select_loc_l</span> <span class="id">l</span> <span class="id">q</span> = <span class="id">false</span> \/ <span class="id">select_loc_h</span> <span class="id">l</span> <span class="id">q</span> = <span class="id">false</span> &lt;-&gt; <span class="id">Loc.diff</span> <span class="id">l</span> (<span class="id">eloc</span> <span class="id">q</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3495')">Proof.</div>
<div class="proofscript" id="proof3495">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">select_loc_l</span>, <span class="id">select_loc_h</span>; <span class="tactic">intros</span>; <span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">OrderedLoc.outside_interval_diff</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">left</span>. <span class="tactic">destruct</span> (<span class="id">OrderedLoc.compare</span> (<span class="id">eloc</span> <span class="id">q</span>) (<span class="id">OrderedLoc.diff_low_bound</span> <span class="id">l</span>)); <span class="tactic">assumption</span> || <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id">right</span>. <span class="tactic">destruct</span> (<span class="id">OrderedLoc.compare</span> (<span class="id">eloc</span> <span class="id">q</span>) (<span class="id">OrderedLoc.diff_high_bound</span> <span class="id">l</span>)); <span class="tactic">assumption</span> || <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">OrderedLoc.diff_outside_interval</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">A</span> | <span class="id">A</span>].<br/>
&nbsp;&nbsp;<span class="id">left</span>. <span class="tactic">destruct</span> (<span class="id">OrderedLoc.compare</span> (<span class="id">eloc</span> <span class="id">q</span>) (<span class="id">OrderedLoc.diff_low_bound</span> <span class="id">l</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">eelim</span> <span class="id">OrderedLoc.lt_not_eq</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">eelim</span> <span class="id">OrderedLoc.lt_not_eq</span>. <span class="tactic">eapply</span> <span class="id">OrderedLoc.lt_trans</span>; <span class="tactic">eauto</span>. <span class="tactic">red</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">right</span>. <span class="tactic">destruct</span> (<span class="id">OrderedLoc.compare</span> (<span class="id">eloc</span> <span class="id">q</span>) (<span class="id">OrderedLoc.diff_high_bound</span> <span class="id">l</span>)).<br/>
&nbsp;&nbsp;<span class="id">eelim</span> <span class="id">OrderedLoc.lt_not_eq</span>. <span class="tactic">eapply</span> <span class="id">OrderedLoc.lt_trans</span>; <span class="tactic">eauto</span>. <span class="tactic">red</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">eelim</span> <span class="id">OrderedLoc.lt_not_eq</span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">OrderedLoc.eq_sym</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">loc_unconstrained_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l</span> <span class="id">e</span> <span class="id">q</span>,<br/>
&nbsp;&nbsp;<span class="id">loc_unconstrained</span> <span class="id">l</span> <span class="id">e</span> = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">EqSet.In</span> <span class="id">q</span> <span class="id">e</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">Loc.diff</span> <span class="id">l</span> (<span class="id">eloc</span> <span class="id">q</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3496')">Proof.</div>
<div class="proofscript" id="proof3496">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">loc_unconstrained</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">select_loc_l</span> <span class="id">l</span> <span class="id">q</span>) <span class="id">eqn</span>:<span class="id">SL</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">select_loc_h</span> <span class="id">l</span> <span class="id">q</span>) <span class="id">eqn</span>:<span class="id">SH</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">EqSet2.mem_between</span> (<span class="id">select_loc_l</span> <span class="id">l</span>) (<span class="id">select_loc_h</span> <span class="id">l</span>) (<span class="id">eqs2</span> <span class="id">e</span>) = <span class="id">true</span>).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">EqSet2.mem_between_2</span> <span class="kwd">with</span> <span class="id">q</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> (<span class="id">select_loc_l_monotone</span> <span class="id">l</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> (<span class="id">select_loc_h_monotone</span> <span class="id">l</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">eqs_same</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">select_loc_charact</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">select_loc_charact</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">loc_unconstrained_satisf</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">k</span> <span class="id">r</span> <span class="id">mr</span> <span class="id">e</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">l</span> := <span class="id">R</span> <span class="id">mr</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> (<span class="id">remove_equation</span> (<span class="id">Eq</span> <span class="id">k</span> <span class="id">r</span> <span class="id">l</span>) <span class="id">e</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">loc_unconstrained</span> (<span class="id">R</span> <span class="id">mr</span>) (<span class="id">remove_equation</span> (<span class="id">Eq</span> <span class="id">k</span> <span class="id">r</span> <span class="id">l</span>) <span class="id">e</span>) = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">Val.lessdef</span> (<span class="id">sel_val</span> <span class="id">k</span> <span class="id">rs</span>#<span class="id">r</span>) <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> (<span class="id">Locmap.set</span> <span class="id">l</span> <span class="id">v</span> <span class="id">ls</span>) <span class="id">e</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3497')">Proof.</div>
<div class="proofscript" id="proof3497">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">OrderedEquation.eq_dec</span> <span class="id">q</span> (<span class="id">Eq</span> <span class="id">k</span> <span class="id">r</span> <span class="id">l</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">q</span>; <span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id">l</span>; <span class="tactic">rewrite</span> <span class="id">Locmap.gss</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">EqSet.In</span> <span class="id">q</span> (<span class="id">remove_equation</span> (<span class="id">Eq</span> <span class="id">k</span> <span class="id">r</span> <span class="id">l</span>) <span class="id">e</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">ESD.fsetdec</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Locmap.gso</span>. <span class="tactic">apply</span> <span class="id">H</span>; <span class="tactic">auto</span>. <span class="tactic">eapply</span> <span class="id">loc_unconstrained_sound</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">reg_loc_unconstrained_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r</span> <span class="id">l</span> <span class="id">e</span> <span class="id">q</span>,<br/>
&nbsp;&nbsp;<span class="id">reg_loc_unconstrained</span> <span class="id">r</span> <span class="id">l</span> <span class="id">e</span> = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">EqSet.In</span> <span class="id">q</span> <span class="id">e</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">ereg</span> <span class="id">q</span> &lt;&gt; <span class="id">r</span> /\ <span class="id">Loc.diff</span> <span class="id">l</span> (<span class="id">eloc</span> <span class="id">q</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3498')">Proof.</div>
<div class="proofscript" id="proof3498">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> (<span class="id">andb_prop</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span>).<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">eapply</span> <span class="id">reg_unconstrained_sound</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">loc_unconstrained_sound</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">parallel_assignment_satisf</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">k</span> <span class="id">r</span> <span class="id">mr</span> <span class="id">e</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">v</span> <span class="id">v</span>',<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">l</span> := <span class="id">R</span> <span class="id">mr</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id">Val.lessdef</span> (<span class="id">sel_val</span> <span class="id">k</span> <span class="id">v</span>) <span class="id">v</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">reg_loc_unconstrained</span> <span class="id">r</span> (<span class="id">R</span> <span class="id">mr</span>) (<span class="id">remove_equation</span> (<span class="id">Eq</span> <span class="id">k</span> <span class="id">r</span> <span class="id">l</span>) <span class="id">e</span>) = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> (<span class="id">remove_equation</span> (<span class="id">Eq</span> <span class="id">k</span> <span class="id">r</span> <span class="id">l</span>) <span class="id">e</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> (<span class="id">rs</span>#<span class="id">r</span> &lt;- <span class="id">v</span>) (<span class="id">Locmap.set</span> <span class="id">l</span> <span class="id">v</span>' <span class="id">ls</span>) <span class="id">e</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3499')">Proof.</div>
<div class="proofscript" id="proof3499">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">OrderedEquation.eq_dec</span> <span class="id">q</span> (<span class="id">Eq</span> <span class="id">k</span> <span class="id">r</span> <span class="id">l</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">q</span>; <span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id">l</span>; <span class="tactic">rewrite</span> <span class="id">Regmap.gss</span>; <span class="tactic">rewrite</span> <span class="id">Locmap.gss</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">EqSet.In</span> <span class="id">q</span> (<span class="id">remove_equation</span> {| <span class="id">ekind</span> := <span class="id">k</span>; <span class="id">ereg</span> := <span class="id">r</span>; <span class="id">eloc</span> := <span class="id">l</span> |} <span class="id">e</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">ESD.fsetdec</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">reg_loc_unconstrained_sound</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">A</span> <span class="id">B</span>].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Regmap.gso</span>; <span class="tactic">auto</span>. <span class="tactic">rewrite</span> <span class="id">Locmap.gso</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">parallel_assignment_satisf_2</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">res</span> <span class="id">res</span>' <span class="id">e</span> <span class="id">e</span>' <span class="id">v</span> <span class="id">v</span>',<br/>
&nbsp;&nbsp;<span class="id">remove_equations_res</span> <span class="id">res</span> <span class="id">res</span>' <span class="id">e</span> = <span class="id">Some</span> <span class="id">e</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">reg_unconstrained</span> <span class="id">res</span> <span class="id">e</span>' = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">forallb</span> (<span class="kwd">fun</span> <span class="id">l</span> =&gt; <span class="id">loc_unconstrained</span> <span class="id">l</span> <span class="id">e</span>') (<span class="id">map</span> <span class="id">R</span> (<span class="id">regs_of_rpair</span> <span class="id">res</span>')) = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">Val.lessdef</span> <span class="id">v</span> <span class="id">v</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> (<span class="id">rs</span>#<span class="id">res</span> &lt;- <span class="id">v</span>) (<span class="id">Locmap.setpair</span> <span class="id">res</span>' <span class="id">v</span>' <span class="id">ls</span>) <span class="id">e</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3500')">Proof.</div>
<div class="proofscript" id="proof3500">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">functional</span> <span class="tactic">inversion</span> <span class="id">H</span>.<br/>
- <span class="comment">(*&nbsp;One&nbsp;location&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="id">InvBooleans</span>. <span class="tactic">simpl</span>. <br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">parallel_assignment_satisf</span> <span class="kwd">with</span> <span class="id">Full</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">reg_loc_unconstrained</span>. <span class="tactic">rewrite</span> <span class="id">H1</span>, <span class="id">H4</span>. <span class="tactic">auto</span>.<br/>
- <span class="comment">(*&nbsp;Two&nbsp;32-bit&nbsp;halves&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">e</span>' := <span class="id">remove_equation</span> {| <span class="id">ekind</span> := <span class="id">Low</span>; <span class="id">ereg</span> := <span class="id">res</span>; <span class="id">eloc</span> := <span class="id">R</span> <span class="id">mr2</span> |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">remove_equation</span> {| <span class="id">ekind</span> := <span class="id">High</span>; <span class="id">ereg</span> := <span class="id">res</span>; <span class="id">eloc</span> := <span class="id">R</span> <span class="id">mr1</span> |} <span class="id">e</span>)) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="id">InvBooleans</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">OrderedEquation.eq_dec</span> <span class="id">q</span> (<span class="id">Eq</span> <span class="id">Low</span> <span class="id">res</span> (<span class="id">R</span> <span class="id">mr2</span>))).<br/>
&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">q</span>; <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">Regmap.gss</span>. <span class="tactic">rewrite</span> <span class="id">Locmap.gss</span>. <br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Val.loword_lessdef</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">OrderedEquation.eq_dec</span> <span class="id">q</span> (<span class="id">Eq</span> <span class="id">High</span> <span class="id">res</span> (<span class="id">R</span> <span class="id">mr1</span>))).<br/>
&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">q</span>; <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">Regmap.gss</span>. <span class="tactic">rewrite</span> <span class="id">Locmap.gso</span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">rewrite</span> <span class="id">Locmap.gss</span>. <br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Val.hiword_lessdef</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">EqSet.In</span> <span class="id">q</span> <span class="id">e</span>'). <span class="tactic">unfold</span> <span class="id">e</span>', <span class="id">remove_equation</span>; <span class="tactic">simpl</span>; <span class="id">ESD.fsetdec</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Regmap.gso</span>. <span class="tactic">rewrite</span> ! <span class="id">Locmap.gso</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">loc_unconstrained_sound</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">loc_unconstrained_sound</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">reg_unconstrained_sound</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id">in_elements_between_1</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r1</span> <span class="id">s</span> <span class="id">q</span>,<br/>
&nbsp;&nbsp;<span class="id">EqSet.In</span> <span class="id">q</span> (<span class="id">EqSet.elements_between</span> (<span class="id">select_reg_l</span> <span class="id">r1</span>) (<span class="id">select_reg_h</span> <span class="id">r1</span>) <span class="id">s</span>) &lt;-&gt; <span class="id">EqSet.In</span> <span class="id">q</span> <span class="id">s</span> /\ <span class="id">ereg</span> <span class="id">q</span> = <span class="id">r1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3501')">Proof.</div>
<div class="proofscript" id="proof3501">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">EqSet.elements_between_iff</span>, <span class="id">select_reg_charact</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">exact</span> (<span class="id">select_reg_l_monotone</span> <span class="id">r1</span>). <span class="tactic">exact</span> (<span class="id">select_reg_h_monotone</span> <span class="id">r1</span>).<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">in_subst_reg</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">q</span> (<span class="id">e</span>: <span class="id">eqs</span>),<br/>
&nbsp;&nbsp;<span class="id">EqSet.In</span> <span class="id">q</span> <span class="id">e</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">ereg</span> <span class="id">q</span> = <span class="id">r1</span> /\ <span class="id">EqSet.In</span> (<span class="id">Eq</span> (<span class="id">ekind</span> <span class="id">q</span>) <span class="id">r2</span> (<span class="id">eloc</span> <span class="id">q</span>)) (<span class="id">subst_reg</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">e</span>)<br/>
&nbsp;&nbsp;\/ <span class="id">ereg</span> <span class="id">q</span> &lt;&gt; <span class="id">r1</span> /\ <span class="id">EqSet.In</span> <span class="id">q</span> (<span class="id">subst_reg</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">e</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3502')">Proof.</div>
<div class="proofscript" id="proof3502">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">q</span> <span class="id">e0</span> <span class="id">IN0</span>. <span class="tactic">unfold</span> <span class="id">subst_reg</span>.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">f</span> := <span class="kwd">fun</span> (<span class="id">q</span>: <span class="id">EqSet.elt</span>) <span class="id">e</span> =&gt; <span class="id">add_equation</span> (<span class="id">Eq</span> (<span class="id">ekind</span> <span class="id">q</span>) <span class="id">r2</span> (<span class="id">eloc</span> <span class="id">q</span>)) (<span class="id">remove_equation</span> <span class="id">q</span> <span class="id">e</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">in_elements_between_1</span> <span class="id">r1</span> <span class="id">e0</span>).<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">elt</span> := <span class="id">EqSet.elements_between</span> (<span class="id">select_reg_l</span> <span class="id">r1</span>) (<span class="id">select_reg_h</span> <span class="id">r1</span>) <span class="id">e0</span>).<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">IN_ELT</span>.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">P</span> := <span class="kwd">fun</span> <span class="id">e1</span> <span class="id">e2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">EqSet.In</span> <span class="id">q</span> <span class="id">e1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">EqSet.In</span> (<span class="id">Eq</span> (<span class="id">ekind</span> <span class="id">q</span>) <span class="id">r2</span> (<span class="id">eloc</span> <span class="id">q</span>)) <span class="id">e2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">P</span> <span class="id">elt</span> (<span class="id">EqSet.fold</span> <span class="id">f</span> <span class="id">elt</span> <span class="id">e0</span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">ESP.fold_rec</span>; <span class="tactic">unfold</span> <span class="id">P</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">ESD.fsetdec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="tactic">red</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">apply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="tactic">destruct</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">subst</span> <span class="id">x</span>. <span class="id">ESD.fsetdec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">ESF.add_iff</span>. <span class="tactic">rewrite</span> <span class="id">ESF.remove_iff</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">OrderedEquation.eq_dec</span> <span class="id">x</span> {| <span class="id">ekind</span> := <span class="id">ekind</span> <span class="id">q</span>; <span class="id">ereg</span> := <span class="id">r2</span>; <span class="id">eloc</span> := <span class="id">eloc</span> <span class="id">q</span> |}); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>. <span class="tactic">subst</span> <span class="id">x</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">Q</span> := <span class="kwd">fun</span> <span class="id">e1</span> <span class="id">e2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~<span class="id">EqSet.In</span> <span class="id">q</span> <span class="id">e1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">EqSet.In</span> <span class="id">q</span> <span class="id">e2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Q</span> <span class="id">elt</span> (<span class="id">EqSet.fold</span> <span class="id">f</span> <span class="id">elt</span> <span class="id">e0</span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">ESP.fold_rec</span>; <span class="tactic">unfold</span> <span class="id">Q</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="tactic">red</span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H4</span>. <span class="id">ESD.fsetdec</span>. <br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">ESP.In_dec</span> <span class="id">q</span> <span class="id">elt</span>).<br/>
&nbsp;&nbsp;<span class="id">left</span>. <span class="tactic">split</span>. <span class="tactic">apply</span> <span class="id">IN_ELT</span>. <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">H</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">right</span>. <span class="tactic">split</span>. <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">elim</span> <span class="id">n</span>. <span class="tactic">rewrite</span> <span class="id">IN_ELT</span>. <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">H0</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">subst_reg_satisf</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">src</span> <span class="id">dst</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e</span>,<br/>
&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> (<span class="id">subst_reg</span> <span class="id">dst</span> <span class="id">src</span> <span class="id">e</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> (<span class="id">rs</span>#<span class="id">dst</span> &lt;- (<span class="id">rs</span>#<span class="id">src</span>)) <span class="id">ls</span> <span class="id">e</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3503')">Proof.</div>
<div class="proofscript" id="proof3503">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">in_subst_reg</span> <span class="id">dst</span> <span class="id">src</span> <span class="id">q</span> <span class="id">e</span> <span class="id">H0</span>) <span class="kwd">as</span> [[<span class="id">A</span> <span class="id">B</span>] | [<span class="id">A</span> <span class="id">B</span>]].<br/>
&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">dst</span>. <span class="tactic">rewrite</span> <span class="id">Regmap.gss</span>. <span class="id">exploit</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Regmap.gso</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">in_subst_reg_kind</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r1</span> <span class="id">k1</span> <span class="id">r2</span> <span class="id">k2</span> <span class="id">q</span> (<span class="id">e</span>: <span class="id">eqs</span>),<br/>
&nbsp;&nbsp;<span class="id">EqSet.In</span> <span class="id">q</span> <span class="id">e</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">ereg</span> <span class="id">q</span>, <span class="id">ekind</span> <span class="id">q</span>) = (<span class="id">r1</span>, <span class="id">k1</span>) /\ <span class="id">EqSet.In</span> (<span class="id">Eq</span> <span class="id">k2</span> <span class="id">r2</span> (<span class="id">eloc</span> <span class="id">q</span>)) (<span class="id">subst_reg_kind</span> <span class="id">r1</span> <span class="id">k1</span> <span class="id">r2</span> <span class="id">k2</span> <span class="id">e</span>)<br/>
&nbsp;&nbsp;\/ <span class="id">EqSet.In</span> <span class="id">q</span> (<span class="id">subst_reg_kind</span> <span class="id">r1</span> <span class="id">k1</span> <span class="id">r2</span> <span class="id">k2</span> <span class="id">e</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3504')">Proof.</div>
<div class="proofscript" id="proof3504">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">r1</span> <span class="id">k1</span> <span class="id">r2</span> <span class="id">k2</span> <span class="id">q</span> <span class="id">e0</span> <span class="id">IN0</span>. <span class="tactic">unfold</span> <span class="id">subst_reg</span>.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">f</span> := <span class="kwd">fun</span> (<span class="id">q</span>: <span class="id">EqSet.elt</span>) <span class="id">e</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">IndexedEqKind.eq</span> (<span class="id">ekind</span> <span class="id">q</span>) <span class="id">k1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id">add_equation</span> (<span class="id">Eq</span> <span class="id">k2</span> <span class="id">r2</span> (<span class="id">eloc</span> <span class="id">q</span>)) (<span class="id">remove_equation</span> <span class="id">q</span> <span class="id">e</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">e</span>).<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">in_elements_between_1</span> <span class="id">r1</span> <span class="id">e0</span>).<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">elt</span> := <span class="id">EqSet.elements_between</span> (<span class="id">select_reg_l</span> <span class="id">r1</span>) (<span class="id">select_reg_h</span> <span class="id">r1</span>) <span class="id">e0</span>).<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">IN_ELT</span>.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">P</span> := <span class="kwd">fun</span> <span class="id">e1</span> <span class="id">e2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">EqSet.In</span> <span class="id">q</span> <span class="id">e1</span> -&gt; <span class="id">ekind</span> <span class="id">q</span> = <span class="id">k1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">EqSet.In</span> (<span class="id">Eq</span> <span class="id">k2</span> <span class="id">r2</span> (<span class="id">eloc</span> <span class="id">q</span>)) <span class="id">e2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">P</span> <span class="id">elt</span> (<span class="id">EqSet.fold</span> <span class="id">f</span> <span class="id">elt</span> <span class="id">e0</span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id">ESP.fold_rec</span>; <span class="tactic">unfold</span> <span class="id">P</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">ESD.fsetdec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="tactic">red</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">apply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="tactic">destruct</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">subst</span> <span class="id">x</span>. <span class="tactic">unfold</span> <span class="id">f</span>. <span class="tactic">destruct</span> (<span class="id">IndexedEqKind.eq</span> (<span class="id">ekind</span> <span class="id">q</span>) <span class="id">k1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">ESD.fsetdec</span>. <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">unfold</span> <span class="id">f</span>. <span class="tactic">destruct</span> (<span class="id">IndexedEqKind.eq</span> (<span class="id">ekind</span> <span class="id">x</span>) <span class="id">k1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">ESF.add_iff</span>. <span class="tactic">rewrite</span> <span class="id">ESF.remove_iff</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">OrderedEquation.eq_dec</span> <span class="id">x</span> {| <span class="id">ekind</span> := <span class="id">k2</span>; <span class="id">ereg</span> := <span class="id">r2</span>; <span class="id">eloc</span> := <span class="id">eloc</span> <span class="id">q</span> |}); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>. <span class="tactic">subst</span> <span class="id">x</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">Q</span> := <span class="kwd">fun</span> <span class="id">e1</span> <span class="id">e2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~<span class="id">EqSet.In</span> <span class="id">q</span> <span class="id">e1</span> \/ <span class="id">ekind</span> <span class="id">q</span> &lt;&gt; <span class="id">k1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">EqSet.In</span> <span class="id">q</span> <span class="id">e2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Q</span> <span class="id">elt</span> (<span class="id">EqSet.fold</span> <span class="id">f</span> <span class="id">elt</span> <span class="id">e0</span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">ESP.fold_rec</span>; <span class="tactic">unfold</span> <span class="id">Q</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">f</span>. <span class="tactic">red</span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">IndexedEqKind.eq</span> (<span class="id">ekind</span> <span class="id">x</span>) <span class="id">k1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">ESF.add_iff</span>. <span class="tactic">rewrite</span> <span class="id">ESF.remove_iff</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>. <span class="tactic">split</span>. <span class="tactic">apply</span> <span class="id">H3</span>. <span class="tactic">tauto</span>. <span class="tactic">intuition</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H3</span>. <span class="tactic">intuition</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">ESP.In_dec</span> <span class="id">q</span> <span class="id">elt</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">IndexedEqKind.eq</span> (<span class="id">ekind</span> <span class="id">q</span>) <span class="id">k1</span>).<br/>
&nbsp;&nbsp;<span class="id">left</span>. <span class="tactic">split</span>. <span class="tactic">f_equal</span>. <span class="tactic">apply</span> <span class="id">IN_ELT</span>. <span class="tactic">auto</span>. <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">H</span>. <span class="tactic">auto</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">right</span>. <span class="tactic">apply</span> <span class="id">H0</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">right</span>. <span class="tactic">apply</span> <span class="id">H0</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">subst_reg_kind_satisf_makelong</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">src1</span> <span class="id">src2</span> <span class="id">dst</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e</span>,<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">e1</span> := <span class="id">subst_reg_kind</span> <span class="id">dst</span> <span class="id">High</span> <span class="id">src1</span> <span class="id">Full</span> <span class="id">e</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">e2</span> := <span class="id">subst_reg_kind</span> <span class="id">dst</span> <span class="id">Low</span> <span class="id">src2</span> <span class="id">Full</span> <span class="id">e1</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id">reg_unconstrained</span> <span class="id">dst</span> <span class="id">e2</span> = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> (<span class="id">rs</span>#<span class="id">dst</span> &lt;- (<span class="id">Val.longofwords</span> <span class="id">rs</span>#<span class="id">src1</span> <span class="id">rs</span>#<span class="id">src2</span>)) <span class="id">ls</span> <span class="id">e</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3505')">Proof.</div>
<div class="proofscript" id="proof3505">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">in_subst_reg_kind</span> <span class="id">dst</span> <span class="id">High</span> <span class="id">src1</span> <span class="id">Full</span> <span class="id">q</span> <span class="id">e</span> <span class="id">H1</span>) <span class="kwd">as</span> [[<span class="id">A</span> <span class="id">B</span>] | <span class="id">B</span>]; <span class="id">fold</span> <span class="id">e1</span> <span class="kwd">in</span> <span class="id">B</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">in_subst_reg_kind</span> <span class="id">dst</span> <span class="id">Low</span> <span class="id">src2</span> <span class="id">Full</span> <span class="id">_</span> <span class="id">e1</span> <span class="id">B</span>) <span class="kwd">as</span> [[<span class="id">C</span> <span class="id">D</span>] | <span class="id">D</span>]; <span class="id">fold</span> <span class="id">e2</span> <span class="kwd">in</span> <span class="id">D</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">C</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">D</span>. <span class="id">inv</span> <span class="id">C</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">A</span>. <span class="tactic">rewrite</span> <span class="id">H3</span>; <span class="tactic">rewrite</span> <span class="id">H4</span>. <span class="tactic">rewrite</span> <span class="id">Regmap.gss</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Val.lessdef_trans</span> <span class="kwd">with</span> (<span class="id">rs</span>#<span class="id">src1</span>).<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">destruct</span> (<span class="id">rs</span>#<span class="id">src1</span>); <span class="tactic">simpl</span>; <span class="tactic">auto</span>. <span class="tactic">destruct</span> (<span class="id">rs</span>#<span class="id">src2</span>); <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Int64.hi_ofwords</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">H0</span>. <span class="id">eexact</span> <span class="id">D</span>. <span class="tactic">simpl</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">in_subst_reg_kind</span> <span class="id">dst</span> <span class="id">Low</span> <span class="id">src2</span> <span class="id">Full</span> <span class="id">q</span> <span class="id">e1</span> <span class="id">B</span>) <span class="kwd">as</span> [[<span class="id">C</span> <span class="id">D</span>] | <span class="id">D</span>]; <span class="id">fold</span> <span class="id">e2</span> <span class="kwd">in</span> <span class="id">D</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">C</span>. <span class="tactic">rewrite</span> <span class="id">H3</span>; <span class="tactic">rewrite</span> <span class="id">H4</span>. <span class="tactic">rewrite</span> <span class="id">Regmap.gss</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Val.lessdef_trans</span> <span class="kwd">with</span> (<span class="id">rs</span>#<span class="id">src2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">destruct</span> (<span class="id">rs</span>#<span class="id">src1</span>); <span class="tactic">simpl</span>; <span class="tactic">auto</span>. <span class="tactic">destruct</span> (<span class="id">rs</span>#<span class="id">src2</span>); <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Int64.lo_ofwords</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">H0</span>. <span class="id">eexact</span> <span class="id">D</span>. <span class="tactic">simpl</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Regmap.gso</span>. <span class="tactic">apply</span> <span class="id">H0</span>; <span class="tactic">auto</span>. <span class="tactic">eapply</span> <span class="id">reg_unconstrained_sound</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">subst_reg_kind_satisf_lowlong</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">src</span> <span class="id">dst</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e</span>,<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">e1</span> := <span class="id">subst_reg_kind</span> <span class="id">dst</span> <span class="id">Full</span> <span class="id">src</span> <span class="id">Low</span> <span class="id">e</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id">reg_unconstrained</span> <span class="id">dst</span> <span class="id">e1</span> = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> (<span class="id">rs</span>#<span class="id">dst</span> &lt;- (<span class="id">Val.loword</span> <span class="id">rs</span>#<span class="id">src</span>)) <span class="id">ls</span> <span class="id">e</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3506')">Proof.</div>
<div class="proofscript" id="proof3506">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">in_subst_reg_kind</span> <span class="id">dst</span> <span class="id">Full</span> <span class="id">src</span> <span class="id">Low</span> <span class="id">q</span> <span class="id">e</span> <span class="id">H1</span>) <span class="kwd">as</span> [[<span class="id">A</span> <span class="id">B</span>] | <span class="id">B</span>]; <span class="id">fold</span> <span class="id">e1</span> <span class="kwd">in</span> <span class="id">B</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">A</span>. <span class="tactic">rewrite</span> <span class="id">H3</span>; <span class="tactic">rewrite</span> <span class="id">H4</span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">Regmap.gss</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">H0</span>. <span class="id">eexact</span> <span class="id">B</span>. <span class="tactic">simpl</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Regmap.gso</span>. <span class="tactic">apply</span> <span class="id">H0</span>; <span class="tactic">auto</span>. <span class="tactic">eapply</span> <span class="id">reg_unconstrained_sound</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">subst_reg_kind_satisf_highlong</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">src</span> <span class="id">dst</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e</span>,<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">e1</span> := <span class="id">subst_reg_kind</span> <span class="id">dst</span> <span class="id">Full</span> <span class="id">src</span> <span class="id">High</span> <span class="id">e</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id">reg_unconstrained</span> <span class="id">dst</span> <span class="id">e1</span> = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> (<span class="id">rs</span>#<span class="id">dst</span> &lt;- (<span class="id">Val.hiword</span> <span class="id">rs</span>#<span class="id">src</span>)) <span class="id">ls</span> <span class="id">e</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3507')">Proof.</div>
<div class="proofscript" id="proof3507">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">in_subst_reg_kind</span> <span class="id">dst</span> <span class="id">Full</span> <span class="id">src</span> <span class="id">High</span> <span class="id">q</span> <span class="id">e</span> <span class="id">H1</span>) <span class="kwd">as</span> [[<span class="id">A</span> <span class="id">B</span>] | <span class="id">B</span>]; <span class="id">fold</span> <span class="id">e1</span> <span class="kwd">in</span> <span class="id">B</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">A</span>. <span class="tactic">rewrite</span> <span class="id">H3</span>; <span class="tactic">rewrite</span> <span class="id">H4</span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">Regmap.gss</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">H0</span>. <span class="id">eexact</span> <span class="id">B</span>. <span class="tactic">simpl</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Regmap.gso</span>. <span class="tactic">apply</span> <span class="id">H0</span>; <span class="tactic">auto</span>. <span class="tactic">eapply</span> <span class="id">reg_unconstrained_sound</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Module</span> <span class="id">ESF2</span> := <span class="id">FSetFacts.Facts</span>(<span class="id">EqSet2</span>).<br/>
<span class="kwd">Module</span> <span class="id">ESP2</span> := <span class="id">FSetProperties.Properties</span>(<span class="id">EqSet2</span>).<br/>
<span class="kwd">Module</span> <span class="id">ESD2</span> := <span class="id">FSetDecide.Decide</span>(<span class="id">EqSet2</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">partial_fold_ind</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">A</span>: <span class="kwd">Type</span>) (<span class="id">P</span>: <span class="id">EqSet2.t</span> -&gt; <span class="id">A</span> -&gt; <span class="kwd">Prop</span>) <span class="id">f</span> <span class="id">init</span> <span class="id">final</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;<span class="id">EqSet2.fold</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">q</span> <span class="id">opte</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">opte</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">e</span> =&gt; <span class="id">f</span> <span class="id">q</span> <span class="id">e</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">s</span> (<span class="id">Some</span> <span class="id">init</span>) = <span class="id">Some</span> <span class="id">final</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">s</span>', <span class="id">EqSet2.Empty</span> <span class="id">s</span>' -&gt; <span class="id">P</span> <span class="id">s</span>' <span class="id">init</span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span> <span class="id">a</span>' <span class="id">a</span>'' <span class="id">s</span>' <span class="id">s</span>'',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">EqSet2.In</span> <span class="id">x</span> <span class="id">s</span> -&gt; ~<span class="id">EqSet2.In</span> <span class="id">x</span> <span class="id">s</span>' -&gt; <span class="id">ESP2.Add</span> <span class="id">x</span> <span class="id">s</span>' <span class="id">s</span>'' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f</span> <span class="id">x</span> <span class="id">a</span>' = <span class="id">Some</span> <span class="id">a</span>'' -&gt; <span class="id">P</span> <span class="id">s</span>' <span class="id">a</span>' -&gt; <span class="id">P</span> <span class="id">s</span>'' <span class="id">a</span>'') -&gt;<br/>
&nbsp;&nbsp;<span class="id">P</span> <span class="id">s</span> <span class="id">final</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3508')">Proof.</div>
<div class="proofscript" id="proof3508">
&nbsp;&nbsp;<span class="tactic">intros</span>. <br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">g</span> := <span class="kwd">fun</span> <span class="id">q</span> <span class="id">opte</span> =&gt; <span class="kwd">match</span> <span class="id">opte</span> <span class="kwd">with</span> <span class="id">Some</span> <span class="id">e</span> =&gt; <span class="id">f</span> <span class="id">q</span> <span class="id">e</span> | <span class="id">None</span> =&gt; <span class="id">None</span> <span class="kwd">end</span>) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">Q</span> := <span class="kwd">fun</span> <span class="id">s1</span> <span class="id">opte</span> =&gt; <span class="kwd">match</span> <span class="id">opte</span> <span class="kwd">with</span> <span class="id">None</span> =&gt; <span class="id">True</span> | <span class="id">Some</span> <span class="id">e</span> =&gt; <span class="id">P</span> <span class="id">s1</span> <span class="id">e</span> <span class="kwd">end</span>).<br/>
&nbsp;&nbsp;<span class="id">change</span> (<span class="id">Q</span> <span class="id">s</span> (<span class="id">Some</span> <span class="id">final</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H</span>. <span class="tactic">apply</span> <span class="id">ESP2.fold_rec</span>; <span class="tactic">unfold</span> <span class="id">Q</span>, <span class="id">g</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">a</span> <span class="kwd">as</span> [<span class="id">e</span>|]; <span class="tactic">auto</span>. <span class="tactic">destruct</span> (<span class="id">f</span> <span class="id">x</span> <span class="id">e</span>) <span class="kwd">as</span> [<span class="id">e</span>'|] <span class="id">eqn</span>:<span class="id">F</span>; <span class="tactic">auto</span>. <span class="tactic">eapply</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">in_subst_loc</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l1</span> <span class="id">l2</span> <span class="id">q</span> (<span class="id">e</span> <span class="id">e</span>': <span class="id">eqs</span>),<br/>
&nbsp;&nbsp;<span class="id">EqSet.In</span> <span class="id">q</span> <span class="id">e</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">subst_loc</span> <span class="id">l1</span> <span class="id">l2</span> <span class="id">e</span> = <span class="id">Some</span> <span class="id">e</span>' -&gt;<br/>
&nbsp;&nbsp;(<span class="id">eloc</span> <span class="id">q</span> = <span class="id">l1</span> /\ <span class="id">EqSet.In</span> (<span class="id">Eq</span> (<span class="id">ekind</span> <span class="id">q</span>) (<span class="id">ereg</span> <span class="id">q</span>) <span class="id">l2</span>) <span class="id">e</span>') \/ (<span class="id">Loc.diff</span> <span class="id">l1</span> (<span class="id">eloc</span> <span class="id">q</span>) /\ <span class="id">EqSet.In</span> <span class="id">q</span> <span class="id">e</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3509')">Proof.</div>
<div class="proofscript" id="proof3509">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">subst_loc</span>; <span class="tactic">intros</span> <span class="id">l1</span> <span class="id">l2</span> <span class="id">q</span> <span class="id">e0</span> <span class="id">e0</span>' <span class="id">IN</span> <span class="id">SUBST</span>.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">elt</span> := <span class="id">EqSet2.elements_between</span> (<span class="id">select_loc_l</span> <span class="id">l1</span>) (<span class="id">select_loc_h</span> <span class="id">l1</span>) (<span class="id">eqs2</span> <span class="id">e0</span>)) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">f</span> := <span class="kwd">fun</span> <span class="id">q0</span> <span class="id">e</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">Loc.eq</span> <span class="id">l1</span> (<span class="id">eloc</span> <span class="id">q0</span>) <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Some</span> (<span class="id">add_equation</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{| <span class="id">ekind</span> := <span class="id">ekind</span> <span class="id">q0</span>; <span class="id">ereg</span> := <span class="id">ereg</span> <span class="id">q0</span>; <span class="id">eloc</span> := <span class="id">l2</span> |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">remove_equation</span> <span class="id">q0</span> <span class="id">e</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">None</span>).<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">P</span> := <span class="kwd">fun</span> <span class="id">e1</span> <span class="id">e2</span> =&gt; <span class="id">EqSet2.In</span> <span class="id">q</span> <span class="id">e1</span> -&gt; <span class="id">eloc</span> <span class="id">q</span> = <span class="id">l1</span> /\ <span class="id">EqSet.In</span> (<span class="id">Eq</span> (<span class="id">ekind</span> <span class="id">q</span>) (<span class="id">ereg</span> <span class="id">q</span>) <span class="id">l2</span>) <span class="id">e2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">A</span>: <span class="id">P</span> <span class="id">elt</span> <span class="id">e0</span>').<br/>
&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">partial_fold_ind</span> <span class="kwd">with</span> (<span class="id">f</span> := <span class="id">f</span>) (<span class="id">s</span> := <span class="id">elt</span>) (<span class="id">final</span> := <span class="id">e0</span>'). <span class="id">eexact</span> <span class="id">SUBST</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">P</span>; <span class="tactic">intros</span>. <span class="id">ESD2.fsetdec</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">P</span>, <span class="id">f</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> (<span class="id">Loc.eq</span> <span class="id">l1</span> (<span class="id">eloc</span> <span class="id">x</span>)); <span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">subst</span> <span class="id">a</span>''; <span class="tactic">clear</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">ESF.add_iff</span>, <span class="id">ESF.remove_iff</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H4</span>; <span class="tactic">destruct</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">x</span>; <span class="tactic">rewrite</span> <span class="id">e</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H3</span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">destruct</span> <span class="id">H2</span>. <span class="tactic">split</span>. <span class="tactic">congruence</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">OrderedEquation.eq_dec</span> <span class="id">x</span> {| <span class="id">ekind</span> := <span class="id">ekind</span> <span class="id">q</span>; <span class="id">ereg</span> := <span class="id">ereg</span> <span class="id">q</span>; <span class="id">eloc</span> := <span class="id">l2</span> |}); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">x</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">Q</span> := <span class="kwd">fun</span> <span class="id">e1</span> <span class="id">e2</span> =&gt; ~<span class="id">EqSet2.In</span> <span class="id">q</span> <span class="id">e1</span> -&gt; <span class="id">EqSet.In</span> <span class="id">q</span> <span class="id">e2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">B</span>: <span class="id">Q</span> <span class="id">elt</span> <span class="id">e0</span>').<br/>
&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">partial_fold_ind</span> <span class="kwd">with</span> (<span class="id">f</span> := <span class="id">f</span>) (<span class="id">s</span> := <span class="id">elt</span>) (<span class="id">final</span> := <span class="id">e0</span>'). <span class="id">eexact</span> <span class="id">SUBST</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">Q</span>; <span class="tactic">intros</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">Q</span>, <span class="id">f</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> (<span class="id">Loc.eq</span> <span class="id">l1</span> (<span class="id">eloc</span> <span class="id">x</span>)); <span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">subst</span> <span class="id">a</span>''; <span class="tactic">clear</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">ESF.add_iff</span>, <span class="id">ESF.remove_iff</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H4</span>. <span class="tactic">intuition</span> <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">ESP2.In_dec</span> <span class="id">q</span> <span class="id">elt</span>).<br/>
&nbsp;&nbsp;<span class="id">left</span>. <span class="tactic">apply</span> <span class="id">A</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">right</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">select_loc_charact</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">select_loc_l</span> <span class="id">l1</span> <span class="id">q</span>) <span class="id">eqn</span>: <span class="id">LL</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">select_loc_h</span> <span class="id">l1</span> <span class="id">q</span>) <span class="id">eqn</span>: <span class="id">LH</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">n</span>. <span class="tactic">eapply</span> <span class="id">EqSet2.elements_between_iff</span>.<br/>
&nbsp;&nbsp;<span class="tactic">exact</span> (<span class="id">select_loc_l_monotone</span> <span class="id">l1</span>).<br/>
&nbsp;&nbsp;<span class="tactic">exact</span> (<span class="id">select_loc_h_monotone</span> <span class="id">l1</span>).<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">apply</span> <span class="id">eqs_same</span>; <span class="tactic">auto</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">loc_type_compat_charact</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span> <span class="id">l</span> <span class="id">e</span> <span class="id">q</span>,<br/>
&nbsp;&nbsp;<span class="id">loc_type_compat</span> <span class="id">env</span> <span class="id">l</span> <span class="id">e</span> = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">EqSet.In</span> <span class="id">q</span> <span class="id">e</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">subtype</span> (<span class="id">sel_type</span> (<span class="id">ekind</span> <span class="id">q</span>) (<span class="id">env</span> (<span class="id">ereg</span> <span class="id">q</span>))) (<span class="id">Loc.type</span> <span class="id">l</span>) = <span class="id">true</span> \/ <span class="id">Loc.diff</span> <span class="id">l</span> (<span class="id">eloc</span> <span class="id">q</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3510')">Proof.</div>
<div class="proofscript" id="proof3510">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">loc_type_compat</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">EqSet2.for_all_between_iff</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">select_loc_l</span> <span class="id">l</span> <span class="id">q</span>) <span class="id">eqn</span>: <span class="id">LL</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">select_loc_h</span> <span class="id">l</span> <span class="id">q</span>) <span class="id">eqn</span>: <span class="id">LH</span>.<br/>
&nbsp;&nbsp;<span class="id">left</span>; <span class="tactic">apply</span> <span class="id">H</span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">eqs_same</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">right</span>. <span class="tactic">apply</span> <span class="id">select_loc_charact</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">right</span>. <span class="tactic">apply</span> <span class="id">select_loc_charact</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">subst</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">exact</span> (<span class="id">select_loc_l_monotone</span> <span class="id">l</span>).<br/>
&nbsp;&nbsp;<span class="tactic">exact</span> (<span class="id">select_loc_h_monotone</span> <span class="id">l</span>).<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">well_typed_move_charact</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span> <span class="id">l</span> <span class="id">e</span> <span class="id">k</span> <span class="id">r</span> <span class="id">rs</span>,<br/>
&nbsp;&nbsp;<span class="id">well_typed_move</span> <span class="id">env</span> <span class="id">l</span> <span class="id">e</span> = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">EqSet.In</span> (<span class="id">Eq</span> <span class="id">k</span> <span class="id">r</span> <span class="id">l</span>) <span class="id">e</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">wt_regset</span> <span class="id">env</span> <span class="id">rs</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">l</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">R</span> <span class="id">mr</span> =&gt; <span class="id">True</span><br/>
&nbsp;&nbsp;| <span class="id">S</span> <span class="id">sl</span> <span class="id">ofs</span> <span class="id">ty</span> =&gt; <span class="id">Val.has_type</span> (<span class="id">sel_val</span> <span class="id">k</span> <span class="id">rs</span>#<span class="id">r</span>) <span class="id">ty</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3511')">Proof.</div>
<div class="proofscript" id="proof3511">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">well_typed_move</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span> <span class="kwd">as</span> [<span class="id">mr</span> | <span class="id">sl</span> <span class="id">ofs</span> <span class="id">ty</span>].<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">loc_type_compat_charact</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">A</span> | <span class="id">A</span>].<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">A</span>. <span class="tactic">eapply</span> <span class="id">Val.has_subtype</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">H1</span> <span class="id">r</span>). <span class="tactic">destruct</span> <span class="id">k</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">rs</span>#<span class="id">r</span>); <span class="tactic">exact</span> <span class="id">I</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">rs</span>#<span class="id">r</span>); <span class="tactic">exact</span> <span class="id">I</span>.<br/>
&nbsp;&nbsp;<span class="id">eelim</span> <span class="id">Loc.diff_not_eq</span>. <span class="id">eexact</span> <span class="id">A</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id">val_lessdef_normalize</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">v</span>' <span class="id">ty</span>,<br/>
&nbsp;&nbsp;<span class="id">Val.has_type</span> <span class="id">v</span> <span class="id">ty</span> -&gt; <span class="id">Val.lessdef</span> <span class="id">v</span> <span class="id">v</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">Val.lessdef</span> <span class="id">v</span> (<span class="id">Val.load_result</span> (<span class="id">chunk_of_type</span> <span class="id">ty</span>) <span class="id">v</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3512')">Proof.</div>
<div class="proofscript" id="proof3512">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H0</span>. <span class="tactic">rewrite</span> <span class="id">Val.load_result_same</span>; <span class="tactic">auto</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">subst_loc_satisf</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span> <span class="id">src</span> <span class="id">dst</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e</span> <span class="id">e</span>',<br/>
&nbsp;&nbsp;<span class="id">subst_loc</span> <span class="id">dst</span> <span class="id">src</span> <span class="id">e</span> = <span class="id">Some</span> <span class="id">e</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">well_typed_move</span> <span class="id">env</span> <span class="id">dst</span> <span class="id">e</span> = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">wt_regset</span> <span class="id">env</span> <span class="id">rs</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> (<span class="id">Locmap.set</span> <span class="id">dst</span> (<span class="id">ls</span> <span class="id">src</span>) <span class="id">ls</span>) <span class="id">e</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3513')">Proof.</div>
<div class="proofscript" id="proof3513">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">in_subst_loc</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [[<span class="id">A</span> <span class="id">B</span>] | [<span class="id">A</span> <span class="id">B</span>]].<br/>
&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">dst</span>. <span class="tactic">rewrite</span> <span class="id">Locmap.gss</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">q</span> <span class="kwd">as</span> [<span class="id">k</span> <span class="id">r</span> <span class="id">l</span>]; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">well_typed_move_charact</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span> <span class="kwd">as</span> [<span class="id">mr</span> | <span class="id">sl</span> <span class="id">ofs</span> <span class="id">ty</span>]; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">H2</span> <span class="id">_</span> <span class="id">B</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">val_lessdef_normalize</span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> (<span class="id">H2</span> <span class="id">_</span> <span class="id">B</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Locmap.gso</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">can_undef_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">e</span> <span class="id">ml</span> <span class="id">q</span>,<br/>
&nbsp;&nbsp;<span class="id">can_undef</span> <span class="id">ml</span> <span class="id">e</span> = <span class="id">true</span> -&gt; <span class="id">EqSet.In</span> <span class="id">q</span> <span class="id">e</span> -&gt; <span class="id">Loc.notin</span> (<span class="id">eloc</span> <span class="id">q</span>) (<span class="id">map</span> <span class="id">R</span> <span class="id">ml</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3514')">Proof.</div>
<div class="proofscript" id="proof3514">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">ml</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="id">InvBooleans</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Loc.diff_sym</span>. <span class="tactic">eapply</span> <span class="id">loc_unconstrained_sound</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">undef_regs_outside</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ml</span> <span class="id">ls</span> <span class="id">l</span>,<br/>
&nbsp;&nbsp;<span class="id">Loc.notin</span> <span class="id">l</span> (<span class="id">map</span> <span class="id">R</span> <span class="id">ml</span>) -&gt; <span class="id">undef_regs</span> <span class="id">ml</span> <span class="id">ls</span> <span class="id">l</span> = <span class="id">ls</span> <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3515')">Proof.</div>
<div class="proofscript" id="proof3515">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">ml</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Locmap.gso</span>. <span class="tactic">apply</span> <span class="id">IHml</span>. <span class="tactic">tauto</span>. <span class="tactic">apply</span> <span class="id">Loc.diff_sym</span>. <span class="tactic">tauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">can_undef_satisf</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ml</span> <span class="id">e</span> <span class="id">rs</span> <span class="id">ls</span>,<br/>
&nbsp;&nbsp;<span class="id">can_undef</span> <span class="id">ml</span> <span class="id">e</span> = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> (<span class="id">undef_regs</span> <span class="id">ml</span> <span class="id">ls</span>) <span class="id">e</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3516')">Proof.</div>
<div class="proofscript" id="proof3516">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">undef_regs_outside</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">can_undef_sound</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">can_undef_except_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">lx</span> <span class="id">e</span> <span class="id">ml</span> <span class="id">q</span>,<br/>
&nbsp;&nbsp;<span class="id">can_undef_except</span> <span class="id">lx</span> <span class="id">ml</span> <span class="id">e</span> = <span class="id">true</span> -&gt; <span class="id">EqSet.In</span> <span class="id">q</span> <span class="id">e</span> -&gt; <span class="id">Loc.diff</span> (<span class="id">eloc</span> <span class="id">q</span>) <span class="id">lx</span> -&gt; <span class="id">Loc.notin</span> (<span class="id">eloc</span> <span class="id">q</span>) (<span class="id">map</span> <span class="id">R</span> <span class="id">ml</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3517')">Proof.</div>
<div class="proofscript" id="proof3517">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">ml</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="id">InvBooleans</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">orb_true_elim</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">proj_sumbool_true</span> <span class="kwd">in</span> <span class="id">e0</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Loc.diff_sym</span>. <span class="tactic">eapply</span> <span class="id">loc_unconstrained_sound</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHml</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">subst_loc_undef_satisf</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span> <span class="id">src</span> <span class="id">dst</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">ml</span> <span class="id">e</span> <span class="id">e</span>',<br/>
&nbsp;&nbsp;<span class="id">subst_loc</span> <span class="id">dst</span> <span class="id">src</span> <span class="id">e</span> = <span class="id">Some</span> <span class="id">e</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">well_typed_move</span> <span class="id">env</span> <span class="id">dst</span> <span class="id">e</span> = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">can_undef_except</span> <span class="id">dst</span> <span class="id">ml</span> <span class="id">e</span> = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">wt_regset</span> <span class="id">env</span> <span class="id">rs</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> (<span class="id">Locmap.set</span> <span class="id">dst</span> (<span class="id">ls</span> <span class="id">src</span>) (<span class="id">undef_regs</span> <span class="id">ml</span> <span class="id">ls</span>)) <span class="id">e</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3518')">Proof.</div>
<div class="proofscript" id="proof3518">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">in_subst_loc</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [[<span class="id">A</span> <span class="id">B</span>] | [<span class="id">A</span> <span class="id">B</span>]].<br/>
&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">dst</span>. <span class="tactic">rewrite</span> <span class="id">Locmap.gss</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">q</span> <span class="kwd">as</span> [<span class="id">k</span> <span class="id">r</span> <span class="id">l</span>]; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">well_typed_move_charact</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span> <span class="kwd">as</span> [<span class="id">mr</span> | <span class="id">sl</span> <span class="id">ofs</span> <span class="id">ty</span>]; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">H3</span> <span class="id">_</span> <span class="id">B</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">val_lessdef_normalize</span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> (<span class="id">H3</span> <span class="id">_</span> <span class="id">B</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Locmap.gso</span>; <span class="tactic">auto</span>. <span class="tactic">rewrite</span> <span class="id">undef_regs_outside</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">can_undef_except_sound</span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">Loc.diff_sym</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">transfer_use_def_satisf</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">args</span> <span class="id">res</span> <span class="id">args</span>' <span class="id">res</span>' <span class="id">und</span> <span class="id">e</span> <span class="id">e</span>' <span class="id">rs</span> <span class="id">ls</span>,<br/>
&nbsp;&nbsp;<span class="id">transfer_use_def</span> <span class="id">args</span> <span class="id">res</span> <span class="id">args</span>' <span class="id">res</span>' <span class="id">und</span> <span class="id">e</span> = <span class="id">Some</span> <span class="id">e</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">Val.lessdef_list</span> <span class="id">rs</span>##<span class="id">args</span> (<span class="id">reglist</span> <span class="id">ls</span> <span class="id">args</span>') /\<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">v</span> <span class="id">v</span>', <span class="id">Val.lessdef</span> <span class="id">v</span> <span class="id">v</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">satisf</span> (<span class="id">rs</span>#<span class="id">res</span> &lt;- <span class="id">v</span>) (<span class="id">Locmap.set</span> (<span class="id">R</span> <span class="id">res</span>') <span class="id">v</span>' (<span class="id">undef_regs</span> <span class="id">und</span> <span class="id">ls</span>)) <span class="id">e</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3519')">Proof.</div>
<div class="proofscript" id="proof3519">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">transfer_use_def</span>; <span class="tactic">intros</span>. <span class="id">MonadInv</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">eapply</span> <span class="id">add_equations_lessdef</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id">parallel_assignment_satisf</span>; <span class="tactic">eauto</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">can_undef_satisf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">add_equations_satisf</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">add_equations_res_lessdef</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r</span> <span class="id">oty</span> <span class="id">l</span> <span class="id">e</span> <span class="id">e</span>' <span class="id">rs</span> <span class="id">ls</span>,<br/>
&nbsp;&nbsp;<span class="id">add_equations_res</span> <span class="id">r</span> <span class="id">oty</span> <span class="id">l</span> <span class="id">e</span> = <span class="id">Some</span> <span class="id">e</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">Val.has_type</span> <span class="id">rs</span>#<span class="id">r</span> (<span class="kwd">match</span> <span class="id">oty</span> <span class="kwd">with</span> <span class="id">Some</span> <span class="id">ty</span> =&gt; <span class="id">ty</span> | <span class="id">None</span> =&gt; <span class="id">Tint</span> <span class="kwd">end</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">Val.lessdef</span> <span class="id">rs</span>#<span class="id">r</span> (<span class="id">Locmap.getpair</span> (<span class="id">map_rpair</span> <span class="id">R</span> <span class="id">l</span>) <span class="id">ls</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3520')">Proof.</div>
<div class="proofscript" id="proof3520">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">functional</span> <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">simpl</span>.<br/>
- <span class="tactic">subst</span>. <span class="tactic">eapply</span> <span class="id">add_equation_lessdef</span> <span class="kwd">with</span> (<span class="id">q</span> := <span class="id">Eq</span> <span class="id">Full</span> <span class="id">r</span> (<span class="id">R</span> <span class="id">mr</span>)); <span class="tactic">eauto</span>.<br/>
- <span class="tactic">subst</span>. <span class="tactic">rewrite</span> &lt;- (<span class="id">val_longofwords_eq</span> <span class="id">rs</span>#<span class="id">r</span>) <span class="tactic">by</span> <span class="tactic">auto</span>. <br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Val.longofwords_lessdef</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">add_equation_lessdef</span> <span class="kwd">with</span> (<span class="id">q</span> := <span class="id">Eq</span> <span class="id">High</span> <span class="id">r</span> (<span class="id">R</span> <span class="id">mr1</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">add_equation_satisf</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">add_equation_lessdef</span> <span class="kwd">with</span> (<span class="id">q</span> := <span class="id">Eq</span> <span class="id">Low</span> <span class="id">r</span> (<span class="id">R</span> <span class="id">mr2</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">callee_save_loc</span> (<span class="id">l</span>: <span class="id">loc</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">l</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">R</span> <span class="id">r</span> =&gt; <span class="id">is_callee_save</span> <span class="id">r</span> = <span class="id">true</span><br/>
&nbsp;&nbsp;| <span class="id">S</span> <span class="id">sl</span> <span class="id">ofs</span> <span class="id">ty</span> =&gt; <span class="id">sl</span> &lt;&gt; <span class="id">Outgoing</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">agree_callee_save</span> (<span class="id">ls1</span> <span class="id">ls2</span>: <span class="id">locset</span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l</span>, <span class="id">callee_save_loc</span> <span class="id">l</span> -&gt; <span class="id">ls1</span> <span class="id">l</span> = <span class="id">ls2</span> <span class="id">l</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">return_regs_agree_callee_save</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">caller</span> <span class="id">callee</span>,<br/>
&nbsp;&nbsp;<span class="id">agree_callee_save</span> <span class="id">caller</span> (<span class="id">return_regs</span> <span class="id">caller</span> <span class="id">callee</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3521')">Proof.</div>
<div class="proofscript" id="proof3521">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">return_regs</span>. <span class="tactic">red</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">auto</span>. <br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">sl</span>; <span class="tactic">auto</span> || <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">no_caller_saves_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">e</span> <span class="id">q</span>,<br/>
&nbsp;&nbsp;<span class="id">no_caller_saves</span> <span class="id">e</span> = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">EqSet.In</span> <span class="id">q</span> <span class="id">e</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">callee_save_loc</span> (<span class="id">eloc</span> <span class="id">q</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3522')">Proof.</div>
<div class="proofscript" id="proof3522">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">no_caller_saves</span>, <span class="id">callee_save_loc</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">EqSet.for_all_2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">hnf</span>. <span class="tactic">intros</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">rewrite</span> <span class="id">H1</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">lazy</span> <span class="id">beta</span>. <span class="tactic">destruct</span> (<span class="id">eloc</span> <span class="id">q</span>). <span class="tactic">auto</span>. <span class="tactic">destruct</span> <span class="id">sl</span>; <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">val_hiword_longofwords</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v1</span> <span class="id">v2</span>, <span class="id">Val.lessdef</span> (<span class="id">Val.hiword</span> (<span class="id">Val.longofwords</span> <span class="id">v1</span> <span class="id">v2</span>)) <span class="id">v1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3523')">Proof.</div>
<div class="proofscript" id="proof3523">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">v1</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>. <span class="tactic">destruct</span> <span class="id">v2</span>; <span class="tactic">auto</span>. <span class="tactic">unfold</span> <span class="id">Val.hiword</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Int64.hi_ofwords</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">val_loword_longofwords</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v1</span> <span class="id">v2</span>, <span class="id">Val.lessdef</span> (<span class="id">Val.loword</span> (<span class="id">Val.longofwords</span> <span class="id">v1</span> <span class="id">v2</span>)) <span class="id">v2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3524')">Proof.</div>
<div class="proofscript" id="proof3524">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">v1</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>. <span class="tactic">destruct</span> <span class="id">v2</span>; <span class="tactic">auto</span>. <span class="tactic">unfold</span> <span class="id">Val.loword</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Int64.lo_ofwords</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">function_return_satisf</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">rs</span> <span class="id">ls_before</span> <span class="id">ls_after</span> <span class="id">res</span> <span class="id">res</span>' <span class="id">sg</span> <span class="id">e</span> <span class="id">e</span>' <span class="id">v</span>,<br/>
&nbsp;&nbsp;<span class="id">res</span>' = <span class="id">loc_result</span> <span class="id">sg</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">remove_equations_res</span> <span class="id">res</span> <span class="id">res</span>' <span class="id">e</span> = <span class="id">Some</span> <span class="id">e</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls_before</span> <span class="id">e</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">forallb</span> (<span class="kwd">fun</span> <span class="id">l</span> =&gt; <span class="id">reg_loc_unconstrained</span> <span class="id">res</span> <span class="id">l</span> <span class="id">e</span>') (<span class="id">map</span> <span class="id">R</span> (<span class="id">regs_of_rpair</span> <span class="id">res</span>')) = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">no_caller_saves</span> <span class="id">e</span>' = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">Val.lessdef</span> <span class="id">v</span> (<span class="id">Locmap.getpair</span> (<span class="id">map_rpair</span> <span class="id">R</span> <span class="id">res</span>') <span class="id">ls_after</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">agree_callee_save</span> <span class="id">ls_before</span> <span class="id">ls_after</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> (<span class="id">rs</span>#<span class="id">res</span> &lt;- <span class="id">v</span>) <span class="id">ls_after</span> <span class="id">e</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3525')">Proof.</div>
<div class="proofscript" id="proof3525">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">functional</span> <span class="tactic">inversion</span> <span class="id">H0</span>.<br/>
- <span class="comment">(*&nbsp;One&nbsp;register&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H8</span> <span class="kwd">in</span> *. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">InvBooleans</span>.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">e</span>' := <span class="id">remove_equation</span> {| <span class="id">ekind</span> := <span class="id">Full</span>; <span class="id">ereg</span> := <span class="id">res</span>; <span class="id">eloc</span> := <span class="id">R</span> <span class="id">mr</span> |} <span class="id">e</span>) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">OrderedEquation.eq_dec</span> <span class="id">q</span> (<span class="id">Eq</span> <span class="id">Full</span> <span class="id">res</span> (<span class="id">R</span> <span class="id">mr</span>))).<br/>
&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">q</span>; <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">Regmap.gss</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">EqSet.In</span> <span class="id">q</span> <span class="id">e</span>'). <span class="tactic">unfold</span> <span class="id">e</span>', <span class="id">remove_equation</span>; <span class="tactic">simpl</span>. <span class="id">ESD.fsetdec</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">reg_loc_unconstrained_sound</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">A</span> <span class="id">B</span>].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Regmap.gso</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">no_caller_saves_sound</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">red</span> <span class="kwd">in</span> <span class="id">H5</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H5</span>; <span class="tactic">auto</span>.<br/>
- <span class="comment">(*&nbsp;Two&nbsp;32-bit&nbsp;halves&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H9</span> <span class="kwd">in</span> *. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">e</span>' := <span class="id">remove_equation</span> {| <span class="id">ekind</span> := <span class="id">Low</span>; <span class="id">ereg</span> := <span class="id">res</span>; <span class="id">eloc</span> := <span class="id">R</span> <span class="id">mr2</span> |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">remove_equation</span> {| <span class="id">ekind</span> := <span class="id">High</span>; <span class="id">ereg</span> := <span class="id">res</span>; <span class="id">eloc</span> := <span class="id">R</span> <span class="id">mr1</span> |} <span class="id">e</span>)) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">InvBooleans</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">OrderedEquation.eq_dec</span> <span class="id">q</span> (<span class="id">Eq</span> <span class="id">Low</span> <span class="id">res</span> (<span class="id">R</span> <span class="id">mr2</span>))).<br/>
&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">q</span>; <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">Regmap.gss</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Val.lessdef_trans</span>. <span class="tactic">apply</span> <span class="id">Val.loword_lessdef</span>. <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">val_loword_longofwords</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">OrderedEquation.eq_dec</span> <span class="id">q</span> (<span class="id">Eq</span> <span class="id">High</span> <span class="id">res</span> (<span class="id">R</span> <span class="id">mr1</span>))).<br/>
&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">q</span>; <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">Regmap.gss</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Val.lessdef_trans</span>. <span class="tactic">apply</span> <span class="id">Val.hiword_lessdef</span>. <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">val_hiword_longofwords</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">EqSet.In</span> <span class="id">q</span> <span class="id">e</span>'). <span class="tactic">unfold</span> <span class="id">e</span>', <span class="id">remove_equation</span>; <span class="tactic">simpl</span>; <span class="id">ESD.fsetdec</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">reg_loc_unconstrained_sound</span>. <span class="id">eexact</span> <span class="id">H</span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">A</span> <span class="id">B</span>].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">reg_loc_unconstrained_sound</span>. <span class="id">eexact</span> <span class="id">H2</span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">C</span> <span class="id">D</span>].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Regmap.gso</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">no_caller_saves_sound</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">red</span> <span class="kwd">in</span> <span class="id">H5</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H5</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">compat_left_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r</span> <span class="id">l</span> <span class="id">e</span> <span class="id">q</span>,<br/>
&nbsp;&nbsp;<span class="id">compat_left</span> <span class="id">r</span> <span class="id">l</span> <span class="id">e</span> = <span class="id">true</span> -&gt; <span class="id">EqSet.In</span> <span class="id">q</span> <span class="id">e</span> -&gt; <span class="id">ereg</span> <span class="id">q</span> = <span class="id">r</span> -&gt; <span class="id">ekind</span> <span class="id">q</span> = <span class="id">Full</span> /\ <span class="id">eloc</span> <span class="id">q</span> = <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3526')">Proof.</div>
<div class="proofscript" id="proof3526">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">compat_left</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">EqSet.for_all_between_iff</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">select_reg_charact</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">destruct</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">H</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">ekind</span> <span class="id">q</span>); <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Loc.eq</span> <span class="id">l</span> (<span class="id">eloc</span> <span class="id">q</span>)); <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">subst</span> <span class="id">x2</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">exact</span> (<span class="id">select_reg_l_monotone</span> <span class="id">r</span>).<br/>
&nbsp;&nbsp;<span class="tactic">exact</span> (<span class="id">select_reg_h_monotone</span> <span class="id">r</span>).<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">compat_left2_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r</span> <span class="id">l1</span> <span class="id">l2</span> <span class="id">e</span> <span class="id">q</span>,<br/>
&nbsp;&nbsp;<span class="id">compat_left2</span> <span class="id">r</span> <span class="id">l1</span> <span class="id">l2</span> <span class="id">e</span> = <span class="id">true</span> -&gt; <span class="id">EqSet.In</span> <span class="id">q</span> <span class="id">e</span> -&gt; <span class="id">ereg</span> <span class="id">q</span> = <span class="id">r</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">ekind</span> <span class="id">q</span> = <span class="id">High</span> /\ <span class="id">eloc</span> <span class="id">q</span> = <span class="id">l1</span>) \/ (<span class="id">ekind</span> <span class="id">q</span> = <span class="id">Low</span> /\ <span class="id">eloc</span> <span class="id">q</span> = <span class="id">l2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3527')">Proof.</div>
<div class="proofscript" id="proof3527">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">compat_left2</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">EqSet.for_all_between_iff</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">select_reg_charact</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">destruct</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">H</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">ekind</span> <span class="id">q</span>); <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id">InvBooleans</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">InvBooleans</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">subst</span> <span class="id">x2</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">exact</span> (<span class="id">select_reg_l_monotone</span> <span class="id">r</span>).<br/>
&nbsp;&nbsp;<span class="tactic">exact</span> (<span class="id">select_reg_h_monotone</span> <span class="id">r</span>).<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">compat_entry_satisf</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">rl</span> <span class="id">ll</span> <span class="id">e</span>,<br/>
&nbsp;&nbsp;<span class="id">compat_entry</span> <span class="id">rl</span> <span class="id">ll</span> <span class="id">e</span> = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">vl</span> <span class="id">ls</span>,<br/>
&nbsp;&nbsp;<span class="id">Val.lessdef_list</span> <span class="id">vl</span> (<span class="id">map</span> (<span class="kwd">fun</span> <span class="id">p</span> =&gt; <span class="id">Locmap.getpair</span> <span class="id">p</span> <span class="id">ls</span>) <span class="id">ll</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> (<span class="id">init_regs</span> <span class="id">vl</span> <span class="id">rl</span>) <span class="id">ls</span> <span class="id">e</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3528')">Proof.</div>
<div class="proofscript" id="proof3528">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">e</span>. <span class="id">functional</span> <span class="tactic">induction</span> (<span class="id">compat_entry</span> <span class="id">rl</span> <span class="id">ll</span> <span class="id">e</span>); <span class="tactic">intros</span>.<br/>
- <span class="comment">(*&nbsp;no&nbsp;params&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">Regmap.gi</span>. <span class="tactic">destruct</span> (<span class="id">ekind</span> <span class="id">q</span>); <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
- <span class="comment">(*&nbsp;a&nbsp;param&nbsp;in&nbsp;a&nbsp;single&nbsp;location&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">InvBooleans</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">inv</span> <span class="id">H0</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">Regmap.gsspec</span>. <span class="tactic">destruct</span> (<span class="id">peq</span> (<span class="id">ereg</span> <span class="id">q</span>) <span class="id">r1</span>).<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">compat_left_sound</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">A</span> <span class="id">B</span>]. <span class="tactic">rewrite</span> <span class="id">A</span>; <span class="tactic">rewrite</span> <span class="id">B</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHb</span>; <span class="tactic">eauto</span>.<br/>
- <span class="comment">(*&nbsp;a&nbsp;param&nbsp;split&nbsp;across&nbsp;two&nbsp;locations&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">InvBooleans</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">inv</span> <span class="id">H0</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">Regmap.gsspec</span>. <span class="tactic">destruct</span> (<span class="id">peq</span> (<span class="id">ereg</span> <span class="id">q</span>) <span class="id">r1</span>).<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">compat_left2_sound</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [[<span class="id">A</span> <span class="id">B</span>] | [<span class="id">A</span> <span class="id">B</span>]]; <span class="tactic">rewrite</span> <span class="id">A</span>; <span class="tactic">rewrite</span> <span class="id">B</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Val.lessdef_trans</span> <span class="kwd">with</span> (<span class="id">Val.hiword</span> (<span class="id">Val.longofwords</span> (<span class="id">ls</span> <span class="id">l1</span>) (<span class="id">ls</span> <span class="id">l2</span>))).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Val.hiword_lessdef</span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">val_hiword_longofwords</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Val.lessdef_trans</span> <span class="kwd">with</span> (<span class="id">Val.loword</span> (<span class="id">Val.longofwords</span> (<span class="id">ls</span> <span class="id">l1</span>) (<span class="id">ls</span> <span class="id">l2</span>))).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Val.loword_lessdef</span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">val_loword_longofwords</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHb</span>; <span class="tactic">eauto</span>.<br/>
- <span class="comment">(*&nbsp;error&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">discriminate</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">call_regs_param_values</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sg</span> <span class="id">ls</span>,<br/>
&nbsp;&nbsp;<span class="id">map</span> (<span class="kwd">fun</span> <span class="id">p</span> =&gt; <span class="id">Locmap.getpair</span> <span class="id">p</span> (<span class="id">call_regs</span> <span class="id">ls</span>)) (<span class="id">loc_parameters</span> <span class="id">sg</span>)<br/>
&nbsp;&nbsp;= <span class="id">map</span> (<span class="kwd">fun</span> <span class="id">p</span> =&gt; <span class="id">Locmap.getpair</span> <span class="id">p</span> <span class="id">ls</span>) (<span class="id">loc_arguments</span> <span class="id">sg</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3529')">Proof.</div>
<div class="proofscript" id="proof3529">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">loc_parameters</span>. <span class="tactic">rewrite</span> <span class="id">list_map_compose</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">list_map_exten</span>; <span class="tactic">intros</span>. <span class="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">A</span>: <span class="kwd">forall</span> <span class="id">l</span>, <span class="id">loc_argument_acceptable</span> <span class="id">l</span> -&gt; <span class="id">call_regs</span> <span class="id">ls</span> (<span class="id">parameter_of_argument</span> <span class="id">l</span>) = <span class="id">ls</span> <span class="id">l</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">l</span> <span class="kwd">as</span> [<span class="id">r</span> | [] <span class="id">ofs</span> <span class="id">ty</span>]; <span class="tactic">simpl</span>; <span class="tactic">auto</span>; <span class="id">contradiction</span>. }<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">loc_arguments_acceptable</span>; <span class="tactic">eauto</span>. <span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
- <span class="tactic">auto</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">H0</span>; <span class="tactic">f_equal</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">return_regs_arg_values</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sg</span> <span class="id">ls1</span> <span class="id">ls2</span>,<br/>
&nbsp;&nbsp;<span class="id">tailcall_is_possible</span> <span class="id">sg</span> = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">map</span> (<span class="kwd">fun</span> <span class="id">p</span> =&gt; <span class="id">Locmap.getpair</span> <span class="id">p</span> (<span class="id">return_regs</span> <span class="id">ls1</span> <span class="id">ls2</span>)) (<span class="id">loc_arguments</span> <span class="id">sg</span>) <br/>
&nbsp;&nbsp;= <span class="id">map</span> (<span class="kwd">fun</span> <span class="id">p</span> =&gt; <span class="id">Locmap.getpair</span> <span class="id">p</span> <span class="id">ls2</span>) (<span class="id">loc_arguments</span> <span class="id">sg</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3530')">Proof.</div>
<div class="proofscript" id="proof3530">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">tailcall_is_possible_correct</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">list_map_exten</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Locmap.getpair_exten</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">In</span> <span class="id">l</span> (<span class="id">regs_of_rpairs</span> (<span class="id">loc_arguments</span> <span class="id">sg</span>))) <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id">in_regs_of_rpairs</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">loc_arguments_acceptable_2</span>; <span class="tactic">eauto</span>. <span class="id">exploit</span> <span class="id">H</span>; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="tactic">try</span> <span class="id">contradiction</span>. <span class="tactic">rewrite</span> <span class="id">H4</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">find_function_tailcall</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tge</span> <span class="id">ros</span> <span class="id">ls1</span> <span class="id">ls2</span>,<br/>
&nbsp;&nbsp;<span class="id">ros_compatible_tailcall</span> <span class="id">ros</span> = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">find_function</span> <span class="id">tge</span> <span class="id">ros</span> (<span class="id">return_regs</span> <span class="id">ls1</span> <span class="id">ls2</span>) = <span class="id">find_function</span> <span class="id">tge</span> <span class="id">ros</span> <span class="id">ls2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3531')">Proof.</div>
<div class="proofscript" id="proof3531">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">ros_compatible_tailcall</span>, <span class="id">find_function</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">ros</span> <span class="kwd">as</span> [<span class="id">r</span>|<span class="id">id</span>]; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">return_regs</span>. <span class="tactic">destruct</span> (<span class="id">is_callee_save</span> <span class="id">r</span>). <span class="tactic">discriminate</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">loadv_int64_split</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">a</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;<span class="id">Mem.loadv</span> <span class="id">Mint64</span> <span class="id">m</span> <span class="id">a</span> = <span class="id">Some</span> <span class="id">v</span> -&gt; <span class="id">Archi.splitlong</span> = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">v1</span> <span class="id">v2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Mem.loadv</span> <span class="id">Mint32</span> <span class="id">m</span> <span class="id">a</span> = <span class="id">Some</span> (<span class="kwd">if</span> <span class="id">Archi.big_endian</span> <span class="kwd">then</span> <span class="id">v1</span> <span class="kwd">else</span> <span class="id">v2</span>)<br/>
&nbsp;&nbsp;/\ <span class="id">Mem.loadv</span> <span class="id">Mint32</span> <span class="id">m</span> (<span class="id">Val.add</span> <span class="id">a</span> (<span class="id">Vint</span> (<span class="id">Int.repr</span> 4))) = <span class="id">Some</span> (<span class="kwd">if</span> <span class="id">Archi.big_endian</span> <span class="kwd">then</span> <span class="id">v2</span> <span class="kwd">else</span> <span class="id">v1</span>)<br/>
&nbsp;&nbsp;/\ <span class="id">Val.lessdef</span> (<span class="id">Val.hiword</span> <span class="id">v</span>) <span class="id">v1</span><br/>
&nbsp;&nbsp;/\ <span class="id">Val.lessdef</span> (<span class="id">Val.loword</span> <span class="id">v</span>) <span class="id">v2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3532')">Proof.</div>
<div class="proofscript" id="proof3532">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">Archi.splitlong_ptr32</span> <span class="kwd">in</span> <span class="id">H0</span>. <br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Mem.loadv_int64_split</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">v1</span> &amp; <span class="id">v2</span> &amp; <span class="id">A</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span>).<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">v1</span>, <span class="id">v2</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">C</span>; <span class="tactic">auto</span>. <span class="tactic">destruct</span> <span class="id">v1</span>, <span class="id">v2</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Int64.hi_ofwords</span>, <span class="id">Int64.lo_ofwords</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">add_equations_builtin_arg_satisf</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">arg</span> <span class="id">arg</span>' <span class="id">e</span> <span class="id">e</span>',<br/>
&nbsp;&nbsp;<span class="id">add_equations_builtin_arg</span> <span class="id">env</span> <span class="id">arg</span> <span class="id">arg</span>' <span class="id">e</span> = <span class="id">Some</span> <span class="id">e</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e</span>' -&gt; <span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3533')">Proof.</div>
<div class="proofscript" id="proof3533">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">arg</span>; <span class="tactic">destruct</span> <span class="id">arg</span>'; <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="id">MonadInv</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">add_equation_satisf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">arg</span>'1; <span class="id">MonadInv</span>. <span class="tactic">destruct</span> <span class="id">arg</span>'2; <span class="id">MonadInv</span>. <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id">add_equation_satisf</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">add_equations_builtin_arg_lessdef</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span> (<span class="id">ge</span>: <span class="id">RTL.genv</span>) <span class="id">sp</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">m</span> <span class="id">arg</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;<span class="id">eval_builtin_arg</span> <span class="id">ge</span> (<span class="kwd">fun</span> <span class="id">r</span> =&gt; <span class="id">rs</span>#<span class="id">r</span>) <span class="id">sp</span> <span class="id">m</span> <span class="id">arg</span> <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">e</span> <span class="id">e</span>' <span class="id">arg</span>',<br/>
&nbsp;&nbsp;<span class="id">add_equations_builtin_arg</span> <span class="id">env</span> <span class="id">arg</span> <span class="id">arg</span>' <span class="id">e</span> = <span class="id">Some</span> <span class="id">e</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">wt_regset</span> <span class="id">env</span> <span class="id">rs</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">v</span>', <span class="id">eval_builtin_arg</span> <span class="id">ge</span> <span class="id">ls</span> <span class="id">sp</span> <span class="id">m</span> <span class="id">arg</span>' <span class="id">v</span>' /\ <span class="id">Val.lessdef</span> <span class="id">v</span> <span class="id">v</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3534')">Proof.</div>
<div class="proofscript" id="proof3534">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">simpl</span>; <span class="tactic">intros</span> <span class="id">e</span> <span class="id">e</span>' <span class="id">arg</span>' <span class="id">AE</span> <span class="id">SAT</span> <span class="id">WT</span>; <span class="tactic">destruct</span> <span class="id">arg</span>'; <span class="id">MonadInv</span>.<br/>
- <span class="id">exploit</span> <span class="id">add_equation_lessdef</span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">ls</span> <span class="id">x0</span>); <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">barg</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">arg</span>'1; <span class="id">MonadInv</span>. <span class="tactic">destruct</span> <span class="id">arg</span>'2; <span class="id">MonadInv</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">add_equation_lessdef</span>. <span class="tactic">eauto</span>. <span class="tactic">simpl</span>; <span class="tactic">intros</span> <span class="id">LD1</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">add_equation_lessdef</span>. <span class="tactic">eapply</span> <span class="id">add_equation_satisf</span>. <span class="tactic">eauto</span>. <span class="tactic">simpl</span>; <span class="tactic">intros</span> <span class="id">LD2</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">Val.longofwords</span> (<span class="id">ls</span> <span class="id">x0</span>) (<span class="id">ls</span> <span class="id">x1</span>)); <span class="tactic">split</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">barg</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">val_longofwords_eq</span> <span class="id">rs</span>#<span class="id">x</span>). <span class="tactic">apply</span> <span class="id">Val.longofwords_lessdef</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">e0</span>; <span class="tactic">apply</span> <span class="id">WT</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
- <span class="id">econstructor</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">barg</span>.<br/>
- <span class="id">econstructor</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">barg</span>.<br/>
- <span class="id">econstructor</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">barg</span>.<br/>
- <span class="id">econstructor</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">barg</span>.<br/>
- <span class="id">econstructor</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">barg</span>.<br/>
- <span class="id">econstructor</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">barg</span>.<br/>
- <span class="id">econstructor</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">barg</span>.<br/>
- <span class="id">econstructor</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">barg</span>.<br/>
- <span class="id">exploit</span> <span class="id">IHeval_builtin_arg1</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">add_equations_builtin_arg_satisf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">v1</span> &amp; <span class="id">A</span> &amp; <span class="id">B</span>).<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">IHeval_builtin_arg2</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">v2</span> &amp; <span class="id">C</span> &amp; <span class="id">D</span>).<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">Val.longofwords</span> <span class="id">v1</span> <span class="id">v2</span>); <span class="tactic">split</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">barg</span>. <span class="tactic">apply</span> <span class="id">Val.longofwords_lessdef</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">add_equations_builtin_args_satisf</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">arg</span> <span class="id">arg</span>' <span class="id">e</span> <span class="id">e</span>',<br/>
&nbsp;&nbsp;<span class="id">add_equations_builtin_args</span> <span class="id">env</span> <span class="id">arg</span> <span class="id">arg</span>' <span class="id">e</span> = <span class="id">Some</span> <span class="id">e</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e</span>' -&gt; <span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3535')">Proof.</div>
<div class="proofscript" id="proof3535">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">arg</span>; <span class="tactic">destruct</span> <span class="id">arg</span>'; <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="id">MonadInv</span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id">add_equations_builtin_arg_satisf</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">add_equations_builtin_args_lessdef</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span> (<span class="id">ge</span>: <span class="id">RTL.genv</span>) <span class="id">sp</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">m</span> <span class="id">tm</span> <span class="id">arg</span> <span class="id">vl</span>,<br/>
&nbsp;&nbsp;<span class="id">eval_builtin_args</span> <span class="id">ge</span> (<span class="kwd">fun</span> <span class="id">r</span> =&gt; <span class="id">rs</span>#<span class="id">r</span>) <span class="id">sp</span> <span class="id">m</span> <span class="id">arg</span> <span class="id">vl</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">arg</span>' <span class="id">e</span> <span class="id">e</span>',<br/>
&nbsp;&nbsp;<span class="id">add_equations_builtin_args</span> <span class="id">env</span> <span class="id">arg</span> <span class="id">arg</span>' <span class="id">e</span> = <span class="id">Some</span> <span class="id">e</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">wt_regset</span> <span class="id">env</span> <span class="id">rs</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">Mem.extends</span> <span class="id">m</span> <span class="id">tm</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">vl</span>', <span class="id">eval_builtin_args</span> <span class="id">ge</span> <span class="id">ls</span> <span class="id">sp</span> <span class="id">tm</span> <span class="id">arg</span>' <span class="id">vl</span>' /\ <span class="id">Val.lessdef_list</span> <span class="id">vl</span> <span class="id">vl</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3536')">Proof.</div>
<div class="proofscript" id="proof3536">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="tactic">destruct</span> <span class="id">arg</span>'; <span class="id">MonadInv</span>.<br/>
- <span class="id">exists</span> (@<span class="id">nil</span> <span class="id">val</span>); <span class="tactic">split</span>; <span class="id">constructor</span>.<br/>
- <span class="id">exploit</span> <span class="id">IHlist_forall2</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">vl</span>' &amp; <span class="id">A</span> &amp; <span class="id">B</span>).<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">add_equations_builtin_arg_lessdef</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">add_equations_builtin_args_satisf</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">v1</span>' &amp; <span class="id">C</span> &amp; <span class="id">D</span>).<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (@<span class="id">eval_builtin_arg_lessdef</span> <span class="id">_</span> <span class="id">ge</span> <span class="id">ls</span> <span class="id">ls</span>); <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">v1</span>'' &amp; <span class="id">E</span> &amp; <span class="id">F</span>).<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">v1</span>'' :: <span class="id">vl</span>'); <span class="tactic">split</span>; <span class="id">constructor</span>; <span class="tactic">auto</span>. <span class="tactic">eapply</span> <span class="id">Val.lessdef_trans</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">add_equations_debug_args_satisf</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">arg</span> <span class="id">arg</span>' <span class="id">e</span> <span class="id">e</span>',<br/>
&nbsp;&nbsp;<span class="id">add_equations_debug_args</span> <span class="id">env</span> <span class="id">arg</span> <span class="id">arg</span>' <span class="id">e</span> = <span class="id">Some</span> <span class="id">e</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e</span>' -&gt; <span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3537')">Proof.</div>
<div class="proofscript" id="proof3537">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">arg</span>; <span class="tactic">destruct</span> <span class="id">arg</span>'; <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="id">MonadInv</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">add_equations_builtin_arg</span> <span class="id">env</span> <span class="id">a</span> <span class="id">b</span> <span class="id">e</span>) <span class="kwd">as</span> [<span class="id">e1</span>|] <span class="id">eqn</span>:<span class="id">A</span>;<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id">add_equations_builtin_arg_satisf</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">add_equations_debug_args_eval</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span> (<span class="id">ge</span>: <span class="id">RTL.genv</span>) <span class="id">sp</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">m</span> <span class="id">tm</span> <span class="id">arg</span> <span class="id">vl</span>,<br/>
&nbsp;&nbsp;<span class="id">eval_builtin_args</span> <span class="id">ge</span> (<span class="kwd">fun</span> <span class="id">r</span> =&gt; <span class="id">rs</span>#<span class="id">r</span>) <span class="id">sp</span> <span class="id">m</span> <span class="id">arg</span> <span class="id">vl</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">arg</span>' <span class="id">e</span> <span class="id">e</span>',<br/>
&nbsp;&nbsp;<span class="id">add_equations_debug_args</span> <span class="id">env</span> <span class="id">arg</span> <span class="id">arg</span>' <span class="id">e</span> = <span class="id">Some</span> <span class="id">e</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">wt_regset</span> <span class="id">env</span> <span class="id">rs</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">Mem.extends</span> <span class="id">m</span> <span class="id">tm</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">vl</span>', <span class="id">eval_builtin_args</span> <span class="id">ge</span> <span class="id">ls</span> <span class="id">sp</span> <span class="id">tm</span> <span class="id">arg</span>' <span class="id">vl</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3538')">Proof.</div>
<div class="proofscript" id="proof3538">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="tactic">destruct</span> <span class="id">arg</span>'; <span class="id">MonadInv</span>.<br/>
- <span class="id">exists</span> (@<span class="id">nil</span> <span class="id">val</span>); <span class="id">constructor</span>.<br/>
- <span class="id">exists</span> (@<span class="id">nil</span> <span class="id">val</span>); <span class="id">constructor</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">add_equations_builtin_arg</span> <span class="id">env</span> <span class="id">a1</span> <span class="id">b</span> <span class="id">e</span>) <span class="kwd">as</span> [<span class="id">e1</span>|] <span class="id">eqn</span>:<span class="id">A</span>.<br/>
+ <span class="id">exploit</span> <span class="id">IHlist_forall2</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">vl</span>' &amp; <span class="id">B</span>).<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">add_equations_builtin_arg_lessdef</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">add_equations_debug_args_satisf</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">v1</span>' &amp; <span class="id">C</span> &amp; <span class="id">D</span>).<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (@<span class="id">eval_builtin_arg_lessdef</span> <span class="id">_</span> <span class="id">ge</span> <span class="id">ls</span> <span class="id">ls</span>); <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">v1</span>'' &amp; <span class="id">E</span> &amp; <span class="id">F</span>).<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">v1</span>'' :: <span class="id">vl</span>'); <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
+ <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">add_equations_builtin_eval</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ef</span> <span class="id">env</span> <span class="id">args</span> <span class="id">args</span>' <span class="id">e1</span> <span class="id">e2</span> <span class="id">m1</span> <span class="id">m1</span>' <span class="id">rs</span> <span class="id">ls</span> (<span class="id">ge</span>: <span class="id">RTL.genv</span>) <span class="id">sp</span> <span class="id">vargs</span> <span class="id">t</span> <span class="id">vres</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;<span class="id">wt_regset</span> <span class="id">env</span> <span class="id">rs</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">ef</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">EF_debug</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">add_equations_debug_args</span> <span class="id">env</span> <span class="id">args</span> <span class="id">args</span>' <span class="id">e1</span><br/>
&nbsp;&nbsp;| <span class="id">_</span>              =&gt; <span class="id">add_equations_builtin_args</span> <span class="id">env</span> <span class="id">args</span> <span class="id">args</span>' <span class="id">e1</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span> = <span class="id">Some</span> <span class="id">e2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">Mem.extends</span> <span class="id">m1</span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">eval_builtin_args</span> <span class="id">ge</span> (<span class="kwd">fun</span> <span class="id">r</span> =&gt; <span class="id">rs</span> # <span class="id">r</span>) <span class="id">sp</span> <span class="id">m1</span> <span class="id">args</span> <span class="id">vargs</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">external_call</span> <span class="id">ef</span> <span class="id">ge</span> <span class="id">vargs</span> <span class="id">m1</span> <span class="id">t</span> <span class="id">vres</span> <span class="id">m2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e1</span> /\<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">vargs</span>' <span class="id">vres</span>' <span class="id">m2</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eval_builtin_args</span> <span class="id">ge</span> <span class="id">ls</span> <span class="id">sp</span> <span class="id">m1</span>' <span class="id">args</span>' <span class="id">vargs</span>'<br/>
&nbsp;&nbsp;/\ <span class="id">external_call</span> <span class="id">ef</span> <span class="id">ge</span> <span class="id">vargs</span>' <span class="id">m1</span>' <span class="id">t</span> <span class="id">vres</span>' <span class="id">m2</span>'<br/>
&nbsp;&nbsp;/\ <span class="id">Val.lessdef</span> <span class="id">vres</span> <span class="id">vres</span>'<br/>
&nbsp;&nbsp;/\ <span class="id">Mem.extends</span> <span class="id">m2</span> <span class="id">m2</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3539')">Proof.</div>
<div class="proofscript" id="proof3539">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">DEFAULT</span>: <span class="id">add_equations_builtin_args</span> <span class="id">env</span> <span class="id">args</span> <span class="id">args</span>' <span class="id">e1</span> = <span class="id">Some</span> <span class="id">e2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e1</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">vargs</span>' <span class="id">vres</span>' <span class="id">m2</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eval_builtin_args</span> <span class="id">ge</span> <span class="id">ls</span> <span class="id">sp</span> <span class="id">m1</span>' <span class="id">args</span>' <span class="id">vargs</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id">external_call</span> <span class="id">ef</span> <span class="id">ge</span> <span class="id">vargs</span>' <span class="id">m1</span>' <span class="id">t</span> <span class="id">vres</span>' <span class="id">m2</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id">Val.lessdef</span> <span class="id">vres</span> <span class="id">vres</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id">Mem.extends</span> <span class="id">m2</span> <span class="id">m2</span>').<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">split</span>. <span class="tactic">eapply</span> <span class="id">add_equations_builtin_args_satisf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">add_equations_builtin_args_lessdef</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">vargs</span>' &amp; <span class="id">A</span> &amp; <span class="id">B</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">external_call_mem_extends</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">vres</span>' &amp; <span class="id">m2</span>' &amp; <span class="id">C</span> &amp; <span class="id">D</span> &amp; <span class="id">E</span> &amp; <span class="id">F</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">vargs</span>', <span class="id">vres</span>', <span class="id">m2</span>'; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">ef</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">eapply</span> <span class="id">add_equations_debug_args_satisf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">add_equations_debug_args_eval</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">vargs</span>' &amp; <span class="id">A</span>).<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H4</span>; <span class="id">inv</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">vargs</span>', <span class="id">Vundef</span>, <span class="id">m1</span>'. <span class="tactic">intuition</span> <span class="tactic">auto</span>. <span class="tactic">simpl</span>. <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">parallel_set_builtin_res_satisf</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span> <span class="id">res</span> <span class="id">res</span>' <span class="id">e0</span> <span class="id">e1</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">v</span> <span class="id">v</span>',<br/>
&nbsp;&nbsp;<span class="id">remove_equations_builtin_res</span> <span class="id">env</span> <span class="id">res</span> <span class="id">res</span>' <span class="id">e0</span> = <span class="id">Some</span> <span class="id">e1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">forallb</span> (<span class="kwd">fun</span> <span class="id">r</span> =&gt; <span class="id">reg_unconstrained</span> <span class="id">r</span> <span class="id">e1</span>) (<span class="id">params_of_builtin_res</span> <span class="id">res</span>) = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">forallb</span> (<span class="kwd">fun</span> <span class="id">mr</span> =&gt; <span class="id">loc_unconstrained</span> (<span class="id">R</span> <span class="id">mr</span>) <span class="id">e1</span>) (<span class="id">params_of_builtin_res</span> <span class="id">res</span>') = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">Val.lessdef</span> <span class="id">v</span> <span class="id">v</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> (<span class="id">regmap_setres</span> <span class="id">res</span> <span class="id">v</span> <span class="id">rs</span>) (<span class="id">Locmap.setres</span> <span class="id">res</span>' <span class="id">v</span>' <span class="id">ls</span>) <span class="id">e0</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3540')">Proof.</div>
<div class="proofscript" id="proof3540">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">forallb_forall</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">res</span>, <span class="id">res</span>'; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="id">inv</span> <span class="id">H</span>.<br/>
- <span class="tactic">apply</span> <span class="id">parallel_assignment_satisf</span> <span class="kwd">with</span> (<span class="id">k</span> := <span class="id">Full</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">reg_loc_unconstrained</span>. <span class="tactic">rewrite</span> <span class="id">H0</span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">rewrite</span> <span class="id">H1</span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">auto</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">res</span>'1; <span class="tactic">try</span> <span class="tactic">discriminate</span>. <span class="tactic">destruct</span> <span class="id">res</span>'2; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">x0</span> <span class="id">into</span> <span class="id">hi</span>; <span class="tactic">rename</span> <span class="id">x1</span> <span class="id">into</span> <span class="id">lo</span>. <span class="id">MonadInv</span>. <span class="tactic">destruct</span> (<span class="id">mreg_eq</span> <span class="id">hi</span> <span class="id">lo</span>); <span class="id">inv</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">e</span>' := <span class="id">remove_equation</span> {| <span class="id">ekind</span> := <span class="id">High</span>; <span class="id">ereg</span> := <span class="id">x</span>; <span class="id">eloc</span> := <span class="id">R</span> <span class="id">hi</span> |} <span class="id">e0</span>) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">e</span>'' := <span class="id">remove_equation</span> {| <span class="id">ekind</span> := <span class="id">Low</span>; <span class="id">ereg</span> := <span class="id">x</span>; <span class="id">eloc</span> := <span class="id">R</span> <span class="id">lo</span> |} <span class="id">e</span>') <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">red</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">OrderedEquation.eq_dec</span> <span class="id">q</span> (<span class="id">Eq</span> <span class="id">Low</span> <span class="id">x</span> (<span class="id">R</span> <span class="id">lo</span>))).<br/>
&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">q</span>; <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">Regmap.gss</span>. <span class="tactic">rewrite</span> <span class="id">Locmap.gss</span>. <span class="tactic">apply</span> <span class="id">Val.loword_lessdef</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">OrderedEquation.eq_dec</span> <span class="id">q</span> (<span class="id">Eq</span> <span class="id">High</span> <span class="id">x</span> (<span class="id">R</span> <span class="id">hi</span>))).<br/>
&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">q</span>; <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">Regmap.gss</span>. <span class="tactic">rewrite</span> <span class="id">Locmap.gso</span> <span class="tactic">by</span> (<span class="tactic">red</span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Locmap.gss</span>. <span class="tactic">apply</span> <span class="id">Val.hiword_lessdef</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">EqSet.In</span> <span class="id">q</span> <span class="id">e</span>'').<br/>
&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id">e</span>'', <span class="id">e</span>', <span class="id">remove_equation</span>; <span class="tactic">simpl</span>; <span class="id">ESD.fsetdec</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Regmap.gso</span>. <span class="tactic">rewrite</span> ! <span class="id">Locmap.gso</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">loc_unconstrained_sound</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">loc_unconstrained_sound</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">reg_unconstrained_sound</span>; <span class="tactic">eauto</span>.<br/>
- <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<h1> Properties of the dataflow analysis </h1>
<br/>
<span class="kwd">Lemma</span> <span class="id">analyze_successors</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> <span class="id">env</span> <span class="id">bsh</span> <span class="id">an</span> <span class="id">pc</span> <span class="id">bs</span> <span class="id">s</span> <span class="id">e</span>,<br/>
&nbsp;&nbsp;<span class="id">analyze</span> <span class="id">f</span> <span class="id">env</span> <span class="id">bsh</span> = <span class="id">Some</span> <span class="id">an</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">bsh</span>!<span class="id">pc</span> = <span class="id">Some</span> <span class="id">bs</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">In</span> <span class="id">s</span> (<span class="id">successors_block_shape</span> <span class="id">bs</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">an</span>!!<span class="id">pc</span> = <span class="id">OK</span> <span class="id">e</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">e</span>', <span class="id">transfer</span> <span class="id">f</span> <span class="id">env</span> <span class="id">bsh</span> <span class="id">s</span> <span class="id">an</span>!!<span class="id">s</span> = <span class="id">OK</span> <span class="id">e</span>' /\ <span class="id">EqSet.Subset</span> <span class="id">e</span>' <span class="id">e</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3541')">Proof.</div>
<div class="proofscript" id="proof3541">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">analyze</span>; <span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id">DS.fixpoint_allnodes_solution</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span>. <span class="tactic">unfold</span> <span class="id">DS.L.ge</span>. <span class="tactic">destruct</span> (<span class="id">transfer</span> <span class="id">f</span> <span class="id">env</span> <span class="id">bsh</span> <span class="id">s</span> <span class="id">an</span>#<span class="id">s</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">e0</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">satisf_successors</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> <span class="id">env</span> <span class="id">bsh</span> <span class="id">an</span> <span class="id">pc</span> <span class="id">bs</span> <span class="id">s</span> <span class="id">e</span> <span class="id">rs</span> <span class="id">ls</span>,<br/>
&nbsp;&nbsp;<span class="id">analyze</span> <span class="id">f</span> <span class="id">env</span> <span class="id">bsh</span> = <span class="id">Some</span> <span class="id">an</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">bsh</span>!<span class="id">pc</span> = <span class="id">Some</span> <span class="id">bs</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">In</span> <span class="id">s</span> (<span class="id">successors_block_shape</span> <span class="id">bs</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">an</span>!!<span class="id">pc</span> = <span class="id">OK</span> <span class="id">e</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">e</span>', <span class="id">transfer</span> <span class="id">f</span> <span class="id">env</span> <span class="id">bsh</span> <span class="id">s</span> <span class="id">an</span>!!<span class="id">s</span> = <span class="id">OK</span> <span class="id">e</span>' /\ <span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3542')">Proof.</div>
<div class="proofscript" id="proof3542">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id">analyze_successors</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">e</span>' [<span class="id">A</span> <span class="id">B</span>]].<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">e</span>'; <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">eapply</span> <span class="id">satisf_incr</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Inversion on <span class="bracket"><span class="id">transf_function</span></span> </div>
<br/>
<span class="kwd">Inductive</span> <span class="id">transf_function_spec</span> (<span class="id">f</span>: <span class="id">RTL.function</span>) (<span class="id">tf</span>: <span class="id">LTL.function</span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id">transf_function_spec_intro</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span> <span class="id">an</span> <span class="id">mv</span> <span class="id">k</span> <span class="id">e1</span> <span class="id">e2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_function</span> <span class="id">f</span> <span class="id">env</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">analyze</span> <span class="id">f</span> <span class="id">env</span> (<span class="id">pair_codes</span> <span class="id">f</span> <span class="id">tf</span>) = <span class="id">Some</span> <span class="id">an</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">LTL.fn_code</span> <span class="id">tf</span>)!(<span class="id">LTL.fn_entrypoint</span> <span class="id">tf</span>) = <span class="id">Some</span>(<span class="id">expand_moves</span> <span class="id">mv</span> (<span class="id">Lbranch</span> (<span class="id">RTL.fn_entrypoint</span> <span class="id">f</span>) :: <span class="id">k</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_moves</span> <span class="id">mv</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">transfer</span> <span class="id">f</span> <span class="id">env</span> (<span class="id">pair_codes</span> <span class="id">f</span> <span class="id">tf</span>) (<span class="id">RTL.fn_entrypoint</span> <span class="id">f</span>) <span class="id">an</span>!!(<span class="id">RTL.fn_entrypoint</span> <span class="id">f</span>) = <span class="id">OK</span> <span class="id">e1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">track_moves</span> <span class="id">env</span> <span class="id">mv</span> <span class="id">e1</span> = <span class="id">Some</span> <span class="id">e2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">compat_entry</span> (<span class="id">RTL.fn_params</span> <span class="id">f</span>) (<span class="id">loc_parameters</span> (<span class="id">fn_sig</span> <span class="id">tf</span>)) <span class="id">e2</span> = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">can_undef</span> <span class="id">destroyed_at_function_entry</span> <span class="id">e2</span> = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">RTL.fn_stacksize</span> <span class="id">f</span> = <span class="id">LTL.fn_stacksize</span> <span class="id">tf</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">RTL.fn_sig</span> <span class="id">f</span> = <span class="id">LTL.fn_sig</span> <span class="id">tf</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">transf_function_spec</span> <span class="id">f</span> <span class="id">tf</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">transf_function_inv</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> <span class="id">tf</span>,<br/>
&nbsp;&nbsp;<span class="id">transf_function</span> <span class="id">f</span> = <span class="id">OK</span> <span class="id">tf</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">transf_function_spec</span> <span class="id">f</span> <span class="id">tf</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3543')">Proof.</div>
<div class="proofscript" id="proof3543">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">transf_function</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">type_function</span> <span class="id">f</span>) <span class="kwd">as</span> [<span class="id">env</span>|] <span class="id">eqn</span>:<span class="id">TY</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">regalloc</span> <span class="id">f</span>); <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">check_function</span> <span class="id">f</span> <span class="id">f0</span> <span class="id">env</span>) <span class="kwd">as</span> [] <span class="id">eqn</span>:?; <span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">check_function</span> <span class="kwd">in</span> <span class="id">Heqr</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">analyze</span> <span class="id">f</span> <span class="id">env</span> (<span class="id">pair_codes</span> <span class="id">f</span> <span class="id">tf</span>)) <span class="kwd">as</span> [<span class="id">an</span>|] <span class="id">eqn</span>:?; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id">monadInv</span> <span class="id">Heqr</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">check_entrypoints_aux</span> <span class="id">f</span> <span class="id">tf</span> <span class="id">env</span> <span class="id">x</span>) <span class="kwd">as</span> [<span class="id">y</span>|] <span class="id">eqn</span>:?; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">check_entrypoints_aux</span>, <span class="id">pair_entrypoints</span> <span class="kwd">in</span> <span class="id">Heqo0</span>. <span class="id">MonadInv</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">extract_moves_sound</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">A</span> <span class="id">B</span>]. <span class="tactic">subst</span> <span class="id">b</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">check_succ_sound</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">k</span> <span class="id">EQ1</span>]. <span class="tactic">subst</span> <span class="id">b0</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">type_function_correct</span>; <span class="tactic">eauto</span>. <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">invert_code</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> <span class="id">env</span> <span class="id">tf</span> <span class="id">pc</span> <span class="id">i</span> <span class="id">opte</span> <span class="id">e</span>,<br/>
&nbsp;&nbsp;<span class="id">wt_function</span> <span class="id">f</span> <span class="id">env</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">RTL.fn_code</span> <span class="id">f</span>)!<span class="id">pc</span> = <span class="id">Some</span> <span class="id">i</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">transfer</span> <span class="id">f</span> <span class="id">env</span> (<span class="id">pair_codes</span> <span class="id">f</span> <span class="id">tf</span>) <span class="id">pc</span> <span class="id">opte</span> = <span class="id">OK</span> <span class="id">e</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">eafter</span>, <span class="id">exists</span> <span class="id">bsh</span>, <span class="id">exists</span> <span class="id">bb</span>,<br/>
&nbsp;&nbsp;<span class="id">opte</span> = <span class="id">OK</span> <span class="id">eafter</span> /\<br/>
&nbsp;&nbsp;(<span class="id">pair_codes</span> <span class="id">f</span> <span class="id">tf</span>)!<span class="id">pc</span> = <span class="id">Some</span> <span class="id">bsh</span> /\<br/>
&nbsp;&nbsp;(<span class="id">LTL.fn_code</span> <span class="id">tf</span>)!<span class="id">pc</span> = <span class="id">Some</span> <span class="id">bb</span> /\<br/>
&nbsp;&nbsp;<span class="id">expand_block_shape</span> <span class="id">bsh</span> <span class="id">i</span> <span class="id">bb</span> /\<br/>
&nbsp;&nbsp;<span class="id">transfer_aux</span> <span class="id">f</span> <span class="id">env</span> <span class="id">bsh</span> <span class="id">eafter</span> = <span class="id">Some</span> <span class="id">e</span> /\<br/>
&nbsp;&nbsp;<span class="id">wt_instr</span> <span class="id">f</span> <span class="id">env</span> <span class="id">i</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3544')">Proof.</div>
<div class="proofscript" id="proof3544">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">opte</span> <span class="kwd">as</span> [<span class="id">eafter</span>|]; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>. <span class="id">exists</span> <span class="id">eafter</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">pair_codes</span> <span class="id">f</span> <span class="id">tf</span>)!<span class="id">pc</span> <span class="kwd">as</span> [<span class="id">bsh</span>|] <span class="id">eqn</span>:?; <span class="tactic">try</span> <span class="tactic">discriminate</span>. <span class="id">exists</span> <span class="id">bsh</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">matching_instr_block</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">bb</span> [<span class="id">A</span> <span class="id">B</span>]].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">transfer_aux</span> <span class="id">f</span> <span class="id">env</span> <span class="id">bsh</span> <span class="id">eafter</span>) <span class="kwd">as</span> [<span class="id">e1</span>|] <span class="id">eqn</span>:?; <span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">bb</span>. <span class="id">exploit</span> <span class="id">wt_instr_at</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
Qed.</div>
<br/>
<h1> Semantic preservation </h1>
<br/>
<span class="kwd">Section</span> <span class="id">PRESERVATION</span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id">prog</span>: <span class="id">RTL.program</span>.<br/>
<span class="kwd">Variable</span> <span class="id">tprog</span>: <span class="id">LTL.program</span>.<br/>
<span class="kwd">Hypothesis</span> <span class="id">TRANSF</span>: <span class="id">match_prog</span> <span class="id">prog</span> <span class="id">tprog</span>.<br/>
<br/>
<span class="kwd">Let</span> <span class="id">ge</span> := <span class="id">Genv.globalenv</span> <span class="id">prog</span>.<br/>
<span class="kwd">Let</span> <span class="id">tge</span> := <span class="id">Genv.globalenv</span> <span class="id">tprog</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">symbols_preserved</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">s</span>: <span class="id">ident</span>), <span class="id">Genv.find_symbol</span> <span class="id">tge</span> <span class="id">s</span> = <span class="id">Genv.find_symbol</span> <span class="id">ge</span> <span class="id">s</span>.<br/>
<span class="kwd">Proof</span> (<span class="id">Genv.find_symbol_match</span> <span class="id">TRANSF</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">senv_preserved</span>:<br/>
&nbsp;&nbsp;<span class="id">Senv.equiv</span> <span class="id">ge</span> <span class="id">tge</span>.<br/>
<span class="kwd">Proof</span> (<span class="id">Genv.senv_match</span> <span class="id">TRANSF</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">functions_translated</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">v</span>: <span class="id">val</span>) (<span class="id">f</span>: <span class="id">RTL.fundef</span>),<br/>
&nbsp;&nbsp;<span class="id">Genv.find_funct</span> <span class="id">ge</span> <span class="id">v</span> = <span class="id">Some</span> <span class="id">f</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">tf</span>,<br/>
&nbsp;&nbsp;<span class="id">Genv.find_funct</span> <span class="id">tge</span> <span class="id">v</span> = <span class="id">Some</span> <span class="id">tf</span> /\ <span class="id">transf_fundef</span> <span class="id">f</span> = <span class="id">OK</span> <span class="id">tf</span>.<br/>
<span class="kwd">Proof</span> (<span class="id">Genv.find_funct_transf_partial</span> <span class="id">TRANSF</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">function_ptr_translated</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">b</span>: <span class="id">block</span>) (<span class="id">f</span>: <span class="id">RTL.fundef</span>),<br/>
&nbsp;&nbsp;<span class="id">Genv.find_funct_ptr</span> <span class="id">ge</span> <span class="id">b</span> = <span class="id">Some</span> <span class="id">f</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">tf</span>,<br/>
&nbsp;&nbsp;<span class="id">Genv.find_funct_ptr</span> <span class="id">tge</span> <span class="id">b</span> = <span class="id">Some</span> <span class="id">tf</span> /\ <span class="id">transf_fundef</span> <span class="id">f</span> = <span class="id">OK</span> <span class="id">tf</span>.<br/>
<span class="kwd">Proof</span> (<span class="id">Genv.find_funct_ptr_transf_partial</span> <span class="id">TRANSF</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">sig_function_translated</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> <span class="id">tf</span>,<br/>
&nbsp;&nbsp;<span class="id">transf_fundef</span> <span class="id">f</span> = <span class="id">OK</span> <span class="id">tf</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">LTL.funsig</span> <span class="id">tf</span> = <span class="id">RTL.funsig</span> <span class="id">f</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3545')">Proof.</div>
<div class="proofscript" id="proof3545">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">destruct</span> <span class="id">f</span>; <span class="id">monadInv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">transf_function_inv</span> <span class="id">_</span> <span class="id">_</span> <span class="id">EQ</span>). <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">find_function_translated</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ros</span> <span class="id">rs</span> <span class="id">fd</span> <span class="id">ros</span>' <span class="id">e</span> <span class="id">e</span>' <span class="id">ls</span>,<br/>
&nbsp;&nbsp;<span class="id">RTL.find_function</span> <span class="id">ge</span> <span class="id">ros</span> <span class="id">rs</span> = <span class="id">Some</span> <span class="id">fd</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">add_equation_ros</span> <span class="id">ros</span> <span class="id">ros</span>' <span class="id">e</span> = <span class="id">Some</span> <span class="id">e</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">tfd</span>,<br/>
&nbsp;&nbsp;<span class="id">LTL.find_function</span> <span class="id">tge</span> <span class="id">ros</span>' <span class="id">ls</span> = <span class="id">Some</span> <span class="id">tfd</span> /\ <span class="id">transf_fundef</span> <span class="id">fd</span> = <span class="id">OK</span> <span class="id">tfd</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3546')">Proof.</div>
<div class="proofscript" id="proof3546">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">RTL.find_function</span>, <span class="id">LTL.find_function</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">ros</span> <span class="kwd">as</span> [<span class="id">r</span>|<span class="id">id</span>]; <span class="tactic">destruct</span> <span class="id">ros</span>' <span class="kwd">as</span> [<span class="id">r</span>'|<span class="id">id</span>']; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="id">MonadInv</span>.<br/>
&nbsp;two&nbsp;regs&nbsp;*)</span>&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">add_equation_lessdef</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> <span class="id">LD</span>. <span class="id">inv</span> <span class="id">LD</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">functions_translated</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;two&nbsp;symbols&nbsp;*)</span>&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">symbols_preserved</span>. <span class="tactic">rewrite</span> <span class="id">Heqo</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">function_ptr_translated</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">exec_moves</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">mv</span> <span class="id">env</span> <span class="id">rs</span> <span class="id">s</span> <span class="id">f</span> <span class="id">sp</span> <span class="id">bb</span> <span class="id">m</span> <span class="id">e</span> <span class="id">e</span>' <span class="id">ls</span>,<br/>
&nbsp;&nbsp;<span class="id">track_moves</span> <span class="id">env</span> <span class="id">mv</span> <span class="id">e</span> = <span class="id">Some</span> <span class="id">e</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">wf_moves</span> <span class="id">mv</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">wt_regset</span> <span class="id">env</span> <span class="id">rs</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">ls</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">star</span> <span class="id">step</span> <span class="id">tge</span> (<span class="id">Block</span> <span class="id">s</span> <span class="id">f</span> <span class="id">sp</span> (<span class="id">expand_moves</span> <span class="id">mv</span> <span class="id">bb</span>) <span class="id">ls</span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">E0</span> (<span class="id">Block</span> <span class="id">s</span> <span class="id">f</span> <span class="id">sp</span> <span class="id">bb</span> <span class="id">ls</span>' <span class="id">m</span>)<br/>
&nbsp;&nbsp;/\ <span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span>' <span class="id">e</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3547')">Proof.</div>
<div class="proofscript" id="proof3547">
<span class="id">Opaque</span> <span class="id">destroyed_by_op</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">mv</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;base&nbsp;*)</span>- <span class="tactic">unfold</span> <span class="id">expand_moves</span>; <span class="tactic">simpl</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="id">exists</span> <span class="id">ls</span>; <span class="tactic">split</span>. <span class="tactic">apply</span> <span class="id">star_refl</span>. <span class="tactic">auto</span>.<br/>
&nbsp;step&nbsp;*)</span>- <span class="tactic">assert</span> (<span class="id">wf_moves</span> <span class="id">mv</span>) <span class="tactic">by</span> (<span class="id">inv</span> <span class="id">H0</span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span> <span class="kwd">as</span> (<span class="id">src</span>, <span class="id">dst</span>); <span class="tactic">unfold</span> <span class="id">expand_moves</span>; <span class="tactic">simpl</span>; <span class="id">MonadInv</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">src</span> <span class="kwd">as</span> [<span class="id">rsrc</span> | <span class="id">ssrc</span>]; <span class="tactic">destruct</span> <span class="id">dst</span> <span class="kwd">as</span> [<span class="id">rdst</span> | <span class="id">sdst</span>].<br/>
* <span class="comment">(*&nbsp;reg-reg&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">IHmv</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">subst_loc_undef_satisf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">ls</span>' [<span class="id">A</span> <span class="id">B</span>]]. <span class="id">exists</span> <span class="id">ls</span>'; <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">eapply</span> <span class="id">star_left</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>. <span class="tactic">auto</span>. <span class="tactic">auto</span>.<br/>
* <span class="comment">(*&nbsp;reg-&gt;stack&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">IHmv</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">subst_loc_undef_satisf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">ls</span>' [<span class="id">A</span> <span class="id">B</span>]]. <span class="id">exists</span> <span class="id">ls</span>'; <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">eapply</span> <span class="id">star_left</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>. <span class="tactic">auto</span>.<br/>
* <span class="comment">(*&nbsp;stack-&gt;reg&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Heqb</span>. <span class="id">exploit</span> <span class="id">IHmv</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">subst_loc_undef_satisf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">ls</span>' [<span class="id">A</span> <span class="id">B</span>]]. <span class="id">exists</span> <span class="id">ls</span>'; <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">eapply</span> <span class="id">star_left</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="tactic">auto</span>. <span class="tactic">auto</span>.<br/>
* <span class="comment">(*&nbsp;stack-&gt;stack&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H6</span>. <span class="id">contradiction</span>.<br/>
Qed.</div>
<br/>
<div class="doc">The simulation relation </div>
<br/>
<span class="kwd">Inductive</span> <span class="id">match_stackframes</span>: <span class="id">list</span> <span class="id">RTL.stackframe</span> -&gt; <span class="id">list</span> <span class="id">LTL.stackframe</span> -&gt; <span class="id">signature</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id">match_stackframes_nil</span>: <span class="kwd">forall</span> <span class="id">sg</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sg</span>.(<span class="id">sig_res</span>) = <span class="id">Some</span> <span class="id">Tint</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_stackframes</span> <span class="id">nil</span> <span class="id">nil</span> <span class="id">sg</span><br/>
&nbsp;&nbsp;| <span class="id">match_stackframes_cons</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">res</span> <span class="id">f</span> <span class="id">sp</span> <span class="id">pc</span> <span class="id">rs</span> <span class="id">s</span> <span class="id">tf</span> <span class="id">bb</span> <span class="id">ls</span> <span class="id">ts</span> <span class="id">sg</span> <span class="id">an</span> <span class="id">e</span> <span class="id">env</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">STACKS</span>: <span class="id">match_stackframes</span> <span class="id">s</span> <span class="id">ts</span> (<span class="id">fn_sig</span> <span class="id">tf</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FUN</span>: <span class="id">transf_function</span> <span class="id">f</span> = <span class="id">OK</span> <span class="id">tf</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ANL</span>: <span class="id">analyze</span> <span class="id">f</span> <span class="id">env</span> (<span class="id">pair_codes</span> <span class="id">f</span> <span class="id">tf</span>) = <span class="id">Some</span> <span class="id">an</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">EQ</span>: <span class="id">transfer</span> <span class="id">f</span> <span class="id">env</span> (<span class="id">pair_codes</span> <span class="id">f</span> <span class="id">tf</span>) <span class="id">pc</span> <span class="id">an</span>!!<span class="id">pc</span> = <span class="id">OK</span> <span class="id">e</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">WTF</span>: <span class="id">wt_function</span> <span class="id">f</span> <span class="id">env</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">WTRS</span>: <span class="id">wt_regset</span> <span class="id">env</span> <span class="id">rs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">WTRES</span>: <span class="id">env</span> <span class="id">res</span> = <span class="id">proj_sig_res</span> <span class="id">sg</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">STEPS</span>: <span class="kwd">forall</span> <span class="id">v</span> <span class="id">ls1</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Val.lessdef</span> <span class="id">v</span> (<span class="id">Locmap.getpair</span> (<span class="id">map_rpair</span> <span class="id">R</span> (<span class="id">loc_result</span> <span class="id">sg</span>)) <span class="id">ls1</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Val.has_type</span> <span class="id">v</span> (<span class="id">env</span> <span class="id">res</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">agree_callee_save</span> <span class="id">ls</span> <span class="id">ls1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">ls2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">star</span> <span class="id">LTL.step</span> <span class="id">tge</span> (<span class="id">Block</span> <span class="id">ts</span> <span class="id">tf</span> <span class="id">sp</span> <span class="id">bb</span> <span class="id">ls1</span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">E0</span> (<span class="id">State</span> <span class="id">ts</span> <span class="id">tf</span> <span class="id">sp</span> <span class="id">pc</span> <span class="id">ls2</span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id">satisf</span> (<span class="id">rs</span>#<span class="id">res</span> &lt;- <span class="id">v</span>) <span class="id">ls2</span> <span class="id">e</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_stackframes</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">RTL.Stackframe</span> <span class="id">res</span> <span class="id">f</span> <span class="id">sp</span> <span class="id">pc</span> <span class="id">rs</span> :: <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">LTL.Stackframe</span> <span class="id">tf</span> <span class="id">sp</span> <span class="id">ls</span> <span class="id">bb</span> :: <span class="id">ts</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sg</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">match_states</span>: <span class="id">RTL.state</span> -&gt; <span class="id">LTL.state</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id">match_states_intro</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">f</span> <span class="id">sp</span> <span class="id">pc</span> <span class="id">rs</span> <span class="id">m</span> <span class="id">ts</span> <span class="id">tf</span> <span class="id">ls</span> <span class="id">m</span>' <span class="id">an</span> <span class="id">e</span> <span class="id">env</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">STACKS</span>: <span class="id">match_stackframes</span> <span class="id">s</span> <span class="id">ts</span> (<span class="id">fn_sig</span> <span class="id">tf</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FUN</span>: <span class="id">transf_function</span> <span class="id">f</span> = <span class="id">OK</span> <span class="id">tf</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ANL</span>: <span class="id">analyze</span> <span class="id">f</span> <span class="id">env</span> (<span class="id">pair_codes</span> <span class="id">f</span> <span class="id">tf</span>) = <span class="id">Some</span> <span class="id">an</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">EQ</span>: <span class="id">transfer</span> <span class="id">f</span> <span class="id">env</span> (<span class="id">pair_codes</span> <span class="id">f</span> <span class="id">tf</span>) <span class="id">pc</span> <span class="id">an</span>!!<span class="id">pc</span> = <span class="id">OK</span> <span class="id">e</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SAT</span>: <span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls</span> <span class="id">e</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MEM</span>: <span class="id">Mem.extends</span> <span class="id">m</span> <span class="id">m</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">WTF</span>: <span class="id">wt_function</span> <span class="id">f</span> <span class="id">env</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">WTRS</span>: <span class="id">wt_regset</span> <span class="id">env</span> <span class="id">rs</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_states</span> (<span class="id">RTL.State</span> <span class="id">s</span> <span class="id">f</span> <span class="id">sp</span> <span class="id">pc</span> <span class="id">rs</span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">LTL.State</span> <span class="id">ts</span> <span class="id">tf</span> <span class="id">sp</span> <span class="id">pc</span> <span class="id">ls</span> <span class="id">m</span>')<br/>
&nbsp;&nbsp;| <span class="id">match_states_call</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">f</span> <span class="id">args</span> <span class="id">m</span> <span class="id">ts</span> <span class="id">tf</span> <span class="id">ls</span> <span class="id">m</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">STACKS</span>: <span class="id">match_stackframes</span> <span class="id">s</span> <span class="id">ts</span> (<span class="id">funsig</span> <span class="id">tf</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FUN</span>: <span class="id">transf_fundef</span> <span class="id">f</span> = <span class="id">OK</span> <span class="id">tf</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ARGS</span>: <span class="id">Val.lessdef_list</span> <span class="id">args</span> (<span class="id">map</span> (<span class="kwd">fun</span> <span class="id">p</span> =&gt; <span class="id">Locmap.getpair</span> <span class="id">p</span> <span class="id">ls</span>) (<span class="id">loc_arguments</span> (<span class="id">funsig</span> <span class="id">tf</span>))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">AG</span>: <span class="id">agree_callee_save</span> (<span class="id">parent_locset</span> <span class="id">ts</span>) <span class="id">ls</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MEM</span>: <span class="id">Mem.extends</span> <span class="id">m</span> <span class="id">m</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">WTARGS</span>: <span class="id">Val.has_type_list</span> <span class="id">args</span> (<span class="id">sig_args</span> (<span class="id">funsig</span> <span class="id">tf</span>))),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_states</span> (<span class="id">RTL.Callstate</span> <span class="id">s</span> <span class="id">f</span> <span class="id">args</span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">LTL.Callstate</span> <span class="id">ts</span> <span class="id">tf</span> <span class="id">ls</span> <span class="id">m</span>')<br/>
&nbsp;&nbsp;| <span class="id">match_states_return</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">res</span> <span class="id">m</span> <span class="id">ts</span> <span class="id">ls</span> <span class="id">m</span>' <span class="id">sg</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">STACKS</span>: <span class="id">match_stackframes</span> <span class="id">s</span> <span class="id">ts</span> <span class="id">sg</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">RES</span>: <span class="id">Val.lessdef</span> <span class="id">res</span> (<span class="id">Locmap.getpair</span> (<span class="id">map_rpair</span> <span class="id">R</span> (<span class="id">loc_result</span> <span class="id">sg</span>)) <span class="id">ls</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">AG</span>: <span class="id">agree_callee_save</span> (<span class="id">parent_locset</span> <span class="id">ts</span>) <span class="id">ls</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MEM</span>: <span class="id">Mem.extends</span> <span class="id">m</span> <span class="id">m</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">WTRES</span>: <span class="id">Val.has_type</span> <span class="id">res</span> (<span class="id">proj_sig_res</span> <span class="id">sg</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_states</span> (<span class="id">RTL.Returnstate</span> <span class="id">s</span> <span class="id">res</span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">LTL.Returnstate</span> <span class="id">ts</span> <span class="id">ls</span> <span class="id">m</span>').<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">match_stackframes_change_sig</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">ts</span> <span class="id">sg</span> <span class="id">sg</span>',<br/>
&nbsp;&nbsp;<span class="id">match_stackframes</span> <span class="id">s</span> <span class="id">ts</span> <span class="id">sg</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">sg</span>'.(<span class="id">sig_res</span>) = <span class="id">sg</span>.(<span class="id">sig_res</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">match_stackframes</span> <span class="id">s</span> <span class="id">ts</span> <span class="id">sg</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3548')">Proof.</div>
<div class="proofscript" id="proof3548">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">proj_sig_res</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">H0</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> (<span class="id">loc_result_exten</span> <span class="id">sg</span>' <span class="id">sg</span>) <span class="kwd">in</span> <span class="id">H</span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Ltac</span> <span class="id">UseShape</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [ <span class="id">WT</span>: <span class="id">wt_function</span> <span class="id">_</span> <span class="id">_</span>, <span class="id">CODE</span>: (<span class="id">RTL.fn_code</span> <span class="id">_</span>)!<span class="id">_</span> = <span class="id">Some</span> <span class="id">_</span>, <span class="id">EQ</span>: <span class="id">transfer</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> = <span class="id">OK</span> <span class="id">_</span> |- <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">invert_code</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">WT</span> <span class="id">CODE</span> <span class="id">EQ</span>) <span class="kwd">as</span> (<span class="id">eafter</span> &amp; <span class="id">bsh</span> &amp; <span class="id">bb</span> &amp; <span class="id">AFTER</span> &amp; <span class="id">BSH</span> &amp; <span class="id">TCODE</span> &amp; <span class="id">EBS</span> &amp; <span class="id">TR</span> &amp; <span class="id">WTI</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">EBS</span>; <span class="tactic">unfold</span> <span class="id">transfer_aux</span> <span class="kwd">in</span> <span class="id">TR</span>; <span class="id">MonadInv</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Remark</span> <span class="id">addressing_not_long</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span> <span class="id">f</span> <span class="id">addr</span> <span class="id">args</span> <span class="id">dst</span> <span class="id">s</span> <span class="id">r</span>,<br/>
&nbsp;&nbsp;<span class="id">wt_instr</span> <span class="id">f</span> <span class="id">env</span> (<span class="id">Iload</span> <span class="id">Mint64</span> <span class="id">addr</span> <span class="id">args</span> <span class="id">dst</span> <span class="id">s</span>) -&gt; <span class="id">Archi.splitlong</span> = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">In</span> <span class="id">r</span> <span class="id">args</span> -&gt; <span class="id">r</span> &lt;&gt; <span class="id">dst</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3549')">Proof.</div>
<div class="proofscript" id="proof3549">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">A</span>: <span class="kwd">forall</span> <span class="id">ty</span>, <span class="id">In</span> <span class="id">ty</span> (<span class="id">type_of_addressing</span> <span class="id">addr</span>) -&gt; <span class="id">ty</span> = <span class="id">Tptr</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">addr</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">intuition</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">B</span>: <span class="id">In</span> (<span class="id">env</span> <span class="id">r</span>) (<span class="id">type_of_addressing</span> <span class="id">addr</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">rewrite</span> &lt;- <span class="id">H5</span>. <span class="tactic">apply</span> <span class="id">in_map</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">C</span>: <span class="id">env</span> <span class="id">r</span> = <span class="id">Tint</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">A</span> <span class="kwd">in</span> <span class="id">B</span>. <span class="tactic">rewrite</span> <span class="id">B</span>. <span class="tactic">unfold</span> <span class="id">Tptr</span>. <span class="tactic">rewrite</span> <span class="id">Archi.splitlong_ptr32</span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">auto</span>. }    <br/>
&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">intros</span>; <span class="tactic">subst</span> <span class="id">r</span>. <span class="tactic">rewrite</span> <span class="id">C</span> <span class="kwd">in</span> <span class="id">H8</span>; <span class="tactic">discriminate</span>.<br/>
Qed.</div>
<br/>
<div class="doc">The proof of semantic preservation is a simulation argument of the
    "plus" kind. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id">step_simulation</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">S1</span> <span class="id">t</span> <span class="id">S2</span>, <span class="id">RTL.step</span> <span class="id">ge</span> <span class="id">S1</span> <span class="id">t</span> <span class="id">S2</span> -&gt; <span class="id">wt_state</span> <span class="id">S1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">S1</span>', <span class="id">match_states</span> <span class="id">S1</span> <span class="id">S1</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">S2</span>', <span class="id">plus</span> <span class="id">LTL.step</span> <span class="id">tge</span> <span class="id">S1</span>' <span class="id">t</span> <span class="id">S2</span>' /\ <span class="id">match_states</span> <span class="id">S2</span> <span class="id">S2</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3550')">Proof.</div>
<div class="proofscript" id="proof3550">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">intros</span> <span class="id">WT</span> <span class="id">S1</span>' <span class="id">MS</span>; <span class="id">inv</span> <span class="id">MS</span>; <span class="tactic">try</span> <span class="id">UseShape</span>.<br/>
<br/>
&nbsp;nop&nbsp;*)</span>- <span class="id">exploit</span> <span class="id">exec_moves</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">ls1</span> [<span class="id">X</span> <span class="id">Y</span>]].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">plus_left</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_right</span>. <span class="id">eexact</span> <span class="id">X</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="id">traceEq</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">satisf_successors</span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">enext</span> [<span class="id">U</span> <span class="id">V</span>]].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;op&nbsp;move&nbsp;*)</span>- <span class="tactic">generalize</span> (<span class="id">wt_exec_Iop</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">WTI</span> <span class="id">H0</span> <span class="id">WTRS</span>). <span class="tactic">intros</span> <span class="id">WTRS</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">exec_moves</span> <span class="id">mv</span>); <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">ls1</span> [<span class="id">X</span> <span class="id">Y</span>]].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">plus_left</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_right</span>. <span class="id">eexact</span> <span class="id">X</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="id">traceEq</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">satisf_successors</span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">subst_reg_satisf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">enext</span> [<span class="id">U</span> <span class="id">V</span>]].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;op&nbsp;makelong&nbsp;*)</span>- <span class="tactic">generalize</span> (<span class="id">wt_exec_Iop</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">WTI</span> <span class="id">H0</span> <span class="id">WTRS</span>). <span class="tactic">intros</span> <span class="id">WTRS</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">exec_moves</span> <span class="id">mv</span>); <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">ls1</span> [<span class="id">X</span> <span class="id">Y</span>]].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">plus_left</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_right</span>. <span class="id">eexact</span> <span class="id">X</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="id">traceEq</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">satisf_successors</span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">subst_reg_kind_satisf_makelong</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">enext</span> [<span class="id">U</span> <span class="id">V</span>]].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;op&nbsp;lowlong&nbsp;*)</span>- <span class="tactic">generalize</span> (<span class="id">wt_exec_Iop</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">WTI</span> <span class="id">H0</span> <span class="id">WTRS</span>). <span class="tactic">intros</span> <span class="id">WTRS</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">exec_moves</span> <span class="id">mv</span>); <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">ls1</span> [<span class="id">X</span> <span class="id">Y</span>]].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">plus_left</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_right</span>. <span class="id">eexact</span> <span class="id">X</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="id">traceEq</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">satisf_successors</span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">subst_reg_kind_satisf_lowlong</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">enext</span> [<span class="id">U</span> <span class="id">V</span>]].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;op&nbsp;highlong&nbsp;*)</span>- <span class="tactic">generalize</span> (<span class="id">wt_exec_Iop</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">WTI</span> <span class="id">H0</span> <span class="id">WTRS</span>). <span class="tactic">intros</span> <span class="id">WTRS</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">exec_moves</span> <span class="id">mv</span>); <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">ls1</span> [<span class="id">X</span> <span class="id">Y</span>]].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">plus_left</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_right</span>. <span class="id">eexact</span> <span class="id">X</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="id">traceEq</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">satisf_successors</span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">subst_reg_kind_satisf_highlong</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">enext</span> [<span class="id">U</span> <span class="id">V</span>]].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;op&nbsp;regular&nbsp;*)</span>- <span class="tactic">generalize</span> (<span class="id">wt_exec_Iop</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">WTI</span> <span class="id">H0</span> <span class="id">WTRS</span>). <span class="tactic">intros</span> <span class="id">WTRS</span>'.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">exec_moves</span> <span class="id">mv1</span>); <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">ls1</span> [<span class="id">A1</span> <span class="id">B1</span>]].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">transfer_use_def_satisf</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">X</span> <span class="id">Y</span>].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">eval_operation_lessdef</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">v</span>' [<span class="id">F</span> <span class="id">G</span>]].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">exec_moves</span> <span class="id">mv2</span>); <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">ls2</span> [<span class="id">A2</span> <span class="id">B2</span>]].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">plus_left</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_trans</span>. <span class="id">eexact</span> <span class="id">A1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_left</span>. <span class="id">econstructor</span>. <span class="id">instantiate</span> (1 := <span class="id">v</span>'). <span class="tactic">rewrite</span> &lt;- <span class="id">F</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">eval_operation_preserved</span>. <span class="tactic">exact</span> <span class="id">symbols_preserved</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">star_right</span>. <span class="id">eexact</span> <span class="id">A2</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="id">traceEq</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">satisf_successors</span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">enext</span> [<span class="id">U</span> <span class="id">V</span>]].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;op&nbsp;dead&nbsp;*)</span>- <span class="id">exploit</span> <span class="id">exec_moves</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">ls1</span> [<span class="id">X</span> <span class="id">Y</span>]].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">plus_left</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_right</span>. <span class="id">eexact</span> <span class="id">X</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="id">traceEq</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">satisf_successors</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">simpl</span>; <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">reg_unconstrained_satisf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">enext</span> [<span class="id">U</span> <span class="id">V</span>]].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">wt_exec_Iop</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;load&nbsp;regular&nbsp;*)</span>- <span class="tactic">generalize</span> (<span class="id">wt_exec_Iload</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">WTI</span> <span class="id">H1</span> <span class="id">WTRS</span>). <span class="tactic">intros</span> <span class="id">WTRS</span>'.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">exec_moves</span> <span class="id">mv1</span>); <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">ls1</span> [<span class="id">A1</span> <span class="id">B1</span>]].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">transfer_use_def_satisf</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">X</span> <span class="id">Y</span>].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">eval_addressing_lessdef</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">a</span>' [<span class="id">F</span> <span class="id">G</span>]].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Mem.loadv_extends</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">v</span>' [<span class="id">P</span> <span class="id">Q</span>]].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">exec_moves</span> <span class="id">mv2</span>); <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">ls2</span> [<span class="id">A2</span> <span class="id">B2</span>]].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">plus_left</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_trans</span>. <span class="id">eexact</span> <span class="id">A1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_left</span>. <span class="id">econstructor</span>. <span class="id">instantiate</span> (1 := <span class="id">a</span>'). <span class="tactic">rewrite</span> &lt;- <span class="id">F</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">eval_addressing_preserved</span>. <span class="tactic">exact</span> <span class="id">symbols_preserved</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_right</span>. <span class="id">eexact</span> <span class="id">A2</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="id">traceEq</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">satisf_successors</span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">enext</span> [<span class="id">U</span> <span class="id">V</span>]].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;load&nbsp;pair&nbsp;*)</span>- <span class="tactic">generalize</span> (<span class="id">wt_exec_Iload</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">WTI</span> <span class="id">H1</span> <span class="id">WTRS</span>). <span class="tactic">intros</span> <span class="id">WTRS</span>'.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">loadv_int64_split</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">v1</span> &amp; <span class="id">v2</span> &amp; <span class="id">LOAD1</span> &amp; <span class="id">LOAD2</span> &amp; <span class="id">V1</span> &amp; <span class="id">V2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">v2</span>' := <span class="kwd">if</span> <span class="id">Archi.big_endian</span> <span class="kwd">then</span> <span class="id">v2</span> <span class="kwd">else</span> <span class="id">v1</span>) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">v1</span>' := <span class="kwd">if</span> <span class="id">Archi.big_endian</span> <span class="kwd">then</span> <span class="id">v1</span> <span class="kwd">else</span> <span class="id">v2</span>) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">exec_moves</span> <span class="id">mv1</span>); <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">ls1</span> [<span class="id">A1</span> <span class="id">B1</span>]].<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">LD1</span>: <span class="id">Val.lessdef_list</span> <span class="id">rs</span>##<span class="id">args</span> (<span class="id">reglist</span> <span class="id">ls1</span> <span class="id">args1</span>')).<br/>
&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">add_equations_lessdef</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">eval_addressing_lessdef</span>. <span class="id">eexact</span> <span class="id">LD1</span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">a1</span>' [<span class="id">F1</span> <span class="id">G1</span>]].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Mem.loadv_extends</span>. <span class="tactic">eauto</span>. <span class="id">eexact</span> <span class="id">LOAD1</span>. <span class="id">eexact</span> <span class="id">G1</span>. <span class="tactic">intros</span> (<span class="id">v1</span>'' &amp; <span class="id">LOAD1</span>' &amp; <span class="id">LD2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">ls2</span> := <span class="id">Locmap.set</span> (<span class="id">R</span> <span class="id">dst1</span>') <span class="id">v1</span>'' (<span class="id">undef_regs</span> (<span class="id">destroyed_by_load</span> <span class="id">Mint32</span> <span class="id">addr</span>) <span class="id">ls1</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">SAT2</span>: <span class="id">satisf</span> (<span class="id">rs</span>#<span class="id">dst</span> &lt;- <span class="id">v</span>) <span class="id">ls2</span> <span class="id">e2</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">loc_unconstrained_satisf</span>. <span class="tactic">eapply</span> <span class="id">can_undef_satisf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">reg_unconstrained_satisf</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">add_equations_satisf</span>; <span class="tactic">eauto</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Regmap.gss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Val.lessdef_trans</span> <span class="kwd">with</span> <span class="id">v1</span>'; <span class="tactic">unfold</span> <span class="id">sel_val</span>; <span class="tactic">unfold</span> <span class="id">kind_first_word</span>; <span class="tactic">unfold</span> <span class="id">v1</span>'; <span class="tactic">destruct</span> <span class="id">Archi.big_endian</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">exec_moves</span> <span class="id">mv2</span>); <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">ls3</span> [<span class="id">A3</span> <span class="id">B3</span>]].<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">LD3</span>: <span class="id">Val.lessdef_list</span> <span class="id">rs</span>##<span class="id">args</span> (<span class="id">reglist</span> <span class="id">ls3</span> <span class="id">args2</span>')).<br/>
&nbsp;&nbsp;{ <span class="tactic">replace</span> (<span class="id">rs</span>##<span class="id">args</span>) <span class="kwd">with</span> ((<span class="id">rs</span>#<span class="id">dst</span>&lt;-<span class="id">v</span>)##<span class="id">args</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">add_equations_lessdef</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">list_map_exten</span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">Regmap.gso</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">addressing_not_long</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">eval_addressing_lessdef</span>. <span class="id">eexact</span> <span class="id">LD3</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">eval_offset_addressing</span>; <span class="tactic">eauto</span>; <span class="tactic">apply</span> <span class="id">Archi.splitlong_ptr32</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">a2</span>' [<span class="id">F2</span> <span class="id">G2</span>]].<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">LOADX</span>: <span class="id">exists</span> <span class="id">v2</span>'', <span class="id">Mem.loadv</span> <span class="id">Mint32</span> <span class="id">m</span>' <span class="id">a2</span>' = <span class="id">Some</span> <span class="id">v2</span>'' /\ <span class="id">Val.lessdef</span> <span class="id">v2</span>' <span class="id">v2</span>'').<br/>
&nbsp;&nbsp;{ <span class="tactic">discriminate</span> || (<span class="tactic">eapply</span> <span class="id">Mem.loadv_extends</span>; [<span class="tactic">eauto</span>|<span class="id">eexact</span> <span class="id">LOAD2</span>|<span class="id">eexact</span> <span class="id">G2</span>]). }<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">LOADX</span> <span class="kwd">as</span> (<span class="id">v2</span>'' &amp; <span class="id">LOAD2</span>' &amp; <span class="id">LD4</span>).<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">ls4</span> := <span class="id">Locmap.set</span> (<span class="id">R</span> <span class="id">dst2</span>') <span class="id">v2</span>'' (<span class="id">undef_regs</span> (<span class="id">destroyed_by_load</span> <span class="id">Mint32</span> <span class="id">addr2</span>) <span class="id">ls3</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">SAT4</span>: <span class="id">satisf</span> (<span class="id">rs</span>#<span class="id">dst</span> &lt;- <span class="id">v</span>) <span class="id">ls4</span> <span class="id">e0</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">loc_unconstrained_satisf</span>. <span class="tactic">eapply</span> <span class="id">can_undef_satisf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">add_equations_satisf</span>; <span class="tactic">eauto</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Regmap.gss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Val.lessdef_trans</span> <span class="kwd">with</span> <span class="id">v2</span>'; <span class="tactic">unfold</span> <span class="id">sel_val</span>; <span class="tactic">unfold</span> <span class="id">kind_second_word</span>; <span class="tactic">unfold</span> <span class="id">v2</span>'; <span class="tactic">destruct</span> <span class="id">Archi.big_endian</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">exec_moves</span> <span class="id">mv3</span>); <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">ls5</span> [<span class="id">A5</span> <span class="id">B5</span>]].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">plus_left</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_trans</span>. <span class="id">eexact</span> <span class="id">A1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_left</span>. <span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id">a1</span>'). <span class="tactic">rewrite</span> &lt;- <span class="id">F1</span>. <span class="tactic">apply</span> <span class="id">eval_addressing_preserved</span>. <span class="tactic">exact</span> <span class="id">symbols_preserved</span>.<br/>
&nbsp;&nbsp;<span class="id">eexact</span> <span class="id">LOAD1</span>'. <span class="id">instantiate</span> (1 := <span class="id">ls2</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_trans</span>. <span class="id">eexact</span> <span class="id">A3</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_left</span>. <span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id">a2</span>'). <span class="tactic">rewrite</span> &lt;- <span class="id">F2</span>. <span class="tactic">apply</span> <span class="id">eval_addressing_preserved</span>. <span class="tactic">exact</span> <span class="id">symbols_preserved</span>.<br/>
&nbsp;&nbsp;<span class="id">eexact</span> <span class="id">LOAD2</span>'. <span class="id">instantiate</span> (1 := <span class="id">ls4</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_right</span>. <span class="id">eexact</span> <span class="id">A5</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="id">traceEq</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">satisf_successors</span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">enext</span> [<span class="id">W</span> <span class="id">Z</span>]].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;load&nbsp;first&nbsp;word&nbsp;of&nbsp;a&nbsp;pair&nbsp;*)</span>- <span class="tactic">generalize</span> (<span class="id">wt_exec_Iload</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">WTI</span> <span class="id">H1</span> <span class="id">WTRS</span>). <span class="tactic">intros</span> <span class="id">WTRS</span>'.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">loadv_int64_split</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">v1</span> &amp; <span class="id">v2</span> &amp; <span class="id">LOAD1</span> &amp; <span class="id">LOAD2</span> &amp; <span class="id">V1</span> &amp; <span class="id">V2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">v2</span>' := <span class="kwd">if</span> <span class="id">Archi.big_endian</span> <span class="kwd">then</span> <span class="id">v2</span> <span class="kwd">else</span> <span class="id">v1</span>) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">v1</span>' := <span class="kwd">if</span> <span class="id">Archi.big_endian</span> <span class="kwd">then</span> <span class="id">v1</span> <span class="kwd">else</span> <span class="id">v2</span>) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">exec_moves</span> <span class="id">mv1</span>); <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">ls1</span> [<span class="id">A1</span> <span class="id">B1</span>]].<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">LD1</span>: <span class="id">Val.lessdef_list</span> <span class="id">rs</span>##<span class="id">args</span> (<span class="id">reglist</span> <span class="id">ls1</span> <span class="id">args</span>')).<br/>
&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">add_equations_lessdef</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">eval_addressing_lessdef</span>. <span class="id">eexact</span> <span class="id">LD1</span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">a1</span>' [<span class="id">F1</span> <span class="id">G1</span>]].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Mem.loadv_extends</span>. <span class="tactic">eauto</span>. <span class="id">eexact</span> <span class="id">LOAD1</span>. <span class="id">eexact</span> <span class="id">G1</span>. <span class="tactic">intros</span> (<span class="id">v1</span>'' &amp; <span class="id">LOAD1</span>' &amp; <span class="id">LD2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">ls2</span> := <span class="id">Locmap.set</span> (<span class="id">R</span> <span class="id">dst</span>') <span class="id">v1</span>'' (<span class="id">undef_regs</span> (<span class="id">destroyed_by_load</span> <span class="id">Mint32</span> <span class="id">addr</span>) <span class="id">ls1</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">SAT2</span>: <span class="id">satisf</span> (<span class="id">rs</span>#<span class="id">dst</span> &lt;- <span class="id">v</span>) <span class="id">ls2</span> <span class="id">e0</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">parallel_assignment_satisf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Val.lessdef_trans</span> <span class="kwd">with</span> <span class="id">v1</span>';<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">sel_val</span>; <span class="tactic">unfold</span> <span class="id">kind_first_word</span>; <span class="tactic">unfold</span> <span class="id">v1</span>'; <span class="tactic">destruct</span> <span class="id">Archi.big_endian</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">can_undef_satisf</span>. <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">add_equations_satisf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">exec_moves</span> <span class="id">mv2</span>); <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">ls3</span> [<span class="id">A3</span> <span class="id">B3</span>]].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">plus_left</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_trans</span>. <span class="id">eexact</span> <span class="id">A1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_left</span>. <span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id">a1</span>'). <span class="tactic">rewrite</span> &lt;- <span class="id">F1</span>. <span class="tactic">apply</span> <span class="id">eval_addressing_preserved</span>. <span class="tactic">exact</span> <span class="id">symbols_preserved</span>.<br/>
&nbsp;&nbsp;<span class="id">eexact</span> <span class="id">LOAD1</span>'. <span class="id">instantiate</span> (1 := <span class="id">ls2</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_right</span>. <span class="id">eexact</span> <span class="id">A3</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="id">traceEq</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">satisf_successors</span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">enext</span> [<span class="id">W</span> <span class="id">Z</span>]].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;load&nbsp;second&nbsp;word&nbsp;of&nbsp;a&nbsp;pair&nbsp;*)</span>- <span class="tactic">generalize</span> (<span class="id">wt_exec_Iload</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">WTI</span> <span class="id">H1</span> <span class="id">WTRS</span>). <span class="tactic">intros</span> <span class="id">WTRS</span>'.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">loadv_int64_split</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">v1</span> &amp; <span class="id">v2</span> &amp; <span class="id">LOAD1</span> &amp; <span class="id">LOAD2</span> &amp; <span class="id">V1</span> &amp; <span class="id">V2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">v2</span>' := <span class="kwd">if</span> <span class="id">Archi.big_endian</span> <span class="kwd">then</span> <span class="id">v2</span> <span class="kwd">else</span> <span class="id">v1</span>) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">v1</span>' := <span class="kwd">if</span> <span class="id">Archi.big_endian</span> <span class="kwd">then</span> <span class="id">v1</span> <span class="kwd">else</span> <span class="id">v2</span>) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">exec_moves</span> <span class="id">mv1</span>); <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">ls1</span> [<span class="id">A1</span> <span class="id">B1</span>]].<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">LD1</span>: <span class="id">Val.lessdef_list</span> <span class="id">rs</span>##<span class="id">args</span> (<span class="id">reglist</span> <span class="id">ls1</span> <span class="id">args</span>')).<br/>
&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">add_equations_lessdef</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">eval_addressing_lessdef</span>. <span class="id">eexact</span> <span class="id">LD1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">eval_offset_addressing</span>; <span class="tactic">eauto</span>; <span class="tactic">apply</span> <span class="id">Archi.splitlong_ptr32</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">a1</span>' [<span class="id">F1</span> <span class="id">G1</span>]].<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">LOADX</span>: <span class="id">exists</span> <span class="id">v2</span>'', <span class="id">Mem.loadv</span> <span class="id">Mint32</span> <span class="id">m</span>' <span class="id">a1</span>' = <span class="id">Some</span> <span class="id">v2</span>'' /\ <span class="id">Val.lessdef</span> <span class="id">v2</span>' <span class="id">v2</span>'').<br/>
&nbsp;&nbsp;{ <span class="tactic">discriminate</span> || (<span class="tactic">eapply</span> <span class="id">Mem.loadv_extends</span>; [<span class="tactic">eauto</span>|<span class="id">eexact</span> <span class="id">LOAD2</span>|<span class="id">eexact</span> <span class="id">G1</span>]). }<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">LOADX</span> <span class="kwd">as</span> (<span class="id">v2</span>'' &amp; <span class="id">LOAD2</span>' &amp; <span class="id">LD2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">ls2</span> := <span class="id">Locmap.set</span> (<span class="id">R</span> <span class="id">dst</span>') <span class="id">v2</span>'' (<span class="id">undef_regs</span> (<span class="id">destroyed_by_load</span> <span class="id">Mint32</span> <span class="id">addr2</span>) <span class="id">ls1</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">SAT2</span>: <span class="id">satisf</span> (<span class="id">rs</span>#<span class="id">dst</span> &lt;- <span class="id">v</span>) <span class="id">ls2</span> <span class="id">e0</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">parallel_assignment_satisf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Val.lessdef_trans</span> <span class="kwd">with</span> <span class="id">v2</span>'; <span class="tactic">unfold</span> <span class="id">sel_val</span>; <span class="tactic">unfold</span> <span class="id">kind_second_word</span>; <span class="tactic">unfold</span> <span class="id">v2</span>'; <span class="tactic">destruct</span> <span class="id">Archi.big_endian</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">can_undef_satisf</span>. <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">add_equations_satisf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">exec_moves</span> <span class="id">mv2</span>); <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">ls3</span> [<span class="id">A3</span> <span class="id">B3</span>]].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">plus_left</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_trans</span>. <span class="id">eexact</span> <span class="id">A1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_left</span>. <span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id">a1</span>'). <span class="tactic">rewrite</span> &lt;- <span class="id">F1</span>. <span class="tactic">apply</span> <span class="id">eval_addressing_preserved</span>. <span class="tactic">exact</span> <span class="id">symbols_preserved</span>.<br/>
&nbsp;&nbsp;<span class="id">eexact</span> <span class="id">LOAD2</span>'. <span class="id">instantiate</span> (1 := <span class="id">ls2</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_right</span>. <span class="id">eexact</span> <span class="id">A3</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="id">traceEq</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">satisf_successors</span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">enext</span> [<span class="id">W</span> <span class="id">Z</span>]].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;load&nbsp;dead&nbsp;*)</span>- <span class="id">exploit</span> <span class="id">exec_moves</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">ls1</span> [<span class="id">X</span> <span class="id">Y</span>]].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">plus_left</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_right</span>. <span class="id">eexact</span> <span class="id">X</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="id">traceEq</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">satisf_successors</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">simpl</span>; <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">reg_unconstrained_satisf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">enext</span> [<span class="id">U</span> <span class="id">V</span>]].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">wt_exec_Iload</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;store&nbsp;*)</span>- <span class="id">exploit</span> <span class="id">exec_moves</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">ls1</span> [<span class="id">X</span> <span class="id">Y</span>]].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">add_equations_lessdef</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> <span class="id">LD</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">LD</span>. <span class="id">inv</span> <span class="id">LD</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">eval_addressing_lessdef</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">a</span>' [<span class="id">F</span> <span class="id">G</span>]].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Mem.storev_extends</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">m</span>'' [<span class="id">P</span> <span class="id">Q</span>]].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">plus_left</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_trans</span>. <span class="id">eexact</span> <span class="id">X</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_two</span>. <span class="id">econstructor</span>. <span class="id">instantiate</span> (1 := <span class="id">a</span>'). <span class="tactic">rewrite</span> &lt;- <span class="id">F</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">eval_addressing_preserved</span>. <span class="tactic">exact</span> <span class="id">symbols_preserved</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="id">traceEq</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">satisf_successors</span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">can_undef_satisf</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">add_equations_satisf</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">enext</span> [<span class="id">U</span> <span class="id">V</span>]].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;store&nbsp;2&nbsp;*)</span>- <span class="tactic">assert</span> (<span class="id">SF</span>: <span class="id">Archi.ptr64</span> = <span class="id">false</span>) <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id">Archi.splitlong_ptr32</span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Mem.storev_int64_split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="kwd">if</span> <span class="id">Archi.big_endian</span> <span class="kwd">then</span> <span class="id">Val.hiword</span> <span class="id">rs</span>#<span class="id">src</span> <span class="kwd">else</span> <span class="id">Val.loword</span> <span class="id">rs</span>#<span class="id">src</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> (<span class="id">sel_val</span> <span class="id">kind_first_word</span> <span class="id">rs</span>#<span class="id">src</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span> (<span class="tactic">unfold</span> <span class="id">kind_first_word</span>; <span class="tactic">destruct</span> <span class="id">Archi.big_endian</span>; <span class="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="kwd">if</span> <span class="id">Archi.big_endian</span> <span class="kwd">then</span> <span class="id">Val.loword</span> <span class="id">rs</span>#<span class="id">src</span> <span class="kwd">else</span> <span class="id">Val.hiword</span> <span class="id">rs</span>#<span class="id">src</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> (<span class="id">sel_val</span> <span class="id">kind_second_word</span> <span class="id">rs</span>#<span class="id">src</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span> (<span class="tactic">unfold</span> <span class="id">kind_second_word</span>; <span class="tactic">destruct</span> <span class="id">Archi.big_endian</span>; <span class="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">m1</span> [<span class="id">STORE1</span> <span class="id">STORE2</span>]].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">exec_moves</span> <span class="id">mv1</span>); <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">ls1</span> [<span class="id">X</span> <span class="id">Y</span>]].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">add_equations_lessdef</span>. <span class="id">eexact</span> <span class="id">Heqo1</span>. <span class="id">eexact</span> <span class="id">Y</span>. <span class="tactic">intros</span> <span class="id">LD1</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">add_equation_lessdef</span>. <span class="tactic">eapply</span> <span class="id">add_equations_satisf</span>. <span class="id">eexact</span> <span class="id">Heqo1</span>. <span class="id">eexact</span> <span class="id">Y</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">intros</span> <span class="id">LD2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">ls2</span> := <span class="id">undef_regs</span> (<span class="id">destroyed_by_store</span> <span class="id">Mint32</span> <span class="id">addr</span>) <span class="id">ls1</span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">SAT2</span>: <span class="id">satisf</span> <span class="id">rs</span> <span class="id">ls2</span> <span class="id">e1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">can_undef_satisf</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">add_equation_satisf</span>. <span class="tactic">eapply</span> <span class="id">add_equations_satisf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">eval_addressing_lessdef</span>. <span class="id">eexact</span> <span class="id">LD1</span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">a1</span>' [<span class="id">F1</span> <span class="id">G1</span>]].<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">F1</span>': <span class="id">eval_addressing</span> <span class="id">tge</span> <span class="id">sp</span> <span class="id">addr</span> (<span class="id">reglist</span> <span class="id">ls1</span> <span class="id">args1</span>') = <span class="id">Some</span> <span class="id">a1</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">F1</span>. <span class="tactic">apply</span> <span class="id">eval_addressing_preserved</span>. <span class="tactic">exact</span> <span class="id">symbols_preserved</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Mem.storev_extends</span>. <span class="tactic">eauto</span>. <span class="id">eexact</span> <span class="id">STORE1</span>. <span class="id">eexact</span> <span class="id">G1</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">m1</span>' [<span class="id">STORE1</span>' <span class="id">EXT1</span>]].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">exec_moves</span> <span class="id">mv2</span>); <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">ls3</span> [<span class="id">U</span> <span class="id">V</span>]].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">add_equations_lessdef</span>. <span class="id">eexact</span> <span class="id">Heqo</span>. <span class="id">eexact</span> <span class="id">V</span>. <span class="tactic">intros</span> <span class="id">LD3</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">add_equation_lessdef</span>. <span class="tactic">eapply</span> <span class="id">add_equations_satisf</span>. <span class="id">eexact</span> <span class="id">Heqo</span>. <span class="id">eexact</span> <span class="id">V</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">intros</span> <span class="id">LD4</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">eval_addressing_lessdef</span>. <span class="id">eexact</span> <span class="id">LD3</span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">a2</span>' [<span class="id">F2</span> <span class="id">G2</span>]].<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">F2</span>': <span class="id">eval_addressing</span> <span class="id">tge</span> <span class="id">sp</span> <span class="id">addr</span> (<span class="id">reglist</span> <span class="id">ls3</span> <span class="id">args2</span>') = <span class="id">Some</span> <span class="id">a2</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">F2</span>. <span class="tactic">apply</span> <span class="id">eval_addressing_preserved</span>. <span class="tactic">exact</span> <span class="id">symbols_preserved</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">eval_offset_addressing</span> <span class="id">tge</span>); <span class="tactic">eauto</span>. <span class="tactic">intros</span> <span class="id">F2</span>''.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">STOREX</span>: <span class="id">exists</span> <span class="id">m2</span>', <span class="id">Mem.storev</span> <span class="id">Mint32</span> <span class="id">m1</span>' (<span class="id">Val.add</span> <span class="id">a2</span>' (<span class="id">Vint</span> (<span class="id">Int.repr</span> 4))) (<span class="id">ls3</span> (<span class="id">R</span> <span class="id">src2</span>')) = <span class="id">Some</span> <span class="id">m2</span>' /\ <span class="id">Mem.extends</span> <span class="id">m</span>' <span class="id">m2</span>').<br/>
&nbsp;&nbsp;{ <span class="tactic">try</span> <span class="tactic">discriminate</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">eapply</span> <span class="id">Mem.storev_extends</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">eexact</span> <span class="id">EXT1</span> | <span class="id">eexact</span> <span class="id">STORE2</span> | <span class="tactic">apply</span> <span class="id">Val.add_lessdef</span>; [<span class="id">eexact</span> <span class="id">G2</span>|<span class="tactic">eauto</span>] | <span class="tactic">eauto</span>]). }<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">STOREX</span> <span class="kwd">as</span> [<span class="id">m2</span>' [<span class="id">STORE2</span>' <span class="id">EXT2</span>]].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">plus_left</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_trans</span>. <span class="id">eexact</span> <span class="id">X</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_left</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="id">eexact</span> <span class="id">F1</span>'. <span class="id">eexact</span> <span class="id">STORE1</span>'. <span class="id">instantiate</span> (1 := <span class="id">ls2</span>). <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_trans</span>. <span class="id">eexact</span> <span class="id">U</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_two</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">exec_Lstore</span> <span class="kwd">with</span> (<span class="id">m</span>' := <span class="id">m2</span>'). <span class="id">eexact</span> <span class="id">F2</span>''. <span class="tactic">discriminate</span>||<span class="tactic">exact</span> <span class="id">STORE2</span>'. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="id">traceEq</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">satisf_successors</span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">can_undef_satisf</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">add_equation_satisf</span>. <span class="tactic">eapply</span> <span class="id">add_equations_satisf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">enext</span> [<span class="id">P</span> <span class="id">Q</span>]].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;call&nbsp;*)</span>- <span class="tactic">set</span> (<span class="id">sg</span> := <span class="id">RTL.funsig</span> <span class="id">fd</span>) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">args</span>' := <span class="id">loc_arguments</span> <span class="id">sg</span>) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">res</span>' := <span class="id">loc_result</span> <span class="id">sg</span>) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">exec_moves</span> <span class="id">mv1</span>); <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">ls1</span> [<span class="id">A1</span> <span class="id">B1</span>]].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">find_function_translated</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">add_equations_args_satisf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">tfd</span> [<span class="id">E</span> <span class="id">F</span>]].<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">SIG</span>: <span class="id">funsig</span> <span class="id">tfd</span> = <span class="id">sg</span>). <span class="tactic">eapply</span> <span class="id">sig_function_translated</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">plus_left</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_right</span>. <span class="id">eexact</span> <span class="id">A1</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="id">traceEq</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">analyze_successors</span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="id">left</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">enext</span> [<span class="id">U</span> <span class="id">V</span>]].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">WTI</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">exploit</span> (<span class="id">exec_moves</span> <span class="id">mv2</span>). <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">function_return_satisf</span> <span class="kwd">with</span> (<span class="id">v</span> := <span class="id">v</span>) (<span class="id">ls_before</span> := <span class="id">ls1</span>) (<span class="id">ls_after</span> := <span class="id">ls0</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">add_equation_ros_satisf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">add_equations_args_satisf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">wt_regset_assign</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">ls2</span> [<span class="id">A2</span> <span class="id">B2</span>]].<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">ls2</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_right</span>. <span class="id">eexact</span> <span class="id">A2</span>. <span class="id">constructor</span>. <span class="id">traceEq</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">satisf_incr</span> <span class="kwd">with</span> <span class="id">eafter</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">SIG</span>. <span class="tactic">eapply</span> <span class="id">add_equations_args_lessdef</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">WTI</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H7</span>. <span class="tactic">apply</span> <span class="id">wt_regset_list</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">red</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">WTI</span>. <span class="tactic">rewrite</span> <span class="id">SIG</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H7</span>. <span class="tactic">apply</span> <span class="id">wt_regset_list</span>; <span class="tactic">auto</span>.<br/>
<br/>
&nbsp;tailcall&nbsp;*)</span>- <span class="tactic">set</span> (<span class="id">sg</span> := <span class="id">RTL.funsig</span> <span class="id">fd</span>) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">args</span>' := <span class="id">loc_arguments</span> <span class="id">sg</span>) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Mem.free_parallel_extends</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">m</span>'' [<span class="id">P</span> <span class="id">Q</span>]].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">exec_moves</span> <span class="id">mv</span>); <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">ls1</span> [<span class="id">A1</span> <span class="id">B1</span>]].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">find_function_translated</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">add_equations_args_satisf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">tfd</span> [<span class="id">E</span> <span class="id">F</span>]].<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">SIG</span>: <span class="id">funsig</span> <span class="id">tfd</span> = <span class="id">sg</span>). <span class="tactic">eapply</span> <span class="id">sig_function_translated</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">plus_left</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_right</span>. <span class="id">eexact</span> <span class="id">A1</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">E</span>. <span class="tactic">apply</span> <span class="id">find_function_tailcall</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">fn_stacksize</span> <span class="id">tf</span>) <span class="kwd">with</span> (<span class="id">RTL.fn_stacksize</span> <span class="id">f</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">transf_function_inv</span> <span class="id">_</span> <span class="id">_</span> <span class="id">FUN</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="id">traceEq</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">match_stackframes_change_sig</span>; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">SIG</span>. <span class="tactic">rewrite</span> <span class="id">e0</span>. <span class="id">decEq</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">transf_function_inv</span> <span class="id">_</span> <span class="id">_</span> <span class="id">FUN</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">SIG</span>. <span class="tactic">rewrite</span> <span class="id">return_regs_arg_values</span>; <span class="tactic">auto</span>. <span class="tactic">eapply</span> <span class="id">add_equations_args_lessdef</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">WTI</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H6</span>. <span class="tactic">apply</span> <span class="id">wt_regset_list</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">return_regs_agree_callee_save</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">SIG</span>. <span class="id">inv</span> <span class="id">WTI</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H6</span>. <span class="tactic">apply</span> <span class="id">wt_regset_list</span>; <span class="tactic">auto</span>.<br/>
<br/>
&nbsp;builtin&nbsp;*)</span>- <span class="id">exploit</span> (<span class="id">exec_moves</span> <span class="id">mv1</span>); <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">ls1</span> [<span class="id">A1</span> <span class="id">B1</span>]].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">add_equations_builtin_eval</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">C</span> &amp; <span class="id">vargs</span>' &amp; <span class="id">vres</span>' &amp; <span class="id">m</span>'' &amp; <span class="id">D</span> &amp; <span class="id">E</span> &amp; <span class="id">F</span> &amp; <span class="id">G</span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">WTRS</span>': <span class="id">wt_regset</span> <span class="id">env</span> (<span class="id">regmap_setres</span> <span class="id">res</span> <span class="id">vres</span> <span class="id">rs</span>)) <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id">wt_exec_Ibuiltin</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">ls2</span> := <span class="id">Locmap.setres</span> <span class="id">res</span>' <span class="id">vres</span>' (<span class="id">undef_regs</span> (<span class="id">destroyed_by_builtin</span> <span class="id">ef</span>) <span class="id">ls1</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">satisf</span> (<span class="id">regmap_setres</span> <span class="id">res</span> <span class="id">vres</span> <span class="id">rs</span>) <span class="id">ls2</span> <span class="id">e0</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">parallel_set_builtin_res_satisf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">can_undef_satisf</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">exec_moves</span> <span class="id">mv2</span>); <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">ls3</span> [<span class="id">A3</span> <span class="id">B3</span>]].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">plus_left</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_trans</span>. <span class="id">eexact</span> <span class="id">A1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_left</span>. <span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">eval_builtin_args_preserved</span> <span class="kwd">with</span> (<span class="id">ge1</span> := <span class="id">ge</span>); <span class="tactic">eauto</span>. <span class="tactic">exact</span> <span class="id">symbols_preserved</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">external_call_symbols_preserved</span>. <span class="tactic">apply</span> <span class="id">senv_preserved</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id">ls2</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_right</span>. <span class="id">eexact</span> <span class="id">A3</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">reflexivity</span>. <span class="tactic">reflexivity</span>. <span class="tactic">reflexivity</span>. <span class="id">traceEq</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">satisf_successors</span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">enext</span> [<span class="id">U</span> <span class="id">V</span>]].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;cond&nbsp;*)</span>- <span class="id">exploit</span> (<span class="id">exec_moves</span> <span class="id">mv</span>); <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">ls1</span> [<span class="id">A1</span> <span class="id">B1</span>]].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">plus_left</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_right</span>. <span class="id">eexact</span> <span class="id">A1</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="tactic">eapply</span> <span class="id">eval_condition_lessdef</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">add_equations_lessdef</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="id">traceEq</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">satisf_successors</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="kwd">if</span> <span class="id">b</span> <span class="kwd">then</span> <span class="id">ifso</span> <span class="kwd">else</span> <span class="id">ifnot</span>). <span class="tactic">simpl</span>. <span class="tactic">destruct</span> <span class="id">b</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">can_undef_satisf</span>. <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">add_equations_satisf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">enext</span> [<span class="id">U</span> <span class="id">V</span>]].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;jumptable&nbsp;*)</span>- <span class="id">exploit</span> (<span class="id">exec_moves</span> <span class="id">mv</span>); <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">ls1</span> [<span class="id">A1</span> <span class="id">B1</span>]].<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Val.lessdef</span> (<span class="id">Vint</span> <span class="id">n</span>) (<span class="id">ls1</span> (<span class="id">R</span> <span class="id">arg</span>'))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H0</span>. <span class="tactic">eapply</span> <span class="id">add_equation_lessdef</span> <span class="kwd">with</span> (<span class="id">q</span> := <span class="id">Eq</span> <span class="id">Full</span> <span class="id">arg</span> (<span class="id">R</span> <span class="id">arg</span>')); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">plus_left</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_right</span>. <span class="id">eexact</span> <span class="id">A1</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="id">traceEq</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">satisf_successors</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id">pc</span>'). <span class="tactic">simpl</span>. <span class="tactic">eapply</span> <span class="id">list_nth_z_in</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">can_undef_satisf</span>. <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">add_equation_satisf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">enext</span> [<span class="id">U</span> <span class="id">V</span>]].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;return&nbsp;*)</span>- <span class="tactic">destruct</span> (<span class="id">transf_function_inv</span> <span class="id">_</span> <span class="id">_</span> <span class="id">FUN</span>).<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Mem.free_parallel_extends</span>; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">H10</span>. <span class="tactic">intros</span> [<span class="id">m</span>'' [<span class="id">P</span> <span class="id">Q</span>]].<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">WTI</span>; <span class="id">MonadInv</span>.<br/>
+ <span class="comment">(*&nbsp;without&nbsp;an&nbsp;argument&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">exec_moves</span> <span class="id">mv</span>); <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">ls1</span> [<span class="id">A1</span> <span class="id">B1</span>]].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">plus_left</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_right</span>. <span class="id">eexact</span> <span class="id">A1</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="id">traceEq</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">return_regs_agree_callee_save</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
+ <span class="comment">(*&nbsp;with&nbsp;an&nbsp;argument&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">exec_moves</span> <span class="id">mv</span>); <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">ls1</span> [<span class="id">A1</span> <span class="id">B1</span>]].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">plus_left</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_right</span>. <span class="id">eexact</span> <span class="id">A1</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="id">traceEq</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H11</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">Locmap.getpair</span> (<span class="id">map_rpair</span> <span class="id">R</span> (<span class="id">loc_result</span> (<span class="id">RTL.fn_sig</span> <span class="id">f</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">return_regs</span> (<span class="id">parent_locset</span> <span class="id">ts</span>) <span class="id">ls1</span>))<br/>
&nbsp;&nbsp;<span class="kwd">with</span> (<span class="id">Locmap.getpair</span> (<span class="id">map_rpair</span> <span class="id">R</span> (<span class="id">loc_result</span> (<span class="id">RTL.fn_sig</span> <span class="id">f</span>))) <span class="id">ls1</span>).<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">add_equations_res_lessdef</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H13</span>. <span class="tactic">apply</span> <span class="id">WTRS</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">loc_result_caller_save</span> (<span class="id">RTL.fn_sig</span> <span class="id">f</span>)). <br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">loc_result</span> (<span class="id">RTL.fn_sig</span> <span class="id">f</span>)); <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">A</span>; <span class="tactic">rewrite</span> <span class="id">A</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">A</span> <span class="id">B</span>]; <span class="tactic">rewrite</span> <span class="id">A</span>, <span class="id">B</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">return_regs_agree_callee_save</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">proj_sig_res</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H11</span>; <span class="tactic">rewrite</span> <span class="id">H13</span>. <span class="tactic">apply</span> <span class="id">WTRS</span>.<br/>
<br/>
&nbsp;internal&nbsp;function&nbsp;*)</span>- <span class="id">monadInv</span> <span class="id">FUN</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">transf_function_inv</span> <span class="id">_</span> <span class="id">_</span> <span class="id">EQ</span>).<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Mem.alloc_extends</span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">Zle_refl</span>. <span class="tactic">rewrite</span> <span class="id">H8</span>; <span class="tactic">apply</span> <span class="id">Zle_refl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">m</span>'' [<span class="id">U</span> <span class="id">V</span>]].<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">WTRS</span>: <span class="id">wt_regset</span> <span class="id">env</span> (<span class="id">init_regs</span> <span class="id">args</span> (<span class="id">fn_params</span> <span class="id">f</span>))).<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">wt_init_regs</span>. <span class="id">inv</span> <span class="id">H0</span>. <span class="tactic">rewrite</span> <span class="id">wt_params</span>. <span class="tactic">rewrite</span> <span class="id">H9</span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">exec_moves</span> <span class="id">mv</span>). <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">can_undef_satisf</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">compat_entry_satisf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">call_regs_param_values</span>. <span class="id">eexact</span> <span class="id">ARGS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">WTRS</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">ls1</span> [<span class="id">A</span> <span class="id">B</span>]].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">plus_left</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_left</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_right</span>. <span class="id">eexact</span> <span class="id">A</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="id">traceEq</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;external&nbsp;function&nbsp;*)</span>- <span class="id">exploit</span> <span class="id">external_call_mem_extends</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">v</span>' [<span class="id">m</span>'' [<span class="id">F</span> [<span class="id">G</span> [<span class="id">J</span> <span class="id">K</span>]]]]].<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">FUN</span>; <span class="id">inv</span> <span class="id">FUN</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">plus_one</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">external_call_symbols_preserved</span> <span class="kwd">with</span> (<span class="id">ge1</span> := <span class="id">ge</span>); <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">senv_preserved</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">destruct</span> (<span class="id">loc_result</span> (<span class="id">ef_sig</span> <span class="id">ef</span>)) <span class="id">eqn</span>:<span class="id">RES</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Locmap.gss</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">loc_result_pair</span> (<span class="id">ef_sig</span> <span class="id">ef</span>)); <span class="tactic">rewrite</span> <span class="id">RES</span>; <span class="tactic">intros</span> (<span class="id">A</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span> &amp; <span class="id">D</span> &amp; <span class="id">E</span>). <br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">external_call_well_typed</span>; <span class="tactic">eauto</span>. <span class="tactic">unfold</span> <span class="id">proj_sig_res</span>; <span class="tactic">rewrite</span> <span class="id">B</span>. <span class="tactic">intros</span> <span class="id">WTRES</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Locmap.gss</span>. <span class="tactic">rewrite</span> <span class="id">Locmap.gso</span> <span class="tactic">by</span> (<span class="tactic">red</span>; <span class="tactic">auto</span>). <span class="tactic">rewrite</span> <span class="id">Locmap.gss</span>. <br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">val_longofwords_eq</span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> (<span class="id">AG</span> <span class="id">l</span> <span class="id">H0</span>).<br/>
&nbsp;&nbsp;<span class="tactic">symmetry</span>; <span class="tactic">apply</span> <span class="id">Locmap.gpo</span>. <br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">X</span>: <span class="kwd">forall</span> <span class="id">r</span>, <span class="id">is_callee_save</span> <span class="id">r</span> = <span class="id">false</span> -&gt; <span class="id">Loc.diff</span> <span class="id">l</span> (<span class="id">R</span> <span class="id">r</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">l</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">congruence</span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">loc_result_caller_save</span> (<span class="id">ef_sig</span> <span class="id">ef</span>)). <span class="tactic">destruct</span> (<span class="id">loc_result</span> (<span class="id">ef_sig</span> <span class="id">ef</span>)); <span class="tactic">simpl</span>; <span class="tactic">intuition</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">external_call_well_typed</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;return&nbsp;*)</span>- <span class="id">inv</span> <span class="id">STACKS</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">STEPS</span>; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">WTRES0</span>; <span class="tactic">auto</span>. <span class="tactic">intros</span> [<span class="id">ls2</span> [<span class="id">A</span> <span class="id">B</span>]].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">plus_left</span>. <span class="id">constructor</span>. <span class="id">eexact</span> <span class="id">A</span>. <span class="id">traceEq</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">wt_regset_assign</span>; <span class="tactic">auto</span>. <span class="tactic">rewrite</span> <span class="id">WTRES0</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">initial_states_simulation</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st1</span>, <span class="id">RTL.initial_state</span> <span class="id">prog</span> <span class="id">st1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">st2</span>, <span class="id">LTL.initial_state</span> <span class="id">tprog</span> <span class="id">st2</span> /\ <span class="id">match_states</span> <span class="id">st1</span> <span class="id">st2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3551')">Proof.</div>
<div class="proofscript" id="proof3551">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">function_ptr_translated</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">tf</span> [<span class="id">FIND</span> <span class="id">TR</span>]].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">sig_function_translated</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> <span class="id">SIG</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">LTL.Callstate</span> <span class="id">nil</span> <span class="id">tf</span> (<span class="id">Locmap.init</span> <span class="id">Vundef</span>) <span class="id">m0</span>); <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> (<span class="id">Genv.init_mem_transf_partial</span> <span class="id">TRANSF</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">symbols_preserved</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">match_program_main</span> <span class="id">TRANSF</span>).  <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>. <span class="tactic">rewrite</span> <span class="id">SIG</span>; <span class="tactic">rewrite</span> <span class="id">H3</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">SIG</span>, <span class="id">H3</span>, <span class="id">loc_arguments_main</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Mem.extends_refl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">SIG</span>, <span class="id">H3</span>. <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">final_states_simulation</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">r</span>,<br/>
&nbsp;&nbsp;<span class="id">match_states</span> <span class="id">st1</span> <span class="id">st2</span> -&gt; <span class="id">RTL.final_state</span> <span class="id">st1</span> <span class="id">r</span> -&gt; <span class="id">LTL.final_state</span> <span class="id">st2</span> <span class="id">r</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3552')">Proof.</div>
<div class="proofscript" id="proof3552">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H0</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">STACKS</span>. <br/>
&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="tactic">rewrite</span> &lt;- (<span class="id">loc_result_exten</span> <span class="id">sg</span>). <span class="id">inv</span> <span class="id">RES</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">auto</span>.  <br/>
Qed.</div>
&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id">wt_prog</span>: <span class="id">wt_program</span> <span class="id">prog</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3553')">Proof.</div>
<div class="proofscript" id="proof3553">
&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">intros</span>. <br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">list_forall2_in_left</span>. <span class="id">eexact</span> (<span class="id">proj1</span> <span class="id">TRANSF</span>). <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;<span class="tactic">intros</span> ([<span class="id">i</span>' <span class="id">gd</span>] &amp; <span class="id">A</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span>). <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">subst</span> <span class="id">i</span>'.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">C</span>. <span class="tactic">destruct</span> <span class="id">f</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
- <span class="id">monadInv</span> <span class="id">H2</span>.  <br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">transf_function</span> <span class="kwd">in</span> <span class="id">EQ</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">type_function</span> <span class="id">f</span>) <span class="kwd">as</span> [<span class="id">env</span>|] <span class="id">eqn</span>:<span class="id">TF</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="tactic">eapply</span> <span class="id">type_function_correct</span>; <span class="tactic">eauto</span>.<br/>
- <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id">transf_program_correct</span>:<br/>
&nbsp;&nbsp;<span class="id">forward_simulation</span> (<span class="id">RTL.semantics</span> <span class="id">prog</span>) (<span class="id">LTL.semantics</span> <span class="id">tprog</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3554')">Proof.</div>
<div class="proofscript" id="proof3554">
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">ms</span> := <span class="kwd">fun</span> <span class="id">s</span> <span class="id">s</span>' =&gt; <span class="id">wt_state</span> <span class="id">s</span> /\ <span class="id">match_states</span> <span class="id">s</span> <span class="id">s</span>').<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">forward_simulation_plus</span> <span class="kwd">with</span> (<span class="id">match_states</span> := <span class="id">ms</span>).<br/>
- <span class="tactic">apply</span> <span class="id">senv_preserved</span>.<br/>
- <span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id">initial_states_simulation</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">st2</span> [<span class="id">A</span> <span class="id">B</span>]].<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">st2</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">wt_initial_state</span> <span class="kwd">with</span> (<span class="id">p</span> := <span class="id">prog</span>); <span class="tactic">auto</span>. <span class="tactic">exact</span> <span class="id">wt_prog</span>.<br/>
- <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H</span>. <span class="tactic">eapply</span> <span class="id">final_states_simulation</span>; <span class="tactic">eauto</span>.<br/>
- <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">step_simulation</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">s2</span>' [<span class="id">A</span> <span class="id">B</span>]].<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">s2</span>'; <span class="tactic">split</span>. <span class="tactic">exact</span> <span class="id">A</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">subject_reduction</span>; <span class="tactic">eauto</span>. <span class="id">eexact</span> <span class="id">wt_prog</span>. <span class="id">eexact</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">PRESERVATION</span>.<br/>
</div>
<div class="footer"><hr/>Generated by coq2html</div>
</body>
</html>
