<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module LockAcqProof</title>
<meta name="description" content="Documentation of Coq module LockAcqProof" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module LockAcqProof</h1>
<div class="coq">
<div class="doc">We prove that the implementation function lock and its corresponding 
specification satisfy the object simulation in this file. </div>
<span class="id">From</span> <span class="id">mathcomp.ssreflect</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">fintype</span> <span class="id">ssrnat</span>.                       <br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Coqlib.html">Coqlib</a></span> <span class="id"><a href="Maps.html">Maps</a></span> <span class="id"><a href="Axioms.html">Axioms</a></span>.  <br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="AST.html">AST</a></span> <span class="id"><a href="Integers.html">Integers</a></span> <span class="id"><a href="Floats.html">Floats</a></span> <span class="id"><a href="Values.html">Values</a></span> <span class="id"><a href="Events.html">Events</a></span> <span class="id"><a href="Globalenvs.html">Globalenvs</a></span> <span class="id"><a href="Smallstep.html">Smallstep</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Locations.html">Locations</a></span> <span class="id"><a href="Stacklayout.html">Stacklayout</a></span> <span class="id"><a href="Conventions.html">Conventions</a></span>.<br/>
&nbsp;<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Asm.html">Asm</a></span>. <br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="CUAST.html">CUAST</a></span> <span class="id"><a href="FMemOpFP.html">FMemOpFP</a></span> <span class="id"><a href="ValFP.html">ValFP</a></span> <span class="id"><a href="Op_fp.html">Op_fp</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Strings.String.html">String</a></span> <span class="id"><a href="val_casted.html">val_casted</a></span> <span class="id"><a href="helpers.html">helpers</a></span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Footprint.html">Footprint</a></span> <span class="id"><a href="GMemory.html">GMemory</a></span> <span class="id"><a href="FMemory.html">FMemory</a></span> <span class="id"><a href="FMemLemmas.html">FMemLemmas</a></span> <span class="id"><a href="TSOMem.html">TSOMem</a></span> <span class="id"><a href="MemAux.html">MemAux</a></span>. <br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="GAST.html">GAST</a></span> <span class="id"><a href="GlobDefs.html">GlobDefs</a></span> <span class="id"><a href="ETrace.html">ETrace</a></span> <span class="id"><a href="Blockset.html">Blockset</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="loadframe.html">loadframe</a></span>.<br/>
&nbsp;<br/>
<span class="kwd">Require</span> <span class="id"><a href="CminorLang.html">CminorLang</a></span>. <br/>
<span class="kwd">Require</span> <span class="id"><a href="SpecLang.html">SpecLang</a></span>. <br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="ASM_local.html">ASM_local</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="AsmLang.html">AsmLang</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="AsmTSO.html">AsmTSO</a></span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html">Coq.Lists.Streams</a></span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="RGRels.html">RGRels</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="LibTactics.html">LibTactics</a></span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="code.html">code</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="ObjectSim.html">ObjectSim</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="TSOGlobSem.html">TSOGlobSem</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="InvRG.html">InvRG</a></span>. <br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="AuxTacLemmas.html">AuxTacLemmas</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="TSOMemLemmas.html">TSOMemLemmas</a></span> <span class="id"><a href="MemLemmas.html">MemLemmas</a></span>.<br/>
<br/>
<h1> Lemmas about lock acquire </h1>
<span class="kwd">Lemma</span> <span class="id"><a name="tso_lock_acquire_init_state">tso_lock_acquire_init_state</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tge</span> <span class="id">tc</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Himp_init</span> : <span class="id"><a href="AsmTSO.html#init_genv">init_genv</a></span> <span class="id"><a href="code.html#lock_comp_tso_unit">lock_comp_tso_unit</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hinit_core</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="LockAcqProof.html#tc">tc</a></span> = <span class="id"><a href="AsmTSO.html#init_core">init_core</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span> <span class="id"><a href="code.html#lock_acquire_ident">lock_acquire_ident</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>),<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">fb</span>, <span class="id"><a href="Globalenvs.html#Genv.find_symbol">Genv.find_symbol</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span> <span class="id"><a href="code.html#lock_acquire_ident">lock_acquire_ident</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">fb</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="LockAcqProof.html#tc">tc</a></span> = <span class="id"><a href="ASM_local.html#fundef_init">fundef_init</a></span> <span class="id">fb</span> (<span class="id"><a href="ASM_local.html#fn_sig">fn_sig</a></span> <span class="id"><a href="code.html#lock_acquire_tso_fnbody">lock_acquire_tso_fnbody</a></span>) <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9933')">Proof.</div>
<div class="proofscript" id="proof9933">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Himp_init</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">init_core</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">ASM_local.init_core</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Globalenvs.html#Genv.find_symbol">Genv.find_symbol</a></span> <span class="id">tge</span> <span class="id"><a href="code.html#lock_acquire_ident">lock_acquire_ident</a></span>) <span class="id">eqn</span>:<span class="id">Hfind_symb</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H2</span> <span class="id"><a href="code.html#lock_acquire_ident">lock_acquire_ident</a></span>).<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hfind_symb</span> <span class="kwd">in</span> <span class="id">H9</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H9</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H5</span> <span class="kwd">in</span> <span class="id">H10</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H10</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hinit_core</span> <span class="id">H10</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Genv.find_funct_ptr</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Genv.find_def</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H10</span> <span class="kwd">in</span> <span class="id">Hinit_core</span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="find_lock_acquire_from_ge">find_lock_acquire_from_ge</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tge</span> <span class="id">fb</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Himp_init</span> : <span class="id"><a href="AsmTSO.html#init_genv">init_genv</a></span> <span class="id"><a href="code.html#lock_comp_tso_unit">lock_comp_tso_unit</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hfb</span> : <span class="id"><a href="Globalenvs.html#Genv.find_symbol">Genv.find_symbol</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span> <span class="id"><a href="code.html#lock_acquire_ident">lock_acquire_ident</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="LockAcqProof.html#fb">fb</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Globalenvs.html#Genv.find_funct_ptr">Genv.find_funct_ptr</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span> <span class="id"><a href="LockAcqProof.html#fb">fb</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="AST.html#Internal">Internal</a></span> <span class="id"><a href="code.html#lock_acquire_tso_fnbody">lock_acquire_tso_fnbody</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9934')">Proof.</div>
<div class="proofscript" id="proof9934">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Himp_init</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H2</span> <span class="id"><a href="code.html#lock_acquire_ident">lock_acquire_ident</a></span>).<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H5</span> <span class="kwd">in</span> <span class="id">H10</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H10</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hfb</span> <span class="id">H10</span> <span class="id">H9</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hfb</span> <span class="kwd">in</span> <span class="id">H9</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H9</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Globalenvs.html#Genv.find_funct_ptr">Genv.find_funct_ptr</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Globalenvs.html#Genv.find_def">Genv.find_def</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H10</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
&nbsp;&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="spec_lock_acquire_init_state">spec_lock_acquire_init_state</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sge</span> <span class="id">sG</span> <span class="id">sc</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hspec_init</span> : <span class="id"><a href="InteractionSemantics.html#init_genv">InteractionSemantics.init_genv</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="code.html#lock_comp_unit">lock_comp_unit</a></span> <span class="id"><a href="LockAcqProof.html#sge">sge</a></span> <span class="id"><a href="LockAcqProof.html#sG">sG</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hsc_init</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="LockAcqProof.html#sc">sc</a></span> = <span class="id"><a href="SpecLang.html#init_core">SpecLang.init_core</a></span> <span class="id"><a href="LockAcqProof.html#sge">sge</a></span> <span class="id"><a href="code.html#lock_acquire_ident">lock_acquire_ident</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>),<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">fb</span>, <span class="id"><a href="Globalenvs.html#Genv.find_symbol">Genv.find_symbol</a></span> <span class="id"><a href="LockAcqProof.html#sge">sge</a></span> <span class="id"><a href="code.html#lock_acquire_ident">lock_acquire_ident</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">fb</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="LockAcqProof.html#sc">sc</a></span> = <span class="id"><a href="SpecLang.html#fundef_init">SpecLang.fundef_init</a></span> (<span class="id"><a href="AST.html#Internal">Internal</a></span> <span class="id"><a href="code.html#lock_acquire_fnbody">lock_acquire_fnbody</a></span>) <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9935')">Proof.</div>
<div class="proofscript" id="proof9935">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hspec_init</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H3</span> <span class="id"><a href="code.html#lock_acquire_ident">lock_acquire_ident</a></span>).<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H3</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H6</span> <span class="kwd">in</span> <span class="id">H11</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H11</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H0</span> <span class="id">H</span> <span class="id">H1</span> <span class="id">H2</span> <span class="id">H3</span> <span class="id">H4</span> <span class="id">H5</span> <span class="id">H6</span> <span class="id">H7</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="SpecLang.html#init_core">SpecLang.init_core</a></span> <span class="kwd">in</span> <span class="id">Hsc_init</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CUAST.html#generic_init_core">generic_init_core</a></span> <span class="kwd">in</span> <span class="id">Hsc_init</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="SpecLang.html#F">SpecLang.F</a></span>, <span class="id"><a href="SpecLang.html#V">SpecLang.V</a></span> <span class="kwd">in</span> <span class="id">H10</span>. <br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H10</span> <span class="kwd">in</span> <span class="id">Hsc_init</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Globalenvs.html#Genv.find_funct_ptr">Genv.find_funct_ptr</a></span> <span class="kwd">in</span> <span class="id">Hsc_init</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Globalenvs.html#Genv.find_def">Genv.find_def</a></span> <span class="kwd">in</span> <span class="id">Hsc_init</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="SpecLang.html#F">SpecLang.F</a></span>, <span class="id"><a href="SpecLang.html#V">SpecLang.V</a></span>  <span class="kwd">in</span> <span class="id">H11</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H11</span> <span class="kwd">in</span> <span class="id">Hsc_init</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hsc_init</span>.<br/>
&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
&nbsp;&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="lock_acquire_core_init_match">lock_acquire_core_init_match</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tge</span> <span class="id">tc</span> <span class="id">sge</span> <span class="id">sG</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htso_init_genv</span> : <span class="id"><a href="AsmTSO.html#init_genv">init_genv</a></span> <span class="id"><a href="code.html#lock_comp_tso_unit">lock_comp_tso_unit</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hspec_init_genv</span> : <span class="id"><a href="InteractionSemantics.html#init_genv">InteractionSemantics.init_genv</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span> <span class="id"><a href="code.html#lock_comp_unit">lock_comp_unit</a></span> <span class="id"><a href="LockAcqProof.html#sge">sge</a></span> <span class="id"><a href="LockAcqProof.html#sG">sG</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hinit_core</span> : <span class="id"><a href="AsmTSO.html#init_core">init_core</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span> <span class="id"><a href="code.html#lock_acquire_ident">lock_acquire_ident</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="LockAcqProof.html#tc">tc</a></span>),<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">sc</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#init_core">InteractionSemantics.init_core</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span> <span class="id"><a href="LockAcqProof.html#sG">sG</a></span> <span class="id"><a href="code.html#lock_acquire_ident">lock_acquire_ident</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">sc</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9936')">Proof.</div>
<div class="proofscript" id="proof9936">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hspec_init_genv</span>.<br/>
&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="SpecLang.html#init_core">SpecLang.init_core</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CUAST.html#generic_init_core">generic_init_core</a></span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H3</span> <span class="id"><a href="code.html#lock_acquire_ident">lock_acquire_ident</a></span>).<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H3</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H6</span> <span class="kwd">in</span> <span class="id">H11</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H11</span>.<br/>
&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">SpecLang.F</span>, <span class="id">SpecLang.V</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H10</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Globalenvs.html#Genv.find_funct_ptr">Genv.find_funct_ptr</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Globalenvs.html#Genv.find_def">Genv.find_def</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H11</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">lock_acquire_core_init_match</span>' :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tge</span> <span class="id">sc</span> <span class="id">sge</span> <span class="id">sG</span> <span class="id">args</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htso_init_genv</span> : <span class="id"><a href="AsmTSO.html#init_genv">init_genv</a></span> <span class="id"><a href="code.html#lock_comp_tso_unit">lock_comp_tso_unit</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hspec_init_genv</span> : <span class="id"><a href="InteractionSemantics.html#init_genv">InteractionSemantics.init_genv</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span> <span class="id"><a href="code.html#lock_comp_unit">lock_comp_unit</a></span> <span class="id"><a href="LockAcqProof.html#sge">sge</a></span> <span class="id"><a href="LockAcqProof.html#sG">sG</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hspec_init_core</span> : <span class="id"><a href="InteractionSemantics.html#init_core">InteractionSemantics.init_core</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="LockAcqProof.html#sG">sG</a></span> <span class="id"><a href="code.html#lock_acquire_ident">lock_acquire_ident</a></span> <span class="id"><a href="LockAcqProof.html#args">args</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="LockAcqProof.html#sc">sc</a></span>),<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">tc</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#init_core">init_core</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span> <span class="id"><a href="code.html#lock_acquire_ident">lock_acquire_ident</a></span> <span class="id"><a href="LockAcqProof.html#args">args</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">tc</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9937')">Proof.</div>
<div class="proofscript" id="proof9937">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htso_init_genv</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H2</span> <span class="id"><a href="code.html#lock_acquire_ident">lock_acquire_ident</a></span>).<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#init_core">init_core</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="ASM_local.html#init_core">ASM_local.init_core</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H9</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H5</span> <span class="kwd">in</span> <span class="id">H10</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H10</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Globalenvs.html#Genv.find_funct_ptr">Genv.find_funct_ptr</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Globalenvs.html#Genv.find_def">Genv.find_def</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H10</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="ASM_local.html#fundef_init">fundef_init</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H</span> <span class="id">H0</span> <span class="id">H1</span> <span class="id">H2</span> <span class="id">H3</span> <span class="id">H4</span> <span class="id">H5</span> <span class="id">H6</span>. <br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hspec_init_genv</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H3</span> <span class="id"><a href="code.html#lock_acquire_ident">lock_acquire_ident</a></span>).<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H3</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H6</span> <span class="kwd">in</span> <span class="id">H13</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H13</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H</span> <span class="id">H0</span> <span class="id">H1</span> <span class="id">H2</span> <span class="id">H3</span> <span class="id">H4</span> <span class="id">H5</span> <span class="id">H6</span> <span class="id">H7</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hspec_init_core</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">SpecLang.init_core</span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">generic_init_core</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hspec_init_core</span> <span class="id">H12</span> <span class="id">H13</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">SpecLang.F</span>, <span class="id">SpecLang.V</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H12</span> <span class="kwd">in</span> <span class="id">Hspec_init_core</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Genv.find_funct_ptr</span>, <span class="id">Genv.find_def</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hspec_init_core</span> <span class="id">H13</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H13</span> <span class="kwd">in</span> <span class="id">Hspec_init_core</span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">args</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<div class="doc"><span class="bracket"><span class="id">match_no_extcall</span></span> holds in function lock </div>
<span class="kwd">Lemma</span> <span class="id"><a name="lock_acquire_no_external">lock_acquire_no_external</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">sc</span> <span class="id">sm</span> <span class="id">tc</span> <span class="id">tm</span> <span class="id">sge</span> <span class="id">tge</span> <span class="id">sG</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hspec_init</span> : <span class="id"><a href="InteractionSemantics.html#init_genv">InteractionSemantics.init_genv</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="code.html#lock_comp_unit">lock_comp_unit</a></span> <span class="id"><a href="LockAcqProof.html#sge">sge</a></span> <span class="id"><a href="LockAcqProof.html#sG">sG</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Himp_init</span> : <span class="id"><a href="AsmTSO.html#init_genv">init_genv</a></span> <span class="id"><a href="code.html#lock_comp_tso_unit">lock_comp_tso_unit</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hlock_acq_match</span> : <span class="id"><a href="InvRG.html#lock_match_state">lock_match_state</a></span> <span class="id"><a href="LockAcqProof.html#sge">sge</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span> <span class="id"><a href="LockAcqProof.html#t">t</a></span> (<span class="id"><a href="LockAcqProof.html#sc">sc</a></span>, <span class="id"><a href="LockAcqProof.html#sm">sm</a></span>) (<span class="id"><a href="LockAcqProof.html#tc">tc</a></span>, <span class="id"><a href="LockAcqProof.html#tm">tm</a></span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#at_external">at_external</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span> <span class="id"><a href="LockAcqProof.html#tc">tc</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9938')">Proof.</div>
<div class="proofscript" id="proof9938">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hlock_acq_match</span>; <span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">simpl</span>; <span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;{<br/>
&nbsp;init&nbsp;state&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="LockAcqProof.html#tso_lock_acquire_init_state">tso_lock_acquire_init_state</a></span> <span class="kwd">in</span> <span class="id">H4</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H4</span> <span class="kwd">as</span> [<span class="id">fb</span> [<span class="id">Hfb</span> <span class="id">Hinit_state</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">fundef_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hinit_state</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<div class="doc"><span class="bracket"><span class="id">match_halt</span></span> holds in function lock </div>
<span class="kwd">Lemma</span> <span class="id"><a name="lock_ret_val_eq">lock_ret_val_eq</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sge</span> <span class="id">tge</span> <span class="id">t</span> <span class="id">sc</span> <span class="id">sm</span> <span class="id">tc</span> <span class="id">tm</span> <span class="id">rv</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hhalt</span> : <span class="id"><a href="AsmTSO.html#halt">halt</a></span> <span class="id"><a href="LockAcqProof.html#tc">tc</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="LockAcqProof.html#rv">rv</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Himp_init</span> : <span class="id"><a href="AsmTSO.html#init_genv">init_genv</a></span> <span class="id"><a href="code.html#lock_comp_tso_unit">lock_comp_tso_unit</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hlock_match_state</span> : <span class="id"><a href="InvRG.html#lock_match_state">lock_match_state</a></span> <span class="id"><a href="LockAcqProof.html#sge">sge</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span> <span class="id"><a href="LockAcqProof.html#t">t</a></span> (<span class="id"><a href="LockAcqProof.html#sc">sc</a></span>, <span class="id"><a href="LockAcqProof.html#sm">sm</a></span>) (<span class="id"><a href="LockAcqProof.html#tc">tc</a></span>, <span class="id"><a href="LockAcqProof.html#tm">tm</a></span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="SpecLang.html#halt">SpecLang.halt</a></span> <span class="id"><a href="LockAcqProof.html#sc">sc</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="LockAcqProof.html#rv">rv</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9939')">Proof.</div>
<div class="proofscript" id="proof9939">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hlock_match_state</span>; <span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hhalt</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : ?<span class="id">rs</span> <span class="id">_</span> = <span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Hhalt</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hhalt</span>; <span class="id">tryfalse</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;].<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="LockAcqProof.html#tso_lock_acquire_init_state">tso_lock_acquire_init_state</a></span> <span class="kwd">in</span> <span class="id">H4</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H4</span> <span class="kwd">as</span> [<span class="id">fb</span> [<span class="id">Hfind_symb</span> <span class="id">Hfunc_init</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">fundef_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hfunc_init</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;} <br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hhalt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H6</span> <span class="kwd">in</span> <span class="id">Hhalt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Conventions1.html#loc_result">loc_result</a></span> <span class="kwd">in</span> <span class="id">Hhalt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Archi.html#ptr64">Archi.ptr64</a></span> <span class="id">eqn</span>:?;<span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hhalt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H7</span> <span class="kwd">in</span> <span class="id">Hhalt</span>; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<div class="doc"><span class="bracket"><span class="id">match_abort</span></span> holds in function lock </div>
<span class="kwd">Lemma</span> <span class="id"><a name="lock_acq_not_abort">lock_acq_not_abort</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sge</span> <span class="id">sG</span> <span class="id">tge</span> <span class="id">t</span> <span class="id">sc</span> <span class="id">sm</span> <span class="id">tc</span> <span class="id">tm</span> <span class="id">fl</span> <span class="id">fm</span> <span class="id">gm</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hspec_init</span> : <span class="id"><a href="InteractionSemantics.html#init_genv">InteractionSemantics.init_genv</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="code.html#lock_comp_unit">lock_comp_unit</a></span> <span class="id"><a href="LockAcqProof.html#sge">sge</a></span> <span class="id"><a href="LockAcqProof.html#sG">sG</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Himp_init</span> : <span class="id"><a href="AsmTSO.html#init_genv">init_genv</a></span> <span class="id"><a href="code.html#lock_comp_tso_unit">lock_comp_tso_unit</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hlock_acq_match_state</span> : <span class="id"><a href="InvRG.html#lock_match_state">lock_match_state</a></span> <span class="id"><a href="LockAcqProof.html#sge">sge</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span> <span class="id"><a href="LockAcqProof.html#t">t</a></span> (<span class="id"><a href="LockAcqProof.html#sc">sc</a></span>, <span class="id"><a href="LockAcqProof.html#sm">sm</a></span>) (<span class="id"><a href="LockAcqProof.html#tc">tc</a></span>, <span class="id"><a href="LockAcqProof.html#tm">tm</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hbf_nil</span> : <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="LockAcqProof.html#tm">tm</a></span> <span class="id"><a href="LockAcqProof.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hgm</span> : <span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="LockAcqProof.html#tm">tm</a></span> = <span class="id"><a href="LockAcqProof.html#gm">gm</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hstep</span> : <span class="kwd">forall</span> (<span class="id">fp</span> : <span class="id"><a href="Footprint.html#FP.t">FP.t</a></span>) (<span class="id">tc</span>' : <span class="id"><a href="AsmTSO.html#core">core</a></span>) (<span class="id">b</span>' : <span class="id"><a href="TSOMem.html#buffer">buffer</a></span>) (<span class="id">gm</span>' : <span class="id"><a href="GMemory.html#gmem">gmem</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="AsmTSO.html#tsostep">tsostep</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span> <span class="id"><a href="LockAcqProof.html#fl">fl</a></span> <span class="id"><a href="LockAcqProof.html#tc">tc</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>, <span class="id"><a href="LockAcqProof.html#gm">gm</a></span>) <span class="id"><a href="LockAcqProof.html#fp">fp</a></span> <span class="id">tc</span>' (<span class="id">b</span>', <span class="id">gm</span>'))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hnot_halt</span> : <span class="id"><a href="AsmTSO.html#halt">halt</a></span> <span class="id"><a href="LockAcqProof.html#tc">tc</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hembed</span> : <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id"><a href="LockAcqProof.html#gm">gm</a></span> <span class="id"><a href="LockAcqProof.html#fl">fl</a></span> <span class="id"><a href="LockAcqProof.html#fm">fm</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9940')">Proof.</div>
<div class="proofscript" id="proof9940">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hlock_acq_match_state</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : init </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hinit_core</span> : <span class="id"><a href="LockAcqProof.html#tso_lock_acquire_init_state">tso_lock_acquire_init_state</a></span> <span class="id">___</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hinit_core</span> <span class="kwd">as</span> [<span class="id">fb</span> [<span class="id">Hfind_symb</span> <span class="id">Hinit_core</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hinit_core</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">fundef_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hinit_core</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Halloc</span> : <span class="id"><a href="TSOMemLemmas.html#tsoalloc_bf_nil_succ_sz0">tsoalloc_bf_nil_succ_sz0</a></span> <span class="id">___</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Halloc</span> <span class="kwd">as</span> [<span class="id">tm1</span> [<span class="id">stk</span> <span class="id">Halloc</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hstep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;alloc&nbsp;case&nbsp;remaining&nbsp;to&nbsp;prove&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store_args_fmem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{ <br/>
<div class="doc">lock acquire : lock label </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hstep</span>. <span class="id">trivial_not_abort</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : movl $L RCX </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hstep</span>. <span class="id">trivial_not_abort</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : movl $0 RDX </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hstep</span>. <span class="id">trivial_not_abort</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : lock_acquire label </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hstep</span>. <span class="id">trivial_not_abort</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : movl $1 RAX </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hstep</span>. <span class="id">trivial_not_abort</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{ <br/>
<div class="doc">lock acquire : lock cmpxchg <span class="bracket"><span class="id">RCX</span></span> RDX </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H1</span> : <span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>, <span class="id">H2</span> : <span class="id">rs</span> (<span class="id"><a href="Asm.html#IR">IR</a></span> <span class="id"><a href="Asm.html#RCX">RCX</a></span>) = <span class="id">_</span>, <span class="id">H3</span> : <span class="id">rs</span> (<span class="id"><a href="Asm.html#IR">IR</a></span> <span class="id"><a href="Asm.html#RAX">RAX</a></span>) = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H1</span> <span class="id">to</span> <span class="id">Hobj_inv</span>, <span class="id">H2</span> <span class="id">to</span> <span class="id">HR8</span>, <span class="id">H3</span> <span class="id">to</span> <span class="id">Hrax</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">obj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hobj_inv</span> <span class="kwd">as</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">L</span>' [<span class="id">Hfind_symb</span> [<span class="id">Hst</span> [<span class="id">H_spec_store</span> [<span class="id">H_tso_store</span> <span class="id">Hunbuffer_safe</span>]]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">_</span> = <span class="id"><a href="Globalenvs.html#Genv.find_symbol">Genv.find_symbol</a></span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hfind_symb</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span> <span class="id">L</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hst</span> <span class="kwd">as</span> [<span class="id">H_lock_st</span> | <span class="id">H_unlock_st</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{   <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hstep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">trivial_not_abort</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (2 := (<span class="id"><a href="Asm.html#nextinstr">nextinstr</a></span> (<span class="id">rs</span> # <span class="id"><a href="Asm.html#ZF">ZF</a></span> &lt;- <span class="id"><a href="Values.html#Vfalse">Vfalse</a></span>) # <span class="id"><a href="Asm.html#RAX">RAX</a></span> &lt;- <span class="id"><a href="Values.html#Vzero">Vzero</a></span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1 := {| <span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>; <span class="id">fmemory</span> := <span class="id">fm</span> |}).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="ASM_local.html#eval_addrmode">eval_addrmode</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Archi.html#ptr64">Archi.ptr64</a></span> <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">HR8</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqb0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Integers.html#Int.add_zero">Int.add_zero</a></span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Ht</span> : <span class="id"><a href="Integers.html#Ptrofs.add">Ptrofs.add</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0) (<span class="id"><a href="Integers.html#Ptrofs.of_int">Ptrofs.of_int</a></span> <span class="id"><a href="Integers.html#Int.zero">Int.zero</a></span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">lock_st</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_lock_st</span> <span class="kwd">as</span> [<span class="id">Hload_sm</span> [<span class="id">Hnot_in_buf</span> <span class="id">Hload_tsom</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht1</span> : <span class="id"><a href="Integers.html#Ptrofs.unsigned_zero">Ptrofs.unsigned_zero</a></span> <span class="id">___</span>; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Integers.html#Ptrofs.zero">Ptrofs.zero</a></span> <span class="kwd">in</span> <span class="id">Ht1</span>; <span class="tactic">rewrite</span> <span class="id">Ht1</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hload_tsom</span> <span class="id">Hembed</span> <span class="id">Hrax</span> <span class="id">Hunbuffer_safe</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">load_tsomem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#load_gm_embed_load_fm">load_gm_embed_load_fm</a></span> <span class="kwd">in</span> <span class="id">Hload_tsom</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hload_tsom</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hrax</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Ht2</span> : <span class="id"><a href="Integers.html#Int.eq">Int.eq</a></span> <span class="id"><a href="Integers.html#Int.zero">Int.zero</a></span> <span class="id"><a href="Integers.html#Int.one">Int.one</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">Hunbuffer_safe</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">unlock_st</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_unlock_st</span> <span class="kwd">as</span> [<span class="id">Hload_sm</span> <span class="id">H_unlock_st</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_unlock_st</span> <span class="kwd">as</span> [<span class="id">H_unlock_st</span> | <span class="id">H_unlock_st</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">H_unlock_st</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="TSOMem.html#load_tsomem">load_tsomem</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">H</span> <span class="id">into</span> <span class="id">Hload_tsom</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">load_tsomem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hstep</span>, <span class="id">Hembed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hstep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">trivial_not_abort</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="ASM_local.html#eval_addrmode">eval_addrmode</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Archi.html#ptr64">Archi.ptr64</a></span> <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">HR8</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Integers.html#Int.add_zero">Int.add_zero</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqb0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Ht</span> : <span class="id"><a href="Integers.html#Ptrofs.add">Ptrofs.add</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0) (<span class="id"><a href="Integers.html#Ptrofs.of_int">Ptrofs.of_int</a></span> <span class="id"><a href="Integers.html#Int.zero">Int.zero</a></span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht1</span> : <span class="id"><a href="Integers.html#Ptrofs.unsigned_zero">Ptrofs.unsigned_zero</a></span> <span class="id">___</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Integers.html#Ptrofs.zero">Ptrofs.zero</a></span> <span class="kwd">in</span> <span class="id">Ht1</span>; <span class="tactic">rewrite</span> <span class="id">Ht1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#load_gm_embed_load_fm">load_gm_embed_load_fm</a></span> <span class="kwd">in</span> <span class="id">Hload_tsom</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hload_tsom</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hrax</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Ht2</span> : <span class="id"><a href="Integers.html#Int.eq">Int.eq</a></span> <span class="id"><a href="Integers.html#Int.zero">Int.zero</a></span> <span class="id"><a href="Integers.html#Int.one">Int.one</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ht2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hunbuffer_safe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">Hunbuffer_safe</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{   <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">H_unlock_st</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H_tso_store</span> <span class="id"><a href="Integers.html#Int.zero">Int.zero</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_tso_store</span> <span class="kwd">as</span> [<span class="id">tm</span>' <span class="id">H_tso_store</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store_tsomem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id">memory</span> <span class="id">L</span> 0 (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="Integers.html#Int.zero">Int.zero</a></span>)) <span class="id">eqn</span>:<span class="id">Hstore</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">g</span> <span class="id">into</span> <span class="id">m</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H_tso_store</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hembed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#store_gm_embed_store_fm">store_gm_embed_store_fm</a></span> <span class="kwd">in</span> <span class="id">Hstore</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hstore</span> <span class="kwd">as</span> [<span class="id">fm</span>' [<span class="id">Hstore</span> <span class="id">Hembed1</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hstep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">trivial_not_abort</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="ASM_local.html#eval_addrmode">eval_addrmode</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Archi.html#ptr64">Archi.ptr64</a></span> <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">HR8</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Integers.html#Int.add_zero">Int.add_zero</a></span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqb0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Ht</span> : <span class="id"><a href="Integers.html#Ptrofs.add">Ptrofs.add</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0) (<span class="id"><a href="Integers.html#Ptrofs.of_int">Ptrofs.of_int</a></span> <span class="id"><a href="Integers.html#Int.zero">Int.zero</a></span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht1</span> : <span class="id"><a href="Integers.html#Ptrofs.unsigned_zero">Ptrofs.unsigned_zero</a></span> <span class="id">___</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Integers.html#Ptrofs.zero">Ptrofs.zero</a></span> <span class="kwd">in</span> <span class="id">Ht1</span>; <span class="tactic">rewrite</span> <span class="id">Ht1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hrax</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="TSOMem.html#load_tsomem">load_tsomem</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> = <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="tactic">rename</span> <span class="id">H</span> <span class="id">into</span> <span class="id">Hload_tm</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hload_tm</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#load_gm_embed_load_fm">load_gm_embed_load_fm</a></span> <span class="kwd">in</span> <span class="id">Hload_tm</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hload_tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Integers.html#Int.eq_true">Int.eq_true</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">rs</span> (<span class="id"><a href="Asm.html#IR">IR</a></span> <span class="id"><a href="Asm.html#RDX">RDX</a></span>) = <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="tactic">rewrite</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Values.html#Vzero">Vzero</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hstore</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hunbuffer_safe</span> <span class="id">Hembed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">Hunbuffer_safe</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hembed</span> <span class="id">Hunbuffer_safe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">Hunbuffer_safe</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : je enter <span class="bracket"><span class="id">ZF</span> = 1</span> </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hstep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">trivial_not_abort</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">rs</span> (<span class="id"><a href="Asm.html#CR">CR</a></span> <span class="id"><a href="Asm.html#ZF">ZF</a></span>) = <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">simpl</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Integers.html#Int.eq_true">Int.eq_true</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#tso_goto_label">tso_goto_label</a></span>, <span class="id"><a href="code.html#lock_acquire_tso_fnbody">lock_acquire_tso_fnbody</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id"><a href="code.html#enter_lbl">enter_lbl</a></span> <span class="id"><a href="code.html#lock_lbl">lock_lbl</a></span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id"><a href="code.html#enter_lbl">enter_lbl</a></span> <span class="id"><a href="code.html#lock_acquire_lbl">lock_acquire_lbl</a></span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id"><a href="code.html#enter_lbl">enter_lbl</a></span> <span class="id"><a href="code.html#spin_lbl">spin_lbl</a></span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id"><a href="code.html#enter_lbl">enter_lbl</a></span> <span class="id"><a href="code.html#enter_lbl">enter_lbl</a></span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">rs</span> <span class="id"><a href="Asm.html#PC">PC</a></span> = <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : je enter <span class="bracket"><span class="id">ZF</span> = 0</span> </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hstep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">trivial_not_abort</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">rs</span> (<span class="id"><a href="Asm.html#CR">CR</a></span> <span class="id"><a href="Asm.html#ZF">ZF</a></span>) = <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">simpl</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Ht</span> : <span class="id"><a href="Integers.html#Int.eq">Int.eq</a></span> <span class="id"><a href="Integers.html#Int.zero">Int.zero</a></span> <span class="id"><a href="Integers.html#Int.one">Int.one</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ht</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : spin label </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hstep</span>. <span class="id">trivial_not_abort</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : movl <span class="bracket"><span class="id">RCX</span></span> RBX </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>, <span class="id">H2</span> : <span class="id">rs</span> (<span class="id"><a href="Asm.html#IR">IR</a></span> <span class="id"><a href="Asm.html#RCX">RCX</a></span>) = <span class="id">_</span>  |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H</span> <span class="id">to</span> <span class="id">Hobj_inv</span>, <span class="id">H2</span> <span class="id">to</span> <span class="id">HR8</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">obj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hobj_inv</span> <span class="kwd">as</span> [<span class="id">L</span>' [<span class="id">Hfind_symb</span> [<span class="id">Hlock_st</span> [<span class="id">Hstore_sm</span> <span class="id">Hstore_tm</span>]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hlock_st</span> <span class="kwd">as</span> [<span class="id">Hlock_st</span> | <span class="id">Hlock_st</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">lock_st</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">Hlock_st</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="TSOMem.html#load_tsomem">load_tsomem</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#load_tsomem">load_tsomem</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">destruct</span> <span class="id">tm</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">H</span> <span class="id">into</span> <span class="id">Hload_tsomem</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">_</span> = <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#load_gm_embed_load_fm">load_gm_embed_load_fm</a></span> <span class="kwd">in</span> <span class="id">Hload_tsomem</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hstep</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">trivial_not_abort</span>.      <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#exec_load_TSO">exec_load_TSO</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Htso_loadv</span> : <span class="id"><a href="TSOMemLemmas.html#Mem_load_fm_load_tm_eq">Mem_load_fm_load_tm_eq</a></span> <span class="id">___</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#load_fm_eq_load_gm">load_fm_eq_load_gm</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="ASM_local.html#eval_addrmode">eval_addrmode</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Archi.html#ptr64">Archi.ptr64</a></span> <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">HR8</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Integers.html#Int.add_zero">Int.add_zero</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqb0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Ht</span> : <span class="id"><a href="Integers.html#Ptrofs.add">Ptrofs.add</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0) (<span class="id"><a href="Integers.html#Ptrofs.of_int">Ptrofs.of_int</a></span> <span class="id"><a href="Integers.html#Int.zero">Int.zero</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">_</span> = <span class="id"><a href="Globalenvs.html#Genv.find_symbol">Genv.find_symbol</a></span> <span class="id">_</span> <span class="id"><a href="code.html#lock_L_ident">lock_L_ident</a></span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hfind_symb</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span> <span class="id">L</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Htso_loadv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hstore_tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">Hstore_tm</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">unlock_st</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">Hlock_st</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">_</span> \/ <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">Hlock</span> | <span class="id">Hunlock</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">Hlock</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="TSOMem.html#load_tsomem">load_tsomem</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#load_tsomem">load_tsomem</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">destruct</span> <span class="id">tm</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">H</span> <span class="id">into</span> <span class="id">Hload_tsomem</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">_</span> = <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#load_gm_embed_load_fm">load_gm_embed_load_fm</a></span> <span class="kwd">in</span> <span class="id">Hload_tsomem</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hstep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">trivial_not_abort</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#exec_load_TSO">exec_load_TSO</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Htso_loadv</span> : <span class="id"><a href="TSOMemLemmas.html#Mem_load_fm_load_tm_eq">Mem_load_fm_load_tm_eq</a></span> <span class="id">___</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#load_fm_eq_load_gm">load_fm_eq_load_gm</a></span>;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="ASM_local.html#eval_addrmode">eval_addrmode</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Archi.html#ptr64">Archi.ptr64</a></span> <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">HR8</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Integers.html#Int.add_zero">Int.add_zero</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqb0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Ht</span> : <span class="id"><a href="Integers.html#Ptrofs.add">Ptrofs.add</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0) (<span class="id"><a href="Integers.html#Ptrofs.of_int">Ptrofs.of_int</a></span> <span class="id"><a href="Integers.html#Int.zero">Int.zero</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">_</span> = <span class="id"><a href="Globalenvs.html#Genv.find_symbol">Genv.find_symbol</a></span> <span class="id">_</span> <span class="id"><a href="code.html#lock_L_ident">lock_L_ident</a></span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hfind_symb</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span> <span class="id">L</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Htso_loadv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> -<span class="id">Hstore_tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">Hstore_tm</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">Hunlock</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="TSOMem.html#load_tsomem">load_tsomem</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#load_tsomem">load_tsomem</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">destruct</span> <span class="id">tm</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">H</span> <span class="id">into</span> <span class="id">Hload_tsomem</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">_</span> = <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#load_gm_embed_load_fm">load_gm_embed_load_fm</a></span> <span class="kwd">in</span> <span class="id">Hload_tsomem</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hstep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">trivial_not_abort</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#exec_load_TSO">exec_load_TSO</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Htso_loadv</span> : <span class="id"><a href="TSOMemLemmas.html#Mem_load_fm_load_tm_eq">Mem_load_fm_load_tm_eq</a></span> <span class="id">___</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#load_fm_eq_load_gm">load_fm_eq_load_gm</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="ASM_local.html#eval_addrmode">eval_addrmode</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Archi.html#ptr64">Archi.ptr64</a></span> <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">HR8</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Integers.html#Int.add_zero">Int.add_zero</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqb0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Ht</span> : <span class="id"><a href="Integers.html#Ptrofs.add">Ptrofs.add</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0) (<span class="id"><a href="Integers.html#Ptrofs.of_int">Ptrofs.of_int</a></span> <span class="id"><a href="Integers.html#Int.zero">Int.zero</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">_</span> = <span class="id"><a href="Globalenvs.html#Genv.find_symbol">Genv.find_symbol</a></span> <span class="id">_</span> <span class="id"><a href="code.html#lock_L_ident">lock_L_ident</a></span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hfind_symb</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span> <span class="id">L</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Htso_loadv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> -<span class="id">Hstore_tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">Hstore_tm</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : cmp R9 $0 </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">rs</span> (<span class="id"><a href="Asm.html#IR">IR</a></span> <span class="id"><a href="Asm.html#RBX">RBX</a></span>) = <span class="id">_</span> \/ <span class="id">rs</span> (<span class="id"><a href="Asm.html#IR">IR</a></span> <span class="id"><a href="Asm.html#RBX">RBX</a></span>) = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">HR9</span> | <span class="id">HR9</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hstep</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">trivial_not_abort</span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">rewrite</span> <span class="id">HR9</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{ <br/>
<div class="doc">lock acquire : je spin </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">rs</span> (<span class="id"><a href="Asm.html#CR">CR</a></span> <span class="id"><a href="Asm.html#ZF">ZF</a></span>) = <span class="id">_</span> \/ <span class="id">rs</span> (<span class="id"><a href="Asm.html#CR">CR</a></span> <span class="id"><a href="Asm.html#ZF">ZF</a></span>) = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">Hzf</span> | <span class="id">Hzf</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hstep</span>; <span class="id">trivial_not_abort</span>; <span class="tactic">try</span> (<span class="tactic">rewrite</span> <span class="id">Hzf</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Integers.html#Int.eq_true">Int.eq_true</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#tso_goto_label">tso_goto_label</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id"><a href="code.html#spin_lbl">spin_lbl</a></span> <span class="id"><a href="code.html#lock_lbl">lock_lbl</a></span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id"><a href="code.html#spin_lbl">spin_lbl</a></span> <span class="id"><a href="code.html#lock_acquire_lbl">lock_acquire_lbl</a></span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id"><a href="code.html#spin_lbl">spin_lbl</a></span> <span class="id"><a href="code.html#spin_lbl">spin_lbl</a></span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">rs</span> <span class="id"><a href="Asm.html#PC">PC</a></span> = <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Ht</span> : <span class="id"><a href="Integers.html#Int.eq">Int.eq</a></span> <span class="id"><a href="Integers.html#Int.zero">Int.zero</a></span> <span class="id"><a href="Integers.html#Int.one">Int.one</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ht</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : jmp lock </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hstep</span>; <span class="id">trivial_not_abort</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#tso_goto_label">tso_goto_label</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id"><a href="code.html#lock_acquire_lbl">lock_acquire_lbl</a></span> <span class="id"><a href="code.html#lock_lbl">lock_lbl</a></span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id"><a href="code.html#lock_acquire_lbl">lock_acquire_lbl</a></span> <span class="id"><a href="code.html#lock_acquire_lbl">lock_acquire_lbl</a></span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">rs</span> <span class="id"><a href="Asm.html#PC">PC</a></span> = <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : enter </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hstep</span>; <span class="id">trivial_not_abort</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{ <br/>
<div class="doc">lock acquire : movl $0 RAX </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hstep</span>; <span class="id">trivial_not_abort</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : retl </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hstep</span>; <span class="id">trivial_not_abort</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : halt </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hnot_halt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">rs</span> <span class="id"><a href="Asm.html#PC">PC</a></span> = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Hnot_halt</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hnot_halt</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">loc_result</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Archi.html#ptr64">Archi.ptr64</a></span> <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<div class="doc"><span class="bracket"><span class="id">match_tau_obj_mem_fp</span></span> holds in function lock </div>
<span class="kwd">Lemma</span> <span class="id"><a name="lock_footprint_case">lock_footprint_case</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sge</span> <span class="id">sG</span> <span class="id">tge</span> <span class="id">sc</span> <span class="id">tm</span> <span class="id">gm</span> <span class="id">t</span> <span class="id">b</span> <span class="id">fp</span> <span class="id">tc</span> <span class="id">tc</span>' <span class="id">b</span>' <span class="id">gm</span>' <span class="id">sm</span> <span class="id">ofs</span> <span class="id">fl</span> <span class="id">b0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hspec_init</span> : <span class="id"><a href="InteractionSemantics.html#init_genv">InteractionSemantics.init_genv</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="code.html#lock_comp_unit">lock_comp_unit</a></span> <span class="id"><a href="LockAcqProof.html#sge">sge</a></span> <span class="id"><a href="LockAcqProof.html#sG">sG</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Himp_init</span> : <span class="id"><a href="AsmTSO.html#init_genv">init_genv</a></span> <span class="id"><a href="code.html#lock_comp_tso_unit">lock_comp_tso_unit</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hge_equiv</span> : <span class="id"><a href="TSOGlobSem.html#genv_match">genv_match</a></span> (<span class="id"><a href="InteractionSemantics.html#F">InteractionSemantics.F</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="InteractionSemantics.html#V">InteractionSemantics.V</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="LockAcqProof.html#sge">sge</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hlock_match_state</span> : <span class="id"><a href="InvRG.html#lock_match_state">lock_match_state</a></span> <span class="id"><a href="LockAcqProof.html#sge">sge</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span> <span class="id"><a href="LockAcqProof.html#t">t</a></span> (<span class="id"><a href="LockAcqProof.html#sc">sc</a></span>, <span class="id"><a href="LockAcqProof.html#sm">sm</a></span>) (<span class="id"><a href="LockAcqProof.html#tc">tc</a></span>, <span class="id"><a href="LockAcqProof.html#tm">tm</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hbf</span> : <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="LockAcqProof.html#tm">tm</a></span> <span class="id"><a href="LockAcqProof.html#t">t</a></span> = <span class="id"><a href="LockAcqProof.html#b">b</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hmem</span> : <span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="LockAcqProof.html#tm">tm</a></span> = <span class="id"><a href="LockAcqProof.html#gm">gm</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hstep</span> : <span class="id"><a href="AsmTSO.html#tsostep">tsostep</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span> <span class="id"><a href="LockAcqProof.html#fl">fl</a></span> <span class="id"><a href="LockAcqProof.html#tc">tc</a></span> (<span class="id"><a href="LockAcqProof.html#b">b</a></span>, <span class="id"><a href="LockAcqProof.html#gm">gm</a></span>) <span class="id"><a href="LockAcqProof.html#fp">fp</a></span> <span class="id">tc</span>' (<span class="id">b</span>', <span class="id">gm</span>'))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hlocs_belongsto</span> : <span class="id"><a href="Footprint.html#Locs.belongsto">Locs.belongsto</a></span> (<span class="id"><a href="Footprint.html#FP.locs">FP.locs</a></span> <span class="id"><a href="LockAcqProof.html#fp">fp</a></span>) <span class="id"><a href="LockAcqProof.html#b0">b0</a></span> <span class="id"><a href="LockAcqProof.html#ofs">ofs</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html#obj_mem">obj_mem</a></span> <span class="id"><a href="LockAcqProof.html#sm">sm</a></span> <span class="id"><a href="LockAcqProof.html#b0">b0</a></span> <span class="id"><a href="LockAcqProof.html#ofs">ofs</a></span> \/ <span class="id">exists</span> <span class="id">n</span>, <span class="id"><a href="MemAux.html#get_block">get_block</a></span> <span class="id"><a href="LockAcqProof.html#fl">fl</a></span> <span class="id">n</span> = <span class="id"><a href="LockAcqProof.html#b0">b0</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9941')">Proof.</div>
<div class="proofscript" id="proof9941">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Locs.belongsto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hlock_match_state</span>; <span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hstep</span>; <span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span>] |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="id">ptr_elim</span>]; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>; <span class="tactic">try</span> <span class="id">external_call_elim</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ptr_elim</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hlocs_belongsto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hlocs_belongsto</span>; <span class="tactic">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;].<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Htso_core</span> : <span class="id"><a href="LockAcqProof.html#tso_lock_acquire_init_state">tso_lock_acquire_init_state</a></span> <span class="id">___</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htso_core</span> <span class="kwd">as</span> [<span class="id">fb</span> [<span class="id">Hfind_symb</span> <span class="id">Htso_core</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Htso_core</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">fundef_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Htso_core</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htso_core</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hstep</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span>] |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="id">ptr_elim</span>]; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>; <span class="tactic">try</span> <span class="id">external_call_elim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H1</span> : <span class="id"><a href="loadframe.html#args_len_rec">args_len_rec</a></span> <span class="id">_</span> <span class="id">_</span> = <span class="id">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H3</span> : <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H4</span> : <span class="id"><a href="TSOMem.html#tsoalloc">tsoalloc</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H1</span> <span class="id">to</span> <span class="id">Hargs_len_rec</span>, <span class="id">H2</span> <span class="id">to</span> <span class="id">Hobj_inv</span>, <span class="id">H3</span> <span class="id">to</span> <span class="id">Hembed</span>, <span class="id">H4</span> <span class="id">to</span> <span class="id">Htsoalloc</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.       <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Htsoalloc</span> <span class="id">Hlocs_belongsto</span> <span class="id">Hargs_len_rec</span> <span class="id">Hembed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htsoalloc</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">Htsoalloc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hargs_len_rec</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store_args_fp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#FP.fp_union_emp">FP.fp_union_emp</a></span> <span class="kwd">in</span> <span class="id">Hlocs_belongsto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">uncheck_alloc_fp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">FP.locs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Locs.union</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>; <span class="id">tryfalse</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H6</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hstep</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span>] |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="id">ptr_elim</span>]; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>; <span class="tactic">try</span> <span class="id">external_call_elim</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ptr_elim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#exec_instr_TSO">exec_instr_TSO</a></span>], <span class="id">H1</span> : <span class="id">rs</span> (<span class="id"><a href="Asm.html#IR">IR</a></span> <span class="id"><a href="Asm.html#RCX">RCX</a></span>) = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H</span> <span class="id">to</span> <span class="id">Hexec_instr_tso</span>, <span class="id">H1</span> <span class="id">to</span> <span class="id">Hecx</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hlocs_belongsto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span> <span class="id">t</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="ASM_local.html#eval_addrmode">eval_addrmode</a></span> <span class="kwd">in</span> <span class="id">Hlocs_belongsto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Archi.html#ptr64">Archi.ptr64</a></span> <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hlocs_belongsto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hecx</span> <span class="kwd">in</span> <span class="id">Hlocs_belongsto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hlocs_belongsto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqb0</span> <span class="kwd">in</span> <span class="id">Hlocs_belongsto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Ht</span> : <span class="id"><a href="Integers.html#Ptrofs.add">Ptrofs.add</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Integers.html#Ptrofs.of_int">Ptrofs.of_int</a></span> (<span class="id"><a href="Integers.html#Int.add">Int.add</a></span> <span class="id"><a href="Integers.html#Int.zero">Int.zero</a></span> (<span class="id"><a href="Integers.html#Int.repr">Int.repr</a></span> 0)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ht</span> <span class="kwd">in</span> <span class="id">Hlocs_belongsto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="FMemory.html#Mem.loadv">Mem.loadv</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id">fm</span> (<span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id">L</span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0))) <span class="id">eqn</span>:<span class="id">Hmem_load</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">rs</span> (<span class="id"><a href="Asm.html#IR">IR</a></span> <span class="id"><a href="Asm.html#RAX">RAX</a></span>) = <span class="id">_</span>, <span class="id">H2</span> : <span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H3</span> : <span class="id">_</span> = <span class="id"><a href="Globalenvs.html#Genv.find_symbol">Genv.find_symbol</a></span> <span class="id">_</span> <span class="id"><a href="code.html#lock_L_ident">lock_L_ident</a></span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H</span> <span class="id">to</span> <span class="id">Heax</span>, <span class="id">H2</span> <span class="id">to</span> <span class="id">Hobj_inv</span>, <span class="id">H3</span> <span class="id">to</span> <span class="id">Hfind_symbol</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hlocs_belongsto</span> <span class="id">Heax</span> <span class="id">Hobj_inv</span> <span class="id">Hfind_symbol</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Heqb0</span> <span class="id">Hexec_instr_tso</span> <span class="id">Hmem_load</span> <span class="id">Hecx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heax</span> <span class="kwd">in</span> <span class="id">Hlocs_belongsto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Values.html#Val.cmpu_bool">Val.cmpu_bool</a></span> (<span class="id"><a href="FMemory.html#Mem.valid_pointer">Mem.valid_pointer</a></span> <span class="id">fm</span>) <span class="id"><a href="Integers.html#Ceq">Ceq</a></span> <span class="id">v</span> <span class="id"><a href="Values.html#Vone">Vone</a></span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Ht1</span> : <span class="id"><a href="Integers.html#Ptrofs.unsigned">Ptrofs.unsigned</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0) = 0%<span class="id">Z</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ht1</span> <span class="kwd">in</span> <span class="id">Hlocs_belongsto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Cop_fp.cmpu_bool_fp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v</span>; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">FP.locs</span>, <span class="id">load_fp</span>, <span class="id">store_fp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Locs.union</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Footprint.html#Locs.emp">Locs.emp</a></span> <span class="id">b0</span> <span class="id">ofs</span>) <span class="id">eqn</span>:?; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">range_locset</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Values.html#eq_block">eq_block</a></span> <span class="id">L</span> <span class="id">b0</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zle">zle</a></span> 0 <span class="id">ofs</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zlt">zlt</a></span> <span class="id">ofs</span> 4) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">obj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hobj_inv</span> <span class="kwd">as</span> [<span class="id">L</span> [<span class="id">Hfind_symb</span>' <span class="id">Hobj_inv</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hfind_symbol</span> <span class="kwd">in</span> <span class="id">Hfind_symb</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hfind_symb</span>'; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>. <br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">loadv_fp</span>, <span class="id">Cop_fp.cmpu_bool_fp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqb0</span> <span class="kwd">in</span> <span class="id">Hlocs_belongsto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">FP.locs</span>, <span class="id">load_fp</span>, <span class="id">FP.union</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Ht1</span> : <span class="id"><a href="Integers.html#Ptrofs.unsigned">Ptrofs.unsigned</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0) = 0%<span class="id">Z</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ht1</span> <span class="kwd">in</span> <span class="id">Hlocs_belongsto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Locs.union</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Footprint.html#Locs.emp">Locs.emp</a></span> <span class="id">b0</span> <span class="id">ofs</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">range_locset</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Values.html#eq_block">eq_block</a></span> <span class="id">L</span> <span class="id">b0</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">obj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hobj_inv</span> <span class="kwd">as</span> [<span class="id">L</span> [<span class="id">Hfind_symb</span>' <span class="id">Hobj_inv</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hfind_symbol</span> <span class="kwd">in</span> <span class="id">Hfind_symb</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hfind_symb</span>'; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zle">zle</a></span> 0 <span class="id">ofs</span>) <span class="id">eqn</span>:?;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zlt">zlt</a></span> <span class="id">ofs</span> 4) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">FP.union</span>, <span class="id">loadv_fp</span>, <span class="id">Cop_fp.cmpu_bool_fp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqb0</span> <span class="kwd">in</span> <span class="id">Hlocs_belongsto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">eval_addrmode</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqb0</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hecx</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqb0</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Ht</span> : <span class="id"><a href="Integers.html#Ptrofs.add">Ptrofs.add</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Integers.html#Ptrofs.of_int">Ptrofs.of_int</a></span> (<span class="id"><a href="Integers.html#Int.add">Int.add</a></span> <span class="id"><a href="Integers.html#Int.zero">Int.zero</a></span> (<span class="id"><a href="Integers.html#Int.repr">Int.repr</a></span> 0)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ht</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Ht1</span> : <span class="id"><a href="Integers.html#Ptrofs.unsigned">Ptrofs.unsigned</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0) = 0%<span class="id">Z</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ht1</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>, <span class="id">Hmem_load</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hmem_load</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heax</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqo</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="ASM_local.html#eval_addrmode">eval_addrmode</a></span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqb0</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="id">eval_addrmode32</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hecx</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqb0</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ht</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hmem_load</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hstep</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span>] |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="id">ptr_elim</span>]; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>; <span class="tactic">try</span> <span class="id">external_call_elim</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ptr_elim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#exec_instr_TSO">exec_instr_TSO</a></span>], <span class="id">H1</span> : <span class="id">rs</span> (<span class="id"><a href="Asm.html#IR">IR</a></span> <span class="id"><a href="Asm.html#RCX">RCX</a></span>) = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H</span> <span class="id">to</span> <span class="id">Hexec_instr_tso</span>, <span class="id">H1</span> <span class="id">to</span> <span class="id">Hecx</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hlocs_belongsto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hstep</span> <span class="id">Hexec_instr_tso</span> <span class="id">Hecx</span> <span class="id">H9</span> <span class="id">Hlocs_belongsto</span> <span class="id">H14</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">exec_load_TSO</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">eval_addrmode</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Archi.html#ptr64">Archi.ptr64</a></span> <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hecx</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqb</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Ht</span> : <span class="id"><a href="Integers.html#Ptrofs.add">Ptrofs.add</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Integers.html#Ptrofs.of_int">Ptrofs.of_int</a></span> (<span class="id"><a href="Integers.html#Int.add">Int.add</a></span> <span class="id"><a href="Integers.html#Int.zero">Int.zero</a></span> (<span class="id"><a href="Integers.html#Int.repr">Int.repr</a></span> 0)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ht</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">exec_load_fp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">eval_addrmode</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqb</span> <span class="kwd">in</span> <span class="id">Hlocs_belongsto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Hstep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hecx</span> <span class="kwd">in</span> <span class="id">Hlocs_belongsto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqb</span> <span class="kwd">in</span> <span class="id">Hlocs_belongsto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ht</span> <span class="kwd">in</span> <span class="id">Hlocs_belongsto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Ht1</span> : <span class="id"><a href="Integers.html#Ptrofs.unsigned">Ptrofs.unsigned</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0) = 0%<span class="id">Z</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ht1</span> <span class="kwd">in</span> <span class="id">Hlocs_belongsto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">FP.locs</span>, <span class="id">load_fp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Locs.union</span>, <span class="id">range_locset</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Footprint.html#Locs.emp">Locs.emp</a></span> <span class="id">b0</span> <span class="id">ofs</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Values.html#eq_block">eq_block</a></span> <span class="id">L</span> <span class="id">b0</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zle">zle</a></span> 0 <span class="id">ofs</span>) <span class="id">eqn</span>:?;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zlt">zlt</a></span> <span class="id">ofs</span> 4) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H14</span> <span class="id">to</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">obj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hobj_inv</span> <span class="kwd">as</span> [<span class="id">L</span>' [<span class="id">Hfind_symb</span>' <span class="id">Hobj_inv</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hfind_symb</span>' <span class="kwd">in</span> <span class="id">H9</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H9</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hstep</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span>] |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="id">ptr_elim</span>]; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>; <span class="tactic">try</span> <span class="id">external_call_elim</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ptr_elim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">rs</span> <span class="id">_</span> = <span class="id">_</span> \/ <span class="id">rs</span> <span class="id">_</span> = <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="tactic">rename</span> <span class="id">H</span> <span class="id">into</span> <span class="id">Hlock_var</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hlocs_belongsto</span> <span class="id">Hlock_var</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">exec_instr_TSO_fp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">compare_ints_TSO_fp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">tso_cmpu_bool_fp_total</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hlock_var</span> <span class="kwd">as</span> [<span class="id">Hlock_var</span> | <span class="id">Hlock_var</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hlock_var</span> <span class="kwd">in</span> <span class="id">Hlocs_belongsto</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#FP.fp_union_emp">FP.fp_union_emp</a></span> <span class="kwd">in</span> <span class="id">Hlocs_belongsto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">FP.locs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Locs.union</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Locs.emp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#FP.fp_union_emp">FP.fp_union_emp</a></span> <span class="kwd">in</span> <span class="id">Hlocs_belongsto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">FP.locs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Locs.union</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Locs.emp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">rs</span> <span class="id"><a href="Asm.html#PC">PC</a></span> = <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="tactic">rename</span> <span class="id">H</span> <span class="id">into</span> <span class="id">Hpc</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Ltac</span> <span class="id">halt_elim</span> <span class="id">rs</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">rs</span> <span class="id"><a href="Asm.html#PC">PC</a></span> = <span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id">_</span> <span class="id">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id">rs</span> <span class="id"><a href="Asm.html#PC">PC</a></span> = <span class="id"><a href="Values.html#Vzero">Vzero</a></span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="id">tryfalse</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hstep</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span>] |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="id">ptr_elim</span>]; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>; <span class="tactic">try</span> <span class="id">external_call_elim</span>; <span class="id">halt_elim</span> <span class="id">rs</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="lock_acq_unbuffer_safe">lock_acq_unbuffer_safe</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sge</span> <span class="id">sG</span> <span class="id">tge</span> <span class="id">b</span> <span class="id">gm</span> <span class="id">b</span>' <span class="id">gm</span>' <span class="id">fp</span> <span class="id">tc</span> <span class="id">tc</span>' <span class="id">tm</span> <span class="id">sc</span> <span class="id">sm</span> <span class="id">t</span> <span class="id">fl</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hspec_init</span> : <span class="id"><a href="InteractionSemantics.html#init_genv">InteractionSemantics.init_genv</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span> <span class="id"><a href="code.html#lock_comp_unit">lock_comp_unit</a></span> <span class="id"><a href="LockAcqProof.html#sge">sge</a></span> <span class="id"><a href="LockAcqProof.html#sG">sG</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Himp_init</span> : <span class="id"><a href="AsmTSO.html#init_genv">init_genv</a></span> <span class="id"><a href="code.html#lock_comp_tso_unit">lock_comp_tso_unit</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hge_equiv</span> : <span class="id"><a href="TSOGlobSem.html#genv_match">genv_match</a></span> (<span class="id"><a href="InteractionSemantics.html#F">InteractionSemantics.F</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="InteractionSemantics.html#V">InteractionSemantics.V</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span>) <span class="id"><a href="LockAcqProof.html#sge">sge</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hlock_acq_match</span> : <span class="id"><a href="InvRG.html#lock_match_state">lock_match_state</a></span> <span class="id"><a href="LockAcqProof.html#sge">sge</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span> <span class="id"><a href="LockAcqProof.html#t">t</a></span> (<span class="id"><a href="LockAcqProof.html#sc">sc</a></span>, <span class="id"><a href="LockAcqProof.html#sm">sm</a></span>) (<span class="id"><a href="LockAcqProof.html#tc">tc</a></span>, <span class="id"><a href="LockAcqProof.html#tm">tm</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hbf</span> : <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="LockAcqProof.html#tm">tm</a></span> <span class="id"><a href="LockAcqProof.html#t">t</a></span> = <span class="id"><a href="LockAcqProof.html#b">b</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hno_conflict</span> : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span>' <span class="id">blk</span> <span class="id">n</span> <span class="id">lo</span> <span class="id">hi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">t</span>' &lt;&gt; <span class="id"><a href="LockAcqProof.html#t">t</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id"><a href="LockAcqProof.html#blk">blk</a></span> <span class="id"><a href="LockAcqProof.html#lo">lo</a></span> <span class="id"><a href="LockAcqProof.html#hi">hi</a></span>) (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="LockAcqProof.html#tm">tm</a></span> <span class="id">t</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="LockAcqProof.html#blk">blk</a></span> &lt;&gt; <span class="id"><a href="MemAux.html#get_block">get_block</a></span> <span class="id"><a href="LockAcqProof.html#fl">fl</a></span> <span class="id"><a href="LockAcqProof.html#n">n</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hgm</span> : <span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="LockAcqProof.html#tm">tm</a></span> = <span class="id"><a href="LockAcqProof.html#gm">gm</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htsostep</span> : <span class="id"><a href="AsmTSO.html#tsostep">tsostep</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span> <span class="id"><a href="LockAcqProof.html#fl">fl</a></span> <span class="id"><a href="LockAcqProof.html#tc">tc</a></span> (<span class="id"><a href="LockAcqProof.html#b">b</a></span>, <span class="id"><a href="LockAcqProof.html#gm">gm</a></span>) <span class="id"><a href="LockAcqProof.html#fp">fp</a></span> <span class="id">tc</span>' (<span class="id">b</span>', <span class="id">gm</span>')),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="LockAcqProof.html#t">t</a></span> <span class="id">b</span>' (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="LockAcqProof.html#tm">tm</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">memory</span> := <span class="id">gm</span>' |}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9942')">Proof.</div>
<div class="proofscript" id="proof9942">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hlock_acq_match</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : init </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Htso_init_core</span> : <span class="id"><a href="LockAcqProof.html#tso_lock_acquire_init_state">tso_lock_acquire_init_state</a></span> <span class="id">___</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htso_init_core</span> <span class="kwd">as</span> [<span class="id">fb</span> [<span class="id">Hfind_symb</span> <span class="id">Htso_init_core</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Htso_init_core</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="ASM_local.html#fundef_init">fundef_init</a></span> <span class="kwd">in</span> <span class="id">Htso_init_core</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Htso_init_core</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htso_init_core</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hspec_init_core</span> : <span class="id"><a href="LockAcqProof.html#spec_lock_acquire_init_state">spec_lock_acquire_init_state</a></span> <span class="id">___</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hspec_init_core</span> <span class="kwd">as</span> [<span class="id">fb2</span> [<span class="id">Hfind_symb</span>' <span class="id">Hspec_init_core</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hspec_init_core</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hspec_init_core</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htsostep</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span>] |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="id">ptr_elim</span>]; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>; <span class="tactic">try</span> <span class="id">external_call_elim</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H1</span> : <span class="id"><a href="loadframe.html#args_len_rec">args_len_rec</a></span> <span class="id">_</span> <span class="id">_</span> = <span class="id">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id">context</span> [<span class="id"><a href="TSOMem.html#tsoalloc">tsoalloc</a></span>],<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H3</span> : <span class="id"><a href="AsmTSO.html#store_args_fmem">store_args_fmem</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H1</span> <span class="id">to</span> <span class="id">Hargs</span>, <span class="id">H2</span> <span class="id">to</span> <span class="id">Htsoalloc</span>, <span class="id">H3</span> <span class="id">to</span> <span class="id">Hstore_args</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hargs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hargs</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Htsoalloc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store_args_fmem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hstore_args</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hstore_args</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">H</span> <span class="id">into</span> <span class="id">Hobj_inv</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="MemLemmas.html#obj_inv_impl_unbuffer_safe">obj_inv_impl_unbuffer_safe</a></span> <span class="kwd">in</span> <span class="id">Hobj_inv</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="MemLemmas.html#unbuffer_safe_tsoalloc_0_stable">unbuffer_safe_tsoalloc_0_stable</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : lock label </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htsostep</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span>] |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="id">ptr_elim</span>]; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>; <span class="tactic">try</span> <span class="id">external_call_elim</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ptr_elim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#exec_instr_TSO">exec_instr_TSO</a></span>],<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id">context</span> [<span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span>], <span class="id">H3</span> : <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H</span> <span class="id">to</span> <span class="id">Hexec_instr_tso</span>, <span class="id">H2</span> <span class="id">to</span> <span class="id">Hobj_inv</span>, <span class="id">H3</span> <span class="id">to</span> <span class="id">Hembed</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hexec_instr_tso</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#buffer_unchange">buffer_unchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="MemLemmas.html#obj_inv_impl_unbuffer_safe">obj_inv_impl_unbuffer_safe</a></span> <span class="kwd">in</span> <span class="id">Hobj_inv</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hembed</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{ <br/>
<div class="doc">lock acquire : movl $L %ecx </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htsostep</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span>] |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="id">ptr_elim</span>]; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>; <span class="tactic">try</span> <span class="id">external_call_elim</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ptr_elim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#exec_instr_TSO">exec_instr_TSO</a></span>],<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id">context</span> [<span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span>], <span class="id">H3</span> : <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H</span> <span class="id">to</span> <span class="id">Hexec_instr_tso</span>, <span class="id">H2</span> <span class="id">to</span> <span class="id">Hobj_inv</span>, <span class="id">H3</span> <span class="id">to</span> <span class="id">Hembed</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hexec_instr_tso</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#buffer_unchange">buffer_unchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="MemLemmas.html#obj_inv_impl_unbuffer_safe">obj_inv_impl_unbuffer_safe</a></span> <span class="kwd">in</span> <span class="id">Hobj_inv</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hembed</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : movl $0 %edx </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htsostep</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span>] |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="id">ptr_elim</span>]; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>; <span class="tactic">try</span> <span class="id">external_call_elim</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ptr_elim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#exec_instr_TSO">exec_instr_TSO</a></span>],<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id">context</span> [<span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span>], <span class="id">H3</span> : <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H</span> <span class="id">to</span> <span class="id">Hexec_instr_tso</span>, <span class="id">H2</span> <span class="id">to</span> <span class="id">Hobj_inv</span>, <span class="id">H3</span> <span class="id">to</span> <span class="id">Hembed</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hexec_instr_tso</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#buffer_unchange">buffer_unchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="MemLemmas.html#obj_inv_impl_unbuffer_safe">obj_inv_impl_unbuffer_safe</a></span> <span class="kwd">in</span> <span class="id">Hobj_inv</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hembed</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : lock acquire label </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htsostep</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span>] |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="id">ptr_elim</span>]; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>; <span class="tactic">try</span> <span class="id">external_call_elim</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ptr_elim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#exec_instr_TSO">exec_instr_TSO</a></span>],<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id">context</span> [<span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span>], <span class="id">H3</span> : <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H</span> <span class="id">to</span> <span class="id">Hexec_instr_tso</span>, <span class="id">H2</span> <span class="id">to</span> <span class="id">Hobj_inv</span>, <span class="id">H3</span> <span class="id">to</span> <span class="id">Hembed</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hexec_instr_tso</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#buffer_unchange">buffer_unchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="MemLemmas.html#obj_inv_impl_unbuffer_safe">obj_inv_impl_unbuffer_safe</a></span> <span class="kwd">in</span> <span class="id">Hobj_inv</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hembed</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : movl $0 RAX </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htsostep</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span>] |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="id">ptr_elim</span>]; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>; <span class="tactic">try</span> <span class="id">external_call_elim</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ptr_elim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#exec_instr_TSO">exec_instr_TSO</a></span>],<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id">context</span> [<span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span>], <span class="id">H3</span> : <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H</span> <span class="id">to</span> <span class="id">Hexec_instr_tso</span>, <span class="id">H2</span> <span class="id">to</span> <span class="id">Hobj_inv</span>, <span class="id">H3</span> <span class="id">to</span> <span class="id">Hembed</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hexec_instr_tso</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#buffer_unchange">buffer_unchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="MemLemmas.html#obj_inv_impl_unbuffer_safe">obj_inv_impl_unbuffer_safe</a></span> <span class="kwd">in</span> <span class="id">Hobj_inv</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hembed</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : lock cmpxchg <span class="bracket">%<span class="id">ecx</span></span> %edx </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htsostep</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span>] |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="id">ptr_elim</span>]; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>; <span class="tactic">try</span> <span class="id">external_call_elim</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ptr_elim</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#exec_instr_TSO">exec_instr_TSO</a></span>],<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id">context</span> [<span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span>], <span class="id">H3</span> : <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H</span> <span class="id">to</span> <span class="id">Hexec_instr_tso</span>, <span class="id">H2</span> <span class="id">to</span> <span class="id">Hobj_inv</span>, <span class="id">H3</span> <span class="id">to</span> <span class="id">Hembed</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span> <span class="id">t</span>) <span class="id">eqn</span>:<span class="id">Hbf</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">eval_addrmode</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Archi.html#ptr64">Archi.ptr64</a></span> <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">rs</span> (<span class="id"><a href="Asm.html#IR">IR</a></span> <span class="id"><a href="Asm.html#RCX">RCX</a></span>) = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqb0</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Ht</span> : <span class="id"><a href="Integers.html#Ptrofs.add">Ptrofs.add</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Integers.html#Ptrofs.of_int">Ptrofs.of_int</a></span> (<span class="id"><a href="Integers.html#Int.add">Int.add</a></span> <span class="id"><a href="Integers.html#Int.zero">Int.zero</a></span> (<span class="id"><a href="Integers.html#Int.repr">Int.repr</a></span> 0)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ht</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="FMemory.html#Mem.loadv">Mem.loadv</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id">fm</span> (<span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id">L</span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0))) <span class="id">eqn</span>:<span class="id">Hload</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">rs</span> (<span class="id"><a href="Asm.html#IR">IR</a></span> <span class="id"><a href="Asm.html#RAX">RAX</a></span>) = <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Values.html#Val.cmpu_bool">Val.cmpu_bool</a></span> (<span class="id"><a href="FMemory.html#Mem.valid_pointer">Mem.valid_pointer</a></span> <span class="id">fm</span>) <span class="id"><a href="Integers.html#Ceq">Ceq</a></span> <span class="id">v</span> <span class="id"><a href="Values.html#Vone">Vone</a></span>) <span class="id">eqn</span>:<span class="id">Hcmp</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">b0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">rs</span> (<span class="id"><a href="Asm.html#IR">IR</a></span> <span class="id"><a href="Asm.html#RDX">RDX</a></span>) = <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="FMemory.html#Mem.storev">Mem.storev</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id">fm</span> (<span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id">L</span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0)) <span class="id"><a href="Values.html#Vzero">Vzero</a></span>) <span class="id">eqn</span>:<span class="id">Hstore</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hexec_instr_tso</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#buffer_unchange1">buffer_unchange1</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hunbuffer_safe</span> : <span class="id"><a href="MemLemmas.html#obj_inv_impl_unbuffer_safe">obj_inv_impl_unbuffer_safe</a></span> <span class="id">___</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#unbuffer_safe_mem_access_same_stable">unbuffer_safe_mem_access_same_stable</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> (<span class="id">bfs</span> := <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span>) (<span class="id">m1</span> := <span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">tm</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hunbuffer_safe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hembed</span> <span class="id">Hstore</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hembed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.storev</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#Mem_store_mem_access_stable">Mem_store_mem_access_stable</a></span> <span class="kwd">in</span> <span class="id">Hstore</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#Mem_GMem_access_eq">Mem_GMem_access_eq</a></span> <span class="kwd">in</span> <span class="id">Hstore</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">Hstore</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hexec_instr_tso</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#buffer_unchange1">buffer_unchange1</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hobj_inv</span> <span class="id">Hembed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="MemLemmas.html#obj_inv_impl_unbuffer_safe">obj_inv_impl_unbuffer_safe</a></span> <span class="kwd">in</span> <span class="id">Hobj_inv</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : je enter <span class="bracket"><span class="id">ZF</span> = 0</span> </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htsostep</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span>] |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="id">ptr_elim</span>]; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>; <span class="tactic">try</span> <span class="id">external_call_elim</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ptr_elim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#exec_instr_TSO">exec_instr_TSO</a></span>],<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id">context</span> [<span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span>], <span class="id">H3</span> : <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H</span> <span class="id">to</span> <span class="id">Hexec_instr_tso</span>, <span class="id">H2</span> <span class="id">to</span> <span class="id">Hobj_inv</span>, <span class="id">H3</span> <span class="id">to</span> <span class="id">Hembed</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">rs</span> (<span class="id"><a href="Asm.html#CR">CR</a></span> <span class="id"><a href="Asm.html#ZF">ZF</a></span>) = <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Integers.html#Int.eq_true">Int.eq_true</a></span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#tso_goto_label">tso_goto_label</a></span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">find_label</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id"><a href="code.html#enter_lbl">enter_lbl</a></span> <span class="id"><a href="code.html#lock_lbl">lock_lbl</a></span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id"><a href="code.html#enter_lbl">enter_lbl</a></span> <span class="id"><a href="code.html#lock_acquire_lbl">lock_acquire_lbl</a></span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id"><a href="code.html#enter_lbl">enter_lbl</a></span> <span class="id"><a href="code.html#spin_lbl">spin_lbl</a></span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">rs</span> <span class="id"><a href="Asm.html#PC">PC</a></span> = <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hexec_instr_tso</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#buffer_unchange">buffer_unchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="MemLemmas.html#obj_inv_impl_unbuffer_safe">obj_inv_impl_unbuffer_safe</a></span> <span class="kwd">in</span> <span class="id">Hobj_inv</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hembed</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : je enter <span class="bracket"><span class="id">ZF</span> = 1</span> </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htsostep</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span>] |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="id">ptr_elim</span>]; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>; <span class="tactic">try</span> <span class="id">external_call_elim</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ptr_elim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#exec_instr_TSO">exec_instr_TSO</a></span>],<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id">context</span> [<span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span>], <span class="id">H3</span> : <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H</span> <span class="id">to</span> <span class="id">Hexec_instr_tso</span>, <span class="id">H2</span> <span class="id">to</span> <span class="id">Hobj_inv</span>, <span class="id">H3</span> <span class="id">to</span> <span class="id">Hembed</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">rs</span> (<span class="id"><a href="Asm.html#CR">CR</a></span> <span class="id"><a href="Asm.html#ZF">ZF</a></span>) = <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hnot_eq</span> : <span class="id"><a href="Integers.html#Int.eq">Int.eq</a></span> <span class="id"><a href="Integers.html#Int.zero">Int.zero</a></span> <span class="id"><a href="Integers.html#Int.one">Int.one</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hnot_eq</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hexec_instr_tso</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#buffer_unchange">buffer_unchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="MemLemmas.html#obj_inv_impl_unbuffer_safe">obj_inv_impl_unbuffer_safe</a></span> <span class="kwd">in</span> <span class="id">Hobj_inv</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hembed</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : spain label </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htsostep</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span>] |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="id">ptr_elim</span>]; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>; <span class="tactic">try</span> <span class="id">external_call_elim</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ptr_elim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#exec_instr_TSO">exec_instr_TSO</a></span>],<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id">context</span> [<span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span>], <span class="id">H3</span> : <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H</span> <span class="id">to</span> <span class="id">Hexec_instr_tso</span>, <span class="id">H2</span> <span class="id">to</span> <span class="id">Hobj_inv</span>, <span class="id">H3</span> <span class="id">to</span> <span class="id">Hembed</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hexec_instr_tso</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#buffer_unchange">buffer_unchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="MemLemmas.html#obj_inv_impl_unbuffer_safe">obj_inv_impl_unbuffer_safe</a></span> <span class="kwd">in</span> <span class="id">Hobj_inv</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hembed</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : movl %ebx <span class="bracket">%<span class="id">ecx</span></span> </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htsostep</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span>] |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="id">ptr_elim</span>]; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>; <span class="tactic">try</span> <span class="id">external_call_elim</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ptr_elim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#exec_instr_TSO">exec_instr_TSO</a></span>],<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id">context</span> [<span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span>], <span class="id">H3</span> : <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H</span> <span class="id">to</span> <span class="id">Hexec_instr_tso</span>, <span class="id">H2</span> <span class="id">to</span> <span class="id">Hobj_inv</span>, <span class="id">H3</span> <span class="id">to</span> <span class="id">Hembed</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">exec_load_TSO</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">eval_addrmode</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Archi.html#ptr64">Archi.ptr64</a></span> <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">rs</span> (<span class="id"><a href="Asm.html#IR">IR</a></span> <span class="id"><a href="Asm.html#RCX">RCX</a></span>) = <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqb0</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Ht</span> : <span class="id"><a href="Integers.html#Ptrofs.add">Ptrofs.add</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Integers.html#Ptrofs.of_int">Ptrofs.of_int</a></span> (<span class="id"><a href="Integers.html#Int.add">Int.add</a></span> <span class="id"><a href="Integers.html#Int.zero">Int.zero</a></span> (<span class="id"><a href="Integers.html#Int.repr">Int.repr</a></span> 0)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ht</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#tsoloadv">tsoloadv</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{| <span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span> := <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span> <span class="id">t</span>; <span class="id">fmemory</span> := <span class="id">fm</span> |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id">L</span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0))) <span class="id">eqn</span>:<span class="id">Hload</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hexec_instr_tso</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#buffer_unchange">buffer_unchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="MemLemmas.html#obj_inv_impl_unbuffer_safe">obj_inv_impl_unbuffer_safe</a></span> <span class="kwd">in</span> <span class="id">Hobj_inv</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hembed</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : cmp %ebx $0 </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htsostep</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span>] |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="id">ptr_elim</span>]; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>; <span class="tactic">try</span> <span class="id">external_call_elim</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ptr_elim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#exec_instr_TSO">exec_instr_TSO</a></span>],<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id">context</span> [<span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span>], <span class="id">H3</span> : <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H</span> <span class="id">to</span> <span class="id">Hexec_instr_tso</span>, <span class="id">H2</span> <span class="id">to</span> <span class="id">Hobj_inv</span>, <span class="id">H3</span> <span class="id">to</span> <span class="id">Hembed</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="ASM_local.html#check_vundef">check_vundef</a></span> (<span class="id">rs</span> <span class="id"><a href="Asm.html#RBX">RBX</a></span>) (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="Integers.html#Int.zero">Int.zero</a></span>)) <span class="id">eqn</span>:<span class="id">Heq</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">compare_ints_TSO</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">rs</span> (<span class="id"><a href="Asm.html#IR">IR</a></span> <span class="id"><a href="Asm.html#RBX">RBX</a></span>) = <span class="id">_</span> \/ <span class="id">rs</span> (<span class="id"><a href="Asm.html#IR">IR</a></span> <span class="id"><a href="Asm.html#RBX">RBX</a></span>) = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">H</span> | <span class="id">H</span>]; <span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>; <span class="tactic">inversion</span> <span class="id">Hexec_instr_tso</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#buffer_unchange">buffer_unchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="MemLemmas.html#obj_inv_impl_unbuffer_safe">obj_inv_impl_unbuffer_safe</a></span> <span class="kwd">in</span> <span class="id">Hobj_inv</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hembed</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#buffer_unchange">buffer_unchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="MemLemmas.html#obj_inv_impl_unbuffer_safe">obj_inv_impl_unbuffer_safe</a></span> <span class="kwd">in</span> <span class="id">Hobj_inv</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hembed</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : je spin </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htsostep</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span>] |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="id">ptr_elim</span>]; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>; <span class="tactic">try</span> <span class="id">external_call_elim</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ptr_elim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#exec_instr_TSO">exec_instr_TSO</a></span>],<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id">context</span> [<span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span>], <span class="id">H3</span> : <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H</span> <span class="id">to</span> <span class="id">Hexec_instr_tso</span>, <span class="id">H2</span> <span class="id">to</span> <span class="id">Hobj_inv</span>, <span class="id">H3</span> <span class="id">to</span> <span class="id">Hembed</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">rs</span> (<span class="id"><a href="Asm.html#CR">CR</a></span> <span class="id"><a href="Asm.html#ZF">ZF</a></span>) = <span class="id">_</span> \/ <span class="id">rs</span> (<span class="id"><a href="Asm.html#CR">CR</a></span> <span class="id"><a href="Asm.html#ZF">ZF</a></span>) = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">H</span> | <span class="id">H</span>]; <span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Integers.html#Int.eq_true">Int.eq_true</a></span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">tso_goto_label</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">find_label</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id"><a href="code.html#spin_lbl">spin_lbl</a></span> <span class="id"><a href="code.html#lock_lbl">lock_lbl</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id"><a href="code.html#spin_lbl">spin_lbl</a></span> <span class="id"><a href="code.html#lock_acquire_lbl">lock_acquire_lbl</a></span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">rs</span> <span class="id"><a href="Asm.html#PC">PC</a></span> = <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hexec_instr_tso</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#buffer_unchange">buffer_unchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="MemLemmas.html#obj_inv_impl_unbuffer_safe">obj_inv_impl_unbuffer_safe</a></span> <span class="kwd">in</span> <span class="id">Hobj_inv</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hembed</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="Integers.html#Int.eq">Int.eq</a></span> <span class="id"><a href="Integers.html#Int.zero">Int.zero</a></span> <span class="id"><a href="Integers.html#Int.one">Int.one</a></span>) <span class="kwd">with</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hexec_instr_tso</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#buffer_unchange">buffer_unchange</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="MemLemmas.html#obj_inv_impl_unbuffer_safe">obj_inv_impl_unbuffer_safe</a></span> <span class="kwd">in</span> <span class="id">Hobj_inv</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hembed</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : jmp lock_acquire </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htsostep</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span>] |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="id">ptr_elim</span>]; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>; <span class="tactic">try</span> <span class="id">external_call_elim</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ptr_elim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#exec_instr_TSO">exec_instr_TSO</a></span>],<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id">context</span> [<span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span>], <span class="id">H3</span> : <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H</span> <span class="id">to</span> <span class="id">Hexec_instr_tso</span>, <span class="id">H2</span> <span class="id">to</span> <span class="id">Hobj_inv</span>, <span class="id">H3</span> <span class="id">to</span> <span class="id">Hembed</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">tso_goto_label</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">find_label</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id"><a href="code.html#lock_acquire_lbl">lock_acquire_lbl</a></span> <span class="id"><a href="code.html#lock_lbl">lock_lbl</a></span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">rs</span> <span class="id"><a href="Asm.html#PC">PC</a></span> = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hexec_instr_tso</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#buffer_unchange">buffer_unchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="MemLemmas.html#obj_inv_impl_unbuffer_safe">obj_inv_impl_unbuffer_safe</a></span> <span class="kwd">in</span> <span class="id">Hobj_inv</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hembed</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : enter label </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htsostep</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span>] |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="id">ptr_elim</span>]; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>; <span class="tactic">try</span> <span class="id">external_call_elim</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ptr_elim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#exec_instr_TSO">exec_instr_TSO</a></span>],<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id">context</span> [<span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span>], <span class="id">H3</span> : <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H</span> <span class="id">to</span> <span class="id">Hexec_instr_tso</span>, <span class="id">H2</span> <span class="id">to</span> <span class="id">Hobj_inv</span>, <span class="id">H3</span> <span class="id">to</span> <span class="id">Hembed</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hexec_instr_tso</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#buffer_unchange">buffer_unchange</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="MemLemmas.html#obj_inv_impl_unbuffer_safe">obj_inv_impl_unbuffer_safe</a></span> <span class="kwd">in</span> <span class="id">Hobj_inv</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hembed</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : movl $0 %eax </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htsostep</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span>] |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="id">ptr_elim</span>]; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>; <span class="tactic">try</span> <span class="id">external_call_elim</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ptr_elim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#exec_instr_TSO">exec_instr_TSO</a></span>],<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id">context</span> [<span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span>], <span class="id">H3</span> : <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H</span> <span class="id">to</span> <span class="id">Hexec_instr_tso</span>, <span class="id">H2</span> <span class="id">to</span> <span class="id">Hobj_inv</span>, <span class="id">H3</span> <span class="id">to</span> <span class="id">Hembed</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hexec_instr_tso</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#buffer_unchange">buffer_unchange</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="MemLemmas.html#obj_inv_impl_unbuffer_safe">obj_inv_impl_unbuffer_safe</a></span> <span class="kwd">in</span> <span class="id">Hobj_inv</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hembed</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : retl </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htsostep</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span>] |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="id">ptr_elim</span>]; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>; <span class="tactic">try</span> <span class="id">external_call_elim</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ptr_elim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#exec_instr_TSO">exec_instr_TSO</a></span>],<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id">context</span> [<span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span>], <span class="id">H3</span> : <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H</span> <span class="id">to</span> <span class="id">Hexec_instr_tso</span>, <span class="id">H2</span> <span class="id">to</span> <span class="id">Hobj_inv</span>, <span class="id">H3</span> <span class="id">to</span> <span class="id">Hembed</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hexec_instr_tso</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#buffer_unchange">buffer_unchange</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="MemLemmas.html#obj_inv_impl_unbuffer_safe">obj_inv_impl_unbuffer_safe</a></span> <span class="kwd">in</span> <span class="id">Hobj_inv</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hembed</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : halt </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htsostep</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span>] |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="id">ptr_elim</span>]; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>; <span class="tactic">try</span> <span class="id">external_call_elim</span>.<br/>
&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret_zero_ptr_false</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret_zero_ptr_false</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret_zero_ptr_false</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret_zero_ptr_false</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<div class="doc">The function initial step of function lock satisfies <span class="bracket"><span class="id">Go</span></span> </div>
<span class="kwd">Lemma</span> <span class="id"><a name="lock_init_step_satify_Gobj">lock_init_step_satify_Gobj</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sge</span> <span class="id">sG</span> <span class="id">tge</span> <span class="id">t</span> <span class="id">sc</span> <span class="id">sm</span> <span class="id">tc</span> <span class="id">tc</span>' <span class="id">tm</span> <span class="id">tm</span>' <span class="id">b</span>' <span class="id">gm</span>' <span class="id">fp</span> <span class="id">fl</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hspec_init</span> : <span class="id"><a href="InteractionSemantics.html#init_genv">InteractionSemantics.init_genv</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="code.html#lock_comp_unit">lock_comp_unit</a></span> <span class="id"><a href="LockAcqProof.html#sge">sge</a></span> <span class="id"><a href="LockAcqProof.html#sG">sG</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Himp_init</span> : <span class="id"><a href="AsmTSO.html#init_genv">init_genv</a></span> <span class="id"><a href="code.html#lock_comp_tso_unit">lock_comp_tso_unit</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hge_equiv</span> : <span class="id"><a href="TSOGlobSem.html#genv_match">genv_match</a></span> (<span class="id"><a href="InteractionSemantics.html#F">InteractionSemantics.F</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="InteractionSemantics.html#V">InteractionSemantics.V</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span>) <span class="id"><a href="LockAcqProof.html#sge">sge</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hno_conflict</span> : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span>' <span class="id">blk</span> <span class="id">n</span> <span class="id">lo</span> <span class="id">hi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">t</span>' &lt;&gt; <span class="id"><a href="LockAcqProof.html#t">t</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id"><a href="LockAcqProof.html#blk">blk</a></span> <span class="id"><a href="LockAcqProof.html#lo">lo</a></span> <span class="id"><a href="LockAcqProof.html#hi">hi</a></span>) (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="LockAcqProof.html#tm">tm</a></span> <span class="id">t</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="LockAcqProof.html#blk">blk</a></span> &lt;&gt; <span class="id"><a href="MemAux.html#get_block">get_block</a></span> <span class="id"><a href="LockAcqProof.html#fl">fl</a></span> <span class="id"><a href="LockAcqProof.html#n">n</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hrel_tm_gm_vb</span> : <span class="id"><a href="RGRels.html#rel_tm_gm_vb">rel_tm_gm_vb</a></span> <span class="id"><a href="LockAcqProof.html#sm">sm</a></span> <span class="id"><a href="LockAcqProof.html#tm">tm</a></span> <span class="id"><a href="LockAcqProof.html#fl">fl</a></span> <span class="id"><a href="LockAcqProof.html#t">t</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htsostep</span> : <span class="id"><a href="AsmTSO.html#tsostep">tsostep</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span> <span class="id"><a href="LockAcqProof.html#fl">fl</a></span> <span class="id"><a href="LockAcqProof.html#tc">tc</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="LockAcqProof.html#tm">tm</a></span> <span class="id"><a href="LockAcqProof.html#t">t</a></span>, <span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="LockAcqProof.html#tm">tm</a></span>) <span class="id"><a href="LockAcqProof.html#fp">fp</a></span> <span class="id">tc</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">b</span>', <span class="id">gm</span>'))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htm</span> : <span class="id">tm</span>' = (<span class="id"><a href="TSOMem.html#mktsomem">mktsomem</a></span> (<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="LockAcqProof.html#t">t</a></span> <span class="id">b</span>' (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="LockAcqProof.html#tm">tm</a></span>)) <span class="id">gm</span>'))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htc_init</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="LockAcqProof.html#tc">tc</a></span> = <span class="id"><a href="AsmTSO.html#init_core">init_core</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span> <span class="id"><a href="code.html#lock_acquire_ident">lock_acquire_ident</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hsc_init</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="LockAcqProof.html#sc">sc</a></span> = <span class="id"><a href="SpecLang.html#init_core">SpecLang.init_core</a></span> <span class="id"><a href="LockAcqProof.html#sge">sge</a></span> <span class="id"><a href="code.html#lock_acquire_ident">lock_acquire_ident</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hobj_inv</span> : <span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span> <span class="id"><a href="LockAcqProof.html#sm">sm</a></span> <span class="id"><a href="LockAcqProof.html#tm">tm</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> <span class="id">FP</span> <span class="id">sc</span>' <span class="id">sm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#star">InteractionSemantics.star</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="InteractionSemantics.html#step">InteractionSemantics.step</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span> <span class="id"><a href="LockAcqProof.html#sG">sG</a></span> <span class="id"><a href="LockAcqProof.html#fl">fl</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="LockAcqProof.html#sc">sc</a></span> <span class="id"><a href="LockAcqProof.html#sm">sm</a></span> <span class="id">FP</span> <span class="id">sc</span>' <span class="id">sm</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( <span class="id"><a href="InvRG.html#Gobj">Gobj</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span> <span class="id"><a href="LockAcqProof.html#t">t</a></span> <span class="id"><a href="LockAcqProof.html#sm">sm</a></span> <span class="id"><a href="LockAcqProof.html#tm">tm</a></span> <span class="id">sm</span>' <span class="id">tm</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InvRG.html#obj_match_state">obj_match_state</a></span> <span class="id"><a href="LockAcqProof.html#sge">sge</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span> <span class="id"><a href="LockAcqProof.html#t">t</a></span> (<span class="id">sc</span>', <span class="id">sm</span>') (<span class="id">tc</span>', <span class="id">tm</span>') /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html#tm_alloc_not_fl">tm_alloc_not_fl</a></span> <span class="id">tm</span>' <span class="id"><a href="LockAcqProof.html#fl">fl</a></span> <span class="id"><a href="LockAcqProof.html#t">t</a></span> /\ <span class="id"><a href="RGRels.html#rel_tm_gm_vb">rel_tm_gm_vb</a></span> <span class="id">sm</span>' <span class="id">tm</span>' <span class="id"><a href="LockAcqProof.html#fl">fl</a></span> <span class="id"><a href="LockAcqProof.html#t">t</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html#obj_fp">obj_fp</a></span> <span class="id"><a href="LockAcqProof.html#sm">sm</a></span> <span class="id">sm</span>' <span class="id"><a href="LockAcqProof.html#fp">fp</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="kwd">forall</span> <span class="id">FP</span>' <span class="id">sc</span>'' <span class="id">sm</span>'', ~ <span class="id"><a href="InteractionSemantics.html#step">InteractionSemantics.step</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span> <span class="id"><a href="LockAcqProof.html#sG">sG</a></span> <span class="id"><a href="LockAcqProof.html#fl">fl</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sc</span>' <span class="id">sm</span>' <span class="id">FP</span>' <span class="id">sc</span>'' <span class="id">sm</span>'')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="InteractionSemantics.html#at_external">InteractionSemantics.at_external</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span> <span class="id"><a href="LockAcqProof.html#sG">sG</a></span> <span class="id">sc</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">ores</span>, <span class="id"><a href="InteractionSemantics.html#after_external">InteractionSemantics.after_external</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span> <span class="id">sc</span>' <span class="id"><a href="LockAcqProof.html#ores">ores</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="InteractionSemantics.html#halt">InteractionSemantics.halt</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span> <span class="id">sc</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9943')">Proof.</div>
<div class="proofscript" id="proof9943">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="LockAcqProof.html#tso_lock_acquire_init_state">tso_lock_acquire_init_state</a></span> <span class="kwd">in</span> <span class="id">Htc_init</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htc_init</span> <span class="kwd">as</span> [<span class="id">fb</span> [<span class="id">Hfind_symb</span> <span class="id">Hf_init</span>]].<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="ASM_local.html#fundef_init">fundef_init</a></span> <span class="kwd">in</span> <span class="id">Hf_init</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hf_init</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hf_init</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="LockAcqProof.html#spec_lock_acquire_init_state">spec_lock_acquire_init_state</a></span> <span class="kwd">in</span> <span class="id">Hsc_init</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hsc_init</span> <span class="kwd">as</span> [<span class="id">fb</span>' [<span class="id">Hfind_symb</span>' <span class="id">Hsc_init</span>]].<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hsc_init</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hsc_init</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Hsc_init</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htsostep</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Htsostep</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span>] |- <span class="id">_</span> =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">H1</span> : <span class="id">context</span> [<span class="id"><a href="loadframe.html#args_len_rec">args_len_rec</a></span>],<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id">context</span> [<span class="id"><a href="TSOMem.html#tsoalloc">tsoalloc</a></span>], <span class="id">H3</span> : <span class="id">context</span> [<span class="id"><a href="AsmTSO.html#store_args_fmem">store_args_fmem</a></span>] |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H1</span> <span class="id">to</span> <span class="id">Hargs_len</span>, <span class="id">H2</span> <span class="id">to</span> <span class="id">Htsoalloc</span>, <span class="id">H3</span> <span class="id">to</span> <span class="id">Hstore_args</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hargs_len</span>, <span class="id">Htsoalloc</span>, <span class="id">Hstore_args</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hargs_len</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Htsoalloc</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store_args_fmem</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hstore_args</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hstore_args</span>; <span class="tactic">subst</span> <span class="id">tsofm</span>'.<br/>
&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H1</span> : <span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">_</span> = <span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H1</span> <span class="id">to</span> <span class="id">Hm_eq</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htsoalloc</span>; <span class="tactic">subst</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hembed_same_block</span> : <span class="id"><a href="TSOMemLemmas.html#rel_tm_gm_vb_impl_alloc_same_block">rel_tm_gm_vb_impl_alloc_same_block</a></span> <span class="id">___</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hm_eq</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hembed_same_block</span> <span class="kwd">as</span> [<span class="id">fsm</span> [<span class="id">Hspec_embed_ex</span> <span class="id">Hnextblock_eq</span>]].<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hmem_alloc</span> : <span class="id"><a href="TSOMemLemmas.html#embed_alloc_succ">embed_alloc_succ</a></span> <span class="id">___</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hmem_alloc</span> <span class="kwd">as</span> [<span class="id">fsm</span>' <span class="id">Hmem_alloc</span>].<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hspec_embed_ex</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="FMemory.html#Mem.freelist">Mem.freelist</a></span> <span class="id">_</span> = <span class="id"><a href="FMemory.html#Mem.freelist">Mem.freelist</a></span> <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="id">renames</span> <span class="id">H</span> <span class="id">to</span> <span class="id">Hmem_freels</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;<span class="tactic">do</span> 3 <span class="id">eexists</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#star_step">InteractionSemantics.star_step</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hmem_freels</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hmem_freels</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id">fsm</span>'); <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">left</span>.<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hobj_inv</span>' : <span class="id"><a href="MemLemmas.html#obj_inv_alloc_stable">obj_inv_alloc_stable</a></span> <span class="id">___</span>; <span class="tactic">eauto</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hobj_inv</span>'.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">HGalloc</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InvRG.html#G_alloc">G_alloc</a></span> <span class="id">tge</span> <span class="id">t</span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fsm</span>) <span class="id">tm</span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fsm</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id">t</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span> <span class="id">t</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> (<span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id">fm</span>') 0 0 :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">memory</span> := <span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm</span> |}).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#G_alloc">G_alloc</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id">fsm</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">symmetry</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#Mem_alloc_gm_alloc">Mem_alloc_gm_alloc</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#buffer_insert">buffer_insert</a></span> <span class="kwd">in</span> <span class="id">Htsoalloc</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Htsoalloc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id"><a href="TSOMemLemmas.html#tsoalloc_append">tsoalloc_append</a></span> <span class="id">___</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">Hnextblock_eq</span> <span class="kwd">in</span> *; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#mem_strip_gm_vb_eq">mem_strip_gm_vb_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#next_block_not_in_validblock">next_block_not_in_validblock</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="TSOMemLemmas.html#next_block_not_in_validblock">next_block_not_in_validblock</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H</span> <span class="id">fm</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id">fm</span>') (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">gm</span>')).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H8</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H8</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#mem_strip_gm_vb_eq">mem_strip_gm_vb_eq</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;} <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hnot_in_vb</span> : <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#not_in_apply_bf_vb_not_in_orign">not_in_apply_bf_vb_not_in_orign</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hunbuffer_safe</span> : <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="MemLemmas.html#obj_inv_impl_unbuffer_safe">obj_inv_impl_unbuffer_safe</a></span> <span class="kwd">in</span> <span class="id">Hunbuffer_safe</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hm_eq</span> <span class="kwd">in</span> <span class="id">H0</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="kwd">forall</span> <span class="id">t</span> <span class="id">lo</span> <span class="id">hi</span>, ~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> (<span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id">fm</span>') <span class="id"><a href="LockAcqProof.html#lo">lo</a></span> <span class="id"><a href="LockAcqProof.html#hi">hi</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span> <span class="id"><a href="LockAcqProof.html#t">t</a></span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hunbuffer_safe</span> <span class="id">Hno_conflict</span> <span class="id">H0</span> <span class="id">H5</span> <span class="id">H8</span> <span class="id">Hm_eq</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t0</span>); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H8</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buffer_not_in_vb_not_alloc_in_bf">apply_buffer_not_in_vb_not_alloc_in_bf</a></span> <span class="kwd">in</span> <span class="id">H5</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H8</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hno_conflict</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;} <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hrel_tm_gm_vb</span> <span class="id">Hnextblock_eq</span> <span class="id">Hmem_freels</span> <span class="id">Hunbuffer_safe</span> <span class="id">H1</span> <span class="id">H0</span> <span class="id">H5</span> <span class="id">Hm_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t</span>') <span class="id">eqn</span>:?; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">introv</span> <span class="id">Hin</span>; <span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">ofs</span> <span class="id">Hin</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hm_eq</span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#unbuffer_safe_block_not_alloc_and_invb_not_in_buffer">unbuffer_safe_block_not_alloc_and_invb_not_in_buffer</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hnextblock_eq</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">introv</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hnextblock_eq</span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">ofs</span> <span class="id">Hin</span>]. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#unbuffer_safe_block_not_alloc_and_invb_not_in_buffer">unbuffer_safe_block_not_alloc_and_invb_not_in_buffer</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hnextblock_eq</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.  <br/>
&nbsp;G&nbsp;*)</span>&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#Gobj">Gobj</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">do</span> 3 <span class="id">right</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;match&nbsp;state&nbsp;*)</span>&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InvRG.html#obj_lock_match">obj_lock_match</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InvRG.html#lock_label_match">lock_label_match</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">rs0</span>.<br/>
&nbsp;&nbsp;<span class="id">Pregmap_elim</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Himp_init</span> <span class="id">Hfind_symb</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Himp_init</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H2</span> <span class="id"><a href="code.html#lock_acquire_ident">lock_acquire_ident</a></span>).<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H5</span> <span class="kwd">in</span> <span class="id">H10</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H9</span> <span class="id">H10</span> <span class="id">Hfind_symb</span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hfind_symb</span> <span class="kwd">in</span> <span class="id">H9</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H9</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Globalenvs.html#Genv.find_funct_ptr">Genv.find_funct_ptr</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Globalenvs.html#Genv.find_def">Genv.find_def</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H10</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hno_conflict</span> <span class="id">H5</span> <span class="id">H8</span> <span class="id">Hmem_alloc</span> <span class="id">Hm_eq</span> <span class="id">HGalloc</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">tm_alloc_not_fl</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_not_eq_get">tupdate_not_eq_get</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hrel_tm_gm_vb</span> <span class="id">Hm_eq</span> <span class="id">Hmem_alloc</span> <span class="id">Hnextblock_eq</span> <span class="id">HGalloc</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">rel_tm_gm_vb</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buffer_split">apply_buffer_split</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">gm</span>' [<span class="id">Happly_buf1</span> <span class="id">Happly_buf2</span>]].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hm_eq</span> <span class="kwd">in</span> <span class="id">Happly_buf1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hrel_tm_gm_vb</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="FMemory.html#Mem.alloc_validblocks">Mem.alloc_validblocks</a></span> <span class="kwd">in</span> <span class="id">Hmem_alloc</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hmem_alloc</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Happly_buf2</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">eapply</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Happly_buf2</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">eapply</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="RGRels.html#obj_alloc_fp">obj_alloc_fp</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">tsoalloc_fp</span>, <span class="id">uncheck_alloc_fp</span>, <span class="id">store_args_fp</span>, <span class="id">FP.locs</span>, <span class="id">FP.union</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">G_alloc</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">HGalloc</span> <span class="kwd">as</span> (<span class="id">b</span>' &amp; <span class="id">HGalloc</span>).<br/>
&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">HGalloc</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">b</span>' = <span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id">fsm</span>).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H1</span> <span class="id">Hmem_alloc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Transparent</span> <span class="id"><a href="FMemory.html#Mem.alloc">Mem.alloc</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.alloc</span>, <span class="id">alloc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>; <span class="id">inv</span> <span class="id">Hmem_alloc</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H3</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Locs.belongsto</span>, <span class="id">Locs.union</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">subst</span>; <span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">Hnextblock_eq</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hmem_alloc</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.alloc</span>; <span class="id">inv</span> <span class="id">Hmem_alloc</span>; <span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#strip">strip</a></span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H4</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>; <span class="id">inv</span> <span class="id">H1</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">right</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fsm</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">unused_mem</span>, <span class="id">Mem.nextblock</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zle">zle</a></span> 0 <span class="id">ofs</span>') <span class="id">eqn</span>:?; <span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zlt">zlt</a></span> <span class="id">ofs</span>' 0) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<div class="doc"><span class="bracket"><span class="id">match_tau</span></span> holds in function lock </div>
<span class="kwd">Lemma</span> <span class="id"><a name="lock_step_satisfy_Gobj">lock_step_satisfy_Gobj</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sge</span> <span class="id">sG</span> <span class="id">tge</span> <span class="id">t</span> <span class="id">sc</span> <span class="id">sm</span> <span class="id">tc</span> <span class="id">tc</span>' <span class="id">tm</span> <span class="id">tm</span>' <span class="id">b</span>' <span class="id">gm</span>' <span class="id">fp</span> <span class="id">fl</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hspec_init</span> : <span class="id"><a href="InteractionSemantics.html#init_genv">InteractionSemantics.init_genv</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="code.html#lock_comp_unit">lock_comp_unit</a></span> <span class="id"><a href="LockAcqProof.html#sge">sge</a></span> <span class="id"><a href="LockAcqProof.html#sG">sG</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Himp_init</span> : <span class="id"><a href="AsmTSO.html#init_genv">init_genv</a></span> <span class="id"><a href="code.html#lock_comp_tso_unit">lock_comp_tso_unit</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hge_equiv</span> : <span class="id"><a href="TSOGlobSem.html#genv_match">genv_match</a></span> (<span class="id"><a href="InteractionSemantics.html#F">InteractionSemantics.F</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="InteractionSemantics.html#V">InteractionSemantics.V</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span>) <span class="id"><a href="LockAcqProof.html#sge">sge</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hno_conflict</span> : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span>' <span class="id">blk</span> <span class="id">n</span> <span class="id">lo</span> <span class="id">hi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">t</span>' &lt;&gt; <span class="id"><a href="LockAcqProof.html#t">t</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id"><a href="LockAcqProof.html#blk">blk</a></span> <span class="id"><a href="LockAcqProof.html#lo">lo</a></span> <span class="id"><a href="LockAcqProof.html#hi">hi</a></span>) (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="LockAcqProof.html#tm">tm</a></span> <span class="id">t</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="LockAcqProof.html#blk">blk</a></span> &lt;&gt; <span class="id"><a href="MemAux.html#get_block">get_block</a></span> <span class="id"><a href="LockAcqProof.html#fl">fl</a></span> <span class="id"><a href="LockAcqProof.html#n">n</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hrel_tm_gm_vb</span> : <span class="id"><a href="RGRels.html#rel_tm_gm_vb">rel_tm_gm_vb</a></span> <span class="id"><a href="LockAcqProof.html#sm">sm</a></span> <span class="id"><a href="LockAcqProof.html#tm">tm</a></span> <span class="id"><a href="LockAcqProof.html#fl">fl</a></span> <span class="id"><a href="LockAcqProof.html#t">t</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htsostep</span> : <span class="id"><a href="AsmTSO.html#tsostep">tsostep</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span> <span class="id"><a href="LockAcqProof.html#fl">fl</a></span> <span class="id"><a href="LockAcqProof.html#tc">tc</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="LockAcqProof.html#tm">tm</a></span> <span class="id"><a href="LockAcqProof.html#t">t</a></span>, <span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="LockAcqProof.html#tm">tm</a></span>) <span class="id"><a href="LockAcqProof.html#fp">fp</a></span> <span class="id">tc</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">b</span>', <span class="id">gm</span>'))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hlock_acq_match_state</span> : <span class="id"><a href="InvRG.html#lock_match_state">lock_match_state</a></span> <span class="id"><a href="LockAcqProof.html#sge">sge</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span> <span class="id"><a href="LockAcqProof.html#t">t</a></span> (<span class="id"><a href="LockAcqProof.html#sc">sc</a></span>, <span class="id"><a href="LockAcqProof.html#sm">sm</a></span>) (<span class="id"><a href="LockAcqProof.html#tc">tc</a></span>, <span class="id"><a href="LockAcqProof.html#tm">tm</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htm</span> : <span class="id">tm</span>' = (<span class="id"><a href="TSOMem.html#mktsomem">mktsomem</a></span> (<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="LockAcqProof.html#t">t</a></span> <span class="id">b</span>' (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="LockAcqProof.html#tm">tm</a></span>)) <span class="id">gm</span>')),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> <span class="id">FP</span> <span class="id">sc</span>' <span class="id">sm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#star">InteractionSemantics.star</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="InteractionSemantics.html#step">InteractionSemantics.step</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span> <span class="id"><a href="LockAcqProof.html#sG">sG</a></span> <span class="id"><a href="LockAcqProof.html#fl">fl</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="LockAcqProof.html#sc">sc</a></span> <span class="id"><a href="LockAcqProof.html#sm">sm</a></span> <span class="id">FP</span> <span class="id">sc</span>' <span class="id">sm</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( <span class="id"><a href="InvRG.html#Gobj">Gobj</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span> <span class="id"><a href="LockAcqProof.html#t">t</a></span> <span class="id"><a href="LockAcqProof.html#sm">sm</a></span> <span class="id"><a href="LockAcqProof.html#tm">tm</a></span> <span class="id">sm</span>' <span class="id">tm</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InvRG.html#obj_match_state">obj_match_state</a></span> <span class="id"><a href="LockAcqProof.html#sge">sge</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span> <span class="id"><a href="LockAcqProof.html#t">t</a></span> (<span class="id">sc</span>', <span class="id">sm</span>') (<span class="id">tc</span>', <span class="id">tm</span>') /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html#tm_alloc_not_fl">tm_alloc_not_fl</a></span> <span class="id">tm</span>' <span class="id"><a href="LockAcqProof.html#fl">fl</a></span> <span class="id"><a href="LockAcqProof.html#t">t</a></span> /\ <span class="id"><a href="RGRels.html#rel_tm_gm_vb">rel_tm_gm_vb</a></span> <span class="id">sm</span>' <span class="id">tm</span>' <span class="id"><a href="LockAcqProof.html#fl">fl</a></span> <span class="id"><a href="LockAcqProof.html#t">t</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html#obj_fp">obj_fp</a></span> <span class="id"><a href="LockAcqProof.html#sm">sm</a></span> <span class="id">sm</span>' <span class="id"><a href="LockAcqProof.html#fp">fp</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="kwd">forall</span> <span class="id">FP</span>' <span class="id">sc</span>'' <span class="id">sm</span>'', ~ <span class="id"><a href="InteractionSemantics.html#step">InteractionSemantics.step</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span> <span class="id"><a href="LockAcqProof.html#sG">sG</a></span> <span class="id"><a href="LockAcqProof.html#fl">fl</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sc</span>' <span class="id">sm</span>' <span class="id">FP</span>' <span class="id">sc</span>'' <span class="id">sm</span>'')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="InteractionSemantics.html#at_external">InteractionSemantics.at_external</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span> <span class="id"><a href="LockAcqProof.html#sG">sG</a></span> <span class="id">sc</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">ores</span>, <span class="id"><a href="InteractionSemantics.html#after_external">InteractionSemantics.after_external</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span> <span class="id">sc</span>' <span class="id"><a href="LockAcqProof.html#ores">ores</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="InteractionSemantics.html#halt">InteractionSemantics.halt</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span> <span class="id">sc</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> <span class="id">FP1</span> <span class="id">sc_ent</span> <span class="id">sm1</span> <span class="id">sc_ent</span>' <span class="id">FP2</span> <span class="id">sc_ext</span> <span class="id">sm</span>' <span class="id">sc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#star">InteractionSemantics.star</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="InteractionSemantics.html#step">InteractionSemantics.step</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span> <span class="id"><a href="LockAcqProof.html#sG">sG</a></span> <span class="id"><a href="LockAcqProof.html#fl">fl</a></span>) <span class="id"><a href="LockAcqProof.html#sc">sc</a></span> <span class="id"><a href="LockAcqProof.html#sm">sm</a></span> <span class="id">FP1</span> <span class="id">sc_ent</span> <span class="id">sm1</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#at_external">InteractionSemantics.at_external</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span> <span class="id"><a href="LockAcqProof.html#sG">sG</a></span> <span class="id">sc_ent</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="GAST.html#ent_atom">ent_atom</a></span>, <span class="id"><a href="GAST.html#ent_atom_sg">ent_atom_sg</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#after_external">InteractionSemantics.after_external</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span> <span class="id">sc_ent</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">sc_ent</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#star">InteractionSemantics.star</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="InteractionSemantics.html#step">InteractionSemantics.step</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span> <span class="id"><a href="LockAcqProof.html#sG">sG</a></span> <span class="id"><a href="LockAcqProof.html#fl">fl</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sc_ent</span>' <span class="id">sm1</span> <span class="id">FP2</span> <span class="id">sc_ext</span> <span class="id">sm</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#at_external">InteractionSemantics.at_external</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span> <span class="id"><a href="LockAcqProof.html#sG">sG</a></span> <span class="id">sc_ext</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="GAST.html#ext_atom">ext_atom</a></span>, <span class="id"><a href="GAST.html#ext_atom_sg">ext_atom_sg</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#after_external">InteractionSemantics.after_external</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span> <span class="id">sc_ext</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">sc</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InvRG.html#Gobj">Gobj</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span> <span class="id"><a href="LockAcqProof.html#t">t</a></span> <span class="id"><a href="LockAcqProof.html#sm">sm</a></span> <span class="id"><a href="LockAcqProof.html#tm">tm</a></span> <span class="id">sm</span>' <span class="id">tm</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InvRG.html#obj_match_state">obj_match_state</a></span> <span class="id"><a href="LockAcqProof.html#sge">sge</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span> <span class="id"><a href="LockAcqProof.html#t">t</a></span> (<span class="id">sc</span>', <span class="id">sm</span>') (<span class="id">tc</span>', <span class="id">tm</span>') /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html#tm_alloc_not_fl">tm_alloc_not_fl</a></span> <span class="id">tm</span>' <span class="id"><a href="LockAcqProof.html#fl">fl</a></span> <span class="id"><a href="LockAcqProof.html#t">t</a></span> /\ <span class="id"><a href="RGRels.html#rel_tm_gm_vb">rel_tm_gm_vb</a></span> <span class="id">sm</span>' <span class="id">tm</span>' <span class="id"><a href="LockAcqProof.html#fl">fl</a></span> <span class="id"><a href="LockAcqProof.html#t">t</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html#obj_fp">obj_fp</a></span> <span class="id"><a href="LockAcqProof.html#sm">sm</a></span> <span class="id">sm</span>' <span class="id"><a href="LockAcqProof.html#fp">fp</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">FP</span>' <span class="id">sc</span>' <span class="id">sm</span>'',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="InteractionSemantics.html#step">InteractionSemantics.step</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="LockAcqProof.html#sG">sG</a></span> <span class="id"><a href="LockAcqProof.html#fl">fl</a></span> <span class="id">sc_ext</span> <span class="id">sm</span>' <span class="id">FP</span>' <span class="id">sc</span>' <span class="id">sm</span>'')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="InteractionSemantics.html#at_external">InteractionSemantics.at_external</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span> <span class="id"><a href="LockAcqProof.html#sG">sG</a></span> <span class="id">sc_ext</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">ores</span>, <span class="id"><a href="InteractionSemantics.html#after_external">InteractionSemantics.after_external</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span> <span class="id">sc_ext</span> <span class="id"><a href="LockAcqProof.html#ores">ores</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="InteractionSemantics.html#halt">InteractionSemantics.halt</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span> <span class="id">sc_ext</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9944')">Proof.</div>
<div class="proofscript" id="proof9944">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Ltac</span> <span class="id">solve_mem_strip</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_eq">tupdate_same_eq</a></span>; <span class="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="FMemory.html#embed">embed</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> ?<span class="id">tm</span>) <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="id">inv</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">_</span> = <span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>. <br/>
<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hlock_acq_match_state</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : init step </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="LockAcqProof.html#lock_init_step_satify_Gobj">lock_init_step_satify_Gobj</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : lock label </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 <span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#star_refl">InteractionSemantics.star_refl</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htsostep</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="id">ptr_elim</span>]; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ptr_elim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
<br/>
&nbsp;G&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#Gobj">Gobj</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>. <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOMemLemmas.html#tm_unchange">tm_unchange</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#Id">Id</a></span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;match_state&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOMemLemmas.html#tm_unchange">tm_unchange</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InvRG.html#obj_lock_match">obj_lock_match</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InvRG.html#mov_Laddr_match">mov_Laddr_match</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Asm.html#nextinstr">nextinstr</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">rs</span> <span class="id">_</span> = <span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="id">solve_mem_strip</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="RGRels.html#obj_emp_fp">obj_emp_fp</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">external_call_elim</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{ <br/>
<div class="doc">lock acquire : movl $L RCX </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 <span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#star_refl">InteractionSemantics.star_refl</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htsostep</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="id">ptr_elim</span>]; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ptr_elim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">HL</span> : <span class="id"><a href="MemLemmas.html#get_lock_ident_from_ge">get_lock_ident_from_ge</a></span> <span class="id">___</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">HL</span> <span class="kwd">as</span> [<span class="id">L</span> <span class="id">HL</span>].<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>; <span class="tactic">split</span>.<br/>
<br/>
&nbsp;G&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#Gobj">Gobj</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>. <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOMemLemmas.html#tm_unchange">tm_unchange</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#Id">Id</a></span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;match&nbsp;state&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InvRG.html#obj_lock_match">obj_lock_match</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InvRG.html#set_lock_val">set_lock_val</a></span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Globalenvs.html#Genv.symbol_address">Genv.symbol_address</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">HL</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">elim_next_intr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Globalenvs.html#Genv.symbol_address">Genv.symbol_address</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">HL</span>.    <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Asm.html#nextinstr_nf">nextinstr_nf</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Asm.html#nextinstr">nextinstr</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 6 (<span class="tactic">rewrite</span> <span class="id"><a href="Asm.html#Pregmap.gso">Pregmap.gso</a></span>; <span class="tactic">try</span> (<span class="tactic">intro</span>; <span class="id">tryfalse</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Asm.html#Pregmap.gss">Pregmap.gss</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="tactic">rename</span> <span class="id">H</span> <span class="id">into</span> <span class="id">Hembed</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_m_unchange_objinv</span> <span class="id">tm</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">_</span> = <span class="id">_</span>, <span class="id">H2</span> : <span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span> <span class="id">H2</span>; <span class="id">simpls</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_eq">tupdate_same_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="FMemory.html#embed">embed</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> ?<span class="id">tm</span>) <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="id">inv</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">_</span> = <span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="RGRels.html#obj_emp_fp">obj_emp_fp</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">external_call_elim</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : movl $0, RDX </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 <span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#star_refl">InteractionSemantics.star_refl</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htsostep</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="id">ptr_elim</span>]; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ptr_elim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>; <span class="tactic">split</span>.<br/>
<br/>
&nbsp;G&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#Gobj">Gobj</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>. <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOMemLemmas.html#tm_unchange">tm_unchange</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#Id">Id</a></span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;match&nbsp;state&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InvRG.html#obj_lock_match">obj_lock_match</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InvRG.html#lock_acquire_label">lock_acquire_label</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">elim_next_intr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Htsostep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="tactic">rename</span> <span class="id">H</span> <span class="id">into</span> <span class="id">Hembed</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_m_unchange_objinv</span> <span class="id">tm</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">_</span> = <span class="id">_</span>, <span class="id">H2</span> : <span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span> <span class="id">H2</span>; <span class="id">simpls</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="id">solve_mem_strip</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="RGRels.html#obj_emp_fp">obj_emp_fp</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">external_call_elim</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : lock acquire label </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 <span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#star_refl">InteractionSemantics.star_refl</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htsostep</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="id">ptr_elim</span>]; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ptr_elim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>; <span class="tactic">split</span>.<br/>
<br/>
&nbsp;G&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#Gobj">Gobj</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>. <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOMemLemmas.html#tm_unchange">tm_unchange</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#Id">Id</a></span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;match&nbsp;state&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InvRG.html#obj_lock_match">obj_lock_match</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InvRG.html#get_cmp_val">get_cmp_val</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">elim_next_intr</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Htsostep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="tactic">rename</span> <span class="id">H</span> <span class="id">into</span> <span class="id">Hembed</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_m_unchange_objinv</span> <span class="id">tm</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">_</span> = <span class="id">_</span>, <span class="id">H2</span> : <span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span> <span class="id">H2</span>; <span class="id">simpls</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="id">solve_mem_strip</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="RGRels.html#obj_emp_fp">obj_emp_fp</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">external_call_elim</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : movl $1, %eax </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 <span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#star_refl">InteractionSemantics.star_refl</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htsostep</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="id">ptr_elim</span>]; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ptr_elim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exec_instr_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>; <span class="tactic">split</span>.<br/>
<br/>
&nbsp;G&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#Gobj">Gobj</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>. <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOMemLemmas.html#tm_unchange">tm_unchange</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#Id">Id</a></span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;match&nbsp;state&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InvRG.html#obj_lock_match">obj_lock_match</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InvRG.html#lock_cmpxchg_match">lock_cmpxchg_match</a></span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">elim_next_intr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Htsostep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="tactic">rename</span> <span class="id">H</span> <span class="id">into</span> <span class="id">Hembed</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_m_unchange_objinv</span> <span class="id">tm</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">_</span> = <span class="id">_</span>, <span class="id">H2</span> : <span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span> <span class="id">H2</span>; <span class="id">simpls</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="id">solve_mem_strip</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="RGRels.html#obj_emp_fp">obj_emp_fp</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">external_call_elim</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{ <br/>
<div class="doc">lock acquire : lock cmpxchg <span class="bracket"><span class="id">RCX</span></span> RDX </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hunbuffer_safe</span> : <span class="id"><a href="LockAcqProof.html#lock_acq_unbuffer_safe">lock_acq_unbuffer_safe</a></span> <span class="id">___</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htsostep</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H1</span> : <span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H1</span> <span class="id">to</span> <span class="id">Hobj_inv</span>, <span class="id">H2</span> <span class="id">to</span> <span class="id">Hembed</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">try</span> <span class="id">ptr_elim</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2 : <span class="id">external_call_elim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="AsmTSO.html#exec_instr_TSO">exec_instr_TSO</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">H</span> <span class="id">into</span> <span class="id">Hexe_instr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexe_instr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span> <span class="id">t</span>) <span class="id">eqn</span>:<span class="id">Hbf</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="FMemory.html#Mem.loadv">Mem.loadv</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id">fm</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="ASM_local.html#eval_addrmode">eval_addrmode</a></span> <span class="id">tge</span> (<span class="id"><a href="Asm.html#Addrmode">Addrmode</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="Asm.html#RCX">RCX</a></span>) <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inl">inl</a></span> 0%<span class="id">Z</span>)) <span class="id">rs</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eqn</span>:<span class="id">Hload_L_val</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H1</span> : @<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id"><a href="Values.html#val">val</a></span> (<span class="id">rs</span> (<span class="id"><a href="Asm.html#IR">IR</a></span> <span class="id"><a href="Asm.html#RAX">RAX</a></span>)) <span class="id"><a href="Values.html#Vone">Vone</a></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id">context</span> [<span class="id">rs</span> (<span class="id"><a href="Asm.html#IR">IR</a></span> <span class="id"><a href="Asm.html#RAX">RAX</a></span>)] |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="id">renames</span> <span class="id">H1</span> <span class="id">to</span> <span class="id">Hvrax</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Values.html#Val.cmpu_bool">Val.cmpu_bool</a></span> (<span class="id"><a href="FMemory.html#Mem.valid_pointer">Mem.valid_pointer</a></span> <span class="id">fm</span>) <span class="id"><a href="Integers.html#Ceq">Ceq</a></span> <span class="id">v</span> <span class="id"><a href="Values.html#Vone">Vone</a></span>) <span class="id">eqn</span>:<span class="id">Hcmp</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">b</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id"><a href="MemLemmas.html#ogenv_match_L_addr_eq">ogenv_match_L_addr_eq</a></span> <span class="id">___</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ht</span> <span class="kwd">as</span> [<span class="id">L</span>' [<span class="id">Htge_L</span> <span class="id">Hsge_L</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H1</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">L</span> = <span class="id"><a href="Globalenvs.html#Genv.find_symbol">Genv.find_symbol</a></span> <span class="id">_</span> <span class="id"><a href="code.html#lock_L_ident">lock_L_ident</a></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id"><a href="Globalenvs.html#Genv.find_symbol">Genv.find_symbol</a></span> <span class="id">_</span> <span class="id"><a href="code.html#lock_L_ident">lock_L_ident</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">inversion</span> <span class="id">H1</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hsge_eq</span> : <span class="id">sge</span> = <span class="id">sG</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hspec_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hspec_init</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
<div class="doc">lock succ </div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">rs</span> (<span class="id"><a href="Asm.html#IR">IR</a></span> <span class="id"><a href="Asm.html#RDX">RDX</a></span>) = <span class="id"><a href="Values.html#Vzero">Vzero</a></span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Hexe_instr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="FMemory.html#Mem.storev">Mem.storev</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id">fm</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="ASM_local.html#eval_addrmode">eval_addrmode</a></span> <span class="id">tge</span> (<span class="id"><a href="Asm.html#Addrmode">Addrmode</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="Asm.html#RCX">RCX</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inl">inl</a></span> 0%<span class="id">Z</span>)) <span class="id">rs</span>) <span class="id"><a href="Values.html#Vzero">Vzero</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eqn</span> : <span class="id">Hlock_succ</span>; <span class="id">tryfalse</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hexe_instr</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Htsostep</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">rs</span> (<span class="id"><a href="Asm.html#IR">IR</a></span> <span class="id"><a href="Asm.html#RCX">RCX</a></span>) = <span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">H</span> <span class="id">into</span> <span class="id">H_L_addr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_L_var</span> : <span class="id">v</span> = <span class="id"><a href="Values.html#Vone">Vone</a></span> /\ <span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id">sm</span> <span class="id">L</span> 0 = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="Integers.html#Int.one">Int.one</a></span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">sm</span>', <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id">sm</span> <span class="id">L</span> 0 (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="Integers.html#Int.zero">Int.zero</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">sm</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{    <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hload_L_val</span> <span class="id">Hcmp</span> <span class="id">H_L_addr</span> <span class="id">Hobj_inv</span> <span class="id">Htge_L</span> <span class="id">Hbf</span> <span class="id">Hembed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Val.cmpu_bool</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hcmp</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id"><a href="Integers.html#Int.eq_spec">Int.eq_spec</a></span> <span class="id">___</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="Integers.html#Int.eq">Int.eq</a></span> <span class="id">i</span> <span class="id"><a href="Integers.html#Int.one">Int.one</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Ht</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="ASM_local.html#eval_addrmode">eval_addrmode</a></span> <span class="kwd">in</span> <span class="id">Hload_L_val</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Archi.html#ptr64">Archi.ptr64</a></span> <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span> <span class="id">eval_addrmode32</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Integers.html#Int.add_zero">Int.add_zero</a></span> <span class="kwd">in</span> <span class="id">Hload_L_val</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_L_addr</span> <span class="kwd">in</span> <span class="id">Hload_L_val</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqb</span> <span class="kwd">in</span> <span class="id">Hload_L_val</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Integers.html#Ptrofs.add_zero">Ptrofs.add_zero</a></span> <span class="kwd">in</span> <span class="id">Hload_L_val</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Ht</span> : <span class="id"><a href="Integers.html#Ptrofs.unsigned">Ptrofs.unsigned</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0) = 0%<span class="id">Z</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ht</span> <span class="kwd">in</span> <span class="id">Hload_L_val</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">obj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hobj_inv</span> <span class="kwd">as</span> [<span class="id">L</span>' [<span class="id">H_L_ge</span> <span class="id">H_L_state</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Htge_L</span> <span class="kwd">in</span> <span class="id">H_L_ge</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">H_L_ge</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H_L_ge</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_L_state</span> <span class="kwd">as</span> [<span class="id">H_L_state</span> <span class="id">H_store_ok</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">H_store_ok</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_L_state</span> <span class="kwd">as</span> [<span class="id">H_L_state</span> | <span class="id">H_L_state</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">lock_st</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">H_L_state</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#load_fm_eq_load_gm">load_fm_eq_load_gm</a></span> <span class="kwd">in</span> <span class="id">Hload_L_val</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="TSOMem.html#load_tsomem">load_tsomem</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">H</span> <span class="id">into</span> <span class="id">Hload_tsom</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">load_tsomem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hload_tsom</span> <span class="kwd">in</span> <span class="id">Hload_L_val</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">unlock_st</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">H_L_state</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_L_var</span> <span class="kwd">as</span> [<span class="id">H_L_var</span> [<span class="id">Hload_L_sm</span> <span class="id">Hstore_L</span>'<span class="id">_sm</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">v</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hstore_L</span>'<span class="id">_sm</span> <span class="kwd">as</span> [<span class="id">sm</span>' <span class="id">Hstore_L</span>'<span class="id">_sm</span>].<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hspec_embed</span> : (<span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">Classical_Prop.classic</a></span> (<span class="id">exists</span> <span class="id">fsm</span>, <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">sm</span> <span class="id">fl</span> <span class="id">fsm</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hspec_embed</span> <span class="kwd">as</span> [<span class="id">Hspec_embed_ex</span> | <span class="id">Hspec_embed_nex</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hspec_embed_ex</span> <span class="kwd">as</span> [<span class="id">fsm</span> <span class="id">Hspec_embed_ex</span>].<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hspec_m_store</span> : <span class="id">exists</span> <span class="id">fsm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="SpecLang.html#storemax">SpecLang.storemax</a></span> <span class="id">fsm</span> <span class="id">L</span> (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="Integers.html#Int.zero">Int.zero</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">fsm</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">sm</span>' <span class="id">fl</span> <span class="id">fsm</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#store_gm_store_spec_m">store_gm_store_spec_m</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hspec_m_store</span> <span class="kwd">as</span> [<span class="id">fsm</span>' [<span class="id">Hspec_m_store</span> <span class="id">Hembed1</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 8 <span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;spec&nbsp;program&nbsp;executes&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#lock_spec_fn">lock_spec_fn</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec_p_exec</span>.<br/>
&nbsp;<br/>
&nbsp;seq&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec_p_exec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hspec_embed_ex</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;assign&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec_p_exec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hspec_embed_ex</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(1 := (<span class="kwd">fun</span> <span class="id">r</span>' : <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span> =&gt; <span class="kwd">if</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">r</span>' <span class="id"><a href="code.html#r">r</a></span> <span class="kwd">then</span> <span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="Integers.html#Int.zero">Int.zero</a></span> <span class="kwd">else</span> <span class="id">te</span> <span class="id">r</span>')).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;<br/>
&nbsp;skip&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec_p_exec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hspec_embed_ex</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;seq&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec_p_exec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hspec_embed_ex</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;assign&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec_p_exec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hspec_embed_ex</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(1 := (<span class="kwd">fun</span> <span class="id">r</span>' : <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">r</span>' <span class="id"><a href="code.html#x">x</a></span> <span class="kwd">then</span> <span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="Integers.html#Int.zero">Int.zero</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="kwd">if</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">r</span>' <span class="id"><a href="code.html#r">r</a></span> <span class="kwd">then</span> <span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="Integers.html#Int.zero">Int.zero</a></span> <span class="kwd">else</span> <span class="id">te</span> <span class="id">r</span>')).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;skip&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec_p_exec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hspec_embed_ex</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;sseq&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec_p_exec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hspec_embed_ex</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;while&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec_p_exec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hspec_embed_ex</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="SpecLang.html#Eval_btrue">SpecLang.Eval_btrue</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id"><a href="code.html#r">r</a></span> <span class="id"><a href="code.html#x">x</a></span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id"><a href="code.html#r">r</a></span> <span class="id"><a href="code.html#r">r</a></span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;atom&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#star_step">InteractionSemantics.star_step</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hspec_embed_ex</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="SpecLang.html#EntAtomstep">SpecLang.EntAtomstep</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#star_refl">InteractionSemantics.star_refl</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<br/>
&nbsp;AtEntAtom&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;AfterEntAtom&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;<br/>
&nbsp;exec&nbsp;atom&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;seq&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec_p_exec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hspec_embed_ex</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;load&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec_p_exec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hspec_embed_ex</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id"><a href="Values.html#Vone">Vone</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#load_gm_load_spec_m">load_gm_load_spec_m</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1 :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">r</span>' : <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">r</span>' <span class="id"><a href="code.html#r">r</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id"><a href="Values.html#Vone">Vone</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">r</span>' <span class="id"><a href="code.html#x">x</a></span> <span class="kwd">then</span> <span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="Integers.html#Int.zero">Int.zero</a></span> <span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">r</span>' <span class="id"><a href="code.html#r">r</a></span> <span class="kwd">then</span> <span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="Integers.html#Int.zero">Int.zero</a></span> <span class="kwd">else</span> <span class="id">te</span> <span class="id">r</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>. <br/>
&nbsp;skip&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec_p_exec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hspec_embed_ex</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;store&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec_p_exec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hspec_embed_ex</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#star_step">InteractionSemantics.star_step</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id">fsm</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed1</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="SpecLang.html#ExtAtomstep">SpecLang.ExtAtomstep</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;AtExtatom&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">eval_addrmode</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Archi.html#ptr64">Archi.ptr64</a></span> <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hload_L_val</span>, <span class="id">Hlock_succ</span>.  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Integers.html#Int.add_zero">Int.add_zero</a></span> <span class="kwd">in</span> <span class="id">Hload_L_val</span>, <span class="id">Hlock_succ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_L_addr</span> <span class="kwd">in</span> <span class="id">Hload_L_val</span>, <span class="id">Hlock_succ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hload_L_val</span>, <span class="id">Hlock_succ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqb</span> <span class="kwd">in</span> <span class="id">Hload_L_val</span>, <span class="id">Hlock_succ</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#load_fm_eq_load_gm">load_fm_eq_load_gm</a></span> <span class="kwd">in</span> <span class="id">Hload_L_val</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#store_fm_eq_store_gm">store_fm_eq_store_gm</a></span> <span class="kwd">in</span> <span class="id">Hlock_succ</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Ht</span> : <span class="id"><a href="Integers.html#Ptrofs.unsigned">Ptrofs.unsigned</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Integers.html#Ptrofs.add">Ptrofs.add</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0) (<span class="id"><a href="Integers.html#Ptrofs.of_int">Ptrofs.of_int</a></span> <span class="id"><a href="Integers.html#Int.zero">Int.zero</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= 0%<span class="id">Z</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ht</span> <span class="kwd">in</span> <span class="id">Hload_L_val</span>, <span class="id">Hlock_succ</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hobj_inv</span>' : <span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span> <span class="id">tge</span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fsm</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id">t</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">memory</span> := <span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">m</span> |}).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hbf</span> <span class="id">Hobj_inv</span> <span class="id">Hstore_L</span>'<span class="id">_sm</span>  <span class="id">Hspec_embed_ex</span> <span class="id">Hsge_L</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hspec_m_store</span> <span class="id">Hembed1</span> <span class="id">Htge_L</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hload_L_val</span> <span class="id">H_L_addr</span> <span class="id">Hembed</span> <span class="id">Hlock_succ</span> <span class="id">Hunbuffer_safe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed1</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#buffer_unchange1">buffer_unchange1</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#lock_st">lock_st</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#gm_store_v_load_same">gm_store_v_load_same</a></span> <span class="kwd">in</span> <span class="id">Hstore_L</span>'<span class="id">_sm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">obj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">introv</span> <span class="id">H_buf_clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H1</span> : <span class="id"><a href="Globalenvs.html#Genv.find_symbol">Genv.find_symbol</a></span> <span class="id">tge</span> <span class="id"><a href="code.html#lock_L_ident">lock_L_ident</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">H</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Htge_L</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">inversion</span> <span class="id">H1</span>; <span class="tactic">subst</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="InvRG.html#lock_st">lock_st</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> \/ <span class="id"><a href="InvRG.html#unlock_st">unlock_st</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">H</span> <span class="id">into</span> <span class="id">Hst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hst</span> <span class="kwd">as</span> [<span class="id">Hlock_st</span> | <span class="id">Hunlock_st</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">lock_st</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">Hlock_st</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="TSOMem.html#load_tsomem">load_tsomem</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">H</span> <span class="id">into</span> <span class="id">Hload_tsomem</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#load_tsomem">load_tsomem</a></span> <span class="kwd">in</span> <span class="id">Hload_tsomem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hload_tsomem</span> <span class="kwd">in</span> <span class="id">Hload_L_val</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">unlock_st</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">Hunlock_st</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">_</span> \/ <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="tactic">rename</span> <span class="id">H</span> <span class="id">into</span> <span class="id">Hunlock_st</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hunlock_st</span> <span class="kwd">as</span> [<span class="id">Hunlock_st1</span> | <span class="id">Hunlock_st2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">Hunlock_st1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="TSOMem.html#load_tsomem">load_tsomem</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#load_tsomem">load_tsomem</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">destruct</span> <span class="id">tm</span>; <span class="id">simpls</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">H</span> <span class="id">into</span> <span class="id">Hload_tsomem</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hload_tsomem</span> <span class="kwd">in</span> <span class="id">Hload_L_val</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hunlock_st2</span> <span class="kwd">as</span> [<span class="id">Hload_tsomem</span> <span class="id">HL_not_bf</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_buf_clear</span> <span class="kwd">as</span> [<span class="id">ofs</span> <span class="id">H_buf_clear</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">HL_not_bf</span> <span class="id">t0</span> <span class="id">ofs</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hembed</span> <span class="id">Hlock_succ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#gm_store_v_load_same">gm_store_v_load_same</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hstore_L</span>'<span class="id">_sm</span> <span class="id">Hembed1</span> <span class="id">Hlock_succ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed1</span>; <span class="tactic">subst</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#gm_store_succ_store_again">gm_store_succ_store_again</a></span> <span class="kwd">in</span> <span class="id">Hstore_L</span>'<span class="id">_sm</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hlock_succ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#gm_store_succ_store_again">gm_store_succ_store_again</a></span> <span class="kwd">in</span> <span class="id">Hlock_succ</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hlock_succ</span> <span class="kwd">as</span> [<span class="id">sm</span>'' <span class="id">Hlock_succ</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hlock_succ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.   <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#buffer_unchange1">buffer_unchange1</a></span> <span class="kwd">in</span> <span class="id">Hunbuffer_safe</span>; <span class="tactic">eauto</span>.   <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hspec_m_store</span> <span class="id">Hobj_inv</span> <span class="id">Hspec_embed_ex</span> <span class="id">Htge_L</span> <span class="id">Hlock_succ</span> <span class="id">Hembed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#speclang_store_impl_obj_mem">speclang_store_impl_obj_mem</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hspec_embed_ex</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">obj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">Hobj_inv</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H1</span> : <span class="id"><a href="Globalenvs.html#Genv.find_symbol">Genv.find_symbol</a></span> <span class="id">_</span> <span class="id">_</span> = <span class="id">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id"><a href="Globalenvs.html#Genv.find_symbol">Genv.find_symbol</a></span> <span class="id">_</span> <span class="id">_</span> = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hobj_inv</span> <span class="id">Hlock_succ</span> <span class="id">Htge_L</span> <span class="id">Hembed</span> <span class="id">Hspec_m_store</span> <span class="id">Hspec_embed_ex</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">obj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Htge_L</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H1</span>; <span class="tactic">subst</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">introv</span> <span class="id">Hrange</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H6</span> <span class="kwd">in</span> <span class="id">Hrange</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#Mem_GMem_access_eq">Mem_GMem_access_eq</a></span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hrange</span> <span class="id">Hlock_succ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hrange</span> <span class="kwd">as</span> [<span class="id">p</span> [<span class="id">Hperm</span> <span class="id">Hperm_order</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">p</span>; <span class="tactic">split</span>; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#store_perm_nochange">store_perm_nochange</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">introv</span> <span class="id">Hrange</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H8</span> <span class="kwd">with</span> (<span class="id">k</span> := <span class="id">k</span>) (<span class="id">p</span> := <span class="id">p</span>) <span class="kwd">in</span> <span class="id">Hrange</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hspec_embed_ex</span> <span class="id">Hspec_m_store</span> <span class="id">Hrange</span> <span class="id">Hlock_succ</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hembed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hspec_embed_ex</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hrange</span> <span class="kwd">as</span> [<span class="id">Hrange</span> <span class="id">Hrange1</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">Hrange</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">GMem.perm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Memperm.perm_order</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hspec_m_store</span> <span class="id">H0</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="TSOMemLemmas.html#Mem_GMem_access_eq">Mem_GMem_access_eq</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> ((<span class="id"><a href="FMemory.html#Mem.mem_access">Mem.mem_access</a></span> <span class="id">fsm</span>') !! <span class="id">L</span> <span class="id">ofs</span> <span class="id">k</span>) <span class="id">eqn</span>:?; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#speclang_not_change_perm">speclang_not_change_perm</a></span> <span class="kwd">in</span> <span class="id">Hspec_m_store</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hspec_m_store</span> <span class="kwd">in</span> <span class="id">Heqo</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqo</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">Hrange1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">GMem.perm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hembed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="FMemLemmas.html">FMemLemmas</a></span>.<br/>
<span class="id">ex_match2</span>.<br/>
<span class="tactic">destruct</span> <span class="id">m</span>; <span class="id">unfolds</span> <span class="id">strip</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hlock_succ</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H2</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;G&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#Gobj">Gobj</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#G_lock">G_lock</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hobj_inv</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#lock_succ">lock_succ</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hembed</span> <span class="id">Hload_L_val</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#buffer_unchange1">buffer_unchange1</a></span>; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hlock_succ</span> <span class="id">Hembed</span> <span class="id">Hbf</span> <span class="id">Hspec_m_store</span> <span class="id">Hspec_embed_ex</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Values.html#Vzero">Vzero</a></span> <span class="kwd">in</span> <span class="id">Hlock_succ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hlock_succ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hspec_embed_ex</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#SpecLang_store_store_gm">SpecLang_store_store_gm</a></span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;match&nbsp;state&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">eapply</span> <span class="id"><a href="InvRG.html#obj_lock_match">obj_lock_match</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InvRG.html#jne_enter_ZF_1_match">jne_enter_ZF_1_match</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">elim_next_intr</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id"><a href="code.html#r">r</a></span> <span class="id"><a href="code.html#r">r</a></span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hembed1</span>. <span class="id">inv</span> <span class="id">Hspec_embed_ex</span>. <span class="id">inv</span> <span class="id">Hembed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_eq">tupdate_same_eq</a></span>; <span class="tactic">eauto</span>.  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hno_conflict</span> <span class="id">Hrel_tm_gm_vb</span> <span class="id">Hstore_L</span>'<span class="id">_sm</span> <span class="id">Hlock_succ</span> <span class="id">Hbf</span> <span class="id">H1</span> <span class="id">Hcmp</span> <span class="id">Hload_L_val</span> <span class="id">H_L_addr</span> <span class="id">Hvrax</span> <span class="id">Hobj_inv</span> <span class="id">Hsge_L</span> <span class="id">Htge_L</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">rel_tm_gm_vb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">introv</span> <span class="id">Hget_block</span> <span class="id">Happly_buffer</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">Hbf</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hrel_tm_gm_vb</span> <span class="kwd">in</span> <span class="id">Hget_block</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 : <span class="id">instantiate</span> (1 := <span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">tm</span>); <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Happly_buffer</span>; <span class="id">inv</span> <span class="id">Happly_buffer</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#store_vb_eq">store_vb_eq</a></span> <span class="kwd">in</span> <span class="id">Hlock_succ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#store_vb_eq">store_vb_eq</a></span> <span class="kwd">in</span> <span class="id">Hstore_L</span>'<span class="id">_sm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#mem_strip_gm_vb_eq">mem_strip_gm_vb_eq</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span> <span class="id">Hvb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hlock_succ</span> <span class="kwd">in</span> <span class="id">Hvb</span>; <span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">Hvb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hget_block</span> <span class="kwd">in</span> <span class="id">Hvb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hstore_L</span>'<span class="id">_sm</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hlock_succ</span>; <span class="tactic">rewrite</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hget_block</span>; <span class="tactic">rewrite</span> <span class="id">Hstore_L</span>'<span class="id">_sm</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="RGRels.html#obj_valid_block_fp">obj_valid_block_fp</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.loadv</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_L_addr</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Archi.html#ptr64">Archi.ptr64</a></span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="Integers.html#Ptrofs.unsigned">Ptrofs.unsigned</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Integers.html#Ptrofs.add">Ptrofs.add</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Integers.html#Ptrofs.of_int">Ptrofs.of_int</a></span> (<span class="id"><a href="Integers.html#Int.add">Int.add</a></span> <span class="id"><a href="Integers.html#Int.zero">Int.zero</a></span> (<span class="id"><a href="Integers.html#Int.repr">Int.repr</a></span> 0))))) <span class="kwd">with</span> 0%<span class="id">Z</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">obj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hobj_inv</span> <span class="kwd">as</span> (<span class="id">L</span>' &amp; <span class="id">Htge_L</span>' &amp; <span class="id">Hobj_inv</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Htge_L</span> <span class="kwd">in</span> <span class="id">Htge_L</span>'; <span class="id">inv</span> <span class="id">Htge_L</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#load_gm_embed_load_fm">load_gm_embed_load_fm</a></span> <span class="kwd">in</span> <span class="id">Hload_L_val</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hload_L_val</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hvrax</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="Integers.html#Ptrofs.unsigned">Ptrofs.unsigned</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Integers.html#Ptrofs.add">Ptrofs.add</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Integers.html#Ptrofs.of_int">Ptrofs.of_int</a></span> (<span class="id"><a href="Integers.html#Int.add">Int.add</a></span> <span class="id"><a href="Integers.html#Int.zero">Int.zero</a></span> (<span class="id"><a href="Integers.html#Int.repr">Int.repr</a></span> 0))))) <span class="kwd">with</span> 0%<span class="id">Z</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#load_fp">load_fp</a></span>, <span class="id"><a href="FMemOpFP.html#store_fp">store_fp</a></span>, <span class="id"><a href="Footprint.html#FP.locs">FP.locs</a></span>, <span class="id"><a href="Footprint.html#FP.union">FP.union</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Footprint.html#Locs.belongsto">Locs.belongsto</a></span>, <span class="id"><a href="Footprint.html#Locs.union">Locs.union</a></span>, <span class="id"><a href="FMemOpFP.html#range_locset">range_locset</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="id">tryfalse</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zle">zle</a></span> 0 <span class="id">ofs</span>) <span class="id">eqn</span>:?; <span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zlt">zlt</a></span> <span class="id">ofs</span> 4) <span class="id">eqn</span>:?;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H4</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span>; <span class="tactic">clear</span> - <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 <span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#star_refl">InteractionSemantics.star_refl</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hspec_embed_nex</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">introv</span> <span class="id">Hsem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hsem</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hspec_embed_nex</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <br/>
<div class="doc">lock fail </div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hexe_instr</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 <span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#star_refl">InteractionSemantics.star_refl</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#buffer_unchange1">buffer_unchange1</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>; <span class="tactic">split</span>.<br/>
<br/>
&nbsp;G&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#Gobj">Gobj</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="id">right</span>; <span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hembed</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#Id">Id</a></span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;match&nbsp;state&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InvRG.html#obj_lock_match">obj_lock_match</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InvRG.html#jne_enter_ZF_0_match">jne_enter_ZF_0_match</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Asm.html#nextinstr">nextinstr</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Asm.html#Pregmap.gss">Pregmap.gss</a></span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">intro</span>; <span class="id">tryfalse</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 (<span class="tactic">rewrite</span> <span class="id"><a href="Asm.html#Pregmap.gso">Pregmap.gso</a></span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">intro</span>; <span class="id">tryfalse</span>]).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">rs</span> <span class="id"><a href="Asm.html#PC">PC</a></span> = <span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">unfold</span> <span class="id"><a href="Values.html#Val.offset_ptr">Val.offset_ptr</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_m_unchange_objinv</span> <span class="id">tm</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hembed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">_</span> = <span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="tactic">rewrite</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hload_L_val</span>, <span class="id">Hvrax</span>, <span class="id">Hcmp</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#loadv_fp">loadv_fp</a></span>, <span class="id"><a href="ASM_local.html#eval_addrmode">eval_addrmode</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Archi.html#ptr64">Archi.ptr64</a></span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="Integers.html#Int.add">Int.add</a></span> <span class="id"><a href="Integers.html#Int.zero">Int.zero</a></span> (<span class="id"><a href="Integers.html#Int.repr">Int.repr</a></span> 0)) <span class="kwd">with</span> <span class="id"><a href="Integers.html#Int.zero">Int.zero</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H7</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Archi.html#ptr64">Archi.ptr64</a></span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="Integers.html#Ptrofs.unsigned">Ptrofs.unsigned</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Integers.html#Ptrofs.add">Ptrofs.add</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0) (<span class="id"><a href="Integers.html#Ptrofs.of_int">Ptrofs.of_int</a></span> <span class="id"><a href="Integers.html#Int.zero">Int.zero</a></span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> 0%<span class="id">Z</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#Mem.loadv">Mem.loadv</a></span>, <span class="id"><a href="ASM_local.html#eval_addrmode">eval_addrmode</a></span> <span class="kwd">in</span> <span class="id">Hload_L_val</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="RGRels.html#obj_valid_block_fp">obj_valid_block_fp</a></span>; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#load_fm_eq_load_gm">load_fm_eq_load_gm</a></span> <span class="kwd">in</span> <span class="id">Hload_L_val</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">Hload_L_val</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="ASM_local.html#eval_addrmode32">eval_addrmode32</a></span> <span class="kwd">in</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H7</span> <span class="kwd">in</span> <span class="id">Hx</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="Integers.html#Ptrofs.add">Ptrofs.add</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Integers.html#Ptrofs.of_int">Ptrofs.of_int</a></span> (<span class="id"><a href="Integers.html#Int.add">Int.add</a></span> <span class="id"><a href="Integers.html#Int.zero">Int.zero</a></span> (<span class="id"><a href="Integers.html#Int.repr">Int.repr</a></span> 0)))) <span class="kwd">with</span> <span class="id"><a href="Integers.html#Ptrofs.zero">Ptrofs.zero</a></span> <span class="kwd">in</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hx</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="Integers.html#Ptrofs.unsigned">Ptrofs.unsigned</a></span> <span class="id"><a href="Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) <span class="kwd">with</span> 0%<span class="id">Z</span> <span class="kwd">in</span> <span class="id">Hload_L_val</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="MemLemmas.html#obj_inv_impl_load_zero_or_one">obj_inv_impl_load_zero_or_one</a></span> <span class="kwd">in</span> <span class="id">Hload_L_val</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hload_L_val</span> <span class="kwd">as</span> [<span class="id">Hv_one</span> | <span class="id">Hv_zero</span>]; <span class="tactic">subst</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hcmp</span>; <span class="id">inv</span> <span class="id">Hcmp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Locs.belongsto</span>, <span class="id">FP.locs</span>, <span class="id">FP.union</span>, <span class="id">load_fp</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Locs.union</span>, <span class="id">range_locset</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zle">zle</a></span> 0 <span class="id">ofs</span>) <span class="id">eqn</span>:?; <span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zlt">zlt</a></span> <span class="id">ofs</span> 4) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hobj_inv</span> <span class="id">H10</span> <span class="id">l</span> <span class="id">l0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">obj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hobj_inv</span> <span class="kwd">as</span> [<span class="id">L</span> <span class="id">Hobj_inv</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H10</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : je enter <span class="bracket"><span class="id">ZF</span> = 1</span> </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htsostep</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H1</span> : <span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H1</span> <span class="id">to</span> <span class="id">Hobj_inv</span>, <span class="id">H2</span> <span class="id">to</span> <span class="id">Hembed</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">try</span> <span class="id">ptr_elim</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2 : <span class="id">external_call_elim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="AsmTSO.html#exec_instr_TSO">exec_instr_TSO</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">H</span> <span class="id">into</span> <span class="id">Hexe_instr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexe_instr</span>. <br/>
&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H1</span> : <span class="id">rs</span> (<span class="id"><a href="Asm.html#CR">CR</a></span> <span class="id"><a href="Asm.html#ZF">ZF</a></span>) = <span class="id">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id">rs</span> <span class="id"><a href="Asm.html#PC">PC</a></span> = <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="id">renames</span> <span class="id">H1</span> <span class="id">to</span> <span class="id">Hzf</span>, <span class="id">H2</span> <span class="id">to</span> <span class="id">Hpc</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hzf</span> <span class="kwd">in</span> <span class="id">Hexe_instr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Integers.html#Int.eq_true">Int.eq_true</a></span> <span class="kwd">in</span> <span class="id">Hexe_instr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#tso_goto_label">tso_goto_label</a></span> <span class="kwd">in</span> <span class="id">Hexe_instr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexe_instr</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">find_label</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id"><a href="code.html#enter_lbl">enter_lbl</a></span> <span class="id"><a href="code.html#lock_lbl">lock_lbl</a></span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id"><a href="code.html#enter_lbl">enter_lbl</a></span> <span class="id"><a href="code.html#lock_acquire_lbl">lock_acquire_lbl</a></span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id"><a href="code.html#enter_lbl">enter_lbl</a></span> <span class="id"><a href="code.html#spin_lbl">spin_lbl</a></span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hpc</span> <span class="kwd">in</span> <span class="id">Hexe_instr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hexe_instr</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <br/>
&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 <span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#star_refl">InteractionSemantics.star_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#buffer_unchange">buffer_unchange</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>; <span class="tactic">split</span>.<br/>
&nbsp;G&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#Gobj">Gobj</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hembed</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#Id">Id</a></span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;match&nbsp;state&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InvRG.html#obj_lock_match">obj_lock_match</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InvRG.html#set_ret_val">set_ret_val</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Pregmap_elim</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_m_unchange_objinv</span> <span class="id">tm</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="id">solve_mem_strip</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="RGRels.html#obj_emp_fp">obj_emp_fp</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : je enter <span class="bracket"><span class="id">ZF</span> = 0</span> </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htsostep</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H1</span> : <span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H1</span> <span class="id">to</span> <span class="id">Hobj_inv</span>, <span class="id">H2</span> <span class="id">to</span> <span class="id">Hembed</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">try</span> <span class="id">ptr_elim</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2 : <span class="id">external_call_elim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="AsmTSO.html#exec_instr_TSO">exec_instr_TSO</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">H</span> <span class="id">into</span> <span class="id">Hexe_instr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexe_instr</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H1</span> : <span class="id">rs</span> (<span class="id"><a href="Asm.html#CR">CR</a></span> <span class="id"><a href="Asm.html#ZF">ZF</a></span>) = <span class="id">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id">rs</span> <span class="id"><a href="Asm.html#PC">PC</a></span> = <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="id">renames</span> <span class="id">H1</span> <span class="id">to</span> <span class="id">Hzf</span>, <span class="id">H2</span> <span class="id">to</span> <span class="id">Hpc</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hzf</span> <span class="kwd">in</span> <span class="id">Hexe_instr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Ht</span> : <span class="id"><a href="Integers.html#Int.eq">Int.eq</a></span> <span class="id"><a href="Integers.html#Int.zero">Int.zero</a></span> <span class="id"><a href="Integers.html#Int.one">Int.one</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ht</span> <span class="kwd">in</span> <span class="id">Hexe_instr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hexe_instr</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 <span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#star_refl">InteractionSemantics.star_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#buffer_unchange">buffer_unchange</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>; <span class="tactic">split</span>.<br/>
&nbsp;G&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#Gobj">Gobj</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hembed</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#Id">Id</a></span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;match&nbsp;state&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InvRG.html#obj_lock_match">obj_lock_match</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InvRG.html#spin_label_match">spin_label_match</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">elim_next_intr</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_m_unchange_objinv</span> <span class="id">tm</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="id">solve_mem_strip</span>. <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="RGRels.html#obj_emp_fp">obj_emp_fp</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock_acquire : spain label </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htsostep</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H1</span> : <span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H1</span> <span class="id">to</span> <span class="id">Hobj_inv</span>, <span class="id">H2</span> <span class="id">to</span> <span class="id">Hembed</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">try</span> <span class="id">ptr_elim</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2 : <span class="id">external_call_elim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="AsmTSO.html#exec_instr_TSO">exec_instr_TSO</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">H</span> <span class="id">into</span> <span class="id">Hexe_instr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexe_instr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hexe_instr</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 <span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#star_refl">InteractionSemantics.star_refl</a></span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H1</span> : <span class="id"><a href="Globalenvs.html#Genv.find_funct_ptr">Genv.find_funct_ptr</a></span> <span class="id">_</span> <span class="id">_</span> = <span class="id">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : ?<span class="id">rs</span> <span class="id"><a href="Asm.html#PC">PC</a></span> = <span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id">_</span> <span class="id">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H3</span> : <span class="id"><a href="ASM_local.html#find_instr">find_instr</a></span> <span class="id">_</span> <span class="id">_</span> = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H1</span> <span class="id">to</span> <span class="id">Hfind_b</span>, <span class="id">H2</span> <span class="id">to</span> <span class="id">Hpc</span>, <span class="id">H3</span> <span class="id">to</span> <span class="id">Hfind_instr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Htsostep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>; <span class="tactic">split</span>.<br/>
&nbsp;G&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#Gobj">Gobj</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>. <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#buffer_unchange">buffer_unchange</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">_</span> = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#Id">Id</a></span>. <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;match_state&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">eapply</span> <span class="id"><a href="InvRG.html#obj_lock_match">obj_lock_match</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#buffer_unchange">buffer_unchange</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InvRG.html#get_lock_var">get_lock_var</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Asm.html#nextinstr">nextinstr</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Asm.html#Pregmap.gss">Pregmap.gss</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hpc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hembed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="id">solve_mem_strip</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="RGRels.html#obj_emp_fp">obj_emp_fp</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{ <br/>
<div class="doc">lock acquire : movl <span class="bracket"><span class="id">RCX</span></span> RBX  </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htsostep</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H1</span> : <span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H1</span> <span class="id">to</span> <span class="id">Hobj_inv</span>, <span class="id">H2</span> <span class="id">to</span> <span class="id">Hembed</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">try</span> <span class="id">ptr_elim</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;2 : <span class="id">external_call_elim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="AsmTSO.html#exec_instr_TSO">exec_instr_TSO</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">H</span> <span class="id">into</span> <span class="id">Hexe_instr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexe_instr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hexe_instr</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 <span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#star_refl">InteractionSemantics.star_refl</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">H0</span> <span class="id">into</span> <span class="id">Hexec_load_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#exec_load_TSO">exec_load_TSO</a></span> <span class="kwd">in</span> <span class="id">Hexec_load_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="ASM_local.html#eval_addrmode">eval_addrmode</a></span> <span class="kwd">in</span> <span class="id">Hexec_load_tso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Archi.html#ptr64">Archi.ptr64</a></span> <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="ASM_local.html#eval_addrmode32">eval_addrmode32</a></span> <span class="kwd">in</span> <span class="id">Hexec_load_tso</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tsoloadv">tsoloadv</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{| <span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span> := <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span> <span class="id">t</span>; <span class="id">fmemory</span> := <span class="id">fm</span> |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Values.html#Val.add">Val.add</a></span> (<span class="id">rs</span> <span class="id"><a href="Asm.html#RCX">RCX</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Values.html#Val.add">Val.add</a></span> (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="Integers.html#Int.zero">Int.zero</a></span>) (<span class="id"><a href="Values.html#Vint">Vint</a></span> (<span class="id"><a href="Integers.html#Int.repr">Int.repr</a></span> 0))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="id">eqn</span>:<span class="id">Htso_load</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hexec_load_tso</span>; <span class="id">tryfalse</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Htsostep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>; <span class="tactic">split</span>.<br/>
&nbsp;G&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#Gobj">Gobj</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>. <span class="id">right</span>. <span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">_</span> = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#Id">Id</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">buffer_unchange</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;match&nbsp;state&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">eapply</span> <span class="id"><a href="InvRG.html#obj_lock_match">obj_lock_match</a></span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InvRG.html#cmp_Lvar_match">cmp_Lvar_match</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">elim_next_intr</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">rs</span> (<span class="id"><a href="Asm.html#IR">IR</a></span> <span class="id"><a href="Asm.html#RCX">RCX</a></span>) = <span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id">_</span> <span class="id">_</span>, <span class="id">H2</span> : <span class="id">_</span> = <span class="id"><a href="Globalenvs.html#Genv.find_symbol">Genv.find_symbol</a></span> <span class="id">_</span> <span class="id"><a href="code.html#lock_L_ident">lock_L_ident</a></span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H</span> <span class="id">to</span> <span class="id">HR8</span>, <span class="id">H2</span> <span class="id">to</span> <span class="id">H_L_addr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hobj_inv</span> <span class="id">Hembed</span> <span class="id">HR8</span> <span class="id">H_L_addr</span> <span class="id">Htso_load</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">HR8</span> <span class="kwd">in</span> <span class="id">Htso_load</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">obj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Archi.html#ptr64">Archi.ptr64</a></span> <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Ht</span> : <span class="id"><a href="Integers.html#Ptrofs.add">Ptrofs.add</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Integers.html#Ptrofs.of_int">Ptrofs.of_int</a></span> (<span class="id"><a href="Integers.html#Int.add">Int.add</a></span> <span class="id"><a href="Integers.html#Int.zero">Int.zero</a></span> (<span class="id"><a href="Integers.html#Int.repr">Int.repr</a></span> 0))) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ht</span> <span class="kwd">in</span> <span class="id">Htso_load</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="InvRG.html#lock_st">lock_st</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> \/ <span class="id"><a href="InvRG.html#unlock_st">unlock_st</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">Hst</span> | <span class="id">Hst</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">lock_st</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">Hst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H1</span> : <span class="id"><a href="Globalenvs.html#Genv.find_symbol">Genv.find_symbol</a></span> <span class="id">_</span> <span class="id"><a href="code.html#lock_L_ident">lock_L_ident</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id"><a href="TSOMem.html#load_tsomem">load_tsomem</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H_L_addr</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">inversion</span> <span class="id">H1</span>; <span class="tactic">subst</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H2</span> <span class="id">to</span> <span class="id">Hload_tsomem</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">load_tsomem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="MemLemmas.html#tsoloadv_not_in_bf_load_gm_eq">tsoloadv_not_in_bf_load_gm_eq</a></span> <span class="kwd">in</span> <span class="id">Htso_load</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hload_tsomem</span> <span class="kwd">in</span> <span class="id">Htso_load</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htso_load</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Asm.html#nextinstr_nf">nextinstr_nf</a></span>, <span class="id"><a href="Asm.html#nextinstr">nextinstr</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Pregmap_elim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">unlock_st</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">Hst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">_</span> \/ <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">Hst</span> | <span class="id">Hst</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">Hst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H1</span> : <span class="id"><a href="Globalenvs.html#Genv.find_symbol">Genv.find_symbol</a></span> <span class="id">_</span> <span class="id"><a href="code.html#lock_L_ident">lock_L_ident</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id"><a href="TSOMem.html#load_tsomem">load_tsomem</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H_L_addr</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">inversion</span> <span class="id">H1</span>; <span class="tactic">subst</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H2</span> <span class="id">to</span> <span class="id">Hload_tsomem</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">load_tsomem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.   <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H7</span> <span class="id">to</span> <span class="id">t</span>''.  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> <span class="id">t</span> <span class="id">t</span>'') <span class="id">eqn</span>:?; <span class="tactic">try</span> <span class="tactic">subst</span> <span class="id">t</span>''; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="MemLemmas.html#in_buffer_count_one_load2">in_buffer_count_one_load2</a></span> <span class="kwd">with</span> (<span class="id">n</span> := <span class="id"><a href="Integers.html#Int.one">Int.one</a></span>) <span class="kwd">in</span> <span class="id">Htso_load</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="MemLemmas.html#tsoloadv_not_in_bf_load_gm_eq">tsoloadv_not_in_bf_load_gm_eq</a></span> <span class="kwd">in</span> <span class="id">Htso_load</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hload_tsomem</span> <span class="kwd">in</span> <span class="id">Htso_load</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htso_load</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Asm.html#nextinstr_nf">nextinstr_nf</a></span>, <span class="id"><a href="Asm.html#nextinstr">nextinstr</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Pregmap_elim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hneq</span> : <span class="id">t</span>'' &lt;&gt; <span class="id">t</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">H_in_buffer</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_in_buffer</span> <span class="kwd">as</span> [<span class="id">ofs</span> <span class="id">H_in_buffer</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H12</span> <span class="kwd">with</span> (<span class="id">ofs</span> := <span class="id">ofs</span>) <span class="kwd">in</span> <span class="id">Hneq</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hst</span> <span class="kwd">as</span> [<span class="id">Hload_tsomem</span> <span class="id">Hnot_bf</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H1</span> : <span class="id"><a href="Globalenvs.html#Genv.find_symbol">Genv.find_symbol</a></span> <span class="id">_</span> <span class="id"><a href="code.html#lock_L_ident">lock_L_ident</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id"><a href="TSOMem.html#load_tsomem">load_tsomem</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H_L_addr</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">inversion</span> <span class="id">H1</span>; <span class="tactic">subst</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H2</span> <span class="id">to</span> <span class="id">Hload_tsomem</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">load_tsomem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="MemLemmas.html#tsoloadv_not_in_bf_load_gm_eq">tsoloadv_not_in_bf_load_gm_eq</a></span> <span class="kwd">in</span> <span class="id">Htso_load</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hload_tsomem</span> <span class="kwd">in</span> <span class="id">Htso_load</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htso_load</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Asm.html#nextinstr_nf">nextinstr_nf</a></span>, <span class="id"><a href="Asm.html#nextinstr">nextinstr</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Pregmap_elim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hnot_bf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">H_in_bf</span>; <span class="tactic">destruct</span> <span class="id">H_in_bf</span> <span class="kwd">as</span> [<span class="id">ofs</span> <span class="id">H_in_bf</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hnot_bf</span> <span class="id">t</span> <span class="id">ofs</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_m_unchange_objinv</span> <span class="id">tm</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="id">solve_mem_strip</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmLang.html#exec_load_fp">exec_load_fp</a></span>, <span class="id"><a href="FMemOpFP.html#loadv_fp">loadv_fp</a></span>, <span class="id"><a href="ASM_local.html#eval_addrmode">eval_addrmode</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Archi.html#ptr64">Archi.ptr64</a></span>); <span class="id">tryfalse</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="Integers.html#Int.add">Int.add</a></span> <span class="id"><a href="Integers.html#Int.zero">Int.zero</a></span> (<span class="id"><a href="Integers.html#Int.repr">Int.repr</a></span> 0)) <span class="kwd">with</span> <span class="id"><a href="Integers.html#Int.zero">Int.zero</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H7</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="Integers.html#Ptrofs.add">Ptrofs.add</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0) (<span class="id"><a href="Integers.html#Ptrofs.of_int">Ptrofs.of_int</a></span> <span class="id"><a href="Integers.html#Int.zero">Int.zero</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> <span class="id"><a href="Integers.html#Ptrofs.zero">Ptrofs.zero</a></span> <span class="kwd">in</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#load_fp">load_fp</a></span>, <span class="id"><a href="FMemOpFP.html#range_locset">range_locset</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="RGRels.html#obj_valid_block_fp">obj_valid_block_fp</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Footprint.html#FP.locs">FP.locs</a></span>, <span class="id"><a href="Footprint.html#Locs.belongsto">Locs.belongsto</a></span>, <span class="id"><a href="Footprint.html#Locs.union">Locs.union</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="Integers.html#Ptrofs.unsigned">Ptrofs.unsigned</a></span> <span class="id"><a href="Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) <span class="kwd">with</span> 0%<span class="id">Z</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zle">zle</a></span> 0 <span class="id">ofs</span>); <span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zlt">zlt</a></span> <span class="id">ofs</span> 4); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H9</span> <span class="id">Hobj_inv</span> <span class="id">l</span> <span class="id">l0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">obj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hobj_inv</span> <span class="kwd">as</span> (<span class="id">L</span> &amp; <span class="id">Hobj_inv</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H9</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H4</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;lock&nbsp;acqurie&nbsp;:&nbsp;cmp&nbsp;RBX&nbsp;$0&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htsostep</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H1</span> : <span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H1</span> <span class="id">to</span> <span class="id">Hobj_inv</span>, <span class="id">H2</span> <span class="id">to</span> <span class="id">Hembed</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">try</span> <span class="id">ptr_elim</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;2 : <span class="id">external_call_elim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="AsmTSO.html#exec_instr_TSO">exec_instr_TSO</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">H</span> <span class="id">into</span> <span class="id">Hexe_instr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexe_instr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="kwd">Next</span> <span class="id">_</span> <span class="id">_</span> = <span class="kwd">Next</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="id">inv</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Htsostep</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 <span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#star_refl">InteractionSemantics.star_refl</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>; <span class="tactic">split</span>.<br/>
<br/>
&nbsp;G&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#Gobj">Gobj</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>. <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#buffer_unchange">buffer_unchange</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hembed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#Id">Id</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;match_state&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InvRG.html#obj_lock_match">obj_lock_match</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InvRG.html#je_spin_match">je_spin_match</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#compare_ints_TSO">compare_ints_TSO</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">elim_next_intr</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">rs</span> (<span class="id"><a href="Asm.html#IR">IR</a></span> <span class="id"><a href="Asm.html#RBX">RBX</a></span>) = <span class="id">_</span> \/ <span class="id">rs</span> (<span class="id"><a href="Asm.html#IR">IR</a></span> <span class="id"><a href="Asm.html#RBX">RBX</a></span>) = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">H</span> | <span class="id">H</span>]; <span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_m_unchange_objinv</span> <span class="id">tm</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="id">solve_mem_strip</span>. <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#compare_ints_TSO_fp">compare_ints_TSO_fp</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H9</span> <span class="kwd">as</span> [<span class="id">H9</span> | <span class="id">H9</span>]; <span class="tactic">rewrite</span> <span class="id">H9</span>; <span class="tactic">simpl</span>; <span class="tactic">rewrite</span> <span class="id"><a href="GDefLemmas.html#fp_union_emp_l">GDefLemmas.fp_union_emp_l</a></span>; <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : je spin </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htsostep</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H1</span> : <span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H1</span> <span class="id">to</span> <span class="id">Hobj_inv</span>, <span class="id">H2</span> <span class="id">to</span> <span class="id">Hembed</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">try</span> <span class="id">ptr_elim</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;2 : <span class="id">external_call_elim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="AsmTSO.html#exec_instr_TSO">exec_instr_TSO</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">H</span> <span class="id">into</span> <span class="id">Hexe_instr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexe_instr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hexe_instr</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Htsostep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">rs</span> <span class="id"><a href="Asm.html#ZF">ZF</a></span>) <span class="id">eqn</span>:<span class="id">Hzf</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Integers.html#Int.eq">Int.eq</a></span> <span class="id">i</span> <span class="id"><a href="Integers.html#Int.one">Int.one</a></span>) <span class="id">eqn</span>:<span class="id">Heq1</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;jmp&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>: <span class="id">_</span> = <span class="kwd">Next</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexe_instr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#tso_goto_label">tso_goto_label</a></span> <span class="kwd">in</span> <span class="id">Hexe_instr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexe_instr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">find_label</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id"><a href="code.html#spin_lbl">spin_lbl</a></span> <span class="id"><a href="code.html#lock_lbl">lock_lbl</a></span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id"><a href="code.html#spin_lbl">spin_lbl</a></span> <span class="id"><a href="code.html#lock_acquire_lbl">lock_acquire_lbl</a></span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">rs</span> <span class="id"><a href="Asm.html#PC">PC</a></span>) <span class="id">eqn</span>:<span class="id">Hpc</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hexe_instr</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 <span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#star_refl">InteractionSemantics.star_refl</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>; <span class="tactic">split</span>.<br/>
&nbsp;G&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#Gobj">Gobj</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>. <span class="id">right</span>. <span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#buffer_unchange">buffer_unchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">_</span> = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span> <span class="id">Hobj_inv</span>; <span class="id">simpls</span>; <span class="tactic">subst</span>; <span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#Id">Id</a></span>; <span class="tactic">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>. <br/>
<br/>
&nbsp;match&nbsp;state&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#buffer_unchange">buffer_unchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id">_</span> <span class="id">_</span> = <span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InvRG.html#obj_lock_match">obj_lock_match</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InvRG.html#get_lock_var">get_lock_var</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Asm.html#Pregmap.gss">Pregmap.gss</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_m_unchange_objinv</span> <span class="id">tm</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="id">solve_mem_strip</span>. <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexe_instr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hexe_instr</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 <span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#star_refl">InteractionSemantics.star_refl</a></span>.<br/>
<br/>
&nbsp;G&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#Gobj">Gobj</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#Id">Id</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#buffer_unchange">buffer_unchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">_</span> = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;match&nbsp;state&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InvRG.html#obj_lock_match">obj_lock_match</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InvRG.html#jmp_lock_match">jmp_lock_match</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">elim_next_intr</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_m_unchange_objinv</span> <span class="id">tm</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="id">solve_mem_strip</span>. <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : jmp lock_acquire </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htsostep</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H1</span> : <span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H1</span> <span class="id">to</span> <span class="id">Hobj_inv</span>, <span class="id">H2</span> <span class="id">to</span> <span class="id">Hembed</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">try</span> <span class="id">ptr_elim</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;2 : <span class="id">external_call_elim</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="AsmTSO.html#exec_instr_TSO">exec_instr_TSO</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> = <span class="kwd">Next</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">H</span> <span class="id">into</span> <span class="id">Hexec_instr_TSO</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexec_instr_TSO</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#tso_goto_label">tso_goto_label</a></span> <span class="kwd">in</span> <span class="id">Hexec_instr_TSO</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexec_instr_TSO</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">find_label</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id"><a href="code.html#lock_acquire_lbl">lock_acquire_lbl</a></span> <span class="id"><a href="code.html#lock_lbl">lock_lbl</a></span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">_</span> <span class="id"><a href="Asm.html#PC">PC</a></span> = <span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Hexec_instr_TSO</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hexec_instr_TSO</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 <span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#star_refl">InteractionSemantics.star_refl</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>; <span class="tactic">split</span>.<br/>
&nbsp;G&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#Gobj">Gobj</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#Id">Id</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">_</span> = <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#buffer_unchange">buffer_unchange</a></span>; <span class="tactic">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;match&nbsp;state&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#buffer_unchange">buffer_unchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InvRG.html#obj_lock_match">obj_lock_match</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InvRG.html#get_cmp_val">get_cmp_val</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Asm.html#Pregmap.gss">Pregmap.gss</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_m_unchange_objinv</span> <span class="id">tm</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="id">solve_mem_strip</span>. <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : enter label </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htsostep</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H1</span> : <span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H1</span> <span class="id">to</span> <span class="id">Hobj_inv</span>, <span class="id">H2</span> <span class="id">to</span> <span class="id">Hembed</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">try</span> <span class="id">ptr_elim</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;2 : <span class="id">external_call_elim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="AsmTSO.html#exec_instr_TSO">exec_instr_TSO</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">H</span> <span class="id">into</span> <span class="id">Hexec_instr_TSO</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexec_instr_TSO</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hexec_instr_TSO</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 <span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#star_refl">InteractionSemantics.star_refl</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>; <span class="tactic">split</span>.<br/>
&nbsp;G&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#Gobj">Gobj</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="id">right</span>; <span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#buffer_unchange">buffer_unchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#Id">Id</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">_</span> = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span> <span class="id">Hobj_inv</span>; <span class="id">simpls</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;match&nbsp;state&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InvRG.html#obj_lock_match">obj_lock_match</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InvRG.html#set_ret_val">set_ret_val</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">elim_next_intr</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_m_unchange_objinv</span> <span class="id">tm</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="id">solve_mem_strip</span>. <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : mov $0 RAX </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htsostep</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H1</span> : <span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H1</span> <span class="id">to</span> <span class="id">Hobj_inv</span>, <span class="id">H2</span> <span class="id">to</span> <span class="id">Hembed</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">try</span> <span class="id">ptr_elim</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;2 : <span class="id">external_call_elim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="AsmTSO.html#exec_instr_TSO">exec_instr_TSO</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">H</span> <span class="id">into</span> <span class="id">Hexec_instr_TSO</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexec_instr_TSO</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hexec_instr_TSO</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Htsostep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 <span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#star_refl">InteractionSemantics.star_refl</a></span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>; <span class="tactic">split</span>.<br/>
&nbsp;G&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#Gobj">Gobj</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="id">right</span>; <span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#Id">Id</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#buffer_unchange">buffer_unchange</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">_</span> = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span> <span class="id">Hobj_inv</span>; <span class="id">simpls</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;match&nbsp;state&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InvRG.html#obj_lock_match">obj_lock_match</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InvRG.html#lock_retl_match">lock_retl_match</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">elim_next_intr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_m_unchange_objinv</span> <span class="id">tm</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="id">solve_mem_strip</span>. <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">lock acquire : retl </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htsostep</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H1</span> : <span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H1</span> <span class="id">to</span> <span class="id">Hobj_inv</span>, <span class="id">H2</span> <span class="id">to</span> <span class="id">Hembed</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">try</span> <span class="id">ptr_elim</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;2 : <span class="id">external_call_elim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="AsmTSO.html#exec_instr_TSO">exec_instr_TSO</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">H</span> <span class="id">into</span> <span class="id">Hexec_instr_TSO</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hexec_instr_TSO</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hexec_instr_TSO</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Htsostep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hspec_embed</span> : (<span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">Classical_Prop.classic</a></span> (<span class="id">exists</span> <span class="id">fsm</span>, <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">sm</span> <span class="id">fl</span> <span class="id">fsm</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hspec_embed</span> <span class="kwd">as</span> [<span class="id">Hspec_embed_ex</span> | <span class="id">Hspec_embed_nex</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hspec_embed_ex</span> <span class="kwd">as</span> [<span class="id">fsm</span> <span class="id">Hspec_embed_ex</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 <span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
<br/>
&nbsp;skip&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec_p_exec</span>.<br/>
<br/>
&nbsp;while&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#star_step">InteractionSemantics.star_step</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hspec_embed_ex</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="SpecLang.html#Swhile_false">SpecLang.Swhile_false</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="SpecLang.html#Eval_bfalse">SpecLang.Eval_bfalse</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">te</span> <span class="id">_</span> = <span class="id"><a href="Values.html#Vone">Vone</a></span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span>; <span class="id">introv</span> <span class="id">Hcontr</span>; <span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Hcontr</span>; <span class="id">tryfalse</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;<br/>
&nbsp;skip&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec_p_exec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hspec_embed_ex</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;skip&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec_p_exec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hspec_embed_ex</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.       <br/>
&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;G&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#Gobj">Gobj</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hembed</span> <span class="id">Hspec_embed_ex</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hembed</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#buffer_unchange">buffer_unchange</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#Id">Id</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hspec_embed_ex</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;<br/>
&nbsp;match&nbsp;state&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hspec_embed_ex</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InvRG.html#obj_lock_match">obj_lock_match</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InvRG.html#lock_halt_match">lock_halt_match</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_m_unchange_objinv</span> <span class="id">tm</span> <span class="id">Hobj_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_mem_strip</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="id">inv</span> <span class="id">Hspec_embed_ex</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 <span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#star_refl">InteractionSemantics.star_refl</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">introv</span> <span class="id">Hcontr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hcontr</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hspec_embed_nex</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
<div class="doc">module halt </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htsostep</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="id">ptr_elim</span>]; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>; <span class="id">ret_zero_ptr_false</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">lock_init_match</span> <span class="id">lock_label_match</span> <span class="id">mov_Laddr_match</span> <span class="id">set_lock_val</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lock_acquire_label</span> <span class="id">get_cmp_val</span> <span class="id">lock_cmpxchg_match</span> <span class="id">jne_enter_ZF_1_match</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">jne_enter_ZF_0_match</span> <span class="id">spin_label_match</span> <span class="id">get_lock_var</span> <span class="id">cmp_Lvar_match</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">je_spin_match</span> <span class="id">jmp_lock_match</span> <span class="id">enter_label_match</span> <span class="id">set_ret_val</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lock_retl_match</span> <span class="id">lock_halt_match</span><br/>
&nbsp;&nbsp;: <span class="id">lock_match</span>.<br/>
<br/>
<div class="doc"><span class="bracket"><span class="id">match_rely</span></span> holds in function lock </div>
<span class="kwd">Lemma</span> <span class="id"><a name="lock_acquire_rely">lock_acquire_rely</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">sc</span> <span class="id">sm</span> <span class="id">sm</span>' <span class="id">tc</span> <span class="id">tm</span> <span class="id">tm</span>' <span class="id">sge</span> <span class="id">sG</span> <span class="id">tge</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hspec_init</span> : <span class="id"><a href="InteractionSemantics.html#init_genv">InteractionSemantics.init_genv</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span> <span class="id"><a href="code.html#lock_comp_unit">lock_comp_unit</a></span> <span class="id"><a href="LockAcqProof.html#sge">sge</a></span> <span class="id"><a href="LockAcqProof.html#sG">sG</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Himp_init</span> : <span class="id"><a href="AsmTSO.html#init_genv">init_genv</a></span> <span class="id"><a href="code.html#lock_comp_tso_unit">lock_comp_tso_unit</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hlock_match</span> : <span class="id"><a href="InvRG.html#lock_match_state">lock_match_state</a></span> <span class="id"><a href="LockAcqProof.html#sge">sge</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span> <span class="id"><a href="LockAcqProof.html#t">t</a></span> (<span class="id"><a href="LockAcqProof.html#sc">sc</a></span>, <span class="id"><a href="LockAcqProof.html#sm">sm</a></span>) (<span class="id"><a href="LockAcqProof.html#tc">tc</a></span>, <span class="id"><a href="LockAcqProof.html#tm">tm</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hrely_step</span> : <span class="id"><a href="InvRG.html#Robj">Robj</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span> <span class="id"><a href="LockAcqProof.html#t">t</a></span> <span class="id"><a href="LockAcqProof.html#sm">sm</a></span> <span class="id"><a href="LockAcqProof.html#tm">tm</a></span> <span class="id">sm</span>' <span class="id">tm</span>'),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InvRG.html#lock_match_state">lock_match_state</a></span> <span class="id"><a href="LockAcqProof.html#sge">sge</a></span> <span class="id"><a href="LockAcqProof.html#tge">tge</a></span> <span class="id"><a href="LockAcqProof.html#t">t</a></span> (<span class="id"><a href="LockAcqProof.html#sc">sc</a></span>, <span class="id">sm</span>') (<span class="id"><a href="LockAcqProof.html#tc">tc</a></span>, <span class="id">tm</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9945')">Proof.</div>
<div class="proofscript" id="proof9945">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="MemLemmas.html#R_impl_I_I">R_impl_I_I</a></span> <span class="kwd">in</span> <span class="id">Hrely_step</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hrely_step</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hlock_match</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">lock_match</span>.<br/>
Qed.</div>
</div>
<div class="footer"><hr/>Generated by coq2html</div>
</body>
</html>
