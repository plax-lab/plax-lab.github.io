<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module GlobDefs</title>
<meta name="description" content="Documentation of Coq module GlobDefs" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module GlobDefs</h1>
<div class="coq">
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Coqlib.html">Coqlib</a></span> <span class="id"><a href="Maps.html">Maps</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">mathcomp.ssreflect.fintype</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="AST.html">AST</a></span> <span class="id"><a href="Values.html">Values</a></span> <span class="id"><a href="Globalenvs.html">Globalenvs</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Blockset.html">Blockset</a></span> <span class="id"><a href="GMemory.html">GMemory</a></span> <span class="id"><a href="MemClosures.html">MemClosures</a></span> <span class="id"><a href="MemAux.html">MemAux</a></span> <span class="id"><a href="InteractionSemantics.html">InteractionSemantics</a></span> <span class="id"><a href="GAST.html">GAST</a></span> <span class="id"><a href="Injections.html">Injections</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html">Lists.Streams</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.micromega.Lia.html">Lia</a></span>.<br/>
<br/>
<h1> Definitions of global runtime states</h1>
<br/>
<div class="doc">This file defines the runtime global states. 
    The global world consists of:
    - <span class="bracket"><span class="id">GlobEnv</span></span>: environment containing module code and freelists
    - <span class="bracket"><span class="id">ProgConfig</span></span>: runtime state 
 </div>
<br/>
<br/>
<div class="doc">thread id </div>
<span class="kwd">Definition</span> <span class="id"><a name="tid">tid</a></span> : <span class="kwd">Type</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>.<br/>
<div class="doc">freelist if </div>
<span class="kwd">Definition</span> <span class="id"><a name="fid">fid</a></span> : <span class="kwd">Type</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>.<br/>
<div class="doc">module id </div>
<span class="kwd">Definition</span> <span class="id"><a name="mid">mid</a></span> : <span class="kwd">Type</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>.<br/>
<br/>
<h2> The freelists of all threads and runtime modules </h2>
<span class="kwd">Module</span> <span class="id"><a name="FLists">FLists</a></span>.<br/>
<br/>
<div class="doc">Freelists consists of
      - <span class="bracket"><span class="id">flist_content</span></span>: mapping from freelist id <span class="bracket"><span class="id">fid</span></span> to the actual freelists of type <span class="bracket"><span class="id">Stream</span> <span class="id">block</span></span>
      - <span class="bracket"><span class="id">thread_flmap</span></span>: a stream of freelist ids allocated for each thread </div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Record</span> <span class="id"><a name="FLists.t">t</a></span>: <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id"><a name="FLists.flist_content">flist_content</a></span>: <span class="id"><a href="GlobDefs.html#fid">fid</a></span> -&gt; <span class="id"><a href="MemAux.html#freelist">freelist</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="FLists.thread_flmap">thread_flmap</a></span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> -&gt; <span class="id"><a href="GlobDefs.html#fid">fid</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
<br/>
<div class="doc">We always assume freelists are <span class="bracket"><span class="id">wd</span></span>, i.e.
      - <span class="bracket"><span class="id">flist_norep</span></span>: each freelist itself has no duplicated block
      - <span class="bracket"><span class="id">flist_disj</span></span>: any two freelists are disjoint
      - <span class="bracket"><span class="id">thread_fl_norep</span></span>: threads' freelist id stream is not duplicated
      - <span class="bracket"><span class="id">thread_fl_disj</span></span>: threads are not assigned with have duplicated freelists 
      In this way, any two different runtime <span class="bracket"><span class="id">Core.t</span></span>s could be guaranteed assigned with disjoint freelist.
   </div>
&nbsp;&nbsp;<span class="kwd">Record</span> <span class="id"><a name="FLists.wd">wd</a></span> (<span class="id">fls</span>: <span class="id"><a href="GlobDefs.html#FLists.t">t</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="FLists.flist_norep">flist_norep</a></span>: <span class="kwd">forall</span> <span class="id">f</span>, <span class="id"><a href="MemAux.html#norep">norep</a></span> (<span class="id"><a href="GlobDefs.html#FLists.flist_content">flist_content</a></span> <span class="id"><a href="GlobDefs.html#fls">fls</a></span> <span class="id"><a href="GlobDefs.html#f">f</a></span>);      <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="FLists.flist_disj">flist_disj</a></span>: <span class="kwd">forall</span> <span class="id">f1</span> <span class="id">f2</span>, <span class="id"><a href="GlobDefs.html#f1">f1</a></span> &lt;&gt; <span class="id"><a href="GlobDefs.html#f2">f2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="MemAux.html#disj">disj</a></span> (<span class="id"><a href="GlobDefs.html#FLists.flist_content">flist_content</a></span> <span class="id"><a href="GlobDefs.html#fls">fls</a></span> <span class="id"><a href="GlobDefs.html#f1">f1</a></span>) (<span class="id"><a href="GlobDefs.html#FLists.flist_content">flist_content</a></span> <span class="id"><a href="GlobDefs.html#fls">fls</a></span> <span class="id"><a href="GlobDefs.html#f2">f2</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="FLists.thread_fl_norep">thread_fl_norep</a></span>: <span class="kwd">forall</span> <span class="id">t</span> <span class="id">n1</span> <span class="id">n2</span>, <span class="id"><a href="GlobDefs.html#n1">n1</a></span> &lt;&gt; <span class="id"><a href="GlobDefs.html#n2">n2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#FLists.thread_flmap">thread_flmap</a></span> <span class="id"><a href="GlobDefs.html#fls">fls</a></span> <span class="id"><a href="GlobDefs.html#t">t</a></span> <span class="id"><a href="GlobDefs.html#n1">n1</a></span> &lt;&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#FLists.thread_flmap">thread_flmap</a></span> <span class="id"><a href="GlobDefs.html#fls">fls</a></span> <span class="id"><a href="GlobDefs.html#t">t</a></span> <span class="id"><a href="GlobDefs.html#n2">n2</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="FLists.thread_fl_disj">thread_fl_disj</a></span>: <span class="kwd">forall</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">n1</span> <span class="id">n2</span>, <span class="id"><a href="GlobDefs.html#t1">t1</a></span> &lt;&gt; <span class="id"><a href="GlobDefs.html#t2">t2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GlobDefs.html#FLists.thread_flmap">thread_flmap</a></span> <span class="id"><a href="GlobDefs.html#fls">fls</a></span> <span class="id"><a href="GlobDefs.html#t1">t1</a></span> <span class="id"><a href="GlobDefs.html#n1">n1</a></span>) &lt;&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GlobDefs.html#FLists.thread_flmap">thread_flmap</a></span> <span class="id"><a href="GlobDefs.html#fls">fls</a></span> <span class="id"><a href="GlobDefs.html#t2">t2</a></span> <span class="id"><a href="GlobDefs.html#n2">n2</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
<br/>
<h3> Initial Freelists </h3>
<div class="doc">mapping blocks to countable freelists.. </div>
<div class="doc">    0   1   2   3   4  ..
     0   1   2   4   7   11 ..
     1   3   5   8   12 ..
     2   6   9   13 ..
     3   10  14 ..
     4   15 ..
   </div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="FLists.fid_to_freelist_func">fid_to_freelist_func</a></span> (<span class="id">base</span>: <span class="id"><a href="Values.html#block">block</a></span>) (<span class="id">fid</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>) (<span class="id">n</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) : <span class="id"><a href="Values.html#block">block</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span>: <span class="id">row</span> := (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.to_nat">Pos.to_nat</a></span> <span class="id"><a href="GlobDefs.html#fid">fid</a></span> - 1)%<span class="id">nat</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span>: <span class="id">col</span> := <span class="id"><a href="GlobDefs.html#n">n</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.of_nat">Pos.of_nat</a></span> ((<span class="id">row</span> + <span class="id">col</span> + 2) * (<span class="id">row</span> + <span class="id">col</span> + 1) / 2 - <span class="id">col</span>)%<span class="id">nat</span> + <span class="id"><a href="GlobDefs.html#base">base</a></span> - 1)%<span class="id">positive</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="FLists.arith_result2">arith_result2</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id"><a href="GlobDefs.html#m">m</a></span> + <span class="id"><a href="GlobDefs.html#n">n</a></span> + 2) * (<span class="id"><a href="GlobDefs.html#m">m</a></span> + <span class="id"><a href="GlobDefs.html#n">n</a></span> + 1) / 2  &gt; <span class="id"><a href="GlobDefs.html#n">n</a></span>)%<span class="id">nat</span> .<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5946')">Proof.</div>
<div class="proofscript" id="proof5946">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">m</span>.<br/>
&nbsp;m&nbsp;=&nbsp;0&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.add_0_l">Nat.add_0_l</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">n</span>. <span class="tactic">simpl</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.Plus.html#plus_Snm_nSm">plus_Snm_nSm</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.Mult.html#mult_comm">mult_comm</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> 3%<span class="id">nat</span> <span class="kwd">with</span> (1 + 2)%<span class="id">nat</span> <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.Plus.html#plus_assoc">plus_assoc</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.mul_add_distr_l">Nat.mul_add_distr_l</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.div_add">Nat.div_add</a></span>; <span class="id">lia</span>.<br/>
&nbsp;induction&nbsp;on&nbsp;m&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.Plus.html#plus_Snm_nSm">plus_Snm_nSm</a></span>. <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.add_assoc">Nat.add_assoc</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.Plus.html#plus_Snm_nSm">plus_Snm_nSm</a></span>. <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.add_assoc">Nat.add_assoc</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.Plus.html#plus_Snm_nSm">plus_Snm_nSm</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.add_assoc">Nat.add_assoc</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> 3%<span class="id">nat</span> <span class="kwd">with</span> (1 + 2)%<span class="id">nat</span> <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.Plus.html#plus_assoc">plus_assoc</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.mul_add_distr_r">Nat.mul_add_distr_r</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.Mult.html#mult_comm">mult_comm</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.Plus.html#plus_comm">plus_comm</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.Mult.html#mult_comm">mult_comm</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.Plus.html#plus_comm">plus_comm</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.div_add">Nat.div_add</a></span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="FLists.div2_plus_1">div2_plus_1</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">y</span> <span class="id">x</span>:<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>, (<span class="id"><a href="GlobDefs.html#x">x</a></span> / 2 - <span class="id"><a href="GlobDefs.html#y">y</a></span> = (<span class="id"><a href="GlobDefs.html#x">x</a></span> - 2 * <span class="id"><a href="GlobDefs.html#y">y</a></span>) / 2)%<span class="id">nat</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5947')">Proof.</div>
<div class="proofscript" id="proof5947">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">y</span>; <span class="tactic">intro</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.mul_0_r">Nat.mul_0_r</a></span>, 2 <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.sub_0_r">Nat.sub_0_r</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">x</span> / 2 - <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">y</span>)%<span class="id">nat</span> <span class="kwd">with</span> (<span class="id">x</span> / 2 - <span class="id">y</span> - 1)%<span class="id">nat</span> <span class="tactic">by</span> <span class="id">lia</span>. <span class="tactic">rewrite</span> <span class="id">IHy</span>. <span class="tactic">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> ((<span class="id">x</span> - 2 * <span class="id">y</span>) / 2 - 1)%<span class="id">nat</span> <span class="kwd">with</span> ((<span class="id">x</span> - 2 * <span class="id">y</span> - 2)/2)%<span class="id">nat</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (2 * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">y</span>)%<span class="id">nat</span> <span class="kwd">with</span> (2 * (<span class="id">y</span> + 1))%<span class="id">nat</span> <span class="tactic">by</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.mul_add_distr_l">Nat.mul_add_distr_l</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.mul_1_r">Nat.mul_1_r</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.sub_add_distr">Nat.sub_add_distr</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="kwd">forall</span> <span class="id">x</span>, (<span class="id"><a href="GlobDefs.html#x">x</a></span> / 2 - 1 = (<span class="id"><a href="GlobDefs.html#x">x</a></span> - 2) / 2)%<span class="id">nat</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">clear</span>. <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">x</span>. <span class="tactic">simpl</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>. <span class="tactic">simpl</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>. <span class="tactic">simpl</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">x</span>)) - 2)%<span class="id">nat</span> <span class="kwd">with</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">x</span>) <span class="tactic">by</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">x</span>) - 2)%<span class="id">nat</span> <span class="kwd">with</span> <span class="id">x</span> <span class="kwd">in</span> <span class="id">IHx</span> <span class="tactic">by</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.Even.html#even_or_odd">Even.even_or_odd</a></span> <span class="id">x</span>).<br/>
&nbsp;even&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.Even.html#even">Even.even</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">x</span>))) <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.Even.html#even_S">Even.even_S</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.Even.html#odd_S">Even.odd_S</a></span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.div2_div">Nat.div2_div</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.Div2.html#even_div2">Div2.even_div2</a></span>; <span class="tactic">auto</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.div2_div">Nat.div2_div</a></span>. <span class="tactic">rewrite</span> <span class="id">IHx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.Div2.html#even_div2">Div2.even_div2</a></span>; <span class="tactic">auto</span>. <span class="tactic">symmetry</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.div2_div">Nat.div2_div</a></span>.<br/>
&nbsp;odd&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.Even.html#odd">Even.odd</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">x</span>))) <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.Even.html#odd_S">Even.odd_S</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.Even.html#even_S">Even.even_S</a></span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.div2_div">Nat.div2_div</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.Div2.html#odd_div2">Div2.odd_div2</a></span> <span class="id">x</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.Div2.html#odd_div2">Div2.odd_div2</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="FLists.arith_aux">arith_aux</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x1</span> <span class="id">y1</span> <span class="id">x2</span> <span class="id">y2</span>, (<span class="id"><a href="GlobDefs.html#x1">x1</a></span> + <span class="id"><a href="GlobDefs.html#y1">y1</a></span> &lt; <span class="id"><a href="GlobDefs.html#x2">x2</a></span> + <span class="id"><a href="GlobDefs.html#y2">y2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GlobDefs.html#x1">x1</a></span> + <span class="id"><a href="GlobDefs.html#y1">y1</a></span> + 2) * (<span class="id"><a href="GlobDefs.html#x1">x1</a></span> + <span class="id"><a href="GlobDefs.html#y1">y1</a></span> + 1) / 2 - <span class="id"><a href="GlobDefs.html#y1">y1</a></span> &lt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GlobDefs.html#x2">x2</a></span> + <span class="id"><a href="GlobDefs.html#y2">y2</a></span> + 2) * (<span class="id"><a href="GlobDefs.html#x2">x2</a></span> + <span class="id"><a href="GlobDefs.html#y2">y2</a></span> + 1) / 2 - <span class="id"><a href="GlobDefs.html#y2">y2</a></span>)%<span class="id">nat</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5948')">Proof.</div>
<div class="proofscript" id="proof5948">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">m1</span> <span class="id">n1</span> <span class="id">m2</span> <span class="id">n2</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="GlobDefs.html#FLists.arith_result2">arith_result2</a></span> <span class="id">m2</span> <span class="id">n2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> ((<span class="id">m2</span> + <span class="id">n2</span> + 2) * (<span class="id">m2</span> + <span class="id">n2</span> + 1) / 2 - <span class="id">n2</span> &gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m2</span> + <span class="id">n2</span> + 2) * (<span class="id">m2</span> + <span class="id">n2</span> + 1) / 2 - (<span class="id">m2</span> + <span class="id">n2</span> + 1))%<span class="id">nat</span> <span class="tactic">by</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> ((<span class="id">m2</span> + <span class="id">n2</span> + 2) * (<span class="id">m2</span> + <span class="id">n2</span> + 1) / 2 - (<span class="id">m2</span> + <span class="id">n2</span> + 1) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m2</span> + <span class="id">n2</span> + 2 - 2) * (<span class="id">m2</span> + <span class="id">n2</span> + 1) / 2)%<span class="id">nat</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">clear</span> <span class="id">H</span> <span class="id">H0</span> <span class="id">H1</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="GlobDefs.html#FLists.div2_plus_1">div2_plus_1</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.mul_sub_distr_r">Nat.mul_sub_distr_r</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">clear</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">m2</span> + <span class="id">n2</span> + 2 - 2)%<span class="id">nat</span> <span class="kwd">with</span> (<span class="id">m2</span> + <span class="id">n2</span>)%<span class="id">nat</span> <span class="kwd">in</span> <span class="id">H1</span> <span class="tactic">by</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> ((<span class="id">m2</span> + <span class="id">n2</span>) * (<span class="id">m2</span> + <span class="id">n2</span> + 1) / 2 &gt;= (<span class="id">m1</span> + <span class="id">n1</span> + 1) * (<span class="id">m1</span> + <span class="id">n1</span> + 2) / 2)%<span class="id">nat</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">generalize</span> <span class="id">H</span>; <span class="tactic">clear</span>; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">m2</span> + <span class="id">n2</span> &gt;= <span class="id">m1</span> + <span class="id">n1</span> + 1)%<span class="id">nat</span> <span class="tactic">by</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.div_le_mono">Nat.div_le_mono</a></span>; [<span class="id">lia</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.mul_le_mono">Nat.mul_le_mono</a></span>; <span class="id">lia</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> ((<span class="id">m1</span> + <span class="id">n1</span> + 1) * (<span class="id">m1</span> + <span class="id">n1</span> + 2) / 2 &gt;=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m1</span> + <span class="id">n1</span> + 1) * (<span class="id">m1</span> + <span class="id">n1</span> + 2) / 2 - <span class="id">n1</span>)%<span class="id">nat</span> <span class="tactic">by</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.le_lt_trans">Nat.le_lt_trans</a></span>. 2: <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.le_trans">Nat.le_trans</a></span>. <span class="tactic">rewrite</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.mul_comm">Nat.mul_comm</a></span>). <span class="tactic">apply</span> <span class="id">H3</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="FLists.arith_result1">arith_result1</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m1</span> <span class="id">n1</span> <span class="id">m2</span> <span class="id">n2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#m1">m1</a></span> &lt;&gt; <span class="id"><a href="GlobDefs.html#m2">m2</a></span> \/ <span class="id"><a href="GlobDefs.html#n1">n1</a></span> &lt;&gt; <span class="id"><a href="GlobDefs.html#n2">n2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id"><a href="GlobDefs.html#m1">m1</a></span> + <span class="id"><a href="GlobDefs.html#n1">n1</a></span> + 2) * (<span class="id"><a href="GlobDefs.html#m1">m1</a></span> + <span class="id"><a href="GlobDefs.html#n1">n1</a></span> + 1) / 2 - <span class="id"><a href="GlobDefs.html#n1">n1</a></span>)%<span class="id">nat</span> &lt;&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id"><a href="GlobDefs.html#m2">m2</a></span> + <span class="id"><a href="GlobDefs.html#n2">n2</a></span> + 2) * (<span class="id"><a href="GlobDefs.html#m2">m2</a></span> + <span class="id"><a href="GlobDefs.html#n2">n2</a></span> + 1) / 2 - <span class="id"><a href="GlobDefs.html#n2">n2</a></span>)%<span class="id">nat</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5949')">Proof.</div>
<div class="proofscript" id="proof5949">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="GlobDefs.html#FLists.arith_result2">arith_result2</a></span> <span class="id">m1</span> <span class="id">n1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="GlobDefs.html#FLists.arith_result2">arith_result2</a></span> <span class="id">m2</span> <span class="id">n2</span>).<br/>
<br/>
&nbsp;whether&nbsp;m1&nbsp;+&nbsp;n1&nbsp;=&nbsp;m2&nbsp;+&nbsp;n2&nbsp;?&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eq_dec">Nat.eq_dec</a></span> (<span class="id">m1</span> + <span class="id">n1</span>) (<span class="id">m2</span> + <span class="id">n2</span>)).<br/>
&nbsp;if&nbsp;eq,&nbsp;by&nbsp;arith_result2,&nbsp;n1&nbsp;=&nbsp;n2&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">e</span> <span class="kwd">in</span> *. <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">n1</span> = <span class="id">n2</span>) <span class="tactic">by</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id">H</span>. <span class="tactic">generalize</span> <span class="id">e</span>; <span class="tactic">clear</span>; <span class="tactic">intro</span>. <span class="id">lia</span>.<br/>
&nbsp;if&nbsp;neq,&nbsp;it&nbsp;is&nbsp;either&nbsp;m1&nbsp;+&nbsp;n1&nbsp;&gt;&nbsp;m2&nbsp;+&nbsp;n2,&nbsp;or&nbsp;..&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.le_decidable">Nat.le_decidable</a></span> (<span class="id">m1</span> + <span class="id">n1</span>) (<span class="id">m2</span> + <span class="id">n2</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">m1</span> + <span class="id">n1</span>  &lt; <span class="id">m2</span> + <span class="id">n2</span> )%<span class="id">nat</span> <span class="tactic">by</span> <span class="id">lia</span>; <span class="tactic">clear</span> <span class="id">n</span> <span class="id">H2</span>.<br/>
&nbsp;by&nbsp;m1&nbsp;+&nbsp;n1&nbsp;&lt;&nbsp;m2&nbsp;+&nbsp;n1,&nbsp;and&nbsp;arith_2,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((m2&nbsp;+&nbsp;n2&nbsp;+&nbsp;2)&nbsp;*&nbsp;..&nbsp;/&nbsp;2&nbsp;-&nbsp;n2&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&nbsp;(...)/2&nbsp;-&nbsp;(m2&nbsp;+&nbsp;n2&nbsp;+&nbsp;1)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;=?&nbsp;(...)/2&nbsp;-&nbsp;(m1&nbsp;+&nbsp;n1&nbsp;+&nbsp;1)&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="GlobDefs.html#FLists.arith_aux">arith_aux</a></span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">m2</span> + <span class="id">n2</span> &lt; <span class="id">m1</span> + <span class="id">n1</span>)%<span class="id">nat</span> <span class="tactic">by</span> <span class="id">lia</span>; <span class="tactic">clear</span> <span class="id">n</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="GlobDefs.html#FLists.arith_aux">arith_aux</a></span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">CoFixpoint</span> <span class="id"><a name="FLists.func_to_stream">func_to_stream</a></span> {<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">func</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> -&gt; <span class="id"><a href="GlobDefs.html#A">A</a></span>) (<span class="id">base</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>): <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="GlobDefs.html#A">A</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Cons">Cons</a></span> (<span class="id"><a href="GlobDefs.html#func">func</a></span> <span class="id"><a href="GlobDefs.html#base">base</a></span>) (<span class="id"><a href="GlobDefs.html#func_to_stream">func_to_stream</a></span> <span class="id"><a href="GlobDefs.html#func">func</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id"><a href="GlobDefs.html#base">base</a></span>)).<br/>
<br/>
<br/>
<div class="doc">in case we need it for cofix </div>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="FLists.frob">frob</a></span> {<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">s</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="GlobDefs.html#A">A</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="GlobDefs.html#A">A</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="GlobDefs.html#s">s</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Cons">Cons</a></span> <span class="id">h</span> <span class="id">t</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Cons">Cons</a></span> <span class="id">h</span> <span class="id">t</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Theorem</span> <span class="id"><a name="FLists.frob_eq">frob_eq</a></span>: <span class="kwd">forall</span> <span class="id">A</span> (<span class="id">s</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="GlobDefs.html#A">A</a></span>), <span class="id"><a href="GlobDefs.html#s">s</a></span> = <span class="id"><a href="GlobDefs.html#FLists.frob">frob</a></span> <span class="id"><a href="GlobDefs.html#s">s</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5950')">Proof.</div>
<div class="proofscript" id="proof5950">
 <span class="tactic">destruct</span> <span class="id">s</span>. <span class="tactic">auto</span>. Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="FLists.freelist_func_stream_S">freelist_func_stream_S</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span> <span class="id">n</span> (<span class="id">func</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> -&gt; <span class="id"><a href="GlobDefs.html#A">A</a></span>) <span class="id">base</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Str_nth">Str_nth</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id"><a href="GlobDefs.html#n">n</a></span>) (<span class="id"><a href="GlobDefs.html#FLists.func_to_stream">func_to_stream</a></span> <span class="id"><a href="GlobDefs.html#func">func</a></span> <span class="id"><a href="GlobDefs.html#base">base</a></span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Str_nth">Str_nth</a></span> <span class="id"><a href="GlobDefs.html#n">n</a></span> (<span class="id"><a href="GlobDefs.html#FLists.func_to_stream">func_to_stream</a></span> <span class="id"><a href="GlobDefs.html#func">func</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id"><a href="GlobDefs.html#base">base</a></span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5951')">Proof.</div>
<div class="proofscript" id="proof5951">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#FLists.func_to_stream">func_to_stream</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Str_nth">Str_nth</a></span>. <span class="tactic">simpl</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="FLists.freelist_func_stream_eq">freelist_func_stream_eq</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span> <span class="id">n</span> (<span class="id">func</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> -&gt; <span class="id"><a href="GlobDefs.html#A">A</a></span>) <span class="id">base</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Str_nth">Str_nth</a></span> <span class="id"><a href="GlobDefs.html#n">n</a></span> (<span class="id"><a href="GlobDefs.html#FLists.func_to_stream">func_to_stream</a></span> <span class="id"><a href="GlobDefs.html#func">func</a></span> <span class="id"><a href="GlobDefs.html#base">base</a></span>) = <span class="id"><a href="GlobDefs.html#func">func</a></span> (<span class="id"><a href="GlobDefs.html#n">n</a></span> + <span class="id"><a href="GlobDefs.html#base">base</a></span>)%<span class="id">nat</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5952')">Proof.</div>
<div class="proofscript" id="proof5952">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">base</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">n</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">rewrite</span> <span class="id"><a href="GlobDefs.html#FLists.freelist_func_stream_S">freelist_func_stream_S</a></span>. <span class="tactic">rewrite</span> <span class="id">IHn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.add_comm">Nat.add_comm</a></span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.add_comm">Nat.add_comm</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="FLists.init_flist_content">init_flist_content</a></span> (<span class="id">base</span>: <span class="id"><a href="Values.html#block">block</a></span>) : <span class="id"><a href="GlobDefs.html#fid">fid</a></span> -&gt; <span class="id"><a href="MemAux.html#freelist">freelist</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">f</span>: <span class="id"><a href="GlobDefs.html#fid">fid</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#FLists.func_to_stream">func_to_stream</a></span> (<span class="id"><a href="GlobDefs.html#FLists.fid_to_freelist_func">fid_to_freelist_func</a></span> <span class="id"><a href="GlobDefs.html#base">base</a></span> <span class="id"><a href="GlobDefs.html#f">f</a></span>) 0.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
<br/>
<div class="doc">norep in each inital freelist </div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="FLists.init_freelist_norep">init_freelist_norep</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">base</span> <span class="id">f</span>, <span class="id"><a href="MemAux.html#norep">norep</a></span> (<span class="id"><a href="GlobDefs.html#FLists.init_flist_content">init_flist_content</a></span> <span class="id"><a href="GlobDefs.html#base">base</a></span> <span class="id"><a href="GlobDefs.html#f">f</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5953')">Proof.</div>
<div class="proofscript" id="proof5953">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#FLists.init_flist_content">init_flist_content</a></span>, <span class="id"><a href="GlobDefs.html#FLists.fid_to_freelist_func">fid_to_freelist_func</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">do</span> 2 <span class="tactic">rewrite</span>  <span class="id"><a href="GlobDefs.html#FLists.freelist_func_stream_eq">freelist_func_stream_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> ((<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.to_nat">Pos.to_nat</a></span> <span class="id">f</span> - 1 + (<span class="id">n1</span> + 0) + 2) * (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.to_nat">Pos.to_nat</a></span> <span class="id">f</span> - 1 + (<span class="id">n1</span> + 0) + 1) / 2 - (<span class="id">n1</span> + 0))%<span class="id">nat</span> <span class="kwd">as</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> ((<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.to_nat">Pos.to_nat</a></span> <span class="id">f</span> - 1 + (<span class="id">n2</span> + 0) + 2) * (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.to_nat">Pos.to_nat</a></span> <span class="id">f</span> - 1 + (<span class="id">n2</span> + 0) + 1) / 2 - (<span class="id">n2</span> + 0))%<span class="id">nat</span> <span class="kwd">as</span> <span class="id">y</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.add_0_r">Nat.add_0_r</a></span> <span class="kwd">in</span> <span class="id">Heqx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.add_0_r">Nat.add_0_r</a></span> <span class="kwd">in</span> <span class="id">Heqy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">x</span> &lt;&gt; <span class="id">y</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id"><a href="GlobDefs.html#FLists.arith_result1">arith_result1</a></span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">x</span> &gt; 0)%<span class="id">nat</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">subst</span>. <span class="tactic">clear</span>. <span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="GlobDefs.html#FLists.arith_result2">arith_result2</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.to_nat">Pos.to_nat</a></span> <span class="id">f</span> - 1) <span class="id">n1</span>). <span class="tactic">omega</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">y</span> &gt; 0)%<span class="id">nat</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">subst</span>. <span class="tactic">clear</span>. <span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="GlobDefs.html#FLists.arith_result2">arith_result2</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.to_nat">Pos.to_nat</a></span> <span class="id">f</span> - 1) <span class="id">n2</span>). <span class="tactic">omega</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Heqx</span> <span class="id">Heqy</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">tmp</span>: <span class="kwd">forall</span> <span class="id">a</span> <span class="id">b</span> <span class="id">c</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>, (<span class="id"><a href="GlobDefs.html#a">a</a></span> + <span class="id"><a href="GlobDefs.html#c">c</a></span> - 1)%<span class="id">positive</span> = (<span class="id"><a href="GlobDefs.html#b">b</a></span> + <span class="id"><a href="GlobDefs.html#c">c</a></span> - 1)%<span class="id">positive</span> -&gt; <span class="id"><a href="GlobDefs.html#a">a</a></span> = <span class="id"><a href="GlobDefs.html#b">b</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">clear</span>. <span class="tactic">intros</span>. <span class="tactic">rewrite</span> &lt;- (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.add_cancel_r">Pos.add_cancel_r</a></span> <span class="id">_</span> <span class="id">_</span> 1) <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.sub_add">Pos.sub_add</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="id">lia</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">tmp</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">clear</span> <span class="id">tmp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H0</span>. <span class="tactic">clear</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.Pnat.html#Nat2Pos.inj_compare">Nat2Pos.inj_compare</a></span> <span class="id">x</span> <span class="id">y</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.compare_eq_iff">Pos.compare_eq_iff</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.compare_eq_iff">Nat.compare_eq_iff</a></span>. <span class="tactic">apply</span> <span class="id">H0</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc">disj among freelists </div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="FLists.init_freelist_disj">init_freelist_disj</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">base</span> <span class="id">f1</span> <span class="id">f2</span>, <span class="id"><a href="GlobDefs.html#f1">f1</a></span> &lt;&gt; <span class="id"><a href="GlobDefs.html#f2">f2</a></span> -&gt; <span class="id"><a href="MemAux.html#disj">disj</a></span> (<span class="id"><a href="GlobDefs.html#FLists.init_flist_content">init_flist_content</a></span> <span class="id"><a href="GlobDefs.html#base">base</a></span> <span class="id"><a href="GlobDefs.html#f1">f1</a></span>) (<span class="id"><a href="GlobDefs.html#FLists.init_flist_content">init_flist_content</a></span> <span class="id"><a href="GlobDefs.html#base">base</a></span> <span class="id"><a href="GlobDefs.html#f2">f2</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5954')">Proof.</div>
<div class="proofscript" id="proof5954">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">constructor</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#FLists.init_flist_content">init_flist_content</a></span>, <span class="id"><a href="GlobDefs.html#FLists.fid_to_freelist_func">fid_to_freelist_func</a></span>. <span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id"><a href="GlobDefs.html#FLists.freelist_func_stream_eq">freelist_func_stream_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> ((<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.to_nat">Pos.to_nat</a></span> <span class="id">f1</span> - 1 + (<span class="id">n1</span> + 0) + 2) * (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.to_nat">Pos.to_nat</a></span> <span class="id">f1</span> - 1 + (<span class="id">n1</span> + 0) + 1) / 2 - (<span class="id">n1</span> + 0))%<span class="id">nat</span> <span class="kwd">as</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> ((<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.to_nat">Pos.to_nat</a></span> <span class="id">f2</span> - 1 + (<span class="id">n2</span> + 0) + 2) * (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.to_nat">Pos.to_nat</a></span> <span class="id">f2</span> - 1 + (<span class="id">n2</span> + 0) + 1) / 2 - (<span class="id">n2</span> + 0))%<span class="id">nat</span> <span class="kwd">as</span> <span class="id">y</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.add_0_r">Nat.add_0_r</a></span> <span class="kwd">in</span> <span class="id">Heqx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.add_0_r">Nat.add_0_r</a></span> <span class="kwd">in</span> <span class="id">Heqy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">x</span> &gt; 0)%<span class="id">nat</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">subst</span>. <span class="tactic">clear</span>. <span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="GlobDefs.html#FLists.arith_result2">arith_result2</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.to_nat">Pos.to_nat</a></span> <span class="id">f1</span> - 1) <span class="id">n1</span>). <span class="tactic">omega</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">y</span> &gt; 0)%<span class="id">nat</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">subst</span>. <span class="tactic">clear</span>. <span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="GlobDefs.html#FLists.arith_result2">arith_result2</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.to_nat">Pos.to_nat</a></span> <span class="id">f2</span> - 1) <span class="id">n2</span>). <span class="tactic">omega</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">tmp1</span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>, (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.to_nat">Pos.to_nat</a></span> <span class="id"><a href="GlobDefs.html#x">x</a></span> - 1)%<span class="id">nat</span> = (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.to_nat">Pos.to_nat</a></span> <span class="id"><a href="GlobDefs.html#y">y</a></span> - 1)%<span class="id">nat</span> -&gt; <span class="id"><a href="GlobDefs.html#x">x</a></span> = <span class="id"><a href="GlobDefs.html#y">y</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">clear</span>. <span class="tactic">intros</span>. <span class="id">lia</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">x</span> &lt;&gt; <span class="id">y</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id"><a href="GlobDefs.html#FLists.arith_result1">arith_result1</a></span>. <span class="id">left</span>. <span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id">H</span>. <span class="tactic">clear</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id">tmp1</span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Heqx</span> <span class="id">Heqy</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">tmp</span>: <span class="kwd">forall</span> <span class="id">a</span> <span class="id">b</span> <span class="id">c</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>, (<span class="id"><a href="GlobDefs.html#a">a</a></span> + <span class="id"><a href="GlobDefs.html#c">c</a></span> - 1)%<span class="id">positive</span> = (<span class="id"><a href="GlobDefs.html#b">b</a></span> + <span class="id"><a href="GlobDefs.html#c">c</a></span> - 1)%<span class="id">positive</span> -&gt; <span class="id"><a href="GlobDefs.html#a">a</a></span> = <span class="id"><a href="GlobDefs.html#b">b</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">clear</span>. <span class="tactic">intros</span>. <span class="tactic">rewrite</span> &lt;- (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.add_cancel_r">Pos.add_cancel_r</a></span> <span class="id">_</span> <span class="id">_</span> 1) <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.sub_add">Pos.sub_add</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="id">lia</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">tmp</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">clear</span> <span class="id">tmp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H2</span>. <span class="tactic">clear</span> <span class="id">H2</span> <span class="id">tmp1</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.Pnat.html#Nat2Pos.inj_compare">Nat2Pos.inj_compare</a></span> <span class="id">x</span> <span class="id">y</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.compare_eq_iff">Pos.compare_eq_iff</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.compare_eq_iff">Nat.compare_eq_iff</a></span>. <span class="tactic">apply</span> <span class="id">H2</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="FLists.tid_to_fid_stream">tid_to_fid_stream</a></span> (<span class="id">i</span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span>) (<span class="id">n</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) : <span class="id"><a href="GlobDefs.html#fid">fid</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span>: <span class="id">row</span> := (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.to_nat">Pos.to_nat</a></span> <span class="id"><a href="GlobDefs.html#i">i</a></span> - 1)%<span class="id">nat</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span>: <span class="id">col</span> := <span class="id"><a href="GlobDefs.html#n">n</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.of_nat">Pos.of_nat</a></span> ((<span class="id">row</span> + <span class="id">col</span> + 2) * (<span class="id">row</span> + <span class="id">col</span> + 1) / 2 - <span class="id">col</span>)%<span class="id">nat</span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="FLists.tid_to_fid_stream_disj">tid_to_fid_stream_disj</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">i1</span> <span class="id">i2</span> <span class="id">n1</span> <span class="id">n2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#i1">i1</a></span> &lt;&gt; <span class="id"><a href="GlobDefs.html#i2">i2</a></span> \/ <span class="id"><a href="GlobDefs.html#n1">n1</a></span> &lt;&gt; <span class="id"><a href="GlobDefs.html#n2">n2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#FLists.tid_to_fid_stream">tid_to_fid_stream</a></span> <span class="id"><a href="GlobDefs.html#i1">i1</a></span> <span class="id"><a href="GlobDefs.html#n1">n1</a></span> &lt;&gt; <span class="id"><a href="GlobDefs.html#FLists.tid_to_fid_stream">tid_to_fid_stream</a></span> <span class="id"><a href="GlobDefs.html#i2">i2</a></span> <span class="id"><a href="GlobDefs.html#n2">n2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5955')">Proof.</div>
<div class="proofscript" id="proof5955">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#FLists.tid_to_fid_stream">tid_to_fid_stream</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> ((<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.to_nat">Pos.to_nat</a></span> <span class="id">i1</span> - 1 &lt;&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.to_nat">Pos.to_nat</a></span> <span class="id">i2</span> - 1)%<span class="id">nat</span> \/ <span class="id">n1</span> &lt;&gt; <span class="id">n2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">auto</span>. <span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.compare_eq_iff">Pos.compare_eq_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.Pnat.html#Pos2Nat.inj_compare">Pos2Nat.inj_compare</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.compare_eq_iff">Nat.compare_eq_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lia</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#FLists.arith_result1">arith_result1</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.Pnat.html#Nat2Pos.inj_iff">Nat2Pos.inj_iff</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="GlobDefs.html#FLists.arith_result2">arith_result2</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.to_nat">Pos.to_nat</a></span> <span class="id">i1</span> - 1)%<span class="id">nat</span> <span class="id">n1</span>). <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="GlobDefs.html#FLists.arith_result2">arith_result2</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.to_nat">Pos.to_nat</a></span> <span class="id">i2</span> - 1)%<span class="id">nat</span> <span class="id">n2</span>). <span class="id">lia</span>.    <br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="FLists.init">init</a></span>: <span class="id"><a href="Values.html#block">block</a></span> -&gt; <span class="id"><a href="GlobDefs.html#FLists.t">t</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">base</span> : <span class="id"><a href="Values.html#block">block</a></span> =&gt; <span class="id"><a href="GlobDefs.html#FLists.Build_t">Build_t</a></span> (<span class="id"><a href="GlobDefs.html#FLists.init_flist_content">init_flist_content</a></span> <span class="id"><a href="GlobDefs.html#base">base</a></span>) <span class="id"><a href="GlobDefs.html#FLists.tid_to_fid_stream">tid_to_fid_stream</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Theorem</span> <span class="id"><a name="FLists.init_wd">init_wd</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span>, <span class="id"><a href="GlobDefs.html#FLists.wd">wd</a></span> (<span class="id"><a href="GlobDefs.html#FLists.init">init</a></span> <span class="id"><a href="GlobDefs.html#b">b</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5956')">Proof.</div>
<div class="proofscript" id="proof5956">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#FLists.init">init</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;norep&nbsp;in&nbsp;freelists&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="GlobDefs.html#FLists.init_freelist_norep">init_freelist_norep</a></span>.<br/>
&nbsp;norep&nbsp;among&nbsp;freelists&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="GlobDefs.html#FLists.init_freelist_disj">init_freelist_disj</a></span>.<br/>
&nbsp;norep&nbsp;in&nbsp;thread's&nbsp;freelist&nbsp;stream&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="GlobDefs.html#FLists.tid_to_fid_stream_disj">tid_to_fid_stream_disj</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="GlobDefs.html#FLists.tid_to_fid_stream_disj">tid_to_fid_stream_disj</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="FLists.get_block">get_block</a></span> (<span class="id">fl</span>: <span class="id"><a href="MemAux.html#freelist">freelist</a></span>) (<span class="id">n</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) : <span class="id"><a href="Values.html#block">block</a></span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Str_nth">Str_nth</a></span> <span class="id"><a href="GlobDefs.html#n">n</a></span> <span class="id"><a href="GlobDefs.html#fl">fl</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="FLists.get_fl">get_fl</a></span> (<span class="id">x</span>: <span class="id"><a href="GlobDefs.html#FLists.t">t</a></span>) (<span class="id">f</span>:<span class="id"><a href="GlobDefs.html#fid">fid</a></span>) : <span class="id"><a href="MemAux.html#freelist">freelist</a></span> := <span class="id"><a href="GlobDefs.html#x">x</a></span>.(<span class="id"><a href="GlobDefs.html#FLists.flist_content">flist_content</a></span>) <span class="id"><a href="GlobDefs.html#f">f</a></span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="FLists.get_tfid">get_tfid</a></span> (<span class="id">x</span>: <span class="id"><a href="GlobDefs.html#FLists.t">t</a></span>) (<span class="id">i</span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span>) (<span class="id">n</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) : <span class="id"><a href="GlobDefs.html#fid">fid</a></span> := (<span class="id"><a href="GlobDefs.html#x">x</a></span>.(<span class="id"><a href="GlobDefs.html#FLists.thread_flmap">thread_flmap</a></span>) <span class="id"><a href="GlobDefs.html#i">i</a></span> <span class="id"><a href="GlobDefs.html#n">n</a></span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="FLists.get_tfl">get_tfl</a></span> (<span class="id">x</span>: <span class="id"><a href="GlobDefs.html#FLists.t">t</a></span>) (<span class="id">i</span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span>) (<span class="id">n</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) : <span class="id"><a href="MemAux.html#freelist">freelist</a></span> := <span class="id"><a href="GlobDefs.html#FLists.get_fl">get_fl</a></span> <span class="id"><a href="GlobDefs.html#x">x</a></span> (<span class="id"><a href="GlobDefs.html#FLists.get_tfid">get_tfid</a></span> <span class="id"><a href="GlobDefs.html#x">x</a></span> <span class="id"><a href="GlobDefs.html#i">i</a></span> <span class="id"><a href="GlobDefs.html#n">n</a></span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="FLists.get_tfblock">get_tfblock</a></span> (<span class="id">x</span>: <span class="id"><a href="GlobDefs.html#FLists.t">t</a></span>) (<span class="id">i</span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span>) (<span class="id">n</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) (<span class="id">bid</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) : <span class="id"><a href="Values.html#block">block</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#FLists.get_block">get_block</a></span> (<span class="id"><a href="GlobDefs.html#FLists.get_tfl">get_tfl</a></span> <span class="id"><a href="GlobDefs.html#x">x</a></span> <span class="id"><a href="GlobDefs.html#i">i</a></span> <span class="id"><a href="GlobDefs.html#n">n</a></span>) <span class="id"><a href="GlobDefs.html#bid">bid</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="FLists.bbelongsto">bbelongsto</a></span> (<span class="id">x</span>: <span class="id"><a href="GlobDefs.html#FLists.t">t</a></span>) (<span class="id">i</span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span>) (<span class="id">b</span>: <span class="id"><a href="Values.html#block">block</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">n</span> <span class="id">bid</span>, <span class="id"><a href="GlobDefs.html#FLists.get_tfblock">get_tfblock</a></span> <span class="id"><a href="GlobDefs.html#x">x</a></span> <span class="id"><a href="GlobDefs.html#i">i</a></span> <span class="id"><a href="GlobDefs.html#n">n</a></span> <span class="id"><a href="GlobDefs.html#bid">bid</a></span> = <span class="id"><a href="GlobDefs.html#b">b</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="FLists.fbelongsto">fbelongsto</a></span> (<span class="id">x</span>: <span class="id"><a href="GlobDefs.html#FLists.t">t</a></span>) (<span class="id">i</span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span>) (<span class="id">f</span>: <span class="id"><a href="GlobDefs.html#fid">fid</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">n</span>, <span class="id"><a href="GlobDefs.html#FLists.get_tfid">get_tfid</a></span> <span class="id"><a href="GlobDefs.html#x">x</a></span> <span class="id"><a href="GlobDefs.html#i">i</a></span> <span class="id"><a href="GlobDefs.html#n">n</a></span> = <span class="id"><a href="GlobDefs.html#f">f</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="FLists.bbelongstof">bbelongstof</a></span> (<span class="id">x</span>: <span class="id"><a href="GlobDefs.html#FLists.t">t</a></span>) (<span class="id">f</span>: <span class="id"><a href="GlobDefs.html#fid">fid</a></span>) (<span class="id">b</span>: <span class="id"><a href="Values.html#block">block</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">n</span>, <span class="id"><a href="GlobDefs.html#FLists.get_block">get_block</a></span> (<span class="id"><a href="GlobDefs.html#FLists.get_fl">get_fl</a></span> <span class="id"><a href="GlobDefs.html#x">x</a></span> <span class="id"><a href="GlobDefs.html#f">f</a></span>) <span class="id"><a href="GlobDefs.html#n">n</a></span> = <span class="id"><a href="GlobDefs.html#b">b</a></span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Theorem</span> <span class="id"><a name="FLists.freelist_norepeat">freelist_norepeat</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">f</span>, <span class="id"><a href="GlobDefs.html#FLists.wd">wd</a></span> <span class="id"><a href="GlobDefs.html#x">x</a></span> -&gt; <span class="id"><a href="MemAux.html#norep">norep</a></span> (<span class="id"><a href="GlobDefs.html#FLists.flist_content">flist_content</a></span> <span class="id"><a href="GlobDefs.html#x">x</a></span> <span class="id"><a href="GlobDefs.html#f">f</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5957')">Proof.</div>
<div class="proofscript" id="proof5957">
 <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="GlobDefs.html#FLists.flist_norep">flist_norep</a></span>. <span class="tactic">auto</span>. Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Theorem</span> <span class="id"><a name="FLists.freelist_disjoint">freelist_disjoint</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">f1</span> <span class="id">f2</span>, <span class="id"><a href="GlobDefs.html#FLists.wd">wd</a></span> <span class="id"><a href="GlobDefs.html#x">x</a></span> -&gt; <span class="id"><a href="GlobDefs.html#f1">f1</a></span> &lt;&gt; <span class="id"><a href="GlobDefs.html#f2">f2</a></span> -&gt; <span class="id"><a href="MemAux.html#disj">disj</a></span> (<span class="id"><a href="GlobDefs.html#FLists.flist_content">flist_content</a></span> <span class="id"><a href="GlobDefs.html#x">x</a></span> <span class="id"><a href="GlobDefs.html#f1">f1</a></span>) (<span class="id"><a href="GlobDefs.html#FLists.flist_content">flist_content</a></span> <span class="id"><a href="GlobDefs.html#x">x</a></span> <span class="id"><a href="GlobDefs.html#f2">f2</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5958')">Proof.</div>
<div class="proofscript" id="proof5958">
 <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="GlobDefs.html#FLists.flist_disj">flist_disj</a></span>; <span class="tactic">auto</span>. Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Theorem</span> <span class="id"><a name="FLists.thread_freelist_norepeat">thread_freelist_norepeat</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">i</span> <span class="id">nf</span>, <span class="id"><a href="GlobDefs.html#FLists.wd">wd</a></span> <span class="id"><a href="GlobDefs.html#x">x</a></span> -&gt; <span class="id"><a href="MemAux.html#norep">norep</a></span> (<span class="id"><a href="GlobDefs.html#FLists.get_tfl">get_tfl</a></span> <span class="id"><a href="GlobDefs.html#x">x</a></span> <span class="id"><a href="GlobDefs.html#i">i</a></span> <span class="id"><a href="GlobDefs.html#nf">nf</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5959')">Proof.</div>
<div class="proofscript" id="proof5959">
 <span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id"><a href="GlobDefs.html#FLists.flist_norep">flist_norep</a></span>; <span class="tactic">auto</span>. Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Theorem</span> <span class="id"><a name="FLists.thread_freelist_disj">thread_freelist_disj</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">i1</span> <span class="id">i2</span> <span class="id">nf1</span> <span class="id">nf2</span>, <span class="id"><a href="GlobDefs.html#FLists.wd">wd</a></span> <span class="id"><a href="GlobDefs.html#x">x</a></span> -&gt; <span class="id"><a href="GlobDefs.html#i1">i1</a></span> &lt;&gt; <span class="id"><a href="GlobDefs.html#i2">i2</a></span> -&gt; <span class="id"><a href="MemAux.html#disj">disj</a></span> (<span class="id"><a href="GlobDefs.html#FLists.get_tfl">get_tfl</a></span> <span class="id"><a href="GlobDefs.html#x">x</a></span> <span class="id"><a href="GlobDefs.html#i1">i1</a></span> <span class="id"><a href="GlobDefs.html#nf1">nf1</a></span>) (<span class="id"><a href="GlobDefs.html#FLists.get_tfl">get_tfl</a></span> <span class="id"><a href="GlobDefs.html#x">x</a></span> <span class="id"><a href="GlobDefs.html#i2">i2</a></span> <span class="id"><a href="GlobDefs.html#nf2">nf2</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5960')">Proof.</div>
<div class="proofscript" id="proof5960">
 <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="GlobDefs.html#FLists.flist_disj">flist_disj</a></span>. <span class="tactic">auto</span>. <span class="tactic">apply</span> (<span class="id"><a href="GlobDefs.html#FLists.thread_fl_disj">thread_fl_disj</a></span> <span class="id">x</span>); <span class="tactic">auto</span>. Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="GlobDefs.html#FLists">FLists</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
<br/>
<h2> The global environment for all modules </h2>
<div class="doc">The environment consists of the runtime ModSems of each module and 
    pre-allocated freelists </div>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="GlobEnv">GlobEnv</a></span>.<br/>
<br/>
<div class="doc">- <span class="bracket"><span class="id">M</span></span> : number of modules </div>
<div class="doc">- <span class="bracket"><span class="id">modules</span></span> : runtime ModSems, which is original module instrumented with initialized module's runtime environments </div>
<div class="doc">- <span class="bracket"><span class="id">ge_bound</span></span> : the bound for blocks bound to global definitions </div>
<div class="doc">- <span class="bracket"><span class="id">freelists</span></span> : the initialized freelists for runtime <span class="bracket"><span class="id">Core.t</span></span>s </div>
&nbsp;&nbsp;<span class="kwd">Record</span> <span class="id"><a name="GlobEnv.t">t</a></span>: <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="GlobEnv.M">M</a></span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="GlobEnv.modules">modules</a></span>: '<span class="id">I_M</span> -&gt; <span class="id"><a href="InteractionSemantics.html#ModSem.t">ModSem.t</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="GlobEnv.get_mod">get_mod</a></span>: <span class="id"><a href="AST.html#ident">ident</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> '<span class="id">I_M</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="GlobEnv.ge_bound">ge_bound</a></span>: <span class="id"><a href="Values.html#block">block</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="GlobEnv.freelists">freelists</a></span>: <span class="id"><a href="GlobDefs.html#FLists.t">FLists.t</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Record</span> <span class="id"><a name="GlobEnv.wd">wd</a></span> (<span class="id">GE</span>: <span class="id"><a href="GlobDefs.html#GlobEnv.t">t</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="GlobEnv.wd_fl">wd_fl</a></span>: <span class="id"><a href="GlobDefs.html#FLists.wd">FLists.wd</a></span> <span class="id"><a href="GlobDefs.html#GE">GE</a></span>.(<span class="id"><a href="GlobDefs.html#GlobEnv.freelists">freelists</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<br/>
<div class="doc">Global environments are disjoint. I.e., function/global variables of different modules 
          are bounded to disjoint memory blocks </div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="GlobEnv.ge_inj">ge_inj</a></span>: <span class="kwd">forall</span> (<span class="id">i1</span> <span class="id">i2</span>: '<span class="id">I_</span>(<span class="id"><a href="GlobDefs.html#GlobEnv.M">M</a></span> <span class="id"><a href="GlobDefs.html#GE">GE</a></span>)) <span class="id">Mod1</span> <span class="id">Mod2</span> <span class="id">id1</span> <span class="id">id2</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eq">Nat.eq</a></span> <span class="id"><a href="GlobDefs.html#i1">i1</a></span> <span class="id"><a href="GlobDefs.html#i2">i2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GlobDefs.html#GlobEnv.modules">modules</a></span> <span class="id"><a href="GlobDefs.html#GE">GE</a></span>) <span class="id"><a href="GlobDefs.html#i1">i1</a></span> = <span class="id"><a href="GlobDefs.html#Mod1">Mod1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GlobDefs.html#GlobEnv.modules">modules</a></span> <span class="id"><a href="GlobDefs.html#GE">GE</a></span>) <span class="id"><a href="GlobDefs.html#i2">i2</a></span> = <span class="id"><a href="GlobDefs.html#Mod2">Mod2</a></span> -&gt;          <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span>: <span class="id">ge1</span> := <span class="id"><a href="InteractionSemantics.html#ModSem.ge">ModSem.ge</a></span> <span class="id"><a href="GlobDefs.html#Mod1">Mod1</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span>: <span class="id">ge2</span> := <span class="id"><a href="InteractionSemantics.html#ModSem.ge">ModSem.ge</a></span> <span class="id"><a href="GlobDefs.html#Mod2">Mod2</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Globalenvs.html#Genv.find_symbol">Genv.find_symbol</a></span> <span class="id">ge1</span> <span class="id"><a href="GlobDefs.html#id1">id1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="GlobDefs.html#b">b</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Globalenvs.html#Genv.find_symbol">Genv.find_symbol</a></span> <span class="id">ge2</span> <span class="id"><a href="GlobDefs.html#id2">id2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="GlobDefs.html#b">b</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#id1">id1</a></span> = <span class="id"><a href="GlobDefs.html#id2">id2</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<br/>
<div class="doc">Global environments are consistent. I.e., same ident is mapped to the same block in 
          all <span class="bracket"><span class="id">ge</span></span>s </div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="GlobEnv.ge_consist">ge_consist</a></span>: <span class="kwd">forall</span> (<span class="id">i1</span> <span class="id">i2</span>: '<span class="id">I_</span>(<span class="id"><a href="GlobDefs.html#GlobEnv.M">M</a></span> <span class="id"><a href="GlobDefs.html#GE">GE</a></span>)) <span class="id">Mod1</span> <span class="id">Mod2</span> <span class="id">id</span> <span class="id">b1</span> <span class="id">b2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GlobDefs.html#GlobEnv.modules">modules</a></span> <span class="id"><a href="GlobDefs.html#GE">GE</a></span>) <span class="id"><a href="GlobDefs.html#i1">i1</a></span> = <span class="id"><a href="GlobDefs.html#Mod1">Mod1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GlobDefs.html#GlobEnv.modules">modules</a></span> <span class="id"><a href="GlobDefs.html#GE">GE</a></span>) <span class="id"><a href="GlobDefs.html#i2">i2</a></span> = <span class="id"><a href="GlobDefs.html#Mod2">Mod2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span>: <span class="id">ge1</span> := <span class="id"><a href="InteractionSemantics.html#ModSem.ge">ModSem.ge</a></span> <span class="id"><a href="GlobDefs.html#Mod1">Mod1</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span>: <span class="id">ge2</span> := <span class="id"><a href="InteractionSemantics.html#ModSem.ge">ModSem.ge</a></span> <span class="id"><a href="GlobDefs.html#Mod2">Mod2</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Globalenvs.html#Genv.find_symbol">Genv.find_symbol</a></span> <span class="id">ge1</span> <span class="id"><a href="GlobDefs.html#id">id</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="GlobDefs.html#b1">b1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Globalenvs.html#Genv.find_symbol">Genv.find_symbol</a></span> <span class="id">ge2</span> <span class="id"><a href="GlobDefs.html#id">id</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="GlobDefs.html#b2">b2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#b1">b1</a></span> = <span class="id"><a href="GlobDefs.html#b2">b2</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<br/>
<div class="doc">genv_next of global environments eq to ge_bound </div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="GlobEnv.ge_bound_consist">ge_bound_consist</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">i</span> <span class="id">Mod</span>, <span class="id"><a href="GlobDefs.html#GlobEnv.modules">modules</a></span> <span class="id"><a href="GlobDefs.html#GE">GE</a></span> <span class="id"><a href="GlobDefs.html#i">i</a></span> = <span class="id"><a href="GlobDefs.html#Mod">Mod</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span>: <span class="id">ge</span> := <span class="id"><a href="InteractionSemantics.html#ModSem.ge">ModSem.ge</a></span> <span class="id"><a href="GlobDefs.html#Mod">Mod</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Globalenvs.html#Genv.genv_next">Genv.genv_next</a></span> <span class="id">ge</span> = <span class="id"><a href="GlobDefs.html#GlobEnv.ge_bound">ge_bound</a></span> <span class="id"><a href="GlobDefs.html#GE">GE</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
<div class="doc">No conflict definitions.
          <span class="bracket"><span class="id">TODO</span></span> is it necessary?
       </div>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="GlobEnv.det">det</a></span> (<span class="id">GE</span>: <span class="id"><a href="GlobDefs.html#GlobEnv.t">t</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ix</span>, <span class="id"><a href="InteractionSemantics.html#mod_det">mod_det</a></span> (<span class="id"><a href="GlobDefs.html#GlobEnv.modules">modules</a></span> <span class="id"><a href="GlobDefs.html#GE">GE</a></span> <span class="id"><a href="GlobDefs.html#ix">ix</a></span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="GlobEnv.mods_wd">mods_wd</a></span> (<span class="id">GE</span>: <span class="id"><a href="GlobDefs.html#GlobEnv.t">t</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ix</span>, <span class="id"><a href="InteractionSemantics.html#mod_wd">mod_wd</a></span> (<span class="id"><a href="GlobDefs.html#GlobEnv.modules">modules</a></span> <span class="id"><a href="GlobDefs.html#GE">GE</a></span> <span class="id"><a href="GlobDefs.html#ix">ix</a></span>).<br/>
&nbsp;&nbsp;<br/>
<div class="doc">The <span class="bracket"><span class="id">GE</span></span> is properly initialized from <span class="bracket"><span class="id">cus</span></span> if <span class="bracket"><span class="id">init</span> <span class="id">cus</span> <span class="id">GE</span></span> </div>
&nbsp;&nbsp;<span class="kwd">Record</span> <span class="id"><a name="GlobEnv.init">init</a></span> {<span class="id">NL</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>} {<span class="id">L</span>: @<span class="id"><a href="GAST.html#langs">langs</a></span> <span class="id"><a href="GlobDefs.html#NL">NL</a></span>} (<span class="id">cus</span>: <span class="id"><a href="GAST.html#cunits">cunits</a></span> <span class="id"><a href="GlobDefs.html#L">L</a></span>) (<span class="id">GE</span>: <span class="id"><a href="GlobDefs.html#GlobEnv.t">t</a></span>): <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
<div class="doc">Amount of runtime semantic modules is equal to amount of compilation units </div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="GlobEnv.mod_num">mod_num</a></span>: (<span class="id"><a href="GlobDefs.html#GlobEnv.M">M</a></span> <span class="id"><a href="GlobDefs.html#GE">GE</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="GlobDefs.html#cus">cus</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<br/>
<div class="doc">All runtime semantic modules (<span class="bracket"><span class="id">ModSem.t</span></span>) are properly initialized w.r.t. its language</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="GlobEnv.ge_init">ge_init</a></span>: <span class="kwd">forall</span> (<span class="id">i</span>: '<span class="id">I_</span>(<span class="id"><a href="GlobDefs.html#GlobEnv.M">M</a></span> <span class="id"><a href="GlobDefs.html#GE">GE</a></span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> <span class="id">cui</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id"><a href="GlobDefs.html#cus">cus</a></span> <span class="id"><a href="GlobDefs.html#i">i</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="GlobDefs.html#cui">cui</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span>: <span class="id">Mod</span>:= (<span class="id"><a href="GlobDefs.html#GlobEnv.modules">modules</a></span> <span class="id"><a href="GlobDefs.html#GE">GE</a></span>) <span class="id"><a href="GlobDefs.html#i">i</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#ModSem.init_modsem">ModSem.init_modsem</a></span> (<span class="id"><a href="GlobDefs.html#L">L</a></span> (<span class="id"><a href="GAST.html#lid">lid</a></span> <span class="id"><a href="GlobDefs.html#L">L</a></span> <span class="id"><a href="GlobDefs.html#cui">cui</a></span>)) (<span class="id"><a href="GAST.html#cu">cu</a></span> <span class="id"><a href="GlobDefs.html#L">L</a></span> <span class="id"><a href="GlobDefs.html#cui">cui</a></span>) <span class="id">Mod</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<br/>
<div class="doc">No conflict definitions.
          <span class="bracket"><span class="id">TODO</span></span> is it necessary?
       </div>
<div class="doc">Domain of <span class="bracket"><span class="id">get_mod</span></span> contains all internal functions </div>
<div class="doc">since get_mod is a function, 
          wd implies internal function sets of
          different cunits are disjoint. </div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="GlobEnv.get_mod_init">get_mod_init</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">id</span> <span class="id">mid</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GlobDefs.html#GlobEnv.get_mod">get_mod</a></span> <span class="id"><a href="GlobDefs.html#GE">GE</a></span> <span class="id"><a href="GlobDefs.html#id">id</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="GlobDefs.html#mid">mid</a></span> &lt;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (@<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_left">fold_left</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> * (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)) (<span class="id"><a href="GAST.html#cunit">cunit</a></span> <span class="id"><a href="GlobDefs.html#L">L</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">ir</span> <span class="id">cui</span> =&gt; <span class="kwd">let</span> (<span class="id">i</span>, <span class="id">res</span>) := <span class="id"><a href="GlobDefs.html#ir">ir</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="GlobDefs.html#res">res</a></span> <span class="kwd">then</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id"><a href="GlobDefs.html#i">i</a></span>, <span class="id"><a href="GlobDefs.html#res">res</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="kwd">if</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In_dec">In_dec</a></span> <span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id"><a href="GlobDefs.html#id">id</a></span> (<span class="id"><a href="InteractionSemantics.html#internal_fn">internal_fn</a></span> (<span class="id"><a href="GlobDefs.html#L">L</a></span> (<span class="id"><a href="GAST.html#lid">lid</a></span> <span class="id"><a href="GlobDefs.html#L">L</a></span> <span class="id"><a href="GlobDefs.html#cui">cui</a></span>)) (<span class="id"><a href="GAST.html#cu">cu</a></span> <span class="id"><a href="GlobDefs.html#L">L</a></span> <span class="id"><a href="GlobDefs.html#cui">cui</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id"><a href="GlobDefs.html#i">i</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="GlobDefs.html#i">i</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id"><a href="GlobDefs.html#i">i</a></span>, <span class="id"><a href="GlobDefs.html#res">res</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#cus">cus</a></span> (0%<span class="id">nat</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">nat_of_ord</span> <span class="id"><a href="GlobDefs.html#mid">mid</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="GlobEnv.ge_wd">ge_wd</a></span>: <span class="id"><a href="GlobDefs.html#GlobEnv.wd">wd</a></span> <span class="id"><a href="GlobDefs.html#GE">GE</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="GlobEnv.init_mem">init_mem</a></span>: <span class="id"><a href="GlobDefs.html#GlobEnv.t">t</a></span> -&gt; <span class="id"><a href="GMemory.html#gmem">gmem</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="GlobEnv.Init_mem">Init_mem</a></span> : <span class="kwd">forall</span> <span class="id">GE</span> <span class="id">gm</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">i</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span>: <span class="id">Mod</span> := <span class="id"><a href="GlobDefs.html#GlobEnv.modules">modules</a></span> <span class="id"><a href="GlobDefs.html#GE">GE</a></span> <span class="id"><a href="GlobDefs.html#i">i</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span>: <span class="id">l</span> := <span class="id"><a href="InteractionSemantics.html#ModSem.lang">ModSem.lang</a></span> <span class="id">Mod</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span>: <span class="id">ge</span> := <span class="id"><a href="InteractionSemantics.html#ModSem.ge">ModSem.ge</a></span> <span class="id">Mod</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#init_gmem">init_gmem</a></span> <span class="id">l</span> <span class="id">ge</span> <span class="id"><a href="GlobDefs.html#gm">gm</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">fi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="MemAux.html#no_overlap">no_overlap</a></span> (<span class="id"><a href="GlobDefs.html#FLists.get_fl">FLists.get_fl</a></span> (<span class="id"><a href="GlobDefs.html#GlobEnv.freelists">freelists</a></span> <span class="id"><a href="GlobDefs.html#GE">GE</a></span>) <span class="id"><a href="GlobDefs.html#fi">fi</a></span>) (<span class="id"><a href="MemAux.html#valid_block_bset">valid_block_bset</a></span> <span class="id"><a href="GlobDefs.html#gm">gm</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#init_mem">init_mem</a></span> <span class="id"><a href="GlobDefs.html#GE">GE</a></span> <span class="id"><a href="GlobDefs.html#gm">gm</a></span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="GlobDefs.html#GlobEnv">GlobEnv</a></span>.<br/>
<br/>
<br/>
<br/>
<h2>  <span class="bracket"><span class="id">Core.t</span></span> </h2>
<div class="doc">
    The type <span class="bracket"><span class="id">Core.t</span></span> gives runtime states of dynamic module invocations. 
<ul>
<li>
 <span class="bracket"><span class="id">i</span> : '<span class="id">I_N</span></span>:
      A natural between <span class="bracket">0..<span class="id">n</span>-1</span> that maps this core back to the
      translation unit numbered <span class="bracket"><span class="id">i</span></span> from which it was invoked. 
</li>
<li>
 <span class="bracket"><span class="id">c</span> : (<span class="id">cores</span> <span class="id">i</span>).(<span class="id">C</span>)</span>:
      Runtime states of module <span class="bracket"><span class="id">i</span></span>. 
</li>
<li>
 <span class="bracket"><span class="id">sg</span> : <span class="id">signature</span></span>:
      Type signature of the function that this core was spawned to handle. 
</li>
<li>
 <span class="bracket"><span class="id">F</span> : <span class="id">fid</span></span>:
      the freelist assigned to this runtime core.
</li>
</ul>
</div>
<div class="doc">
    A <span class="bracket"><span class="id">Core</span></span> is a runtime local state of some core semantics, 
    including module id and the signature of the function spawning the core 
</div>
<span class="kwd">Module</span> <span class="id"><a name="Core">Core</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id"><a name="Core.Core">Core</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">ge</span>: <span class="id"><a href="GlobDefs.html#GlobEnv.t">GlobEnv.t</a></span>}.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Record</span> <span class="id"><a name="Core.t">t</a></span> : <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="Core.i">i</a></span> : '<span class="id">I_ge</span>.(<span class="id"><a href="GlobDefs.html#GlobEnv.M">GlobEnv.M</a></span>);<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="Core.c">c</a></span> : (<span class="id"><a href="GlobDefs.html#Core.Core.ge">ge</a></span>.(<span class="id"><a href="GlobDefs.html#GlobEnv.modules">GlobEnv.modules</a></span>) <span class="id"><a href="GlobDefs.html#i">i</a></span>).(<span class="id"><a href="InteractionSemantics.html#ModSem.lang">ModSem.lang</a></span>).(<span class="id"><a href="InteractionSemantics.html#core">core</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="Core.sg">sg</a></span> : <span class="id"><a href="AST.html#signature">signature</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="Core.F">F</a></span> : <span class="id"><a href="GlobDefs.html#fid">fid</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="Core.update">update</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">x</span>: <span class="id"><a href="GlobDefs.html#Core.t">t</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">c</span>': (<span class="id"><a href="GlobDefs.html#Core.Core.ge">ge</a></span>.(<span class="id"><a href="GlobDefs.html#GlobEnv.modules">GlobEnv.modules</a></span>) <span class="id"><a href="GlobDefs.html#x">x</a></span>.(<span class="id"><a href="GlobDefs.html#Core.i">i</a></span>)).(<span class="id"><a href="InteractionSemantics.html#ModSem.lang">ModSem.lang</a></span>).(<span class="id"><a href="InteractionSemantics.html#core">core</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="GlobDefs.html#Core.t">t</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="Core.Update">Update</a></span>: <span class="kwd">forall</span> <span class="id">x</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">x</span>' = <span class="id"><a href="GlobDefs.html#Core.Build_t">Build_t</a></span> <span class="id">x</span>.(<span class="id"><a href="GlobDefs.html#Core.i">i</a></span>) <span class="id">c</span>' <span class="id">x</span>.(<span class="id"><a href="GlobDefs.html#Core.sg">sg</a></span>) <span class="id">x</span>.(<span class="id"><a href="GlobDefs.html#Core.F">F</a></span>) -&gt; <span class="id"><a href="GlobDefs.html#update">update</a></span> <span class="id">x</span> <span class="id">c</span>' <span class="id">x</span>'.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id"><a href="GlobDefs.html#Core.Core">Core</a></span>.<br/>
<span class="kwd">End</span> <span class="id"><a href="GlobDefs.html#Core">Core</a></span>.<br/>
<br/>
<br/>
<br/>
<h2> <span class="bracket"><span class="id">CallStack.t</span></span> </h2>
<div class="doc">The type <span class="bracket"><span class="id">CallStack.t</span></span> gives the thread runtime stack of spawned cores </div>
<span class="kwd">Module</span> <span class="id"><a name="CallStack">CallStack</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id"><a name="CallStack.CallStack">CallStack</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">ge</span>: <span class="id"><a href="GlobDefs.html#GlobEnv.t">GlobEnv.t</a></span>}.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="CallStack.t">t</a></span> : <span class="kwd">Type</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (@<span class="id"><a href="GlobDefs.html#Core.t">Core.t</a></span> <span class="id"><a href="GlobDefs.html#CallStack.CallStack.ge">ge</a></span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="CallStack.emp_cs">emp_cs</a></span> : <span class="id"><a href="GlobDefs.html#CallStack.t">t</a></span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="CallStack.push">push</a></span> (<span class="id">c</span>: <span class="id"><a href="GlobDefs.html#Core.t">Core.t</a></span>) (<span class="id">cs</span>: <span class="id"><a href="GlobDefs.html#CallStack.t">t</a></span>) : <span class="id"><a href="GlobDefs.html#CallStack.t">t</a></span> := <span class="id"><a href="GlobDefs.html#c">c</a></span> :: <span class="id"><a href="GlobDefs.html#cs">cs</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="CallStack.pop">pop</a></span> (<span class="id">cs</span>: <span class="id"><a href="GlobDefs.html#CallStack.t">t</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="GlobDefs.html#CallStack.t">t</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="GlobDefs.html#cs">cs</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">c</span> :: <span class="id">cs</span>' =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">cs</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="CallStack.top">top</a></span> (<span class="id">cs</span>: <span class="id"><a href="GlobDefs.html#CallStack.t">t</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="GlobDefs.html#Core.t">Core.t</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="GlobDefs.html#cs">cs</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">c</span> :: <span class="id">cs</span>' =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">c</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="CallStack.update">update</a></span> : <span class="id"><a href="GlobDefs.html#CallStack.t">t</a></span> -&gt; <span class="id"><a href="GlobDefs.html#Core.t">Core.t</a></span> -&gt; <span class="id"><a href="GlobDefs.html#CallStack.t">t</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="CallStack.Update">Update</a></span> : <span class="kwd">forall</span> <span class="id">c</span> <span class="id">cs</span> <span class="id">cc</span> <span class="id">c</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#Core.update">Core.update</a></span> <span class="id"><a href="GlobDefs.html#c">c</a></span> <span class="id"><a href="GlobDefs.html#cc">cc</a></span> <span class="id">c</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#update">update</a></span> (<span class="id"><a href="GlobDefs.html#c">c</a></span>::<span class="id"><a href="GlobDefs.html#cs">cs</a></span>) <span class="id">c</span>' (<span class="id">c</span>'::<span class="id"><a href="GlobDefs.html#cs">cs</a></span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="CallStack.is_emp">is_emp</a></span> (<span class="id">cs</span>: <span class="id"><a href="GlobDefs.html#CallStack.t">t</a></span>) : <span class="kwd">Prop</span> := <span class="id"><a href="GlobDefs.html#cs">cs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id"><a href="GlobDefs.html#CallStack.CallStack">CallStack</a></span>.<br/>
<span class="kwd">End</span> <span class="id"><a href="GlobDefs.html#CallStack">CallStack</a></span>.<br/>
<br/>
<h2> <span class="bracket"><span class="id">ThreadPool.t</span></span> </h2>
<div class="doc">The type <span class="bracket"><span class="id">ThreadPool.t</span></span> gives the threadpool definition </div>
<span class="kwd">Module</span> <span class="id"><a name="ThreadPool">ThreadPool</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id"><a name="ThreadPool.ThreadPool">ThreadPool</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">ge</span>: <span class="id"><a href="GlobDefs.html#GlobEnv.t">GlobEnv.t</a></span>}.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Record</span> <span class="id"><a name="ThreadPool.t">t</a></span> : <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="ThreadPool.content">content</a></span>: <span class="id"><a href="Maps.html#PMap.t">PMap.t</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> (@<span class="id"><a href="GlobDefs.html#CallStack.t">CallStack.t</a></span> <span class="id"><a href="GlobDefs.html#ThreadPool.ThreadPool.ge">ge</a></span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="ThreadPool.next_tid">next_tid</a></span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="ThreadPool.next_fmap">next_fmap</a></span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="ThreadPool.emp">emp</a></span>: <span class="id"><a href="GlobDefs.html#ThreadPool.t">t</a></span> := <span class="id"><a href="GlobDefs.html#ThreadPool.Build_t">Build_t</a></span> (<span class="id"><a href="Maps.html#PMap.init">PMap.init</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>) 1%<span class="id">positive</span> (<span class="kwd">fun</span> <span class="id">_</span> =&gt; 0%<span class="id">nat</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="ThreadPool.spawn">spawn</a></span> (<span class="id">thdp</span>: <span class="id"><a href="GlobDefs.html#ThreadPool.t">t</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">mid</span>: '<span class="id">I_</span>(<span class="id"><a href="GlobDefs.html#GlobEnv.M">GlobEnv.M</a></span> <span class="id"><a href="GlobDefs.html#ThreadPool.ThreadPool.ge">ge</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">c</span>: <span class="id"><a href="InteractionSemantics.html#core">core</a></span> (<span class="id"><a href="InteractionSemantics.html#ModSem.lang">ModSem.lang</a></span> (<span class="id"><a href="GlobDefs.html#GlobEnv.modules">GlobEnv.modules</a></span> <span class="id"><a href="GlobDefs.html#ThreadPool.ThreadPool.ge">ge</a></span> <span class="id"><a href="GlobDefs.html#mid">mid</a></span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">sg</span>: <span class="id"><a href="AST.html#signature">signature</a></span>) : <span class="id"><a href="GlobDefs.html#ThreadPool.t">t</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span>: <span class="id">nf</span> := (<span class="id"><a href="GlobDefs.html#thdp">thdp</a></span>.(<span class="id"><a href="GlobDefs.html#ThreadPool.next_fmap">next_fmap</a></span>) <span class="id"><a href="GlobDefs.html#thdp">thdp</a></span>.(<span class="id"><a href="GlobDefs.html#ThreadPool.next_tid">next_tid</a></span>)) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span>: <span class="id">f</span> := <span class="id"><a href="GlobDefs.html#FLists.get_tfid">FLists.get_tfid</a></span> (<span class="id"><a href="GlobDefs.html#GlobEnv.freelists">GlobEnv.freelists</a></span> <span class="id"><a href="GlobDefs.html#ThreadPool.ThreadPool.ge">ge</a></span>) (<span class="id"><a href="GlobDefs.html#thdp">thdp</a></span>.(<span class="id"><a href="GlobDefs.html#ThreadPool.next_tid">next_tid</a></span>)) <span class="id">nf</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span>: <span class="id">c</span> := <span class="id"><a href="GlobDefs.html#Core.Build_t">Core.Build_t</a></span> <span class="id"><a href="GlobDefs.html#mid">mid</a></span> <span class="id"><a href="GlobDefs.html#c">c</a></span> <span class="id"><a href="GlobDefs.html#sg">sg</a></span> <span class="id">f</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#ThreadPool.Build_t">Build_t</a></span> (<span class="id"><a href="Maps.html#PMap.set">PMap.set</a></span> <span class="id"><a href="GlobDefs.html#thdp">thdp</a></span>.(<span class="id"><a href="GlobDefs.html#ThreadPool.next_tid">next_tid</a></span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="GlobDefs.html#c">c</a></span>::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)) <span class="id"><a href="GlobDefs.html#thdp">thdp</a></span>.(<span class="id"><a href="GlobDefs.html#ThreadPool.content">content</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Psucc">Psucc</a></span> <span class="id"><a href="GlobDefs.html#thdp">thdp</a></span>.(<span class="id"><a href="GlobDefs.html#ThreadPool.next_tid">next_tid</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">i</span> =&gt; <span class="kwd">if</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id"><a href="GlobDefs.html#i">i</a></span> <span class="id"><a href="GlobDefs.html#thdp">thdp</a></span>.(<span class="id"><a href="GlobDefs.html#ThreadPool.next_tid">next_tid</a></span>) <span class="kwd">then</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> (<span class="id"><a href="GlobDefs.html#thdp">thdp</a></span>.(<span class="id"><a href="GlobDefs.html#ThreadPool.next_fmap">next_fmap</a></span>) <span class="id"><a href="GlobDefs.html#i">i</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="GlobDefs.html#thdp">thdp</a></span>.(<span class="id"><a href="GlobDefs.html#ThreadPool.next_fmap">next_fmap</a></span>) <span class="id"><a href="GlobDefs.html#i">i</a></span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="ThreadPool.push">push</a></span> (<span class="id">thdp</span>: <span class="id"><a href="GlobDefs.html#ThreadPool.t">t</a></span>) (<span class="id">i</span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">mid</span>: '<span class="id">I_</span>(<span class="id"><a href="GlobDefs.html#GlobEnv.M">GlobEnv.M</a></span> <span class="id"><a href="GlobDefs.html#ThreadPool.ThreadPool.ge">ge</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">c</span>: <span class="id"><a href="InteractionSemantics.html#core">core</a></span> (<span class="id"><a href="InteractionSemantics.html#ModSem.lang">ModSem.lang</a></span> (<span class="id"><a href="GlobDefs.html#GlobEnv.modules">GlobEnv.modules</a></span> <span class="id"><a href="GlobDefs.html#ThreadPool.ThreadPool.ge">ge</a></span> <span class="id"><a href="GlobDefs.html#mid">mid</a></span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">sg</span>: <span class="id"><a href="AST.html#signature">signature</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="GlobDefs.html#ThreadPool.t">t</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span>: <span class="id">ocs</span> := <span class="id"><a href="Maps.html#PMap.get">PMap.get</a></span> <span class="id"><a href="GlobDefs.html#i">i</a></span> <span class="id"><a href="GlobDefs.html#thdp">thdp</a></span>.(<span class="id"><a href="GlobDefs.html#ThreadPool.content">content</a></span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">ocs</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">cs</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span>: <span class="id">nf</span> := (<span class="id"><a href="GlobDefs.html#thdp">thdp</a></span>.(<span class="id"><a href="GlobDefs.html#ThreadPool.next_fmap">next_fmap</a></span>) <span class="id"><a href="GlobDefs.html#i">i</a></span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span>: <span class="id">f</span> := <span class="id"><a href="GlobDefs.html#FLists.get_tfid">FLists.get_tfid</a></span> (<span class="id"><a href="GlobDefs.html#GlobEnv.freelists">GlobEnv.freelists</a></span> <span class="id"><a href="GlobDefs.html#ThreadPool.ThreadPool.ge">ge</a></span>) <span class="id"><a href="GlobDefs.html#i">i</a></span> <span class="id">nf</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span>: <span class="id">c</span> := <span class="id"><a href="GlobDefs.html#Core.Build_t">Core.Build_t</a></span> <span class="id"><a href="GlobDefs.html#mid">mid</a></span> <span class="id"><a href="GlobDefs.html#c">c</a></span> <span class="id"><a href="GlobDefs.html#sg">sg</a></span> <span class="id">f</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GlobDefs.html#ThreadPool.Build_t">Build_t</a></span> (<span class="id"><a href="Maps.html#PMap.set">PMap.set</a></span> <span class="id"><a href="GlobDefs.html#i">i</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="GlobDefs.html#CallStack.push">CallStack.push</a></span> <span class="id"><a href="GlobDefs.html#c">c</a></span> <span class="id">cs</span>)) <span class="id"><a href="GlobDefs.html#thdp">thdp</a></span>.(<span class="id"><a href="GlobDefs.html#ThreadPool.content">content</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GlobDefs.html#thdp">thdp</a></span>.(<span class="id"><a href="GlobDefs.html#ThreadPool.next_tid">next_tid</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">i</span>' =&gt; <span class="kwd">if</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id"><a href="GlobDefs.html#i">i</a></span> <span class="id">i</span>' <span class="kwd">then</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> (<span class="id"><a href="GlobDefs.html#thdp">thdp</a></span>.(<span class="id"><a href="GlobDefs.html#ThreadPool.next_fmap">next_fmap</a></span>) <span class="id"><a href="GlobDefs.html#i">i</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="GlobDefs.html#thdp">thdp</a></span>.(<span class="id"><a href="GlobDefs.html#ThreadPool.next_fmap">next_fmap</a></span>) <span class="id">i</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="ThreadPool.pop">pop</a></span> (<span class="id">thdp</span>: <span class="id"><a href="GlobDefs.html#ThreadPool.t">t</a></span>) (<span class="id">i</span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="GlobDefs.html#ThreadPool.t">t</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span>: <span class="id">ocs</span> := <span class="id"><a href="Maps.html#PMap.get">PMap.get</a></span> <span class="id"><a href="GlobDefs.html#i">i</a></span> <span class="id"><a href="GlobDefs.html#thdp">thdp</a></span>.(<span class="id"><a href="GlobDefs.html#ThreadPool.content">content</a></span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">ocs</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">cs</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="GlobDefs.html#CallStack.pop">CallStack.pop</a></span> <span class="id">cs</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">cs</span>' =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="GlobDefs.html#ThreadPool.Build_t">Build_t</a></span> (<span class="id"><a href="Maps.html#PMap.set">PMap.set</a></span> <span class="id"><a href="GlobDefs.html#i">i</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">cs</span>') <span class="id"><a href="GlobDefs.html#thdp">thdp</a></span>.(<span class="id"><a href="GlobDefs.html#ThreadPool.content">content</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GlobDefs.html#thdp">thdp</a></span>.(<span class="id"><a href="GlobDefs.html#ThreadPool.next_tid">next_tid</a></span>)) (<span class="id"><a href="GlobDefs.html#thdp">thdp</a></span>.(<span class="id"><a href="GlobDefs.html#ThreadPool.next_fmap">next_fmap</a></span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="ThreadPool.get_cs">get_cs</a></span> (<span class="id">thdp</span>: <span class="id"><a href="GlobDefs.html#ThreadPool.t">t</a></span>) (<span class="id">i</span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="GlobDefs.html#CallStack.t">CallStack.t</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#PMap.get">PMap.get</a></span> <span class="id"><a href="GlobDefs.html#i">i</a></span> <span class="id"><a href="GlobDefs.html#thdp">thdp</a></span>.(<span class="id"><a href="GlobDefs.html#ThreadPool.content">content</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="ThreadPool.get_top">get_top</a></span> (<span class="id">thdp</span>: <span class="id"><a href="GlobDefs.html#ThreadPool.t">t</a></span>) (<span class="id">i</span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="GlobDefs.html#Core.t">Core.t</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">get_cs</a></span> <span class="id"><a href="GlobDefs.html#thdp">thdp</a></span> <span class="id"><a href="GlobDefs.html#i">i</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">cs</span> =&gt; <span class="id"><a href="GlobDefs.html#CallStack.top">CallStack.top</a></span> <span class="id">cs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="ThreadPool.update">update</a></span> (<span class="id">thdp</span>: <span class="id"><a href="GlobDefs.html#ThreadPool.t">t</a></span>) (<span class="id">i</span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span>) (<span class="id">c</span>: <span class="id"><a href="GlobDefs.html#Core.t">Core.t</a></span>) : <span class="id"><a href="GlobDefs.html#ThreadPool.t">t</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="ThreadPool.Update">Update</a></span> : <span class="kwd">forall</span> <span class="id">cs</span> <span class="id">cs</span>' <span class="id">thdp</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">get_cs</a></span> <span class="id">thdp</span> <span class="id">i</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="GlobDefs.html#cs">cs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#CallStack.update">CallStack.update</a></span> <span class="id"><a href="GlobDefs.html#cs">cs</a></span> <span class="id">c</span> <span class="id">cs</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">thdp</span>' = <span class="id"><a href="GlobDefs.html#ThreadPool.Build_t">Build_t</a></span> (<span class="id"><a href="Maps.html#PMap.set">PMap.set</a></span> <span class="id">i</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">cs</span>') <span class="id">thdp</span>.(<span class="id"><a href="GlobDefs.html#ThreadPool.content">content</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">thdp</span>.(<span class="id"><a href="GlobDefs.html#ThreadPool.next_tid">next_tid</a></span>)) (<span class="id">thdp</span>.(<span class="id"><a href="GlobDefs.html#ThreadPool.next_fmap">next_fmap</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#update">update</a></span> <span class="id">thdp</span> <span class="id">i</span> <span class="id">c</span> <span class="id">thdp</span>'.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="ThreadPool.init">init</a></span> : <span class="id"><a href="GAST.html#entries">entries</a></span> -&gt; <span class="id"><a href="GlobDefs.html#ThreadPool.t">t</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a name="ThreadPool.init_nil">init_nil</a></span> : <span class="id"><a href="GlobDefs.html#init">init</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> <span class="id"><a href="GlobDefs.html#ThreadPool.emp">emp</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a name="ThreadPool.init_cons">init_cons</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">funid</span> <span class="id">m_id</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#GlobEnv.get_mod">GlobEnv.get_mod</a></span> <span class="id"><a href="GlobDefs.html#ThreadPool.ThreadPool.ge">ge</a></span> <span class="id"><a href="GlobDefs.html#funid">funid</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="GlobDefs.html#m_id">m_id</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">e</span> <span class="id">thdp</span> <span class="id">cc</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#init">init</a></span> <span class="id"><a href="GlobDefs.html#e">e</a></span> <span class="id"><a href="GlobDefs.html#thdp">thdp</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span>: <span class="id">Mod</span> := <span class="id"><a href="GlobDefs.html#GlobEnv.modules">GlobEnv.modules</a></span> <span class="id"><a href="GlobDefs.html#ThreadPool.ThreadPool.ge">ge</a></span> <span class="id"><a href="GlobDefs.html#m_id">m_id</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span>: <span class="id">l</span> := <span class="id"><a href="InteractionSemantics.html#ModSem.lang">ModSem.lang</a></span> <span class="id">Mod</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span>: <span class="id">Ge</span> := <span class="id"><a href="InteractionSemantics.html#ModSem.Ge">ModSem.Ge</a></span> <span class="id">Mod</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">l</span>.(<span class="id"><a href="InteractionSemantics.html#init_core">init_core</a></span>) <span class="id">Ge</span> <span class="id"><a href="GlobDefs.html#funid">funid</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="GlobDefs.html#cc">cc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span>: <span class="id">thdp</span>':= <span class="id"><a href="GlobDefs.html#ThreadPool.spawn">spawn</a></span> <span class="id"><a href="GlobDefs.html#thdp">thdp</a></span> <span class="id"><a href="GlobDefs.html#m_id">m_id</a></span> <span class="id"><a href="GlobDefs.html#cc">cc</a></span> <span class="id"><a href="AST.html#signature_main">signature_main</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#init">init</a></span> (<span class="id"><a href="GlobDefs.html#funid">funid</a></span> :: <span class="id"><a href="GlobDefs.html#e">e</a></span>) <span class="id">thdp</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="ThreadPool.valid_tid">valid_tid</a></span> (<span class="id">TP</span>:<span class="id"><a href="GlobDefs.html#ThreadPool.t">t</a></span>) (<span class="id">i</span>:<span class="id"><a href="GlobDefs.html#tid">tid</a></span>) := <span class="id"><a href="Coqlib.html#Plt">Plt</a></span> <span class="id"><a href="GlobDefs.html#i">i</a></span> (<span class="id"><a href="GlobDefs.html#ThreadPool.next_tid">next_tid</a></span> <span class="id"><a href="GlobDefs.html#TP">TP</a></span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="ThreadPool.halted">halted</a></span> : <span class="id"><a href="GlobDefs.html#ThreadPool.t">t</a></span> -&gt; <span class="id"><a href="GlobDefs.html#tid">tid</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a name="ThreadPool.Halted">Halted</a></span> : <span class="kwd">forall</span> <span class="id">TP</span> <span class="id">i</span> <span class="id">cs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">get_cs</a></span> <span class="id"><a href="GlobDefs.html#TP">TP</a></span> <span class="id"><a href="GlobDefs.html#i">i</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="GlobDefs.html#cs">cs</a></span> -&gt; <span class="id"><a href="GlobDefs.html#CallStack.is_emp">CallStack.is_emp</a></span> <span class="id"><a href="GlobDefs.html#cs">cs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#halted">halted</a></span> <span class="id"><a href="GlobDefs.html#TP">TP</a></span> <span class="id"><a href="GlobDefs.html#i">i</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Record</span> <span class="id"><a name="ThreadPool.inv_cs">inv_cs</a></span> (<span class="id">cs</span>: <span class="id"><a href="GlobDefs.html#CallStack.t">CallStack.t</a></span>) (<span class="id">i</span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span>) (<span class="id">next</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="ThreadPool.fid_belongsto">fid_belongsto</a></span>: <span class="kwd">forall</span> <span class="id">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="GlobDefs.html#c">c</a></span> <span class="id"><a href="GlobDefs.html#cs">cs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#FLists.fbelongsto">FLists.fbelongsto</a></span> (<span class="id"><a href="GlobDefs.html#ThreadPool.ThreadPool.ge">ge</a></span>.(<span class="id"><a href="GlobDefs.html#GlobEnv.freelists">GlobEnv.freelists</a></span>)) <span class="id"><a href="GlobDefs.html#i">i</a></span> <span class="id"><a href="GlobDefs.html#c">c</a></span>.(<span class="id"><a href="GlobDefs.html#Core.F">Core.F</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="ThreadPool.fid_valid">fid_valid</a></span>: <span class="kwd">forall</span> <span class="id">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="GlobDefs.html#c">c</a></span> <span class="id"><a href="GlobDefs.html#cs">cs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">n</span>, (<span class="id"><a href="GlobDefs.html#n">n</a></span> &lt; <span class="id"><a href="GlobDefs.html#next">next</a></span>)%<span class="id">nat</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#FLists.get_tfid">FLists.get_tfid</a></span> (<span class="id"><a href="GlobDefs.html#ThreadPool.ThreadPool.ge">ge</a></span>.(<span class="id"><a href="GlobDefs.html#GlobEnv.freelists">GlobEnv.freelists</a></span>)) <span class="id"><a href="GlobDefs.html#i">i</a></span> <span class="id"><a href="GlobDefs.html#n">n</a></span> = <span class="id"><a href="GlobDefs.html#c">c</a></span>.(<span class="id"><a href="GlobDefs.html#Core.F">Core.F</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="ThreadPool.fid_disjoint">fid_disjoint</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n1</span> <span class="id">n2</span> (<span class="id">core1</span> <span class="id">core2</span>: @<span class="id"><a href="GlobDefs.html#Core.t">Core.t</a></span> <span class="id"><a href="GlobDefs.html#ThreadPool.ThreadPool.ge">ge</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id"><a href="GlobDefs.html#cs">cs</a></span> <span class="id"><a href="GlobDefs.html#n1">n1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="GlobDefs.html#core1">core1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id"><a href="GlobDefs.html#cs">cs</a></span> <span class="id"><a href="GlobDefs.html#n2">n2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="GlobDefs.html#core2">core2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GlobDefs.html#Core.F">Core.F</a></span> <span class="id"><a href="GlobDefs.html#core1">core1</a></span>) = (<span class="id"><a href="GlobDefs.html#Core.F">Core.F</a></span> <span class="id"><a href="GlobDefs.html#core2">core2</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#n1">n1</a></span> = <span class="id"><a href="GlobDefs.html#n2">n2</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="ThreadPool.cs_upd_inv_cs">cs_upd_inv_cs</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">cs</span>: @<span class="id"><a href="GlobDefs.html#CallStack.t">CallStack.t</a></span> <span class="id"><a href="GlobDefs.html#ThreadPool.ThreadPool.ge">ge</a></span>) <span class="id">c</span> <span class="id">cs</span>' <span class="id">i</span> <span class="id">f</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#ThreadPool.inv_cs">inv_cs</a></span> <span class="id"><a href="GlobDefs.html#cs">cs</a></span> <span class="id"><a href="GlobDefs.html#i">i</a></span> <span class="id"><a href="GlobDefs.html#f">f</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#CallStack.update">CallStack.update</a></span> <span class="id"><a href="GlobDefs.html#cs">cs</a></span> <span class="id"><a href="GlobDefs.html#c">c</a></span> <span class="id">cs</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#ThreadPool.inv_cs">inv_cs</a></span> <span class="id">cs</span>' <span class="id"><a href="GlobDefs.html#i">i</a></span> <span class="id"><a href="GlobDefs.html#f">f</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5961')">Proof.</div>
<div class="proofscript" id="proof5961">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>, <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">c</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> {| <span class="id"><a href="GlobDefs.html#Core.Build_t">Core.i</a></span> := <span class="id">i0</span>; <span class="id">Core.c</span> := <span class="id">c</span>; <span class="id">Core.sg</span> := <span class="id">sg</span>; <span class="id">Core.F</span> := <span class="id">F</span> |} <span class="kwd">as</span> <span class="id">c0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">fid_belongsto0</span> <span class="id">c0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">apply</span> <span class="id">fid_belongsto0</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">fid_belongsto0</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">fid_valid0</span> <span class="id">c0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">apply</span> <span class="id">fid_valid0</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">fid_valid0</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">specialize</span> (<span class="id">fid_disjoint0</span> <span class="id">n1</span> <span class="id">n2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n1</span>; <span class="tactic">destruct</span> <span class="id">n2</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">auto</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">fid_disjoint0</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">eauto</span>. <span class="tactic">inversion</span> <span class="id">H</span>. <span class="tactic">subst</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">fid_disjoint0</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>. <span class="tactic">inversion</span> <span class="id">H0</span>. <span class="tactic">subst</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">fid_disjoint0</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="ThreadPool.cs_push_inv_cs">cs_push_inv_cs</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">cs</span> <span class="id">ix</span> <span class="id">cc</span> <span class="id">sg</span> <span class="id">cs</span>' <span class="id">i</span> <span class="id">nf</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#GlobEnv.wd">GlobEnv.wd</a></span> <span class="id"><a href="GlobDefs.html#ThreadPool.ThreadPool.ge">ge</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#ThreadPool.inv_cs">inv_cs</a></span> <span class="id"><a href="GlobDefs.html#cs">cs</a></span> <span class="id"><a href="GlobDefs.html#i">i</a></span> <span class="id"><a href="GlobDefs.html#nf">nf</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#CallStack.push">CallStack.push</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<span class="id"><a href="GlobDefs.html#Core.Build_t">Core.i</a></span> := <span class="id"><a href="GlobDefs.html#ix">ix</a></span>; <span class="id">Core.c</span> := <span class="id"><a href="GlobDefs.html#cc">cc</a></span>; <span class="id">Core.sg</span> := <span class="id"><a href="GlobDefs.html#sg">sg</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Core.F</span> := <span class="id"><a href="GlobDefs.html#FLists.get_tfid">FLists.get_tfid</a></span> (<span class="id"><a href="GlobDefs.html#GlobEnv.freelists">GlobEnv.freelists</a></span> <span class="id"><a href="GlobDefs.html#ThreadPool.ThreadPool.ge">ge</a></span>) <span class="id"><a href="GlobDefs.html#i">i</a></span> <span class="id"><a href="GlobDefs.html#nf">nf</a></span> |} <span class="id"><a href="GlobDefs.html#cs">cs</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id">cs</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#ThreadPool.inv_cs">inv_cs</a></span> <span class="id">cs</span>' <span class="id"><a href="GlobDefs.html#i">i</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id"><a href="GlobDefs.html#nf">nf</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5962')">Proof.</div>
<div class="proofscript" id="proof5962">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">cs</span> <span class="id">ix</span> <span class="id">cc</span> <span class="id">sg</span> <span class="id">cs</span>' <span class="id">i</span> <span class="id">nf</span> <span class="id">Hwdge</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#CallStack.push">CallStack.push</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>; <span class="id">constructor</span>; <span class="tactic">intros</span>; <span class="tactic">subst</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">H</span>. <span class="tactic">subst</span>. <span class="tactic">simpl</span>. <span class="id">eexists</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">fid_belongsto0</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">H</span>. <span class="tactic">subst</span>. <span class="id">exists</span> <span class="id">nf</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">fid_valid0</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">nf</span>'&amp;<span class="id">H</span>&amp;<span class="id">H</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">nf</span>'; <span class="tactic">split</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">n1</span>; <span class="tactic">destruct</span> <span class="id">n2</span>; <span class="tactic">auto</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Coqlib.html#nth_error_in">nth_error_in</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">apply</span> <span class="id">fid_valid0</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> (<span class="id">n</span>&amp;<span class="id">Hneq</span>&amp;<span class="id">H1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="tactic">clear</span> <span class="id">H1</span>. <span class="tactic">assert</span> (<span class="id">nf</span> &lt;&gt; <span class="id">n</span>) <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="GlobDefs.html#GlobEnv.wd_fl">GlobEnv.wd_fl</a></span> <span class="id">_</span> <span class="id">Hwdge</span>). <span class="tactic">eapply</span> <span class="id">thread_fl_norep</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H1</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H1</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Coqlib.html#nth_error_in">nth_error_in</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id">fid_valid0</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">n</span>&amp;<span class="id">Hneq</span>&amp;<span class="id">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H</span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="tactic">clear</span> <span class="id">H</span>. <span class="tactic">assert</span> (<span class="id">nf</span> &lt;&gt; <span class="id">n</span>) <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="GlobDefs.html#GlobEnv.wd_fl">GlobEnv.wd_fl</a></span> <span class="id">_</span> <span class="id">Hwdge</span>). <span class="tactic">eapply</span> <span class="id">thread_fl_norep</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">fid_disjoint0</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span>) <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="ThreadPool.cs_pop_inv_cs">cs_pop_inv_cs</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">cs</span> <span class="id">cs</span>' <span class="id">i</span> <span class="id">nf</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#ThreadPool.inv_cs">inv_cs</a></span> <span class="id"><a href="GlobDefs.html#cs">cs</a></span> <span class="id"><a href="GlobDefs.html#i">i</a></span> <span class="id"><a href="GlobDefs.html#nf">nf</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#CallStack.pop">CallStack.pop</a></span> <span class="id"><a href="GlobDefs.html#cs">cs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">cs</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#ThreadPool.inv_cs">inv_cs</a></span> <span class="id">cs</span>' <span class="id"><a href="GlobDefs.html#i">i</a></span> <span class="id"><a href="GlobDefs.html#nf">nf</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5963')">Proof.</div>
<div class="proofscript" id="proof5963">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#CallStack.pop">CallStack.pop</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> <span class="id">cs</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">clear</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>; <span class="id">constructor</span>; <span class="tactic">intros</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">fid_belongsto0</span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_cons">in_cons</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">fid_valid0</span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_cons">in_cons</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">fid_disjoint0</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n1</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n2</span>)); <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n1</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n2</span>) <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id">fid_disjoint0</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Record</span> <span class="id"><a name="ThreadPool.inv">inv</a></span> (<span class="id">thdp</span>: <span class="id"><a href="GlobDefs.html#ThreadPool.t">t</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="ThreadPool.tp_finite">tp_finite</a></span>: <span class="kwd">forall</span> <span class="id">i</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pge">Pge</a></span> <span class="id"><a href="GlobDefs.html#i">i</a></span> <span class="id"><a href="GlobDefs.html#thdp">thdp</a></span>.(<span class="id"><a href="GlobDefs.html#ThreadPool.next_tid">next_tid</a></span>) -&gt; <span class="id"><a href="Maps.html#PMap.get">PMap.get</a></span> <span class="id"><a href="GlobDefs.html#i">i</a></span> <span class="id"><a href="GlobDefs.html#thdp">thdp</a></span>.(<span class="id"><a href="GlobDefs.html#ThreadPool.content">content</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="ThreadPool.tp_valid">tp_valid</a></span>: <span class="kwd">forall</span> <span class="id">i</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Coqlib.html#Plt">Plt</a></span> <span class="id"><a href="GlobDefs.html#i">i</a></span> <span class="id"><a href="GlobDefs.html#thdp">thdp</a></span>.(<span class="id"><a href="GlobDefs.html#ThreadPool.next_tid">next_tid</a></span>) -&gt; <span class="id">exists</span> <span class="id">cs</span>, <span class="id"><a href="Maps.html#PMap.get">PMap.get</a></span> <span class="id"><a href="GlobDefs.html#i">i</a></span> <span class="id"><a href="GlobDefs.html#thdp">thdp</a></span>.(<span class="id"><a href="GlobDefs.html#ThreadPool.content">content</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="GlobDefs.html#cs">cs</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="ThreadPool.thdp_default">thdp_default</a></span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="GlobDefs.html#thdp">thdp</a></span>.(<span class="id"><a href="GlobDefs.html#ThreadPool.content">content</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="ThreadPool.cs_inv">cs_inv</a></span>: <span class="kwd">forall</span> <span class="id">i</span> <span class="id">cs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#PMap.get">PMap.get</a></span> <span class="id"><a href="GlobDefs.html#i">i</a></span> <span class="id"><a href="GlobDefs.html#thdp">thdp</a></span>.(<span class="id"><a href="GlobDefs.html#ThreadPool.content">content</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="GlobDefs.html#cs">cs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#ThreadPool.inv_cs">inv_cs</a></span> <span class="id"><a href="GlobDefs.html#cs">cs</a></span> <span class="id"><a href="GlobDefs.html#i">i</a></span> (<span class="id"><a href="GlobDefs.html#thdp">thdp</a></span>.(<span class="id"><a href="GlobDefs.html#ThreadPool.next_fmap">next_fmap</a></span>) <span class="id"><a href="GlobDefs.html#i">i</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="ThreadPool.emp_inv">emp_inv</a></span>: <span class="id"><a href="GlobDefs.html#ThreadPool.inv">inv</a></span> <span class="id"><a href="GlobDefs.html#ThreadPool.emp">emp</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5964')">Proof.</div>
<div class="proofscript" id="proof5964">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.emp">emp</a></span>. <span class="id">constructor</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Maps.html#PMap.gi">PMap.gi</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">induction</span> <span class="id">i</span>; <span class="tactic">inversion</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gi">PMap.gi</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="ThreadPool.spawn_inv">spawn_inv</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tp</span> <span class="id">mid</span> <span class="id">c</span> <span class="id">sg</span> <span class="id">tp</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#ThreadPool.spawn">spawn</a></span> <span class="id"><a href="GlobDefs.html#tp">tp</a></span> <span class="id"><a href="GlobDefs.html#mid">mid</a></span> <span class="id"><a href="GlobDefs.html#c">c</a></span> <span class="id"><a href="GlobDefs.html#sg">sg</a></span> = <span class="id">tp</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#ThreadPool.inv">inv</a></span> <span class="id"><a href="GlobDefs.html#tp">tp</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#ThreadPool.inv">inv</a></span> <span class="id">tp</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5965')">Proof.</div>
<div class="proofscript" id="proof5965">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.spawn">spawn</a></span>; <span class="tactic">simpl</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">subst</span>. <span class="tactic">inversion</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">subst</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>; <span class="tactic">subst</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">tp_finite0</span>. <span class="id">lia</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">tp_valid0</span>. <span class="tactic">apply</span> <span class="id"><a href="Coqlib.html#Plt_succ_inv">Plt_succ_inv</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>; <span class="tactic">subst</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="tactic">clear</span>. <span class="id">constructor</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#FLists.fbelongsto">FLists.fbelongsto</a></span>. <span class="tactic">eauto</span>. <span class="tactic">inversion</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#FLists.fbelongsto">FLists.fbelongsto</a></span>. <span class="tactic">eauto</span>. <span class="tactic">inversion</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="tactic">try</span> <span class="tactic">destruct</span> <span class="id">n1</span>; <span class="tactic">do</span> 2 <span class="tactic">try</span> <span class="tactic">destruct</span> <span class="id">n2</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">auto</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="ThreadPool.init_inv">init_inv</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">el</span> <span class="id">tp</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#ThreadPool.init">init</a></span> <span class="id"><a href="GlobDefs.html#el">el</a></span> <span class="id"><a href="GlobDefs.html#tp">tp</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#ThreadPool.inv">inv</a></span> <span class="id"><a href="GlobDefs.html#tp">tp</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5966')">Proof.</div>
<div class="proofscript" id="proof5966">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">induction</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="GlobDefs.html#ThreadPool.emp_inv">emp_inv</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#ThreadPool.spawn_inv">spawn_inv</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="ThreadPool.upd_top_inv">upd_top_inv</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tp</span> <span class="id">i</span> <span class="id">c</span> <span class="id">cc</span> <span class="id">c</span>' <span class="id">tp</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#ThreadPool.inv">inv</a></span> <span class="id"><a href="GlobDefs.html#tp">tp</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#ThreadPool.get_top">get_top</a></span> <span class="id"><a href="GlobDefs.html#tp">tp</a></span> <span class="id"><a href="GlobDefs.html#i">i</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="GlobDefs.html#c">c</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#Core.update">Core.update</a></span> <span class="id"><a href="GlobDefs.html#c">c</a></span> <span class="id"><a href="GlobDefs.html#cc">cc</a></span> <span class="id">c</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#ThreadPool.update">update</a></span> <span class="id"><a href="GlobDefs.html#tp">tp</a></span> <span class="id"><a href="GlobDefs.html#i">i</a></span> <span class="id">c</span>' <span class="id">tp</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#ThreadPool.inv">inv</a></span> <span class="id">tp</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5967')">Proof.</div>
<div class="proofscript" id="proof5967">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>, <span class="id">H2</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id">tp_finite0</span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">get_cs</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">tp_finite0</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">tp_valid0</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">get_cs</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>; <span class="tactic">subst</span>. <span class="tactic">inversion</span> <span class="id">H3</span>. <span class="tactic">subst</span>. <span class="tactic">clear</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">cs_inv0</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#ThreadPool.cs_upd_inv_cs">cs_upd_inv_cs</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">cs_inv0</span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="ThreadPool.push_inv">push_inv</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tp</span> <span class="id">i</span> <span class="id">ix</span> <span class="id">cc</span> <span class="id">sg</span> <span class="id">tp</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#GlobEnv.wd">GlobEnv.wd</a></span> <span class="id"><a href="GlobDefs.html#ThreadPool.ThreadPool.ge">ge</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#ThreadPool.inv">inv</a></span> <span class="id"><a href="GlobDefs.html#tp">tp</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#ThreadPool.push">push</a></span> <span class="id"><a href="GlobDefs.html#tp">tp</a></span> <span class="id"><a href="GlobDefs.html#i">i</a></span> <span class="id"><a href="GlobDefs.html#ix">ix</a></span> <span class="id"><a href="GlobDefs.html#cc">cc</a></span> <span class="id"><a href="GlobDefs.html#sg">sg</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">tp</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#ThreadPool.inv">inv</a></span> <span class="id">tp</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5968')">Proof.</div>
<div class="proofscript" id="proof5968">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">tp</span> <span class="id">i</span> <span class="id">ix</span> <span class="id">cc</span> <span class="id">sg</span> <span class="id">tp</span>' <span class="id">Hwdge</span>; <span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.push">push</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>. <span class="id">remember</span> ((<span class="id"><a href="GlobDefs.html#ThreadPool.content">content</a></span> <span class="id">tp</span>) !! <span class="id">i</span>) <span class="kwd">as</span> <span class="id">tpi</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tpi</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>. <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">clear</span> <span class="id">H0</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">intros</span>; <span class="tactic">subst</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id">tp_finite0</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">tp_finite0</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="id">eexists</span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">tp_valid0</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#ThreadPool.cs_push_inv_cs">cs_push_inv_cs</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="GlobDefs.html#ThreadPool.cs_inv">cs_inv</a></span>; <span class="tactic">auto</span>. <span class="id">constructor</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="ThreadPool.pop_inv">pop_inv</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tp</span> <span class="id">i</span> <span class="id">tp</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#ThreadPool.inv">inv</a></span> <span class="id"><a href="GlobDefs.html#tp">tp</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#ThreadPool.pop">pop</a></span> <span class="id"><a href="GlobDefs.html#tp">tp</a></span> <span class="id"><a href="GlobDefs.html#i">i</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">tp</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#ThreadPool.inv">inv</a></span> <span class="id">tp</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5969')">Proof.</div>
<div class="proofscript" id="proof5969">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.pop">pop</a></span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> ((<span class="id"><a href="GlobDefs.html#ThreadPool.content">content</a></span> <span class="id">tp</span>) !! <span class="id">i</span>) <span class="kwd">as</span> <span class="id">tpi</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tpi</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="GlobDefs.html#CallStack.pop">CallStack.pop</a></span> <span class="id">t0</span>) <span class="kwd">as</span> <span class="id">ocs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">ocs</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">clear</span> <span class="id">H0</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">t0</span>. <span class="tactic">inversion</span> <span class="id">Heqocs</span>. <span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">Heqocs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">intros</span>; <span class="tactic">subst</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id">tp_finite0</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">tp_finite0</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="id">eexists</span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">tp_valid0</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">Heqocs</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span> <span class="id">Heqocs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#ThreadPool.cs_pop_inv_cs">cs_pop_inv_cs</a></span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="GlobDefs.html#ThreadPool.cs_inv">cs_inv</a></span>; <span class="tactic">auto</span>. <span class="id">constructor</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Record</span> <span class="id"><a name="ThreadPool.inv_mem">inv_mem</a></span> (<span class="id">thdp</span>: <span class="id"><a href="GlobDefs.html#ThreadPool.t">t</a></span>) (<span class="id">gm</span>: <span class="id"><a href="GMemory.html#gmem">gmem</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="ThreadPool.tp_valid_freelist_free">tp_valid_freelist_free</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">i</span> <span class="id">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GlobDefs.html#n">n</a></span> &gt;= (<span class="id"><a href="GlobDefs.html#ThreadPool.next_fmap">next_fmap</a></span> <span class="id"><a href="GlobDefs.html#thdp">thdp</a></span>) <span class="id"><a href="GlobDefs.html#i">i</a></span>)%<span class="id">nat</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="MemAux.html#no_overlap">no_overlap</a></span> (<span class="id"><a href="GlobDefs.html#FLists.get_tfl">FLists.get_tfl</a></span> (<span class="id"><a href="GlobDefs.html#GlobEnv.freelists">GlobEnv.freelists</a></span> <span class="id"><a href="GlobDefs.html#ThreadPool.ThreadPool.ge">ge</a></span>) <span class="id"><a href="GlobDefs.html#i">i</a></span> <span class="id"><a href="GlobDefs.html#n">n</a></span>) (<span class="id"><a href="MemAux.html#valid_block_bset">valid_block_bset</a></span> <span class="id"><a href="GlobDefs.html#gm">gm</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="ThreadPool.push_top_fid">push_top_fid</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">thdp</span> <span class="id">i</span> <span class="id">mid</span> <span class="id">c</span> <span class="id">sg</span> <span class="id">thdp</span>' <span class="id">C</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#ThreadPool.push">push</a></span> <span class="id"><a href="GlobDefs.html#thdp">thdp</a></span> <span class="id"><a href="GlobDefs.html#i">i</a></span> <span class="id"><a href="GlobDefs.html#mid">mid</a></span> <span class="id"><a href="GlobDefs.html#c">c</a></span> <span class="id"><a href="GlobDefs.html#sg">sg</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">thdp</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#ThreadPool.get_top">get_top</a></span> <span class="id">thdp</span>' <span class="id"><a href="GlobDefs.html#i">i</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="GlobDefs.html#C">C</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">nf</span> := (<span class="id"><a href="GlobDefs.html#thdp">thdp</a></span>.(<span class="id"><a href="GlobDefs.html#ThreadPool.next_fmap">next_fmap</a></span>) <span class="id"><a href="GlobDefs.html#i">i</a></span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">f</span> := <span class="id"><a href="GlobDefs.html#FLists.get_tfid">FLists.get_tfid</a></span> (<span class="id"><a href="GlobDefs.html#GlobEnv.freelists">GlobEnv.freelists</a></span> <span class="id"><a href="GlobDefs.html#ThreadPool.ThreadPool.ge">ge</a></span>) <span class="id"><a href="GlobDefs.html#i">i</a></span> <span class="id"><a href="GlobDefs.html#nf">nf</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#Core.F">Core.F</a></span> <span class="id"><a href="GlobDefs.html#C">C</a></span> = <span class="id"><a href="GlobDefs.html#f">f</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5970')">Proof.</div>
<div class="proofscript" id="proof5970">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.push">push</a></span>, <span class="id"><a href="GlobDefs.html#ThreadPool.get_top">get_top</a></span>, <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">get_cs</a></span>, <span class="id"><a href="GlobDefs.html#CallStack.top">CallStack.top</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">_</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">clear</span> <span class="id">H</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>: <span class="kwd">match</span> ?<span class="id">x</span> <span class="kwd">with</span> <span class="id">_</span> =&gt; <span class="id">_</span> <span class="kwd">end</span> = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span> <span class="id">eqn</span>:? ; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> (<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">fail</span>); <span class="tactic">subst</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span> <span class="kwd">in</span> <span class="id">Heqo</span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Heqo</span>. <span class="tactic">simpl</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id"><a href="GlobDefs.html#ThreadPool.ThreadPool">ThreadPool</a></span>.<br/>
<span class="kwd">End</span> <span class="id"><a href="GlobDefs.html#ThreadPool">ThreadPool</a></span>.<br/>
<br/>
<h2> Atomic bit </h2>
<span class="kwd">Inductive</span> <span class="id"><a name="Bit">Bit</a></span> : <span class="kwd">Type</span> :=<br/>
| <span class="id"><a name="O">O</a></span> : <span class="id"><a href="GlobDefs.html#Bit">Bit</a></span><br/>
| <span class="id"><a name="I">I</a></span> : <span class="id"><a href="GlobDefs.html#Bit">Bit</a></span>.<br/>
<br/>
<h2> Runtime state </h2>
<div class="doc">Runtime state consists of 
    - <span class="bracket"><span class="id">thread_pool</span></span>: mapping from thread id to runtime callstack 
    - <span class="bracket"><span class="id">cur_tid</span></span>: the current thread that is running
    - <span class="bracket"><span class="id">gm</span></span>: the global emmory state
    - <span class="bracket"><span class="id">atom_bit</span></span>: abstract state for modeling atomic blocks
</div>
<span class="kwd">Record</span> <span class="id"><a name="ProgConfig">ProgConfig</a></span> {<span class="id">GE</span>: <span class="id"><a href="GlobDefs.html#t">GlobEnv.t</a></span>}: <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="thread_pool">thread_pool</a></span> : @<span class="id"><a href="GlobDefs.html#t">ThreadPool.t</a></span> <span class="id"><a href="GlobDefs.html#GE">GE</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="cur_tid">cur_tid</a></span> : <span class="id"><a href="GlobDefs.html#tid">tid</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="gm">gm</a></span> : <span class="id"><a href="GMemory.html#gmem">gmem</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="atom_bit">atom_bit</a></span> : <span class="id"><a href="GlobDefs.html#Bit">Bit</a></span>;<br/>
&nbsp;&nbsp;}.<br/>
<br/>
<h2> Initial state </h2>
<div class="doc">This property checks if runtime ModSems are properly generated and
   runtime Cores are properly initialized </div>
<div class="doc">1. ge of each ModSem are properly initialized, without conflict </div>
<div class="doc">   note that we need <span class="bracket"><span class="id">print</span></span>, <span class="bracket"><span class="id">ent_atom</span></span>, and <span class="bracket"><span class="id">exit_atom</span></span>, we require these idents are not conflicted </div>
<div class="doc">2. global vars are properly initialized in gm, freelists are free in gm </div>
<div class="doc">3. cores are initialized from entries, inv |- threadpool  </div>
<div class="doc">4. all freelist are wd and free </div>
<div class="doc">5. initial gms are reach-closed on its domain (valid_blocks) </div>
<div class="doc">6. the initialized <span class="bracket"><span class="id">cur_tid</span></span> is valid and the <span class="bracket"><span class="id">atom_bit</span></span> set to <span class="bracket"><span class="id">O</span></span> </div>
<span class="kwd">Inductive</span> <span class="id"><a name="init_config">init_config</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">NL</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>} {<span class="id">L</span>: @<span class="id"><a href="GAST.html#langs">langs</a></span> <span class="id"><a href="GlobDefs.html#NL">NL</a></span>} (<span class="id">p</span>: @<span class="id"><a href="GAST.html#prog">prog</a></span> <span class="id"><a href="GlobDefs.html#NL">NL</a></span> <span class="id"><a href="GlobDefs.html#L">L</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m</span>:<span class="id"><a href="GMemory.html#gmem">gmem</a></span>) (<span class="id">GE</span>: <span class="id"><a href="GlobDefs.html#t">GlobEnv.t</a></span>) (<span class="id">pc</span>: @<span class="id"><a href="GlobDefs.html#ProgConfig">ProgConfig</a></span> <span class="id"><a href="GlobDefs.html#GE">GE</a></span>) (<span class="id">t</span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span>): <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a name="Init_config">Init_config</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#init">GlobEnv.init</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">p</span>) <span class="id">GE</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#init_mem">GlobEnv.init_mem</a></span> <span class="id">GE</span> <span class="id">m</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#init">ThreadPool.init</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">p</span>) (<span class="id">pc</span>.(<span class="id"><a href="GlobDefs.html#thread_pool">thread_pool</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#wd">FLists.wd</a></span> (<span class="id"><a href="GlobDefs.html#freelists">GlobEnv.freelists</a></span> <span class="id">GE</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">fi</span>, <span class="id"><a href="MemAux.html#no_overlap">no_overlap</a></span> (<span class="id"><a href="GlobDefs.html#get_fl">FLists.get_fl</a></span> (<span class="id"><a href="GlobDefs.html#freelists">GlobEnv.freelists</a></span> <span class="id">GE</span>) <span class="id"><a href="GlobDefs.html#fi">fi</a></span>) (<span class="id"><a href="MemAux.html#valid_block_bset">valid_block_bset</a></span> <span class="id">m</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="MemClosures.html#reach_closed">reach_closed</a></span> <span class="id">m</span> (<span class="id"><a href="MemAux.html#valid_block_bset">valid_block_bset</a></span> <span class="id">m</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#cur_tid">cur_tid</a></span> <span class="id">pc</span> = <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Coqlib.html#Plt">Plt</a></span> <span class="id">t</span> (<span class="id"><a href="GlobDefs.html#next_tid">ThreadPool.next_tid</a></span> <span class="id">pc</span>.(<span class="id"><a href="GlobDefs.html#thread_pool">thread_pool</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GlobDefs.html#atom_bit">atom_bit</a></span> <span class="id">pc</span>) = <span class="id"><a href="GlobDefs.html#O">O</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GlobDefs.html#gm">gm</a></span> <span class="id">pc</span>) = <span class="id">m</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#init_config">init_config</a></span> <span class="id">p</span> <span class="id">m</span> <span class="id">GE</span> <span class="id">pc</span> <span class="id">t</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="init_config_GE_wd">init_config_GE_wd</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">NL</span> <span class="id">L</span> (<span class="id">p</span>:@<span class="id"><a href="GAST.html#prog">prog</a></span> <span class="id"><a href="GlobDefs.html#NL">NL</a></span> <span class="id"><a href="GlobDefs.html#L">L</a></span>) <span class="id">gm</span> <span class="id">GE</span> <span class="id">pc</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#init_config">init_config</a></span> <span class="id"><a href="GlobDefs.html#p">p</a></span> <span class="id"><a href="GlobDefs.html#gm">gm</a></span> <span class="id"><a href="GlobDefs.html#GE">GE</a></span> <span class="id"><a href="GlobDefs.html#pc">pc</a></span> <span class="id"><a href="GlobDefs.html#t">t</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#wd">GlobEnv.wd</a></span> <span class="id"><a href="GlobDefs.html#GE">GE</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5971')">Proof.</div>
<div class="proofscript" id="proof5971">
&nbsp;&nbsp;<span class="tactic">inversion</span> 1.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<h2> Final state </h2>
<div class="doc">A state is final state if all threads are halted </div>
<span class="kwd">Inductive</span> <span class="id"><a name="final_state">final_state</a></span> {<span class="id">ge</span>: <span class="id"><a href="GlobDefs.html#t">GlobEnv.t</a></span>} : @<span class="id"><a href="GlobDefs.html#ProgConfig">ProgConfig</a></span> <span class="id">ge</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id"><a name="Final_state">Final_state</a></span> : <span class="kwd">forall</span> <span class="id">pc</span> <span class="id">TP</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#thread_pool">thread_pool</a></span> <span class="id"><a href="GlobDefs.html#pc">pc</a></span> = <span class="id"><a href="GlobDefs.html#TP">TP</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">i</span>, <span class="id"><a href="GlobDefs.html#valid_tid">ThreadPool.valid_tid</a></span> <span class="id"><a href="GlobDefs.html#TP">TP</a></span> <span class="id"><a href="GlobDefs.html#i">i</a></span> -&gt; <span class="id"><a href="GlobDefs.html#halted">ThreadPool.halted</a></span> <span class="id"><a href="GlobDefs.html#TP">TP</a></span> <span class="id"><a href="GlobDefs.html#i">i</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#final_state">final_state</a></span> <span class="id"><a href="GlobDefs.html#pc">pc</a></span>.<br/>
<br/>
<br/>
<br/>
<h2> Realtion on initial memories </h2>
<div class="doc">We require:
    - sgm injects tgm w.r.t. some block inject function
    - domain of sgm tgm matches
    - locs of sgm tgm matches
 </div>
<span class="kwd">Record</span> <span class="id"><a name="InitRel">InitRel</a></span> (<span class="id">mu</span>: <span class="id"><a href="Injections.html#Mu">Mu</a></span>) (<span class="id">SGE</span> <span class="id">TGE</span>: <span class="id"><a href="GlobDefs.html#t">GlobEnv.t</a></span>) (<span class="id">sgm</span> <span class="id">tgm</span>: <span class="id"><a href="GMemory.html#gmem">gmem</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="ir_inject">ir_inject</a></span>: <span class="id"><a href="GMemory.html#GMem.Binject_weak">GMem.Binject_weak</a></span> (<span class="id"><a href="Injections.html#inj">inj</a></span> <span class="id"><a href="GlobDefs.html#mu">mu</a></span>) <span class="id"><a href="GlobDefs.html#sgm">sgm</a></span> <span class="id"><a href="GlobDefs.html#tgm">tgm</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="ir_mu_wd">ir_mu_wd</a></span>: <span class="id"><a href="Blockset.html#Bset.inject">Bset.inject</a></span> (<span class="id"><a href="Injections.html#inj">inj</a></span> <span class="id"><a href="GlobDefs.html#mu">mu</a></span>) (<span class="id"><a href="Injections.html#SharedSrc">SharedSrc</a></span> <span class="id"><a href="GlobDefs.html#mu">mu</a></span>) (<span class="id"><a href="Injections.html#SharedTgt">SharedTgt</a></span> <span class="id"><a href="GlobDefs.html#mu">mu</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="ir_shared_src">ir_shared_src</a></span>: <span class="id"><a href="Injections.html#SharedSrc">SharedSrc</a></span> <span class="id"><a href="GlobDefs.html#mu">mu</a></span> = <span class="kwd">fun</span> <span class="id">b</span> =&gt; <span class="id"><a href="Coqlib.html#Plt">Plt</a></span> <span class="id"><a href="GlobDefs.html#b">b</a></span> (<span class="id"><a href="GlobDefs.html#ge_bound">GlobEnv.ge_bound</a></span> <span class="id"><a href="GlobDefs.html#SGE">SGE</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="ir_shared_tgt">ir_shared_tgt</a></span>: <span class="id"><a href="Injections.html#SharedTgt">SharedTgt</a></span> <span class="id"><a href="GlobDefs.html#mu">mu</a></span> = <span class="kwd">fun</span> <span class="id">b</span> =&gt; <span class="id"><a href="Coqlib.html#Plt">Plt</a></span> <span class="id"><a href="GlobDefs.html#b">b</a></span> (<span class="id"><a href="GlobDefs.html#ge_bound">GlobEnv.ge_bound</a></span> <span class="id"><a href="GlobDefs.html#TGE">TGE</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="ir_ge_bound">ir_ge_bound</a></span>: <span class="id"><a href="GlobDefs.html#ge_bound">GlobEnv.ge_bound</a></span> <span class="id"><a href="GlobDefs.html#SGE">SGE</a></span> = <span class="id"><a href="GlobDefs.html#ge_bound">GlobEnv.ge_bound</a></span> <span class="id"><a href="GlobDefs.html#TGE">TGE</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="ir_senv_init_inj">ir_senv_init_inj</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">m</span>: '<span class="id">I_</span>(<span class="id"><a href="GlobDefs.html#M">GlobEnv.M</a></span> <span class="id"><a href="GlobDefs.html#SGE">SGE</a></span>)) (<span class="id">n</span>: '<span class="id">I_</span>(<span class="id"><a href="GlobDefs.html#M">GlobEnv.M</a></span> <span class="id"><a href="GlobDefs.html#TGE">TGE</a></span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">nat_of_ord</span> <span class="id"><a href="GlobDefs.html#m">m</a></span> = <span class="id">nat_of_ord</span> <span class="id"><a href="GlobDefs.html#n">n</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Modm</span> := <span class="id"><a href="GlobDefs.html#modules">GlobEnv.modules</a></span> <span class="id"><a href="GlobDefs.html#SGE">SGE</a></span> <span class="id"><a href="GlobDefs.html#m">m</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Modn</span> := <span class="id"><a href="GlobDefs.html#modules">GlobEnv.modules</a></span> <span class="id"><a href="GlobDefs.html#TGE">TGE</a></span> <span class="id"><a href="GlobDefs.html#n">n</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">sge</span> := <span class="id"><a href="InteractionSemantics.html#ModSem.ge">ModSem.ge</a></span> <span class="id"><a href="GlobDefs.html#Modm">Modm</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">tge</span> := <span class="id"><a href="InteractionSemantics.html#ModSem.ge">ModSem.ge</a></span> <span class="id"><a href="GlobDefs.html#Modn">Modn</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">id</span>, <span class="id"><a href="Coqlib.html#option_rel">option_rel</a></span> (<span class="kwd">fun</span> <span class="id">b</span> <span class="id">b</span>' =&gt; <span class="id"><a href="Injections.html#inj">inj</a></span> <span class="id"><a href="GlobDefs.html#mu">mu</a></span> <span class="id"><a href="GlobDefs.html#b">b</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">b</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Globalenvs.html#Senv.find_symbol">Senv.find_symbol</a></span> <span class="id"><a href="GlobDefs.html#sge">sge</a></span> <span class="id"><a href="GlobDefs.html#id">id</a></span>) (<span class="id"><a href="Globalenvs.html#Senv.find_symbol">Senv.find_symbol</a></span> <span class="id"><a href="GlobDefs.html#tge">tge</a></span> <span class="id"><a href="GlobDefs.html#id">id</a></span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="ir_shared_src_valid">ir_shared_src_valid</a></span>: <span class="kwd">forall</span> <span class="id">b</span>, <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span> <span class="id"><a href="GlobDefs.html#sgm">sgm</a></span> <span class="id"><a href="GlobDefs.html#b">b</a></span> &lt;-&gt; <span class="id"><a href="Injections.html#SharedSrc">Injections.SharedSrc</a></span> <span class="id"><a href="GlobDefs.html#mu">mu</a></span> <span class="id"><a href="GlobDefs.html#b">b</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="ir_shared_tgt_valid">ir_shared_tgt_valid</a></span>: <span class="kwd">forall</span> <span class="id">b</span>, <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span> <span class="id"><a href="GlobDefs.html#tgm">tgm</a></span> <span class="id"><a href="GlobDefs.html#b">b</a></span> &lt;-&gt; <span class="id"><a href="Injections.html#SharedTgt">Injections.SharedTgt</a></span> <span class="id"><a href="GlobDefs.html#mu">mu</a></span> <span class="id"><a href="GlobDefs.html#b">b</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;}.<br/>
<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="res_has_type">res_has_type</a></span> (<span class="id">res</span>: <span class="id"><a href="Values.html#val">val</a></span>) (<span class="id">sg</span>: <span class="id"><a href="AST.html#signature">signature</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="Values.html#Val.has_type">Val.has_type</a></span> <span class="id"><a href="GlobDefs.html#res">res</a></span> (<span class="id"><a href="AST.html#proj_sig_res">proj_sig_res</a></span> <span class="id"><a href="GlobDefs.html#sg">sg</a></span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="res_sg">res_sg</a></span> (<span class="id">sg</span>: <span class="id"><a href="AST.html#signature">signature</a></span>) (<span class="id">res</span>: <span class="id"><a href="Values.html#val">val</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Values.html#val">val</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> (<span class="id"><a href="GlobDefs.html#sg">sg</a></span>.(<span class="id"><a href="AST.html#sig_res">sig_res</a></span>)) <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="GlobDefs.html#res">res</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="not_pointer">not_pointer</a></span> (<span class="id">v</span>: <span class="id"><a href="Values.html#val">val</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="GlobDefs.html#v">v</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Values.html#Vundef">Vundef</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.</div>
<div class="footer"><hr/>Generated by coq2html</div>
</body>
</html>
