<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module Soundness</title>
<meta name="description" content="Documentation of Coq module Soundness" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module Soundness</h1>
<div class="coq">
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Setoids.Setoid.html">Setoid</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html">List</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">mathcomp.ssreflect.fintype</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Coqlib.html">Coqlib</a></span> <span class="id"><a href="Errors.html">Errors</a></span> <span class="id"><a href="Values.html">Values</a></span> <span class="id"><a href="AST.html">AST</a></span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Blockset.html">Blockset</a></span> <span class="id"><a href="InteractionSemantics.html">InteractionSemantics</a></span> <span class="id"><a href="GAST.html">GAST</a></span> <span class="id"><a href="GlobDefs.html">GlobDefs</a></span> <span class="id"><a href="GlobSemantics.html">GlobSemantics</a></span> <span class="id"><a href="DRF.html">DRF</a></span> <span class="id"><a href="ReachClose.html">ReachClose</a></span> <span class="id"><a href="Init.html">Init</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="NPEquiv.html">NPEquiv</a></span> <span class="id"><a href="GlobUSimRefine.html">GlobUSimRefine</a></span> <span class="id"><a href="SimDRF.html">SimDRF</a></span> <span class="id"><a href="Flipping.html">Flipping</a></span> <span class="id"><a href="Compositionality.html">Compositionality</a></span> <span class="id"><a href="SeqCorrect.html">SeqCorrect</a></span>.<br/>
<br/>
<h2> Framework Final Theorem </h2>
<br/>
<div class="doc">This file defines the final theorem <span class="bracket"><span class="id">framework_final_theorem</span></span> of our framework (Thm. 10), 
    in which languages are parameterized. </div>
<br/>
<div class="doc">The main result is that if we have a <span class="bracket"><span class="id">safe</span></span> and <span class="bracket"><span class="id">DRF</span></span> source program
    <span class="bracket"><span class="id">P_s</span></span> = <span class="bracket"><span class="kwd">Let</span> (<span class="id">c_1</span>,...,<span class="id">c_n</span>) <span class="id">In</span> <span class="id">f_1</span> || ... || <span class="id">f_n</span></span>, 
    each of its modules <span class="bracket"><span class="id">c_i</span></span> is reach-closed and 
    correctly compiled to a target module <span class="bracket"><span class="id">t_i</span></span>, 
    and all the target languages are deterministic,
    then the target program
    <span class="bracket"><span class="kwd">Let</span> (<span class="id">c_1</span>,...,<span class="id">c_n</span>) <span class="id">In</span> <span class="id">f_1</span> || ... || <span class="id">f_n</span></span> refines <span class="bracket"><span class="id">P_s</span></span>. </div>
<br/>
<br/>
<div class="doc">Block set and block injection definitions, 
    for the definition of simulation and refinement </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="blocks">blocks</a></span> := <span class="id"><a href="Blockset.html#Bset.t">Bset.t</a></span>.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="bs_emp">bs_emp</a></span> := <span class="id"><a href="Blockset.html#Bset.emp">Bset.emp</a></span>.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="block_subset">block_subset</a></span> := <span class="id"><a href="Blockset.html#Bset.subset">Bset.subset</a></span>.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="block_inj">block_inj</a></span> := <span class="id"><a href="Blockset.html#Bset.inj">Bset.inj</a></span>.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="binj_emp">binj_emp</a></span> := <span class="id"><a href="Blockset.html#Bset.inj_emp">Bset.inj_emp</a></span>.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="binj_id">binj_id</a></span> := <span class="id"><a href="Blockset.html#Bset.inj_id">Bset.inj_id</a></span>.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="block_inj_subset">block_inj_subset</a></span> := <span class="id"><a href="Blockset.html#Bset.inj_subset">Bset.inj_subset</a></span>.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="blocks_inject">blocks_inject</a></span> := <span class="id"><a href="Blockset.html#Bset.inject">Bset.inject</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="seqs_correct">seqs_correct</a></span> {<span class="id">NL</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>} {<span class="id">L</span>: @<span class="id"><a href="GAST.html#langs">langs</a></span> <span class="id"><a href="Soundness.html#NL">NL</a></span>} (<span class="id">scomps</span>: @<span class="id"><a href="GAST.html#gcomp">gcomp</a></span> <span class="id"><a href="Soundness.html#NL">NL</a></span> <span class="id"><a href="Soundness.html#L">L</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">scomp</span> =&gt; <span class="id"><a href="SeqCorrect.html#seq_correct">seq_correct</a></span> <span class="id"><a href="Soundness.html#scomp">scomp</a></span>.(<span class="id"><a href="GAST.html#comp">comp</a></span>)) <span class="id"><a href="Soundness.html#scomps">scomps</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="seqs_correct_ldsims">seqs_correct_ldsims</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">NL</span> <span class="id">L</span> <span class="id">comps</span> <span class="id">scunits</span> <span class="id">tcunits</span>,<br/>
&nbsp;&nbsp;@<span class="id"><a href="Soundness.html#seqs_correct">seqs_correct</a></span> <span class="id"><a href="Soundness.html#NL">NL</a></span> <span class="id"><a href="Soundness.html#L">L</a></span> <span class="id"><a href="Soundness.html#comps">comps</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="GAST.html#cunits_transf">cunits_transf</a></span> <span class="id"><a href="Soundness.html#comps">comps</a></span> <span class="id"><a href="Soundness.html#scunits">scunits</a></span> <span class="id"><a href="Soundness.html#tcunits">tcunits</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="Compositionality.html#ldsims">ldsims</a></span> <span class="id"><a href="Soundness.html#scunits">scunits</a></span> <span class="id"><a href="Soundness.html#tcunits">tcunits</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9168')">Proof.</div>
<div class="proofscript" id="proof9168">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">NL</span> <span class="id">L</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">comps</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;{ <span class="tactic">inversion</span> <span class="id">H0</span>. <span class="id">constructor</span>. }<br/>
&nbsp;&nbsp;{ <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>. <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="id">H3</span> <span class="id">H4</span>. <span class="tactic">clear</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H3</span>. <span class="tactic">subst</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H4</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHcomps</span>; <span class="tactic">auto</span>. }<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="seqs_correct_fn_preserved">seqs_correct_fn_preserved</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">NL</span> <span class="id">L</span> <span class="id">comps</span> <span class="id">scunits</span> <span class="id">tcunits</span>,<br/>
&nbsp;&nbsp;@<span class="id"><a href="Soundness.html#seqs_correct">seqs_correct</a></span> <span class="id"><a href="Soundness.html#NL">NL</a></span> <span class="id"><a href="Soundness.html#L">L</a></span> <span class="id"><a href="Soundness.html#comps">comps</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="GAST.html#cunits_transf">cunits_transf</a></span> <span class="id"><a href="Soundness.html#comps">comps</a></span> <span class="id"><a href="Soundness.html#scunits">scunits</a></span> <span class="id"><a href="Soundness.html#tcunits">tcunits</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="Compositionality.html#fn_preserved">fn_preserved</a></span> <span class="id"><a href="Soundness.html#scunits">scunits</a></span> <span class="id"><a href="Soundness.html#tcunits">tcunits</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9169')">Proof.</div>
<div class="proofscript" id="proof9169">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">NL</span> <span class="id">L</span>; <span class="tactic">induction</span> <span class="id">comps</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;{ <span class="tactic">inversion</span> <span class="id">H0</span>. <span class="id">constructor</span>. }<br/>
&nbsp;&nbsp;{ <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>. <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="id">H3</span> <span class="id">H4</span>. <span class="tactic">clear</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H3</span>. <span class="tactic">subst</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H4</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHcomps</span>; <span class="tactic">auto</span>. }<br/>
Qed.</div>
<br/>
&nbsp;&nbsp;<br/>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="Soundness">Soundness</a></span>.<br/>
<div class="doc">NL languages </div>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">NL</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>}.<br/>
<div class="doc">Languages </div>
&nbsp;&nbsp;<span class="kwd">Variable</span> (<span class="id"><a name="Soundness.L">L</a></span>: @<span class="id"><a href="GAST.html#langs">langs</a></span> <span class="id"><a href="Soundness.html#Soundness.NL">NL</a></span>).<br/>
&nbsp;&nbsp;<br/>
<div class="doc">Compilation units of source/target program</div>
&nbsp;&nbsp;<span class="kwd">Variable</span> (<span class="id"><a name="Soundness.scunits">scunits</a></span> <span class="id"><a name="Soundness.tcunits">tcunits</a></span>: @<span class="id"><a href="GAST.html#cunits">cunits</a></span> <span class="id"><a href="Soundness.html#Soundness.NL">NL</a></span> <span class="id"><a href="Soundness.html#Soundness.L">L</a></span>).<br/>
&nbsp;&nbsp;<br/>
<div class="doc">Thread entries </div>
&nbsp;&nbsp;<span class="kwd">Variable</span> (<span class="id"><a name="Soundness.e">e</a></span>: <span class="id"><a href="GAST.html#entries">entries</a></span>).<br/>
&nbsp;&nbsp;<br/>
<div class="doc">The collection of compilers </div>
&nbsp;&nbsp;<span class="kwd">Variable</span> (<span class="id"><a name="Soundness.comps">comps</a></span>: @<span class="id"><a href="GAST.html#gcomp">gcomp</a></span> <span class="id"><a href="Soundness.html#Soundness.NL">NL</a></span> <span class="id"><a href="Soundness.html#Soundness.L">L</a></span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Theorem</span> <span class="id"><a name="framework_sound">framework_sound</a></span>:<br/>
<div class="doc">languages are well-defined </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GAST.html#wd_langs">wd_langs</a></span> <span class="id"><a href="Soundness.html#Soundness.scunits">scunits</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GAST.html#wd_langs">wd_langs</a></span> <span class="id"><a href="Soundness.html#Soundness.tcunits">tcunits</a></span> -&gt;<br/>
<div class="doc">target languages are deterministic </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GAST.html#det_langs">det_langs</a></span> <span class="id"><a href="Soundness.html#Soundness.tcunits">tcunits</a></span> -&gt;<br/>
<div class="doc">all compilation units are reach-closed </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Compositionality.html#rc_cunits">rc_cunits</a></span> <span class="id"><a href="Soundness.html#Soundness.scunits">scunits</a></span> -&gt;<br/>
<div class="doc">compilation units are compiled by <span class="bracket"><span class="id">comps</span></span> </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GAST.html#cunits_transf">cunits_transf</a></span> <span class="id"><a href="Soundness.html#Soundness.comps">comps</a></span> <span class="id"><a href="Soundness.html#Soundness.scunits">scunits</a></span> <span class="id"><a href="Soundness.html#Soundness.tcunits">tcunits</a></span> -&gt;<br/>
<div class="doc">compilers are correct w.r.t. the global root and global injection on root</div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Soundness.html#seqs_correct">seqs_correct</a></span> <span class="id"><a href="Soundness.html#Soundness.comps">comps</a></span> -&gt;<br/>
<div class="doc">whole source program is data-race-free </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="DRF.html#drf">drf</a></span> (<span class="id"><a href="Soundness.html#Soundness.scunits">scunits</a></span>, <span class="id"><a href="Soundness.html#Soundness.e">e</a></span>) -&gt;<br/>
<div class="doc">whole source program is safe </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobSemantics.html#safe_prog">safe_prog</a></span> (<span class="id"><a href="Soundness.html#Soundness.scunits">scunits</a></span>, <span class="id"><a href="Soundness.html#Soundness.e">e</a></span>) -&gt;<br/>
<div class="doc">main result: target program refines the source </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobSemantics.html#prog_refine">prog_refine</a></span> (<span class="id"><a href="Soundness.html#Soundness.scunits">scunits</a></span>, <span class="id"><a href="Soundness.html#Soundness.e">e</a></span>) (<span class="id"><a href="Soundness.html#Soundness.tcunits">tcunits</a></span>, <span class="id"><a href="Soundness.html#Soundness.e">e</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9170')">Proof.</div>
<div class="proofscript" id="proof9170">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Hwd_src</span> <span class="id">Hwd_tgt</span> <span class="id">Hdet_tgt</span> <span class="id">Hrc</span> <span class="id">Hcomp</span> <span class="id">Hcorrect</span> <span class="id">Hdrf</span> <span class="id">Hsafe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> (@<span class="id"><a href="Compositionality.html#compositionality">compositionality</a></span> <span class="id"><a href="Soundness.html#Soundness.NL">NL</a></span> <span class="id"><a href="Soundness.html#Soundness.L">L</a></span>) <span class="kwd">as</span> <span class="id">HSim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">HSim</span> <span class="id">_</span> <span class="id">_</span> <span class="id"><a href="Soundness.html#Soundness.e">e</a></span> <span class="id">Hwd_src</span> <span class="id">Hwd_tgt</span> <span class="id">Hrc</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="NPEquiv.html#Safe_NPSafe">Safe_NPSafe</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hwd_src</span> <span class="id">Hsafe</span>) <span class="kwd">as</span> <span class="id">Hnpsafe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">cut</span> (<span class="id"><a href="Compositionality.html#ldsims">ldsims</a></span> <span class="id"><a href="Soundness.html#Soundness.scunits">scunits</a></span> <span class="id"><a href="Soundness.html#Soundness.tcunits">tcunits</a></span>). <span class="tactic">intro</span>. <span class="id">specialize</span> (<span class="id">HSim</span> <span class="id">H</span>). <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Flipping.html#flipping">flipping</a></span> <span class="kwd">in</span> <span class="id">HSim</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>. <span class="tactic">intros</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="RefineEquiv.html#init_pair_config_refine">RefineEquiv.init_pair_config_refine</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Init.html#init_pair_lemma">init_pair_lemma</a></span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> ?;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">H0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> {|<span class="id"><a href="GlobDefs.html#Build_ProgConfig">thread_pool</a></span> := <span class="id"><a href="GlobDefs.html#thread_pool">thread_pool</a></span> <span class="id">tpc</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cur_tid</span> := <span class="id">ts</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">gm</span> := <span class="id"><a href="GlobDefs.html#gm">gm</a></span> <span class="id">tpc</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">atom_bit</span> := <span class="id"><a href="GlobDefs.html#atom_bit">atom_bit</a></span> <span class="id">tpc</span> |} <span class="kwd">as</span> <span class="id">tpc</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">tpc</span> <span class="id">Heqtpc</span>'. <span class="tactic">rename</span> <span class="id">tpc</span>' <span class="id">into</span> <span class="id">tpc</span>. <span class="tactic">rename</span> <span class="id">H2</span> <span class="id">into</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="NPSemantics.html#np_safe_config">NPSemantics.np_safe_config</a></span> <span class="id">spc</span>). <span class="tactic">inversion</span> <span class="id">Hnpsafe</span>;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="NPEquiv.html#DRF_NP_Refine_Config">DRF_NP_Refine_Config</a></span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">H0</span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">H1</span>;<span class="tactic">eauto</span>;<span class="tactic">simpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">ts</span> = <span class="id"><a href="GlobDefs.html#cur_tid">cur_tid</a></span> <span class="id">tpc</span>). <span class="tactic">inversion</span> <span class="id">H1</span>;<span class="tactic">auto</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="GlobDefs.html#cur_tid">cur_tid</a></span> <span class="id">tpc</span> = <span class="id"><a href="GlobDefs.html#cur_tid">cur_tid</a></span> <span class="id">spc</span>). <span class="tactic">inversion</span> <span class="id">H0</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H4</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Init.html#init_free">init_free</a></span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Init.html#init_pair_lemma">init_pair_lemma</a></span> <span class="kwd">in</span> <span class="id">H0</span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">H5</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="GlobUSimRefine.html#USim_Safe_Config">USim_Safe_Config</a></span> <span class="kwd">in</span> <span class="id">H5</span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">H0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="NPEquiv.html#NPDRF_DRF_Config">NPDRF_DRF_Config</a></span>; <span class="tactic">eauto</span>;<span class="tactic">simpl</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">ts</span> = <span class="id"><a href="GlobDefs.html#cur_tid">cur_tid</a></span> <span class="id">tpc</span>). <span class="tactic">inversion</span> <span class="id">H1</span>;<span class="tactic">auto</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="GlobDefs.html#cur_tid">cur_tid</a></span> <span class="id">tpc</span> = <span class="id"><a href="GlobDefs.html#cur_tid">cur_tid</a></span> <span class="id">spc</span>). <span class="tactic">inversion</span> <span class="id">H0</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H4</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Init.html#init_free">init_free</a></span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Init.html#init_pair_lemma">init_pair_lemma</a></span> <span class="kwd">in</span> <span class="id">H0</span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">H5</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="GlobUSimRefine.html#USim_Safe_Config">USim_Safe_Config</a></span> <span class="kwd">in</span> <span class="id">H5</span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">H0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">ts</span> = <span class="id"><a href="GlobDefs.html#cur_tid">cur_tid</a></span> <span class="id">tpc</span>). <span class="tactic">inversion</span> <span class="id">H1</span>;<span class="tactic">auto</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="GlobDefs.html#cur_tid">cur_tid</a></span> <span class="id">tpc</span> = <span class="id"><a href="GlobDefs.html#cur_tid">cur_tid</a></span> <span class="id">spc</span>). <span class="tactic">inversion</span> <span class="id">H0</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H4</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Init.html#init_free">init_free</a></span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Init.html#init_pair_lemma">init_pair_lemma</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> ?;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">H5</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="SimDRF.html#USim_NPDRF_Config">USim_NPDRF_Config</a></span> <span class="kwd">in</span> <span class="id">H5</span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">H0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>( <span class="id"><a href="NPDRF.html#npdrf">NPDRF.npdrf</a></span> (<span class="id"><a href="Soundness.html#Soundness.scunits">scunits</a></span>,<span class="id"><a href="Soundness.html#Soundness.e">e</a></span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="NPDRF.html#npdrf">NPDRF.npdrf</a></span>. <span class="tactic">intro</span>. <span class="tactic">unfold</span> <span class="id"><a href="DRF.html#drf">drf</a></span> <span class="kwd">in</span> <span class="id">Hdrf</span>. <span class="id">contradict</span> <span class="id">Hdrf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="SmileReorder.html#NPRace_Race">SmileReorder.NPRace_Race</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="NPEquiv.html#NPDRF_config">NPDRF_config</a></span> <span class="kwd">in</span> <span class="id">H6</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Init.html#init_property_1_alt">init_property_1_alt</a></span> <span class="kwd">in</span> <span class="id">H6</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="GlobUSimRefine.html#USim_Refine">USim_Refine</a></span> <span class="kwd">in</span> <span class="id">HSim</span> <span class="kwd">as</span> <span class="id">HRefine</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">HRefine</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Soundness.html#seqs_correct_fn_preserved">seqs_correct_fn_preserved</a></span>; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Soundness.html#seqs_correct_ldsims">seqs_correct_ldsims</a></span>; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="Soundness.html#Soundness">Soundness</a></span>.<br/>
<br/>
<h2> Framework final theorem </h2>
<br/>
<div class="doc">Correctness of concurrent compiler correctness:
    for any compilation units <span class="bracket"><span class="id">scunits</span></span> and <span class="bracket"><span class="id">tcunits</span></span>,
    if the <span class="bracket"><span class="id">tcunits</span></span> are compiled from <span class="bracket"><span class="id">scunits</span></span> by <span class="bracket"><span class="id">comps</span></span>,
    and the whole source program <span class="bracket">(<span class="id">scunits</span>, <span class="id">entries</span>)</span> is safe,
    and the whole source program is data-race-free (<span class="bracket"><span class="id">drf</span></span>), 
    and all source compilation units are reach-closed (<span class="bracket"><span class="id">rc_cunits</span></span>), 
    then target program refines the source (<span class="bracket"><span class="id">prog_refine</span></span>) 
 </div>
<span class="kwd">Definition</span> <span class="id"><a name="gcorrect">gcorrect</a></span> {<span class="id">NL</span> <span class="id">L</span>} (<span class="id">comps</span>: @<span class="id"><a href="GAST.html#gcomp">gcomp</a></span> <span class="id"><a href="Soundness.html#NL">NL</a></span> <span class="id"><a href="Soundness.html#L">L</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">scunits</span> <span class="id">tcunits</span> <span class="id">entries</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GAST.html#cunits_transf">cunits_transf</a></span> <span class="id"><a href="Soundness.html#comps">comps</a></span> <span class="id"><a href="Soundness.html#scunits">scunits</a></span> <span class="id"><a href="Soundness.html#tcunits">tcunits</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobSemantics.html#safe_prog">safe_prog</a></span> (<span class="id"><a href="Soundness.html#scunits">scunits</a></span>, <span class="id"><a href="Soundness.html#entries">entries</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="DRF.html#drf">drf</a></span> (<span class="id"><a href="Soundness.html#scunits">scunits</a></span>, <span class="id"><a href="Soundness.html#entries">entries</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Compositionality.html#rc_cunits">rc_cunits</a></span> <span class="id"><a href="Soundness.html#scunits">scunits</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobSemantics.html#prog_refine">prog_refine</a></span> (<span class="id"><a href="Soundness.html#scunits">scunits</a></span>, <span class="id"><a href="Soundness.html#entries">entries</a></span>) (<span class="id"><a href="Soundness.html#tcunits">tcunits</a></span>, <span class="id"><a href="Soundness.html#entries">entries</a></span>).<br/>
<br/>
<div class="doc">Source and target langages of compilers are well-defined (<span class="bracket"><span class="id">wd</span></span>) </div>
<span class="kwd">Definition</span> <span class="id"><a name="wd_comps_langs">wd_comps_langs</a></span> {<span class="id">NL</span> <span class="id">L</span>} (<span class="id">comps</span>: @<span class="id"><a href="GAST.html#gcomp">gcomp</a></span> <span class="id"><a href="Soundness.html#NL">NL</a></span> <span class="id"><a href="Soundness.html#L">L</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">comp</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="Soundness.html#comp">comp</a></span> <span class="id"><a href="Soundness.html#comps">comps</a></span> -&gt; <span class="id"><a href="InteractionSemantics.html#wd">wd</a></span> (<span class="id"><a href="Soundness.html#L">L</a></span> (<span class="id"><a href="GAST.html#slid">slid</a></span> <span class="id"><a href="Soundness.html#comp">comp</a></span>)) /\ <span class="id"><a href="InteractionSemantics.html#wd">wd</a></span> (<span class="id"><a href="Soundness.html#L">L</a></span> (<span class="id"><a href="GAST.html#tlid">tlid</a></span> <span class="id"><a href="Soundness.html#comp">comp</a></span>)).<br/>
<div class="doc">Target languages of compilers are deterministic (<span class="bracket"><span class="id">lang_det</span></span>) </div>
<span class="kwd">Definition</span> <span class="id"><a name="det_comps_tgt_langs">det_comps_tgt_langs</a></span> {<span class="id">NL</span> <span class="id">L</span>} (<span class="id">comps</span>: @<span class="id"><a href="GAST.html#gcomp">gcomp</a></span> <span class="id"><a href="Soundness.html#NL">NL</a></span> <span class="id"><a href="Soundness.html#L">L</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">comp</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="Soundness.html#comp">comp</a></span> <span class="id"><a href="Soundness.html#comps">comps</a></span> -&gt; <span class="id"><a href="InteractionSemantics.html#lang_det">lang_det</a></span> (<span class="id"><a href="Soundness.html#L">L</a></span> (<span class="id"><a href="GAST.html#tlid">tlid</a></span> <span class="id"><a href="Soundness.html#comp">comp</a></span>)).<br/>
<br/>
<div class="doc">Framework final theorem:
    for any sequential compilers <span class="bracket"><span class="id">comps</span></span>, 
    if 
    - <span class="bracket"><span class="id">wd_comps_langs</span> <span class="id">comps</span></span>: source and target languages of compilers are well defined,
    - <span class="bracket"><span class="id">det_comps_tgt_langs</span> <span class="id">comps</span></span>: target languages are deterministic,
    - <span class="bracket"><span class="id">seqs_correct</span></span>: sequential compilers are correct w.r.t. our correctness creteria,
    then <span class="bracket"><span class="id">gcorrect</span> <span class="id">comps</span></span>: the sequential compilers are correct as a whole for compiling concurrent programs </div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="framework_final_theorem">framework_final_theorem</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">NL</span> <span class="id">L</span> (<span class="id">comps</span>: @<span class="id"><a href="GAST.html#gcomp">gcomp</a></span> <span class="id"><a href="Soundness.html#NL">NL</a></span> <span class="id"><a href="Soundness.html#L">L</a></span>),<br/>
&nbsp;&nbsp;<span class="id"><a href="Soundness.html#wd_comps_langs">wd_comps_langs</a></span> <span class="id"><a href="Soundness.html#comps">comps</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="Soundness.html#det_comps_tgt_langs">det_comps_tgt_langs</a></span> <span class="id"><a href="Soundness.html#comps">comps</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="Soundness.html#seqs_correct">seqs_correct</a></span> <span class="id"><a href="Soundness.html#comps">comps</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="Soundness.html#gcorrect">gcorrect</a></span> <span class="id"><a href="Soundness.html#comps">comps</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9171')">Proof.</div>
<div class="proofscript" id="proof9171">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Soundness.html#gcorrect">gcorrect</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">NL</span> <span class="id">L</span> <span class="id">comps</span> <span class="id">Hwd</span> <span class="id">Hdet</span> <span class="id">Hcorrect</span> <span class="id">scunits</span> <span class="id">tcunits</span> <span class="id">entries</span> <span class="id">Hcomp</span> <span class="id">Hsafe</span> <span class="id">Hdrf</span> <span class="id">Hrc</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Soundness.html#framework_sound">framework_sound</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;{ <span class="id">revert</span> <span class="id">Hcomp</span> <span class="id">Hwd</span>; <span class="tactic">clear</span>. <span class="tactic">intro</span> <span class="id">H</span>. <span class="tactic">induction</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">intros</span> <span class="id">cu</span> <span class="id">C</span>. <span class="id">inv</span> <span class="id">C</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">intros</span> <span class="id">cu</span> <span class="id">A</span>. <span class="tactic">destruct</span> <span class="id">A</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">exploit</span> <span class="id">Hwd</span>. <span class="id">left</span>. <span class="tactic">eauto</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">IHcunits_transf</span>. <span class="tactic">intros</span> <span class="id">cu</span>' <span class="id">B</span>. <span class="tactic">apply</span> <span class="id">Hwd</span>. <span class="id">right</span>. <span class="tactic">auto</span>. <span class="tactic">eauto</span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;{ <span class="id">revert</span> <span class="id">Hcomp</span> <span class="id">Hwd</span>; <span class="tactic">clear</span>. <span class="tactic">intro</span> <span class="id">H</span>. <span class="tactic">induction</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">intros</span> <span class="id">cu</span> <span class="id">C</span>. <span class="id">inv</span> <span class="id">C</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">intros</span> <span class="id">cu</span> <span class="id">A</span>. <span class="tactic">destruct</span> <span class="id">A</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">exploit</span> <span class="id">Hwd</span>. <span class="id">left</span>. <span class="tactic">eauto</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">IHcunits_transf</span>. <span class="tactic">intros</span> <span class="id">cu</span>' <span class="id">B</span>. <span class="tactic">apply</span> <span class="id">Hwd</span>. <span class="id">right</span>. <span class="tactic">auto</span>. <span class="tactic">eauto</span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;{ <span class="id">revert</span> <span class="id">Hcomp</span> <span class="id">Hdet</span>; <span class="tactic">clear</span>. <span class="tactic">intro</span> <span class="id">H</span>. <span class="tactic">induction</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">intros</span> <span class="id">cu</span> <span class="id">C</span>. <span class="id">inv</span> <span class="id">C</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">intros</span> <span class="id">cu</span> <span class="id">A</span>. <span class="tactic">destruct</span> <span class="id">A</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> <span class="id">tlid</span> <span class="kwd">with</span> (<span class="id"><a href="GAST.html#tlid">GAST.tlid</a></span> {| <span class="id"><a href="GAST.html#Build_seq_comp_i">slid</a></span> := <span class="id">slid</span>; <span class="id">tlid</span> := <span class="id">tlid</span>; <span class="id">comp</span> := <span class="id">comp0</span> |}) <span class="tactic">by</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hdet</span>. <span class="id">left</span>. <span class="tactic">auto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHcunits_transf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">cu</span>' <span class="id">B</span>. <span class="tactic">apply</span> <span class="id">Hdet</span>. <span class="id">right</span>. <span class="tactic">auto</span>. <span class="tactic">auto</span>. }<br/>
Qed.</div>
<br/>
</div>
<div class="footer"><hr/>Generated by coq2html</div>
</body>
</html>
