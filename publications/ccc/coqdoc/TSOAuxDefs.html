<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module TSOAuxDefs</title>
<meta name="description" content="Documentation of Coq module TSOAuxDefs" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module TSOAuxDefs</h1>
<div class="coq">
<span class="id">From</span> <span class="id">mathcomp.ssreflect</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">fintype</span> <span class="id">ssrnat</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Coqlib.html">Coqlib</a></span> <span class="id"><a href="Maps.html">Maps</a></span> <span class="id"><a href="Axioms.html">Axioms</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Locations.html">Locations</a></span> <span class="id"><a href="AST.html">AST</a></span> <span class="id"><a href="Integers.html">Integers</a></span> <span class="id"><a href="Floats.html">Floats</a></span> <span class="id"><a href="Values.html">Values</a></span> <span class="id"><a href="Events.html">Events</a></span> <span class="id"><a href="Globalenvs.html">Globalenvs</a></span> <span class="id"><a href="Smallstep.html">Smallstep</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Stacklayout.html">Stacklayout</a></span> <span class="id"><a href="Conventions.html">Conventions</a></span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Asm.html">Asm</a></span> <span class="id"><a href="CUAST.html">CUAST</a></span> <span class="id"><a href="ValFP.html">ValFP</a></span> <span class="id"><a href="val_casted.html">val_casted</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="loadframe.html">loadframe</a></span> <span class="id"><a href="Footprint.html">Footprint</a></span> <span class="id"><a href="FPLemmas.html">FPLemmas</a></span> <span class="id"><a href="GMemory.html">GMemory</a></span> <span class="id"><a href="FMemory.html">FMemory</a></span> <span class="id"><a href="FMemOpFP.html">FMemOpFP</a></span> <span class="id"><a href="FMemLemmas.html">FMemLemmas</a></span> <span class="id"><a href="TSOMem.html">TSOMem</a></span> <span class="id"><a href="TSOMemLemmas.html">TSOMemLemmas</a></span> <span class="id"><a href="Memperm.html">Memperm</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="GAST.html">GAST</a></span> <span class="id"><a href="GlobDefs.html">GlobDefs</a></span> <span class="id"><a href="ETrace.html">ETrace</a></span> <span class="id"><a href="Blockset.html">Blockset</a></span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Languages.html">Languages</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="TSOGlobSem.html">TSOGlobSem</a></span> <span class="id"><a href="GlobSemantics.html">GlobSemantics</a></span> <span class="id"><a href="InteractionSemantics.html">InteractionSemantics</a></span> <span class="id"><a href="RGRels.html">RGRels</a></span> <span class="id"><a href="ClientSim.html">ClientSim</a></span> <span class="id"><a href="ObjectSim.html">ObjectSim</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="ASM_local.html">ASM_local</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="AsmLang.html">AsmLang</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="AsmTSO.html">AsmTSO</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="MemAux.html">MemAux</a></span> <span class="id"><a href="TSOStepAuxLemmas.html">TSOStepAuxLemmas</a></span>.<br/>
<span class="kwd">Local</span> <span class="kwd">Ltac</span> <span class="id">simpls</span> := <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
<span class="kwd">Local</span> <span class="id">Transparent</span> <span class="id"><a href="FMemory.html#Mem.load">Mem.load</a></span> <span class="id"><a href="FMemory.html#Mem.alloc">Mem.alloc</a></span> <span class="id"><a href="FMemory.html#Mem.store">Mem.store</a></span> <span class="id"><a href="FMemory.html#Mem.free">Mem.free</a></span>.<br/>
<span class="kwd">Ltac</span> <span class="id">Hsimpl</span>:=<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H1</span>:?<span class="id">a</span>,<span class="id">H2</span>:?<span class="id">a</span>-&gt;?<span class="id">b</span>|-<span class="id">_</span>=&gt;<span class="id">specialize</span> (<span class="id">H2</span> <span class="id">H1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>:<span class="id">_</span>/\<span class="id">_</span>|-<span class="id">_</span>=&gt; <span class="tactic">destruct</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>:<span class="id">exists</span> <span class="id">_</span>,<span class="id">_</span>|-<span class="id">_</span>=&gt;<span class="tactic">destruct</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<span class="kwd">Ltac</span> <span class="id">Esimpl</span>:=<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>:<span class="id">_</span>|-<span class="id">_</span>/\<span class="id">_</span>=&gt;<span class="tactic">split</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>:<span class="id">_</span>|-<span class="id">exists</span> <span class="id">_</span>,<span class="id">_</span>=&gt;<span class="id">eexists</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<span class="kwd">Ltac</span> <span class="id">ex_match</span>:=<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>: <span class="kwd">match</span> ?<span class="id">x</span> <span class="kwd">with</span> <span class="id">_</span> =&gt; <span class="id">_</span> <span class="kwd">end</span> = <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="tactic">destruct</span> <span class="id">x</span> <span class="id">eqn</span>:?<span class="id">Hx</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
<span class="kwd">Ltac</span> <span class="id">ex_match2</span>:=<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>: <span class="id">context</span>[<span class="kwd">match</span> ?<span class="id">x</span> <span class="kwd">with</span> <span class="id">_</span> =&gt; <span class="id">_</span> <span class="kwd">end</span>]  |- <span class="id">_</span> =&gt; <span class="tactic">destruct</span> <span class="id">x</span> <span class="id">eqn</span>:?<span class="id">Hx</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>: <span class="id">_</span> |- <span class="id">context</span>[<span class="kwd">match</span> ?<span class="id">x</span> <span class="kwd">with</span> <span class="id">_</span> =&gt; <span class="id">_</span> <span class="kwd">end</span> ] =&gt; <span class="tactic">destruct</span> <span class="id">x</span> <span class="id">eqn</span>:?<span class="id">Hx</span>;<span class="tactic">try</span> <span class="tactic">discriminate</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<span class="tactic">try</span> <span class="tactic">congruence</span>;<span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="bf_footprint">bf_footprint</a></span> (<span class="id">bf</span>:<span class="id"><a href="TSOMem.html#buffer">buffer</a></span>):<span class="id"><a href="Footprint.html#FP.t">FP.t</a></span>:=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span><br/>
&nbsp;&nbsp;| <span class="id">x</span>::<span class="id">ls</span> =&gt; <span class="id"><a href="Footprint.html#FP.union">FP.union</a></span> (<span class="id"><a href="TSOMem.html#bi_footprint">bi_footprint</a></span> <span class="id">x</span>)(<span class="id"><a href="TSOAuxDefs.html#bf_footprint">bf_footprint</a></span> <span class="id">ls</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="bf_footprint_app_union">bf_footprint_app_union</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf1</span> <span class="id">bf2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#bf_footprint">bf_footprint</a></span> (<span class="id"><a href="TSOAuxDefs.html#bf1">bf1</a></span> ++ <span class="id"><a href="TSOAuxDefs.html#bf2">bf2</a></span>) = <span class="id"><a href="Footprint.html#FP.union">FP.union</a></span> (<span class="id"><a href="TSOAuxDefs.html#bf_footprint">bf_footprint</a></span> <span class="id"><a href="TSOAuxDefs.html#bf1">bf1</a></span>)(<span class="id"><a href="TSOAuxDefs.html#bf_footprint">bf_footprint</a></span> <span class="id"><a href="TSOAuxDefs.html#bf2">bf2</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9225')">Proof.</div>
<div class="proofscript" id="proof9225">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf1</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#FP.emp_union_fp">FP.emp_union_fp</a></span>;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> &lt;-<span class="id"><a href="Footprint.html#FP.fp_union_assoc">FP.fp_union_assoc</a></span>. <span class="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="bi_footprint_cmps_emp">bi_footprint_cmps_emp</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span>, <span class="id"><a href="Footprint.html#FP.cmps">FP.cmps</a></span> (<span class="id"><a href="TSOMem.html#bi_footprint">bi_footprint</a></span> <span class="id"><a href="TSOAuxDefs.html#bi">bi</a></span>) = <span class="id"><a href="Footprint.html#Locs.emp">Locs.emp</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9226')">Proof.</div>
<div class="proofscript" id="proof9226">
 <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#bi_footprint">bi_footprint</a></span>. <span class="tactic">destruct</span> <span class="id">bi</span>;<span class="tactic">auto</span>. Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="bi_footprint_reads_emp">bi_footprint_reads_emp</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span>, <span class="id"><a href="Footprint.html#FP.reads">FP.reads</a></span> (<span class="id"><a href="TSOMem.html#bi_footprint">bi_footprint</a></span> <span class="id"><a href="TSOAuxDefs.html#bi">bi</a></span>) = <span class="id"><a href="Footprint.html#Locs.emp">Locs.emp</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9227')">Proof.</div>
<div class="proofscript" id="proof9227">
 <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#bi_footprint">bi_footprint</a></span>. <span class="tactic">destruct</span> <span class="id">bi</span>;<span class="tactic">auto</span>. Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="bf_footprint_cmps_emp">bf_footprint_cmps_emp</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span>, <span class="id"><a href="Footprint.html#FP.cmps">FP.cmps</a></span> (<span class="id"><a href="TSOAuxDefs.html#bf_footprint">bf_footprint</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>) = <span class="id"><a href="Footprint.html#Locs.emp">Locs.emp</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9228')">Proof.</div>
<div class="proofscript" id="proof9228">
 <span class="tactic">induction</span> <span class="id">bf</span>;<span class="tactic">auto</span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="TSOAuxDefs.html#bi_footprint_cmps_emp">bi_footprint_cmps_emp</a></span>. <span class="tactic">auto</span>. Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="bf_footprint_reads_emp">bf_footprint_reads_emp</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span>, <span class="id"><a href="Footprint.html#FP.reads">FP.reads</a></span> (<span class="id"><a href="TSOAuxDefs.html#bf_footprint">bf_footprint</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>) = <span class="id"><a href="Footprint.html#Locs.emp">Locs.emp</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9229')">Proof.</div>
<div class="proofscript" id="proof9229">
 <span class="tactic">induction</span> <span class="id">bf</span>;<span class="tactic">auto</span>;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="TSOAuxDefs.html#bi_footprint_reads_emp">bi_footprint_reads_emp</a></span>;<span class="tactic">auto</span>. Qed.</div>
<span class="kwd">Definition</span> <span class="id"><a name="eff_eq">eff_eq</a></span> <span class="id">fp1</span> <span class="id">fp2</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="Footprint.html#FP.writes">FP.writes</a></span> <span class="id"><a href="TSOAuxDefs.html#fp1">fp1</a></span> = <span class="id"><a href="Footprint.html#FP.writes">FP.writes</a></span> <span class="id"><a href="TSOAuxDefs.html#fp2">fp2</a></span> /\ <span class="id"><a href="Footprint.html#FP.frees">FP.frees</a></span> <span class="id"><a href="TSOAuxDefs.html#fp1">fp1</a></span> = <span class="id"><a href="Footprint.html#FP.frees">FP.frees</a></span> <span class="id"><a href="TSOAuxDefs.html#fp2">fp2</a></span>.<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="eff_eq_refl">eff_eq_refl</a></span>:<span class="kwd">forall</span> <span class="id">fp</span>, <span class="id"><a href="TSOAuxDefs.html#eff_eq">eff_eq</a></span> <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span>. <span class="kwd">Proof</span>. <span class="tactic">split</span>;<span class="tactic">auto</span>. Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="eff_eq_union">eff_eq_union</a></span>: <span class="kwd">forall</span> <span class="id">fp1</span> <span class="id">fp2</span> <span class="id">fp1</span>' <span class="id">fp2</span>',<span class="id"><a href="TSOAuxDefs.html#eff_eq">eff_eq</a></span> <span class="id"><a href="TSOAuxDefs.html#fp1">fp1</a></span> <span class="id">fp1</span>'-&gt;<span class="id"><a href="TSOAuxDefs.html#eff_eq">eff_eq</a></span> <span class="id"><a href="TSOAuxDefs.html#fp2">fp2</a></span> <span class="id">fp2</span>'-&gt;<span class="id"><a href="TSOAuxDefs.html#eff_eq">eff_eq</a></span> (<span class="id"><a href="Footprint.html#FP.union">FP.union</a></span> <span class="id"><a href="TSOAuxDefs.html#fp1">fp1</a></span> <span class="id"><a href="TSOAuxDefs.html#fp2">fp2</a></span>)(<span class="id"><a href="Footprint.html#FP.union">FP.union</a></span> <span class="id">fp1</span>' <span class="id">fp2</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9230')">Proof.</div>
<div class="proofscript" id="proof9230">
 <span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#eff_eq">eff_eq</a></span>;<span class="id">constructor</span>;<span class="id">Hsimpl</span>;<span class="tactic">unfold</span> <span class="id"><a href="Footprint.html#FP.union">FP.union</a></span>;<span class="tactic">simpl</span>; <span class="tactic">congruence</span>. Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="fpsmile_eff_eq_trans">fpsmile_eff_eq_trans</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fp0</span> <span class="id">fp1</span> <span class="id">fp2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Footprint.html#FP.smile">FP.smile</a></span> <span class="id"><a href="TSOAuxDefs.html#fp0">fp0</a></span> <span class="id"><a href="TSOAuxDefs.html#fp1">fp1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#eff_eq">eff_eq</a></span> <span class="id"><a href="TSOAuxDefs.html#fp0">fp0</a></span> <span class="id"><a href="TSOAuxDefs.html#fp2">fp2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Footprint.html#FP.reads">FP.reads</a></span> <span class="id"><a href="TSOAuxDefs.html#fp2">fp2</a></span> = <span class="id"><a href="Footprint.html#Locs.emp">Locs.emp</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Footprint.html#FP.cmps">FP.cmps</a></span> <span class="id"><a href="TSOAuxDefs.html#fp2">fp2</a></span> = <span class="id"><a href="Footprint.html#Locs.emp">Locs.emp</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Footprint.html#FP.smile">FP.smile</a></span> <span class="id"><a href="TSOAuxDefs.html#fp2">fp2</a></span> <span class="id"><a href="TSOAuxDefs.html#fp1">fp1</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9231')">Proof.</div>
<div class="proofscript" id="proof9231">
&nbsp;&nbsp;<span class="tactic">intros</span> ? ? ? [] [] ? ?;<span class="id">Hsimpl</span>;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">try</span> <span class="tactic">split</span>;<span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span>. <span class="id">Locs.unfolds</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span>. <span class="id">Locs.unfolds</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span>. <span class="id">Locs.unfolds</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<span class="kwd">Definition</span> <span class="id"><a name="buffer_item_local_alloc">buffer_item_local_alloc</a></span> <span class="id">bi</span> <span class="id">fl</span>:=  <br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="TSOAuxDefs.html#bi">bi</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id">b</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id"><a href="MemAux.html#in_fl">in_fl</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id">b</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="buffer_local_alloc">buffer_local_alloc</a></span> <span class="id">bf</span> <span class="id">fl</span>:=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOAuxDefs.html#bi">bi</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>-&gt; <span class="id"><a href="TSOAuxDefs.html#buffer_item_local_alloc">buffer_item_local_alloc</a></span> <span class="id"><a href="TSOAuxDefs.html#bi">bi</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span>.<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="buffer_local_alloc_app">buffer_local_alloc_app</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf1</span> <span class="id">bf2</span> <span class="id">fl</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_local_alloc">buffer_local_alloc</a></span> <span class="id"><a href="TSOAuxDefs.html#bf1">bf1</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_local_alloc">buffer_local_alloc</a></span> <span class="id"><a href="TSOAuxDefs.html#bf2">bf2</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_local_alloc">buffer_local_alloc</a></span> (<span class="id"><a href="TSOAuxDefs.html#bf1">bf1</a></span> ++ <span class="id"><a href="TSOAuxDefs.html#bf2">bf2</a></span>) <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9232')">Proof.</div>
<div class="proofscript" id="proof9232">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#buffer_local_alloc">buffer_local_alloc</a></span> <span class="kwd">in</span> *;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_or">in_app_or</a></span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> [];<span class="tactic">eauto</span>.<br/>
Qed.</div>
<span class="kwd">Definition</span> <span class="id"><a name="BufferEff">BufferEff</a></span> <span class="id">bf</span> <span class="id">bf</span>' <span class="id">fp</span> <span class="id">fl</span>:=<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">ls</span>, <span class="id">bf</span>' = <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> ++ <span class="id"><a href="TSOAuxDefs.html#ls">ls</a></span> /\ <span class="id"><a href="TSOAuxDefs.html#eff_eq">eff_eq</a></span> (<span class="id"><a href="TSOAuxDefs.html#bf_footprint">bf_footprint</a></span> <span class="id"><a href="TSOAuxDefs.html#ls">ls</a></span>) <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> /\ <span class="id"><a href="TSOAuxDefs.html#buffer_local_alloc">buffer_local_alloc</a></span> <span class="id"><a href="TSOAuxDefs.html#ls">ls</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span>.<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="BufferEff_refl">BufferEff_refl</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">fl</span>,<span class="id"><a href="TSOAuxDefs.html#BufferEff">BufferEff</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9233')">Proof.</div>
<div class="proofscript" id="proof9233">
 <span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#BufferEff">BufferEff</a></span>;<span class="tactic">intros</span>;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>;<span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_eq_refl">eff_eq_refl</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#buffer_local_alloc">buffer_local_alloc</a></span>;<span class="tactic">intros</span>;<span class="id">inv</span> <span class="id">H</span>. Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="BufferEff_refl2">BufferEff_refl2</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">fl</span> <span class="id">fp</span>,<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> = <span class="id"><a href="Footprint.html#Locs.emp">Locs.emp</a></span> -&gt; <span class="id"><a href="TSOAuxDefs.html#BufferEff">BufferEff</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9234')">Proof.</div>
<div class="proofscript" id="proof9234">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#BufferEff">BufferEff</a></span>;<span class="tactic">intros</span>;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="Footprint.html#Locs.eq">Locs.eq</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> <span class="id">fp</span>) <span class="id"><a href="Footprint.html#Locs.emp">Locs.emp</a></span>). <span class="tactic">rewrite</span> <span class="id">H</span>;<span class="tactic">apply</span> <span class="id"><a href="Footprint.html#Locs.eq_refl">Locs.eq_refl</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">Locs.unfolds</span>. <span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> <span class="id">fp</span>;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#eff_eq">eff_eq</a></span>;<span class="tactic">split</span>;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Footprint.html#Locs.locs_eq">Locs.locs_eq</a></span>. <span class="id">Locs.unfolds</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H0</span> <span class="id">b</span> <span class="id">ofs</span>). <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#orb_false_iff">orb_false_iff</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> [];<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Footprint.html#Locs.locs_eq">Locs.locs_eq</a></span>. <span class="id">Locs.unfolds</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H0</span> <span class="id">b</span> <span class="id">ofs</span>). <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#orb_false_iff">orb_false_iff</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> [];<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#buffer_local_alloc">buffer_local_alloc</a></span>;<span class="tactic">intros</span>;<span class="id">inv</span> <span class="id">H0</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="BufferEff_union">BufferEff_union</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">bf</span>' <span class="id">bf</span>'' <span class="id">fp</span> <span class="id">fp</span>' <span class="id">fl</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#BufferEff">BufferEff</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id">bf</span>' <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#BufferEff">BufferEff</a></span> <span class="id">bf</span>' <span class="id">bf</span>'' <span class="id">fp</span>' <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#BufferEff">BufferEff</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id">bf</span>'' (<span class="id"><a href="Footprint.html#FP.union">FP.union</a></span> <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id">fp</span>') <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9235')">Proof.</div>
<div class="proofscript" id="proof9235">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#BufferEff">BufferEff</a></span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">Hsimpl</span>. <span class="id">exists</span> (<span class="id">x0</span> ++ <span class="id">x</span>). <span class="tactic">rewrite</span> <span class="id">H0</span>,<span class="id">H</span>. <span class="tactic">split</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">rewrite</span> <span class="id"><a href="TSOAuxDefs.html#bf_footprint_app_union">bf_footprint_app_union</a></span>. <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_eq_union">eff_eq_union</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#buffer_local_alloc_app">buffer_local_alloc_app</a></span>;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="eff_chg">eff_chg</a></span> (<span class="id">bf</span> <span class="id">bf</span>':<span class="id"><a href="TSOMem.html#buffer">buffer</a></span>):<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>:=<br/>
&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#buffer_eq">buffer_eq</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> &amp;&amp; <span class="id"><a href="TSOMem.html#buffer_eq">buffer_eq</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id">bf</span>'.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="eff_chg_f">eff_chg_f</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">bf</span>', <span class="id"><a href="TSOAuxDefs.html#eff_chg">eff_chg</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id">bf</span>'= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> -&gt; <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> &lt;&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> \/ <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> &lt;&gt; <span class="id">bf</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9236')">Proof.</div>
<div class="proofscript" id="proof9236">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#eff_chg">eff_chg</a></span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="TSOMem.html#buffer_eq">buffer_eq</a></span>;<span class="tactic">try</span> <span class="id">contradiction</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="TSOMem.html#buffer_eq">buffer_eq</a></span>;<span class="tactic">try</span> <span class="tactic">congruence</span>;<span class="tactic">auto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="eff_chg_t">eff_chg_t</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">bf</span>', <span class="id"><a href="TSOAuxDefs.html#eff_chg">eff_chg</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id">bf</span>'= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt; <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> /\ <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> = <span class="id">bf</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9237')">Proof.</div>
<div class="proofscript" id="proof9237">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#eff_chg">eff_chg</a></span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="TSOMem.html#buffer_eq">buffer_eq</a></span>;<span class="tactic">try</span> <span class="tactic">discriminate</span>;<span class="tactic">auto</span>;<span class="tactic">subst</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="TSOMem.html#buffer_eq">buffer_eq</a></span>;<span class="tactic">try</span> <span class="tactic">discriminate</span>;<span class="tactic">auto</span>.<br/>
Qed.</div>
<span class="kwd">Section</span> <span class="id"><a name="EFFBASE">EFFBASE</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">CoFixpoint</span> <span class="id"><a name="NFL">NFL</a></span>:<span class="id"><a href="MemAux.html#freelist">freelist</a></span>:= <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#const">Streams.const</a></span> 1%<span class="id">positive</span>.<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="tsostorev_app">tsostorev_app</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">chunk</span> <span class="id">m</span> <span class="id">b</span> <span class="id">v</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tsostorev">tsostorev</a></span> <span class="id"><a href="TSOAuxDefs.html#chunk">chunk</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#v">v</a></span> =<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">ls</span>, <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">m</span>' = <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> ++ <span class="id"><a href="TSOAuxDefs.html#ls">ls</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9238')">Proof.</div>
<div class="proofscript" id="proof9238">
 <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsostorev">tsostorev</a></span>,<span class="id"><a href="TSOMem.html#tsostore">tsostore</a></span>;<span class="tactic">intros</span>. <span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H</span>. <span class="tactic">simpl</span>;<span class="tactic">eauto</span>. Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="tsostorev_bfeff">tsostorev_bfeff</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">chunk</span> <span class="id">m</span> <span class="id">b</span> <span class="id">v</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tsostorev">tsostorev</a></span> <span class="id"><a href="TSOAuxDefs.html#chunk">chunk</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#v">v</a></span> =<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fl</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#BufferEff">BufferEff</a></span> (<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span>)(<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">m</span>') (<span class="id"><a href="FMemOpFP.html#storev_fp">storev_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#chunk">chunk</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span>) <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9239')">Proof.</div>
<div class="proofscript" id="proof9239">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsostorev">tsostorev</a></span>,<span class="id"><a href="TSOMem.html#tsostore">tsostore</a></span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#buffer_insert">buffer_insert</a></span>,<span class="id"><a href="TSOAuxDefs.html#BufferEff">BufferEff</a></span>;<span class="tactic">simpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">eexists</span>;<span class="tactic">split</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> !<span class="id"><a href="Footprint.html#FP.fp_union_emp">FP.fp_union_emp</a></span>. <span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_eq_refl">eff_eq_refl</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#buffer_local_alloc">buffer_local_alloc</a></span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>;<span class="tactic">simpl</span>;<span class="tactic">auto</span>. <span class="id">inv</span> <span class="id">H0</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="store_stack_fmem_bfeff">store_stack_fmem_bfeff</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">stk</span> <span class="id">ty</span> <span class="id">v</span> <span class="id">a</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#store_stack_fmem">store_stack_fmem</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#stk">stk</a></span> <span class="id"><a href="TSOAuxDefs.html#ty">ty</a></span> <span class="id"><a href="TSOAuxDefs.html#v">v</a></span> <span class="id"><a href="TSOAuxDefs.html#a">a</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fl</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#BufferEff">BufferEff</a></span> (<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span>)(<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">m</span>')(<span class="id"><a href="loadframe.html#store_stack_fp">store_stack_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#stk">stk</a></span> <span class="id"><a href="TSOAuxDefs.html#ty">ty</a></span> <span class="id"><a href="TSOAuxDefs.html#v">v</a></span>) <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9240')">Proof.</div>
<div class="proofscript" id="proof9240">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#store_stack_fmem">store_stack_fmem</a></span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tsostorev_bfeff">tsostorev_bfeff</a></span>;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="store_stack_fmem_bf_app">store_stack_fmem_bf_app</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">stk</span> <span class="id">ty</span> <span class="id">v</span> <span class="id">a</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#store_stack_fmem">store_stack_fmem</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#stk">stk</a></span> <span class="id"><a href="TSOAuxDefs.html#ty">ty</a></span> <span class="id"><a href="TSOAuxDefs.html#v">v</a></span> <span class="id"><a href="TSOAuxDefs.html#a">a</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">ls</span>, <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">m</span>' = <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> ++ <span class="id"><a href="TSOAuxDefs.html#ls">ls</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9241')">Proof.</div>
<div class="proofscript" id="proof9241">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOAuxDefs.html#store_stack_fmem_bfeff">store_stack_fmem_bfeff</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">instantiate</span>(1:=<span class="id"><a href="TSOAuxDefs.html#NFL">NFL</a></span>).<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#BufferEff">BufferEff</a></span>;<span class="tactic">intros</span>;<span class="id">Hsimpl</span>;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="tsoalloc_app">tsoalloc_app</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">m</span>' <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tsoalloc">tsoalloc</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#lo">lo</a></span> <span class="id"><a href="TSOAuxDefs.html#hi">hi</a></span> (<span class="id">m</span>',<span class="id"><a href="TSOAuxDefs.html#b">b</a></span>)-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">ls</span>,<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">m</span>' = <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> ++<span class="id"><a href="TSOAuxDefs.html#ls">ls</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9242')">Proof.</div>
<div class="proofscript" id="proof9242">
&nbsp;&nbsp;<span class="tactic">inversion</span> 1;<span class="tactic">subst</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#buffer_insert">buffer_insert</a></span>;<span class="tactic">simpl</span>;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="tsoalloc_bfeff">tsoalloc_bfeff</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">m</span>' <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tsoalloc">tsoalloc</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#lo">lo</a></span> <span class="id"><a href="TSOAuxDefs.html#hi">hi</a></span> (<span class="id">m</span>',<span class="id"><a href="TSOAuxDefs.html#b">b</a></span>)-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#BufferEff">BufferEff</a></span> (<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span>)(<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">m</span>')(<span class="id"><a href="AsmTSO.html#tsoalloc_fp">tsoalloc_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#lo">lo</a></span> <span class="id"><a href="TSOAuxDefs.html#hi">hi</a></span>)(<span class="id"><a href="FMemory.html#Mem.freelist">Mem.freelist</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9243')">Proof.</div>
<div class="proofscript" id="proof9243">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#BufferEff">BufferEff</a></span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="tactic">simpl</span>. <span class="id">Esimpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#FP.fp_union_emp">FP.fp_union_emp</a></span>. <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_eq_refl">eff_eq_refl</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#buffer_local_alloc">buffer_local_alloc</a></span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#buffer_item_local_alloc">buffer_item_local_alloc</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span>,<span class="id"><a href="MemAux.html#get_block">get_block</a></span>,<span class="id"><a href="MemAux.html#in_fl">in_fl</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H6</span>. <span class="tactic">rewrite</span> <span class="id">H</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>.<br/>
Qed.</div>
<span class="kwd">Local</span> <span class="kwd">Ltac</span> <span class="id">trynil</span>:=<br/>
&nbsp;&nbsp;<span class="tactic">try</span> (<span class="id">exists</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>;<span class="tactic">auto</span>;<span class="tactic">fail</span>).<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="store_args_fmem_bf_app">store_args_fmem_bf_app</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">args</span> <span class="id">tys</span> <span class="id">z</span> <span class="id">m</span> <span class="id">stk</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#store_args_rec_fmem">store_args_rec_fmem</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#stk">stk</a></span> <span class="id"><a href="TSOAuxDefs.html#z">z</a></span> <span class="id"><a href="TSOAuxDefs.html#args">args</a></span> <span class="id"><a href="TSOAuxDefs.html#tys">tys</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">ls</span>, <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">m</span>' = <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> ++ <span class="id"><a href="TSOAuxDefs.html#ls">ls</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9244')">Proof.</div>
<div class="proofscript" id="proof9244">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">args</span>;<span class="tactic">simpl</span>;<span class="tactic">intros</span>. <span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H</span>;<span class="tactic">eauto</span>. <span class="id">trynil</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match</span>;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;1,2,4,5,6: <span class="tactic">apply</span> <span class="id">IHargs</span> <span class="kwd">in</span> <span class="id">H</span>;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#store_stack_fmem_bf_app">store_stack_fmem_bf_app</a></span> <span class="kwd">in</span> <span class="id">Hx1</span>; <span class="id">Hsimpl</span>; <span class="tactic">rewrite</span> <span class="id">H</span>,<span class="id">H0</span>,&lt;-<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHargs</span> <span class="kwd">in</span> <span class="id">H</span>;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#store_stack_fmem_bf_app">store_stack_fmem_bf_app</a></span> <span class="kwd">in</span> <span class="id">Hx2</span>;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#store_stack_fmem_bf_app">store_stack_fmem_bf_app</a></span> <span class="kwd">in</span> <span class="id">Hx3</span>;<span class="id">Hsimpl</span>;<span class="tactic">rewrite</span> <span class="id">H</span>,<span class="id">H0</span>,<span class="id">H1</span>,&lt;-!<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="store_args_fmem_bfeff">store_args_fmem_bfeff</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">args</span> <span class="id">tys</span> <span class="id">z</span> <span class="id">m</span> <span class="id">stk</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#store_args_rec_fmem">store_args_rec_fmem</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> (<span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id"><a href="TSOAuxDefs.html#stk">stk</a></span> <span class="id"><a href="Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) <span class="id"><a href="TSOAuxDefs.html#z">z</a></span> <span class="id"><a href="TSOAuxDefs.html#args">args</a></span> <span class="id"><a href="TSOAuxDefs.html#tys">tys</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fl</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#BufferEff">BufferEff</a></span> (<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span>)(<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">m</span>')(<span class="id"><a href="loadframe.html#store_args_rec_fp">store_args_rec_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#stk">stk</a></span> <span class="id"><a href="TSOAuxDefs.html#z">z</a></span> <span class="id"><a href="TSOAuxDefs.html#tys">tys</a></span>) <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9245')">Proof.</div>
<div class="proofscript" id="proof9245">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">args</span>;<span class="tactic">simpl</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match</span>. <span class="id">inv</span> <span class="id">Hx</span>. <span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#BufferEff">BufferEff</a></span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_eq_refl">eff_eq_refl</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#buffer_local_alloc">buffer_local_alloc</a></span>;<span class="tactic">intros</span>;<span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match</span>;<span class="tactic">subst</span>;<span class="id">simpls</span>;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">try</span> <span class="id">solve</span>[<span class="tactic">eapply</span> <span class="id">IHargs</span> <span class="kwd">with</span>(<span class="id">fl</span>:=<span class="id">fl</span>) <span class="kwd">in</span> <span class="id">H</span>;<span class="tactic">eauto</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#BufferEff_union">BufferEff_union</a></span>;<span class="tactic">eauto</span>;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#BufferEff">BufferEff</a></span>;<span class="id">Esimpl</span>;<span class="tactic">simpl</span>;<span class="tactic">eauto</span>;<span class="tactic">simpl</span>;[<span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#FP.fp_union_emp">FP.fp_union_emp</a></span>;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_eq_refl">eff_eq_refl</a></span>|<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#buffer_local_alloc">buffer_local_alloc</a></span>,<span class="id"><a href="TSOAuxDefs.html#buffer_item_local_alloc">buffer_item_local_alloc</a></span>;<span class="tactic">intros</span>;<span class="id">inv</span> <span class="id">H0</span>;[<span class="tactic">auto</span>|<span class="id">inv</span> <span class="id">H1</span>]]].<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHargs</span> <span class="kwd">with</span>(<span class="id">fl</span>:=<span class="id">fl</span>) <span class="kwd">in</span> <span class="id">H</span>;<span class="tactic">eauto</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#BufferEff_union">BufferEff_union</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#BufferEff">BufferEff</a></span>;<span class="id">Esimpl</span>;<span class="tactic">simpl</span>;<span class="tactic">eauto</span>;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#FP.fp_union_emp">FP.fp_union_emp</a></span>,<span class="id"><a href="Footprint.html#FP.union_comm_eq">FP.union_comm_eq</a></span>. <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_eq_refl">eff_eq_refl</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#buffer_local_alloc">buffer_local_alloc</a></span>,<span class="id"><a href="TSOAuxDefs.html#buffer_item_local_alloc">buffer_item_local_alloc</a></span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>;<span class="tactic">auto</span>. <span class="id">inv</span> <span class="id">H1</span>;<span class="tactic">auto</span>. <span class="id">inv</span> <span class="id">H0</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="loadv_eff_emp">loadv_eff_emp</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ge</span> <span class="id">chunk</span> <span class="id">a</span> <span class="id">rs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="AsmLang.html#exec_load_fp">exec_load_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#chunk">chunk</a></span> <span class="id"><a href="TSOAuxDefs.html#a">a</a></span> <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span>) = <span class="id"><a href="Footprint.html#Locs.emp">Locs.emp</a></span> .<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9246')">Proof.</div>
<div class="proofscript" id="proof9246">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>,<span class="id"><a href="AsmLang.html#exec_load_fp">exec_load_fp</a></span>,<span class="id"><a href="FMemOpFP.html#loadv_fp">loadv_fp</a></span>;<span class="id">Locs.unfolds</span>;<span class="tactic">intros</span>;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="TSO_bf_add">TSO_bf_add</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ge</span> <span class="id">fl</span> <span class="id">c</span> <span class="id">gm</span> <span class="id">bf</span> <span class="id">fp</span> <span class="id">c</span>' <span class="id">gm</span>' <span class="id">bf</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#tsostep">tsostep</a></span> <span class="id"><a href="TSOAuxDefs.html#ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> (<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>,<span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span>) <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id">c</span>' (<span class="id">bf</span>',<span class="id">gm</span>')-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">ls</span>, <span class="id">bf</span>' = <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> ++ <span class="id"><a href="TSOAuxDefs.html#ls">ls</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9247')">Proof.</div>
<div class="proofscript" id="proof9247">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">bf</span> = <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> {|<span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span>:=<span class="id">bf</span>;<span class="id">fmemory</span>:=<span class="id">fm</span>|}). <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> {|<span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span>:=<span class="id">bf</span>;<span class="id">fmemory</span>:=<span class="id">fm</span>|}.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H8</span>;<span class="id">trynil</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">i</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<span class="tactic">try</span> <span class="id">contradiction</span>;<span class="id">inv</span> <span class="id">H4</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="id">trynil</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#exec_load_TSO">exec_load_TSO</a></span> <span class="kwd">in</span> <span class="id">H5</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H5</span>;<span class="id">trynil</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">try</span> (<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#exec_store_TSO">exec_store_TSO</a></span> <span class="kwd">in</span> <span class="id">H4</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H4</span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tsostorev_app">tsostorev_app</a></span>;<span class="tactic">eauto</span>;<span class="tactic">fail</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">try</span> (<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#tso_goto_label">tso_goto_label</a></span> <span class="kwd">in</span> <span class="id">H4</span>;    <span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H4</span>; <span class="id">trynil</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#buffer_insert">buffer_insert</a></span>;<span class="tactic">simpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tsostorev_app">tsostorev_app</a></span> <span class="kwd">in</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tsostorev_app">tsostorev_app</a></span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tsoalloc_app">tsoalloc_app</a></span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>. <span class="tactic">rewrite</span> <span class="id">H4</span>,<span class="id">H</span>,<span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;-!<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#tsoalloc_app">tsoalloc_app</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#store_args_fmem_bf_app">store_args_fmem_bf_app</a></span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;<span class="id">Hsimpl</span>. <span class="tactic">rewrite</span> <span class="id">H</span>,<span class="id">H1</span>,&lt;-<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="TSO_bfeff">TSO_bfeff</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ge</span> <span class="id">fl</span> <span class="id">c</span> <span class="id">gm</span> <span class="id">bf</span> <span class="id">fp</span> <span class="id">c</span>' <span class="id">gm</span>' <span class="id">bf</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#tsostep">tsostep</a></span> <span class="id"><a href="TSOAuxDefs.html#ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> (<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>,<span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span>) <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id">c</span>' (<span class="id">bf</span>',<span class="id">gm</span>')-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#eff_chg">eff_chg</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id">bf</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#BufferEff">BufferEff</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id">bf</span>' <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9248')">Proof.</div>
<div class="proofscript" id="proof9248">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rename</span> <span class="id">H0</span> <span class="id">into</span> <span class="id">R</span>. <span class="id">inv</span> <span class="id">H</span>;<span class="id">inv</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">bf</span> = <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> {|<span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span>:=<span class="id">bf</span>;<span class="id">fmemory</span>:=<span class="id">fm</span>|}). <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">fm</span> = <span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> {|<span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span>:=<span class="id">bf</span>;<span class="id">fmemory</span>:=<span class="id">fm</span>|}). <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> {|<span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span>:=<span class="id">bf</span>;<span class="id">fmemory</span>:=<span class="id">fm</span>|}.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rename</span> <span class="id">H0</span> <span class="id">into</span> <span class="id">R2</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H8</span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#BufferEff_refl">BufferEff_refl</a></span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">i</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<span class="id">ex_match</span>;<span class="tactic">try</span> <span class="id">contradiction</span>;<span class="id">inv</span> <span class="id">H4</span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#BufferEff_refl">BufferEff_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">try</span> (<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#exec_load_TSO">exec_load_TSO</a></span> <span class="kwd">in</span> <span class="id">H5</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H5</span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#BufferEff_refl2">BufferEff_refl2</a></span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#loadv_eff_emp">loadv_eff_emp</a></span>;<span class="tactic">fail</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">try</span> (<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#exec_store_TSO">exec_store_TSO</a></span> <span class="kwd">in</span> <span class="id">H5</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H5</span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tsostorev_bfeff">tsostorev_bfeff</a></span>;<span class="tactic">eauto</span>;<span class="tactic">fail</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Local</span> <span class="kwd">Ltac</span> <span class="id">loc_emp</span>:= <span class="tactic">try</span> <span class="tactic">rewrite</span> !<span class="id"><a href="Footprint.html#Locs.locs_union_emp">Locs.locs_union_emp</a></span>,!<span class="id"><a href="Footprint.html#Locs.emp_union_locs">Locs.emp_union_locs</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Local</span> <span class="kwd">Ltac</span> <span class="id">loc_emp</span>':=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>,<span class="id"><a href="AsmTSO.html#compare_ints_TSO_fp">compare_ints_TSO_fp</a></span>,<span class="id"><a href="AsmTSO.html#tso_cmpu_bool_fp_total">tso_cmpu_bool_fp_total</a></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#compare_longs_TSO_fp">compare_longs_TSO_fp</a></span>,<span class="id"><a href="AsmTSO.html#tso_cmplu_bool_fp_total">tso_cmplu_bool_fp_total</a></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#tso_weak_valid_pointer_fp">tso_weak_valid_pointer_fp</a></span>,<span class="id"><a href="FMemOpFP.html#valid_pointer_fp">valid_pointer_fp</a></span>;<span class="tactic">simpl</span>;<span class="id">ex_match2</span>;<span class="tactic">simpl</span>;<span class="id">loc_emp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">try</span> (<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#BufferEff_refl2">BufferEff_refl2</a></span>;<span class="id">loc_emp</span>';<span class="tactic">fail</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">try</span> <span class="id">solve</span>[<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#tso_goto_label">tso_goto_label</a></span> <span class="kwd">in</span> <span class="id">H5</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H5</span>;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#BufferEff_refl">BufferEff_refl</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#BufferEff_union">BufferEff_union</a></span>. <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#BufferEff_refl2">BufferEff_refl2</a></span>;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#loadv_fp">loadv_fp</a></span>,<span class="id"><a href="FMemOpFP.html#load_fp">load_fp</a></span>;<span class="id">loc_emp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#BufferEff">BufferEff</a></span>. <span class="id">Esimpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#FP.fp_union_emp">FP.fp_union_emp</a></span>. <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_eq_refl">eff_eq_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#buffer_local_alloc">buffer_local_alloc</a></span>. <span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>;<span class="tactic">auto</span>. <span class="id">inv</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="id">simpls</span>;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_chg_f">eff_chg_f</a></span> <span class="kwd">in</span> <span class="id">R</span> <span class="kwd">as</span> [];<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tsoalloc_bfeff">tsoalloc_bfeff</a></span> <span class="kwd">in</span> <span class="id">H3</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#BufferEff_union">BufferEff_union</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#BufferEff_union">BufferEff_union</a></span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tsostorev_bfeff">tsostorev_bfeff</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#BufferEff_refl2">BufferEff_refl2</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H5</span>;<span class="tactic">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">ge</span> <span class="id">fp</span> <span class="id">rs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">args</span>;<span class="tactic">simpl</span>;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H5</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H5</span>. <span class="tactic">apply</span> <span class="id">IHargs</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="InteractionSemantics.html#effects_union">effects_union</a></span>,<span class="id">H2</span>,<span class="id"><a href="Footprint.html#Locs.locs_union_emp">Locs.locs_union_emp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H2</span> <span class="id">IHargs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">H1</span>;<span class="tactic">auto</span>;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#loadv_fp">loadv_fp</a></span>;<span class="id">ex_match2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H</span>,<span class="id"><a href="InteractionSemantics.html#effects_union">effects_union</a></span>,<span class="id">IHeval_builtin_arg_fp1</span>,<span class="id">IHeval_builtin_arg_fp2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#BufferEff_refl2">BufferEff_refl2</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H3</span>. <span class="tactic">clear</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">H3</span>;<span class="tactic">auto</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H0</span>,<span class="id"><a href="InteractionSemantics.html#effects_union">effects_union</a></span>,<span class="id">IHload_arguments_fp</span>,<span class="id"><a href="Footprint.html#Locs.locs_union_emp">Locs.locs_union_emp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H</span>;<span class="tactic">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">induction</span> <span class="id">H</span>;<span class="id">inv</span> <span class="id">H</span>;<span class="tactic">try</span> <span class="id">inv</span> <span class="id">H0</span>;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#loadv_fp">loadv_fp</a></span>;<span class="id">ex_match2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tsoalloc_bfeff">tsoalloc_bfeff</a></span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#BufferEff_union">BufferEff_union</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#store_args_fmem_bfeff">store_args_fmem_bfeff</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="tsostorev_memunchg">tsostorev_memunchg</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">chunk</span> <span class="id">m</span> <span class="id">b</span> <span class="id">v</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tsostorev">tsostorev</a></span> <span class="id"><a href="TSOAuxDefs.html#chunk">chunk</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span>) = <span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id">m</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9249')">Proof.</div>
<div class="proofscript" id="proof9249">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsostorev">tsostorev</a></span>,<span class="id"><a href="TSOMem.html#tsostore">tsostore</a></span>;<span class="tactic">intros</span>. <span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H</span>;<span class="tactic">auto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="store_stack_fmem_memunchg">store_stack_fmem_memunchg</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">stk</span> <span class="id">ty</span> <span class="id">v</span> <span class="id">a</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#store_stack_fmem">store_stack_fmem</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#stk">stk</a></span> <span class="id"><a href="TSOAuxDefs.html#ty">ty</a></span> <span class="id"><a href="TSOAuxDefs.html#v">v</a></span> <span class="id"><a href="TSOAuxDefs.html#a">a</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span>) = <span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id">m</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9250')">Proof.</div>
<div class="proofscript" id="proof9250">
 <span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#store_stack_fmem">store_stack_fmem</a></span>. <span class="tactic">intros</span>; <span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tsostorev_memunchg">tsostorev_memunchg</a></span>;<span class="tactic">eauto</span>. Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="store_args_fmem_memunchg">store_args_fmem_memunchg</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">args</span> <span class="id">tys</span> <span class="id">z</span> <span class="id">m</span> <span class="id">stk</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#store_args_rec_fmem">store_args_rec_fmem</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#stk">stk</a></span> <span class="id"><a href="TSOAuxDefs.html#z">z</a></span> <span class="id"><a href="TSOAuxDefs.html#args">args</a></span> <span class="id"><a href="TSOAuxDefs.html#tys">tys</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span>) = <span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id">m</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9251')">Proof.</div>
<div class="proofscript" id="proof9251">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">args</span>;<span class="tactic">simpl</span>;<span class="tactic">intros</span>;<span class="id">ex_match</span>;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;1,2,4,5,6:<span class="tactic">apply</span> <span class="id">IHargs</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#store_stack_fmem_memunchg">store_stack_fmem_memunchg</a></span> <span class="kwd">in</span> <span class="id">Hx1</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHargs</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#store_stack_fmem_memunchg">store_stack_fmem_memunchg</a></span> <span class="kwd">in</span> <span class="id">Hx2</span>;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#store_stack_fmem_memunchg">store_stack_fmem_memunchg</a></span> <span class="kwd">in</span> <span class="id">Hx3</span>;<span class="tactic">congruence</span>.<br/>
Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="tsoalloc_memunchg">tsoalloc_memunchg</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">m</span>' <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tsoalloc">tsoalloc</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#lo">lo</a></span> <span class="id"><a href="TSOAuxDefs.html#hi">hi</a></span> (<span class="id">m</span>',<span class="id"><a href="TSOAuxDefs.html#b">b</a></span>)-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span>) = <span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id">m</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9252')">Proof.</div>
<div class="proofscript" id="proof9252">
 <span class="tactic">inversion</span> 1;<span class="tactic">subst</span>;<span class="tactic">auto</span>. Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="tsofree_memunchg">tsofree_memunchg</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">m</span>' <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tsofree">tsofree</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#lo">lo</a></span> <span class="id"><a href="TSOAuxDefs.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span>) = <span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id">m</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9253')">Proof.</div>
<div class="proofscript" id="proof9253">
 <span class="tactic">inversion</span> 1;<span class="tactic">subst</span>;<span class="tactic">auto</span>. Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="TSO_memchg">TSO_memchg</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ge</span> <span class="id">fl</span> <span class="id">c</span> <span class="id">gm</span> <span class="id">bf</span> <span class="id">fp</span> <span class="id">c</span>' <span class="id">gm</span>' <span class="id">bf</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#tsostep">tsostep</a></span> <span class="id"><a href="TSOAuxDefs.html#ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> (<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>,<span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span>) <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id">c</span>' (<span class="id">bf</span>',<span class="id">gm</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> &lt;&gt; <span class="id">gm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> /\ <span class="id">bf</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9254')">Proof.</div>
<div class="proofscript" id="proof9254">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">H6</span>. <span class="id">inv</span> <span class="id">H9</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#exec_instr_TSO">exec_instr_TSO</a></span> <span class="kwd">in</span> <span class="id">H4</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H4</span>;<span class="tactic">auto</span>;<span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">try</span> (<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#exec_load_TSO">exec_load_TSO</a></span> <span class="kwd">in</span> <span class="id">H6</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H6</span>;<span class="tactic">auto</span>; <span class="id">contradiction</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">try</span> (<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#exec_store_TSO">exec_store_TSO</a></span> <span class="kwd">in</span> <span class="id">H6</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H6</span>;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#tsostorev_memunchg">tsostorev_memunchg</a></span> <span class="kwd">in</span> <span class="id">Hx</span>; <span class="id">contradiction</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#tso_goto_label">tso_goto_label</a></span> <span class="kwd">in</span> *;<span class="id">ex_match</span>;<span class="tactic">try</span> <span class="id">inv</span> <span class="id">H6</span>;<span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tsofree_memunchg">tsofree_memunchg</a></span> <span class="kwd">in</span> <span class="id">Hx3</span>. <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#tsoalloc_memunchg">tsoalloc_memunchg</a></span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#tsostorev_memunchg">tsostorev_memunchg</a></span> <span class="kwd">in</span> <span class="id">H5</span>;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#tsostorev_memunchg">tsostorev_memunchg</a></span> <span class="kwd">in</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#store_args_fmem_memunchg">store_args_fmem_memunchg</a></span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#tsoalloc_memunchg">tsoalloc_memunchg</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<span class="tactic">congruence</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="TSO_memunchg">TSO_memunchg</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ge</span> <span class="id">fl</span> <span class="id">c</span> <span class="id">gm</span> <span class="id">bf</span> <span class="id">fp</span> <span class="id">c</span>' <span class="id">gm</span>' <span class="id">bf</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#tsostep">tsostep</a></span> <span class="id"><a href="TSOAuxDefs.html#ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> (<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>,<span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span>) <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id">c</span>' (<span class="id">bf</span>',<span class="id">gm</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> &lt;&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> \/ <span class="id">bf</span>' &lt;&gt; <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> = <span class="id">gm</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9255')">Proof.</div>
<div class="proofscript" id="proof9255">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">H6</span>. <span class="id">inv</span> <span class="id">H9</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">i</span>;<span class="id">inv</span> <span class="id">H4</span>;<span class="id">inv</span> <span class="id">H3</span>;<span class="tactic">simpl</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">try</span> (<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#exec_load_TSO">exec_load_TSO</a></span> <span class="kwd">in</span> <span class="id">H6</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H6</span>;<span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">try</span>(<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#exec_store_TSO">exec_store_TSO</a></span> <span class="kwd">in</span> <span class="id">H4</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H4</span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tsostorev_memunchg">tsostorev_memunchg</a></span> <span class="kwd">in</span> <span class="id">Hx</span>;<span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">try</span> (<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#tso_goto_label">tso_goto_label</a></span> <span class="kwd">in</span> <span class="id">H4</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H4</span>;<span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">destruct</span> <span class="id">H0</span>;<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#tsoalloc_memunchg">tsoalloc_memunchg</a></span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#tsostorev_memunchg">tsostorev_memunchg</a></span> <span class="kwd">in</span> <span class="id">H5</span>;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#tsostorev_memunchg">tsostorev_memunchg</a></span> <span class="kwd">in</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#store_args_fmem_memunchg">store_args_fmem_memunchg</a></span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#tsoalloc_memunchg">tsoalloc_memunchg</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<span class="tactic">congruence</span>.<br/>
Qed.</div>
<span class="kwd">End</span> <span class="id"><a href="TSOAuxDefs.html#EFFBASE">EFFBASE</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="MemPost_union">MemPost_union</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">fp</span> <span class="id">fp</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#MemPost">MemPost</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id">m</span>' <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#MemPost">MemPost</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id">m</span>' <span class="id">fp</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#MemPost">MemPost</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id">m</span>' (<span class="id"><a href="Footprint.html#FP.union">FP.union</a></span> <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id">fp</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9256')">Proof.</div>
<div class="proofscript" id="proof9256">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#MemPost">MemPost</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="InteractionSemantics.html#effects_union">effects_union</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#unchanged_content_union2">unchanged_content_union2</a></span>;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<span class="kwd">Definition</span> <span class="id"><a name="buffer_safe">buffer_safe</a></span> (<span class="id">bf</span>:<span class="id"><a href="TSOMem.html#buffer">buffer</a></span>)(<span class="id">m</span>:<span class="id"><a href="GMemory.html#gmem">gmem</a></span>):<span class="kwd">Prop</span>:= <span class="id">exists</span> <span class="id">m</span>', <span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'.<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="unbuffer_safe_buffer_safe">unbuffer_safe_buffer_safe</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#t">t</a></span>) (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9257')">Proof.</div>
<div class="proofscript" id="proof9257">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">unbuffer_safe_apply_buffer</span>' <span class="kwd">in</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="unchanged_content_equiv">unchanged_content_equiv</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">P</span> : <span class="id"><a href="Values.html#block">block</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span> -&gt; <span class="kwd">Prop</span>) (<span class="id">m</span> <span class="id">m</span>' : <span class="id">GMem.gmem</span>'),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> <span class="id"><a href="TSOAuxDefs.html#P">P</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id">m</span>' &lt;-&gt; <span class="id"><a href="GMemory.html#GMem.unchanged_on">GMem.unchanged_on</a></span> <span class="id"><a href="TSOAuxDefs.html#P">P</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id">m</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9258')">Proof.</div>
<div class="proofscript" id="proof9258">
&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#unchanged_content_equiv">unchanged_content_equiv</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="id">econstructor</span>;<span class="tactic">eauto</span>. <span class="id">econstructor</span>;<span class="tactic">eauto</span>. <span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#Memperm_validblock">Memperm_validblock</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> ?. <span class="tactic">eapply</span> <span class="id">unchanged_on_perm</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#Memperm_validblock">Memperm_validblock</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> ?. <span class="tactic">eapply</span> <span class="id">unchanged_on_perm</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">unchanged_on_validity</span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="alloc_mempost">alloc_mempost</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span> <span class="id">m1</span>' <span class="id">m2</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="id"><a href="TSOAuxDefs.html#m1">m1</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#z">z</a></span> <span class="id"><a href="TSOAuxDefs.html#z0">z0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="id"><a href="TSOAuxDefs.html#m2">m2</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#z">z</a></span> <span class="id"><a href="TSOAuxDefs.html#z0">z0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.unchanged_on">GMem.unchanged_on</a></span> (<span class="id"><a href="InteractionSemantics.html#belongsto">belongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">FMemOpFP.uncheck_alloc_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#z">z</a></span> <span class="id"><a href="TSOAuxDefs.html#z0">z0</a></span>))) <span class="id">m1</span>' <span class="id">m2</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9259')">Proof.</div>
<div class="proofscript" id="proof9259">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="kwd">in</span> *;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#belongsto">belongsto</a></span>,<span class="id"><a href="Footprint.html#Locs.belongsto">Locs.belongsto</a></span>,<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>,<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">FMemOpFP.uncheck_alloc_fp</a></span>;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#Locs.emp_union_locs">Locs.emp_union_locs</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>,<span class="id"><a href="GMemory.html#GMem.perm">GMem.perm</a></span>;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#belongsto">belongsto</a></span>,<span class="id"><a href="Footprint.html#Locs.belongsto">Locs.belongsto</a></span>,<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>,<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">FMemOpFP.uncheck_alloc_fp</a></span>;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#Locs.emp_union_locs">Locs.emp_union_locs</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> !<span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>,<span class="id"><a href="GMemory.html#GMem.perm">GMem.perm</a></span>;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#belongsto">belongsto</a></span>,<span class="id"><a href="Footprint.html#Locs.belongsto">Locs.belongsto</a></span>,<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>,<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">FMemOpFP.uncheck_alloc_fp</a></span>;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#Locs.emp_union_locs">Locs.emp_union_locs</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> !<span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="free_mempost">free_mempost</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span> <span class="id">m1</span>' <span class="id">m2</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#free">free</a></span> <span class="id"><a href="TSOAuxDefs.html#m1">m1</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#z">z</a></span> <span class="id"><a href="TSOAuxDefs.html#z0">z0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#free">free</a></span> <span class="id"><a href="TSOAuxDefs.html#m2">m2</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#z">z</a></span> <span class="id"><a href="TSOAuxDefs.html#z0">z0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.unchanged_on">GMem.unchanged_on</a></span> (<span class="id"><a href="InteractionSemantics.html#belongsto">belongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#free_fp">FMemOpFP.free_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#z">z</a></span> <span class="id"><a href="TSOAuxDefs.html#z0">z0</a></span>))) <span class="id">m1</span>' <span class="id">m2</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9260')">Proof.</div>
<div class="proofscript" id="proof9260">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#free">free</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">ex_match</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#belongsto">belongsto</a></span>,<span class="id"><a href="Footprint.html#Locs.belongsto">Locs.belongsto</a></span>,<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>,<span class="id"><a href="FMemOpFP.html#free_fp">FMemOpFP.free_fp</a></span>;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#Locs.emp_union_locs">Locs.emp_union_locs</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemOpFP.html#range_locset_loc">FMemOpFP.range_locset_loc</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">Hsimpl</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">r0</span>. <span class="id">instantiate</span>(1:=<span class="id">ofs</span>) ;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>;<span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#Memperm_validblock">Memperm_validblock</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">r</span>. <span class="id">instantiate</span>(1:=<span class="id">ofs</span>) ;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>;<span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#Memperm_validblock">Memperm_validblock</a></span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>,<span class="id"><a href="GMemory.html#GMem.perm">GMem.perm</a></span>;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#belongsto">belongsto</a></span>,<span class="id"><a href="Footprint.html#Locs.belongsto">Locs.belongsto</a></span>,<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>,<span class="id"><a href="FMemOpFP.html#free_fp">FMemOpFP.free_fp</a></span>;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#Locs.emp_union_locs">Locs.emp_union_locs</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemOpFP.html#range_locset_loc">FMemOpFP.range_locset_loc</a></span> <span class="kwd">in</span> <span class="id">H</span>;<span class="id">Hsimpl</span>;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> !<span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#zle">zle</a></span>;<span class="tactic">try</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#zlt">zlt</a></span>;<span class="tactic">try</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>,<span class="id"><a href="GMemory.html#GMem.perm">GMem.perm</a></span>;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#belongsto">belongsto</a></span>,<span class="id"><a href="Footprint.html#Locs.belongsto">Locs.belongsto</a></span>,<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>,<span class="id"><a href="FMemOpFP.html#free_fp">FMemOpFP.free_fp</a></span>;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#Locs.emp_union_locs">Locs.emp_union_locs</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemOpFP.html#range_locset_loc">FMemOpFP.range_locset_loc</a></span> <span class="kwd">in</span> <span class="id">H</span>;<span class="id">Hsimpl</span>;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_false_iff">andb_false_iff</a></span> <span class="kwd">in</span> <span class="id">Hx1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hx1</span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#zle">zle</a></span>;<span class="tactic">try</span> <span class="tactic">omega</span>;<span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#zlt">zlt</a></span>;<span class="tactic">try</span> <span class="tactic">discriminate</span>;<span class="tactic">try</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_buffer_app_eq">apply_buffer_app_eq</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf1</span> <span class="id">bf2</span> <span class="id">m</span> <span class="id">m1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOAuxDefs.html#bf1">bf1</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOAuxDefs.html#m1">m1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> (<span class="id"><a href="TSOAuxDefs.html#bf1">bf1</a></span>++<span class="id"><a href="TSOAuxDefs.html#bf2">bf2</a></span>) <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> = <span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOAuxDefs.html#bf2">bf2</a></span> <span class="id"><a href="TSOAuxDefs.html#m1">m1</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9261')">Proof.</div>
<div class="proofscript" id="proof9261">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf1</span>;<span class="tactic">intros</span>;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#optbind">optbind</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">ex_match</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf1</span> <span class="kwd">in</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="alloc_eff">alloc_eff</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#z">z</a></span> <span class="id"><a href="TSOAuxDefs.html#z0">z0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#MemEffect">MemEffect</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id">m</span>' (<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">FMemOpFP.uncheck_alloc_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#z">z</a></span> <span class="id"><a href="TSOAuxDefs.html#z0">z0</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9262')">Proof.</div>
<div class="proofscript" id="proof9262">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="kwd">in</span> *;<span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">FMemOpFP.uncheck_alloc_fp</a></span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>,<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span>;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#Locs.emp_union_locs">Locs.emp_union_locs</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#unchanged_validity">unchanged_validity</a></span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match</span>. <span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">intro</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span>;<span class="tactic">auto</span>;<span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.eq_perm">GMem.eq_perm</a></span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.perm">GMem.perm</a></span>;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="tactic">auto</span>;<span class="tactic">subst</span>;<span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#unchanged_validity">unchanged_validity</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span>,<span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<span class="id">ex_match</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">intro</span>;<span class="tactic">try</span> <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span>;<span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.eq_perm">GMem.eq_perm</a></span>,<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">ex_match</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.perm">GMem.perm</a></span>;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>;<span class="tactic">auto</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.perm">GMem.perm</a></span> <span class="kwd">in</span> *. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradict</span> <span class="id">H1</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Footprint.html#Locs.belongsto">Locs.belongsto</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.perm">GMem.perm</a></span> <span class="kwd">in</span> *;<span class="tactic">simpl</span> <span class="kwd">in</span>*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="tactic">unfold</span> <span class="id"><a href="Footprint.html#Locs.belongsto">Locs.belongsto</a></span>;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>;<span class="tactic">simpl</span>;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="tsoalloc_eff">tsoalloc_eff</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">m</span>' <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tsoalloc">tsoalloc</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#lo">lo</a></span> <span class="id"><a href="TSOAuxDefs.html#hi">hi</a></span> (<span class="id">m</span>',<span class="id"><a href="TSOAuxDefs.html#b">b</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> (<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span>) (<span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span>)) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOAuxDefs.html#m1">m1</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> (<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">m</span>')(<span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id">m</span>')) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOAuxDefs.html#m2">m2</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#LEffect">LEffect</a></span> <span class="id"><a href="TSOAuxDefs.html#m1">m1</a></span> <span class="id"><a href="TSOAuxDefs.html#m2">m2</a></span> (<span class="id"><a href="AsmTSO.html#tsoalloc_fp">tsoalloc_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#lo">lo</a></span> <span class="id"><a href="TSOAuxDefs.html#hi">hi</a></span>)(<span class="id"><a href="FMemory.html#Mem.freelist">Mem.freelist</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9263')">Proof.</div>
<div class="proofscript" id="proof9263">
&nbsp;&nbsp;<span class="tactic">inversion</span> 1;<span class="tactic">subst</span>. <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">gm</span>'. <span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOAuxDefs.html#apply_buffer_app_eq">apply_buffer_app_eq</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">exists</span> <span class="id">m2</span>,  <span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> (<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> (<span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id">fm</span>') <span class="id">lo</span> <span class="id">hi</span> :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id">gm</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOAuxDefs.html#m2">m2</a></span>).<br/>
&nbsp;&nbsp;<span class="id">eexists</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id">Hsimpl</span>;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span>,<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span>,<span class="id"><a href="TSOMem.html#optbind">optbind</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#alloc_eff">alloc_eff</a></span> <span class="kwd">in</span> <span class="id">Hx</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#LocalAlloc">LocalAlloc</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="kwd">in</span> <span class="id">Hx</span>;<span class="id">inv</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>;<span class="tactic">simpl</span>;<span class="tactic">intros</span>;<span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span>;<span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span>,<span class="id"><a href="MemAux.html#get_block">get_block</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="MemAux.html#in_fl">in_fl</a></span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H6</span>. <span class="tactic">rewrite</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="free_eff">free_eff</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#free">free</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#lo">lo</a></span> <span class="id"><a href="TSOAuxDefs.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#MemEffect">MemEffect</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id">m</span>' (<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#lo">lo</a></span> <span class="id"><a href="TSOAuxDefs.html#hi">hi</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9264')">Proof.</div>
<div class="proofscript" id="proof9264">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#free">free</a></span> <span class="kwd">in</span> <span class="id">H</span>;<span class="id">ex_match</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unchecked_free">unchecked_free</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>;<span class="id">gmem_unfolds</span>;<span class="tactic">simpl</span>;<span class="id">Esimpl</span>;<span class="tactic">intros</span>;<span class="tactic">try</span> <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#Locs.emp_union_locs">Locs.emp_union_locs</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#range_locset">range_locset</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">ex_match</span>;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">lo</span> + (<span class="id">hi</span> - <span class="id">lo</span>) = <span class="id">hi</span>). <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H0</span>,<span class="id">H</span>. <span class="tactic">tauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>;<span class="tactic">auto</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#range_locset">range_locset</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">ex_match</span>;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">lo</span> + (<span class="id">hi</span> - <span class="id">lo</span>) = <span class="id">hi</span>). <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H0</span>,<span class="id">H</span>. <span class="tactic">tauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>;<span class="tactic">auto</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>;<span class="id">gmem_unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#range_locset">range_locset</a></span>. <span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">lo</span> + (<span class="id">hi</span> - <span class="id">lo</span>) = <span class="id">hi</span>). <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#range_locset">range_locset</a></span>. <span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="store_eff">store_eff</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">chunk</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOAuxDefs.html#chunk">chunk</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#ofs">ofs</a></span> <span class="id"><a href="TSOAuxDefs.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#MemEffect">MemEffect</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id">m</span>' (<span class="id"><a href="FMemOpFP.html#store_fp">store_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#chunk">chunk</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#ofs">ofs</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9265')">Proof.</div>
<div class="proofscript" id="proof9265">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#store">store</a></span>;<span class="tactic">intros</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#store_fp">store_fp</a></span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>;<span class="id">gmem_unfolds</span>;<span class="tactic">simpl</span>;<span class="id">Esimpl</span>;<span class="tactic">intros</span>;<span class="tactic">try</span> <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#Locs.locs_union_emp">Locs.locs_union_emp</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#range_locset">range_locset</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match</span>.<br/>
&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="FMemory.html#Mem.setN_outside">Mem.setN_outside</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#zle">zle</a></span>. <span class="id">Focus</span> 2. <span class="id">left</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#zlt">zlt</a></span>. <span class="id">inv</span> <span class="id">H</span>. <span class="id">right</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Memdata.html#encode_val_length">encode_val_length</a></span>. <span class="tactic">rewrite</span> &lt;-<span class="id"><a href="Memdata.html#size_chunk_conv">size_chunk_conv</a></span>. <span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.perm">GMem.perm</a></span> <span class="kwd">in</span> *;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<span class="id">contradiction</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="MemPre_union">MemPre_union</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m0</span> <span class="id">m1</span> <span class="id">fp</span> <span class="id">fp</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#MemPre">MemPre</a></span> <span class="id"><a href="TSOAuxDefs.html#m0">m0</a></span> <span class="id"><a href="TSOAuxDefs.html#m1">m1</a></span> <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#MemPre">MemPre</a></span> <span class="id"><a href="TSOAuxDefs.html#m0">m0</a></span> <span class="id"><a href="TSOAuxDefs.html#m1">m1</a></span> <span class="id">fp</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#MemPre">MemPre</a></span> <span class="id"><a href="TSOAuxDefs.html#m0">m0</a></span> <span class="id"><a href="TSOAuxDefs.html#m1">m1</a></span> (<span class="id"><a href="Footprint.html#FP.union">FP.union</a></span> <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id">fp</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9266')">Proof.</div>
<div class="proofscript" id="proof9266">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#unchanged_content_union2">unchanged_content_union2</a></span> <span class="kwd">in</span> <span class="id">ReadMemEq0</span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">ReadMemEq</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#unchanged_perm_union2">unchanged_perm_union2</a></span> <span class="kwd">in</span> <span class="id">CmpMemPermExists0</span>;<span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">CmpMemPermExists</span>;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Footprint.html#FP.union">FP.union</a></span>,<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> <span class="kwd">in</span> *;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#belongsto">belongsto</a></span>,<span class="id"><a href="Footprint.html#Locs.belongsto">Locs.belongsto</a></span>,<span class="id"><a href="Footprint.html#Locs.union">Locs.union</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#orb_true_iff">orb_true_iff</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> [|];<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#orb_true_iff">orb_true_iff</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> [|].<br/>
&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">try</span> (<span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#EffectPermEqPre">EffectPermEqPre</a></span>;<span class="tactic">rewrite</span> <span class="id">H</span>;<span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">bool</span>).<br/>
&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">try</span> (<span class="tactic">apply</span> <span class="id">EffectPermEqPre0</span>;<span class="tactic">rewrite</span> <span class="id">H</span>;<span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">bool</span>).<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="Fleq_apply_buffer_item_preserve">Fleq_apply_buffer_item_preserve</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m0</span> <span class="id">m1</span> <span class="id">bf</span> <span class="id">m0</span>' <span class="id">m1</span>' <span class="id">fl</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#FreelistEq">FreelistEq</a></span> <span class="id"><a href="TSOAuxDefs.html#m0">m0</a></span> <span class="id"><a href="TSOAuxDefs.html#m1">m1</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id"><a href="TSOAuxDefs.html#m0">m0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m0</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id"><a href="TSOAuxDefs.html#m1">m1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#FreelistEq">FreelistEq</a></span> <span class="id">m0</span>' <span class="id">m1</span>' <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9267')">Proof.</div>
<div class="proofscript" id="proof9267">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bf</span>;<span class="tactic">simpl</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#FreelistEq">FreelistEq</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H</span> <span class="id">_</span> <span class="id">H2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">b</span> <span class="id">b0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOMemLemmas.html#alloc_add_new_vb">alloc_add_new_vb</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOMemLemmas.html#alloc_add_new_vb">alloc_add_new_vb</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>. <span class="tactic">rewrite</span>&lt;- <span class="id">H1</span>,&lt;- <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>;<span class="tactic">split</span>;<span class="tactic">intro</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="kwd">in</span> <span class="id">H0</span>,<span class="id">H1</span>;<span class="id">inv</span> <span class="id">H0</span>;<span class="id">inv</span> <span class="id">H1</span>;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">intro</span>;<span class="id">inv</span> <span class="id">H0</span>;<span class="tactic">try</span> <span class="id">contradiction</span>;<span class="id">right</span>;<span class="tactic">eauto</span>;<span class="tactic">eapply</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#FreelistEq">FreelistEq</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">specialize</span> (<span class="id">H</span> <span class="id">_</span> <span class="id">H2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#free">free</a></span> <span class="kwd">in</span> *;<span class="id">ex_match</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unchecked_free">unchecked_free</a></span> <span class="kwd">in</span> *;<span class="id">inv</span> <span class="id">H0</span>;<span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#FreelistEq">FreelistEq</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">specialize</span> (<span class="id">H</span> <span class="id">_</span> <span class="id">H2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="kwd">in</span> *;<span class="id">ex_match</span>. <span class="id">inv</span> <span class="id">H1</span>. <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>;<span class="tactic">simpl</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="MemPre_apply_buffer_item_preserve">MemPre_apply_buffer_item_preserve</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m0</span> <span class="id">m1</span> <span class="id">bf</span> <span class="id">m0</span>' <span class="id">m1</span>' <span class="id">fp</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#MemPre">MemPre</a></span> <span class="id"><a href="TSOAuxDefs.html#m0">m0</a></span> <span class="id"><a href="TSOAuxDefs.html#m1">m1</a></span> <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id"><a href="TSOAuxDefs.html#m0">m0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m0</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id"><a href="TSOAuxDefs.html#m1">m1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#MemPre">MemPre</a></span> <span class="id">m0</span>' <span class="id">m1</span>' <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9268')">Proof.</div>
<div class="proofscript" id="proof9268">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bf</span>;<span class="tactic">simpl</span>;  <span class="tactic">intros</span>;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span> <span class="kwd">as</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#alloc_eff">alloc_eff</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#alloc_eff">alloc_eff</a></span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#alloc_mempost">alloc_mempost</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">gmem_unfolds</span>;<span class="id">Esimpl</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">b0</span> <span class="id">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span>(1:=<span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#belongsto">belongsto</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Locs.unfolds</span>. <span class="id">ex_match2</span>. <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">bool</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>)) <span class="id">b0</span> <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span>,<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>,<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> (<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>))) <span class="id">m0</span> <span class="id">m0</span>'). <span class="id">inv</span> <span class="id">H3</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> (<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>))) <span class="id">m1</span> <span class="id">m1</span>'). <span class="id">inv</span> <span class="id">H4</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H8</span> <span class="kwd">as</span> [[? <span class="id">_</span>] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H9</span> <span class="kwd">as</span> [[? <span class="id">_</span>] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H8</span> <span class="kwd">in</span> <span class="id">H7</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H9</span> <span class="kwd">in</span> <span class="id">H7</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;-<span class="id">H11</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H10</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">b0</span> <span class="id">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H5</span>. <span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#belongsto">belongsto</a></span>;<span class="id">Locs.unfolds</span>. <span class="id">ex_match2</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>;<span class="tactic">simpl</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>)) <span class="id">b0</span> <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span>,<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>,<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> (<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>))) <span class="id">m0</span> <span class="id">m0</span>'). <span class="id">inv</span> <span class="id">H3</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> (<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>))) <span class="id">m1</span> <span class="id">m1</span>'). <span class="id">inv</span> <span class="id">H4</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H8</span> <span class="kwd">as</span> [[<span class="id">_</span> ?] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H9</span> <span class="kwd">as</span> [[<span class="id">_</span> ?] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H8</span> <span class="id">_</span> <span class="id">_</span> <span class="id">k</span> <span class="id">p</span> <span class="id">H7</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H9</span> <span class="id">_</span> <span class="id">_</span> <span class="id">k</span> <span class="id">p</span> <span class="id">H7</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span>&lt;- <span class="id">H8</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H9</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">b0</span> <span class="id">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id"><a href="ClientSim.html#unchanged_on_sym">unchanged_on_sym</a></span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H5</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#belongsto">belongsto</a></span>;<span class="id">Locs.unfolds</span>. <span class="id">ex_match2</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>)) <span class="id">b0</span> <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span>,<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>,<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="GMemory.html#GMem.perm">GMem.perm</a></span> <span class="id">m0</span> <span class="id">b0</span> <span class="id">ofs</span> <span class="id"><a href="Memperm.html#Max">Max</a></span> <span class="id"><a href="Memperm.html#Readable">Readable</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="kwd">in</span> <span class="id">H0</span>;<span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H7</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span> <span class="kwd">in</span> <span class="id">H7</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H3</span> <span class="kwd">in</span> <span class="id">H8</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H4</span> <span class="kwd">in</span> <span class="id">H8</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H10</span>,<span class="id">H11</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">gmem_unfolds</span>;<span class="id">Esimpl</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">b0</span> <span class="id">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span>(1:=<span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#belongsto">belongsto</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Locs.unfolds</span>. <span class="id">ex_match2</span>. <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">bool</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>)) <span class="id">b0</span> <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span>,<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>,<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> (<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>))) <span class="id">m0</span> <span class="id">m0</span>'). <span class="id">inv</span> <span class="id">H3</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> (<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>))) <span class="id">m1</span> <span class="id">m1</span>'). <span class="id">inv</span> <span class="id">H4</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H8</span> <span class="kwd">as</span> [[? <span class="id">_</span>] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H9</span> <span class="kwd">as</span> [[? <span class="id">_</span>] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H8</span> <span class="kwd">in</span> <span class="id">H7</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H9</span> <span class="kwd">in</span> <span class="id">H7</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;-<span class="id">H11</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H10</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="tactic">eapply</span> <span class="id">CmpMemPermExists</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">b0</span> <span class="id">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H5</span>. <span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#belongsto">belongsto</a></span>;<span class="id">Locs.unfolds</span>. <span class="id">ex_match2</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>;<span class="tactic">simpl</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>)) <span class="id">b0</span> <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span>,<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>,<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> (<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>))) <span class="id">m0</span> <span class="id">m0</span>'). <span class="id">inv</span> <span class="id">H3</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> (<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>))) <span class="id">m1</span> <span class="id">m1</span>'). <span class="id">inv</span> <span class="id">H4</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H8</span> <span class="kwd">as</span> [[<span class="id">_</span> ?] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H9</span> <span class="kwd">as</span> [[<span class="id">_</span> ?] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H8</span> <span class="id">_</span> <span class="id">_</span> <span class="id">k</span> <span class="id">p</span> <span class="id">H7</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H9</span> <span class="id">_</span> <span class="id">_</span> <span class="id">k</span> <span class="id">p</span> <span class="id">H7</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span>&lt;- <span class="id">H8</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H9</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="tactic">eapply</span> <span class="id">CmpMemPermExists</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">gmem_unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">b0</span> <span class="id">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H5</span>. <span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#belongsto">belongsto</a></span>;<span class="id">Locs.unfolds</span>. <span class="id">ex_match2</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>;<span class="tactic">simpl</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>)) <span class="id">b0</span> <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span>,<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>,<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> (<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>))) <span class="id">m0</span> <span class="id">m0</span>'). <span class="id">inv</span> <span class="id">H3</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> (<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>))) <span class="id">m1</span> <span class="id">m1</span>'). <span class="id">inv</span> <span class="id">H4</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H8</span> <span class="kwd">as</span> [[<span class="id">_</span> ?] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H9</span> <span class="kwd">as</span> [[<span class="id">_</span> ?] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H8</span> <span class="id">_</span> <span class="id">_</span> <span class="id">k</span> <span class="id">p</span> <span class="id">H7</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H9</span> <span class="id">_</span> <span class="id">_</span> <span class="id">k</span> <span class="id">p</span> <span class="id">H7</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span>&lt;- <span class="id">H8</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H9</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="tactic">eapply</span> <span class="id">EffectPermEqPre</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#free_eff">free_eff</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#free_eff">free_eff</a></span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#free_mempost">free_mempost</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">gmem_unfolds</span>;<span class="id">Esimpl</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="FMemOpFP.html#range_locset">range_locset</a></span> <span class="id">b</span> <span class="id">z</span> (<span class="id">z0</span> -<span class="id">z</span>) <span class="id">b0</span> <span class="id">ofs</span>) <span class="id">eqn</span>:?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span>(1:=<span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#belongsto">belongsto</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Locs.unfolds</span>. <span class="id">ex_match2</span>. <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">bool</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>)) <span class="id">b0</span> <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span>,<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>,<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> (<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>))) <span class="id">m0</span> <span class="id">m0</span>'). <span class="id">inv</span> <span class="id">H3</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> (<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>))) <span class="id">m1</span> <span class="id">m1</span>'). <span class="id">inv</span> <span class="id">H4</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H8</span> <span class="kwd">as</span> [[? <span class="id">_</span>] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H9</span> <span class="kwd">as</span> [[? <span class="id">_</span>] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H8</span> <span class="kwd">in</span> <span class="id">H7</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H9</span> <span class="kwd">in</span> <span class="id">H7</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;-<span class="id">H11</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H10</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="FMemOpFP.html#range_locset">range_locset</a></span> <span class="id">b</span> <span class="id">z</span> (<span class="id">z0</span> -<span class="id">z</span>) <span class="id">b0</span> <span class="id">ofs</span>) <span class="id">eqn</span>:?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id"><a href="ClientSim.html#unchanged_on_sym">unchanged_on_sym</a></span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">intro</span>;<span class="tactic">eapply</span> <span class="id">H5</span>;<span class="tactic">eauto</span>;<span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#Memperm_validblock">Memperm_validblock</a></span> <span class="kwd">in</span> <span class="id">H7</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H5</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#belongsto">belongsto</a></span>;<span class="id">Locs.unfolds</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>)) <span class="id">b0</span> <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span>,<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>,<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> (<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>))) <span class="id">m0</span> <span class="id">m0</span>'). <span class="id">inv</span> <span class="id">H3</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> (<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>))) <span class="id">m1</span> <span class="id">m1</span>'). <span class="id">inv</span> <span class="id">H4</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H8</span> <span class="kwd">as</span> [[<span class="id">_</span> ?] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H9</span> <span class="kwd">as</span> [[<span class="id">_</span> ?] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H8</span> <span class="id">_</span> <span class="id">_</span> <span class="id">k</span> <span class="id">p</span> <span class="id">H7</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H9</span> <span class="id">_</span> <span class="id">_</span> <span class="id">k</span> <span class="id">p</span> <span class="id">H7</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span>&lt;- <span class="id">H8</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H9</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span>  (<span class="id"><a href="FMemOpFP.html#range_locset">range_locset</a></span> <span class="id">b</span> <span class="id">z</span> (<span class="id">z0</span> -<span class="id">z</span>) <span class="id">b0</span> <span class="id">ofs</span>) <span class="id">eqn</span>:?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id"><a href="ClientSim.html#unchanged_on_sym">unchanged_on_sym</a></span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H5</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>)) <span class="id">b0</span> <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span>,<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>,<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="GMemory.html#GMem.perm">GMem.perm</a></span> <span class="id">m0</span> <span class="id">b0</span> <span class="id">ofs</span> <span class="id"><a href="Memperm.html#Max">Max</a></span> <span class="id"><a href="Memperm.html#Readable">Readable</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#free">free</a></span> <span class="kwd">in</span> <span class="id">H0</span>;<span class="id">ex_match</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unchecked_free">unchecked_free</a></span> <span class="kwd">in</span> <span class="id">H0</span>;<span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#range_locset">range_locset</a></span> <span class="kwd">in</span> <span class="id">Heqb1</span>. <span class="id">ex_match</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">z</span>+(<span class="id">z0</span>-<span class="id">z</span>) = <span class="id">z0</span>). <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">Heqb1</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span> <span class="kwd">in</span> <span class="id">H7</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqb1</span> <span class="kwd">in</span> <span class="id">H7</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span> <span class="kwd">in</span> <span class="id">H7</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H3</span> <span class="kwd">in</span> <span class="id">H8</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H4</span> <span class="kwd">in</span> <span class="id">H8</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H10</span>,<span class="id">H11</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">gmem_unfolds</span>;<span class="id">Esimpl</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="FMemOpFP.html#range_locset">range_locset</a></span> <span class="id">b</span> <span class="id">z</span> (<span class="id">z0</span> -<span class="id">z</span>) <span class="id">b0</span> <span class="id">ofs</span>) <span class="id">eqn</span>:?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span>(1:=<span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#belongsto">belongsto</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Locs.unfolds</span>. <span class="id">ex_match2</span>. <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">bool</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>)) <span class="id">b0</span> <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span>,<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>,<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> (<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>))) <span class="id">m0</span> <span class="id">m0</span>'). <span class="id">inv</span> <span class="id">H3</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> (<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>))) <span class="id">m1</span> <span class="id">m1</span>'). <span class="id">inv</span> <span class="id">H4</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H8</span> <span class="kwd">as</span> [[? <span class="id">_</span>] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H9</span> <span class="kwd">as</span> [[? <span class="id">_</span>] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H8</span> <span class="kwd">in</span> <span class="id">H7</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H9</span> <span class="kwd">in</span> <span class="id">H7</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;-<span class="id">H11</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H10</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="tactic">eapply</span> <span class="id">CmpMemPermExists</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="FMemOpFP.html#range_locset">range_locset</a></span> <span class="id">b</span> <span class="id">z</span> (<span class="id">z0</span> -<span class="id">z</span>) <span class="id">b0</span> <span class="id">ofs</span>) <span class="id">eqn</span>:?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id"><a href="ClientSim.html#unchanged_on_sym">unchanged_on_sym</a></span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">intro</span>;<span class="tactic">eapply</span> <span class="id">H5</span>;<span class="tactic">eauto</span>;<span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#Memperm_validblock">Memperm_validblock</a></span> <span class="kwd">in</span> <span class="id">H7</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H5</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#belongsto">belongsto</a></span>;<span class="id">Locs.unfolds</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>)) <span class="id">b0</span> <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span>,<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>,<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> (<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>))) <span class="id">m0</span> <span class="id">m0</span>'). <span class="id">inv</span> <span class="id">H3</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> (<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>))) <span class="id">m1</span> <span class="id">m1</span>'). <span class="id">inv</span> <span class="id">H4</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H8</span> <span class="kwd">as</span> [[<span class="id">_</span> ?] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H9</span> <span class="kwd">as</span> [[<span class="id">_</span> ?] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H8</span> <span class="id">_</span> <span class="id">_</span> <span class="id">k</span> <span class="id">p</span> <span class="id">H7</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H9</span> <span class="id">_</span> <span class="id">_</span> <span class="id">k</span> <span class="id">p</span> <span class="id">H7</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span>&lt;- <span class="id">H8</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H9</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="tactic">eapply</span> <span class="id">CmpMemPermExists</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">gmem_unfolds</span>;<span class="id">Esimpl</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="FMemOpFP.html#range_locset">range_locset</a></span> <span class="id">b</span> <span class="id">z</span> (<span class="id">z0</span> -<span class="id">z</span>) <span class="id">b0</span> <span class="id">ofs</span>) <span class="id">eqn</span>:?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id"><a href="ClientSim.html#unchanged_on_sym">unchanged_on_sym</a></span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">intro</span>;<span class="tactic">eapply</span> <span class="id">H5</span>;<span class="tactic">eauto</span>;<span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#Memperm_validblock">Memperm_validblock</a></span> <span class="kwd">in</span> <span class="id">H7</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H5</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#belongsto">belongsto</a></span>;<span class="id">Locs.unfolds</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>)) <span class="id">b0</span> <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span>,<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>,<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> (<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>))) <span class="id">m0</span> <span class="id">m0</span>'). <span class="id">inv</span> <span class="id">H3</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> (<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>))) <span class="id">m1</span> <span class="id">m1</span>'). <span class="id">inv</span> <span class="id">H4</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H8</span> <span class="kwd">as</span> [[<span class="id">_</span> ?] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H9</span> <span class="kwd">as</span> [[<span class="id">_</span> ?] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H8</span> <span class="id">_</span> <span class="id">_</span> <span class="id">k</span> <span class="id">p</span> <span class="id">H7</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H9</span> <span class="id">_</span> <span class="id">_</span> <span class="id">k</span> <span class="id">p</span> <span class="id">H7</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span>&lt;- <span class="id">H8</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H9</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="tactic">eapply</span> <span class="id">EffectPermEqPre</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">H2</span> <span class="id">into</span> <span class="id">R</span>. <span class="tactic">rename</span> <span class="id">H</span> <span class="id">into</span> <span class="id">H2</span>. <span class="tactic">rename</span> <span class="id">R</span> <span class="id">into</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>;<span class="id">gmem_unfolds</span>;<span class="id">Esimpl</span>;<span class="tactic">intros</span>;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="kwd">in</span> *;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H0</span>;<span class="id">inv</span> <span class="id">H1</span>;<span class="tactic">simpl</span>;<span class="tactic">try</span> (<span class="tactic">eapply</span> <span class="id">H2</span>;<span class="tactic">eauto</span>;<span class="tactic">fail</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="FMemOpFP.html#range_locset">range_locset</a></span> <span class="id">b</span> <span class="id">z</span> (<span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id">m</span>) <span class="id">b0</span> <span class="id">ofs</span>) <span class="id">eqn</span>:?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#range_locset">range_locset</a></span> <span class="kwd">in</span> <span class="id">Heqb1</span>. <span class="id">ex_match</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span>! <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_iff">andb_true_iff</a></span> <span class="kwd">in</span> <span class="id">Heqb1</span> <span class="kwd">as</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#zle">zle</a></span>;<span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#zlt">zlt</a></span>;<span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#setN_geteq2">setN_geteq2</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Memdata.html#encode_val_length">encode_val_length</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span>&lt;- <span class="id"><a href="Memdata.html#size_chunk_conv">size_chunk_conv</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#range_locset">range_locset</a></span> <span class="kwd">in</span> <span class="id">Heqb1</span>. <span class="id">ex_match</span>;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span>! <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_false_iff">andb_false_iff</a></span> <span class="kwd">in</span> <span class="id">Heqb1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Heqb1</span>;[<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#zle">zle</a></span>|<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#zlt">zlt</a></span>];<span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> !<span class="id"><a href="FMemory.html#Mem.setN_outside">Mem.setN_outside</a></span>;<span class="tactic">eauto</span>;<span class="tactic">try</span> (<span class="id">left</span>;<span class="tactic">omega</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H2</span>;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> !<span class="id"><a href="FMemory.html#Mem.setN_outside">Mem.setN_outside</a></span>;<span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">H2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Memdata.html#encode_val_length">encode_val_length</a></span>,&lt;-<span class="id"><a href="Memdata.html#size_chunk_conv">size_chunk_conv</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Memdata.html#encode_val_length">encode_val_length</a></span>,&lt;-<span class="id"><a href="Memdata.html#size_chunk_conv">size_chunk_conv</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> !<span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>. <span class="tactic">eapply</span> <span class="id">CmpMemPermExists</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>. <span class="tactic">eapply</span> <span class="id">CmpMemPermExists</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>. <span class="tactic">eapply</span> <span class="id">EffectPermEqPre</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="LPre_apply_buffer_item_preserve">LPre_apply_buffer_item_preserve</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m0</span> <span class="id">m1</span> <span class="id">bf</span> <span class="id">m0</span>' <span class="id">m1</span>' <span class="id">fp</span> <span class="id">fl</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#LPre">LPre</a></span> <span class="id"><a href="TSOAuxDefs.html#m0">m0</a></span> <span class="id"><a href="TSOAuxDefs.html#m1">m1</a></span> <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id"><a href="TSOAuxDefs.html#m0">m0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m0</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id"><a href="TSOAuxDefs.html#m1">m1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#LPre">LPre</a></span> <span class="id">m0</span>' <span class="id">m1</span>' <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9269')">Proof.</div>
<div class="proofscript" id="proof9269">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bf</span>;<span class="tactic">simpl</span>;  <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#alloc_eff">alloc_eff</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#alloc_eff">alloc_eff</a></span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#alloc_mempost">alloc_mempost</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">gmem_unfolds</span>;<span class="id">Esimpl</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">b0</span> <span class="id">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span>(1:=<span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#belongsto">belongsto</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Locs.unfolds</span>. <span class="id">ex_match2</span>. <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">bool</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>)) <span class="id">b0</span> <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span>,<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>,<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> (<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>))) <span class="id">m0</span> <span class="id">m0</span>'). <span class="id">inv</span> <span class="id">H</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> (<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>))) <span class="id">m1</span> <span class="id">m1</span>'). <span class="id">inv</span> <span class="id">H4</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H8</span> <span class="kwd">as</span> [[? <span class="id">_</span>] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H9</span> <span class="kwd">as</span> [[? <span class="id">_</span>] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H8</span> <span class="kwd">in</span> <span class="id">H7</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H9</span> <span class="kwd">in</span> <span class="id">H7</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;-<span class="id">H11</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H10</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H2</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">b0</span> <span class="id">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H5</span>. <span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#belongsto">belongsto</a></span>;<span class="id">Locs.unfolds</span>. <span class="id">ex_match2</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>;<span class="tactic">simpl</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>)) <span class="id">b0</span> <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span>,<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>,<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> (<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>))) <span class="id">m0</span> <span class="id">m0</span>'). <span class="id">inv</span> <span class="id">H</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> (<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>))) <span class="id">m1</span> <span class="id">m1</span>'). <span class="id">inv</span> <span class="id">H4</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H8</span> <span class="kwd">as</span> [[<span class="id">_</span> ?] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H9</span> <span class="kwd">as</span> [[<span class="id">_</span> ?] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H8</span> <span class="id">_</span> <span class="id">_</span> <span class="id">k</span> <span class="id">p</span> <span class="id">H7</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H9</span> <span class="id">_</span> <span class="id">_</span> <span class="id">k</span> <span class="id">p</span> <span class="id">H7</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span>&lt;- <span class="id">H8</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H9</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H2</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">b0</span> <span class="id">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id"><a href="ClientSim.html#unchanged_on_sym">unchanged_on_sym</a></span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H5</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#belongsto">belongsto</a></span>;<span class="id">Locs.unfolds</span>. <span class="id">ex_match2</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>)) <span class="id">b0</span> <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span>,<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>,<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="GMemory.html#GMem.perm">GMem.perm</a></span> <span class="id">m0</span> <span class="id">b0</span> <span class="id">ofs</span> <span class="id"><a href="Memperm.html#Max">Max</a></span> <span class="id"><a href="Memperm.html#Readable">Readable</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="kwd">in</span> <span class="id">H0</span>;<span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H7</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span> <span class="kwd">in</span> <span class="id">H7</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H8</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H4</span> <span class="kwd">in</span> <span class="id">H8</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H10</span>,<span class="id">H11</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H2</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H2</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">gmem_unfolds</span>;<span class="id">Esimpl</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">b0</span> <span class="id">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span>(1:=<span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#belongsto">belongsto</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Locs.unfolds</span>. <span class="id">ex_match2</span>. <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">bool</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>)) <span class="id">b0</span> <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span>,<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>,<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> (<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>))) <span class="id">m0</span> <span class="id">m0</span>'). <span class="id">inv</span> <span class="id">H</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> (<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>))) <span class="id">m1</span> <span class="id">m1</span>'). <span class="id">inv</span> <span class="id">H4</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H8</span> <span class="kwd">as</span> [[? <span class="id">_</span>] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H9</span> <span class="kwd">as</span> [[? <span class="id">_</span>] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H8</span> <span class="kwd">in</span> <span class="id">H7</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H9</span> <span class="kwd">in</span> <span class="id">H7</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;-<span class="id">H11</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H10</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>. <span class="tactic">eapply</span> <span class="id">CmpMemPermExists</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">b0</span> <span class="id">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H5</span>. <span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#belongsto">belongsto</a></span>;<span class="id">Locs.unfolds</span>. <span class="id">ex_match2</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>;<span class="tactic">simpl</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>)) <span class="id">b0</span> <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span>,<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>,<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> (<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>))) <span class="id">m0</span> <span class="id">m0</span>'). <span class="id">inv</span> <span class="id">H</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> (<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>))) <span class="id">m1</span> <span class="id">m1</span>'). <span class="id">inv</span> <span class="id">H4</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H8</span> <span class="kwd">as</span> [[<span class="id">_</span> ?] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H9</span> <span class="kwd">as</span> [[<span class="id">_</span> ?] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H8</span> <span class="id">_</span> <span class="id">_</span> <span class="id">k</span> <span class="id">p</span> <span class="id">H7</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H9</span> <span class="id">_</span> <span class="id">_</span> <span class="id">k</span> <span class="id">p</span> <span class="id">H7</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span>&lt;- <span class="id">H8</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H9</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>. <span class="tactic">eapply</span> <span class="id">CmpMemPermExists</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">gmem_unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">b0</span> <span class="id">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H5</span>. <span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#belongsto">belongsto</a></span>;<span class="id">Locs.unfolds</span>. <span class="id">ex_match2</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>;<span class="tactic">simpl</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>)) <span class="id">b0</span> <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span>,<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>,<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> (<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>))) <span class="id">m0</span> <span class="id">m0</span>'). <span class="id">inv</span> <span class="id">H</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> (<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>))) <span class="id">m1</span> <span class="id">m1</span>'). <span class="id">inv</span> <span class="id">H4</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H8</span> <span class="kwd">as</span> [[<span class="id">_</span> ?] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H9</span> <span class="kwd">as</span> [[<span class="id">_</span> ?] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H8</span> <span class="id">_</span> <span class="id">_</span> <span class="id">k</span> <span class="id">p</span> <span class="id">H7</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H9</span> <span class="id">_</span> <span class="id">_</span> <span class="id">k</span> <span class="id">p</span> <span class="id">H7</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span>&lt;- <span class="id">H8</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H9</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>. <span class="tactic">eapply</span> <span class="id">EffectPermEqPre</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#FreelistEq">FreelistEq</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H3</span> <span class="id">_</span> <span class="id">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">b</span> <span class="id">b0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOMemLemmas.html#alloc_add_new_vb">alloc_add_new_vb</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOMemLemmas.html#alloc_add_new_vb">alloc_add_new_vb</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>. <span class="tactic">rewrite</span>&lt;- <span class="id">H1</span>,&lt;- <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>;<span class="tactic">split</span>;<span class="tactic">intro</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="kwd">in</span> <span class="id">H0</span>,<span class="id">H1</span>;<span class="id">inv</span> <span class="id">H0</span>;<span class="id">inv</span> <span class="id">H1</span>;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">intro</span>;<span class="id">inv</span> <span class="id">H0</span>;<span class="tactic">try</span> <span class="id">contradiction</span>;<span class="id">right</span>;<span class="tactic">eauto</span>;<span class="tactic">eapply</span> <span class="id">H3</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#free_eff">free_eff</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#free_eff">free_eff</a></span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#free_mempost">free_mempost</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">gmem_unfolds</span>;<span class="id">Esimpl</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="FMemOpFP.html#range_locset">range_locset</a></span> <span class="id">b</span> <span class="id">z</span> (<span class="id">z0</span> -<span class="id">z</span>) <span class="id">b0</span> <span class="id">ofs</span>) <span class="id">eqn</span>:?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span>(1:=<span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#belongsto">belongsto</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Locs.unfolds</span>. <span class="id">ex_match2</span>. <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">bool</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>)) <span class="id">b0</span> <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span>,<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>,<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> (<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>))) <span class="id">m0</span> <span class="id">m0</span>'). <span class="id">inv</span> <span class="id">H</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> (<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>))) <span class="id">m1</span> <span class="id">m1</span>'). <span class="id">inv</span> <span class="id">H4</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H8</span> <span class="kwd">as</span> [[? <span class="id">_</span>] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H9</span> <span class="kwd">as</span> [[? <span class="id">_</span>] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H8</span> <span class="kwd">in</span> <span class="id">H7</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H9</span> <span class="kwd">in</span> <span class="id">H7</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;-<span class="id">H11</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H10</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H2</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="FMemOpFP.html#range_locset">range_locset</a></span> <span class="id">b</span> <span class="id">z</span> (<span class="id">z0</span> -<span class="id">z</span>) <span class="id">b0</span> <span class="id">ofs</span>) <span class="id">eqn</span>:?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id"><a href="ClientSim.html#unchanged_on_sym">unchanged_on_sym</a></span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">intro</span>;<span class="tactic">eapply</span> <span class="id">H5</span>;<span class="tactic">eauto</span>;<span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#Memperm_validblock">Memperm_validblock</a></span> <span class="kwd">in</span> <span class="id">H7</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H5</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#belongsto">belongsto</a></span>;<span class="id">Locs.unfolds</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>)) <span class="id">b0</span> <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span>,<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>,<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> (<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>))) <span class="id">m0</span> <span class="id">m0</span>'). <span class="id">inv</span> <span class="id">H</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> (<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>))) <span class="id">m1</span> <span class="id">m1</span>'). <span class="id">inv</span> <span class="id">H4</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H8</span> <span class="kwd">as</span> [[<span class="id">_</span> ?] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H9</span> <span class="kwd">as</span> [[<span class="id">_</span> ?] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H8</span> <span class="id">_</span> <span class="id">_</span> <span class="id">k</span> <span class="id">p</span> <span class="id">H7</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H9</span> <span class="id">_</span> <span class="id">_</span> <span class="id">k</span> <span class="id">p</span> <span class="id">H7</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span>&lt;- <span class="id">H8</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H9</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H2</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span>  (<span class="id"><a href="FMemOpFP.html#range_locset">range_locset</a></span> <span class="id">b</span> <span class="id">z</span> (<span class="id">z0</span> -<span class="id">z</span>) <span class="id">b0</span> <span class="id">ofs</span>) <span class="id">eqn</span>:?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id"><a href="ClientSim.html#unchanged_on_sym">unchanged_on_sym</a></span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H5</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>)) <span class="id">b0</span> <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span>,<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>,<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="GMemory.html#GMem.perm">GMem.perm</a></span> <span class="id">m0</span> <span class="id">b0</span> <span class="id">ofs</span> <span class="id"><a href="Memperm.html#Max">Max</a></span> <span class="id"><a href="Memperm.html#Readable">Readable</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#free">free</a></span> <span class="kwd">in</span> <span class="id">H0</span>;<span class="id">ex_match</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unchecked_free">unchecked_free</a></span> <span class="kwd">in</span> <span class="id">H0</span>;<span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#range_locset">range_locset</a></span> <span class="kwd">in</span> <span class="id">Heqb1</span>. <span class="id">ex_match</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">z</span>+(<span class="id">z0</span>-<span class="id">z</span>) = <span class="id">z0</span>). <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">Heqb1</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span> <span class="kwd">in</span> <span class="id">H7</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqb1</span> <span class="kwd">in</span> <span class="id">H7</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span> <span class="kwd">in</span> <span class="id">H7</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H8</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H4</span> <span class="kwd">in</span> <span class="id">H8</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H10</span>,<span class="id">H11</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H2</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H2</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">gmem_unfolds</span>;<span class="id">Esimpl</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="FMemOpFP.html#range_locset">range_locset</a></span> <span class="id">b</span> <span class="id">z</span> (<span class="id">z0</span> -<span class="id">z</span>) <span class="id">b0</span> <span class="id">ofs</span>) <span class="id">eqn</span>:?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span>(1:=<span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#belongsto">belongsto</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Locs.unfolds</span>. <span class="id">ex_match2</span>. <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">bool</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>)) <span class="id">b0</span> <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span>,<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>,<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> (<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>))) <span class="id">m0</span> <span class="id">m0</span>'). <span class="id">inv</span> <span class="id">H</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> (<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>))) <span class="id">m1</span> <span class="id">m1</span>'). <span class="id">inv</span> <span class="id">H4</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H8</span> <span class="kwd">as</span> [[? <span class="id">_</span>] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H9</span> <span class="kwd">as</span> [[? <span class="id">_</span>] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H8</span> <span class="kwd">in</span> <span class="id">H7</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H9</span> <span class="kwd">in</span> <span class="id">H7</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;-<span class="id">H11</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H10</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>. <span class="tactic">eapply</span> <span class="id">CmpMemPermExists</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="FMemOpFP.html#range_locset">range_locset</a></span> <span class="id">b</span> <span class="id">z</span> (<span class="id">z0</span> -<span class="id">z</span>) <span class="id">b0</span> <span class="id">ofs</span>) <span class="id">eqn</span>:?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id"><a href="ClientSim.html#unchanged_on_sym">unchanged_on_sym</a></span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">intro</span>;<span class="tactic">eapply</span> <span class="id">H5</span>;<span class="tactic">eauto</span>;<span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#Memperm_validblock">Memperm_validblock</a></span> <span class="kwd">in</span> <span class="id">H7</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H5</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#belongsto">belongsto</a></span>;<span class="id">Locs.unfolds</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>)) <span class="id">b0</span> <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span>,<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>,<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> (<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>))) <span class="id">m0</span> <span class="id">m0</span>'). <span class="id">inv</span> <span class="id">H</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> (<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>))) <span class="id">m1</span> <span class="id">m1</span>'). <span class="id">inv</span> <span class="id">H4</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H8</span> <span class="kwd">as</span> [[<span class="id">_</span> ?] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H9</span> <span class="kwd">as</span> [[<span class="id">_</span> ?] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H8</span> <span class="id">_</span> <span class="id">_</span> <span class="id">k</span> <span class="id">p</span> <span class="id">H7</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H9</span> <span class="id">_</span> <span class="id">_</span> <span class="id">k</span> <span class="id">p</span> <span class="id">H7</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span>&lt;- <span class="id">H8</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H9</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>. <span class="tactic">eapply</span> <span class="id">CmpMemPermExists</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">gmem_unfolds</span>;<span class="id">Esimpl</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="FMemOpFP.html#range_locset">range_locset</a></span> <span class="id">b</span> <span class="id">z</span> (<span class="id">z0</span> -<span class="id">z</span>) <span class="id">b0</span> <span class="id">ofs</span>) <span class="id">eqn</span>:?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id"><a href="ClientSim.html#unchanged_on_sym">unchanged_on_sym</a></span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">intro</span>;<span class="tactic">eapply</span> <span class="id">H5</span>;<span class="tactic">eauto</span>;<span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#Memperm_validblock">Memperm_validblock</a></span> <span class="kwd">in</span> <span class="id">H7</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H5</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#belongsto">belongsto</a></span>;<span class="id">Locs.unfolds</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>)) <span class="id">b0</span> <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span>,<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>,<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> (<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>))) <span class="id">m0</span> <span class="id">m0</span>'). <span class="id">inv</span> <span class="id">H</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> (<span class="id"><a href="InteractionSemantics.html#notbelongsto">notbelongsto</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> (<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>))) <span class="id">m1</span> <span class="id">m1</span>'). <span class="id">inv</span> <span class="id">H4</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H8</span> <span class="kwd">as</span> [[<span class="id">_</span> ?] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H9</span> <span class="kwd">as</span> [[<span class="id">_</span> ?] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H8</span> <span class="id">_</span> <span class="id">_</span> <span class="id">k</span> <span class="id">p</span> <span class="id">H7</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H9</span> <span class="id">_</span> <span class="id">_</span> <span class="id">k</span> <span class="id">p</span> <span class="id">H7</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span>&lt;- <span class="id">H8</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H9</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>. <span class="tactic">eapply</span> <span class="id">EffectPermEqPre</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#FreelistEq">FreelistEq</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">specialize</span> (<span class="id">H3</span> <span class="id">_</span> <span class="id">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#free">free</a></span> <span class="kwd">in</span> *;<span class="id">ex_match</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unchecked_free">unchecked_free</a></span> <span class="kwd">in</span> *;<span class="id">inv</span> <span class="id">H0</span>;<span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>;<span class="id">gmem_unfolds</span>;<span class="id">Esimpl</span>;<span class="tactic">intros</span>;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="kwd">in</span> *;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H0</span>;<span class="id">inv</span> <span class="id">H1</span>;<span class="tactic">simpl</span>;<span class="tactic">try</span> (<span class="tactic">eapply</span> <span class="id">H2</span>;<span class="tactic">eauto</span>;<span class="tactic">fail</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="FMemOpFP.html#range_locset">range_locset</a></span> <span class="id">b</span> <span class="id">z</span> (<span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id">m</span>) <span class="id">b0</span> <span class="id">ofs</span>) <span class="id">eqn</span>:?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#range_locset">range_locset</a></span> <span class="kwd">in</span> <span class="id">Heqb1</span>. <span class="id">ex_match</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span>! <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_iff">andb_true_iff</a></span> <span class="kwd">in</span> <span class="id">Heqb1</span> <span class="kwd">as</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#zle">zle</a></span>;<span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#zlt">zlt</a></span>;<span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#setN_geteq2">setN_geteq2</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Memdata.html#encode_val_length">encode_val_length</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span>&lt;- <span class="id"><a href="Memdata.html#size_chunk_conv">size_chunk_conv</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#range_locset">range_locset</a></span> <span class="kwd">in</span> <span class="id">Heqb1</span>. <span class="id">ex_match</span>;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span>! <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_false_iff">andb_false_iff</a></span> <span class="kwd">in</span> <span class="id">Heqb1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Heqb1</span>;[<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#zle">zle</a></span>|<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#zlt">zlt</a></span>];<span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> !<span class="id"><a href="FMemory.html#Mem.setN_outside">Mem.setN_outside</a></span>;<span class="tactic">eauto</span>;<span class="tactic">try</span> (<span class="id">left</span>;<span class="tactic">omega</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H2</span>;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> !<span class="id"><a href="FMemory.html#Mem.setN_outside">Mem.setN_outside</a></span>;<span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">H2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Memdata.html#encode_val_length">encode_val_length</a></span>,&lt;-<span class="id"><a href="Memdata.html#size_chunk_conv">size_chunk_conv</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Memdata.html#encode_val_length">encode_val_length</a></span>,&lt;-<span class="id"><a href="Memdata.html#size_chunk_conv">size_chunk_conv</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> !<span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>. <span class="tactic">eapply</span> <span class="id">CmpMemPermExists</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>. <span class="tactic">eapply</span> <span class="id">CmpMemPermExists</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>. <span class="tactic">eapply</span> <span class="id">EffectPermEqPre</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#FreelistEq">FreelistEq</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">specialize</span> (<span class="id">H3</span> <span class="id">_</span> <span class="id">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="kwd">in</span> <span class="id">H0</span>,<span class="id">H1</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H0</span>;<span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="Fleq_apply_buffer_preserve">Fleq_apply_buffer_preserve</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">m0</span> <span class="id">m1</span> <span class="id">m0</span>' <span class="id">m1</span>' <span class="id">fl</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#FreelistEq">FreelistEq</a></span> <span class="id"><a href="TSOAuxDefs.html#m0">m0</a></span> <span class="id"><a href="TSOAuxDefs.html#m1">m1</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id"><a href="TSOAuxDefs.html#m0">m0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m0</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id"><a href="TSOAuxDefs.html#m1">m1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#FreelistEq">FreelistEq</a></span> <span class="id">m0</span>' <span class="id">m1</span>' <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9270')">Proof.</div>
<div class="proofscript" id="proof9270">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>;<span class="tactic">intros</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">do</span> 2 <span class="id">inv_some</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#optbind">optbind</a></span> <span class="kwd">in</span> <span class="id">H0</span>,<span class="id">H1</span>. <span class="id">ex_match</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#Fleq_apply_buffer_item_preserve">Fleq_apply_buffer_item_preserve</a></span> <span class="kwd">in</span> <span class="id">H</span>;<span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">Hx0</span>;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="MemPre_apply_buffer_preserve">MemPre_apply_buffer_preserve</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">m0</span> <span class="id">m1</span> <span class="id">m0</span>' <span class="id">m1</span>' <span class="id">fp</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#MemPre">MemPre</a></span> <span class="id"><a href="TSOAuxDefs.html#m0">m0</a></span> <span class="id"><a href="TSOAuxDefs.html#m1">m1</a></span> <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id"><a href="TSOAuxDefs.html#m0">m0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m0</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id"><a href="TSOAuxDefs.html#m1">m1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#MemPre">MemPre</a></span> <span class="id">m0</span>' <span class="id">m1</span>' <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9271')">Proof.</div>
<div class="proofscript" id="proof9271">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>;<span class="tactic">simpl</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>;<span class="id">inv</span> <span class="id">H1</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#optbind">optbind</a></span> <span class="kwd">in</span> *. <span class="id">ex_match</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOAuxDefs.html#MemPre_apply_buffer_item_preserve">MemPre_apply_buffer_item_preserve</a></span>;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="LPre_apply_buffer_preserve">LPre_apply_buffer_preserve</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">m0</span> <span class="id">m1</span> <span class="id">m0</span>' <span class="id">m1</span>' <span class="id">fp</span> <span class="id">fl</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#LPre">LPre</a></span> <span class="id"><a href="TSOAuxDefs.html#m0">m0</a></span> <span class="id"><a href="TSOAuxDefs.html#m1">m1</a></span> <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id"><a href="TSOAuxDefs.html#m0">m0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m0</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id"><a href="TSOAuxDefs.html#m1">m1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#LPre">LPre</a></span> <span class="id">m0</span>' <span class="id">m1</span>' <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9272')">Proof.</div>
<div class="proofscript" id="proof9272">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>;<span class="tactic">simpl</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>;<span class="id">inv</span> <span class="id">H1</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#optbind">optbind</a></span> <span class="kwd">in</span> *. <span class="id">ex_match</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOAuxDefs.html#LPre_apply_buffer_item_preserve">LPre_apply_buffer_item_preserve</a></span>;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_buffer_item_eff">apply_buffer_item_eff</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span> <span class="id">m</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOAuxDefs.html#bi">bi</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#MemEffect">MemEffect</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id">m</span>' (<span class="id"><a href="TSOMem.html#bi_footprint">bi_footprint</a></span> <span class="id"><a href="TSOAuxDefs.html#bi">bi</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9273')">Proof.</div>
<div class="proofscript" id="proof9273">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#alloc_eff">alloc_eff</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#free_eff">free_eff</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#store_eff">store_eff</a></span> <span class="kwd">in</span> <span class="id">H</span>;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_buffer_eff">apply_buffer_eff</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span> <span class="id">m</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOAuxDefs.html#bi">bi</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#MemEffect">MemEffect</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id">m</span>' (<span class="id"><a href="TSOAuxDefs.html#bf_footprint">bf_footprint</a></span> <span class="id"><a href="TSOAuxDefs.html#bi">bi</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9274')">Proof.</div>
<div class="proofscript" id="proof9274">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bi</span>;<span class="tactic">intros</span>;<span class="id">inv</span> <span class="id">H</span>. <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#MemEffect_refl">MemEffect_refl</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#optbind">optbind</a></span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHbi</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#apply_buffer_item_eff">apply_buffer_item_eff</a></span> <span class="kwd">in</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#MemEffect_trans">MemEffect_trans</a></span>;<span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#MemEffect_union_fp">MemEffect_union_fp</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#FP.union_comm_eq">FP.union_comm_eq</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#MemEffect_union_fp">MemEffect_union_fp</a></span>;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="exec_store_TSO_eff">exec_store_TSO_eff</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ge</span> <span class="id">chunk</span> <span class="id">m</span> <span class="id">a</span> <span class="id">rs</span> <span class="id">b</span> <span class="id">c</span> <span class="id">rs</span>' <span class="id">m</span>' <span class="id">m1</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#exec_store_TSO">exec_store_TSO</a></span> <span class="id"><a href="TSOAuxDefs.html#ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#chunk">chunk</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#a">a</a></span> <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> = <span class="kwd">Next</span> <span class="id">rs</span>' <span class="id">m</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> (<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span>)(<span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span>)) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOAuxDefs.html#m1">m1</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> (<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">m</span>')(<span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id">m</span>')) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOAuxDefs.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#LEffect">LEffect</a></span> <span class="id"><a href="TSOAuxDefs.html#m1">m1</a></span> <span class="id"><a href="TSOAuxDefs.html#m2">m2</a></span> (<span class="id"><a href="AsmLang.html#exec_store_fp">exec_store_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#chunk">chunk</a></span> <span class="id"><a href="TSOAuxDefs.html#a">a</a></span> <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span>)(<span class="id"><a href="FMemory.html#Mem.freelist">Mem.freelist</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9275')">Proof.</div>
<div class="proofscript" id="proof9275">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#exec_store_TSO">exec_store_TSO</a></span>,<span class="id"><a href="TSOMem.html#tsostorev">tsostorev</a></span>,<span class="id"><a href="TSOMem.html#tsostore">tsostore</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">Hx</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buffer_split">apply_buffer_split</a></span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> [?[]].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H</span>;<span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#optbind">optbind</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match</span>. <span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#store_eff">store_eff</a></span> <span class="kwd">in</span> <span class="id">Hx</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">auto</span>. <span class="tactic">unfold</span> <span class="id"><a href="AsmLang.html#exec_store_fp">exec_store_fp</a></span>,<span class="id"><a href="FMemOpFP.html#storev_fp">storev_fp</a></span>. <span class="tactic">rewrite</span> <span class="id">Hx0</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#LocalAlloc">LocalAlloc</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="kwd">in</span> <span class="id">Hx</span>. <span class="id">ex_match</span>. <span class="id">inv</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="id">contradiction</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="store_args_rec_fmem_applyable_backwards">store_args_rec_fmem_applyable_backwards</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">args</span> <span class="id">m1</span> <span class="id">b</span> <span class="id">i</span> <span class="id">tys</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#store_args_rec_fmem">store_args_rec_fmem</a></span> <span class="id"><a href="TSOAuxDefs.html#m1">m1</a></span> (<span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) <span class="id"><a href="TSOAuxDefs.html#i">i</a></span> <span class="id"><a href="TSOAuxDefs.html#args">args</a></span> <span class="id"><a href="TSOAuxDefs.html#tys">tys</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOAuxDefs.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m2</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> (<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOAuxDefs.html#m2">m2</a></span>)(<span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id"><a href="TSOAuxDefs.html#m2">m2</a></span>)) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m1</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> (<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOAuxDefs.html#m1">m1</a></span>)(<span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id"><a href="TSOAuxDefs.html#m1">m1</a></span>)) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9276')">Proof.</div>
<div class="proofscript" id="proof9276">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#store_args_fmem_bf_app">store_args_fmem_bf_app</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> ?. <span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#store_args_fmem_memunchg">store_args_fmem_memunchg</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> ?;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buffer_split">apply_buffer_split</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="store_args_rec_fmem_eff_inv">store_args_rec_fmem_eff_inv</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">args</span> <span class="id">m1</span> <span class="id">b</span> <span class="id">i</span> <span class="id">tys</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#store_args_rec_fmem">store_args_rec_fmem</a></span> <span class="id"><a href="TSOAuxDefs.html#m1">m1</a></span> (<span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) <span class="id"><a href="TSOAuxDefs.html#i">i</a></span> <span class="id"><a href="TSOAuxDefs.html#args">args</a></span> <span class="id"><a href="TSOAuxDefs.html#tys">tys</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOAuxDefs.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m1</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> (<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOAuxDefs.html#m1">m1</a></span>)(<span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id"><a href="TSOAuxDefs.html#m1">m1</a></span>)) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m2</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> (<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOAuxDefs.html#m2">m2</a></span>)(<span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id"><a href="TSOAuxDefs.html#m2">m2</a></span>)) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#LEffect">LEffect</a></span> <span class="id">m1</span>' <span class="id">m2</span>' (<span class="id"><a href="loadframe.html#store_args_rec_fp">loadframe.store_args_rec_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#i">i</a></span> <span class="id"><a href="TSOAuxDefs.html#tys">tys</a></span>)(<span class="id"><a href="FMemory.html#Mem.freelist">Mem.freelist</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id"><a href="TSOAuxDefs.html#m1">m1</a></span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9277')">Proof.</div>
<div class="proofscript" id="proof9277">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">args</span>;<span class="tactic">simpl</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="id">inv</span> <span class="id">H1</span>. <span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#LEffect_refl">LEffect_refl</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">ex_match</span>;<span class="tactic">subst</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOAuxDefs.html#store_args_rec_fmem_applyable_backwards">store_args_rec_fmem_applyable_backwards</a></span>;<span class="tactic">eauto</span>;<span class="tactic">simpl</span>;<span class="tactic">intros</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buffer_split">apply_buffer_split</a></span> <span class="kwd">in</span> <span class="id">H2</span> <span class="kwd">as</span> ?;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H3</span> <span class="kwd">in</span> <span class="id">H0</span>;<span class="id">inv</span> <span class="id">H0</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">IHargs</span>;<span class="tactic">eauto</span>;<span class="tactic">simpl</span>;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#LEffect_trans_union">LEffect_trans_union</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span>,<span class="id"><a href="TSOMem.html#optbind">optbind</a></span> <span class="kwd">in</span> <span class="id">H4</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#apply_buffer_item_eff">apply_buffer_item_eff</a></span> <span class="kwd">in</span> <span class="id">Hx</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">auto</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hx</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="kwd">in</span> <span class="id">Hx</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#LocalAlloc">LocalAlloc</a></span>,<span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>;<span class="tactic">simpl</span>;<span class="tactic">intros</span>;<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOAuxDefs.html#store_args_rec_fmem_applyable_backwards">store_args_rec_fmem_applyable_backwards</a></span>;<span class="tactic">eauto</span>;<span class="tactic">simpl</span>;<span class="tactic">intros</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buffer_split">apply_buffer_split</a></span> <span class="kwd">in</span> <span class="id">H2</span> <span class="kwd">as</span> ?;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H3</span> <span class="kwd">in</span> <span class="id">H0</span>;<span class="id">inv</span> <span class="id">H0</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">IHargs</span>;<span class="tactic">eauto</span>;<span class="tactic">simpl</span>;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#LEffect_trans_union">LEffect_trans_union</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span>,<span class="id"><a href="TSOMem.html#optbind">optbind</a></span> <span class="kwd">in</span> <span class="id">H4</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#apply_buffer_item_eff">apply_buffer_item_eff</a></span> <span class="kwd">in</span> <span class="id">Hx</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">auto</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hx</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="kwd">in</span> <span class="id">Hx</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#LocalAlloc">LocalAlloc</a></span>,<span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>;<span class="tactic">simpl</span>;<span class="tactic">intros</span>;<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOAuxDefs.html#store_args_rec_fmem_applyable_backwards">store_args_rec_fmem_applyable_backwards</a></span>;<span class="tactic">eauto</span>;<span class="tactic">simpl</span>;<span class="tactic">intros</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buffer_split">apply_buffer_split</a></span> <span class="kwd">in</span> <span class="id">H2</span> <span class="kwd">as</span> ?;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buffer_split">apply_buffer_split</a></span> <span class="kwd">in</span> <span class="id">H3</span> <span class="kwd">as</span> ?;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H5</span> <span class="kwd">in</span> <span class="id">H0</span>;<span class="id">inv</span> <span class="id">H0</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">IHargs</span>;<span class="tactic">eauto</span>;<span class="tactic">simpl</span>;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#LEffect_trans_union">LEffect_trans_union</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span>,<span class="id"><a href="TSOMem.html#optbind">optbind</a></span> <span class="kwd">in</span> <span class="id">H4</span>,<span class="id">H6</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H4</span>;<span class="id">inv</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#apply_buffer_item_eff">apply_buffer_item_eff</a></span> <span class="kwd">in</span> <span class="id">Hx</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#apply_buffer_item_eff">apply_buffer_item_eff</a></span> <span class="kwd">in</span> <span class="id">Hx0</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#FP.union_comm_eq">FP.union_comm_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#LEffect_trans_union">LEffect_trans_union</a></span> <span class="kwd">with</span>(<span class="id">m2</span>:=<span class="id">x0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="kwd">in</span> <span class="id">Hx0</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">Hx0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#LocalAlloc">LocalAlloc</a></span>,<span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>;<span class="tactic">simpl</span>;<span class="tactic">intros</span>;<span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="kwd">in</span> <span class="id">Hx</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#LocalAlloc">LocalAlloc</a></span>,<span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>;<span class="tactic">simpl</span>;<span class="tactic">intros</span>;<span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOAuxDefs.html#store_args_rec_fmem_applyable_backwards">store_args_rec_fmem_applyable_backwards</a></span>;<span class="tactic">eauto</span>;<span class="tactic">simpl</span>;<span class="tactic">intros</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buffer_split">apply_buffer_split</a></span> <span class="kwd">in</span> <span class="id">H2</span> <span class="kwd">as</span> ?;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H3</span> <span class="kwd">in</span> <span class="id">H0</span>;<span class="id">inv</span> <span class="id">H0</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">IHargs</span>;<span class="tactic">eauto</span>;<span class="tactic">simpl</span>;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#LEffect_trans_union">LEffect_trans_union</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span>,<span class="id"><a href="TSOMem.html#optbind">optbind</a></span> <span class="kwd">in</span> <span class="id">H4</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#apply_buffer_item_eff">apply_buffer_item_eff</a></span> <span class="kwd">in</span> <span class="id">Hx</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">auto</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hx</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="kwd">in</span> <span class="id">Hx</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#LocalAlloc">LocalAlloc</a></span>,<span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>;<span class="tactic">simpl</span>;<span class="tactic">intros</span>;<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOAuxDefs.html#store_args_rec_fmem_applyable_backwards">store_args_rec_fmem_applyable_backwards</a></span>;<span class="tactic">eauto</span>;<span class="tactic">simpl</span>;<span class="tactic">intros</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buffer_split">apply_buffer_split</a></span> <span class="kwd">in</span> <span class="id">H2</span> <span class="kwd">as</span> ?;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H3</span> <span class="kwd">in</span> <span class="id">H0</span>;<span class="id">inv</span> <span class="id">H0</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">IHargs</span>;<span class="tactic">eauto</span>;<span class="tactic">simpl</span>;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#LEffect_trans_union">LEffect_trans_union</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span>,<span class="id"><a href="TSOMem.html#optbind">optbind</a></span> <span class="kwd">in</span> <span class="id">H4</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#apply_buffer_item_eff">apply_buffer_item_eff</a></span> <span class="kwd">in</span> <span class="id">Hx</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">auto</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hx</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="kwd">in</span> <span class="id">Hx</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#LocalAlloc">LocalAlloc</a></span>,<span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>;<span class="tactic">simpl</span>;<span class="tactic">intros</span>;<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOAuxDefs.html#store_args_rec_fmem_applyable_backwards">store_args_rec_fmem_applyable_backwards</a></span>;<span class="tactic">eauto</span>;<span class="tactic">simpl</span>;<span class="tactic">intros</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buffer_split">apply_buffer_split</a></span> <span class="kwd">in</span> <span class="id">H2</span> <span class="kwd">as</span> ?;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H3</span> <span class="kwd">in</span> <span class="id">H0</span>;<span class="id">inv</span> <span class="id">H0</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">IHargs</span>;<span class="tactic">eauto</span>;<span class="tactic">simpl</span>;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#LEffect_trans_union">LEffect_trans_union</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span>,<span class="id"><a href="TSOMem.html#optbind">optbind</a></span> <span class="kwd">in</span> <span class="id">H4</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#apply_buffer_item_eff">apply_buffer_item_eff</a></span> <span class="kwd">in</span> <span class="id">Hx</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">auto</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hx</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="kwd">in</span> <span class="id">Hx</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#LocalAlloc">LocalAlloc</a></span>,<span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>;<span class="tactic">simpl</span>;<span class="tactic">intros</span>;<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Record</span> <span class="id"><a name="TEffect">TEffect</a></span> <span class="id">gm</span> <span class="id">bf</span> <span class="id">gm</span>' <span class="id">bf</span>' <span class="id">fp</span> <span class="id">fl</span>:=<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="img_eff">img_eff</a></span>:<span class="kwd">forall</span> <span class="id">m1</span>', <span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m2</span>', <span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id">bf</span>' <span class="id">gm</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#LEffect">LEffect</a></span> <span class="id">m1</span>' <span class="id">m2</span>' <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="mem_unchg">mem_unchg</a></span>: <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> &lt;&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> \/ <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> &lt;&gt; <span class="id">bf</span>' -&gt; <span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> = <span class="id">gm</span>';<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="mem_chg">mem_chg</a></span>: <span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> &lt;&gt; <span class="id">gm</span>' -&gt; <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> = <span class="id">bf</span>' /\ <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="bf_chg">bf_chg</a></span>: <span class="id">exists</span> <span class="id">ls</span>, <span class="id">bf</span>' = <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> ++ <span class="id"><a href="TSOAuxDefs.html#ls">ls</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="bf_eff">bf_eff</a></span>: <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> &lt;&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> \/ <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> &lt;&gt; <span class="id">bf</span>' -&gt; <span class="id"><a href="TSOAuxDefs.html#BufferEff">BufferEff</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id">bf</span>' <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span>;<br/>
&nbsp;&nbsp;}.<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="TSO_eff">TSO_eff</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ge</span> <span class="id">fl</span> <span class="id">c</span> <span class="id">gm</span> <span class="id">bf</span> <span class="id">fp</span> <span class="id">c</span>' <span class="id">gm</span>' <span class="id">bf</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#tsostep">tsostep</a></span> <span class="id"><a href="TSOAuxDefs.html#ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> (<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>,<span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span>) <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id">c</span>' (<span class="id">bf</span>',<span class="id">gm</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#TEffect">TEffect</a></span> <span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id">gm</span>' <span class="id">bf</span>' <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9278')">Proof.</div>
<div class="proofscript" id="proof9278">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">H7</span>. <span class="id">inv</span> <span class="id">H10</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">i</span>;<span class="id">inv</span> <span class="id">H5</span>;<span class="id">inv</span> <span class="id">H4</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">try</span>(<span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="id">inv</span> <span class="id">H1</span>; <span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#LEffect_refl">LEffect_refl</a></span>;<span class="tactic">fail</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">try</span>(<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#exec_load_TSO">exec_load_TSO</a></span> <span class="kwd">in</span> <span class="id">H7</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H7</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="id">inv</span> <span class="id">H1</span>;<span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#LEffect_refl">LEffect_refl</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">try</span> (<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#exec_store_TSO_eff">exec_store_TSO_eff</a></span> <span class="kwd">in</span> <span class="id">H7</span>;<span class="tactic">eauto</span>;<span class="tactic">fail</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">try</span> (<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#tso_goto_label">tso_goto_label</a></span> <span class="kwd">in</span> <span class="id">H7</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H7</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="id">inv</span> <span class="id">H1</span>;<span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#LEffect_refl">LEffect_refl</a></span>;<span class="tactic">fail</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H7</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buffer_split">apply_buffer_split</a></span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">Hx2</span>;<span class="id">inv</span> <span class="id">Hx2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#optbind">optbind</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match</span>. <span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#free_eff">free_eff</a></span> <span class="kwd">in</span> <span class="id">Hx2</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#FP.union_comm_eq">FP.union_comm_eq</a></span>. <span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#MemEffect_union_fp">MemEffect_union_fp</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#LocalAlloc">LocalAlloc</a></span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#free">free</a></span> <span class="kwd">in</span> <span class="id">Hx2</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">Hx2</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unchecked_free">unchecked_free</a></span>,<span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span> <span class="kwd">in</span> <span class="id">H5</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H5</span>. <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H7</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>;<span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#mem_storev_eff">mem_storev_eff</a></span> <span class="kwd">in</span> <span class="id">Hx1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hx1</span>;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#FP.union_comm_eq">FP.union_comm_eq</a></span>. <span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#MemEffect_union_fp">MemEffect_union_fp</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match</span>; <span class="id">inv</span> <span class="id">H7</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<span class="id">inv</span> <span class="id">H0</span>;<span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#mem_storev_eff">mem_storev_eff</a></span> <span class="kwd">in</span> <span class="id">Hx3</span> <span class="kwd">as</span> [];<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#FP.fp_union_assoc">FP.fp_union_assoc</a></span>,<span class="id"><a href="Footprint.html#FP.union_comm_eq">FP.union_comm_eq</a></span>. <span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#MemEffect_union_fp">MemEffect_union_fp</a></span>;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#LEffect_refl">LEffect_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match</span>. <span class="id">inv</span> <span class="id">H7</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">H0</span>;<span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#mem_storev_eff">mem_storev_eff</a></span> <span class="kwd">in</span> <span class="id">Hx2</span> <span class="kwd">as</span> [];<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#FP.union_comm_eq">FP.union_comm_eq</a></span>;<span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#MemEffect_union_fp">MemEffect_union_fp</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H4</span>;<span class="id">inv</span> <span class="id">H6</span>;<span class="id">inv</span> <span class="id">H7</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">apply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buffer_split">apply_buffer_split</a></span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> [?[]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H12</span>;<span class="id">inv</span> <span class="id">H12</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H0</span>;<span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#LEffect_trans_union">LEffect_trans_union</a></span> <span class="kwd">with</span>(<span class="id">m2</span>:=<span class="id">x0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span>,<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span>,<span class="id"><a href="TSOMem.html#optbind">optbind</a></span> <span class="kwd">in</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#alloc_eff">alloc_eff</a></span> <span class="kwd">in</span> <span class="id">Hx</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="kwd">in</span> <span class="id">Hx</span>;<span class="id">inv</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#LocalAlloc">LocalAlloc</a></span>,<span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H7</span>;<span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span>,<span class="id"><a href="MemAux.html#get_block">get_block</a></span> <span class="kwd">in</span> <span class="id">H7</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="MemAux.html#in_fl">in_fl</a></span>. <span class="id">inv</span> <span class="id">H14</span>. <span class="tactic">rewrite</span> <span class="id">H8</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#LEffect_trans_union">LEffect_trans_union</a></span> <span class="kwd">with</span>(<span class="id">m2</span>:=<span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span>,<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span>,<span class="id"><a href="TSOMem.html#optbind">optbind</a></span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#store_eff">store_eff</a></span> <span class="kwd">in</span> <span class="id">Hx</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#LocalAlloc">LocalAlloc</a></span>,<span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>;<span class="tactic">simpl</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="kwd">in</span> <span class="id">Hx</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H7</span>. <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span>,<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span>,<span class="id"><a href="TSOMem.html#optbind">optbind</a></span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#store_eff">store_eff</a></span> <span class="kwd">in</span> <span class="id">Hx</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#LocalAlloc">LocalAlloc</a></span>,<span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="kwd">in</span> <span class="id">Hx</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">Hx</span>;<span class="tactic">simpl</span>;<span class="tactic">intros</span>;<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="id">inv</span> <span class="id">H1</span>;<span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#LEffect_refl">LEffect_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="id">inv</span> <span class="id">H1</span>;<span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#LEffect_refl">LEffect_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="id">inv</span> <span class="id">H1</span>;<span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#LEffect_refl">LEffect_refl</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tsoalloc_eff">tsoalloc_eff</a></span> <span class="kwd">in</span> <span class="id">H2</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H3</span>;<span class="id">inv</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#LEffect_trans_union">LEffect_trans_union</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#store_args_fmem">store_args_fmem</a></span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#store_args_rec_fmem_eff_inv">store_args_rec_fmem_eff_inv</a></span> <span class="kwd">in</span> <span class="id">H4</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="FMemory.html#Mem.freelist">Mem.freelist</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id">bm1</span>) = <span class="id"><a href="FMemory.html#Mem.freelist">Mem.freelist</a></span> <span class="id">fm</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>. <span class="id">inv</span> <span class="id">H13</span>. <span class="tactic">simpl</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="loadframe.html#store_args_fp">loadframe.store_args_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H3</span> <span class="kwd">in</span> <span class="id">H4</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#TSO_memunchg">TSO_memunchg</a></span>;<span class="tactic">eauto</span>. <span class="tactic">destruct</span> <span class="id">H0</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#TSO_memchg">TSO_memchg</a></span> <span class="kwd">in</span> <span class="id">H0</span>;<span class="tactic">eauto</span>. <span class="id">Hsimpl</span>;<span class="tactic">subst</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#TSO_bf_add">TSO_bf_add</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#TSO_bfeff">TSO_bfeff</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOAuxDefs.html#eff_chg">eff_chg</a></span>) <span class="id">eqn</span>:?;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_chg_t">eff_chg_t</a></span> <span class="kwd">in</span> <span class="id">Heqb</span> <span class="kwd">as</span> [];<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span>;<span class="id">contradiction</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="TEffect_LocalAlloc">TEffect_LocalAlloc</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">gm</span> <span class="id">bf</span> <span class="id">gm</span>' <span class="id">bf</span>' <span class="id">fp</span> <span class="id">fl</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#TEffect">TEffect</a></span> <span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id">gm</span>' <span class="id">bf</span>' <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#LocalAlloc">LocalAlloc</a></span> <span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> <span class="id">gm</span>' <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9279')">Proof.</div>
<div class="proofscript" id="proof9279">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOAuxDefs.html#eff_chg">eff_chg</a></span> <span class="id">bf</span> <span class="id">bf</span>') <span class="id">eqn</span>:?.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_chg_t">eff_chg_t</a></span> <span class="kwd">in</span> <span class="id">Heqb</span> <span class="kwd">as</span> [];<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOAuxDefs.html#img_eff">img_eff</a></span>;<span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H</span>;<span class="tactic">simpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> 1;<span class="tactic">subst</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_chg_f">eff_chg_f</a></span> <span class="kwd">in</span> <span class="id">Heqb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOAuxDefs.html#mem_unchg">mem_unchg</a></span>;<span class="tactic">eauto</span>;<span class="tactic">intro</span>;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#LocalAlloc_refl">LocalAlloc_refl</a></span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="TEffect2">TEffect2</a></span>  <span class="id">gm</span> <span class="id">bf</span> <span class="id">gm</span>' <span class="id">bf</span>' <span class="id">fp</span> <span class="id">fl</span>:=<br/>
&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="TSOAuxDefs.html#eff_chg">eff_chg</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id">bf</span>' <span class="kwd">then</span> <span class="id"><a href="InteractionSemantics.html#LEffect">LEffect</a></span> <span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> <span class="id">gm</span>' <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span><br/>
&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="TSOAuxDefs.html#BufferEff">BufferEff</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id">bf</span>' <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> /\ <span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> = <span class="id">gm</span>'.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="MemEffect_eq_on_eff">MemEffect_eq_on_eff</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fp1</span> <span class="id">fp2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#eff_eq">eff_eq</a></span> <span class="id"><a href="TSOAuxDefs.html#fp1">fp1</a></span> <span class="id"><a href="TSOAuxDefs.html#fp2">fp2</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m1</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#MemEffect">MemEffect</a></span> <span class="id"><a href="TSOAuxDefs.html#m1">m1</a></span> <span class="id"><a href="TSOAuxDefs.html#m2">m2</a></span> <span class="id"><a href="TSOAuxDefs.html#fp1">fp1</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#MemEffect">MemEffect</a></span> <span class="id"><a href="TSOAuxDefs.html#m1">m1</a></span> <span class="id"><a href="TSOAuxDefs.html#m2">m2</a></span> <span class="id"><a href="TSOAuxDefs.html#fp2">fp2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9280')">Proof.</div>
<div class="proofscript" id="proof9280">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#eff_eq">eff_eq</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H</span>,&lt;- <span class="id">H0</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H0</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="buffer_item_local_alloc_local_alloc">buffer_item_local_alloc_local_alloc</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">fl</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_item_local_alloc">buffer_item_local_alloc</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#LocalAlloc">LocalAlloc</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id">m</span>' <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9281')">Proof.</div>
<div class="proofscript" id="proof9281">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bf</span>;<span class="tactic">simpl</span>;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#LocalAlloc">LocalAlloc</a></span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="kwd">in</span> <span class="id">H0</span>;<span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span> <span class="kwd">in</span> <span class="id">H2</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="tactic">destruct</span> <span class="id">H2</span>;<span class="tactic">try</span> <span class="tactic">congruence</span>;<span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#free">free</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unchecked_free">unchecked_free</a></span>,<span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="buffer_local_alloc_apply_buffer_local_alloc">buffer_local_alloc_apply_buffer_local_alloc</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">fl</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_local_alloc">buffer_local_alloc</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#LocalAlloc">LocalAlloc</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id">m</span>' <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9282')">Proof.</div>
<div class="proofscript" id="proof9282">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>;<span class="tactic">intros</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>;<span class="id">inv</span> <span class="id">H0</span>;<span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#LocalAlloc_refl">LocalAlloc_refl</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#optbind">optbind</a></span> <span class="kwd">in</span> <span class="id">H0</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHbf</span> <span class="kwd">with</span>(<span class="id">fl</span>:=<span class="id">fl</span>) <span class="kwd">in</span> <span class="id">H2</span>. <span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#LocalAlloc_trans">LocalAlloc_trans</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#buffer_item_local_alloc_local_alloc">buffer_item_local_alloc_local_alloc</a></span> <span class="kwd">in</span> <span class="id">Hx</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span>;<span class="tactic">simpl</span>;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#buffer_local_alloc">buffer_local_alloc</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">H</span>. <span class="tactic">simpl</span>;<span class="tactic">auto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="TEffect_TEffect2_eq">TEffect_TEffect2_eq</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">bf</span> <span class="id">m</span>' <span class="id">bf</span>' <span class="id">fp</span> <span class="id">fl</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#TEffect">TEffect</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id">m</span>' <span class="id">bf</span>' <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> &lt;-&gt; <span class="id"><a href="TSOAuxDefs.html#TEffect2">TEffect2</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id">m</span>' <span class="id">bf</span>' <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9283')">Proof.</div>
<div class="proofscript" id="proof9283">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#TEffect2">TEffect2</a></span>. <span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_chg_t">eff_chg_t</a></span> <span class="kwd">in</span> <span class="id">Hx</span> <span class="kwd">as</span> []; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOAuxDefs.html#img_eff">img_eff</a></span>;<span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H</span>;<span class="tactic">simpl</span>;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_chg_f">eff_chg_f</a></span> <span class="kwd">in</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">eapply</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#TEffect2">TEffect2</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_chg_t">eff_chg_t</a></span> <span class="kwd">in</span> <span class="id">Hx</span> <span class="kwd">as</span> [];<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">H0</span>;<span class="id">inv</span> <span class="id">H1</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [];<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [];<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_chg_f">eff_chg_f</a></span> <span class="kwd">in</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#BufferEff">BufferEff</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buffer_split">apply_buffer_split</a></span> <span class="kwd">in</span> <span class="id">H2</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>. <span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H</span>;<span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#apply_buffer_eff">apply_buffer_eff</a></span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#MemEffect_eq_on_eff">MemEffect_eq_on_eff</a></span>;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#buffer_local_alloc_apply_buffer_local_alloc">buffer_local_alloc_apply_buffer_local_alloc</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#BufferEff">BufferEff</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="load_locality">load_locality</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">chunk</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#MemPre">MemPre</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id">m</span>' (<span class="id"><a href="FMemOpFP.html#load_fp">load_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#chunk">chunk</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#ofs">ofs</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="TSOAuxDefs.html#chunk">chunk</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#ofs">ofs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOAuxDefs.html#v">v</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="TSOAuxDefs.html#chunk">chunk</a></span> <span class="id">m</span>' <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#ofs">ofs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOAuxDefs.html#v">v</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9284')">Proof.</div>
<div class="proofscript" id="proof9284">
&nbsp;&nbsp;<span class="tactic">inversion</span> 1;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#load">load</a></span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="id">Focus</span> 2. <span class="tactic">clear</span> <span class="id">Hx0</span>;<span class="id">contradict</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">v0</span>. <span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H3</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ReadMemEq</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#load_fp">load_fp</a></span>,<span class="id"><a href="InteractionSemantics.html#belongsto">belongsto</a></span>,<span class="id"><a href="FMemOpFP.html#range_locset">range_locset</a></span>;<span class="id">Locs.unfolds</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>. <span class="tactic">destruct</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#zle">zle</a></span>;<span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#zlt">zlt</a></span>;<span class="tactic">try</span> <span class="id">contradiction</span>. <span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">f_equal</span>. <span class="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemory.html#Mem.getN_exten">Mem.getN_exten</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> &lt;-<span class="id"><a href="Memdata.html#size_chunk_conv">size_chunk_conv</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">v1</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">H1</span>;<span class="tactic">eauto</span>. <span class="tactic">intro</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#belongsto">belongsto</a></span> (<span class="id"><a href="Footprint.html#FP.reads">FP.reads</a></span> (<span class="id"><a href="FMemOpFP.html#load_fp">load_fp</a></span> <span class="id">chunk</span> <span class="id">b</span> <span class="id">ofs</span>)) <span class="id">b</span> <span class="id">i</span>).<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#load_fp">load_fp</a></span>,<span class="id"><a href="InteractionSemantics.html#belongsto">belongsto</a></span>,<span class="id"><a href="FMemOpFP.html#range_locset">range_locset</a></span>;<span class="id">Locs.unfolds</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>. <span class="tactic">destruct</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#zle">zle</a></span>;<span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#zlt">zlt</a></span>;<span class="tactic">try</span> <span class="id">contradiction</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">ReadMemEq</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">v0</span>. <span class="tactic">apply</span> <span class="id">H5</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="load_fp_effect_emp">load_fp_effect_emp</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ge</span> <span class="id">chunk</span> <span class="id">a</span> <span class="id">rs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Footprint.html#Locs.eq">Locs.eq</a></span> (<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>(<span class="id"><a href="AsmLang.html#exec_load_fp">exec_load_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#chunk">chunk</a></span> <span class="id"><a href="TSOAuxDefs.html#a">a</a></span> <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> )) <span class="id"><a href="Footprint.html#Locs.emp">Locs.emp</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9285')">Proof.</div>
<div class="proofscript" id="proof9285">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>,<span class="id"><a href="AsmLang.html#exec_load_fp">exec_load_fp</a></span>,<span class="id"><a href="FMemOpFP.html#loadv_fp">loadv_fp</a></span>,<span class="id"><a href="FMemOpFP.html#load_fp">load_fp</a></span>;<span class="id">ex_match2</span>;<span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#Locs.emp_union_locs">Locs.emp_union_locs</a></span>;<span class="tactic">apply</span> <span class="id"><a href="Footprint.html#Locs.eq_refl">Locs.eq_refl</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Local</span> <span class="id">Transparent</span> <span class="id"><a href="FMemory.html#Mem.load">Mem.load</a></span> <span class="id"><a href="FMemory.html#Mem.alloc">Mem.alloc</a></span> <span class="id"><a href="FMemory.html#Mem.store">Mem.store</a></span> <span class="id"><a href="FMemory.html#Mem.free">Mem.free</a></span>.<br/>
<span class="kwd">Local</span> <span class="kwd">Ltac</span> <span class="id">unfold_unchanged_perm</span> :=<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#unchanged_perm">unchanged_perm</a></span>,<span class="id"><a href="InteractionSemantics.html#unchanged_validity">unchanged_validity</a></span>,<span class="id"><a href="GMemory.html#GMem.eq_perm">GMem.eq_perm</a></span>,<span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>,<span class="id"><a href="GMemory.html#GMem.perm">GMem.perm</a></span> <span class="kwd">in</span> *.<br/>
<br/>
<span class="kwd">Local</span> <span class="kwd">Ltac</span> <span class="id">unfold_belongsto</span> :=<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#belongsto">belongsto</a></span>, <span class="id"><a href="Footprint.html#Locs.belongsto">Locs.belongsto</a></span> <span class="kwd">in</span> *.<br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">unfold_effects</span> :=<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>, <span class="id"><a href="Footprint.html#Locs.union">Locs.union</a></span> <span class="kwd">in</span> *. <br/>
<span class="kwd">Lemma</span> <span class="id"><a name="store_locality">store_locality</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">chunk</span> <span class="id">m</span> <span class="id">m0</span> <span class="id">b</span> <span class="id">z</span> <span class="id">v</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#MemPre">MemPre</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#m0">m0</a></span> (<span class="id"><a href="FMemOpFP.html#store_fp">store_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#chunk">chunk</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#z">z</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOAuxDefs.html#chunk">chunk</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#z">z</a></span> <span class="id"><a href="TSOAuxDefs.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m0</span>' : <span class="id"><a href="GMemory.html#gmem">gmem</a></span>, <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOAuxDefs.html#chunk">chunk</a></span> <span class="id"><a href="TSOAuxDefs.html#m0">m0</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#z">z</a></span> <span class="id"><a href="TSOAuxDefs.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m0</span>' /\ <span class="id"><a href="InteractionSemantics.html#MemPost">MemPost</a></span> <span class="id">m</span>' <span class="id">m0</span>' (<span class="id"><a href="FMemOpFP.html#store_fp">store_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#chunk">chunk</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#z">z</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9286')">Proof.</div>
<div class="proofscript" id="proof9286">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>; <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#MemPost">MemPost</a></span>, <span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold_unchanged_perm</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold_belongsto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold_effects</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#store_fp">FMemOpFP.store_fp</a></span> <span class="kwd">in</span> *; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#range_locset">FMemOpFP.range_locset</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Footprint.html#Locs.emp">Locs.emp</a></span> <span class="kwd">in</span> *; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zle">zle</a></span> <span class="id">z</span> <span class="id">ofs</span>); <span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zlt">zlt</a></span> <span class="id">ofs</span> (<span class="id">z</span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id">chunk</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span> ;<span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">v0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">H0</span>;<span class="tactic">eauto</span>. <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">v1</span>. <span class="id">exploit</span> <span class="id">H3</span>;<span class="tactic">eauto</span>. <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#Memperm_validblock">Memperm_validblock</a></span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#Memperm_validblock">Memperm_validblock</a></span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.perm">GMem.perm</a></span> <span class="kwd">in</span> *; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold_belongsto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold_effects</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#range_locset">FMemOpFP.range_locset</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zle">zle</a></span> <span class="id">z</span> <span class="id">ofs</span>); <span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zlt">zlt</a></span> <span class="id">ofs</span> (<span class="id">z</span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id">chunk</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>; <span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">z</span> &lt;= <span class="id">ofs</span> &lt; <span class="id">z</span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id">chunk</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="FMemLemmas.html#setN_geteq2">setN_geteq2</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Memdata.html#encode_val_length">encode_val_length</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="Memdata.html#size_chunk_conv">size_chunk_conv</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">n</span>; <span class="tactic">clear</span> - <span class="id">v0</span> <span class="id">EffectPermEqPre</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#valid_access">valid_access</a></span>, <span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> <span class="kwd">in</span> *; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id">H1</span> <span class="kwd">as</span> <span class="id">Hrange</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">EffectPermEqPre</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold_belongsto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold_effects</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#range_locset">FMemOpFP.range_locset</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zle">zle</a></span> <span class="id">z</span> <span class="id">ofs</span>); <span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zlt">zlt</a></span> <span class="id">ofs</span> (<span class="id">z</span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id">chunk</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">discriminate</span>;<span class="tactic">try</span> <span class="id">contradiction</span>; <span class="tactic">try</span> <span class="tactic">omega</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="alloc_locality">alloc_locality</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m0</span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#MemPre">MemPre</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#m0">m0</a></span> (<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#z">z</a></span> <span class="id"><a href="TSOAuxDefs.html#z0">z0</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#z">z</a></span> <span class="id"><a href="TSOAuxDefs.html#z0">z0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m0</span>', <span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="id"><a href="TSOAuxDefs.html#m0">m0</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#z">z</a></span> <span class="id"><a href="TSOAuxDefs.html#z0">z0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m0</span>' /\ <span class="id"><a href="InteractionSemantics.html#MemPost">MemPost</a></span> <span class="id">m</span>' <span class="id">m0</span>' (<span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#z">z</a></span> <span class="id"><a href="TSOAuxDefs.html#z0">z0</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9287')">Proof.</div>
<div class="proofscript" id="proof9287">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">eexists</span>; <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#MemPost">MemPost</a></span>, <span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold_unchanged_perm</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">FMemOpFP.uncheck_alloc_fp</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold_effects</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold_belongsto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intro</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intro</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.perm">GMem.perm</a></span> <span class="kwd">in</span> *; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold_belongsto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold_effects</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span>! <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span> <span class="kwd">in</span> *; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="free_locality">free_locality</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m0</span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#MemPre">MemPre</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#m0">m0</a></span> (<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#z">z</a></span> <span class="id"><a href="TSOAuxDefs.html#z0">z0</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#free">free</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#z">z</a></span> <span class="id"><a href="TSOAuxDefs.html#z0">z0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m0</span>' : <span class="id"><a href="GMemory.html#gmem">gmem</a></span>, <span class="id"><a href="TSOMem.html#free">free</a></span> <span class="id"><a href="TSOAuxDefs.html#m0">m0</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#z">z</a></span> <span class="id"><a href="TSOAuxDefs.html#z0">z0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m0</span>' /\ <span class="id"><a href="InteractionSemantics.html#MemPost">MemPost</a></span> <span class="id">m</span>' <span class="id">m0</span>' (<span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#z">z</a></span> <span class="id"><a href="TSOAuxDefs.html#z0">z0</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9288')">Proof.</div>
<div class="proofscript" id="proof9288">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#free">free</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>. <br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>; <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#MemPost">MemPost</a></span>, <span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span>, <span class="id"><a href="TSOMem.html#unchecked_free">unchecked_free</a></span> <span class="kwd">in</span> *; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold_belongsto</span>; <span class="id">unfold_effects</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#range_locset">FMemOpFP.range_locset</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold_unchanged_perm</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Zplus_minus">Zplus_minus</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zle">zle</a></span> <span class="id">z</span> <span class="id">ofs</span>); <span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zlt">zlt</a></span> <span class="id">ofs</span> <span class="id">z0</span>); <span class="id">simpls</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>;<span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">z</span> &lt;= <span class="id">ofs</span> &lt; <span class="id">z0</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">r0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">r</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#Memperm_validblock">Memperm_validblock</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#Memperm_validblock">Memperm_validblock</a></span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Zplus_minus">Zplus_minus</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zle">zle</a></span> <span class="id">z</span> <span class="id">ofs</span>); <span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zlt">zlt</a></span> <span class="id">ofs</span> <span class="id">z0</span>); <span class="id">simpls</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intro</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.perm">GMem.perm</a></span> <span class="kwd">in</span> *; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Zplus_minus">Zplus_minus</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zle">zle</a></span> <span class="id">z</span> <span class="id">ofs</span>); <span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zlt">zlt</a></span> <span class="id">ofs</span> <span class="id">z0</span>); <span class="id">simpls</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>;<span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">n</span>; <span class="tactic">clear</span> - <span class="id">r</span> <span class="id">EffectPermEqPre</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> <span class="kwd">in</span> *; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id">H</span> <span class="kwd">as</span> <span class="id">Hrange</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">r</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">EffectPermEqPre</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#belongsto">belongsto</a></span>,<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>. <span class="id">Locs.unfolds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span>. <span class="tactic">simpl</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#range_locset">FMemOpFP.range_locset</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">subst</span>; <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Zplus_minus">Zplus_minus</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zle">zle</a></span> <span class="id">z</span> <span class="id">ofs</span>); <span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zlt">zlt</a></span> <span class="id">ofs</span> <span class="id">z0</span>); <span class="id">simpls</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">discriminate</span>; <span class="tactic">try</span> <span class="id">contradiction</span>; <span class="tactic">try</span> <span class="tactic">omega</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="buf_item_unbuf_locality_1">buf_item_unbuf_locality_1</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span> <span class="id">m</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuf_locality_1">unbuf_locality_1</a></span> <span class="id"><a href="TSOAuxDefs.html#bi">bi</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id">m</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9289')">Proof.</div>
<div class="proofscript" id="proof9289">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unbuf_locality_1">unbuf_locality_1</a></span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#alloc_locality">alloc_locality</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#free_locality">free_locality</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#store_locality">store_locality</a></span>;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="tsoloadv_locality1">tsoloadv_locality1</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">chunk</span> <span class="id">addr</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tsoloadv">tsoloadv</a></span> <span class="id"><a href="TSOAuxDefs.html#chunk">chunk</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#addr">addr</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOAuxDefs.html#v">v</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#MemPre">MemPre</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span>))(<span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id">m</span>')) (<span class="id"><a href="FMemOpFP.html#loadv_fp">loadv_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#chunk">chunk</a></span> <span class="id"><a href="TSOAuxDefs.html#addr">addr</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> = <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> (<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">m</span>')(<span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id">m</span>'))-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tsoloadv">tsoloadv</a></span> <span class="id"><a href="TSOAuxDefs.html#chunk">chunk</a></span> <span class="id">m</span>' <span class="id"><a href="TSOAuxDefs.html#addr">addr</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOAuxDefs.html#v">v</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9290')">Proof.</div>
<div class="proofscript" id="proof9290">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsoloadv">tsoloadv</a></span>,<span class="id"><a href="TSOMem.html#tsoload">tsoload</a></span>;<span class="tactic">intros</span>;<span class="id">ex_match2</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<span class="tactic">subst</span>;<span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hx1</span>;<span class="id">inv</span> <span class="id">Hx3</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#load_locality">load_locality</a></span>;<span class="tactic">eauto</span>. <span class="id">inv</span> <span class="id">H2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#MemPre_apply_buffer_preserve">MemPre_apply_buffer_preserve</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span>. <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="validity_preserve">validity_preserve</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ge</span> <span class="id">fl</span> <span class="id">c</span> <span class="id">bf</span> <span class="id">gm</span> <span class="id">fp</span> <span class="id">c</span>' <span class="id">bf</span>' <span class="id">gm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#tsostep">tsostep</a></span> <span class="id"><a href="TSOAuxDefs.html#ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> (<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>,<span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span>) <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id">c</span>' (<span class="id">bf</span>',<span class="id">gm</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>  <span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> -&gt; <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span> <span class="id">gm</span>' <span class="id"><a href="TSOAuxDefs.html#b">b</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9291')">Proof.</div>
<div class="proofscript" id="proof9291">
&nbsp;&nbsp;<span class="tactic">inversion</span> 1;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H5</span>. <span class="id">inv</span> <span class="id">H8</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">i</span>;<span class="id">inv</span> <span class="id">H4</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">try</span> (<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#exec_load_TSO">exec_load_TSO</a></span> <span class="kwd">in</span> <span class="id">H6</span>; <span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H6</span>;<span class="tactic">auto</span>;<span class="tactic">fail</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">try</span> (<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#exec_store_TSO">exec_store_TSO</a></span> <span class="kwd">in</span> <span class="id">H6</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H6</span>;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsostorev">tsostorev</a></span>,<span class="id"><a href="TSOMem.html#tsostore">tsostore</a></span> <span class="kwd">in</span> <span class="id">Hx</span>;<span class="id">inv</span> <span class="id">Hx</span>;<span class="id">ex_match</span>;<span class="tactic">auto</span>;<span class="id">inv</span> <span class="id">H5</span>;<span class="tactic">simpl</span>;<span class="tactic">auto</span>;<span class="tactic">fail</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">try</span>(<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#tso_goto_label">tso_goto_label</a></span> <span class="kwd">in</span> <span class="id">H6</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H6</span>;<span class="tactic">auto</span>;<span class="tactic">fail</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">try</span> (<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H6</span>; <span class="tactic">simpl</span>;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#Mem.storev">Mem.storev</a></span>,<span class="id"><a href="FMemory.html#Mem.store">Mem.store</a></span> <span class="kwd">in</span> <span class="id">Hx1</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">Hx1</span>;<span class="tactic">auto</span>;<span class="tactic">fail</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match</span>. <span class="id">inv</span> <span class="id">H6</span>. <span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#Mem.storev">Mem.storev</a></span>,<span class="id"><a href="FMemory.html#Mem.store">Mem.store</a></span> <span class="kwd">in</span> <span class="id">Hx3</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">Hx3</span>;<span class="tactic">auto</span>. <span class="id">inv</span> <span class="id">H6</span>;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match</span>. <span class="id">inv</span> <span class="id">H6</span>. <span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#Mem.storev">Mem.storev</a></span>,<span class="id"><a href="FMemory.html#Mem.store">Mem.store</a></span> <span class="kwd">in</span> <span class="id">Hx2</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">Hx2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#tsostorev_memunchg">tsostorev_memunchg</a></span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#tsostorev_memunchg">tsostorev_memunchg</a></span> <span class="kwd">in</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#tsoalloc_memunchg">tsoalloc_memunchg</a></span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">H3</span>,<span class="id">H5</span>,<span class="id">H6</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#store_args_fmem_memunchg">store_args_fmem_memunchg</a></span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#tsoalloc_memunchg">tsoalloc_memunchg</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">H1</span>,<span class="id">H3</span>;<span class="tactic">auto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="embed_preserve">embed_preserve</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ge</span> <span class="id">fl</span> <span class="id">c</span> <span class="id">bf</span> <span class="id">gm</span> <span class="id">fp</span> <span class="id">c</span>' <span class="id">bf</span>' <span class="id">gm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#tsostep">tsostep</a></span> <span class="id"><a href="TSOAuxDefs.html#ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> (<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>,<span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span>) <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id">c</span>' (<span class="id">bf</span>',<span class="id">gm</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">fm</span>', <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">gm</span>' <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id">fm</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9292')">Proof.</div>
<div class="proofscript" id="proof9292">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">gm</span> = <span class="id">gm</span>' \/ <span class="id">gm</span> &lt;&gt; <span class="id">gm</span>'). <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">Classical_Prop.classic</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span>. <span class="id">inv</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#mem_chg">mem_chg</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> ?;<span class="tactic">subst</span>;<span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#TSO_eff">TSO_eff</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span>;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">H6</span>. <span class="id">inv</span> <span class="id">H9</span>;<span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">i</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H4</span>;<span class="tactic">try</span> <span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#exec_load_TSO">exec_load_TSO</a></span>,<span class="id"><a href="AsmTSO.html#exec_store_TSO">exec_store_TSO</a></span>,<span class="id"><a href="AsmTSO.html#tso_goto_label">tso_goto_label</a></span> <span class="kwd">in</span> <span class="id">H4</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H4</span>;<span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#tsostorev_memunchg">tsostorev_memunchg</a></span> <span class="kwd">in</span> <span class="id">Hx</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#mem_storev_fleq">mem_storev_fleq</a></span> <span class="kwd">in</span> <span class="id">Hx0</span>;<span class="tactic">rewrite</span> <span class="id">Hx0</span>; <span class="id">exists</span> <span class="id">m</span>;<span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#mem_storev_fleq">mem_storev_fleq</a></span> <span class="kwd">in</span> <span class="id">Hx2</span>;<span class="tactic">rewrite</span> <span class="id">Hx2</span>; <span class="id">exists</span> <span class="id">m</span>;<span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#mem_storev_fleq">mem_storev_fleq</a></span> <span class="kwd">in</span> <span class="id">Hx1</span>;<span class="tactic">rewrite</span> <span class="id">Hx1</span>; <span class="id">exists</span> <span class="id">m</span>;<span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#tsoalloc_memunchg">tsoalloc_memunchg</a></span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#tsostorev_memunchg">tsostorev_memunchg</a></span> <span class="kwd">in</span> <span class="id">H5</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#tsostorev_memunchg">tsostorev_memunchg</a></span> <span class="kwd">in</span> <span class="id">H6</span>.  <span class="tactic">simpl</span> <span class="kwd">in</span> *;<span class="tactic">congruence</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#tsoalloc_memunchg">tsoalloc_memunchg</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#store_args_fmem_memunchg">store_args_fmem_memunchg</a></span> <span class="kwd">in</span> <span class="id">H3</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<span class="tactic">congruence</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="embed_back_preserve">embed_back_preserve</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ge</span> <span class="id">fl</span> <span class="id">c</span> <span class="id">bf</span> <span class="id">gm</span> <span class="id">fp</span> <span class="id">c</span>' <span class="id">bf</span>' <span class="id">gm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#tsostep">tsostep</a></span> <span class="id"><a href="TSOAuxDefs.html#ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> (<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>,<span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span>) <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id">c</span>' (<span class="id">bf</span>',<span class="id">gm</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fl2</span> <span class="id">fm</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="MemAux.html#disj">disj</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#fl2">fl2</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">gm</span>' <span class="id"><a href="TSOAuxDefs.html#fl2">fl2</a></span> <span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">fm0</span>,<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> <span class="id"><a href="TSOAuxDefs.html#fl2">fl2</a></span> <span class="id"><a href="TSOAuxDefs.html#fm0">fm0</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9293')">Proof.</div>
<div class="proofscript" id="proof9293">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOAuxDefs.html#eff_chg">eff_chg</a></span> <span class="id">bf</span> <span class="id">bf</span>') <span class="id">eqn</span>:?.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_chg_t">eff_chg_t</a></span> <span class="kwd">in</span> <span class="id">Heqb</span> <span class="kwd">as</span> [];<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOAuxDefs.html#img_eff">img_eff</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#TSO_eff">TSO_eff</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">simpl</span>;<span class="tactic">eauto</span>;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#disjoint_fl_memeq">disjoint_fl_memeq</a></span> <span class="kwd">in</span> <span class="id">H3</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>. <span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#FreelistEq_comm">FreelistEq_comm</a></span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="FMemLemmas.html#FreelistEq_mem_fl_wd">FreelistEq_mem_fl_wd</a></span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>. <span class="tactic">eapply</span> <span class="id"><a href="FMemLemmas.html#gmem_fl_wd_embed">gmem_fl_wd_embed</a></span> <span class="kwd">with</span> (<span class="id">wd</span>:=<span class="id">H3</span>);<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#validity_preserve">validity_preserve</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_chg_f">eff_chg_f</a></span> <span class="kwd">in</span> <span class="id">Heqb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOAuxDefs.html#mem_unchg">mem_unchg</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#TSO_eff">TSO_eff</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Heqb</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>;<span class="tactic">subst</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="embed_preserve2">embed_preserve2</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ge</span> <span class="id">fl</span> <span class="id">c</span> <span class="id">bf</span> <span class="id">gm</span> <span class="id">fp</span> <span class="id">c</span>' <span class="id">bf</span>' <span class="id">gm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#tsostep">tsostep</a></span> <span class="id"><a href="TSOAuxDefs.html#ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> (<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>,<span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span>) <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id">c</span>' (<span class="id">bf</span>',<span class="id">gm</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fl2</span> <span class="id">fm</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="MemAux.html#disj">disj</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#fl2">fl2</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> <span class="id"><a href="TSOAuxDefs.html#fl2">fl2</a></span> <span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">fm0</span>,<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">gm</span>' <span class="id"><a href="TSOAuxDefs.html#fl2">fl2</a></span> <span class="id"><a href="TSOAuxDefs.html#fm0">fm0</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9294')">Proof.</div>
<div class="proofscript" id="proof9294">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOAuxDefs.html#eff_chg">eff_chg</a></span> <span class="id">bf</span> <span class="id">bf</span>') <span class="id">eqn</span>:?.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_chg_t">eff_chg_t</a></span> <span class="kwd">in</span> <span class="id">Heqb</span> <span class="kwd">as</span> [];<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOAuxDefs.html#img_eff">img_eff</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#TSO_eff">TSO_eff</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">simpl</span>;<span class="tactic">eauto</span>;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#disjoint_fl_memeq">disjoint_fl_memeq</a></span> <span class="kwd">in</span> <span class="id">H3</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="FMemLemmas.html#FreelistEq_mem_fl_wd">FreelistEq_mem_fl_wd</a></span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>. <span class="tactic">eapply</span> <span class="id"><a href="FMemLemmas.html#gmem_fl_wd_embed">gmem_fl_wd_embed</a></span> <span class="kwd">with</span> (<span class="id">wd</span>:=<span class="id">H3</span>);<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#validity_preserve">validity_preserve</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_chg_f">eff_chg_f</a></span> <span class="kwd">in</span> <span class="id">Heqb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOAuxDefs.html#mem_unchg">mem_unchg</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#TSO_eff">TSO_eff</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Heqb</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>;<span class="tactic">subst</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<span class="kwd">Ltac</span> <span class="id">inv_next</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">H</span> : <span class="kwd">Next</span> <span class="id">_</span> <span class="id">_</span> = <span class="kwd">Next</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<span class="kwd">Ltac</span> <span class="id">ex_match3</span>:=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H</span>: ?<span class="id">x</span> = ?<span class="id">y</span> |- <span class="id">context</span> [?<span class="id">x</span>] =&gt; <span class="tactic">rewrite</span> <span class="id">H</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="get_block_exists">get_block_exists</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fl</span> <span class="id">n</span>,<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">b</span>,<span class="id"><a href="MemAux.html#get_block">get_block</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#n">n</a></span> = <span class="id"><a href="TSOAuxDefs.html#b">b</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9295')">Proof.</div>
<div class="proofscript" id="proof9295">
 <span class="tactic">eauto</span>. Qed.</div>
<span class="kwd">Lemma</span> <span class="id">fmem_eq</span>':<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fm</span> <span class="id">fm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.mem_contents">Mem.mem_contents</a></span> <span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span> = <span class="id"><a href="FMemory.html#Mem.mem_contents">Mem.mem_contents</a></span> <span class="id">fm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.validblocks">Mem.validblocks</a></span> <span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span> = <span class="id"><a href="FMemory.html#Mem.validblocks">Mem.validblocks</a></span> <span class="id">fm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.freelist">Mem.freelist</a></span> <span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span> = <span class="id"><a href="FMemory.html#Mem.freelist">Mem.freelist</a></span> <span class="id">fm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.mem_access">Mem.mem_access</a></span> <span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span> = <span class="id"><a href="FMemory.html#Mem.mem_access">Mem.mem_access</a></span> <span class="id">fm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span> = <span class="id">fm</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9296')">Proof.</div>
<div class="proofscript" id="proof9296">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fm</span>,<span class="id">fm</span>';<span class="tactic">simpl</span>;<span class="tactic">intros</span>;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">nextblockid</span> = <span class="id">nextblockid0</span>).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">valid_wd</span> <span class="id">valid_wd0</span>;<span class="tactic">clear</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.lt_total">Nat.lt_total</a></span> <span class="id">nextblockid</span> <span class="id">nextblockid0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [|[|]];<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="TSOAuxDefs.html#get_block_exists">get_block_exists</a></span> <span class="id">freelist0</span> <span class="id">nextblockid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">valid_wd</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">valid_wd0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.lt_neq">Nat.lt_neq</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="TSOAuxDefs.html#get_block_exists">get_block_exists</a></span> <span class="id">freelist0</span> <span class="id">nextblockid0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">valid_wd</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">valid_wd0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.lt_neq">Nat.lt_neq</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="Axioms.html#proof_irr">proof_irr</a></span> <span class="id">access_max</span> <span class="id">access_max0</span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="Axioms.html#proof_irr">proof_irr</a></span> <span class="id">freelist_wd</span> <span class="id">freelist_wd0</span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="Axioms.html#proof_irr">proof_irr</a></span> <span class="id">valid_wd</span> <span class="id">valid_wd0</span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="Axioms.html#proof_irr">proof_irr</a></span> <span class="id">invalid_noaccess</span> <span class="id">invalid_noaccess0</span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="Axioms.html#proof_irr">proof_irr</a></span> <span class="id">contents_default</span> <span class="id">contents_default0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="embed_eq">embed_eq</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">gm</span> <span class="id">fl</span> <span class="id">fm</span> <span class="id">fm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id">fm</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span> = <span class="id">fm</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9297')">Proof.</div>
<div class="proofscript" id="proof9297">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>;<span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fm</span>,<span class="id">fm</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="kwd">in</span> *. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">fmem_eq</span>';<span class="tactic">eauto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="cmpu_bool_fp_eq">cmpu_bool_fp_eq</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">c</span> <span class="id">v1</span> <span class="id">v2</span>, <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Cop_fp.html#cmpu_bool_fp_total">Cop_fp.cmpu_bool_fp_total</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> <span class="id"><a href="TSOAuxDefs.html#v1">v1</a></span> <span class="id"><a href="TSOAuxDefs.html#v2">v2</a></span>= <span class="id"><a href="ASM_local.html#of_optfp">of_optfp</a></span> (<span class="id"><a href="Cop_fp.html#cmpu_bool_fp">Cop_fp.cmpu_bool_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> <span class="id"><a href="TSOAuxDefs.html#v1">v1</a></span> <span class="id"><a href="TSOAuxDefs.html#v2">v2</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9298')">Proof.</div>
<div class="proofscript" id="proof9298">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Cop_fp.html#cmpu_bool_fp">Cop_fp.cmpu_bool_fp</a></span>,<span class="id"><a href="Cop_fp.html#cmpu_bool_fp_total">Cop_fp.cmpu_bool_fp_total</a></span>;<span class="tactic">intros</span>;<span class="id">ex_match2</span>;<span class="tactic">auto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="GMem_eq">GMem_eq</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>', <span class="id"><a href="GMemory.html#GMem.eq">GMem.eq</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id">m</span>' &lt;-&gt; <span class="id">GMem.eq</span>' <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id">m</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9299')">Proof.</div>
<div class="proofscript" id="proof9299">
 <span class="tactic">split</span>;<span class="tactic">inversion</span> 1;<span class="tactic">subst</span>;<span class="id">econstructor</span>;<span class="tactic">eauto</span>. Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="storev_eq">storev_eq</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">chunk</span> <span class="id">addr</span> <span class="id">v</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">m</span>'',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.storev">Mem.storev</a></span> <span class="id"><a href="TSOAuxDefs.html#chunk">chunk</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#addr">addr</a></span> <span class="id"><a href="TSOAuxDefs.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.storev">Mem.storev</a></span> <span class="id"><a href="TSOAuxDefs.html#chunk">chunk</a></span> <span class="id">m</span>' <span class="id"><a href="TSOAuxDefs.html#addr">addr</a></span> <span class="id"><a href="TSOAuxDefs.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#unchanged_content">unchanged_content</a></span> (<span class="id"><a href="InteractionSemantics.html#belongsto">belongsto</a></span> (<span class="id"><a href="Footprint.html#FP.writes">FP.writes</a></span> (<span class="id"><a href="FMemOpFP.html#storev_fp">storev_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#chunk">chunk</a></span> <span class="id"><a href="TSOAuxDefs.html#addr">addr</a></span>))) (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span>)(<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">m</span>')-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.eq">GMem.eq</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">m</span>')(<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">m</span>'').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9300')">Proof.</div>
<div class="proofscript" id="proof9300">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#GMem_eq">GMem_eq</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#unchanged_content_memeq">unchanged_content_memeq</a></span> <span class="kwd">with</span>(<span class="id">l</span>:=(<span class="id"><a href="Footprint.html#FP.writes">FP.writes</a></span> (<span class="id"><a href="FMemOpFP.html#storev_fp">storev_fp</a></span> <span class="id">chunk</span> <span class="id">addr</span>)));<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#unchanged_content_trans">unchanged_content_trans</a></span>;<span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#unchanged_content_comm">unchanged_content_comm</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#Mem.storev">Mem.storev</a></span> <span class="kwd">in</span> *;<span class="id">ex_match</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#Mem.store">Mem.store</a></span> <span class="kwd">in</span> *. <span class="id">ex_match2</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#strip">strip</a></span>. <span class="tactic">simpl</span>. <span class="tactic">clear</span> - <span class="id">v1</span> <span class="id">v0</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">gmem_unfolds</span>;<span class="id">Esimpl</span>;<span class="tactic">intros</span>;<span class="tactic">auto</span>;<span class="tactic">try</span> <span class="id">solve</span>[<span class="tactic">eapply</span> <span class="id">H1</span>;<span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#belongsto">belongsto</a></span>,<span class="id"><a href="FMemOpFP.html#range_locset">range_locset</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">Locs.unfolds</span>.  <span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#zle">zle</a></span>;<span class="id">inv</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#zlt">zlt</a></span>;<span class="id">inv</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> !<span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#setN_geteq2">setN_geteq2</a></span>;<span class="tactic">auto</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Memdata.html#size_chunk_conv">size_chunk_conv</a></span> <span class="kwd">in</span> <span class="id">l0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Memdata.html#encode_val_length">encode_val_length</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#mem_storev_eff">mem_storev_eff</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> [[? <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#effects">effects</a></span> <span class="kwd">in</span> <span class="id">MemContentPreserve</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="Footprint.html#FP.frees">FP.frees</a></span> (<span class="id"><a href="FMemOpFP.html#storev_fp">storev_fp</a></span> <span class="id">chunk</span> <span class="id">addr</span>) = <span class="id"><a href="Footprint.html#Locs.emp">Locs.emp</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#storev_fp">storev_fp</a></span>. <span class="id">ex_match2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span>,<span class="id"><a href="Footprint.html#Locs.locs_union_emp">Locs.locs_union_emp</a></span> <span class="kwd">in</span> <span class="id">MemContentPreserve</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="eval_builtin_args_locality">eval_builtin_args_locality</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">args</span> <span class="id">tm</span> <span class="id">ge</span> (<span class="id">rs</span>:<span class="id"><a href="Asm.html#preg">Asm.preg</a></span>-&gt;<span class="id"><a href="Values.html#val">val</a></span>) <span class="id">v</span> <span class="id">vargs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#eval_builtin_args">eval_builtin_args</a></span> <span class="id"><a href="TSOAuxDefs.html#ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id"><a href="TSOAuxDefs.html#v">v</a></span> <span class="id"><a href="TSOAuxDefs.html#tm">tm</a></span> <span class="id"><a href="TSOAuxDefs.html#args">args</a></span> <span class="id"><a href="TSOAuxDefs.html#vargs">vargs</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tm0</span> <span class="id">fp</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#MemPre">MemPre</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id"><a href="TSOAuxDefs.html#tm">tm</a></span>))(<span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id"><a href="TSOAuxDefs.html#tm0">tm0</a></span>)) <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> (<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOAuxDefs.html#tm0">tm0</a></span>) (<span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id"><a href="TSOAuxDefs.html#tm0">tm0</a></span>))-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOAuxDefs.html#tm">tm</a></span> = <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOAuxDefs.html#tm0">tm0</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="MemOpFP.html#eval_builtin_args_fp">MemOpFP.eval_builtin_args_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id"><a href="TSOAuxDefs.html#v">v</a></span> <span class="id"><a href="TSOAuxDefs.html#args">args</a></span> <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#eval_builtin_args">eval_builtin_args</a></span> <span class="id"><a href="TSOAuxDefs.html#ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id"><a href="TSOAuxDefs.html#v">v</a></span> <span class="id"><a href="TSOAuxDefs.html#tm0">tm0</a></span> <span class="id"><a href="TSOAuxDefs.html#args">args</a></span> <span class="id"><a href="TSOAuxDefs.html#vargs">vargs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9301')">Proof.</div>
<div class="proofscript" id="proof9301">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#eval_builtin_args">eval_builtin_args</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">args</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H3</span>. <span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#MemPre_split">MemPre_split</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> [].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">IHargs</span>;<span class="tactic">eauto</span>. <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H3</span> <span class="id">H8</span> <span class="id">H7</span> <span class="id">H0</span> <span class="id">IHargs</span> <span class="id">args</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">tm0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">fp1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">H6</span>;<span class="tactic">intros</span>;<span class="id">inv</span> <span class="id">H5</span>;<span class="tactic">try</span> <span class="id">solve</span>[<span class="id">constructor</span>].<br/>
<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsoloadv">tsoloadv</a></span> <span class="kwd">in</span> *. <span class="id">ex_match</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsoload">tsoload</a></span> <span class="kwd">in</span> *. <span class="id">ex_match</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">destruct</span> <span class="id">tm0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span> . <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">ex_match3</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOAuxDefs.html#MemPre_apply_buffer_preserve">MemPre_apply_buffer_preserve</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H0</span>. <span class="tactic">apply</span> <span class="id">Hx1</span>. <span class="tactic">apply</span> <span class="id">H1</span>. <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#load_locality">load_locality</a></span>;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsoloadv">tsoloadv</a></span> <span class="kwd">in</span> *. <span class="id">ex_match</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsoload">tsoload</a></span> <span class="kwd">in</span> *. <span class="id">ex_match</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">destruct</span> <span class="id">tm0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span> . <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">ex_match3</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOAuxDefs.html#MemPre_apply_buffer_preserve">MemPre_apply_buffer_preserve</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H0</span>. <span class="tactic">apply</span> <span class="id">Hx1</span>. <span class="tactic">apply</span> <span class="id">H1</span>. <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#load_locality">load_locality</a></span>;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#MemPre_split">MemPre_split</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> [].<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHeval_builtin_arg1</span> <span class="kwd">in</span> <span class="id">H4</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHeval_builtin_arg2</span> <span class="kwd">in</span> <span class="id">H6</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="extcall_arg_locality">extcall_arg_locality</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">rs</span> <span class="id">l</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#extcall_arg">extcall_arg</a></span> <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#l">l</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fp</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> = <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOAuxDefs.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> (<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOAuxDefs.html#m2">m2</a></span>)(<span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id"><a href="TSOAuxDefs.html#m2">m2</a></span>))-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#MemPre">MemPre</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span>))(<span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id"><a href="TSOAuxDefs.html#m2">m2</a></span>)) <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ASM_local.html#extcall_arg_fp">extcall_arg_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id"><a href="TSOAuxDefs.html#l">l</a></span> <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#extcall_arg">extcall_arg</a></span> <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id"><a href="TSOAuxDefs.html#m2">m2</a></span> <span class="id"><a href="TSOAuxDefs.html#l">l</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9302')">Proof.</div>
<div class="proofscript" id="proof9302">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>;<span class="tactic">try</span> <span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tsoloadv_locality1">tsoloadv_locality1</a></span>;<span class="tactic">eauto</span>. <span class="id">inv</span> <span class="id">H3</span>;<span class="tactic">auto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="extcall_args_locality">extcall_args_locality</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sig</span> <span class="id">args</span> <span class="id">tm</span> (<span class="id">rs</span>:<span class="id"><a href="Asm.html#preg">Asm.preg</a></span>-&gt;<span class="id"><a href="Values.html#val">val</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#extcall_arguments">extcall_arguments</a></span> <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id"><a href="TSOAuxDefs.html#tm">tm</a></span> <span class="id"><a href="TSOAuxDefs.html#sig">sig</a></span> <span class="id"><a href="TSOAuxDefs.html#args">args</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tm0</span> <span class="id">fp</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#MemPre">MemPre</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id"><a href="TSOAuxDefs.html#tm">tm</a></span>))(<span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id"><a href="TSOAuxDefs.html#tm0">tm0</a></span>)) <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> (<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOAuxDefs.html#tm0">tm0</a></span>) (<span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id"><a href="TSOAuxDefs.html#tm0">tm0</a></span>))-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOAuxDefs.html#tm">tm</a></span> = <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOAuxDefs.html#tm0">tm0</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ASM_local.html#extcall_arguments_fp">extcall_arguments_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id"><a href="TSOAuxDefs.html#sig">sig</a></span> <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#extcall_arguments">extcall_arguments</a></span> <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id"><a href="TSOAuxDefs.html#tm0">tm0</a></span> <span class="id"><a href="TSOAuxDefs.html#sig">sig</a></span> <span class="id"><a href="TSOAuxDefs.html#args">args</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9303')">Proof.</div>
<div class="proofscript" id="proof9303">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#extcall_arguments">extcall_arguments</a></span>,<span class="id"><a href="ASM_local.html#extcall_arguments_fp">extcall_arguments_fp</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">sig</span>. <span class="tactic">generalize</span> (<span class="id"><a href="Conventions1.html#loc_arguments">loc_arguments</a></span> <span class="id">sig</span>).<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">sig</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="id">econstructor</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H5</span>;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#MemPre_split">MemPre_split</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#extcall_arg_locality">extcall_arg_locality</a></span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">H0</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#MemPre_split">MemPre_split</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#MemPre_split">MemPre_split</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#extcall_arg_locality">extcall_arg_locality</a></span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">H0</span>;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#MemPre_split">MemPre_split</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#MemPre_split">MemPre_split</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#extcall_arg_locality">extcall_arg_locality</a></span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">H5</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHl</span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">H7</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#MemPre_split">MemPre_split</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> [];<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="store_stack_fmem_locality">store_stack_fmem_locality</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fm</span> <span class="id">fm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span> = <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">fm</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">z</span> <span class="id">a</span> <span class="id">ty</span> <span class="id">fm1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#store_stack_fmem">store_stack_fmem</a></span> <span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span> <span class="id"><a href="TSOAuxDefs.html#v">v</a></span> <span class="id"><a href="TSOAuxDefs.html#ty">ty</a></span> <span class="id"><a href="TSOAuxDefs.html#z">z</a></span> <span class="id"><a href="TSOAuxDefs.html#a">a</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOAuxDefs.html#fm1">fm1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">fm2</span>, <span class="id"><a href="AsmTSO.html#store_stack_fmem">store_stack_fmem</a></span> <span class="id">fm</span>' <span class="id"><a href="TSOAuxDefs.html#v">v</a></span> <span class="id"><a href="TSOAuxDefs.html#ty">ty</a></span> <span class="id"><a href="TSOAuxDefs.html#z">z</a></span> <span class="id"><a href="TSOAuxDefs.html#a">a</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOAuxDefs.html#fm2">fm2</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOAuxDefs.html#fm1">fm1</a></span> = <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOAuxDefs.html#fm2">fm2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9304')">Proof.</div>
<div class="proofscript" id="proof9304">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#store_stack_fmem">store_stack_fmem</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsostorev">tsostorev</a></span> <span class="kwd">in</span> *. <span class="id">ex_match</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsostore">tsostore</a></span> <span class="kwd">in</span> *. <span class="id">eexists</span>;<span class="tactic">split</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">inv_some</span>. <span class="tactic">simpl</span>. <span class="tactic">congruence</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="store_args_fmem_locality">store_args_fmem_locality</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">b</span> <span class="id">stk</span> <span class="id">tys</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#store_args_fmem">store_args_fmem</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#stk">stk</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#tys">tys</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m0</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOAuxDefs.html#m0">m0</a></span> = <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#store_args_fmem">store_args_fmem</a></span> <span class="id"><a href="TSOAuxDefs.html#m0">m0</a></span>  <span class="id"><a href="TSOAuxDefs.html#stk">stk</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#tys">tys</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOAuxDefs.html#m1">m1</a></span> /\ <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOAuxDefs.html#m1">m1</a></span> = <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">m</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9305')">Proof.</div>
<div class="proofscript" id="proof9305">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#store_args_fmem">store_args_fmem</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> 0.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">b</span>.<br/>
&nbsp;&nbsp;<span class="id">revert</span> <span class="id">z</span> <span class="id">m</span>;<span class="tactic">induction</span> <span class="id">b</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">ex_match</span>. <span class="id">inv_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>. <span class="tactic">split</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<span class="id">ex_match</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">try</span> <span class="id">solve</span>[<span class="tactic">eapply</span> <span class="id">IHb</span> <span class="kwd">in</span> <span class="id">H</span>;<span class="tactic">eauto</span>;<span class="tactic">simpl</span>;<span class="tactic">congruence</span>].<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<span class="kwd">Section</span> <span class="id"><a name="AUX_TSOSTEP">AUX_TSOSTEP</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">ge</span>:<span class="id"><a href="Globalenvs.html#Genv.t">Genv.t</a></span> <span class="id"><a href="AsmTSO.html#F">F</a></span> <span class="id"><a href="AsmTSO.html#V">V</a></span>}.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="notlock_instr">notlock_instr</a></span> <span class="id">i</span>:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="TSOAuxDefs.html#i">i</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="ASM_local.html#Plock_xchg">Plock_xchg</a></span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="ASM_local.html#Plock_cmpxchg">Plock_cmpxchg</a></span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="ASM_local.html#Plock_dec">Plock_dec</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="tso_lock_fstep">tso_lock_fstep</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#core">core</a></span> -&gt; <span class="id"><a href="TSOMem.html#tsofmem">tsofmem</a></span> -&gt; <span class="id"><a href="Footprint.html#FP.t">FP.t</a></span> -&gt; <span class="id"><a href="AsmTSO.html#core">core</a></span> -&gt; <span class="id"><a href="TSOMem.html#tsofmem">tsofmem</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;|<span class="id"><a name="make_lock_step">make_lock_step</a></span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> (<span class="id">f</span>: <span class="id"><a href="ASM_local.html#function">function</a></span>) <span class="id">i</span> <span class="id">rs</span> <span class="id">bm</span> <span class="id">rs</span>' <span class="id">bm</span>' <span class="id">lf</span> <span class="id">fp</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id"><a href="Asm.html#PC">PC</a></span> = <span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#ofs">ofs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Globalenvs.html#Genv.find_funct_ptr">Genv.find_funct_ptr</a></span> <span class="id"><a href="TSOAuxDefs.html#AUX_TSOSTEP.ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="AST.html#Internal">Internal</a></span> <span class="id"><a href="TSOAuxDefs.html#f">f</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ASM_local.html#find_instr">find_instr</a></span> (<span class="id"><a href="Integers.html#Ptrofs.unsigned">Ptrofs.unsigned</a></span> <span class="id"><a href="TSOAuxDefs.html#ofs">ofs</a></span>) <span class="id"><a href="TSOAuxDefs.html#f">f</a></span>.(<span class="id"><a href="ASM_local.html#fn_code">fn_code</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOAuxDefs.html#i">i</a></span> -&gt; <span class="id"><a href="AsmTSO.html#not_alloc_instr">not_alloc_instr</a></span> <span class="id"><a href="TSOAuxDefs.html#i">i</a></span> -&gt; <span class="id"><a href="TSOAuxDefs.html#notlock_instr">notlock_instr</a></span> <span class="id"><a href="TSOAuxDefs.html#i">i</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#exec_instr_TSO">exec_instr_TSO</a></span> <span class="id"><a href="TSOAuxDefs.html#AUX_TSOSTEP.ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#f">f</a></span> <span class="id"><a href="TSOAuxDefs.html#i">i</a></span> <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id"><a href="TSOAuxDefs.html#bm">bm</a></span> = <span class="kwd">Next</span> <span class="id">rs</span>' <span class="id">bm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#exec_instr_TSO_fp">exec_instr_TSO_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#AUX_TSOSTEP.ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#f">f</a></span> <span class="id"><a href="TSOAuxDefs.html#i">i</a></span> <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id"><a href="TSOAuxDefs.html#bm">bm</a></span> = <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#tso_lock_fstep">tso_lock_fstep</a></span> (<span class="id"><a href="ASM_local.html#Core_State">Core_State</a></span> <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id"><a href="TSOAuxDefs.html#lf">lf</a></span>) <span class="id"><a href="TSOAuxDefs.html#bm">bm</a></span> <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> (<span class="id"><a href="ASM_local.html#Core_State">Core_State</a></span> <span class="id">rs</span>' <span class="id"><a href="TSOAuxDefs.html#lf">lf</a></span>) <span class="id">bm</span>'.<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="tso_notlock_fstep">tso_notlock_fstep</a></span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#core">core</a></span> -&gt; <span class="id"><a href="TSOMem.html#tsofmem">tsofmem</a></span> -&gt; <span class="id"><a href="Footprint.html#FP.t">FP.t</a></span> -&gt; <span class="id"><a href="AsmTSO.html#core">core</a></span> -&gt; <span class="id"><a href="TSOMem.html#tsofmem">tsofmem</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id"><a name="tso_exec_step_internal">tso_exec_step_internal</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> (<span class="id">f</span>: <span class="id"><a href="ASM_local.html#function">function</a></span>) <span class="id">i</span> <span class="id">rs</span> <span class="id">bm</span> <span class="id">rs</span>' <span class="id">bm</span>' <span class="id">lf</span> <span class="id">fp</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id"><a href="Asm.html#PC">PC</a></span> = <span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#ofs">ofs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Globalenvs.html#Genv.find_funct_ptr">Genv.find_funct_ptr</a></span> <span class="id"><a href="TSOAuxDefs.html#AUX_TSOSTEP.ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="AST.html#Internal">Internal</a></span> <span class="id"><a href="TSOAuxDefs.html#f">f</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ASM_local.html#find_instr">find_instr</a></span> (<span class="id"><a href="Integers.html#Ptrofs.unsigned">Ptrofs.unsigned</a></span> <span class="id"><a href="TSOAuxDefs.html#ofs">ofs</a></span>) <span class="id"><a href="TSOAuxDefs.html#f">f</a></span>.(<span class="id"><a href="ASM_local.html#fn_code">fn_code</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOAuxDefs.html#i">i</a></span> -&gt; <span class="id"><a href="AsmTSO.html#not_alloc_instr">not_alloc_instr</a></span> <span class="id"><a href="TSOAuxDefs.html#i">i</a></span> -&gt; <span class="id"><a href="TSOAuxDefs.html#notlock_instr">notlock_instr</a></span> <span class="id"><a href="TSOAuxDefs.html#i">i</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#exec_instr_TSO">exec_instr_TSO</a></span> <span class="id"><a href="TSOAuxDefs.html#AUX_TSOSTEP.ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#f">f</a></span> <span class="id"><a href="TSOAuxDefs.html#i">i</a></span> <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id"><a href="TSOAuxDefs.html#bm">bm</a></span> = <span class="kwd">Next</span> <span class="id">rs</span>' <span class="id">bm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#exec_instr_TSO_fp">exec_instr_TSO_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#AUX_TSOSTEP.ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#f">f</a></span> <span class="id"><a href="TSOAuxDefs.html#i">i</a></span> <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id"><a href="TSOAuxDefs.html#bm">bm</a></span> = <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#tso_notlock_fstep">tso_notlock_fstep</a></span> (<span class="id"><a href="ASM_local.html#Core_State">Core_State</a></span> <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id"><a href="TSOAuxDefs.html#lf">lf</a></span>) <span class="id"><a href="TSOAuxDefs.html#bm">bm</a></span> <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> (<span class="id"><a href="ASM_local.html#Core_State">Core_State</a></span> <span class="id">rs</span>' <span class="id"><a href="TSOAuxDefs.html#lf">lf</a></span>) <span class="id">bm</span>'<br/>
<br/>
| <span class="id"><a name="tso_exec_step_internal_allocframe">tso_exec_step_internal_allocframe</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> (<span class="id">f</span> : <span class="id"><a href="ASM_local.html#function">function</a></span>) (<span class="id">rs</span>:<span class="id"><a href="Asm.html#regset">regset</a></span>) <span class="id">bm</span> <span class="id">rs</span>' <span class="id">bm</span>' <span class="id">bm2</span> <span class="id">bm3</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">stk</span> <span class="id">lf</span> <span class="id">fp</span> <span class="id">sz</span> <span class="id">ofs_ra</span> <span class="id">ofs_link</span> <span class="id">sp</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hrs</span>': <span class="id">rs</span>' = <span class="id"><a href="Asm.html#nextinstr">nextinstr</a></span> (<span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> #<span class="id"><a href="Asm.html#RAX">RAX</a></span> &lt;- (<span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span>#<span class="id"><a href="Asm.html#RSP">RSP</a></span>) #<span class="id"><a href="Asm.html#RSP">RSP</a></span> &lt;- <span class="id"><a href="TSOAuxDefs.html#sp">sp</a></span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id"><a href="Asm.html#PC">PC</a></span> = <span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#ofs">ofs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Globalenvs.html#Genv.find_funct_ptr">Genv.find_funct_ptr</a></span> <span class="id"><a href="TSOAuxDefs.html#AUX_TSOSTEP.ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="AST.html#Internal">Internal</a></span> <span class="id"><a href="TSOAuxDefs.html#f">f</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ASM_local.html#find_instr">find_instr</a></span> (<span class="id"><a href="Integers.html#Ptrofs.unsigned">Ptrofs.unsigned</a></span> <span class="id"><a href="TSOAuxDefs.html#ofs">ofs</a></span>) <span class="id"><a href="TSOAuxDefs.html#f">f</a></span>.(<span class="id"><a href="ASM_local.html#fn_code">fn_code</a></span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="ASM_local.html#Pallocframe">Pallocframe</a></span> <span class="id"><a href="TSOAuxDefs.html#sz">sz</a></span> <span class="id"><a href="TSOAuxDefs.html#ofs_ra">ofs_ra</a></span> <span class="id"><a href="TSOAuxDefs.html#ofs_link">ofs_link</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tsoalloc">tsoalloc</a></span> <span class="id"><a href="TSOAuxDefs.html#bm">bm</a></span> 0 <span class="id"><a href="TSOAuxDefs.html#sz">sz</a></span> (<span class="id">bm</span>', <span class="id"><a href="TSOAuxDefs.html#stk">stk</a></span>) -&gt; <span class="id"><a href="TSOAuxDefs.html#sp">sp</a></span> = <span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id"><a href="TSOAuxDefs.html#stk">stk</a></span> <span class="id"><a href="Integers.html#Ptrofs.zero">Ptrofs.zero</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tsostorev">tsostorev</a></span> <span class="id"><a href="AST.html#Mptr">Mptr</a></span> <span class="id">bm</span>' (<span class="id"><a href="Values.html#Val.offset_ptr">Val.offset_ptr</a></span> <span class="id"><a href="TSOAuxDefs.html#sp">sp</a></span> <span class="id"><a href="TSOAuxDefs.html#ofs_link">ofs_link</a></span>) <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span>#<span class="id"><a href="Asm.html#RSP">RSP</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOAuxDefs.html#bm2">bm2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tsostorev">tsostorev</a></span> <span class="id"><a href="AST.html#Mptr">Mptr</a></span> <span class="id"><a href="TSOAuxDefs.html#bm2">bm2</a></span> (<span class="id"><a href="Values.html#Val.offset_ptr">Val.offset_ptr</a></span> <span class="id"><a href="TSOAuxDefs.html#sp">sp</a></span> <span class="id"><a href="TSOAuxDefs.html#ofs_ra">ofs_ra</a></span>) <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span>#<span class="id"><a href="Asm.html#RA">RA</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOAuxDefs.html#bm3">bm3</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> = <span class="id"><a href="Footprint.html#FP.union">FP.union</a></span> (<span class="id"><a href="AsmTSO.html#tsoalloc_fp">tsoalloc_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#stk">stk</a></span> 0 <span class="id"><a href="TSOAuxDefs.html#sz">sz</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Footprint.html#FP.union">FP.union</a></span> (<span class="id"><a href="FMemOpFP.html#storev_fp">storev_fp</a></span> <span class="id"><a href="AST.html#Mptr">Mptr</a></span> (<span class="id"><a href="Values.html#Val.offset_ptr">Val.offset_ptr</a></span> <span class="id"><a href="TSOAuxDefs.html#sp">sp</a></span> <span class="id"><a href="TSOAuxDefs.html#ofs_link">ofs_link</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="FMemOpFP.html#storev_fp">storev_fp</a></span> <span class="id"><a href="AST.html#Mptr">Mptr</a></span> (<span class="id"><a href="Values.html#Val.offset_ptr">Val.offset_ptr</a></span> <span class="id"><a href="TSOAuxDefs.html#sp">sp</a></span> <span class="id"><a href="TSOAuxDefs.html#ofs_ra">ofs_ra</a></span>))) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#tso_notlock_fstep">tso_notlock_fstep</a></span> (<span class="id"><a href="ASM_local.html#Core_State">Core_State</a></span> <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id"><a href="TSOAuxDefs.html#lf">lf</a></span>) <span class="id"><a href="TSOAuxDefs.html#bm">bm</a></span> <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> (<span class="id"><a href="ASM_local.html#Core_State">Core_State</a></span> <span class="id">rs</span>' <span class="id"><a href="TSOAuxDefs.html#lf">lf</a></span>) <span class="id"><a href="TSOAuxDefs.html#bm3">bm3</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
| <span class="id"><a name="tso_exec_step_builtin">tso_exec_step_builtin</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">f</span> <span class="id">ef</span> <span class="id">args</span> <span class="id">fp</span> <span class="id">res</span> <span class="id">rs</span> <span class="id">bm</span> <span class="id">vargs</span> <span class="id">vres</span> <span class="id">rs</span>' <span class="id">lf</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id"><a href="Asm.html#PC">PC</a></span> = <span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#ofs">ofs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Globalenvs.html#Genv.find_funct_ptr">Genv.find_funct_ptr</a></span> <span class="id"><a href="TSOAuxDefs.html#AUX_TSOSTEP.ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="AST.html#Internal">Internal</a></span> <span class="id"><a href="TSOAuxDefs.html#f">f</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ASM_local.html#find_instr">find_instr</a></span> (<span class="id"><a href="Integers.html#Ptrofs.unsigned">Ptrofs.unsigned</a></span> <span class="id"><a href="TSOAuxDefs.html#ofs">ofs</a></span>) <span class="id"><a href="TSOAuxDefs.html#f">f</a></span>.(<span class="id"><a href="ASM_local.html#fn_code">fn_code</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="ASM_local.html#Pbuiltin">Pbuiltin</a></span> <span class="id"><a href="TSOAuxDefs.html#ef">ef</a></span> <span class="id"><a href="TSOAuxDefs.html#args">args</a></span> <span class="id"><a href="TSOAuxDefs.html#res">res</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id"><a href="Asm.html#RSP">RSP</a></span> &lt;&gt; <span class="id"><a href="Values.html#Vundef">Vundef</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#eval_builtin_args">eval_builtin_args</a></span> <span class="id"><a href="TSOAuxDefs.html#AUX_TSOSTEP.ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> (<span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id"><a href="Asm.html#RSP">RSP</a></span>) <span class="id"><a href="TSOAuxDefs.html#bm">bm</a></span> <span class="id"><a href="TSOAuxDefs.html#args">args</a></span> <span class="id"><a href="TSOAuxDefs.html#vargs">vargs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="MemOpFP.html#eval_builtin_args_fp">MemOpFP.eval_builtin_args_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#AUX_TSOSTEP.ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> (<span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id"><a href="Asm.html#RSP">RSP</a></span>) <span class="id"><a href="TSOAuxDefs.html#args">args</a></span> <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="helpers.html#i64ext_sem">helpers.i64ext_sem</a></span> <span class="id"><a href="TSOAuxDefs.html#ef">ef</a></span> <span class="id"><a href="TSOAuxDefs.html#vargs">vargs</a></span> <span class="id"><a href="TSOAuxDefs.html#vres">vres</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rs</span>' = <span class="id"><a href="Asm.html#nextinstr_nf">nextinstr_nf</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Asm.html#set_res">set_res</a></span> <span class="id"><a href="TSOAuxDefs.html#res">res</a></span> <span class="id"><a href="TSOAuxDefs.html#vres">vres</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Asm.html#undef_regs">undef_regs</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="Asm.html#preg_of">preg_of</a></span> (<span class="id"><a href="Machregs.html#destroyed_by_builtin">destroyed_by_builtin</a></span> <span class="id"><a href="TSOAuxDefs.html#ef">ef</a></span>)) <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#tso_notlock_fstep">tso_notlock_fstep</a></span> (<span class="id"><a href="ASM_local.html#Core_State">Core_State</a></span> <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id"><a href="TSOAuxDefs.html#lf">lf</a></span>) <span class="id"><a href="TSOAuxDefs.html#bm">bm</a></span> <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> (<span class="id"><a href="ASM_local.html#Core_State">Core_State</a></span> <span class="id">rs</span>' <span class="id"><a href="TSOAuxDefs.html#lf">lf</a></span>) <span class="id"><a href="TSOAuxDefs.html#bm">bm</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
| <span class="id"><a name="tso_exec_step_to_external">tso_exec_step_to_external</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">ef</span> <span class="id">args</span> <span class="id">rs</span> <span class="id">bm</span> <span class="id">lf</span> <span class="id">fp</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id"><a href="Asm.html#PC">PC</a></span> = <span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="Integers.html#Ptrofs.zero">Ptrofs.zero</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Globalenvs.html#Genv.find_funct_ptr">Genv.find_funct_ptr</a></span> <span class="id"><a href="TSOAuxDefs.html#AUX_TSOSTEP.ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="AST.html#External">External</a></span> <span class="id"><a href="TSOAuxDefs.html#ef">ef</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#extcall_arguments">extcall_arguments</a></span> <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id"><a href="TSOAuxDefs.html#bm">bm</a></span> (<span class="id"><a href="AST.html#ef_sig">ef_sig</a></span> <span class="id"><a href="TSOAuxDefs.html#ef">ef</a></span>) <span class="id"><a href="TSOAuxDefs.html#args">args</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ASM_local.html#extcall_arguments_fp">extcall_arguments_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> (<span class="id"><a href="AST.html#ef_sig">ef_sig</a></span> <span class="id"><a href="TSOAuxDefs.html#ef">ef</a></span>) <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#tso_notlock_fstep">tso_notlock_fstep</a></span> (<span class="id"><a href="ASM_local.html#Core_State">Core_State</a></span> <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id"><a href="TSOAuxDefs.html#lf">lf</a></span>) <span class="id"><a href="TSOAuxDefs.html#bm">bm</a></span> <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> (<span class="id"><a href="ASM_local.html#Core_CallstateOut">Core_CallstateOut</a></span> <span class="id"><a href="TSOAuxDefs.html#ef">ef</a></span> <span class="id"><a href="TSOAuxDefs.html#args">args</a></span> <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id"><a href="TSOAuxDefs.html#lf">lf</a></span>) <span class="id"><a href="TSOAuxDefs.html#bm">bm</a></span><br/>
<br/>
| <span class="id"><a name="tso_exec_step_i64ext">tso_exec_step_i64ext</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">ef</span> <span class="id">args</span> <span class="id">res</span> <span class="id">rs</span> <span class="id">bm</span> <span class="id">rs</span>' <span class="id">lf</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id"><a href="Asm.html#PC">PC</a></span> = <span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="Integers.html#Ptrofs.zero">Ptrofs.zero</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Globalenvs.html#Genv.find_funct_ptr">Genv.find_funct_ptr</a></span> <span class="id"><a href="TSOAuxDefs.html#AUX_TSOSTEP.ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="AST.html#External">External</a></span> <span class="id"><a href="TSOAuxDefs.html#ef">ef</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="helpers.html#i64ext_sem">helpers.i64ext_sem</a></span> <span class="id"><a href="TSOAuxDefs.html#ef">ef</a></span> <span class="id"><a href="TSOAuxDefs.html#args">args</a></span> <span class="id"><a href="TSOAuxDefs.html#res">res</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rs</span>' = (<span class="id"><a href="Asm.html#set_pair">set_pair</a></span> (<span class="id"><a href="Asm.html#loc_external_result">loc_external_result</a></span> (<span class="id"><a href="AST.html#ef_sig">ef_sig</a></span> <span class="id"><a href="TSOAuxDefs.html#ef">ef</a></span>)) <span class="id"><a href="TSOAuxDefs.html#res">res</a></span> <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span>) #<span class="id"><a href="Asm.html#PC">PC</a></span> &lt;- (<span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id"><a href="Asm.html#RA">RA</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#tso_notlock_fstep">tso_notlock_fstep</a></span> (<span class="id"><a href="ASM_local.html#Core_CallstateOut">Core_CallstateOut</a></span> <span class="id"><a href="TSOAuxDefs.html#ef">ef</a></span> <span class="id"><a href="TSOAuxDefs.html#args">args</a></span> <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id"><a href="TSOAuxDefs.html#lf">lf</a></span>) <span class="id"><a href="TSOAuxDefs.html#bm">bm</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> (<span class="id"><a href="ASM_local.html#Core_State">Core_State</a></span> <span class="id">rs</span>' <span class="id"><a href="TSOAuxDefs.html#lf">lf</a></span>) <span class="id"><a href="TSOAuxDefs.html#bm">bm</a></span><br/>
<br/>
| <span class="id"><a name="exec_initialize_call">exec_initialize_call</a></span>: <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bm</span> <span class="id">args</span> <span class="id">tys</span> <span class="id">retty</span> <span class="id">bm1</span> <span class="id">stk</span> <span class="id">bm2</span> <span class="id">fb</span> <span class="id">z</span> <span class="id">fp1</span> <span class="id">fp2</span> <span class="id">fp</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="loadframe.html#args_len_rec">args_len_rec</a></span> <span class="id"><a href="TSOAuxDefs.html#args">args</a></span> <span class="id"><a href="TSOAuxDefs.html#tys">tys</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOAuxDefs.html#z">z</a></span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tsoalloc">tsoalloc</a></span> <span class="id"><a href="TSOAuxDefs.html#bm">bm</a></span> 0 (4*<span class="id"><a href="TSOAuxDefs.html#z">z</a></span>) (<span class="id"><a href="TSOAuxDefs.html#bm1">bm1</a></span>, <span class="id"><a href="TSOAuxDefs.html#stk">stk</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#tsoalloc_fp">tsoalloc_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#stk">stk</a></span> 0 (4*<span class="id"><a href="TSOAuxDefs.html#z">z</a></span>) = <span class="id"><a href="TSOAuxDefs.html#fp1">fp1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#store_args_fmem">store_args_fmem</a></span> <span class="id"><a href="TSOAuxDefs.html#bm1">bm1</a></span> <span class="id"><a href="TSOAuxDefs.html#stk">stk</a></span> <span class="id"><a href="TSOAuxDefs.html#args">args</a></span> <span class="id"><a href="TSOAuxDefs.html#tys">tys</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOAuxDefs.html#bm2">bm2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="loadframe.html#store_args_fp">store_args_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#stk">stk</a></span> <span class="id"><a href="TSOAuxDefs.html#tys">tys</a></span> = <span class="id"><a href="TSOAuxDefs.html#fp2">fp2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Footprint.html#FP.union">FP.union</a></span> <span class="id"><a href="TSOAuxDefs.html#fp1">fp1</a></span> <span class="id"><a href="TSOAuxDefs.html#fp2">fp2</a></span> = <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">rs0</span> := (<span class="id"><a href="Asm.html#Pregmap.init">Pregmap.init</a></span> <span class="id"><a href="Values.html#Vundef">Vundef</a></span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#<span class="id"><a href="Asm.html#PC">PC</a></span> &lt;- (<span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id"><a href="TSOAuxDefs.html#fb">fb</a></span> <span class="id"><a href="Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#<span class="id"><a href="Asm.html#RA">RA</a></span> &lt;- <span class="id"><a href="Values.html#Vzero">Vzero</a></span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#<span class="id"><a href="Asm.html#RSP">RSP</a></span> &lt;- (<span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id"><a href="TSOAuxDefs.html#stk">stk</a></span> <span class="id"><a href="Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#tso_notlock_fstep">tso_notlock_fstep</a></span> (<span class="id"><a href="ASM_local.html#Core_CallstateIn">Core_CallstateIn</a></span> <span class="id"><a href="TSOAuxDefs.html#fb">fb</a></span> <span class="id"><a href="TSOAuxDefs.html#args">args</a></span> <span class="id"><a href="TSOAuxDefs.html#tys">tys</a></span> <span class="id"><a href="TSOAuxDefs.html#retty">retty</a></span>) <span class="id"><a href="TSOAuxDefs.html#bm">bm</a></span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> (<span class="id"><a href="ASM_local.html#Core_State">Core_State</a></span> <span class="id"><a href="TSOAuxDefs.html#rs0">rs0</a></span> (<span class="id"><a href="ASM_local.html#mk_load_frame">mk_load_frame</a></span> <span class="id"><a href="TSOAuxDefs.html#stk">stk</a></span> <span class="id"><a href="TSOAuxDefs.html#retty">retty</a></span>)) <span class="id"><a href="TSOAuxDefs.html#bm2">bm2</a></span><br/>
&nbsp;&nbsp;.<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="tsofstep_lock_or_notlock">tsofstep_lock_or_notlock</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">m</span> <span class="id">b</span> <span class="id">s</span>' <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span> <span class="id"><a href="TSOAuxDefs.html#AUX_TSOSTEP.ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#s">s</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id">s</span>' <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#tso_lock_fstep">tso_lock_fstep</a></span> <span class="id"><a href="TSOAuxDefs.html#s">s</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id">s</span>' <span class="id">m</span>' \/ <span class="id"><a href="TSOAuxDefs.html#tso_notlock_fstep">tso_notlock_fstep</a></span> <span class="id"><a href="TSOAuxDefs.html#s">s</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id">s</span>' <span class="id">m</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9306')">Proof.</div>
<div class="proofscript" id="proof9306">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> 1;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOAuxDefs.html#notlock_instr">notlock_instr</a></span> <span class="id">i</span>) <span class="id">eqn</span>:?;[<span class="id">right</span>|<span class="id">left</span>];<span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>;<span class="id">econstructor</span> 2;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>;<span class="id">econstructor</span> 3;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>;<span class="id">econstructor</span> 4;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>;<span class="id">econstructor</span> 5;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>;<span class="id">econstructor</span> 6;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="lock_step_tsofstep">lock_step_tsofstep</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">m</span> <span class="id">b</span> <span class="id">s</span>' <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#tso_lock_fstep">tso_lock_fstep</a></span> <span class="id"><a href="TSOAuxDefs.html#s">s</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id">s</span>' <span class="id">m</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span> <span class="id"><a href="TSOAuxDefs.html#AUX_TSOSTEP.ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#s">s</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id">s</span>' <span class="id">m</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9307')">Proof.</div>
<div class="proofscript" id="proof9307">
 <span class="tactic">inversion</span> 1;<span class="tactic">subst</span>;<span class="id">econstructor</span>;<span class="tactic">eauto</span>. Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="not_lock_step_tsofstep">not_lock_step_tsofstep</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">m</span> <span class="id">b</span> <span class="id">s</span>' <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#tso_notlock_fstep">tso_notlock_fstep</a></span> <span class="id"><a href="TSOAuxDefs.html#s">s</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id">s</span>' <span class="id">m</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#tsofstep">tsofstep</a></span> <span class="id"><a href="TSOAuxDefs.html#AUX_TSOSTEP.ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#s">s</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id">s</span>' <span class="id">m</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9308')">Proof.</div>
<div class="proofscript" id="proof9308">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> 1;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span> 2;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span> 3;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span> 4;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span> 5;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span> 6;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="lock_step_buffer_nil">lock_step_buffer_nil</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">m</span> <span class="id">b</span> <span class="id">s</span>' <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#tso_lock_fstep">tso_lock_fstep</a></span> <span class="id"><a href="TSOAuxDefs.html#s">s</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id">s</span>' <span class="id">m</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> /\ <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">m</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9309')">Proof.</div>
<div class="proofscript" id="proof9309">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> 1;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#notlock_instr">notlock_instr</a></span> <span class="kwd">in</span> <span class="id">H4</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H4</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#exec_instr_TSO">exec_instr_TSO</a></span> <span class="kwd">in</span> <span class="id">H5</span>;<span class="id">ex_match</span>; <span class="id">inv_next</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="not_lock_step_mem_ung">not_lock_step_mem_ung</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">m</span> <span class="id">b</span> <span class="id">s</span>' <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#tso_notlock_fstep">tso_notlock_fstep</a></span> <span class="id"><a href="TSOAuxDefs.html#s">s</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id">s</span>' <span class="id">m</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span>) = <span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id">m</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9310')">Proof.</div>
<div class="proofscript" id="proof9310">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> 1;<span class="tactic">subst</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#notlock_instr">notlock_instr</a></span> <span class="kwd">in</span> <span class="id">H4</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#exec_instr_TSO">exec_instr_TSO</a></span>,<span class="id"><a href="AsmTSO.html#exec_load_TSO">exec_load_TSO</a></span>,<span class="id"><a href="AsmTSO.html#exec_store_TSO">exec_store_TSO</a></span>,<span class="id"><a href="AsmTSO.html#tso_goto_label">tso_goto_label</a></span> <span class="kwd">in</span> <span class="id">H5</span>;<span class="id">ex_match</span>;<span class="tactic">try</span> <span class="id">inv_next</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>:<span class="tactic">try</span> <span class="id">solve</span>[<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tsostorev_memunchg">tsostorev_memunchg</a></span>;<span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#tsofree_memunchg">tsofree_memunchg</a></span> <span class="kwd">in</span> <span class="id">Hx2</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#tsostorev_memunchg">tsostorev_memunchg</a></span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#tsostorev_memunchg">tsostorev_memunchg</a></span> <span class="kwd">in</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#tsoalloc_memunchg">tsoalloc_memunchg</a></span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#tsoalloc_memunchg">tsoalloc_memunchg</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#store_args_fmem_memunchg">store_args_fmem_memunchg</a></span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="tso_lock_step">tso_lock_step</a></span>:<span class="id"><a href="MemAux.html#freelist">freelist</a></span>-&gt;<span class="id"><a href="AsmTSO.html#core">core</a></span> -&gt; <span class="id"><a href="TSOMem.html#buffer">buffer</a></span> * <span class="id"><a href="GMemory.html#gmem">gmem</a></span> -&gt; <span class="id"><a href="Footprint.html#FP.t">FP.t</a></span> -&gt; <span class="id"><a href="AsmTSO.html#core">core</a></span> -&gt; <span class="id"><a href="TSOMem.html#buffer">buffer</a></span> * <span class="id"><a href="GMemory.html#gmem">gmem</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;|<span class="id"><a name="LockStep">LockStep</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fl</span> <span class="id">c</span>  <span class="id">gm</span> <span class="id">fm</span> <span class="id">fp</span> <span class="id">c</span>' <span class="id">m</span>'  <span class="id">gm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#tso_lock_fstep">tso_lock_fstep</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> {|<span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span>:=<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>;<span class="id">fmemory</span>:=<span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span>|} <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id">c</span>' <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">gm</span>' = <span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id">m</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> = <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#tso_lock_step">tso_lock_step</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>,<span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span>) <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id">c</span>' (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>,<span class="id">gm</span>').<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="tso_lock_step_locality">tso_lock_step_locality</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fl</span> <span class="id">c</span> <span class="id">gm</span> <span class="id">fp</span> <span class="id">c</span>' <span class="id">gm</span>' ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#tso_lock_step">tso_lock_step</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>,<span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span>) <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id">c</span>' (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>,<span class="id">gm</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">gm0</span> <span class="id">fm0</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id"><a href="TSOAuxDefs.html#gm0">gm0</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#fm0">fm0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#LPre">LPre</a></span> <span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> <span class="id"><a href="TSOAuxDefs.html#gm0">gm0</a></span> <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#tso_lock_step">tso_lock_step</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>,<span class="id"><a href="TSOAuxDefs.html#gm0">gm0</a></span>) <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id">c</span>' (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>,<span class="id"><a href="TSOAuxDefs.html#m1">m1</a></span>) /\  <span class="id"><a href="InteractionSemantics.html#LPost">LPost</a></span> <span class="id">gm</span>'  <span class="id"><a href="TSOAuxDefs.html#m1">m1</a></span>  <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9311')">Proof.</div>
<div class="proofscript" id="proof9311">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">fl</span> <span class="id">c</span> <span class="id">gm</span> <span class="id">fp</span> <span class="id">c</span>' <span class="id">gm</span>' <span class="id">STEP</span> <span class="id">gm0</span> <span class="id">fm0</span> <span class="id">EMBED1</span> <span class="id">PRE1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">STEP</span>. <span class="id">inv</span> <span class="id">H1</span>. <span class="id">inv</span> <span class="id">EMBED1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">PRE1</span> <span class="kwd">as</span> [<span class="id">MEMPRE</span> <span class="id">FLEQ</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#notlock_instr">notlock_instr</a></span> <span class="kwd">in</span> <span class="id">H5</span>;<span class="id">ex_match</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<span class="id">ex_match</span>;<span class="tactic">try</span> <span class="id">inv_next</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#MemPre_split">MemPre_split</a></span> <span class="kwd">in</span> <span class="id">MEMPRE</span> <span class="kwd">as</span> [<span class="id">PRE1</span> <span class="id">PRE2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="FMemLemmas.html#MemPre_mem_loadv_eq">MemPre_mem_loadv_eq</a></span> <span class="kwd">with</span>(<span class="id">Fleq</span>:=<span class="id">FLEQ</span>) <span class="kwd">in</span> <span class="id">Hx0</span> <span class="kwd">as</span> <span class="id">R</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="FMemLemmas.html#LPre_mem_storev_LPost">LPre_mem_storev_LPost</a></span> <span class="kwd">with</span>(<span class="id">Fleq</span>:=<span class="id">FLEQ</span>) <span class="kwd">in</span> <span class="id">Hx1</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span> 1 <span class="kwd">with</span>(<span class="id">fm</span>:= (<span class="id"><a href="FMemLemmas.html#combine">combine</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm0</span>) (<span class="id"><a href="FMemory.html#Mem.freelist">Mem.freelist</a></span> <span class="id">fm</span>) (<span class="id"><a href="FMemory.html#Mem.nextblockid">Mem.nextblockid</a></span> <span class="id">fm</span>)(<span class="id"><a href="FMemLemmas.html#FreelistEq_mem_fl_wd">FreelistEq_mem_fl_wd</a></span> <span class="id">fm</span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm0</span>) <span class="id">FLEQ</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">do</span> 2 <span class="id">ex_match3</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H6</span>;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#MemPost_union">MemPost_union</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#MemPost_effect_emp">MemPost_effect_emp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#loadv_fp">loadv_fp</a></span>,<span class="id"><a href="FMemOpFP.html#load_fp">load_fp</a></span>,<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>;<span class="id">ex_match2</span>;<span class="tactic">simpl</span>;<span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#Locs.locs_union_emp">Locs.locs_union_emp</a></span>;<span class="tactic">apply</span> <span class="id"><a href="Footprint.html#Locs.eq_refl">Locs.eq_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#MemPre_split">MemPre_split</a></span> <span class="kwd">in</span> <span class="id">MEMPRE</span> <span class="kwd">as</span> [<span class="id">PRE1</span> <span class="id">PRE2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#MemPre_split">MemPre_split</a></span> <span class="kwd">in</span> <span class="id">PRE2</span> <span class="kwd">as</span> [<span class="id">PRE2</span> <span class="id">PRE3</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="FMemLemmas.html#MemPre_mem_loadv_eq">MemPre_mem_loadv_eq</a></span> <span class="kwd">with</span>(<span class="id">Fleq</span>:=<span class="id">FLEQ</span>) <span class="kwd">in</span> <span class="id">Hx0</span> <span class="kwd">as</span> <span class="id">R</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm0</span>= <span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="FMemLemmas.html#combine">combine</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm0</span>) (<span class="id"><a href="FMemory.html#Mem.freelist">Mem.freelist</a></span> <span class="id">fm</span>) (<span class="id"><a href="FMemory.html#Mem.nextblockid">Mem.nextblockid</a></span> <span class="id">fm</span>)(<span class="id"><a href="FMemLemmas.html#FreelistEq_mem_fl_wd">FreelistEq_mem_fl_wd</a></span> <span class="id">fm</span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm0</span>) <span class="id">FLEQ</span>))). <span class="tactic">rewrite</span> <span class="id"><a href="FMemLemmas.html#strip_combine">strip_combine</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">PRE2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;-<span class="id"><a href="TSOAuxDefs.html#cmpu_bool_fp_eq">cmpu_bool_fp_eq</a></span> <span class="kwd">in</span> <span class="id">PRE2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="FMemLemmas.html#MemPre_cmpu_valid_pointer_ceq">MemPre_cmpu_valid_pointer_ceq</a></span> <span class="kwd">in</span> <span class="id">Hx1</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="FMemLemmas.html#LPre_mem_storev_LPost">LPre_mem_storev_LPost</a></span> <span class="kwd">with</span>(<span class="id">Fleq</span>:=<span class="id">FLEQ</span>) <span class="kwd">in</span> <span class="id">Hx3</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span> 1 <span class="kwd">with</span>(<span class="id">fm</span>:= (<span class="id"><a href="FMemLemmas.html#combine">combine</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm0</span>) (<span class="id"><a href="FMemory.html#Mem.freelist">Mem.freelist</a></span> <span class="id">fm</span>) (<span class="id"><a href="FMemory.html#Mem.nextblockid">Mem.nextblockid</a></span> <span class="id">fm</span>)(<span class="id"><a href="FMemLemmas.html#FreelistEq_mem_fl_wd">FreelistEq_mem_fl_wd</a></span> <span class="id">fm</span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm0</span>) <span class="id">FLEQ</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">do</span> 3 <span class="id">ex_match3</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">repeat</span> <span class="id">ex_match3</span>. <span class="tactic">rewrite</span> <span class="id"><a href="FMemLemmas.html#LPre_cmpu_bool_fp_eq">LPre_cmpu_bool_fp_eq</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="TSOAuxDefs.html#cmpu_bool_fp_eq">cmpu_bool_fp_eq</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H7</span>;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#MemPost_union">MemPost_union</a></span>. <span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#MemPost_effect_emp">MemPost_effect_emp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#loadv_fp">loadv_fp</a></span>,<span class="id"><a href="FMemOpFP.html#load_fp">load_fp</a></span>,<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>;<span class="id">ex_match2</span>;<span class="tactic">simpl</span>;<span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#Locs.locs_union_emp">Locs.locs_union_emp</a></span>;<span class="tactic">apply</span> <span class="id"><a href="Footprint.html#Locs.eq_refl">Locs.eq_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#MemPost_union">MemPost_union</a></span>;<span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#MemPost_effect_emp">MemPost_effect_emp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#cmpu_bool_fp_effemp0">cmpu_bool_fp_effemp0</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#MemPre_split">MemPre_split</a></span> <span class="kwd">in</span> <span class="id">MEMPRE</span> <span class="kwd">as</span> [<span class="id">PRE1</span> <span class="id">PRE2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="FMemLemmas.html#MemPre_mem_loadv_eq">MemPre_mem_loadv_eq</a></span> <span class="kwd">with</span>(<span class="id">Fleq</span>:=<span class="id">FLEQ</span>) <span class="kwd">in</span> <span class="id">Hx0</span> <span class="kwd">as</span> <span class="id">R</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm0</span>= <span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="FMemLemmas.html#combine">combine</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm0</span>) (<span class="id"><a href="FMemory.html#Mem.freelist">Mem.freelist</a></span> <span class="id">fm</span>) (<span class="id"><a href="FMemory.html#Mem.nextblockid">Mem.nextblockid</a></span> <span class="id">fm</span>)(<span class="id"><a href="FMemLemmas.html#FreelistEq_mem_fl_wd">FreelistEq_mem_fl_wd</a></span> <span class="id">fm</span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm0</span>) <span class="id">FLEQ</span>))). <span class="tactic">rewrite</span> <span class="id"><a href="FMemLemmas.html#strip_combine">strip_combine</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">PRE2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;-<span class="id"><a href="TSOAuxDefs.html#cmpu_bool_fp_eq">cmpu_bool_fp_eq</a></span> <span class="kwd">in</span> <span class="id">PRE2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="FMemLemmas.html#MemPre_cmpu_valid_pointer_ceq">MemPre_cmpu_valid_pointer_ceq</a></span> <span class="kwd">in</span> <span class="id">Hx1</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span> 1 <span class="kwd">with</span>(<span class="id">fm</span>:= (<span class="id"><a href="FMemLemmas.html#combine">combine</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm0</span>) (<span class="id"><a href="FMemory.html#Mem.freelist">Mem.freelist</a></span> <span class="id">fm</span>) (<span class="id"><a href="FMemory.html#Mem.nextblockid">Mem.nextblockid</a></span> <span class="id">fm</span>)(<span class="id"><a href="FMemLemmas.html#FreelistEq_mem_fl_wd">FreelistEq_mem_fl_wd</a></span> <span class="id">fm</span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm0</span>) <span class="id">FLEQ</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">do</span> 3 <span class="id">ex_match3</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">do</span> 2 <span class="id">ex_match3</span>.  <span class="tactic">rewrite</span> <span class="id"><a href="FMemLemmas.html#LPre_cmpu_bool_fp_eq">LPre_cmpu_bool_fp_eq</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="TSOAuxDefs.html#cmpu_bool_fp_eq">cmpu_bool_fp_eq</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#MemPost_union">MemPost_union</a></span>;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#MemPost_effect_emp">MemPost_effect_emp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#loadv_fp">loadv_fp</a></span>,<span class="id"><a href="FMemOpFP.html#load_fp">load_fp</a></span>,<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>;<span class="id">ex_match2</span>;<span class="tactic">simpl</span>;<span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#Locs.locs_union_emp">Locs.locs_union_emp</a></span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="Footprint.html#Locs.eq_refl">Locs.eq_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#cmpu_bool_fp_effemp0">cmpu_bool_fp_effemp0</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#MemPre_split">MemPre_split</a></span> <span class="kwd">in</span> <span class="id">MEMPRE</span> <span class="kwd">as</span> [<span class="id">PRE1</span> <span class="id">PRE2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="FMemLemmas.html#MemPre_mem_loadv_eq">MemPre_mem_loadv_eq</a></span> <span class="kwd">with</span>(<span class="id">Fleq</span>:=<span class="id">FLEQ</span>) <span class="kwd">in</span> <span class="id">Hx0</span> <span class="kwd">as</span> <span class="id">R</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="FMemLemmas.html#LPre_mem_storev_LPost">LPre_mem_storev_LPost</a></span> <span class="kwd">with</span>(<span class="id">Fleq</span>:=<span class="id">FLEQ</span>) <span class="kwd">in</span> <span class="id">Hx2</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span> 1 <span class="kwd">with</span>(<span class="id">fm</span>:= (<span class="id"><a href="FMemLemmas.html#combine">combine</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm0</span>) (<span class="id"><a href="FMemory.html#Mem.freelist">Mem.freelist</a></span> <span class="id">fm</span>) (<span class="id"><a href="FMemory.html#Mem.nextblockid">Mem.nextblockid</a></span> <span class="id">fm</span>)(<span class="id"><a href="FMemLemmas.html#FreelistEq_mem_fl_wd">FreelistEq_mem_fl_wd</a></span> <span class="id">fm</span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm0</span>) <span class="id">FLEQ</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">do</span> 2 <span class="id">ex_match3</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H6</span>;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#MemPost_union">MemPost_union</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#MemPost_effect_emp">MemPost_effect_emp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#loadv_fp">loadv_fp</a></span>,<span class="id"><a href="FMemOpFP.html#load_fp">load_fp</a></span>,<span class="id"><a href="InteractionSemantics.html#effects">effects</a></span>;<span class="id">ex_match2</span>;<span class="tactic">simpl</span>;<span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#Locs.locs_union_emp">Locs.locs_union_emp</a></span>;<span class="tactic">apply</span> <span class="id"><a href="Footprint.html#Locs.eq_refl">Locs.eq_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="tso_not_lock_step">tso_not_lock_step</a></span>:<span class="id"><a href="MemAux.html#freelist">freelist</a></span>-&gt;<span class="id"><a href="AsmTSO.html#core">core</a></span> -&gt; <span class="id"><a href="TSOMem.html#buffer">buffer</a></span> * <span class="id"><a href="GMemory.html#gmem">gmem</a></span> -&gt; <span class="id"><a href="Footprint.html#FP.t">FP.t</a></span> -&gt; <span class="id"><a href="AsmTSO.html#core">core</a></span> -&gt; <span class="id"><a href="TSOMem.html#buffer">buffer</a></span> * <span class="id"><a href="GMemory.html#gmem">gmem</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;|<span class="id"><a name="NotLockStep">NotLockStep</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fl</span> <span class="id">c</span> <span class="id">b</span> <span class="id">gm</span> <span class="id">fm</span> <span class="id">fp</span> <span class="id">c</span>' <span class="id">m</span>' <span class="id">b</span>'  <span class="id">gm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#tso_notlock_fstep">tso_notlock_fstep</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> {|<span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span>:=<span class="id"><a href="TSOAuxDefs.html#b">b</a></span>;<span class="id">fmemory</span>:=<span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span>|} <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id">c</span>' <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">gm</span>' = <span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id">m</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">b</span>' = <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#tso_not_lock_step">tso_not_lock_step</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> (<span class="id"><a href="TSOAuxDefs.html#b">b</a></span>,<span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span>) <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id">c</span>' (<span class="id">b</span>',<span class="id">gm</span>').<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="tso_not_lock_step_memung">tso_not_lock_step_memung</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fl</span> <span class="id">c</span> <span class="id">b</span> <span class="id">gm</span> <span class="id">fp</span> <span class="id">c</span>' <span class="id">b</span>' <span class="id">gm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#tso_not_lock_step">tso_not_lock_step</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> (<span class="id"><a href="TSOAuxDefs.html#b">b</a></span>,<span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span>) <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id">c</span>' (<span class="id">b</span>',<span class="id">gm</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> = <span class="id">gm</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9312')">Proof.</div>
<div class="proofscript" id="proof9312">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> 1;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#not_lock_step_mem_ung">not_lock_step_mem_ung</a></span> <span class="kwd">in</span> <span class="id">H9</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">H6</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="tso_valid_pointer_locality">tso_valid_pointer_locality</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">bf</span> <span class="id">fm</span> <span class="id">fm</span>' ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">m</span> := {|<span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span>:=<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>;<span class="id">fmemory</span>:=<span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span>|} <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">m</span>' := {|<span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span>:=<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>;<span class="id">fmemory</span>:=<span class="id">fm</span>'|} <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm</span>')-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#MemPre">MemPre</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span>)(<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm</span>')(<span class="id"><a href="FMemOpFP.html#valid_pointer_fp">valid_pointer_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#x">x</a></span> <span class="id"><a href="TSOAuxDefs.html#y">y</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_valid_pointer">tso_valid_pointer</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#x">x</a></span> <span class="id"><a href="TSOAuxDefs.html#y">y</a></span> = <span class="id"><a href="TSOMem.html#tso_valid_pointer">tso_valid_pointer</a></span> <span class="id">m</span>' <span class="id"><a href="TSOAuxDefs.html#x">x</a></span> <span class="id"><a href="TSOAuxDefs.html#y">y</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9313')">Proof.</div>
<div class="proofscript" id="proof9313">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tso_valid_pointer">tso_valid_pointer</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">m</span>,<span class="id">m</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>,<span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="id">ex_match3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#MemPre_apply_buffer_preserve">MemPre_apply_buffer_preserve</a></span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H</span>;<span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">_</span> [<span class="id">_</span> <span class="id">R</span>] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#valid_pointer_fp">valid_pointer_fp</a></span>,<span class="id"><a href="GMemory.html#GMem.eq_perm">GMem.eq_perm</a></span>,<span class="id"><a href="GMemory.html#GMem.perm">GMem.perm</a></span> <span class="kwd">in</span> <span class="id">R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="tactic">destruct</span> <span class="id"><a href="TSOMem.html#perm_dec">perm_dec</a></span>;<span class="tactic">try</span> <span class="tactic">discriminate</span>;<span class="tactic">auto</span>;<span class="id">contradict</span> <span class="id">n</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">R</span>;<span class="tactic">eauto</span>;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#range_locset_belongsto">range_locset_belongsto</a></span>;<span class="tactic">split</span>;<span class="tactic">auto</span>;<span class="tactic">split</span>;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="tso_weak_valid_pointer_fp_locality">tso_weak_valid_pointer_fp_locality</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">bf</span> <span class="id">fm</span> <span class="id">fm</span>' ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">m</span> := {|<span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span>:=<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>;<span class="id">fmemory</span>:=<span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span>|} <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">m</span>' := {|<span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span>:=<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>;<span class="id">fmemory</span>:=<span class="id">fm</span>'|} <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#MemPre">MemPre</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span>)(<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm</span>')(<span class="id"><a href="AsmTSO.html#tso_weak_valid_pointer_fp">tso_weak_valid_pointer_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#x">x</a></span> <span class="id"><a href="TSOAuxDefs.html#y">y</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#tso_weak_valid_pointer_fp">tso_weak_valid_pointer_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#x">x</a></span> <span class="id"><a href="TSOAuxDefs.html#y">y</a></span> = <span class="id"><a href="AsmTSO.html#tso_weak_valid_pointer_fp">tso_weak_valid_pointer_fp</a></span> <span class="id">m</span>'  <span class="id"><a href="TSOAuxDefs.html#x">x</a></span> <span class="id"><a href="TSOAuxDefs.html#y">y</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9314')">Proof.</div>
<div class="proofscript" id="proof9314">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#tso_weak_valid_pointer_fp">tso_weak_valid_pointer_fp</a></span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tso_valid_pointer_locality">tso_valid_pointer_locality</a></span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOAuxDefs.html#tso_valid_pointer_locality">tso_valid_pointer_locality</a></span> <span class="kwd">in</span> <span class="id">Hx</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#MemPre_subset">MemPre_subset</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="Footprint.html#Locs.subset_refl">Locs.subset_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="FMemLemmas.html#range_locset_expend1_subset">range_locset_expend1_subset</a></span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="tso_weak_valid_pointer">tso_weak_valid_pointer</a></span> (<span class="id">tfm</span> : <span class="id"><a href="TSOMem.html#tsofmem">tsofmem</a></span>) (<span class="id">b</span> : <span class="id"><a href="Values.html#block">block</a></span>) (<span class="id">ofs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_valid_pointer">tso_valid_pointer</a></span> <span class="id"><a href="TSOAuxDefs.html#tfm">tfm</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id"><a href="TSOAuxDefs.html#ofs">ofs</a></span> || <span class="id"><a href="TSOMem.html#tso_valid_pointer">tso_valid_pointer</a></span> <span class="id"><a href="TSOAuxDefs.html#tfm">tfm</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> (<span class="id"><a href="TSOAuxDefs.html#ofs">ofs</a></span>-1).<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="tso_weak_valid_pointer_locality">tso_weak_valid_pointer_locality</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">bf</span> <span class="id">fm</span> <span class="id">fm</span>' ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">m</span> := {|<span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span>:=<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>;<span class="id">fmemory</span>:=<span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span>|} <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">m</span>' := {|<span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span>:=<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>;<span class="id">fmemory</span>:=<span class="id">fm</span>'|} <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#MemPre">MemPre</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span>)(<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm</span>')(<span class="id"><a href="AsmTSO.html#tso_weak_valid_pointer_fp">tso_weak_valid_pointer_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#x">x</a></span> <span class="id"><a href="TSOAuxDefs.html#y">y</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#tso_weak_valid_pointer">tso_weak_valid_pointer</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#x">x</a></span> <span class="id"><a href="TSOAuxDefs.html#y">y</a></span> = <span class="id"><a href="TSOAuxDefs.html#tso_weak_valid_pointer">tso_weak_valid_pointer</a></span> <span class="id">m</span>'  <span class="id"><a href="TSOAuxDefs.html#x">x</a></span> <span class="id"><a href="TSOAuxDefs.html#y">y</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9315')">Proof.</div>
<div class="proofscript" id="proof9315">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#tso_weak_valid_pointer_fp">tso_weak_valid_pointer_fp</a></span>,<span class="id"><a href="TSOAuxDefs.html#tso_weak_valid_pointer">tso_weak_valid_pointer</a></span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tso_valid_pointer_locality">tso_valid_pointer_locality</a></span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="tactic">eauto</span>. <span class="tactic">rewrite</span> &lt;-<span class="id">H1</span>,<span class="id">Hx</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOAuxDefs.html#tso_valid_pointer_locality">tso_valid_pointer_locality</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">H</span>. <span class="tactic">exact</span> <span class="id">H0</span>. <span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#MemPre_subset">MemPre_subset</a></span>;<span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#valid_pointer_fp">valid_pointer_fp</a></span>. <span class="id">econstructor</span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="Footprint.html#Locs.subset_refl">Locs.subset_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#range_locset_expend1_subset">range_locset_expend1_subset</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">Hx</span>. <span class="tactic">rewrite</span> <span class="id">Hx</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOAuxDefs.html#tso_valid_pointer_locality">tso_valid_pointer_locality</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">H</span>. <span class="tactic">exact</span> <span class="id">H0</span>. <span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#MemPre_subset">MemPre_subset</a></span>;<span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="Footprint.html#Locs.subset_refl">Locs.subset_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">instantiate</span>(1:=<span class="id">y</span>-1). <span class="id">instantiate</span>(1:=<span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Locs.unfolds</span>. <span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#range_locset">range_locset</a></span>. <span class="tactic">intros</span>;<span class="id">ex_match</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_iff">andb_true_iff</a></span> <span class="kwd">in</span> <span class="id">H3</span> <span class="kwd">as</span> []. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_iff">andb_true_iff</a></span>;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#zlt">zlt</a></span>;<span class="tactic">auto</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">rewrite</span> <span class="id">H3</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="tso_cmpu_bool_fp_locality">tso_cmpu_bool_fp_locality</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">bf</span> <span class="id">fm</span> <span class="id">fm</span>' <span class="id">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">m</span> := {|<span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span>:=<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>;<span class="id">fmemory</span>:=<span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span>|} <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">m</span>' := {|<span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span>:=<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>;<span class="id">fmemory</span>:=<span class="id">fm</span>'|} <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#MemPre">MemPre</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span>)(<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm</span>')(<span class="id"><a href="AsmTSO.html#tso_cmpu_bool_fp_total">tso_cmpu_bool_fp_total</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> <span class="id"><a href="TSOAuxDefs.html#x">x</a></span> <span class="id"><a href="TSOAuxDefs.html#y">y</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#tso_cmpu_bool_fp_total">tso_cmpu_bool_fp_total</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> <span class="id"><a href="TSOAuxDefs.html#x">x</a></span> <span class="id"><a href="TSOAuxDefs.html#y">y</a></span> = <span class="id"><a href="AsmTSO.html#tso_cmpu_bool_fp_total">tso_cmpu_bool_fp_total</a></span> <span class="id">m</span>' <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> <span class="id"><a href="TSOAuxDefs.html#x">x</a></span> <span class="id"><a href="TSOAuxDefs.html#y">y</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9316')">Proof.</div>
<div class="proofscript" id="proof9316">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#tso_cmpu_bool_fp_total">tso_cmpu_bool_fp_total</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tso_weak_valid_pointer_fp_locality">tso_weak_valid_pointer_fp_locality</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#MemPre_split">MemPre_split</a></span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tso_weak_valid_pointer_fp_locality">tso_weak_valid_pointer_fp_locality</a></span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tso_weak_valid_pointer_fp_locality">tso_weak_valid_pointer_fp_locality</a></span> <span class="kwd">in</span> <span class="id">H2</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="tso_cmpu_bool_locality">tso_cmpu_bool_locality</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">bf</span> <span class="id">fm</span> <span class="id">fm</span>' <span class="id">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">m</span> := {|<span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span>:=<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>;<span class="id">fmemory</span>:=<span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span>|} <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">m</span>' := {|<span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span>:=<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>;<span class="id">fmemory</span>:=<span class="id">fm</span>'|} <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#MemPre">MemPre</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span>)(<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm</span>')(<span class="id"><a href="AsmTSO.html#tso_cmpu_bool_fp_total">tso_cmpu_bool_fp_total</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> <span class="id"><a href="TSOAuxDefs.html#x">x</a></span> <span class="id"><a href="TSOAuxDefs.html#y">y</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Values.html#Val.cmpu">Val.cmpu</a></span> (<span class="id"><a href="TSOMem.html#tso_valid_pointer">tso_valid_pointer</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span>) <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> <span class="id"><a href="TSOAuxDefs.html#x">x</a></span> <span class="id"><a href="TSOAuxDefs.html#y">y</a></span> = <span class="id"><a href="Values.html#Val.cmpu">Val.cmpu</a></span> (<span class="id"><a href="TSOMem.html#tso_valid_pointer">tso_valid_pointer</a></span> <span class="id">m</span>') <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> <span class="id"><a href="TSOAuxDefs.html#x">x</a></span> <span class="id"><a href="TSOAuxDefs.html#y">y</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9317')">Proof.</div>
<div class="proofscript" id="proof9317">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Values.html#Val.cmpu">Val.cmpu</a></span>,<span class="id"><a href="AsmTSO.html#tso_cmpu_bool_fp_total">tso_cmpu_bool_fp_total</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Values.html#Val.cmpu_bool">Val.cmpu_bool</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="tactic">compute</span> ["&amp;&amp;"] <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">try</span> <span class="id">solve</span>[<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tso_weak_valid_pointer_locality">tso_weak_valid_pointer_locality</a></span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="tactic">eauto</span>;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#tso_weak_valid_pointer">tso_weak_valid_pointer</a></span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="tactic">congruence</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#MemPre_split">MemPre_split</a></span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">H1</span> <span class="id">H2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tso_weak_valid_pointer_locality">tso_weak_valid_pointer_locality</a></span> <span class="kwd">in</span> <span class="id">H2</span>;<span class="tactic">eauto</span>;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#tso_weak_valid_pointer">tso_weak_valid_pointer</a></span> <span class="kwd">in</span> <span class="id">H2</span>;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tso_weak_valid_pointer_locality">tso_weak_valid_pointer_locality</a></span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="tactic">eauto</span>;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#tso_weak_valid_pointer">tso_weak_valid_pointer</a></span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#MemPre_split">MemPre_split</a></span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">H1</span> <span class="id">H2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tso_weak_valid_pointer_locality">tso_weak_valid_pointer_locality</a></span> <span class="kwd">in</span> <span class="id">H2</span>;<span class="tactic">eauto</span>;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#tso_weak_valid_pointer">tso_weak_valid_pointer</a></span> <span class="kwd">in</span> <span class="id">H2</span>;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tso_weak_valid_pointer_locality">tso_weak_valid_pointer_locality</a></span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="tactic">eauto</span>;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#tso_weak_valid_pointer">tso_weak_valid_pointer</a></span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#MemPre_split">MemPre_split</a></span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">H1</span> <span class="id">H2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tso_valid_pointer_locality">tso_valid_pointer_locality</a></span> <span class="kwd">in</span> <span class="id">H2</span>;<span class="tactic">eauto</span>;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#tso_weak_valid_pointer">tso_weak_valid_pointer</a></span> <span class="kwd">in</span> <span class="id">H2</span>;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tso_valid_pointer_locality">tso_valid_pointer_locality</a></span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="tactic">eauto</span>;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#tso_weak_valid_pointer">tso_weak_valid_pointer</a></span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#MemPre_split">MemPre_split</a></span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">H1</span> <span class="id">H2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tso_valid_pointer_locality">tso_valid_pointer_locality</a></span> <span class="kwd">in</span> <span class="id">H2</span>;<span class="tactic">eauto</span>;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#tso_weak_valid_pointer">tso_weak_valid_pointer</a></span> <span class="kwd">in</span> <span class="id">H2</span>;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tso_valid_pointer_locality">tso_valid_pointer_locality</a></span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="tactic">eauto</span>;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#tso_weak_valid_pointer">tso_weak_valid_pointer</a></span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="compare_ints_TSO_fp_locality">compare_ints_TSO_fp_locality</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">bf</span> <span class="id">fm</span> <span class="id">fm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">m</span> := {|<span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span>:=<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>;<span class="id">fmemory</span>:=<span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span>|} <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">m</span>' := {|<span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span>:=<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>;<span class="id">fmemory</span>:=<span class="id">fm</span>'|} <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm</span>')-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#MemPre">MemPre</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span>)(<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm</span>')(<span class="id"><a href="AsmTSO.html#compare_ints_TSO_fp">compare_ints_TSO_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#x">x</a></span> <span class="id"><a href="TSOAuxDefs.html#y">y</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#compare_ints_TSO_fp">compare_ints_TSO_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#x">x</a></span> <span class="id"><a href="TSOAuxDefs.html#y">y</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> = <span class="id"><a href="AsmTSO.html#compare_ints_TSO_fp">compare_ints_TSO_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#x">x</a></span> <span class="id"><a href="TSOAuxDefs.html#y">y</a></span>  <span class="id">m</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9318')">Proof.</div>
<div class="proofscript" id="proof9318">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#compare_ints_TSO_fp">compare_ints_TSO_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#MemPre_split">MemPre_split</a></span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">f_equal</span>; <span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tso_cmpu_bool_fp_locality">tso_cmpu_bool_fp_locality</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="compare_ints_TSO_locality">compare_ints_TSO_locality</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">bf</span> <span class="id">fm</span> <span class="id">fm</span>' <span class="id">rs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">m</span> := {|<span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span>:=<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>;<span class="id">fmemory</span>:=<span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span>|} <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">m</span>' := {|<span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span>:=<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>;<span class="id">fmemory</span>:=<span class="id">fm</span>'|} <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm</span>')-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#MemPre">MemPre</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span>)(<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm</span>')(<span class="id"><a href="AsmTSO.html#compare_ints_TSO_fp">compare_ints_TSO_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#x">x</a></span> <span class="id"><a href="TSOAuxDefs.html#y">y</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#compare_ints_TSO">compare_ints_TSO</a></span> <span class="id"><a href="TSOAuxDefs.html#x">x</a></span> <span class="id"><a href="TSOAuxDefs.html#y">y</a></span> <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> = <span class="id"><a href="AsmTSO.html#compare_ints_TSO">compare_ints_TSO</a></span> <span class="id"><a href="TSOAuxDefs.html#x">x</a></span> <span class="id"><a href="TSOAuxDefs.html#y">y</a></span> <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id">m</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9319')">Proof.</div>
<div class="proofscript" id="proof9319">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#compare_ints_TSO_fp">compare_ints_TSO_fp</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#compare_ints_TSO">compare_ints_TSO</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#MemPre_split">MemPre_split</a></span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">f_equal</span>. <span class="tactic">f_equal</span>. <span class="tactic">f_equal</span>. <span class="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tso_cmpu_bool_locality">tso_cmpu_bool_locality</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">f_equal</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tso_cmpu_bool_locality">tso_cmpu_bool_locality</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="exec_load_TSO_buffer_unchg">exec_load_TSO_buffer_unchg</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">chunk</span> <span class="id">m</span> <span class="id">addr</span> <span class="id">rs</span> <span class="id">p</span> <span class="id">rs</span>' <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#exec_load_TSO">exec_load_TSO</a></span> <span class="id"><a href="TSOAuxDefs.html#AUX_TSOSTEP.ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#chunk">chunk</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#addr">addr</a></span> <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id"><a href="TSOAuxDefs.html#p">p</a></span> = <span class="kwd">Next</span> <span class="id">rs</span>' <span class="id">m</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> = <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">m</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9320')">Proof.</div>
<div class="proofscript" id="proof9320">
 <span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#exec_load_TSO">exec_load_TSO</a></span>;<span class="tactic">intros</span>;<span class="id">ex_match</span>. Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="exec_load_TSO_locality">exec_load_TSO_locality</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">chunk</span> <span class="id">m</span> <span class="id">addr</span> <span class="id">rs</span> <span class="id">p</span> <span class="id">rs</span>' <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#exec_load_TSO">exec_load_TSO</a></span> <span class="id"><a href="TSOAuxDefs.html#AUX_TSOSTEP.ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#chunk">chunk</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#addr">addr</a></span> <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id"><a href="TSOAuxDefs.html#p">p</a></span> = <span class="kwd">Next</span> <span class="id">rs</span>' <span class="id">m</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m0</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> = <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOAuxDefs.html#m0">m0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> (<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOAuxDefs.html#m0">m0</a></span>)(<span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id"><a href="TSOAuxDefs.html#m0">m0</a></span>))-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#MemPre">MemPre</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span>))(<span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id"><a href="TSOAuxDefs.html#m0">m0</a></span>))(<span class="id"><a href="AsmLang.html#exec_load_fp">exec_load_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#AUX_TSOSTEP.ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#chunk">chunk</a></span> <span class="id"><a href="TSOAuxDefs.html#addr">addr</a></span> <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#exec_load_TSO">exec_load_TSO</a></span> <span class="id"><a href="TSOAuxDefs.html#AUX_TSOSTEP.ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#chunk">chunk</a></span> <span class="id"><a href="TSOAuxDefs.html#m0">m0</a></span> <span class="id"><a href="TSOAuxDefs.html#addr">addr</a></span> <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id"><a href="TSOAuxDefs.html#p">p</a></span> = <span class="kwd">Next</span> <span class="id">rs</span>' <span class="id"><a href="TSOAuxDefs.html#m0">m0</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9321')">Proof.</div>
<div class="proofscript" id="proof9321">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#exec_load_TSO">exec_load_TSO</a></span>;<span class="tactic">intros</span>;<span class="id">ex_match</span>;<span class="id">inv_next</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tsoloadv_locality1">tsoloadv_locality1</a></span> <span class="kwd">in</span> <span class="id">Hx</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match3</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="exec_store_TSO_memunchg">exec_store_TSO_memunchg</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">chunk</span> <span class="id">m</span> <span class="id">addr</span> <span class="id">rs</span> <span class="id">p</span> <span class="id">lp</span> <span class="id">rs</span>' <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#exec_store_TSO">exec_store_TSO</a></span> <span class="id"><a href="TSOAuxDefs.html#AUX_TSOSTEP.ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#chunk">chunk</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#addr">addr</a></span> <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id"><a href="TSOAuxDefs.html#p">p</a></span> <span class="id"><a href="TSOAuxDefs.html#lp">lp</a></span> = <span class="kwd">Next</span> <span class="id">rs</span>' <span class="id">m</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span>) = <span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id">m</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9322')">Proof.</div>
<div class="proofscript" id="proof9322">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#exec_store_TSO">exec_store_TSO</a></span>;<span class="tactic">intros</span>;<span class="id">ex_match</span>;<span class="id">inv_next</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tsostorev_memunchg">tsostorev_memunchg</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="exec_store_TSO_locality">exec_store_TSO_locality</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">chunk</span> <span class="id">m</span> <span class="id">addr</span> <span class="id">rs</span> <span class="id">p</span> <span class="id">lp</span> <span class="id">rs</span>' <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#exec_store_TSO">exec_store_TSO</a></span> <span class="id"><a href="TSOAuxDefs.html#AUX_TSOSTEP.ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#chunk">chunk</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#addr">addr</a></span> <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id"><a href="TSOAuxDefs.html#p">p</a></span> <span class="id"><a href="TSOAuxDefs.html#lp">lp</a></span> = <span class="kwd">Next</span> <span class="id">rs</span>' <span class="id">m</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m0</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m0</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#exec_store_TSO">exec_store_TSO</a></span> <span class="id"><a href="TSOAuxDefs.html#AUX_TSOSTEP.ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#chunk">chunk</a></span> <span class="id"><a href="TSOAuxDefs.html#m0">m0</a></span> <span class="id"><a href="TSOAuxDefs.html#addr">addr</a></span> <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id"><a href="TSOAuxDefs.html#p">p</a></span> <span class="id"><a href="TSOAuxDefs.html#lp">lp</a></span>= <span class="kwd">Next</span> <span class="id">rs</span>' <span class="id">m0</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9323')">Proof.</div>
<div class="proofscript" id="proof9323">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#exec_store_TSO">exec_store_TSO</a></span>,<span class="id"><a href="AsmLang.html#exec_store_fp">exec_store_fp</a></span>;<span class="tactic">intros</span>;<span class="id">ex_match</span>;<span class="id">inv_next</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsostorev">tsostorev</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsostore">tsostore</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv_some</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="exec_store_TSO_locality2">exec_store_TSO_locality2</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">chunk</span> <span class="id">m</span> <span class="id">addr</span> <span class="id">rs</span> <span class="id">p</span> <span class="id">lp</span> <span class="id">rs</span>' <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#exec_store_TSO">exec_store_TSO</a></span> <span class="id"><a href="TSOAuxDefs.html#AUX_TSOSTEP.ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#chunk">chunk</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#addr">addr</a></span> <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id"><a href="TSOAuxDefs.html#p">p</a></span> <span class="id"><a href="TSOAuxDefs.html#lp">lp</a></span> = <span class="kwd">Next</span> <span class="id">rs</span>' <span class="id">m</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m0</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> = <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOAuxDefs.html#m0">m0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m0</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#exec_store_TSO">exec_store_TSO</a></span> <span class="id"><a href="TSOAuxDefs.html#AUX_TSOSTEP.ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#chunk">chunk</a></span> <span class="id"><a href="TSOAuxDefs.html#m0">m0</a></span> <span class="id"><a href="TSOAuxDefs.html#addr">addr</a></span> <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span> <span class="id"><a href="TSOAuxDefs.html#p">p</a></span> <span class="id"><a href="TSOAuxDefs.html#lp">lp</a></span>= <span class="kwd">Next</span> <span class="id">rs</span>' <span class="id">m0</span>' /\ <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">m</span>' = <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">m0</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9324')">Proof.</div>
<div class="proofscript" id="proof9324">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#exec_store_TSO">exec_store_TSO</a></span>,<span class="id"><a href="AsmLang.html#exec_store_fp">exec_store_fp</a></span>;<span class="tactic">intros</span>;<span class="id">ex_match</span>;<span class="id">inv_next</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsostorev">tsostorev</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsostore">tsostore</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv_some</span>. <span class="id">eexists</span>;<span class="tactic">split</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#buffer_insert">buffer_insert</a></span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="tsofmem_eq">tsofmem_eq</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span>, <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> = {|<span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span>:=<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span>;<span class="id">fmemory</span>:=<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span>|}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9325')">Proof.</div>
<div class="proofscript" id="proof9325">
 <span class="tactic">destruct</span> <span class="id">m</span>;<span class="tactic">auto</span>. Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="fleq_nextblockideq">fleq_nextblockideq</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">fl</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#FreelistEq">FreelistEq</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id">m</span>' <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fm</span> <span class="id">fm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">m</span>' <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id">fm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.nextblockid">Mem.nextblockid</a></span> <span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span> = <span class="id"><a href="FMemory.html#Mem.nextblockid">Mem.nextblockid</a></span> <span class="id">fm</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9326')">Proof.</div>
<div class="proofscript" id="proof9326">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#FreelistEq">FreelistEq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>;<span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#strip">strip</a></span>,<span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="MemAux.html#in_fl">in_fl</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="kwd">forall</span> <span class="id">b</span> <span class="id">n</span>, <span class="id"><a href="MemAux.html#get_block">get_block</a></span> (<span class="id"><a href="FMemory.html#Mem.freelist">Mem.freelist</a></span> <span class="id">fm</span>) <span class="id"><a href="TSOAuxDefs.html#n">n</a></span> = <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> -&gt;    <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> (<span class="id"><a href="FMemory.html#Mem.validblocks">Mem.validblocks</a></span> <span class="id">fm</span>) &lt;-&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> (<span class="id"><a href="FMemory.html#Mem.validblocks">Mem.validblocks</a></span> <span class="id">fm</span>')).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fm</span>,<span class="id">fm</span>'. <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">subst</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H1</span> <span class="id">valid_wd</span> <span class="id">valid_wd0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.lt_total">Nat.lt_total</a></span> <span class="id">nextblockid</span> <span class="id">nextblockid0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [|[|]];<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="TSOAuxDefs.html#get_block_exists">get_block_exists</a></span> <span class="id">freelist</span> <span class="id">nextblockid</span> <span class="kwd">as</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd0</span> <span class="kwd">in</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd</span> <span class="kwd">in</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="TSOAuxDefs.html#get_block_exists">get_block_exists</a></span> <span class="id">freelist</span> <span class="id">nextblockid0</span> <span class="kwd">as</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd</span> <span class="kwd">in</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd0</span> <span class="kwd">in</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="buffer_fl_embed">buffer_fl_embed</a></span> <span class="id">bf</span> <span class="id">fl</span> <span class="id">m</span>:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m</span>', <span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' /\ <span class="id">exists</span> <span class="id">fm</span>', <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">m</span>' <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id">fm</span>'.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="buffer_fl_embed_rel">buffer_fl_embed_rel</a></span> <span class="id">bf</span> <span class="id">fl</span> <span class="id">m</span> <span class="id">m</span>':=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_fl_embed">buffer_fl_embed</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_fl_embed">buffer_fl_embed</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id">m</span>'.<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="alloc_buffer_fl_embed_rel">alloc_buffer_fl_embed_rel</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">fl</span> <span class="id">m</span> <span class="id">fm</span> <span class="id">fm2</span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tsoalloc">tsoalloc</a></span> ({|<span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span>:=<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>;<span class="id">fmemory</span>:=<span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span>|}) <span class="id"><a href="TSOAuxDefs.html#lo">lo</a></span> <span class="id"><a href="TSOAuxDefs.html#hi">hi</a></span> (<span class="id"><a href="TSOAuxDefs.html#fm2">fm2</a></span>,<span class="id"><a href="TSOAuxDefs.html#b">b</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_fl_embed">buffer_fl_embed</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9327')">Proof.</div>
<div class="proofscript" id="proof9327">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#buffer_fl_embed">buffer_fl_embed</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="check_compare_ints_TSO_locality">check_compare_ints_TSO_locality</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">bf</span> <span class="id">fm</span> <span class="id">fm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">m</span> := {|<span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span>:=<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>;<span class="id">fmemory</span>:=<span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span>|} <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">m</span>' := {|<span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span>:=<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>;<span class="id">fmemory</span>:=<span class="id">fm</span>'|} <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm</span>')-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#MemPre">MemPre</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span>)(<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm</span>')(<span class="id"><a href="AsmTSO.html#compare_ints_TSO_fp">compare_ints_TSO_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#x">x</a></span> <span class="id"><a href="TSOAuxDefs.html#y">y</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#check_compare_ints_TSO">check_compare_ints_TSO</a></span> <span class="id"><a href="TSOAuxDefs.html#x">x</a></span> <span class="id"><a href="TSOAuxDefs.html#y">y</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> = <span class="id"><a href="AsmTSO.html#check_compare_ints_TSO">check_compare_ints_TSO</a></span> <span class="id"><a href="TSOAuxDefs.html#x">x</a></span> <span class="id"><a href="TSOAuxDefs.html#y">y</a></span> <span class="id">m</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9328')">Proof.</div>
<div class="proofscript" id="proof9328">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#check_compare_ints_TSO">check_compare_ints_TSO</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Values.html#Val.cmpu_bool">Val.cmpu_bool</a></span> (<span class="id"><a href="TSOMem.html#tso_valid_pointer">tso_valid_pointer</a></span> <span class="id">m</span>) <span class="id"><a href="Integers.html#Ceq">Ceq</a></span> <span class="id">x</span> <span class="id">y</span> = <span class="id"><a href="Values.html#Val.cmpu_bool">Val.cmpu_bool</a></span> (<span class="id"><a href="TSOMem.html#tso_valid_pointer">tso_valid_pointer</a></span> <span class="id">m</span>') <span class="id"><a href="Integers.html#Ceq">Ceq</a></span> <span class="id">x</span> <span class="id">y</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#compare_ints_TSO_fp">compare_ints_TSO_fp</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#MemPre_split">MemPre_split</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">H1</span> <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Values.html#Val.cmpu">Val.cmpu</a></span>, <span class="id"><a href="AsmTSO.html#tso_cmpu_bool_fp_total">tso_cmpu_bool_fp_total</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Values.html#Val.cmpu_bool">Val.cmpu_bool</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="tactic">compute</span> ["&amp;&amp;"] <span class="kwd">in</span> *; <span class="tactic">subst</span> <span class="id">m</span> <span class="id">m</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">try</span> <span class="id">solve</span>[<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tso_weak_valid_pointer_locality">tso_weak_valid_pointer_locality</a></span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="tactic">eauto</span>;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#tso_weak_valid_pointer">tso_weak_valid_pointer</a></span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="tactic">congruence</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#MemPre_split">MemPre_split</a></span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">H1</span> <span class="id">H2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tso_weak_valid_pointer_locality">tso_weak_valid_pointer_locality</a></span> <span class="kwd">in</span> <span class="id">H2</span>;<span class="tactic">eauto</span>;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#tso_weak_valid_pointer">tso_weak_valid_pointer</a></span> <span class="kwd">in</span> <span class="id">H2</span>;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tso_weak_valid_pointer_locality">tso_weak_valid_pointer_locality</a></span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="tactic">eauto</span>;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#tso_weak_valid_pointer">tso_weak_valid_pointer</a></span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#MemPre_split">MemPre_split</a></span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">H1</span> <span class="id">H2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tso_weak_valid_pointer_locality">tso_weak_valid_pointer_locality</a></span> <span class="kwd">in</span> <span class="id">H2</span>;<span class="tactic">eauto</span>;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#tso_weak_valid_pointer">tso_weak_valid_pointer</a></span> <span class="kwd">in</span> <span class="id">H2</span>;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tso_weak_valid_pointer_locality">tso_weak_valid_pointer_locality</a></span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="tactic">eauto</span>;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#tso_weak_valid_pointer">tso_weak_valid_pointer</a></span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#MemPre_split">MemPre_split</a></span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">H1</span> <span class="id">H2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tso_valid_pointer_locality">tso_valid_pointer_locality</a></span> <span class="kwd">in</span> <span class="id">H2</span>;<span class="tactic">eauto</span>;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#tso_weak_valid_pointer">tso_weak_valid_pointer</a></span> <span class="kwd">in</span> <span class="id">H2</span>;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tso_valid_pointer_locality">tso_valid_pointer_locality</a></span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="tactic">eauto</span>;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#tso_weak_valid_pointer">tso_weak_valid_pointer</a></span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#MemPre_split">MemPre_split</a></span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">H1</span> <span class="id">H2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tso_valid_pointer_locality">tso_valid_pointer_locality</a></span> <span class="kwd">in</span> <span class="id">H2</span>;<span class="tactic">eauto</span>;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#tso_weak_valid_pointer">tso_weak_valid_pointer</a></span> <span class="kwd">in</span> <span class="id">H2</span>;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tso_valid_pointer_locality">tso_valid_pointer_locality</a></span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="tactic">eauto</span>;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#tso_weak_valid_pointer">tso_weak_valid_pointer</a></span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">not_lock_step_locality</span>':<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fl</span> <span class="id">c</span> <span class="id">gm</span> <span class="id">bf</span> <span class="id">fp</span> <span class="id">c</span>' <span class="id">bf</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#tso_not_lock_step">tso_not_lock_step</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> (<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>,<span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span>) <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id">c</span>' (<span class="id">bf</span>',<span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">gm0</span> <span class="id">fm0</span> (<span class="id">FLEMBEDREL</span>:<span class="id"><a href="TSOAuxDefs.html#buffer_fl_embed_rel">buffer_fl_embed_rel</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> <span class="id"><a href="TSOAuxDefs.html#gm0">gm0</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id"><a href="TSOAuxDefs.html#gm0">gm0</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#fm0">fm0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#LPre">LPre</a></span> <span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> <span class="id"><a href="TSOAuxDefs.html#gm0">gm0</a></span> <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id"><a href="TSOAuxDefs.html#gm0">gm0</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#tso_not_lock_step">tso_not_lock_step</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> (<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>,<span class="id"><a href="TSOAuxDefs.html#gm0">gm0</a></span>) <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id">c</span>' (<span class="id">bf</span>',<span class="id"><a href="TSOAuxDefs.html#gm0">gm0</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9329')">Proof.</div>
<div class="proofscript" id="proof9329">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>. <span class="tactic">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> [<span class="id">MEMPRE</span> <span class="id">FLEQ</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>. <span class="id">inv</span> <span class="id">H8</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> {| <span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span> := <span class="id">bf</span>; <span class="id">fmemory</span> := <span class="id">fm0</span> |} <span class="kwd">as</span> <span class="id">m0</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">replace</span> <span class="id">fm0</span> <span class="kwd">with</span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id">m0</span>) <span class="kwd">in</span> * <span class="tactic">by</span> (<span class="tactic">rewrite</span> <span class="id">Heqm0</span> ;<span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">replace</span> <span class="id">bf</span> <span class="kwd">with</span> (<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">m0</span>) <span class="kwd">in</span> * <span class="tactic">by</span> (<span class="tactic">rewrite</span> <span class="id">Heqm0</span> ;<span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">fm0</span> <span class="id">bf</span> <span class="id">Heqm0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H1</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H11</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#notlock_instr">notlock_instr</a></span> <span class="kwd">in</span> <span class="id">H7</span>;<span class="id">ex_match</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H8</span>,<span class="id">MEMPRE</span>;<span class="id">ex_match</span>;<span class="tactic">try</span> <span class="id">inv_next</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Ltac</span> <span class="id">triv</span>:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;[<span class="id">econstructor</span>;<span class="tactic">reflexivity</span>|<span class="id">econstructor</span>;<span class="tactic">eauto</span>;<span class="tactic">simpl</span>;<span class="tactic">eauto</span>|<span class="tactic">auto</span>|<span class="tactic">auto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">try</span> <span class="id">solve</span>[<span class="id">triv</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">try</span> <span class="id">solve</span>[<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#exec_load_TSO_locality">exec_load_TSO_locality</a></span> <span class="kwd">with</span>(<span class="id">m0</span>:=<span class="id">m0</span>) <span class="kwd">in</span> <span class="id">H8</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>;<span class="id">triv</span>;[<span class="tactic">rewrite</span> &lt;-<span class="id"><a href="TSOAuxDefs.html#tsofmem_eq">tsofmem_eq</a></span>;<span class="tactic">auto</span>|<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#exec_load_TSO_buffer_unchg">exec_load_TSO_buffer_unchg</a></span> <span class="kwd">in</span> <span class="id">H8</span>;<span class="tactic">eauto</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">try</span> <span class="id">solve</span>[<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#exec_store_TSO_locality2">exec_store_TSO_locality2</a></span> <span class="kwd">with</span>(<span class="id">m0</span>:=<span class="id">m0</span>) <span class="kwd">in</span> <span class="id">H8</span> <span class="kwd">as</span> <span class="id">R</span>;<span class="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">R</span> <span class="kwd">as</span> [?[]];<span class="id">triv</span>;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#exec_store_TSO_memunchg">exec_store_TSO_memunchg</a></span>;<span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">try</span> <span class="id">solve</span>[<span class="id">triv</span>; <span class="tactic">repeat</span> <span class="id">ex_match3</span>; <span class="tactic">rewrite</span>&lt;- !<span class="id"><a href="TSOAuxDefs.html#tsofmem_eq">tsofmem_eq</a></span>; <span class="tactic">auto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">try</span> <span class="id">solve</span>[<span class="id">triv</span>;[<span class="id">ex_match3</span>;<span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOAuxDefs.html#tsofmem_eq">tsofmem_eq</a></span>,<span class="id"><a href="TSOAuxDefs.html#compare_ints_TSO_locality">compare_ints_TSO_locality</a></span>,&lt;- <span class="id"><a href="TSOAuxDefs.html#tsofmem_eq">tsofmem_eq</a></span>;<span class="tactic">eauto</span>|<span class="id">erewrite</span> &lt;-<span class="id"><a href="TSOAuxDefs.html#compare_ints_TSO_fp_locality">compare_ints_TSO_fp_locality</a></span>;<span class="tactic">eauto</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">try</span> <span class="id">solve</span>[<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#tso_goto_label">tso_goto_label</a></span> <span class="kwd">in</span> <span class="id">H8</span>;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">H2</span>;<span class="id">inv_next</span>;<span class="id">triv</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#tso_goto_label">tso_goto_label</a></span>;<span class="tactic">repeat</span> <span class="id">ex_match3</span>; <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="TSOAuxDefs.html#tsofmem_eq">tsofmem_eq</a></span>; <span class="tactic">auto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">triv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match3</span>. <span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOAuxDefs.html#check_compare_ints_TSO_locality">check_compare_ints_TSO_locality</a></span>. <span class="tactic">rewrite</span> <span class="id">Hx1</span>. <span class="id">all</span>: <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOAuxDefs.html#tsofmem_eq">tsofmem_eq</a></span>,<span class="id"><a href="TSOAuxDefs.html#compare_ints_TSO_locality">compare_ints_TSO_locality</a></span>,&lt;- <span class="id"><a href="TSOAuxDefs.html#tsofmem_eq">tsofmem_eq</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;-<span class="id"><a href="TSOAuxDefs.html#compare_ints_TSO_fp_locality">compare_ints_TSO_fp_locality</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">triv</span>. <span class="id">ex_match3</span>. <span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOAuxDefs.html#check_compare_ints_TSO_locality">check_compare_ints_TSO_locality</a></span>. <span class="tactic">rewrite</span> <span class="id">Hx1</span>. <span class="id">all</span>: <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOAuxDefs.html#tsofmem_eq">tsofmem_eq</a></span>,<span class="id"><a href="TSOAuxDefs.html#compare_ints_TSO_locality">compare_ints_TSO_locality</a></span>,&lt;- <span class="id"><a href="TSOAuxDefs.html#tsofmem_eq">tsofmem_eq</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;-<span class="id"><a href="TSOAuxDefs.html#compare_ints_TSO_fp_locality">compare_ints_TSO_fp_locality</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm</span> = <span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> {|<span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span> := <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">m0</span>; <span class="id">fmemory</span> := <span class="id">fm</span>|})).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H8</span> <span class="kwd">in</span> <span class="id">MEMPRE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#MemPre_split">MemPre_split</a></span> <span class="kwd">in</span> <span class="id">MEMPRE</span> <span class="kwd">as</span> [<span class="id">PRE1</span> <span class="id">PRE2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#MemPre_split">MemPre_split</a></span> <span class="kwd">in</span> <span class="id">PRE1</span> <span class="kwd">as</span> [<span class="id">PRE0</span> <span class="id">PRE1</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tsoloadv_locality1">tsoloadv_locality1</a></span> <span class="kwd">in</span> <span class="id">PRE1</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tsoloadv_locality1">tsoloadv_locality1</a></span> <span class="kwd">in</span> <span class="id">PRE0</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Focus</span> 2. <span class="id">econstructor</span>;<span class="tactic">try</span> <span class="id">eassumption</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;-!<span class="id"><a href="TSOAuxDefs.html#tsofmem_eq">tsofmem_eq</a></span>. <span class="tactic">repeat</span> <span class="id">ex_match3</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">ex_match3</span>. <span class="tactic">f_equal</span>. <span class="id">econstructor</span>;<span class="tactic">eauto</span>. <span class="tactic">auto</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#exec_load_TSO_locality">exec_load_TSO_locality</a></span> <span class="kwd">with</span>(<span class="id">m0</span>:=<span class="id">m0</span>) <span class="kwd">in</span> <span class="id">H8</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">triv</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">Hx0</span>, &lt;-<span class="id"><a href="TSOAuxDefs.html#tsofmem_eq">tsofmem_eq</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#exec_load_TSO_buffer_unchg">exec_load_TSO_buffer_unchg</a></span> <span class="kwd">in</span> <span class="id">H8</span>;<span class="tactic">eauto</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H8</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hx0</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span>. <span class="id">eexists</span>;<span class="tactic">simpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;need&nbsp;FLEMBED*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">exists</span> <span class="id">m0</span>',<span class="id"><a href="TSOMem.html#tsoalloc">tsoalloc</a></span> <span class="id">m0</span> 0 <span class="id">sz</span> (<span class="id">m0</span>',<span class="id">stk</span>)/\<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">m0</span>' = <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">bm</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#alloc_buffer_fl_embed_rel">alloc_buffer_fl_embed_rel</a></span> <span class="kwd">in</span> <span class="id">H6</span> <span class="kwd">as</span>?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Focus</span> 2. <span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#buffer_fl_embed_rel">buffer_fl_embed_rel</a></span> <span class="kwd">in</span> <span class="id">FLEMBEDREL</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">FLEMBEDREL</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">FLEMBEDREL</span> <span class="kwd">in</span> <span class="id">H7</span> <span class="kwd">as</span> <span class="id">FLEMBED</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H7</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">FLEMBED</span> <span class="kwd">as</span> [?[?[]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H6</span>;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#Fleq_apply_buffer_preserve">Fleq_apply_buffer_preserve</a></span> <span class="kwd">in</span> <span class="id">FLEQ</span> <span class="kwd">as</span> <span class="id">FLEQ2</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#fleq_nextblockideq">fleq_nextblockideq</a></span> <span class="kwd">in</span> <span class="id">FLEQ2</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>;[|<span class="tactic">rewrite</span> &lt;- <span class="id">H0</span>;<span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id">fm</span>' = <span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id">x0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span>;<span class="tactic">f_equal</span>;<span class="tactic">auto</span>. <span class="id">inv</span> <span class="id">H10</span>;<span class="id">inv</span> <span class="id">H18</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H12</span>. <span class="id">eexists</span>. <span class="tactic">split</span>. <span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H7</span> <span class="kwd">as</span> [<span class="id">m1</span>[]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsostorev">tsostorev</a></span> <span class="kwd">in</span> *;<span class="id">ex_match</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Focus</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span> 2. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="TSOAuxDefs.html#tsofmem_eq">tsofmem_eq</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsostorev">tsostorev</a></span>. <span class="id">ex_match3</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsostore">tsostore</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsostorev">tsostorev</a></span>. <span class="id">ex_match3</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsostore">tsostore</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">inv</span> <span class="id">H7</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsostore">tsostore</a></span> <span class="kwd">in</span> *. <span class="tactic">do</span> 2 <span class="id">inv_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="id">econstructor</span>;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span> 3;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#eval_builtin_args_locality">eval_builtin_args_locality</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="id">econstructor</span>;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span> 4;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#extcall_args_locality">extcall_args_locality</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="id">econstructor</span>;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span> 5;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;need&nbsp;FLEMBED*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">exists</span> <span class="id">m0</span>',<span class="id"><a href="TSOMem.html#tsoalloc">tsoalloc</a></span> <span class="id">m0</span> 0 (4*<span class="id">z</span>) (<span class="id">m0</span>',<span class="id">stk</span>)/\<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">m0</span>' = <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">bm1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#alloc_buffer_fl_embed_rel">alloc_buffer_fl_embed_rel</a></span> <span class="kwd">in</span> <span class="id">H4</span> <span class="kwd">as</span>?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Focus</span> 2. <span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#buffer_fl_embed_rel">buffer_fl_embed_rel</a></span> <span class="kwd">in</span> <span class="id">FLEMBEDREL</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">FLEMBEDREL</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">FLEMBEDREL</span> <span class="kwd">in</span> <span class="id">H5</span> <span class="kwd">as</span> <span class="id">FLEMBED</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">FLEMBED</span> <span class="kwd">as</span> [?[?[]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H4</span>;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#Fleq_apply_buffer_preserve">Fleq_apply_buffer_preserve</a></span> <span class="kwd">in</span> <span class="id">FLEQ</span> <span class="kwd">as</span> <span class="id">FLEQ2</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#fleq_nextblockideq">fleq_nextblockideq</a></span> <span class="kwd">in</span> <span class="id">FLEQ2</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>;[|<span class="tactic">rewrite</span> &lt;- <span class="id">H0</span>;<span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id">fm</span>' = <span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id">x0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span>;<span class="tactic">f_equal</span>;<span class="tactic">auto</span>. <span class="id">inv</span> <span class="id">H7</span>;<span class="id">inv</span> <span class="id">H15</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H9</span>. <span class="id">eexists</span>. <span class="tactic">split</span>. <span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H5</span> <span class="kwd">as</span> [?[]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#store_args_fmem_locality">store_args_fmem_locality</a></span> <span class="kwd">in</span> <span class="id">H6</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="id">econstructor</span>;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span> 6;<span class="tactic">try</span> <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="TSOAuxDefs.html#tsofmem_eq">tsofmem_eq</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#store_args_fmem_memunchg">store_args_fmem_memunchg</a></span> <span class="kwd">in</span> <span class="id">H8</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#tsoalloc_memunchg">tsoalloc_memunchg</a></span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#tsoalloc_memunchg">tsoalloc_memunchg</a></span> <span class="kwd">in</span> <span class="id">H4</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="not_lock_step_locality">not_lock_step_locality</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fl</span> <span class="id">c</span> <span class="id">gm</span> <span class="id">bf</span> <span class="id">fp</span> <span class="id">c</span>' <span class="id">bf</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#tso_not_lock_step">tso_not_lock_step</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> (<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>,<span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span>) <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id">c</span>' (<span class="id">bf</span>',<span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">gm0</span> <span class="id">fm0</span> (<span class="id">FLEMBED</span>:<span class="id"><a href="TSOAuxDefs.html#buffer_fl_embed">buffer_fl_embed</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#gm0">gm0</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id"><a href="TSOAuxDefs.html#gm0">gm0</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#fm0">fm0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#LPre">LPre</a></span> <span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> <span class="id"><a href="TSOAuxDefs.html#gm0">gm0</a></span> <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id"><a href="TSOAuxDefs.html#gm0">gm0</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#tso_not_lock_step">tso_not_lock_step</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> (<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>,<span class="id"><a href="TSOAuxDefs.html#gm0">gm0</a></span>) <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id">c</span>' (<span class="id">bf</span>',<span class="id"><a href="TSOAuxDefs.html#gm0">gm0</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9330')">Proof.</div>
<div class="proofscript" id="proof9330">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="TSOAuxDefs.html#buffer_fl_embed_rel">buffer_fl_embed_rel</a></span> <span class="id">bf</span> <span class="id">fl</span> <span class="id">gm</span> <span class="id">gm0</span>). <span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#buffer_fl_embed_rel">buffer_fl_embed_rel</a></span>. <span class="tactic">intro</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">not_lock_step_locality</span>' <span class="kwd">in</span> <span class="id">H4</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<span class="kwd">End</span> <span class="id"><a href="TSOAuxDefs.html#AUX_TSOSTEP">AUX_TSOSTEP</a></span>.<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="tsostep_lock_or_notlock">tsostep_lock_or_notlock</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ge</span> <span class="id">fl</span> <span class="id">c</span> <span class="id">bf</span> <span class="id">gm</span> <span class="id">fp</span> <span class="id">c</span>' <span class="id">bf</span>' <span class="id">gm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#tsostep">tsostep</a></span> <span class="id"><a href="TSOAuxDefs.html#ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> (<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>,<span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span>) <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id">c</span>' (<span class="id">bf</span>',<span class="id">gm</span>')-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOAuxDefs.html#tso_lock_step">tso_lock_step</a></span> <span class="id"><a href="TSOAuxDefs.html#ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> (<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>,<span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span>) <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id">c</span>' (<span class="id">bf</span>',<span class="id">gm</span>') \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOAuxDefs.html#tso_not_lock_step">tso_not_lock_step</a></span> <span class="id"><a href="TSOAuxDefs.html#ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> (<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>,<span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span>) <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id">c</span>' (<span class="id">bf</span>',<span class="id">gm</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9331')">Proof.</div>
<div class="proofscript" id="proof9331">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#tsofstep_lock_or_notlock">tsofstep_lock_or_notlock</a></span> <span class="kwd">in</span> <span class="id">H8</span> <span class="kwd">as</span> [|].<br/>
&nbsp;&nbsp;<span class="id">left</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#lock_step_buffer_nil">lock_step_buffer_nil</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> ?. <span class="tactic">destruct</span> <span class="id">H0</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span>. <span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">right</span>. <span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="lock_step_tsostep">lock_step_tsostep</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ge</span> <span class="id">fl</span> <span class="id">c</span> <span class="id">bf</span> <span class="id">gm</span> <span class="id">fp</span> <span class="id">c</span>' <span class="id">bf</span>' <span class="id">gm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOAuxDefs.html#tso_lock_step">tso_lock_step</a></span> <span class="id"><a href="TSOAuxDefs.html#ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> (<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>,<span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span>) <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id">c</span>' (<span class="id">bf</span>',<span class="id">gm</span>')-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#tsostep">tsostep</a></span> <span class="id"><a href="TSOAuxDefs.html#ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> (<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>,<span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span>) <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id">c</span>' (<span class="id">bf</span>',<span class="id">gm</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9332')">Proof.</div>
<div class="proofscript" id="proof9332">
&nbsp;&nbsp;<span class="tactic">inversion</span> 1;<span class="tactic">subst</span>;<span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#lock_step_tsofstep">lock_step_tsofstep</a></span>;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="not_lock_step_tsostep">not_lock_step_tsostep</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ge</span> <span class="id">fl</span> <span class="id">c</span> <span class="id">bf</span> <span class="id">gm</span> <span class="id">fp</span> <span class="id">c</span>' <span class="id">bf</span>' <span class="id">gm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOAuxDefs.html#tso_not_lock_step">tso_not_lock_step</a></span> <span class="id"><a href="TSOAuxDefs.html#ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> (<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>,<span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span>) <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id">c</span>' (<span class="id">bf</span>',<span class="id">gm</span>')-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#tsostep">tsostep</a></span> <span class="id"><a href="TSOAuxDefs.html#ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> (<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>,<span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span>) <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id">c</span>' (<span class="id">bf</span>',<span class="id">gm</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9333')">Proof.</div>
<div class="proofscript" id="proof9333">
&nbsp;&nbsp;<span class="tactic">inversion</span> 1;<span class="tactic">subst</span>;<span class="id">econstructor</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#not_lock_step_tsofstep">not_lock_step_tsofstep</a></span>;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="exec_load_fp_eq_emp">exec_load_fp_eq_emp</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ge</span> <span class="id">chunk</span> <span class="id">r</span> <span class="id">rs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#eff_eq">eff_eq</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> (<span class="id"><a href="AsmLang.html#exec_load_fp">exec_load_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#chunk">chunk</a></span> <span class="id"><a href="TSOAuxDefs.html#r">r</a></span> <span class="id"><a href="TSOAuxDefs.html#rs">rs</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9334')">Proof.</div>
<div class="proofscript" id="proof9334">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmLang.html#exec_load_fp">exec_load_fp</a></span>,<span class="id"><a href="FMemOpFP.html#loadv_fp">loadv_fp</a></span>,<span class="id"><a href="FMemOpFP.html#load_fp">load_fp</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_eq_refl">eff_eq_refl</a></span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>;<span class="tactic">auto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="tso_cmpu_bool_fp_eq_emp">tso_cmpu_bool_fp_eq_emp</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">c</span> <span class="id">bm</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#eff_eq">eff_eq</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> (<span class="id"><a href="AsmTSO.html#tso_cmpu_bool_fp_total">tso_cmpu_bool_fp_total</a></span> <span class="id"><a href="TSOAuxDefs.html#bm">bm</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> <span class="id"><a href="TSOAuxDefs.html#x">x</a></span> <span class="id"><a href="TSOAuxDefs.html#y">y</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9335')">Proof.</div>
<div class="proofscript" id="proof9335">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#tso_cmpu_bool_fp_total">tso_cmpu_bool_fp_total</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_eq_refl">eff_eq_refl</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#tso_weak_valid_pointer_fp">tso_weak_valid_pointer_fp</a></span>,<span class="id"><a href="FMemOpFP.html#valid_pointer_fp">valid_pointer_fp</a></span>;<span class="id">ex_match2</span>;<span class="tactic">try</span> <span class="id">constructor</span>;<span class="tactic">auto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="tso_cmplu_bool_fp_eq_emp">tso_cmplu_bool_fp_eq_emp</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">c</span> <span class="id">bm</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#eff_eq">eff_eq</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> (<span class="id"><a href="AsmTSO.html#tso_cmplu_bool_fp_total">tso_cmplu_bool_fp_total</a></span> <span class="id"><a href="TSOAuxDefs.html#bm">bm</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> <span class="id"><a href="TSOAuxDefs.html#x">x</a></span> <span class="id"><a href="TSOAuxDefs.html#y">y</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9336')">Proof.</div>
<div class="proofscript" id="proof9336">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#tso_cmplu_bool_fp_total">tso_cmplu_bool_fp_total</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_eq_refl">eff_eq_refl</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#tso_weak_valid_pointer_fp">tso_weak_valid_pointer_fp</a></span>,<span class="id"><a href="FMemOpFP.html#valid_pointer_fp">valid_pointer_fp</a></span>;<span class="id">ex_match2</span>;<span class="tactic">try</span> <span class="id">constructor</span>;<span class="tactic">auto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="compare_ints_TSO_fp_eq_emp">compare_ints_TSO_fp_eq_emp</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">bm</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#eff_eq">eff_eq</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> (<span class="id"><a href="AsmTSO.html#compare_ints_TSO_fp">compare_ints_TSO_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#x">x</a></span> <span class="id"><a href="TSOAuxDefs.html#y">y</a></span> <span class="id"><a href="TSOAuxDefs.html#bm">bm</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9337')">Proof.</div>
<div class="proofscript" id="proof9337">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#compare_ints_TSO_fp">compare_ints_TSO_fp</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="Footprint.html#FP.fp_union_emp">FP.fp_union_emp</a></span> <span class="kwd">with</span>(<span class="id">fp</span>:=<span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span>).<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_eq_union">eff_eq_union</a></span>;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#tso_cmpu_bool_fp_eq_emp">tso_cmpu_bool_fp_eq_emp</a></span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="compare_longs_TSO_fp_eq_emp">compare_longs_TSO_fp_eq_emp</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">bm</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#eff_eq">eff_eq</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> (<span class="id"><a href="AsmTSO.html#compare_longs_TSO_fp">compare_longs_TSO_fp</a></span> <span class="id"><a href="TSOAuxDefs.html#x">x</a></span> <span class="id"><a href="TSOAuxDefs.html#y">y</a></span> <span class="id"><a href="TSOAuxDefs.html#bm">bm</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9338')">Proof.</div>
<div class="proofscript" id="proof9338">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#compare_longs_TSO_fp">compare_longs_TSO_fp</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="Footprint.html#FP.fp_union_emp">FP.fp_union_emp</a></span> <span class="kwd">with</span>(<span class="id">fp</span>:=<span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span>).<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_eq_union">eff_eq_union</a></span>;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#tso_cmplu_bool_fp_eq_emp">tso_cmplu_bool_fp_eq_emp</a></span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="tso_not_lock_step_bufeff">tso_not_lock_step_bufeff</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ge</span> <span class="id">fl</span> <span class="id">c</span> <span class="id">b</span> <span class="id">gm</span> <span class="id">fp</span> <span class="id">c</span>' <span class="id">b</span>' <span class="id">gm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOAuxDefs.html#tso_not_lock_step">tso_not_lock_step</a></span> <span class="id"><a href="TSOAuxDefs.html#ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> (<span class="id"><a href="TSOAuxDefs.html#b">b</a></span>,<span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span>) <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id">c</span>' (<span class="id">b</span>',<span class="id">gm</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#BufferEff">BufferEff</a></span> <span class="id"><a href="TSOAuxDefs.html#b">b</a></span> <span class="id">b</span>' <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9339')">Proof.</div>
<div class="proofscript" id="proof9339">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#not_lock_step_tsostep">not_lock_step_tsostep</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOAuxDefs.html#eff_chg">eff_chg</a></span> <span class="id">b</span> <span class="id">b</span>') <span class="id">eqn</span>:?.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_chg_t">eff_chg_t</a></span> <span class="kwd">in</span> <span class="id">Heqb0</span> <span class="kwd">as</span> [];<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#BufferEff">BufferEff</a></span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>. <span class="tactic">split</span>. <span class="tactic">auto</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">H9</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#notlock_instr">notlock_instr</a></span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="id">ex_match2</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H4</span>;<span class="tactic">try</span> <span class="id">inv_next</span>;<span class="tactic">simpl</span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_eq_refl">eff_eq_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#exec_load_fp_eq_emp">exec_load_fp_eq_emp</a></span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#compare_ints_TSO_fp_eq_emp">compare_ints_TSO_fp_eq_emp</a></span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#compare_longs_TSO_fp_eq_emp">compare_longs_TSO_fp_eq_emp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">try</span> <span class="id">solve</span>[<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#exec_store_TSO">exec_store_TSO</a></span> <span class="kwd">in</span> <span class="id">H4</span>; <span class="id">ex_match2</span>;<span class="id">inv_next</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsostorev">tsostorev</a></span>,<span class="id"><a href="TSOMem.html#tsostore">tsostore</a></span> <span class="kwd">in</span> *; <span class="id">ex_match2</span>; <span class="id">inv_some</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H11</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="id">inv_next</span>. <span class="tactic">simpl</span>. <span class="id">inv</span> <span class="id">H11</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsostorev">tsostorev</a></span>,<span class="id"><a href="TSOMem.html#tsostore">tsostore</a></span> <span class="kwd">in</span> <span class="id">H5</span>. <span class="id">ex_match</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H5</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H11</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradict</span> <span class="id">H11</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_cons_not_nil">app_cons_not_nil</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H4</span>;<span class="tactic">clear</span>. <span class="tactic">induction</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_eq_refl">eff_eq_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="Footprint.html#FP.fp_union_emp">FP.fp_union_emp</a></span> <span class="kwd">with</span>(<span class="id">fp</span>:=<span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_eq_union">eff_eq_union</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">IHeval_builtin_args_fp</span> <span class="id">H4</span> <span class="id">H0</span> <span class="id">fp2</span> <span class="id">fp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">H</span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_eq_refl">eff_eq_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#loadv_fp">loadv_fp</a></span>. <span class="id">ex_match2</span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_eq_refl">eff_eq_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#load_fp">load_fp</a></span>. <span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#loadv_fp">loadv_fp</a></span>. <span class="id">ex_match2</span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_eq_refl">eff_eq_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#load_fp">load_fp</a></span>. <span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="Footprint.html#FP.fp_union_emp">FP.fp_union_emp</a></span> <span class="kwd">with</span>(<span class="id">fp</span>:=<span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span>),&lt;- <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_eq_union">eff_eq_union</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H2</span>;<span class="tactic">clear</span>. <span class="tactic">induction</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_eq_refl">eff_eq_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;-<span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="Footprint.html#FP.fp_union_emp">FP.fp_union_emp</a></span> <span class="kwd">with</span>(<span class="id">fp</span>:=<span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_eq_union">eff_eq_union</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">IHload_arguments_fp</span> <span class="id">H2</span> <span class="id">H0</span> <span class="id">fp2</span> <span class="id">fp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">H0</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_eq_refl">eff_eq_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#loadv_fp">loadv_fp</a></span>. <span class="id">ex_match2</span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_eq_refl">eff_eq_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#load_fp">load_fp</a></span>. <span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>;<span class="id">inv</span> <span class="id">H1</span>;<span class="tactic">try</span> <span class="tactic">rewrite</span> !<span class="id"><a href="Footprint.html#FP.fp_union_emp">FP.fp_union_emp</a></span>;<span class="tactic">try</span> <span class="tactic">rewrite</span> !<span class="id"><a href="Footprint.html#FP.emp_union_fp">FP.emp_union_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_eq_refl">eff_eq_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#loadv_fp">loadv_fp</a></span>. <span class="id">ex_match2</span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_eq_refl">eff_eq_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#load_fp">load_fp</a></span>. <span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#loadv_fp">loadv_fp</a></span>. <span class="id">ex_match2</span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_eq_refl">eff_eq_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#load_fp">load_fp</a></span>. <span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="Footprint.html#FP.fp_union_emp">FP.fp_union_emp</a></span> <span class="kwd">with</span>(<span class="id">fp</span>:=<span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_eq_union">eff_eq_union</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#loadv_fp">loadv_fp</a></span>. <span class="id">ex_match2</span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_eq_refl">eff_eq_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#load_fp">load_fp</a></span>. <span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#loadv_fp">loadv_fp</a></span>. <span class="id">ex_match2</span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_eq_refl">eff_eq_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#load_fp">load_fp</a></span>. <span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#eff_eq_refl">eff_eq_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#store_args_fmem_bf_app">store_args_fmem_bf_app</a></span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H11</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H11</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#buffer_local_alloc">buffer_local_alloc</a></span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#TSO_bfeff">TSO_bfeff</a></span>;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<span class="kwd">Definition</span> <span class="id"><a name="bi_disj_fl">bi_disj_fl</a></span> <span class="id">bi</span> <span class="id">fl</span>:=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="TSOAuxDefs.html#bi">bi</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id">b</span> <span class="id">_</span> <span class="id">_</span> =&gt; ~ <span class="id"><a href="MemAux.html#in_fl">in_fl</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id">b</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="bi_disj_fl_freelisteq">bi_disj_fl_freelisteq</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">fl</span> <span class="id">bi</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#bi_disj_fl">bi_disj_fl</a></span> <span class="id"><a href="TSOAuxDefs.html#bi">bi</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOAuxDefs.html#bi">bi</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#FreelistEq">FreelistEq</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id">m</span>' <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9340')">Proof.</div>
<div class="proofscript" id="proof9340">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#FreelistEq">FreelistEq</a></span>;<span class="tactic">simpl</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">inv_some</span>. <span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">intro</span>;<span class="tactic">auto</span>. <span class="tactic">destruct</span> <span class="id">H0</span>;<span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#free">free</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">ex_match</span>. <span class="id">inv_some</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="kwd">in</span> <span class="id">H0</span>;<span class="id">ex_match</span>;<span class="id">inv_some</span>. <span class="tactic">tauto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="freelisteq_embed">freelisteq_embed</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">fl</span> <span class="id">m</span>' <span class="id">fm</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#FreelistEq">FreelistEq</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id">m</span>' <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">fm</span>', <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">m</span>' <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id">fm</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9341')">Proof.</div>
<div class="proofscript" id="proof9341">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">eapply</span> <span class="id"><a href="FMemLemmas.html#FreelistEq_mem_fl_wd">FreelistEq_mem_fl_wd</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">eexists</span>. <span class="tactic">eapply</span> <span class="id"><a href="FMemLemmas.html#gmem_fl_wd_embed">gmem_fl_wd_embed</a></span> <span class="kwd">with</span>(<span class="id">wd</span>:=<span class="id">H0</span>).<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="buffer_item_local_alloc_disj">buffer_item_local_alloc_disj</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span> <span class="id">fl</span> <span class="id">fl</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="MemAux.html#disj">disj</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id">fl</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_item_local_alloc">buffer_item_local_alloc</a></span> <span class="id"><a href="TSOAuxDefs.html#bi">bi</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#bi_disj_fl">bi_disj_fl</a></span> <span class="id"><a href="TSOAuxDefs.html#bi">bi</a></span> <span class="id">fl</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9342')">Proof.</div>
<div class="proofscript" id="proof9342">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#buffer_item_local_alloc">buffer_item_local_alloc</a></span>,<span class="id"><a href="TSOAuxDefs.html#bi_disj_fl">bi_disj_fl</a></span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="tactic">unfold</span> <span class="id"><a href="MemAux.html#in_fl">in_fl</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [].<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H1</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>,<span class="id">H0</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_buffer_item_tsostep_exchage">apply_buffer_item_tsostep_exchage</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ge</span> <span class="id">fl</span> <span class="id">c</span> <span class="id">bf</span> <span class="id">gm</span> <span class="id">fp</span> <span class="id">c</span>' <span class="id">bf</span>' <span class="id">gm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#tsostep">tsostep</a></span> <span class="id"><a href="TSOAuxDefs.html#ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> (<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>,<span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span>) <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id">c</span>' (<span class="id">bf</span>',<span class="id">gm</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fl</span>' <span class="id">bi</span> <span class="id">gm</span>'',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="Footprint.html#FP.conflict">FP.conflict</a></span> (<span class="id"><a href="TSOMem.html#bi_footprint">bi_footprint</a></span> <span class="id"><a href="TSOAuxDefs.html#bi">bi</a></span>) <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOAuxDefs.html#bi">bi</a></span> <span class="id">gm</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">gm</span>''-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_item_local_alloc">buffer_item_local_alloc</a></span> <span class="id"><a href="TSOAuxDefs.html#bi">bi</a></span> <span class="id">fl</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="MemAux.html#disj">disj</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id">fl</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_fl_embed">buffer_fl_embed</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id">gm</span>'' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">gm1</span>, <span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOAuxDefs.html#bi">bi</a></span> <span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOAuxDefs.html#gm1">gm1</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">gm2</span>, <span class="id"><a href="AsmTSO.html#tsostep">tsostep</a></span> <span class="id"><a href="TSOAuxDefs.html#ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> (<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>,<span class="id"><a href="TSOAuxDefs.html#gm1">gm1</a></span>) <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id">c</span>' (<span class="id">bf</span>',<span class="id"><a href="TSOAuxDefs.html#gm2">gm2</a></span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.eq">GMem.eq</a></span> <span class="id">gm</span>'' <span class="id"><a href="TSOAuxDefs.html#gm2">gm2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9343')">Proof.</div>
<div class="proofscript" id="proof9343">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#tsostep_lock_or_notlock">tsostep_lock_or_notlock</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> [|].<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">bf</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> /\ <span class="id">bf</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>;<span class="tactic">auto</span>. <span class="tactic">destruct</span> <span class="id">H6</span>;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#LEffect">LEffect</a></span> <span class="id">gm</span> <span class="id">gm</span>' <span class="id">fp</span> <span class="id">fl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#lock_step_tsostep">lock_step_tsostep</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#TSO_eff">TSO_eff</a></span> <span class="kwd">in</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H6</span>;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Footprint.html#FP.smile_conflict_compat">FP.smile_conflict_compat</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FPLemmas.html#fpsmile_sym">FPLemmas.fpsmile_sym</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#LEffect_fpsmile_LPre_Rule">LEffect_fpsmile_LPre_Rule</a></span> <span class="kwd">in</span> <span class="id">H6</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H7</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#buf_item_unbuf_locality_1">buf_item_unbuf_locality_1</a></span> <span class="kwd">in</span> <span class="id">H7</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">x</span>. <span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#Fleq_apply_buffer_item_preserve">Fleq_apply_buffer_item_preserve</a></span> <span class="kwd">in</span> <span class="id">H8</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#apply_buffer_item_eff">apply_buffer_item_eff</a></span> <span class="kwd">in</span> <span class="id">H9</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FPLemmas.html#fpsmile_sym">FPLemmas.fpsmile_sym</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#MemEffect_fpsmile_MemPre_Rule">MemEffect_fpsmile_MemPre_Rule</a></span> <span class="kwd">in</span> <span class="id">H12</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#FreelistEq">FreelistEq</a></span> <span class="id">gm</span> <span class="id">x</span> <span class="id">fl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#bi_disj_fl_freelisteq">bi_disj_fl_freelisteq</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#buffer_item_local_alloc_disj">buffer_item_local_alloc_disj</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FPLemmas.html#disj_comm">disj_comm</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#LPre">LPre</a></span> <span class="id">gm</span> <span class="id">x</span> <span class="id">fp</span> <span class="id">fl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#MemPre_comm">MemPre_comm</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">exists</span> <span class="id">fm</span>, <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">gm</span> <span class="id">fl</span> <span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span>). <span class="id">inv</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#freelisteq_embed">freelisteq_embed</a></span> <span class="kwd">in</span> <span class="id">H14</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#tso_lock_step_locality">tso_lock_step_locality</a></span> <span class="kwd">in</span> <span class="id">H15</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#LEffect">LEffect</a></span> <span class="id">x</span> <span class="id">x2</span> <span class="id">fp</span> <span class="id">fl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#lock_step_tsostep">lock_step_tsostep</a></span> <span class="kwd">in</span> <span class="id">H15</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#TSO_eff">TSO_eff</a></span> <span class="kwd">in</span> <span class="id">H15</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H15</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#lock_step_tsostep">lock_step_tsostep</a></span> <span class="kwd">in</span> <span class="id">H15</span>. <span class="id">Esimpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="GMemory.html#GMem.eq_sym">GMem.eq_sym</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#GMem_eq">GMem_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="FPLemmas.html#LEffect_LPost_fpsmile_memeq">LEffect_LPost_fpsmile_memeq</a></span> <span class="kwd">with</span>(<span class="id">m0</span>:=<span class="id">gm</span>)(<span class="id">m1</span>:=<span class="id">gm</span>')(<span class="id">m2</span>:=<span class="id">gm</span>'')(<span class="id">m1</span>':=<span class="id">x</span>)(<span class="id">m2</span>':=<span class="id">x2</span>);<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#apply_buffer_item_eff">apply_buffer_item_eff</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#buffer_item_local_alloc_local_alloc">buffer_item_local_alloc_local_alloc</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FPLemmas.html#fpsmile_sym">FPLemmas.fpsmile_sym</a></span>;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">auto</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#buffer_item_local_alloc_local_alloc">buffer_item_local_alloc_local_alloc</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#tso_not_lock_step_memung">tso_not_lock_step_memung</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> ?;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">gm</span>''. <span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">gm</span>''. <span class="tactic">split</span>;[|<span class="tactic">apply</span> <span class="id"><a href="GMemory.html#GMem.eq_refl">GMem.eq_refl</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#not_lock_step_tsostep">not_lock_step_tsostep</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H5</span> <span class="kwd">as</span> [?[?[]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">exists</span> <span class="id">fm</span>,<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">gm</span>' <span class="id">fl</span> <span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H8</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#buffer_item_local_alloc_disj">buffer_item_local_alloc_disj</a></span> <span class="kwd">in</span> <span class="id">H3</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>;[|<span class="tactic">apply</span> <span class="id"><a href="FPLemmas.html#disj_comm">disj_comm</a></span>;<span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#bi_disj_fl_freelisteq">bi_disj_fl_freelisteq</a></span> <span class="kwd">in</span> <span class="id">H9</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#freelisteq_embed">freelisteq_embed</a></span> <span class="kwd">in</span> <span class="id">H8</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#not_lock_step_locality">not_lock_step_locality</a></span>;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#LPre_comm">LPre_comm</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#LEffect_fpsmile_LPre_Rule">LEffect_fpsmile_LPre_Rule</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FPLemmas.html#disj_comm">disj_comm</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#apply_buffer_item_eff">apply_buffer_item_eff</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#buffer_item_local_alloc_local_alloc">buffer_item_local_alloc_local_alloc</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Footprint.html#FP.smile_conflict_compat">FP.smile_conflict_compat</a></span>;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="TSO_step_access_validity_preserve">TSO_step_access_validity_preserve</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ge</span> <span class="id">fl</span> <span class="id">bf</span> <span class="id">bf</span>' <span class="id">c</span> <span class="id">gm</span> <span class="id">fp</span> <span class="id">c</span>' <span class="id">gm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#tsostep">tsostep</a></span> <span class="id"><a href="TSOAuxDefs.html#ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> (<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>,<span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span>) <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id">c</span>' (<span class="id">bf</span>',<span class="id">gm</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> = <span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">gm</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> = <span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">gm</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9344')">Proof.</div>
<div class="proofscript" id="proof9344">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">H5</span>. <span class="id">inv</span> <span class="id">H8</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">i</span>;<span class="id">inv</span> <span class="id">H3</span>;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#exec_load_TSO">exec_load_TSO</a></span>,<span class="id"><a href="AsmTSO.html#exec_store_TSO">exec_store_TSO</a></span>,<span class="id"><a href="AsmTSO.html#tso_goto_label">tso_goto_label</a></span> <span class="kwd">in</span> *;<span class="id">ex_match</span>;<span class="tactic">try</span> <span class="id">inv</span> <span class="id">H5</span>;<span class="tactic">try</span> <span class="id">solve</span>[<span class="tactic">split</span>;<span class="tactic">auto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">try</span> (<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#tsostorev_memunchg">tsostorev_memunchg</a></span> <span class="kwd">in</span> <span class="id">Hx</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hx</span>;<span class="tactic">rewrite</span> <span class="id">Hx</span>;<span class="tactic">split</span>;<span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#Mem.storev">Mem.storev</a></span>,<span class="id"><a href="FMemory.html#Mem.store">Mem.store</a></span> <span class="kwd">in</span> *;<span class="id">ex_match</span>;<span class="id">inv</span> <span class="id">Hx1</span>;<span class="id">inv</span> <span class="id">Hx2</span>;<span class="tactic">try</span> <span class="id">inv</span> <span class="id">Hx3</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#tsoalloc_memunchg">tsoalloc_memunchg</a></span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#tsostorev_memunchg">tsostorev_memunchg</a></span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#tsostorev_memunchg">tsostorev_memunchg</a></span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *|- . <span class="tactic">rewrite</span> <span class="id">H2</span>,<span class="id">H4</span>,<span class="id">H5</span>. <span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#tsoalloc_memunchg">tsoalloc_memunchg</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#store_args_fmem_memunchg">store_args_fmem_memunchg</a></span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span>,<span class="id">H2</span>;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="access_validity_eq_fmem_nextblockid_eq">access_validity_eq_fmem_nextblockid_eq</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">gm</span> <span class="id">gm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> = <span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">gm</span>'-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fl</span> <span class="id">fm</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">fm</span>', <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">gm</span>' <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id">fm</span>' /\ <span class="id"><a href="FMemory.html#Mem.nextblockid">Mem.nextblockid</a></span> <span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span> = <span class="id"><a href="FMemory.html#Mem.nextblockid">Mem.nextblockid</a></span> <span class="id">fm</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9345')">Proof.</div>
<div class="proofscript" id="proof9345">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="InteractionSemantics.html#FreelistEq">FreelistEq</a></span> <span class="id">gm</span> <span class="id">gm</span>' <span class="id">fl</span>).<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#FreelistEq">FreelistEq</a></span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>. <span class="tactic">rewrite</span> <span class="id">H</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FMemLemmas.html#FreelistEq_mem_fl_wd">FreelistEq_mem_fl_wd</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="id">eexists</span>. <span class="tactic">split</span>. <span class="tactic">eapply</span> <span class="id"><a href="FMemLemmas.html#gmem_fl_wd_embed">gmem_fl_wd_embed</a></span> <span class="kwd">with</span>(<span class="id">wd</span>:=<span class="id">H1</span>).<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_buffer_item_validity_preserve">apply_buffer_item_validity_preserve</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">gm1</span> <span class="id">gm</span> <span class="id">gm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> = <span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">gm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> = <span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">gm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOAuxDefs.html#gm1">gm1</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">gm1</span>', <span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id">gm</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">gm1</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOAuxDefs.html#gm1">gm1</a></span> = <span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">gm1</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOAuxDefs.html#gm1">gm1</a></span> = <span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">gm1</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9346')">Proof.</div>
<div class="proofscript" id="proof9346">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bf</span>;<span class="tactic">simpl</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="kwd">in</span> *;<span class="tactic">try</span> (<span class="id">inv</span> <span class="id">H1</span>;<span class="tactic">simpl</span>;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>;<span class="tactic">simpl</span>;<span class="tactic">eauto</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>;<span class="tactic">fail</span>).<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#free">free</a></span> <span class="kwd">in</span> *. <span class="id">ex_match</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> <span class="id">gm</span>' <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span> <span class="id"><a href="Memperm.html#Max">Max</a></span> <span class="id"><a href="Memperm.html#Freeable">Freeable</a></span>).<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span>;<span class="tactic">intros</span>. <span class="tactic">rewrite</span>&lt;- <span class="id">H0</span>;<span class="tactic">eapply</span> <span class="id">r</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unchecked_free">unchecked_free</a></span> <span class="kwd">in</span> *;<span class="id">inv</span> <span class="id">H1</span>;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>;<span class="tactic">simpl</span>;<span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span>. <span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>. <span class="id">inv</span> <span class="id">H1</span>;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>;<span class="tactic">simpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Hx0</span>. <span class="id">contradict</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v0</span>;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span>;<span class="tactic">intros</span>;<span class="tactic">rewrite</span> &lt;- <span class="id">H0</span>;<span class="tactic">eapply</span> <span class="id">r</span>;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_buffer_validity_preserve">apply_buffer_validity_preserve</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">gm1</span> <span class="id">gm</span> <span class="id">gm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> = <span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">gm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> = <span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">gm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOAuxDefs.html#gm1">gm1</a></span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">gm1</span>', <span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id">gm</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">gm1</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOAuxDefs.html#gm1">gm1</a></span> = <span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">gm1</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOAuxDefs.html#gm1">gm1</a></span> = <span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">gm1</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9347')">Proof.</div>
<div class="proofscript" id="proof9347">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>;<span class="tactic">intros</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>. <span class="tactic">simpl</span>;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#optbind">optbind</a></span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="id">ex_match</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#apply_buffer_item_validity_preserve">apply_buffer_item_validity_preserve</a></span> <span class="kwd">in</span> <span class="id">Hx</span> <span class="kwd">as</span> ?;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">IHbf</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#optbind">optbind</a></span>. <span class="id">ex_match3</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_buffer_validity_preserve2">apply_buffer_validity_preserve2</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">gm</span> <span class="id">gm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> = <span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">gm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> = <span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">gm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id">gm</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9348')">Proof.</div>
<div class="proofscript" id="proof9348">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#optbind">optbind</a></span> <span class="kwd">in</span> *. <span class="id">ex_match</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOAuxDefs.html#apply_buffer_item_validity_preserve">apply_buffer_item_validity_preserve</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>;<span class="id">Hsimpl</span>. <span class="id">ex_match3</span>. <span class="tactic">eapply</span> <span class="id">IHbf</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>. <span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">H</span>,<span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOAuxDefs.html#apply_buffer_item_validity_preserve">apply_buffer_item_validity_preserve</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>;<span class="id">Hsimpl</span>. <span class="tactic">congruence</span>.<br/>
Qed.</div>
<span class="kwd">Definition</span> <span class="id"><a name="access_validity_eq">access_validity_eq</a></span> <span class="id">gm</span> <span class="id">gm</span>':=<br/>
&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> = <span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">gm</span>' /\  <span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> = <span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">gm</span>'.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="access_validity_eq_comm">access_validity_eq_comm</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m1</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#access_validity_eq">access_validity_eq</a></span> <span class="id"><a href="TSOAuxDefs.html#m1">m1</a></span> <span class="id"><a href="TSOAuxDefs.html#m2">m2</a></span> -&gt; <span class="id"><a href="TSOAuxDefs.html#access_validity_eq">access_validity_eq</a></span> <span class="id"><a href="TSOAuxDefs.html#m2">m2</a></span> <span class="id"><a href="TSOAuxDefs.html#m1">m1</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9349')">Proof.</div>
<div class="proofscript" id="proof9349">
 <span class="tactic">destruct</span> 1;<span class="tactic">split</span>;<span class="tactic">auto</span>. Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="access_validity_eq_fl_embed_rel">access_validity_eq_fl_embed_rel</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#access_validity_eq">access_validity_eq</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">fl</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_fl_embed_rel">buffer_fl_embed_rel</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id">m</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9350')">Proof.</div>
<div class="proofscript" id="proof9350">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#buffer_fl_embed_rel">buffer_fl_embed_rel</a></span>,<span class="id"><a href="TSOAuxDefs.html#buffer_fl_embed">buffer_fl_embed</a></span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">Hsimpl</span>. <span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#apply_buffer_validity_preserve">apply_buffer_validity_preserve</a></span> <span class="kwd">in</span> <span class="id">H2</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;<span class="id">eexists</span>;<span class="tactic">split</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#access_validity_eq_fmem_nextblockid_eq">access_validity_eq_fmem_nextblockid_eq</a></span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">Hsimpl</span>;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="access_validity_buffer_safe_preserve">access_validity_buffer_safe_preserve</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">gm</span> <span class="id">gm</span>' <span class="id">bf</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#access_validity_eq">access_validity_eq</a></span> <span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> <span class="id">gm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id">gm</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9351')">Proof.</div>
<div class="proofscript" id="proof9351">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>. <span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOAuxDefs.html#apply_buffer_validity_preserve">apply_buffer_validity_preserve</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">Hsimpl</span>;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="lock_step_LEffect">lock_step_LEffect</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ge</span> <span class="id">fl</span> <span class="id">c</span> <span class="id">b</span> <span class="id">m</span> <span class="id">fp</span> <span class="id">c</span>' <span class="id">b</span>' <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOAuxDefs.html#tso_lock_step">tso_lock_step</a></span> <span class="id"><a href="TSOAuxDefs.html#ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> (<span class="id"><a href="TSOAuxDefs.html#b">b</a></span>,<span class="id"><a href="TSOAuxDefs.html#m">m</a></span>) <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id">c</span>' (<span class="id">b</span>',<span class="id">m</span>')-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#LEffect">LEffect</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id">m</span>' <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9352')">Proof.</div>
<div class="proofscript" id="proof9352">
&nbsp;&nbsp;<span class="tactic">inversion</span> 1;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#img_eff">img_eff</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#TSO_eff">TSO_eff</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#lock_step_tsostep">lock_step_tsostep</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id">TSO_one_step_reorder</span>':<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ge</span> <span class="id">ge1</span> <span class="id">fl</span> <span class="id">c</span> <span class="id">gm</span> <span class="id">bf</span> <span class="id">fp</span> <span class="id">c</span>' <span class="id">gm</span>' <span class="id">bf</span>' <span class="id">fl1</span> <span class="id">c1</span> <span class="id">c1</span>' <span class="id">bf1</span> <span class="id">fp1</span> <span class="id">bf1</span>' <span class="id">gm</span>''<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">STEP1</span>:<span class="id"><a href="AsmTSO.html#tsostep">tsostep</a></span> <span class="id"><a href="TSOAuxDefs.html#ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> (<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>,<span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span>) <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id">c</span>' (<span class="id">bf</span>',<span class="id">gm</span>'))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">STEP2</span>:<span class="id"><a href="AsmTSO.html#tsostep">tsostep</a></span> <span class="id"><a href="TSOAuxDefs.html#ge1">ge1</a></span> <span class="id"><a href="TSOAuxDefs.html#fl1">fl1</a></span> <span class="id"><a href="TSOAuxDefs.html#c1">c1</a></span> (<span class="id"><a href="TSOAuxDefs.html#bf1">bf1</a></span>,<span class="id">gm</span>') <span class="id"><a href="TSOAuxDefs.html#fp1">fp1</a></span> <span class="id">c1</span>' (<span class="id">bf1</span>',<span class="id">gm</span>''))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">BUS1</span>: <span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> <span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span> <span class="id">gm</span>'')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">BUS2</span>:<span class="id"><a href="TSOAuxDefs.html#buffer_safe">buffer_safe</a></span> <span class="id"><a href="TSOAuxDefs.html#bf1">bf1</a></span> <span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">DISJFL</span>:<span class="id"><a href="MemAux.html#disj">disj</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#fl1">fl1</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FPSMILE</span>:<span class="id"><a href="Footprint.html#FP.smile">FP.smile</a></span> <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id"><a href="TSOAuxDefs.html#fp1">fp1</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">gm1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#tsostep">tsostep</a></span> <span class="id"><a href="TSOAuxDefs.html#ge1">ge1</a></span> <span class="id"><a href="TSOAuxDefs.html#fl1">fl1</a></span> <span class="id"><a href="TSOAuxDefs.html#c1">c1</a></span> (<span class="id"><a href="TSOAuxDefs.html#bf1">bf1</a></span>,<span class="id"><a href="TSOAuxDefs.html#gm">gm</a></span>) <span class="id"><a href="TSOAuxDefs.html#fp1">fp1</a></span> <span class="id">c1</span>' (<span class="id">bf1</span>',<span class="id"><a href="TSOAuxDefs.html#gm1">gm1</a></span>)/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">gm2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#tsostep">tsostep</a></span> <span class="id"><a href="TSOAuxDefs.html#ge">ge</a></span> <span class="id"><a href="TSOAuxDefs.html#fl">fl</a></span> <span class="id"><a href="TSOAuxDefs.html#c">c</a></span> (<span class="id"><a href="TSOAuxDefs.html#bf">bf</a></span>,<span class="id"><a href="TSOAuxDefs.html#gm1">gm1</a></span>) <span class="id"><a href="TSOAuxDefs.html#fp">fp</a></span> <span class="id">c</span>' (<span class="id">bf</span>',<span class="id"><a href="TSOAuxDefs.html#gm2">gm2</a></span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.eq">GMem.eq</a></span> <span class="id">gm</span>'' <span class="id"><a href="TSOAuxDefs.html#gm2">gm2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9353')">Proof.</div>
<div class="proofscript" id="proof9353">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#tsostep_lock_or_notlock">tsostep_lock_or_notlock</a></span> <span class="kwd">in</span> <span class="id">STEP1</span> <span class="kwd">as</span> <span class="id">R1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#tsostep_lock_or_notlock">tsostep_lock_or_notlock</a></span> <span class="kwd">in</span> <span class="id">STEP2</span> <span class="kwd">as</span> <span class="id">R2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">R1</span> <span class="kwd">as</span> [<span class="id">R1</span>|<span class="id">R1</span>],<span class="id">R2</span> <span class="kwd">as</span> [<span class="id">R2</span>|<span class="id">R2</span>].<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">bf</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> /\ <span class="id">bf</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> /\ <span class="id">bf1</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> /\ <span class="id">bf1</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">R1</span>;<span class="id">inv</span> <span class="id">R2</span>;<span class="tactic">auto</span>. <span class="id">Hsimpl</span>;<span class="tactic">subst</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">exists</span> <span class="id">fm</span>, <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">gm</span>' <span class="id">fl1</span> <span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span>). <span class="id">inv</span> <span class="id">R2</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#embed_back_preserve">embed_back_preserve</a></span> <span class="kwd">in</span> <span class="id">H</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> @<span class="id"><a href="TSOAuxDefs.html#tso_lock_step_locality">tso_lock_step_locality</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#LEffect_fpsmile_LPre_Rule">LEffect_fpsmile_LPre_Rule</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#lock_step_LEffect">lock_step_LEffect</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>;<span class="id">Hsimpl</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">exists</span> <span class="id">fm</span>,<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">gm</span> <span class="id">fl</span> <span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span>). <span class="id">inv</span> <span class="id">R1</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>. <span class="tactic">apply</span> <span class="id"><a href="FPLemmas.html#disj_comm">disj_comm</a></span> <span class="kwd">in</span> <span class="id">DISJFL</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#lock_step_tsostep">lock_step_tsostep</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#embed_preserve2">embed_preserve2</a></span> <span class="kwd">in</span> <span class="id">H2</span>;<span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">DISJFL</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> @<span class="id"><a href="TSOAuxDefs.html#tso_lock_step_locality">tso_lock_step_locality</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">R1</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#LPre_comm">LPre_comm</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#LEffect_fpsmile_LPre_Rule">LEffect_fpsmile_LPre_Rule</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#lock_step_LEffect">lock_step_LEffect</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FPLemmas.html#fpsmile_sym">fpsmile_sym</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>;<span class="id">Hsimpl</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#lock_step_tsostep">lock_step_tsostep</a></span> <span class="kwd">in</span> <span class="id">H4</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="GMemory.html#GMem.eq_sym">GMem.eq_sym</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#GMem_eq">GMem_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="FPLemmas.html#LEffect_LPost_fpsmile_memeq">LEffect_LPost_fpsmile_memeq</a></span> <span class="kwd">with</span>(<span class="id">m0</span>:=<span class="id">gm</span>)(<span class="id">m1</span>:=<span class="id">gm</span>')(<span class="id">m2</span>:=<span class="id">gm</span>'')(<span class="id">m1</span>':=<span class="id">x1</span>)(<span class="id">m2</span>':=<span class="id">x4</span>);<span class="tactic">eauto</span>;<span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#lock_step_LEffect">lock_step_LEffect</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">gm</span>'' = <span class="id">gm</span>'). <span class="id">inv</span> <span class="id">R2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#not_lock_step_mem_ung">not_lock_step_mem_ung</a></span> <span class="kwd">in</span> <span class="id">H8</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">H5</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="TSOAuxDefs.html#access_validity_eq">access_validity_eq</a></span> <span class="id">gm</span> <span class="id">gm</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#TSO_step_access_validity_preserve">TSO_step_access_validity_preserve</a></span> <span class="kwd">in</span> <span class="id">STEP1</span> <span class="kwd">as</span> [];<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">exists</span> <span class="id">fm</span>, <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">gm</span>' <span class="id">fl1</span> <span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span>). <span class="id">inv</span> <span class="id">R2</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#embed_back_preserve">embed_back_preserve</a></span> <span class="kwd">in</span> <span class="id">H0</span>;<span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">DISJFL</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> @<span class="id">not_lock_step_locality</span>';<span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">R2</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#access_validity_buffer_safe_preserve">access_validity_buffer_safe_preserve</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#access_validity_eq_fl_embed_rel">access_validity_eq_fl_embed_rel</a></span>;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#access_validity_eq_comm">access_validity_eq_comm</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#LEffect_fpsmile_LPre_Rule">LEffect_fpsmile_LPre_Rule</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#lock_step_LEffect">lock_step_LEffect</a></span>;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#not_lock_step_tsostep">not_lock_step_tsostep</a></span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>;<span class="tactic">split</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="GMemory.html#GMem.eq_refl">GMem.eq_refl</a></span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">gm</span>' = <span class="id">gm</span>). <span class="id">inv</span> <span class="id">R1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#not_lock_step_mem_ung">not_lock_step_mem_ung</a></span> <span class="kwd">in</span> <span class="id">H8</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">H5</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>. <span class="tactic">split</span>;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id"><a href="TSOAuxDefs.html#access_validity_eq">access_validity_eq</a></span> <span class="id">gm</span> <span class="id">gm</span>'').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#TSO_step_access_validity_preserve">TSO_step_access_validity_preserve</a></span> <span class="kwd">in</span> <span class="id">STEP2</span> <span class="kwd">as</span> [];<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">exists</span> <span class="id">fm</span>, <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">gm</span> <span class="id">fl</span> <span class="id"><a href="TSOAuxDefs.html#fm">fm</a></span>). <span class="id">inv</span> <span class="id">R1</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#embed_preserve2">embed_preserve2</a></span> <span class="kwd">in</span> <span class="id">H0</span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="FPLemmas.html#disj_comm">disj_comm</a></span>;<span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">DISJFL</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> @<span class="id">not_lock_step_locality</span>';<span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">R1</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#access_validity_buffer_safe_preserve">access_validity_buffer_safe_preserve</a></span>;<span class="tactic">eauto</span>;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#access_validity_eq_comm">access_validity_eq_comm</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#access_validity_eq_fl_embed_rel">access_validity_eq_fl_embed_rel</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#LPre_comm">LPre_comm</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#LEffect_fpsmile_LPre_Rule">LEffect_fpsmile_LPre_Rule</a></span>;<span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id"><a href="FPLemmas.html#disj_comm">disj_comm</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#lock_step_LEffect">lock_step_LEffect</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="FPLemmas.html#fpsmile_sym">fpsmile_sym</a></span>;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#not_lock_step_tsostep">not_lock_step_tsostep</a></span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>;<span class="tactic">split</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="GMemory.html#GMem.eq_refl">GMem.eq_refl</a></span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">gm</span> = <span class="id">gm</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">R1</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#not_lock_step_mem_ung">not_lock_step_mem_ung</a></span> <span class="kwd">in</span> <span class="id">H8</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">H5</span>;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">gm</span>' = <span class="id">gm</span>'').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">R2</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOAuxDefs.html#not_lock_step_mem_ung">not_lock_step_mem_ung</a></span> <span class="kwd">in</span> <span class="id">H9</span>;<span class="id">inv</span> <span class="id">H6</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Esimpl</span>;<span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id"><a href="GMemory.html#GMem.eq_refl">GMem.eq_refl</a></span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_buf_item_MemEffect">apply_buf_item_MemEffect</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span> <span class="id">m</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOAuxDefs.html#bi">bi</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#MemEffect">MemEffect</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id">m</span>' (<span class="id"><a href="TSOMem.html#bi_footprint">bi_footprint</a></span> <span class="id"><a href="TSOAuxDefs.html#bi">bi</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9354')">Proof.</div>
<div class="proofscript" id="proof9354">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>; <span class="id">simpls</span>.<br/>
<div class="doc">alloc </div>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#alloc_eff">alloc_eff</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
<div class="doc">free </div>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#free_eff">free_eff</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
<div class="doc">store </div>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#store_eff">store_eff</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_buf_item_outside_stable">apply_buf_item_outside_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span> <span class="id">bi</span>' <span class="id">m</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOAuxDefs.html#bi">bi</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Footprint.html#FP.smile">FP.smile</a></span> (<span class="id"><a href="TSOMem.html#bi_footprint">bi_footprint</a></span> <span class="id"><a href="TSOAuxDefs.html#bi">bi</a></span>) (<span class="id"><a href="TSOMem.html#bi_footprint">bi_footprint</a></span> <span class="id">bi</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#MemPre">MemPre</a></span> <span class="id"><a href="TSOAuxDefs.html#m">m</a></span> <span class="id">m</span>' (<span class="id"><a href="TSOMem.html#bi_footprint">bi_footprint</a></span> <span class="id">bi</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9355')">Proof.</div>
<div class="proofscript" id="proof9355">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#MemPre_comm">MemPre_comm</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#MemEffect_fpsmile_MemPre_Rule">MemEffect_fpsmile_MemPre_Rule</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#apply_buf_item_MemEffect">apply_buf_item_MemEffect</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
</div>
<div class="footer"><hr/>Generated by coq2html</div>
</body>
</html>
