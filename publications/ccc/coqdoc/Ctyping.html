<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module Ctyping</title>
<meta name="description" content="Documentation of Coq module Ctyping" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module Ctyping</h1>
<div class="coq">
<br/>
<div class="doc">Typing rules and type-checking for the Compcert C language </div>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">String</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Coqlib</span> <span class="id">Maps</span> <span class="id">Integers</span> <span class="id">Floats</span> <span class="id">Errors</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">AST</span> <span class="id">Linking</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Values</span> <span class="id">Memory</span> <span class="id">Globalenvs</span> <span class="id">Events</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Ctypes</span> <span class="id">Cop</span> <span class="id">Csyntax</span> <span class="id">Csem</span>.<br/>
<br/>
<span class="kwd">Local</span> <span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">error_monad_scope</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">strict</span> := <span class="id">false</span>.<br/>
<span class="id">Opaque</span> <span class="id">strict</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">size_t</span> : <span class="id">type</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">Archi.ptr64</span> <span class="kwd">then</span> <span class="id">Tlong</span> <span class="id">Unsigned</span> <span class="id">noattr</span> <span class="kwd">else</span> <span class="id">Tint</span> <span class="id">I32</span> <span class="id">Unsigned</span> <span class="id">noattr</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">ptrdiff_t</span> : <span class="id">type</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">Archi.ptr64</span> <span class="kwd">then</span> <span class="id">Tlong</span> <span class="id">Signed</span> <span class="id">noattr</span> <span class="kwd">else</span> <span class="id">Tint</span> <span class="id">I32</span> <span class="id">Signed</span> <span class="id">noattr</span>.<br/>
<br/>
<h1> Operations over types </h1>
<br/>
<div class="doc">The type of a member of a composite (struct or union).
  The "volatile" attribute carried by the composite propagates
  to the type of the member, but not the "alignas" attribute. </div>
<br/>
<span class="kwd">Definition</span> <span class="id">attr_add_volatile</span> (<span class="id">vol</span>: <span class="id">bool</span>) (<span class="id">a</span>: <span class="id">attr</span>) :=<br/>
&nbsp;&nbsp;{| <span class="id">attr_volatile</span> := <span class="id">a</span>.(<span class="id">attr_volatile</span>) || <span class="id">vol</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">attr_alignas</span>  := <span class="id">a</span>.(<span class="id">attr_alignas</span>) |}.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">type_of_member</span> (<span class="id">a</span>: <span class="id">attr</span>) (<span class="id">f</span>: <span class="id">ident</span>) (<span class="id">m</span>: <span class="id">members</span>) : <span class="id">res</span> <span class="id">type</span> :=<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">ty</span> &lt;- <span class="id">field_type</span> <span class="id">f</span> <span class="id">m</span>;<br/>
&nbsp;&nbsp;<span class="id">OK</span> (<span class="id">change_attributes</span> (<span class="id">attr_add_volatile</span> <span class="id">a</span>.(<span class="id">attr_volatile</span>)) <span class="id">ty</span>).<br/>
<br/>
<div class="doc">Type-checking of arithmetic and logical operators </div>
<br/>
<span class="kwd">Definition</span> <span class="id">type_unop</span> (<span class="id">op</span>: <span class="id">unary_operation</span>) (<span class="id">ty</span>: <span class="id">type</span>) : <span class="id">res</span> <span class="id">type</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">op</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Onotbool</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">classify_bool</span> <span class="id">ty</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">bool_default</span> =&gt; <span class="id">Error</span> (<span class="id">msg</span> "<span class="id">operator</span> !")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">OK</span> (<span class="id">Tint</span> <span class="id">I32</span> <span class="id">Signed</span> <span class="id">noattr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;| <span class="id">Onotint</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">classify_notint</span> <span class="id">ty</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">notint_case_i</span> <span class="id">sg</span> =&gt; <span class="id">OK</span> (<span class="id">Tint</span> <span class="id">I32</span> <span class="id">sg</span> <span class="id">noattr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">notint_case_l</span> <span class="id">sg</span> =&gt; <span class="id">OK</span> (<span class="id">Tlong</span> <span class="id">sg</span> <span class="id">noattr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">notint_default</span>   =&gt; <span class="id">Error</span> (<span class="id">msg</span> "<span class="id">operator</span> ~")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;| <span class="id">Oneg</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">classify_neg</span> <span class="id">ty</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">neg_case_i</span> <span class="id">sg</span> =&gt; <span class="id">OK</span> (<span class="id">Tint</span> <span class="id">I32</span> <span class="id">sg</span> <span class="id">noattr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">neg_case_f</span> =&gt; <span class="id">OK</span> (<span class="id">Tfloat</span> <span class="id">F64</span> <span class="id">noattr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">neg_case_s</span> =&gt; <span class="id">OK</span> (<span class="id">Tfloat</span> <span class="id">F32</span> <span class="id">noattr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">neg_case_l</span> <span class="id">sg</span> =&gt; <span class="id">OK</span> (<span class="id">Tlong</span> <span class="id">sg</span> <span class="id">noattr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">neg_default</span>   =&gt; <span class="id">Error</span> (<span class="id">msg</span> "<span class="id">operator</span> <span class="id">prefix</span> -")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;| <span class="id">Oabsfloat</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">classify_neg</span> <span class="id">ty</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">neg_default</span>   =&gt; <span class="id">Error</span> (<span class="id">msg</span> "<span class="id">operator</span> <span class="id">__builtin_fabs</span>")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span>             =&gt; <span class="id">OK</span> (<span class="id">Tfloat</span> <span class="id">F64</span> <span class="id">noattr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">binarith_type</span> (<span class="id">ty1</span> <span class="id">ty2</span>: <span class="id">type</span>) (<span class="id">m</span>: <span class="id">string</span>): <span class="id">res</span> <span class="id">type</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">classify_binarith</span> <span class="id">ty1</span> <span class="id">ty2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">bin_case_i</span> <span class="id">sg</span> =&gt; <span class="id">OK</span> (<span class="id">Tint</span> <span class="id">I32</span> <span class="id">sg</span> <span class="id">noattr</span>)<br/>
&nbsp;&nbsp;| <span class="id">bin_case_l</span> <span class="id">sg</span> =&gt; <span class="id">OK</span> (<span class="id">Tlong</span> <span class="id">sg</span> <span class="id">noattr</span>)<br/>
&nbsp;&nbsp;| <span class="id">bin_case_f</span> =&gt; <span class="id">OK</span> (<span class="id">Tfloat</span> <span class="id">F64</span> <span class="id">noattr</span>)<br/>
&nbsp;&nbsp;| <span class="id">bin_case_s</span> =&gt; <span class="id">OK</span> (<span class="id">Tfloat</span> <span class="id">F32</span> <span class="id">noattr</span>)<br/>
&nbsp;&nbsp;| <span class="id">bin_default</span>   =&gt; <span class="id">Error</span> (<span class="id">msg</span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">binarith_int_type</span> (<span class="id">ty1</span> <span class="id">ty2</span>: <span class="id">type</span>) (<span class="id">m</span>: <span class="id">string</span>): <span class="id">res</span> <span class="id">type</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">classify_binarith</span> <span class="id">ty1</span> <span class="id">ty2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">bin_case_i</span> <span class="id">sg</span> =&gt; <span class="id">OK</span> (<span class="id">Tint</span> <span class="id">I32</span> <span class="id">sg</span> <span class="id">noattr</span>)<br/>
&nbsp;&nbsp;| <span class="id">bin_case_l</span> <span class="id">sg</span> =&gt; <span class="id">OK</span> (<span class="id">Tlong</span> <span class="id">sg</span> <span class="id">noattr</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">Error</span> (<span class="id">msg</span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">shift_op_type</span> (<span class="id">ty1</span> <span class="id">ty2</span>: <span class="id">type</span>) (<span class="id">m</span>: <span class="id">string</span>): <span class="id">res</span> <span class="id">type</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">classify_shift</span> <span class="id">ty1</span> <span class="id">ty2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">shift_case_ii</span> <span class="id">sg</span> | <span class="id">shift_case_il</span> <span class="id">sg</span> =&gt; <span class="id">OK</span> (<span class="id">Tint</span> <span class="id">I32</span> <span class="id">sg</span> <span class="id">noattr</span>)<br/>
&nbsp;&nbsp;| <span class="id">shift_case_li</span> <span class="id">sg</span> | <span class="id">shift_case_ll</span> <span class="id">sg</span> =&gt; <span class="id">OK</span> (<span class="id">Tlong</span> <span class="id">sg</span> <span class="id">noattr</span>)<br/>
&nbsp;&nbsp;| <span class="id">shift_default</span> =&gt; <span class="id">Error</span> (<span class="id">msg</span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">comparison_type</span> (<span class="id">ty1</span> <span class="id">ty2</span>: <span class="id">type</span>) (<span class="id">m</span>: <span class="id">string</span>): <span class="id">res</span> <span class="id">type</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">classify_cmp</span> <span class="id">ty1</span> <span class="id">ty2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">cmp_default</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">classify_binarith</span> <span class="id">ty1</span> <span class="id">ty2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">bin_default</span> =&gt; <span class="id">Error</span> (<span class="id">msg</span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">OK</span> (<span class="id">Tint</span> <span class="id">I32</span> <span class="id">Signed</span> <span class="id">noattr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">OK</span> (<span class="id">Tint</span> <span class="id">I32</span> <span class="id">Signed</span> <span class="id">noattr</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">type_binop</span> (<span class="id">op</span>: <span class="id">binary_operation</span>) (<span class="id">ty1</span> <span class="id">ty2</span>: <span class="id">type</span>) : <span class="id">res</span> <span class="id">type</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">op</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Oadd</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">classify_add</span> <span class="id">ty1</span> <span class="id">ty2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">add_case_pi</span> <span class="id">ty</span> <span class="id">_</span> | <span class="id">add_case_ip</span> <span class="id">_</span> <span class="id">ty</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">add_case_pl</span> <span class="id">ty</span>   | <span class="id">add_case_lp</span> <span class="id">ty</span> =&gt; <span class="id">OK</span> (<span class="id">Tpointer</span> <span class="id">ty</span> <span class="id">noattr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">add_default</span> =&gt; <span class="id">binarith_type</span> <span class="id">ty1</span> <span class="id">ty2</span> "<span class="id">operator</span> +"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;| <span class="id">Osub</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">classify_sub</span> <span class="id">ty1</span> <span class="id">ty2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">sub_case_pi</span> <span class="id">ty</span> <span class="id">_</span> | <span class="id">sub_case_pl</span> <span class="id">ty</span> =&gt; <span class="id">OK</span> (<span class="id">Tpointer</span> <span class="id">ty</span> <span class="id">noattr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">sub_case_pp</span> <span class="id">ty</span> =&gt; <span class="id">OK</span> <span class="id">ptrdiff_t</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">sub_default</span> =&gt; <span class="id">binarith_type</span> <span class="id">ty1</span> <span class="id">ty2</span> "<span class="id">operator</span> <span class="id">infix</span> -"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;| <span class="id">Omul</span> =&gt; <span class="id">binarith_type</span> <span class="id">ty1</span> <span class="id">ty2</span> "<span class="id">operator</span> <span class="id">infix</span> *"<br/>
&nbsp;&nbsp;| <span class="id">Odiv</span> =&gt; <span class="id">binarith_type</span> <span class="id">ty1</span> <span class="id">ty2</span> "<span class="id">operator</span> /"<br/>
&nbsp;&nbsp;| <span class="id">Omod</span> =&gt; <span class="id">binarith_int_type</span> <span class="id">ty1</span> <span class="id">ty2</span> "<span class="id">operator</span> %"<br/>
&nbsp;&nbsp;| <span class="id">Oand</span> =&gt; <span class="id">binarith_int_type</span> <span class="id">ty1</span> <span class="id">ty2</span> "<span class="id">operator</span> &amp;"<br/>
&nbsp;&nbsp;| <span class="id">Oor</span> =&gt; <span class="id">binarith_int_type</span> <span class="id">ty1</span> <span class="id">ty2</span> "<span class="id">operator</span> |"<br/>
&nbsp;&nbsp;| <span class="id">Oxor</span> =&gt; <span class="id">binarith_int_type</span> <span class="id">ty1</span> <span class="id">ty2</span> "<span class="id">operator</span> ^"<br/>
&nbsp;&nbsp;| <span class="id">Oshl</span> =&gt; <span class="id">shift_op_type</span> <span class="id">ty1</span> <span class="id">ty2</span> "<span class="id">operator</span> &lt;&lt;"<br/>
&nbsp;&nbsp;| <span class="id">Oshr</span> =&gt; <span class="id">shift_op_type</span> <span class="id">ty1</span> <span class="id">ty2</span> "<span class="id">operator</span> &gt;&gt;"<br/>
&nbsp;&nbsp;| <span class="id">Oeq</span> =&gt; <span class="id">comparison_type</span> <span class="id">ty1</span> <span class="id">ty2</span> "<span class="id">operator</span> =="<br/>
&nbsp;&nbsp;| <span class="id">One</span> =&gt; <span class="id">comparison_type</span> <span class="id">ty1</span> <span class="id">ty2</span> "<span class="id">operator</span> !="<br/>
&nbsp;&nbsp;| <span class="id">Olt</span> =&gt; <span class="id">comparison_type</span> <span class="id">ty1</span> <span class="id">ty2</span> "<span class="id">operator</span> &lt;"<br/>
&nbsp;&nbsp;| <span class="id">Ogt</span> =&gt; <span class="id">comparison_type</span> <span class="id">ty1</span> <span class="id">ty2</span> "<span class="id">operator</span> &gt;"<br/>
&nbsp;&nbsp;| <span class="id">Ole</span> =&gt; <span class="id">comparison_type</span> <span class="id">ty1</span> <span class="id">ty2</span> "<span class="id">operator</span> &lt;="<br/>
&nbsp;&nbsp;| <span class="id">Oge</span> =&gt; <span class="id">comparison_type</span> <span class="id">ty1</span> <span class="id">ty2</span> "<span class="id">operator</span> &gt;="<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">type_deref</span> (<span class="id">ty</span>: <span class="id">type</span>) : <span class="id">res</span> <span class="id">type</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">ty</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Tpointer</span> <span class="id">tyelt</span> <span class="id">_</span> =&gt; <span class="id">OK</span> <span class="id">tyelt</span><br/>
&nbsp;&nbsp;| <span class="id">Tarray</span> <span class="id">tyelt</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">OK</span> <span class="id">tyelt</span><br/>
&nbsp;&nbsp;| <span class="id">Tfunction</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">OK</span> <span class="id">ty</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">Error</span> (<span class="id">msg</span> "<span class="id">operator</span> <span class="id">prefix</span> *")<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">Inferring the type of a conditional expression: the merge of the types
  of the two arms. </div>
<br/>
<span class="kwd">Definition</span> <span class="id">attr_combine</span> (<span class="id">a1</span> <span class="id">a2</span>: <span class="id">attr</span>) : <span class="id">attr</span> :=<br/>
&nbsp;&nbsp;{| <span class="id">attr_volatile</span> := <span class="id">a1</span>.(<span class="id">attr_volatile</span>) || <span class="id">a2</span>.(<span class="id">attr_volatile</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">attr_alignas</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">a1</span>.(<span class="id">attr_alignas</span>), <span class="id">a2</span>.(<span class="id">attr_alignas</span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span>, <span class="id">al2</span> =&gt; <span class="id">al2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">al1</span>, <span class="id">None</span> =&gt; <span class="id">al1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">n1</span>, <span class="id">Some</span> <span class="id">n2</span> =&gt; <span class="id">Some</span> (<span class="id">N.max</span> <span class="id">n1</span> <span class="id">n2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;|}.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">intsize_eq</span>: <span class="kwd">forall</span> (<span class="id">x</span> <span class="id">y</span>: <span class="id">intsize</span>), {<span class="id">x</span>=<span class="id">y</span>} + {<span class="id">x</span>&lt;&gt;<span class="id">y</span>}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4047')">Proof.</div>
<div class="proofscript" id="proof4047">
 <span class="id">decide</span> <span class="id">equality</span>. Defined.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">signedness_eq</span>: <span class="kwd">forall</span> (<span class="id">x</span> <span class="id">y</span>: <span class="id">signedness</span>), {<span class="id">x</span>=<span class="id">y</span>} + {<span class="id">x</span>&lt;&gt;<span class="id">y</span>}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4048')">Proof.</div>
<div class="proofscript" id="proof4048">
 <span class="id">decide</span> <span class="id">equality</span>. Defined.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">floatsize_eq</span>: <span class="kwd">forall</span> (<span class="id">x</span> <span class="id">y</span>: <span class="id">floatsize</span>), {<span class="id">x</span>=<span class="id">y</span>} + {<span class="id">x</span>&lt;&gt;<span class="id">y</span>}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4049')">Proof.</div>
<div class="proofscript" id="proof4049">
 <span class="id">decide</span> <span class="id">equality</span>. Defined.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">callconv_combine</span> (<span class="id">cc1</span> <span class="id">cc2</span>: <span class="id">calling_convention</span>) : <span class="id">res</span> <span class="id">calling_convention</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">bool_eq</span> <span class="id">cc1</span>.(<span class="id">cc_vararg</span>) <span class="id">cc2</span>.(<span class="id">cc_vararg</span>) <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">OK</span> {| <span class="id">cc_vararg</span> := <span class="id">cc1</span>.(<span class="id">cc_vararg</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cc_unproto</span> := <span class="id">cc1</span>.(<span class="id">cc_unproto</span>) &amp;&amp; <span class="id">cc2</span>.(<span class="id">cc_unproto</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cc_structret</span> := <span class="id">cc1</span>.(<span class="id">cc_structret</span>) |}<br/>
&nbsp;&nbsp;<span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Error</span> (<span class="id">msg</span> "<span class="id">incompatible</span> <span class="id">calling</span> <span class="id">conventions</span>").<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id">type_combine</span> (<span class="id">ty1</span> <span class="id">ty2</span>: <span class="id">type</span>) : <span class="id">res</span> <span class="id">type</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">ty1</span>, <span class="id">ty2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Tvoid</span>, <span class="id">Tvoid</span> =&gt; <span class="id">OK</span> <span class="id">Tvoid</span><br/>
&nbsp;&nbsp;| <span class="id">Tint</span> <span class="id">sz1</span> <span class="id">sg1</span> <span class="id">a1</span>, <span class="id">Tint</span> <span class="id">sz2</span> <span class="id">sg2</span> <span class="id">a2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">intsize_eq</span> <span class="id">sz1</span> <span class="id">sz2</span> &amp;&amp; <span class="id">signedness_eq</span> <span class="id">sg1</span> <span class="id">sg2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id">OK</span> (<span class="id">Tint</span> <span class="id">sz1</span> <span class="id">sg1</span> (<span class="id">attr_combine</span> <span class="id">a1</span> <span class="id">a2</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">Error</span> (<span class="id">msg</span> "<span class="id">incompatible</span> <span class="id">int</span> <span class="id">types</span>")<br/>
&nbsp;&nbsp;| <span class="id">Tlong</span> <span class="id">sg1</span> <span class="id">a1</span>, <span class="id">Tlong</span> <span class="id">sg2</span> <span class="id">a2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">signedness_eq</span> <span class="id">sg1</span> <span class="id">sg2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id">OK</span> (<span class="id">Tlong</span> <span class="id">sg1</span> (<span class="id">attr_combine</span> <span class="id">a1</span> <span class="id">a2</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">Error</span> (<span class="id">msg</span> "<span class="id">incompatible</span> <span class="id">long</span> <span class="id">types</span>")<br/>
&nbsp;&nbsp;| <span class="id">Tfloat</span> <span class="id">sz1</span> <span class="id">a1</span>, <span class="id">Tfloat</span> <span class="id">sz2</span> <span class="id">a2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">floatsize_eq</span> <span class="id">sz1</span> <span class="id">sz2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id">OK</span> (<span class="id">Tfloat</span> <span class="id">sz1</span> (<span class="id">attr_combine</span> <span class="id">a1</span> <span class="id">a2</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">Error</span> (<span class="id">msg</span> "<span class="id">incompatible</span> <span class="id">float</span> <span class="id">types</span>")<br/>
&nbsp;&nbsp;| <span class="id">Tpointer</span> <span class="id">t1</span> <span class="id">a1</span>, <span class="id">Tpointer</span> <span class="id">t2</span> <span class="id">a2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">t</span> &lt;- <span class="id">type_combine</span> <span class="id">t1</span> <span class="id">t2</span>; <span class="id">OK</span> (<span class="id">Tpointer</span> <span class="id">t</span> (<span class="id">attr_combine</span> <span class="id">a1</span> <span class="id">a2</span>))<br/>
&nbsp;&nbsp;| <span class="id">Tarray</span> <span class="id">t1</span> <span class="id">sz1</span> <span class="id">a1</span>, <span class="id">Tarray</span> <span class="id">t2</span> <span class="id">sz2</span> <span class="id">a2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">t</span> &lt;- <span class="id">type_combine</span> <span class="id">t1</span> <span class="id">t2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">zeq</span> <span class="id">sz1</span> <span class="id">sz2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id">OK</span> (<span class="id">Tarray</span> <span class="id">t</span> <span class="id">sz1</span> (<span class="id">attr_combine</span> <span class="id">a1</span> <span class="id">a2</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">Error</span> (<span class="id">msg</span> "<span class="id">incompatible</span> <span class="id">array</span> <span class="id">types</span>")<br/>
&nbsp;&nbsp;| <span class="id">Tfunction</span> <span class="id">args1</span> <span class="id">res1</span> <span class="id">cc1</span>, <span class="id">Tfunction</span> <span class="id">args2</span> <span class="id">res2</span> <span class="id">cc2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">res</span> &lt;- <span class="id">type_combine</span> <span class="id">res1</span> <span class="id">res2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">args</span> &lt;-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">if</span> <span class="id">cc1</span>.(<span class="id">cc_unproto</span>) <span class="kwd">then</span> <span class="id">OK</span> <span class="id">args2</span> <span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">cc2</span>.(<span class="id">cc_unproto</span>) <span class="kwd">then</span> <span class="id">OK</span> <span class="id">args1</span> <span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">typelist_combine</span> <span class="id">args1</span> <span class="id">args2</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">cc</span> &lt;- <span class="id">callconv_combine</span> <span class="id">cc1</span> <span class="id">cc2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">OK</span> (<span class="id">Tfunction</span> <span class="id">args</span> <span class="id">res</span> <span class="id">cc</span>)<br/>
&nbsp;&nbsp;| <span class="id">Tstruct</span> <span class="id">id1</span> <span class="id">a1</span>, <span class="id">Tstruct</span> <span class="id">id2</span> <span class="id">a2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">ident_eq</span> <span class="id">id1</span> <span class="id">id2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id">OK</span> (<span class="id">Tstruct</span> <span class="id">id1</span> (<span class="id">attr_combine</span> <span class="id">a1</span> <span class="id">a2</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">Error</span> (<span class="id">msg</span> "<span class="id">incompatible</span> <span class="kwd">struct</span> <span class="id">types</span>")<br/>
&nbsp;&nbsp;| <span class="id">Tunion</span> <span class="id">id1</span> <span class="id">a1</span>, <span class="id">Tunion</span> <span class="id">id2</span> <span class="id">a2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">ident_eq</span> <span class="id">id1</span> <span class="id">id2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id">OK</span> (<span class="id">Tunion</span> <span class="id">id1</span> (<span class="id">attr_combine</span> <span class="id">a1</span> <span class="id">a2</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">Error</span> (<span class="id">msg</span> "<span class="id">incompatible</span> <span class="id">union</span> <span class="id">types</span>")<br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Error</span> (<span class="id">msg</span> "<span class="id">incompatible</span> <span class="id">types</span>")<br/>
&nbsp;&nbsp;<span class="kwd">end</span><br/>
<br/>
<span class="kwd">with</span> <span class="id">typelist_combine</span> (<span class="id">tl1</span> <span class="id">tl2</span>: <span class="id">typelist</span>) : <span class="id">res</span> <span class="id">typelist</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">tl1</span>, <span class="id">tl2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Tnil</span>, <span class="id">Tnil</span> =&gt; <span class="id">OK</span> <span class="id">Tnil</span><br/>
&nbsp;&nbsp;| <span class="id">Tcons</span> <span class="id">t1</span> <span class="id">tl1</span>, <span class="id">Tcons</span> <span class="id">t2</span> <span class="id">tl2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">t</span> &lt;- <span class="id">type_combine</span> <span class="id">t1</span> <span class="id">t2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">tl</span> &lt;- <span class="id">typelist_combine</span> <span class="id">tl1</span> <span class="id">tl2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">OK</span> (<span class="id">Tcons</span> <span class="id">t</span> <span class="id">tl</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Error</span> (<span class="id">msg</span> "<span class="id">incompatible</span> <span class="id">function</span> <span class="id">types</span>")<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">is_void</span> (<span class="id">ty</span>: <span class="id">type</span>) : <span class="id">bool</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">ty</span> <span class="kwd">with</span> <span class="id">Tvoid</span> =&gt; <span class="id">true</span> | <span class="id">_</span> =&gt; <span class="id">false</span> <span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">type_conditional</span> (<span class="id">ty1</span> <span class="id">ty2</span>: <span class="id">type</span>) : <span class="id">res</span> <span class="id">type</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">typeconv</span> <span class="id">ty1</span>, <span class="id">typeconv</span> <span class="id">ty2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| (<span class="id">Tint</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> | <span class="id">Tlong</span> <span class="id">_</span> <span class="id">_</span> | <span class="id">Tfloat</span> <span class="id">_</span> <span class="id">_</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Tint</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> | <span class="id">Tlong</span> <span class="id">_</span> <span class="id">_</span> | <span class="id">Tfloat</span> <span class="id">_</span> <span class="id">_</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">binarith_type</span> <span class="id">ty1</span> <span class="id">ty2</span> "<span class="id">conditional</span> <span class="id">expression</span>"<br/>
&nbsp;&nbsp;| <span class="id">Tpointer</span> <span class="id">t1</span> <span class="id">a1</span>, <span class="id">Tpointer</span> <span class="id">t2</span> <span class="id">a2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">t</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">is_void</span> <span class="id">t1</span> || <span class="id">is_void</span> <span class="id">t2</span> <span class="kwd">then</span> <span class="id">Tvoid</span> <span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">type_combine</span> <span class="id">t1</span> <span class="id">t2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">OK</span> <span class="id">t</span> =&gt; <span class="id">t</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Error</span> <span class="id">_</span> =&gt; <span class="id">Tvoid</span>   <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">in</span> <span class="id">OK</span> (<span class="id">Tpointer</span> <span class="id">t</span> <span class="id">noattr</span>)<br/>
&nbsp;&nbsp;| <span class="id">Tpointer</span> <span class="id">t1</span> <span class="id">a1</span>, <span class="id">Tint</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">OK</span> (<span class="id">Tpointer</span> <span class="id">t1</span> <span class="id">noattr</span>)<br/>
&nbsp;&nbsp;| <span class="id">Tint</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>, <span class="id">Tpointer</span> <span class="id">t2</span> <span class="id">a2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">OK</span> (<span class="id">Tpointer</span> <span class="id">t2</span> <span class="id">noattr</span>)<br/>
&nbsp;&nbsp;| <span class="id">t1</span>, <span class="id">t2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">type_combine</span> <span class="id">t1</span> <span class="id">t2</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<h1> Specification of the type system </h1>
<br/>
<div class="doc">Type environments map identifiers to their types. </div>
<br/>
<span class="kwd">Definition</span> <span class="id">typenv</span> := <span class="id">PTree.t</span> <span class="id">type</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">wt_cast</span> (<span class="id">from</span> <span class="id">to</span>: <span class="id">type</span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id">classify_cast</span> <span class="id">from</span> <span class="id">to</span> &lt;&gt; <span class="id">cast_case_default</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">wt_bool</span> (<span class="id">ty</span>: <span class="id">type</span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id">classify_bool</span> <span class="id">ty</span> &lt;&gt; <span class="id">bool_default</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">wt_int</span> (<span class="id">n</span>: <span class="id">int</span>) (<span class="id">sz</span>: <span class="id">intsize</span>) (<span class="id">sg</span>: <span class="id">signedness</span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">sz</span>, <span class="id">sg</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">IBool</span>, <span class="id">_</span> =&gt; <span class="id">Int.zero_ext</span> 8 <span class="id">n</span> = <span class="id">n</span><br/>
&nbsp;&nbsp;| <span class="id">I8</span>, <span class="id">Unsigned</span> =&gt; <span class="id">Int.zero_ext</span> 8 <span class="id">n</span> = <span class="id">n</span><br/>
&nbsp;&nbsp;| <span class="id">I8</span>, <span class="id">Signed</span> =&gt; <span class="id">Int.sign_ext</span> 8 <span class="id">n</span> = <span class="id">n</span><br/>
&nbsp;&nbsp;| <span class="id">I16</span>, <span class="id">Unsigned</span> =&gt; <span class="id">Int.zero_ext</span> 16 <span class="id">n</span> = <span class="id">n</span><br/>
&nbsp;&nbsp;| <span class="id">I16</span>, <span class="id">Signed</span> =&gt; <span class="id">Int.sign_ext</span> 16 <span class="id">n</span> = <span class="id">n</span><br/>
&nbsp;&nbsp;| <span class="id">I32</span>, <span class="id">_</span> =&gt; <span class="id">True</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">wt_val</span> : <span class="id">val</span> -&gt; <span class="id">type</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id">wt_val_int</span>: <span class="kwd">forall</span> <span class="id">n</span> <span class="id">sz</span> <span class="id">sg</span> <span class="id">a</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_int</span> <span class="id">n</span> <span class="id">sz</span> <span class="id">sg</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_val</span> (<span class="id">Vint</span> <span class="id">n</span>) (<span class="id">Tint</span> <span class="id">sz</span> <span class="id">sg</span> <span class="id">a</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_val_ptr_int</span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">sg</span> <span class="id">a</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Archi.ptr64</span> = <span class="id">false</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_val</span> (<span class="id">Vptr</span> <span class="id">b</span> <span class="id">ofs</span>) (<span class="id">Tint</span> <span class="id">I32</span> <span class="id">sg</span> <span class="id">a</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_val_long</span>: <span class="kwd">forall</span> <span class="id">n</span> <span class="id">sg</span> <span class="id">a</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_val</span> (<span class="id">Vlong</span> <span class="id">n</span>) (<span class="id">Tlong</span> <span class="id">sg</span> <span class="id">a</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_val_ptr_long</span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">sg</span> <span class="id">a</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Archi.ptr64</span> = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_val</span> (<span class="id">Vptr</span> <span class="id">b</span> <span class="id">ofs</span>) (<span class="id">Tlong</span> <span class="id">sg</span> <span class="id">a</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_val_float</span>: <span class="kwd">forall</span> <span class="id">f</span> <span class="id">a</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_val</span> (<span class="id">Vfloat</span> <span class="id">f</span>) (<span class="id">Tfloat</span> <span class="id">F64</span> <span class="id">a</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_val_single</span>: <span class="kwd">forall</span> <span class="id">f</span> <span class="id">a</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_val</span> (<span class="id">Vsingle</span> <span class="id">f</span>) (<span class="id">Tfloat</span> <span class="id">F32</span> <span class="id">a</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_val_pointer</span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">ty</span> <span class="id">a</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_val</span> (<span class="id">Vptr</span> <span class="id">b</span> <span class="id">ofs</span>) (<span class="id">Tpointer</span> <span class="id">ty</span> <span class="id">a</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_val_int_pointer</span>: <span class="kwd">forall</span> <span class="id">n</span> <span class="id">ty</span> <span class="id">a</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Archi.ptr64</span> = <span class="id">false</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_val</span> (<span class="id">Vint</span> <span class="id">n</span>) (<span class="id">Tpointer</span> <span class="id">ty</span> <span class="id">a</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_val_long_pointer</span>: <span class="kwd">forall</span> <span class="id">n</span> <span class="id">ty</span> <span class="id">a</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Archi.ptr64</span> = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_val</span> (<span class="id">Vlong</span> <span class="id">n</span>) (<span class="id">Tpointer</span> <span class="id">ty</span> <span class="id">a</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_val_array</span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">ty</span> <span class="id">sz</span> <span class="id">a</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_val</span> (<span class="id">Vptr</span> <span class="id">b</span> <span class="id">ofs</span>) (<span class="id">Tarray</span> <span class="id">ty</span> <span class="id">sz</span> <span class="id">a</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_val_function</span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">tyargs</span> <span class="id">tyres</span> <span class="id">cc</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_val</span> (<span class="id">Vptr</span> <span class="id">b</span> <span class="id">ofs</span>) (<span class="id">Tfunction</span> <span class="id">tyargs</span> <span class="id">tyres</span> <span class="id">cc</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_val_struct</span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">id</span> <span class="id">a</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_val</span> (<span class="id">Vptr</span> <span class="id">b</span> <span class="id">ofs</span>) (<span class="id">Tstruct</span> <span class="id">id</span> <span class="id">a</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_val_union</span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">id</span> <span class="id">a</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_val</span> (<span class="id">Vptr</span> <span class="id">b</span> <span class="id">ofs</span>) (<span class="id">Tunion</span> <span class="id">id</span> <span class="id">a</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_val_undef</span>: <span class="kwd">forall</span> <span class="id">ty</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_val</span> <span class="id">Vundef</span> <span class="id">ty</span><br/>
&nbsp;&nbsp;| <span class="id">wt_val_void</span>: <span class="kwd">forall</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_val</span> <span class="id">v</span> <span class="id">Tvoid</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">wt_arguments</span>: <span class="id">exprlist</span> -&gt; <span class="id">typelist</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id">wt_arg_nil</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_arguments</span> <span class="id">Enil</span> <span class="id">Tnil</span><br/>
&nbsp;&nbsp;| <span class="id">wt_arg_cons</span>: <span class="kwd">forall</span> <span class="id">a</span> <span class="id">al</span> <span class="id">ty</span> <span class="id">tyl</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_cast</span> (<span class="id">typeof</span> <span class="id">a</span>) <span class="id">ty</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_arguments</span> <span class="id">al</span> <span class="id">tyl</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_arguments</span> (<span class="id">Econs</span> <span class="id">a</span> <span class="id">al</span>) (<span class="id">Tcons</span> <span class="id">ty</span> <span class="id">tyl</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_arg_extra</span>: <span class="kwd">forall</span> <span class="id">a</span> <span class="id">al</span>,  <span class="docright">(* tolerance for varargs  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">strict</span> = <span class="id">false</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_arguments</span> (<span class="id">Econs</span> <span class="id">a</span> <span class="id">al</span>) <span class="id">Tnil</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">subtype</span> (<span class="id">t1</span> <span class="id">t2</span>: <span class="id">type</span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span>, <span class="id">wt_val</span> <span class="id">v</span> <span class="id">t1</span> -&gt; <span class="id">wt_val</span> <span class="id">v</span> <span class="id">t2</span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id">WT_EXPR_STMT</span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id">ce</span>: <span class="id">composite_env</span>.<br/>
<span class="kwd">Variable</span>  <span class="id">e</span>: <span class="id">typenv</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">wt_rvalue</span> : <span class="id">expr</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id">wt_Eval</span>: <span class="kwd">forall</span> <span class="id">v</span> <span class="id">ty</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_val</span> <span class="id">v</span> <span class="id">ty</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> (<span class="kwd">Eval</span> <span class="id">v</span> <span class="id">ty</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_Evalof</span>: <span class="kwd">forall</span> <span class="id">l</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_lvalue</span> <span class="id">l</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> (<span class="id">Evalof</span> <span class="id">l</span> (<span class="id">typeof</span> <span class="id">l</span>))<br/>
&nbsp;&nbsp;| <span class="id">wt_Eaddrof</span>: <span class="kwd">forall</span> <span class="id">l</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_lvalue</span> <span class="id">l</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> (<span class="id">Eaddrof</span> <span class="id">l</span> (<span class="id">Tpointer</span> (<span class="id">typeof</span> <span class="id">l</span>) <span class="id">noattr</span>))<br/>
&nbsp;&nbsp;| <span class="id">wt_Eunop</span>: <span class="kwd">forall</span> <span class="id">op</span> <span class="id">r</span> <span class="id">ty</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> <span class="id">r</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">type_unop</span> <span class="id">op</span> (<span class="id">typeof</span> <span class="id">r</span>) = <span class="id">OK</span> <span class="id">ty</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> (<span class="id">Eunop</span> <span class="id">op</span> <span class="id">r</span> <span class="id">ty</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_Ebinop</span>: <span class="kwd">forall</span> <span class="id">op</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">ty</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> <span class="id">r1</span> -&gt; <span class="id">wt_rvalue</span> <span class="id">r2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">type_binop</span> <span class="id">op</span> (<span class="id">typeof</span> <span class="id">r1</span>) (<span class="id">typeof</span> <span class="id">r2</span>) = <span class="id">OK</span> <span class="id">ty</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> (<span class="id">Ebinop</span> <span class="id">op</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">ty</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_Ecast</span>: <span class="kwd">forall</span> <span class="id">r</span> <span class="id">ty</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> <span class="id">r</span> -&gt; <span class="id">wt_cast</span> (<span class="id">typeof</span> <span class="id">r</span>) <span class="id">ty</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> (<span class="id">Ecast</span> <span class="id">r</span> <span class="id">ty</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_Eseqand</span>: <span class="kwd">forall</span> <span class="id">r1</span> <span class="id">r2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> <span class="id">r1</span> -&gt; <span class="id">wt_rvalue</span> <span class="id">r2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_bool</span> (<span class="id">typeof</span> <span class="id">r1</span>) -&gt; <span class="id">wt_bool</span> (<span class="id">typeof</span> <span class="id">r2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> (<span class="id">Eseqand</span> <span class="id">r1</span> <span class="id">r2</span> (<span class="id">Tint</span> <span class="id">I32</span> <span class="id">Signed</span> <span class="id">noattr</span>))<br/>
&nbsp;&nbsp;| <span class="id">wt_Eseqor</span>: <span class="kwd">forall</span> <span class="id">r1</span> <span class="id">r2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> <span class="id">r1</span> -&gt; <span class="id">wt_rvalue</span> <span class="id">r2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_bool</span> (<span class="id">typeof</span> <span class="id">r1</span>) -&gt; <span class="id">wt_bool</span> (<span class="id">typeof</span> <span class="id">r2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> (<span class="id">Eseqor</span> <span class="id">r1</span> <span class="id">r2</span> (<span class="id">Tint</span> <span class="id">I32</span> <span class="id">Signed</span> <span class="id">noattr</span>))<br/>
&nbsp;&nbsp;| <span class="id">wt_Econdition</span>: <span class="kwd">forall</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">r3</span> <span class="id">ty</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> <span class="id">r1</span> -&gt; <span class="id">wt_rvalue</span> <span class="id">r2</span> -&gt; <span class="id">wt_rvalue</span> <span class="id">r3</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_bool</span> (<span class="id">typeof</span> <span class="id">r1</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_cast</span> (<span class="id">typeof</span> <span class="id">r2</span>) <span class="id">ty</span> -&gt; <span class="id">wt_cast</span> (<span class="id">typeof</span> <span class="id">r3</span>) <span class="id">ty</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> (<span class="id">Econdition</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">r3</span> <span class="id">ty</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_Esizeof</span>: <span class="kwd">forall</span> <span class="id">ty</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> (<span class="id">Esizeof</span> <span class="id">ty</span> <span class="id">size_t</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_Ealignof</span>: <span class="kwd">forall</span> <span class="id">ty</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> (<span class="id">Ealignof</span> <span class="id">ty</span> <span class="id">size_t</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_Eassign</span>: <span class="kwd">forall</span> <span class="id">l</span> <span class="id">r</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_lvalue</span> <span class="id">l</span> -&gt; <span class="id">wt_rvalue</span> <span class="id">r</span> -&gt; <span class="id">wt_cast</span> (<span class="id">typeof</span> <span class="id">r</span>) (<span class="id">typeof</span> <span class="id">l</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> (<span class="id">Eassign</span> <span class="id">l</span> <span class="id">r</span> (<span class="id">typeof</span> <span class="id">l</span>))<br/>
&nbsp;&nbsp;| <span class="id">wt_Eassignop</span>: <span class="kwd">forall</span> <span class="id">op</span> <span class="id">l</span> <span class="id">r</span> <span class="id">ty</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_lvalue</span> <span class="id">l</span> -&gt; <span class="id">wt_rvalue</span> <span class="id">r</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">type_binop</span> <span class="id">op</span> (<span class="id">typeof</span> <span class="id">l</span>) (<span class="id">typeof</span> <span class="id">r</span>) = <span class="id">OK</span> <span class="id">ty</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_cast</span> <span class="id">ty</span> (<span class="id">typeof</span> <span class="id">l</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> (<span class="id">Eassignop</span> <span class="id">op</span> <span class="id">l</span> <span class="id">r</span> <span class="id">ty</span> (<span class="id">typeof</span> <span class="id">l</span>))<br/>
&nbsp;&nbsp;| <span class="id">wt_Epostincr</span>: <span class="kwd">forall</span> <span class="id">id</span> <span class="id">l</span> <span class="id">ty</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_lvalue</span> <span class="id">l</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">type_binop</span> (<span class="kwd">match</span> <span class="id">id</span> <span class="kwd">with</span> <span class="id">Incr</span> =&gt; <span class="id">Oadd</span> | <span class="id">Decr</span> =&gt; <span class="id">Osub</span> <span class="kwd">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">typeof</span> <span class="id">l</span>) (<span class="id">Tint</span> <span class="id">I32</span> <span class="id">Signed</span> <span class="id">noattr</span>) = <span class="id">OK</span> <span class="id">ty</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_cast</span> (<span class="id">incrdecr_type</span> (<span class="id">typeof</span> <span class="id">l</span>)) (<span class="id">typeof</span> <span class="id">l</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> (<span class="id">Epostincr</span> <span class="id">id</span> <span class="id">l</span> (<span class="id">typeof</span> <span class="id">l</span>))<br/>
&nbsp;&nbsp;| <span class="id">wt_Ecomma</span>: <span class="kwd">forall</span> <span class="id">r1</span> <span class="id">r2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> <span class="id">r1</span> -&gt; <span class="id">wt_rvalue</span> <span class="id">r2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> (<span class="id">Ecomma</span> <span class="id">r1</span> <span class="id">r2</span> (<span class="id">typeof</span> <span class="id">r2</span>))<br/>
&nbsp;&nbsp;| <span class="id">wt_Ecall</span>: <span class="kwd">forall</span> <span class="id">r1</span> <span class="id">rargs</span> <span class="id">tyargs</span> <span class="id">tyres</span> <span class="id">cconv</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> <span class="id">r1</span> -&gt; <span class="id">wt_exprlist</span> <span class="id">rargs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">classify_fun</span> (<span class="id">typeof</span> <span class="id">r1</span>) = <span class="id">fun_case_f</span> <span class="id">tyargs</span> <span class="id">tyres</span> <span class="id">cconv</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_arguments</span> <span class="id">rargs</span> <span class="id">tyargs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> (<span class="id">Ecall</span> <span class="id">r1</span> <span class="id">rargs</span> <span class="id">tyres</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_Ebuiltin</span>: <span class="kwd">forall</span> <span class="id">ef</span> <span class="id">tyargs</span> <span class="id">rargs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_exprlist</span> <span class="id">rargs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_arguments</span> <span class="id">rargs</span> <span class="id">tyargs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sig_res</span> (<span class="id">ef_sig</span> <span class="id">ef</span>) = <span class="id">None</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> (<span class="id">Ebuiltin</span> <span class="id">ef</span> <span class="id">tyargs</span> <span class="id">rargs</span> <span class="id">Tvoid</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_Eparen</span>: <span class="kwd">forall</span> <span class="id">r</span> <span class="id">tycast</span> <span class="id">ty</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> <span class="id">r</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_cast</span> (<span class="id">typeof</span> <span class="id">r</span>) <span class="id">tycast</span> -&gt; <span class="id">subtype</span> <span class="id">tycast</span> <span class="id">ty</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> (<span class="id">Eparen</span> <span class="id">r</span> <span class="id">tycast</span> <span class="id">ty</span>)<br/>
<br/>
<span class="kwd">with</span> <span class="id">wt_lvalue</span> : <span class="id">expr</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id">wt_Eloc</span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">ty</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_lvalue</span> (<span class="id">Eloc</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">ty</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_Evar</span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">ty</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">e</span>!<span class="id">x</span> = <span class="id">Some</span> <span class="id">ty</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_lvalue</span> (<span class="id">Evar</span> <span class="id">x</span> <span class="id">ty</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_Ederef</span>: <span class="kwd">forall</span> <span class="id">r</span> <span class="id">ty</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> <span class="id">r</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">type_deref</span> (<span class="id">typeof</span> <span class="id">r</span>) = <span class="id">OK</span> <span class="id">ty</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_lvalue</span> (<span class="id">Ederef</span> <span class="id">r</span> <span class="id">ty</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_Efield</span>: <span class="kwd">forall</span> <span class="id">r</span> <span class="id">f</span> <span class="id">id</span> <span class="id">a</span> <span class="id">co</span> <span class="id">ty</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> <span class="id">r</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">typeof</span> <span class="id">r</span> = <span class="id">Tstruct</span> <span class="id">id</span> <span class="id">a</span> \/ <span class="id">typeof</span> <span class="id">r</span> = <span class="id">Tunion</span> <span class="id">id</span> <span class="id">a</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ce</span>!<span class="id">id</span> = <span class="id">Some</span> <span class="id">co</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">type_of_member</span> <span class="id">a</span> <span class="id">f</span> <span class="id">co</span>.(<span class="id">co_members</span>) = <span class="id">OK</span> <span class="id">ty</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_lvalue</span> (<span class="id">Efield</span> <span class="id">r</span> <span class="id">f</span> <span class="id">ty</span>)<br/>
<br/>
<span class="kwd">with</span> <span class="id">wt_exprlist</span> : <span class="id">exprlist</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id">wt_Enil</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_exprlist</span> <span class="id">Enil</span><br/>
&nbsp;&nbsp;| <span class="id">wt_Econs</span>: <span class="kwd">forall</span> <span class="id">r1</span> <span class="id">rl</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> <span class="id">r1</span> -&gt; <span class="id">wt_exprlist</span> <span class="id">rl</span> -&gt; <span class="id">wt_exprlist</span> (<span class="id">Econs</span> <span class="id">r1</span> <span class="id">rl</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">wt_expr_kind</span> (<span class="id">k</span>: <span class="id">kind</span>) (<span class="id">a</span>: <span class="id">expr</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">k</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">RV</span> =&gt; <span class="id">wt_rvalue</span> <span class="id">a</span><br/>
&nbsp;&nbsp;| <span class="id">LV</span> =&gt; <span class="id">wt_lvalue</span> <span class="id">a</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">expr_kind</span> (<span class="id">a</span>: <span class="id">expr</span>) : <span class="id">kind</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">a</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Eloc</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">LV</span><br/>
&nbsp;&nbsp;| <span class="id">Evar</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">LV</span><br/>
&nbsp;&nbsp;| <span class="id">Ederef</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">LV</span><br/>
&nbsp;&nbsp;| <span class="id">Efield</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">LV</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">RV</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">wt_expr</span> (<span class="id">a</span>: <span class="id">expr</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">expr_kind</span> <span class="id">a</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">RV</span> =&gt; <span class="id">wt_rvalue</span> <span class="id">a</span><br/>
&nbsp;&nbsp;| <span class="id">LV</span> =&gt; <span class="id">wt_lvalue</span> <span class="id">a</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id">rt</span>: <span class="id">type</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">wt_stmt</span>: <span class="id">statement</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id">wt_Sskip</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_stmt</span> <span class="id">Sskip</span><br/>
&nbsp;&nbsp;| <span class="id">wt_Sdo</span>: <span class="kwd">forall</span> <span class="id">r</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> <span class="id">r</span> -&gt; <span class="id">wt_stmt</span> (<span class="id">Sdo</span> <span class="id">r</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_Ssequence</span>: <span class="kwd">forall</span> <span class="id">s1</span> <span class="id">s2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_stmt</span> <span class="id">s1</span> -&gt; <span class="id">wt_stmt</span> <span class="id">s2</span> -&gt; <span class="id">wt_stmt</span> (<span class="id">Ssequence</span> <span class="id">s1</span> <span class="id">s2</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_Sifthenelse</span>: <span class="kwd">forall</span> <span class="id">r</span> <span class="id">s1</span> <span class="id">s2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> <span class="id">r</span> -&gt; <span class="id">wt_stmt</span> <span class="id">s1</span> -&gt; <span class="id">wt_stmt</span> <span class="id">s2</span> -&gt; <span class="id">wt_bool</span> (<span class="id">typeof</span> <span class="id">r</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_stmt</span> (<span class="id">Sifthenelse</span> <span class="id">r</span> <span class="id">s1</span> <span class="id">s2</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_Swhile</span>: <span class="kwd">forall</span> <span class="id">r</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> <span class="id">r</span> -&gt; <span class="id">wt_stmt</span> <span class="id">s</span> -&gt; <span class="id">wt_bool</span> (<span class="id">typeof</span> <span class="id">r</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_stmt</span> (<span class="id">Swhile</span> <span class="id">r</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_Sdowhile</span>: <span class="kwd">forall</span> <span class="id">r</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> <span class="id">r</span> -&gt; <span class="id">wt_stmt</span> <span class="id">s</span> -&gt; <span class="id">wt_bool</span> (<span class="id">typeof</span> <span class="id">r</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_stmt</span> (<span class="id">Sdowhile</span> <span class="id">r</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_Sfor</span>: <span class="kwd">forall</span> <span class="id">s1</span> <span class="id">r</span> <span class="id">s2</span> <span class="id">s3</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> <span class="id">r</span> -&gt; <span class="id">wt_stmt</span> <span class="id">s1</span> -&gt; <span class="id">wt_stmt</span> <span class="id">s2</span> -&gt; <span class="id">wt_stmt</span> <span class="id">s3</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_bool</span> (<span class="id">typeof</span> <span class="id">r</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_stmt</span> (<span class="id">Sfor</span> <span class="id">s1</span> <span class="id">r</span> <span class="id">s2</span> <span class="id">s3</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_Sbreak</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_stmt</span> <span class="id">Sbreak</span><br/>
&nbsp;&nbsp;| <span class="id">wt_Scontinue</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_stmt</span> <span class="id">Scontinue</span><br/>
&nbsp;&nbsp;| <span class="id">wt_Sreturn_none</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_stmt</span> (<span class="id">Sreturn</span> <span class="id">None</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_Sreturn_some</span>: <span class="kwd">forall</span> <span class="id">r</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> <span class="id">r</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_cast</span> (<span class="id">typeof</span> <span class="id">r</span>) <span class="id">rt</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_stmt</span> (<span class="id">Sreturn</span> (<span class="id">Some</span> <span class="id">r</span>))<br/>
&nbsp;&nbsp;| <span class="id">wt_Sswitch</span>: <span class="kwd">forall</span> <span class="id">r</span> <span class="id">ls</span> <span class="id">sg</span> <span class="id">sz</span> <span class="id">a</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> <span class="id">r</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">typeof</span> <span class="id">r</span> = <span class="id">Tint</span> <span class="id">sz</span> <span class="id">sg</span> <span class="id">a</span> \/ <span class="id">typeof</span> <span class="id">r</span> = <span class="id">Tlong</span> <span class="id">sg</span> <span class="id">a</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_lblstmts</span> <span class="id">ls</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_stmt</span> (<span class="id">Sswitch</span> <span class="id">r</span> <span class="id">ls</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_Slabel</span>: <span class="kwd">forall</span> <span class="id">lbl</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_stmt</span> <span class="id">s</span> -&gt; <span class="id">wt_stmt</span> (<span class="id">Slabel</span> <span class="id">lbl</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_Sgoto</span>: <span class="kwd">forall</span> <span class="id">lbl</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_stmt</span> (<span class="id">Sgoto</span> <span class="id">lbl</span>)<br/>
<br/>
<span class="kwd">with</span> <span class="id">wt_lblstmts</span> : <span class="id">labeled_statements</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id">wt_LSnil</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_lblstmts</span> <span class="id">LSnil</span><br/>
&nbsp;&nbsp;| <span class="id">wt_LScons</span>: <span class="kwd">forall</span> <span class="tactic">case</span> <span class="id">s</span> <span class="id">ls</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_stmt</span> <span class="id">s</span> -&gt; <span class="id">wt_lblstmts</span> <span class="id">ls</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_lblstmts</span> (<span class="id">LScons</span> <span class="tactic">case</span> <span class="id">s</span> <span class="id">ls</span>).<br/>
<br/>
<span class="kwd">End</span> <span class="id">WT_EXPR_STMT</span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id">bind_vars</span> (<span class="id">e</span>: <span class="id">typenv</span>) (<span class="id">l</span>: <span class="id">list</span> (<span class="id">ident</span> * <span class="id">type</span>)) : <span class="id">typenv</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">l</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">nil</span> =&gt; <span class="id">e</span><br/>
&nbsp;&nbsp;| (<span class="id">id</span>, <span class="id">ty</span>) :: <span class="id">l</span> =&gt; <span class="id">bind_vars</span> (<span class="id">PTree.set</span> <span class="id">id</span> <span class="id">ty</span> <span class="id">e</span>) <span class="id">l</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">wt_function</span> (<span class="id">ce</span>: <span class="id">composite_env</span>) (<span class="id">e</span>: <span class="id">typenv</span>) : <span class="id">function</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id">wt_function_intro</span>: <span class="kwd">forall</span> <span class="id">f</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_stmt</span> <span class="id">ce</span> (<span class="id">bind_vars</span> (<span class="id">bind_vars</span> <span class="id">e</span> <span class="id">f</span>.(<span class="id">fn_params</span>)) <span class="id">f</span>.(<span class="id">fn_vars</span>)) <span class="id">f</span>.(<span class="id">fn_return</span>) <span class="id">f</span>.(<span class="id">fn_body</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_function</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">f</span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id">bind_globdef</span> (<span class="id">e</span>: <span class="id">typenv</span>) (<span class="id">l</span>: <span class="id">list</span> (<span class="id">ident</span> * <span class="id">globdef</span> <span class="id">fundef</span> <span class="id">type</span>)) : <span class="id">typenv</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">l</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">nil</span> =&gt; <span class="id">e</span><br/>
&nbsp;&nbsp;| (<span class="id">id</span>, <span class="id">Gfun</span> <span class="id">fd</span>) :: <span class="id">l</span> =&gt; <span class="id">bind_globdef</span> (<span class="id">PTree.set</span> <span class="id">id</span> (<span class="id">type_of_fundef</span> <span class="id">fd</span>) <span class="id">e</span>) <span class="id">l</span><br/>
&nbsp;&nbsp;| (<span class="id">id</span>, <span class="id">Gvar</span> <span class="id">v</span>) :: <span class="id">l</span> =&gt; <span class="id">bind_globdef</span> (<span class="id">PTree.set</span> <span class="id">id</span> <span class="id">v</span>.(<span class="id">gvar_info</span>) <span class="id">e</span>) <span class="id">l</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">wt_program</span> : <span class="id">program</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id">wt_program_intro</span>: <span class="kwd">forall</span> <span class="id">p</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">e</span> := <span class="id">bind_globdef</span> (<span class="id">PTree.empty</span> <span class="id">_</span>) <span class="id">p</span>.(<span class="id">prog_defs</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">id</span> <span class="id">f</span>, <span class="id">In</span> (<span class="id">id</span>, <span class="id">Gfun</span> (<span class="id">Internal</span> <span class="id">f</span>)) <span class="id">p</span>.(<span class="id">prog_defs</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_function</span> <span class="id">p</span>.(<span class="id">prog_comp_env</span>) <span class="id">e</span> <span class="id">f</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_program</span> <span class="id">p</span>.<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">wt_val</span> <span class="id">wt_rvalue</span> <span class="id">wt_lvalue</span> <span class="id">wt_stmt</span> <span class="id">wt_lblstmts</span>: <span class="id">ty</span>.<br/>
<span class="kwd">Hint</span> <span class="kwd">Extern</span> 1 (<span class="id">wt_int</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>) =&gt; <span class="tactic">exact</span> <span class="id">I</span>: <span class="id">ty</span>.<br/>
<span class="kwd">Hint</span> <span class="kwd">Extern</span> 1 (<span class="id">wt_int</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>) =&gt; <span class="tactic">reflexivity</span>: <span class="id">ty</span>.<br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">DestructCases</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span>: <span class="kwd">match</span> <span class="kwd">match</span> ?<span class="id">x</span> <span class="kwd">with</span> <span class="id">_</span> =&gt; <span class="id">_</span> <span class="kwd">end</span> <span class="kwd">with</span> <span class="id">_</span> =&gt; <span class="id">_</span> <span class="kwd">end</span> = <span class="id">Some</span> <span class="id">_</span> |- <span class="id">_</span> ] =&gt; <span class="tactic">destruct</span> <span class="id">x</span> <span class="id">eqn</span>:?; <span class="id">DestructCases</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span>: <span class="kwd">match</span> <span class="kwd">match</span> ?<span class="id">x</span> <span class="kwd">with</span> <span class="id">_</span> =&gt; <span class="id">_</span> <span class="kwd">end</span> <span class="kwd">with</span> <span class="id">_</span> =&gt; <span class="id">_</span> <span class="kwd">end</span> = <span class="id">OK</span> <span class="id">_</span> |- <span class="id">_</span> ] =&gt; <span class="tactic">destruct</span> <span class="id">x</span> <span class="id">eqn</span>:?; <span class="id">DestructCases</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span>: <span class="kwd">match</span> ?<span class="id">x</span> <span class="kwd">with</span> <span class="id">_</span> =&gt; <span class="id">_</span> <span class="kwd">end</span> = <span class="id">OK</span> <span class="id">_</span> |- <span class="id">_</span> ] =&gt; <span class="tactic">destruct</span> <span class="id">x</span> <span class="id">eqn</span>:?; <span class="id">DestructCases</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span>: <span class="kwd">match</span> ?<span class="id">x</span> <span class="kwd">with</span> <span class="id">_</span> =&gt; <span class="id">_</span> <span class="kwd">end</span> = <span class="id">Some</span> <span class="id">_</span> |- <span class="id">_</span> ] =&gt; <span class="tactic">destruct</span> <span class="id">x</span> <span class="id">eqn</span>:?; <span class="id">DestructCases</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span>: <span class="id">Some</span> <span class="id">_</span> = <span class="id">Some</span> <span class="id">_</span> |- <span class="id">_</span> ] =&gt; <span class="id">inv</span> <span class="id">H</span>; <span class="id">DestructCases</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span>: <span class="id">None</span> = <span class="id">Some</span> <span class="id">_</span> |- <span class="id">_</span> ] =&gt; <span class="tactic">discriminate</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span>: <span class="id">OK</span> <span class="id">_</span> = <span class="id">OK</span> <span class="id">_</span> |- <span class="id">_</span> ] =&gt; <span class="id">inv</span> <span class="id">H</span>; <span class="id">DestructCases</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span>: <span class="id">Error</span> <span class="id">_</span> = <span class="id">OK</span> <span class="id">_</span> |- <span class="id">_</span> ] =&gt; <span class="tactic">discriminate</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">idtac</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">DestructMatch</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [ |- <span class="kwd">match</span> <span class="kwd">match</span> ?<span class="id">x</span> <span class="kwd">with</span> <span class="id">_</span> =&gt; <span class="id">_</span> <span class="kwd">end</span> <span class="kwd">with</span> <span class="id">_</span> =&gt; <span class="id">_</span> <span class="kwd">end</span> ] =&gt; <span class="tactic">destruct</span> <span class="id">x</span>; <span class="id">DestructMatch</span><br/>
&nbsp;&nbsp;| [ |- <span class="kwd">match</span> ?<span class="id">x</span> <span class="kwd">with</span> <span class="id">_</span> =&gt; <span class="id">_</span> <span class="kwd">end</span> ] =&gt; <span class="tactic">destruct</span> <span class="id">x</span>; <span class="id">DestructMatch</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">idtac</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<h1> Type checking </h1>
<br/>
<span class="kwd">Definition</span> <span class="id">check_cast</span> (<span class="id">t1</span> <span class="id">t2</span>: <span class="id">type</span>) : <span class="id">res</span> <span class="id">unit</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">classify_cast</span> <span class="id">t1</span> <span class="id">t2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">cast_case_default</span> =&gt; <span class="id">Error</span> (<span class="id">msg</span> "<span class="id">illegal</span> <span class="id">cast</span>")<br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">OK</span> <span class="id">tt</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">check_bool</span> (<span class="id">t</span>: <span class="id">type</span>) : <span class="id">res</span> <span class="id">unit</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">classify_bool</span> <span class="id">t</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">bool_default</span> =&gt; <span class="id">Error</span> (<span class="id">msg</span> "<span class="id">not</span> <span class="id">a</span> <span class="id">boolean</span>")<br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">OK</span> <span class="id">tt</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">check_literal</span> (<span class="id">v</span>: <span class="id">val</span>) (<span class="id">t</span>: <span class="id">type</span>) : <span class="id">res</span> <span class="id">unit</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">v</span>, <span class="id">t</span>  <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Vint</span> <span class="id">n</span>, <span class="id">Tint</span> <span class="id">I32</span> <span class="id">sg</span> <span class="id">a</span> =&gt; <span class="id">OK</span> <span class="id">tt</span><br/>
&nbsp;&nbsp;| <span class="id">Vint</span> <span class="id">n</span>, <span class="id">Tpointer</span> <span class="id">t</span>' <span class="id">a</span> =&gt; <span class="id">OK</span> <span class="id">tt</span><br/>
&nbsp;&nbsp;| <span class="id">Vlong</span> <span class="id">n</span>, <span class="id">Tlong</span> <span class="id">sg</span> <span class="id">a</span> =&gt; <span class="id">OK</span> <span class="id">tt</span><br/>
&nbsp;&nbsp;| <span class="id">Vsingle</span> <span class="id">f</span>, <span class="id">Tfloat</span> <span class="id">F32</span> <span class="id">a</span> =&gt; <span class="id">OK</span> <span class="id">tt</span><br/>
&nbsp;&nbsp;| <span class="id">Vfloat</span> <span class="id">f</span>, <span class="id">Tfloat</span> <span class="id">F64</span> <span class="id">a</span> =&gt; <span class="id">OK</span> <span class="id">tt</span><br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">Error</span> (<span class="id">msg</span> "<span class="id">wrong</span> <span class="id">literal</span>")<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id">check_arguments</span> (<span class="id">el</span>: <span class="id">exprlist</span>) (<span class="id">tyl</span>: <span class="id">typelist</span>) : <span class="id">res</span> <span class="id">unit</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">el</span>, <span class="id">tyl</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Enil</span>, <span class="id">Tnil</span> =&gt; <span class="id">OK</span> <span class="id">tt</span><br/>
&nbsp;&nbsp;| <span class="id">Enil</span>, <span class="id">_</span> =&gt; <span class="id">Error</span> (<span class="id">msg</span> "<span class="id">not</span> <span class="id">enough</span> <span class="id">arguments</span>")<br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">Tnil</span> =&gt; <span class="kwd">if</span> <span class="id">strict</span> <span class="kwd">then</span> <span class="id">Error</span> (<span class="id">msg</span> "<span class="id">too</span> <span class="id">many</span> <span class="id">arguments</span>") <span class="kwd">else</span> <span class="id">OK</span> <span class="id">tt</span><br/>
&nbsp;&nbsp;| <span class="id">Econs</span> <span class="id">e1</span> <span class="id">el</span>, <span class="id">Tcons</span> <span class="id">ty1</span> <span class="id">tyl</span> =&gt; <span class="tactic">do</span> <span class="id">x</span> &lt;- <span class="id">check_cast</span> (<span class="id">typeof</span> <span class="id">e1</span>) <span class="id">ty1</span>; <span class="id">check_arguments</span> <span class="id">el</span> <span class="id">tyl</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">check_rval</span> (<span class="id">e</span>: <span class="id">expr</span>) : <span class="id">res</span> <span class="id">unit</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">e</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Eloc</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> | <span class="id">Evar</span> <span class="id">_</span> <span class="id">_</span> | <span class="id">Ederef</span> <span class="id">_</span> <span class="id">_</span> | <span class="id">Efield</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Error</span> (<span class="id">msg</span> "<span class="id">not</span> <span class="id">a</span> <span class="id">r</span>-<span class="id">value</span>")<br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">OK</span> <span class="id">tt</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">check_lval</span> (<span class="id">e</span>: <span class="id">expr</span>) : <span class="id">res</span> <span class="id">unit</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">e</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Eloc</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> | <span class="id">Evar</span> <span class="id">_</span> <span class="id">_</span> | <span class="id">Ederef</span> <span class="id">_</span> <span class="id">_</span> | <span class="id">Efield</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">OK</span> <span class="id">tt</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Error</span> (<span class="id">msg</span> "<span class="id">not</span> <span class="id">a</span> <span class="id">l</span>-<span class="id">value</span>")<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id">check_rvals</span> (<span class="id">el</span>: <span class="id">exprlist</span>) : <span class="id">res</span> <span class="id">unit</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">el</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Enil</span> =&gt; <span class="id">OK</span> <span class="id">tt</span><br/>
&nbsp;&nbsp;| <span class="id">Econs</span> <span class="id">e1</span> <span class="id">el</span> =&gt; <span class="tactic">do</span> <span class="id">x</span> &lt;- <span class="id">check_rval</span> <span class="id">e1</span>; <span class="id">check_rvals</span> <span class="id">el</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">Type-checking of expressions is presented as smart constructors
  that check type constraints and build the expression with the correct
  type annotation. </div>
<br/>
<span class="kwd">Definition</span> <span class="id">evar</span> (<span class="id">e</span>: <span class="id">typenv</span>) (<span class="id">x</span>: <span class="id">ident</span>) : <span class="id">res</span> <span class="id">expr</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">e</span>!<span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">ty</span> =&gt; <span class="id">OK</span> (<span class="id">Evar</span> <span class="id">x</span> <span class="id">ty</span>)<br/>
&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">Error</span> (<span class="id">MSG</span> "<span class="id">unbound</span> <span class="id">variable</span> " :: <span class="id">CTX</span> <span class="id">x</span> :: <span class="id">nil</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">ederef</span> (<span class="id">r</span>: <span class="id">expr</span>) : <span class="id">res</span> <span class="id">expr</span> :=<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">x1</span> &lt;- <span class="id">check_rval</span> <span class="id">r</span>;<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">ty</span> &lt;- <span class="id">type_deref</span> (<span class="id">typeof</span> <span class="id">r</span>);<br/>
&nbsp;&nbsp;<span class="id">OK</span> (<span class="id">Ederef</span> <span class="id">r</span> <span class="id">ty</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">efield</span> (<span class="id">ce</span>: <span class="id">composite_env</span>) (<span class="id">r</span>: <span class="id">expr</span>) (<span class="id">f</span>: <span class="id">ident</span>) : <span class="id">res</span> <span class="id">expr</span> :=<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">x1</span> &lt;- <span class="id">check_rval</span> <span class="id">r</span>;<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">typeof</span> <span class="id">r</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Tstruct</span> <span class="id">id</span> <span class="id">a</span> | <span class="id">Tunion</span> <span class="id">id</span> <span class="id">a</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">ce</span>!<span class="id">id</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">Error</span> (<span class="id">MSG</span> "<span class="id">unbound</span> <span class="id">composite</span> " :: <span class="id">CTX</span> <span class="id">id</span> :: <span class="id">nil</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">co</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">ty</span> &lt;- <span class="id">type_of_member</span> <span class="id">a</span> <span class="id">f</span> <span class="id">co</span>.(<span class="id">co_members</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">OK</span> (<span class="id">Efield</span> <span class="id">r</span> <span class="id">f</span> <span class="id">ty</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Error</span> (<span class="id">MSG</span> "<span class="id">argument</span> <span class="id">of</span> ." :: <span class="id">CTX</span> <span class="id">f</span> :: <span class="id">MSG</span> " <span class="id">is</span> <span class="id">not</span> <span class="id">a</span> <span class="kwd">struct</span> <span class="id">or</span> <span class="id">union</span>" :: <span class="id">nil</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">econst_int</span> (<span class="id">n</span>: <span class="id">int</span>) (<span class="id">sg</span>: <span class="id">signedness</span>) : <span class="id">expr</span> :=<br/>
&nbsp;&nbsp;(<span class="kwd">Eval</span> (<span class="id">Vint</span> <span class="id">n</span>) (<span class="id">Tint</span> <span class="id">I32</span> <span class="id">sg</span> <span class="id">noattr</span>)).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">econst_ptr_int</span> (<span class="id">n</span>: <span class="id">int</span>) (<span class="id">ty</span>: <span class="id">type</span>) : <span class="id">expr</span> :=<br/>
&nbsp;&nbsp;(<span class="kwd">Eval</span> (<span class="kwd">if</span> <span class="id">Archi.ptr64</span> <span class="kwd">then</span> <span class="id">Vlong</span> (<span class="id">Int64.repr</span> (<span class="id">Int.unsigned</span> <span class="id">n</span>)) <span class="kwd">else</span> <span class="id">Vint</span> <span class="id">n</span>) (<span class="id">Tpointer</span> <span class="id">ty</span> <span class="id">noattr</span>)).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">econst_long</span> (<span class="id">n</span>: <span class="id">int64</span>) (<span class="id">sg</span>: <span class="id">signedness</span>) : <span class="id">expr</span> :=<br/>
&nbsp;&nbsp;(<span class="kwd">Eval</span> (<span class="id">Vlong</span> <span class="id">n</span>) (<span class="id">Tlong</span> <span class="id">sg</span> <span class="id">noattr</span>)).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">econst_ptr_long</span> (<span class="id">n</span>: <span class="id">int64</span>) (<span class="id">ty</span>: <span class="id">type</span>) : <span class="id">expr</span> :=<br/>
&nbsp;&nbsp;(<span class="kwd">Eval</span> (<span class="kwd">if</span> <span class="id">Archi.ptr64</span> <span class="kwd">then</span> <span class="id">Vlong</span> <span class="id">n</span> <span class="kwd">else</span> <span class="id">Vint</span> (<span class="id">Int64.loword</span> <span class="id">n</span>)) (<span class="id">Tpointer</span> <span class="id">ty</span> <span class="id">noattr</span>)).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">econst_float</span> (<span class="id">n</span>: <span class="id">float</span>) : <span class="id">expr</span> :=<br/>
&nbsp;&nbsp;(<span class="kwd">Eval</span> (<span class="id">Vfloat</span> <span class="id">n</span>) (<span class="id">Tfloat</span> <span class="id">F64</span> <span class="id">noattr</span>)).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">econst_single</span> (<span class="id">n</span>: <span class="id">float32</span>) : <span class="id">expr</span> :=<br/>
&nbsp;&nbsp;(<span class="kwd">Eval</span> (<span class="id">Vsingle</span> <span class="id">n</span>) (<span class="id">Tfloat</span> <span class="id">F32</span> <span class="id">noattr</span>)).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">evalof</span> (<span class="id">l</span>: <span class="id">expr</span>) : <span class="id">res</span> <span class="id">expr</span> :=<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">x</span> &lt;- <span class="id">check_lval</span> <span class="id">l</span>; <span class="id">OK</span> (<span class="id">Evalof</span> <span class="id">l</span> (<span class="id">typeof</span> <span class="id">l</span>)).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">eaddrof</span> (<span class="id">l</span>: <span class="id">expr</span>) : <span class="id">res</span> <span class="id">expr</span> :=<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">x</span> &lt;- <span class="id">check_lval</span> <span class="id">l</span>; <span class="id">OK</span> (<span class="id">Eaddrof</span> <span class="id">l</span> (<span class="id">Tpointer</span> (<span class="id">typeof</span> <span class="id">l</span>) <span class="id">noattr</span>)).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">eunop</span> (<span class="id">op</span>: <span class="id">unary_operation</span>) (<span class="id">r</span>: <span class="id">expr</span>) : <span class="id">res</span> <span class="id">expr</span> :=<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">x</span> &lt;- <span class="id">check_rval</span> <span class="id">r</span>;<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">ty</span> &lt;- <span class="id">type_unop</span> <span class="id">op</span> (<span class="id">typeof</span> <span class="id">r</span>);<br/>
&nbsp;&nbsp;<span class="id">OK</span> (<span class="id">Eunop</span> <span class="id">op</span> <span class="id">r</span> <span class="id">ty</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">ebinop</span> (<span class="id">op</span>: <span class="id">binary_operation</span>) (<span class="id">r1</span> <span class="id">r2</span>: <span class="id">expr</span>) : <span class="id">res</span> <span class="id">expr</span> :=<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">x1</span> &lt;- <span class="id">check_rval</span> <span class="id">r1</span>; <span class="tactic">do</span> <span class="id">x2</span> &lt;- <span class="id">check_rval</span> <span class="id">r2</span>;<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">ty</span> &lt;- <span class="id">type_binop</span> <span class="id">op</span> (<span class="id">typeof</span> <span class="id">r1</span>) (<span class="id">typeof</span> <span class="id">r2</span>);<br/>
&nbsp;&nbsp;<span class="id">OK</span> (<span class="id">Ebinop</span> <span class="id">op</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">ty</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">ecast</span> (<span class="id">ty</span>: <span class="id">type</span>) (<span class="id">r</span>: <span class="id">expr</span>) : <span class="id">res</span> <span class="id">expr</span> :=<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">x1</span> &lt;- <span class="id">check_rval</span> <span class="id">r</span>;<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">x2</span> &lt;- <span class="id">check_cast</span> (<span class="id">typeof</span> <span class="id">r</span>) <span class="id">ty</span>;<br/>
&nbsp;&nbsp;<span class="id">OK</span> (<span class="id">Ecast</span> <span class="id">r</span> <span class="id">ty</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">eseqand</span> (<span class="id">r1</span> <span class="id">r2</span>: <span class="id">expr</span>) : <span class="id">res</span> <span class="id">expr</span> :=<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">x1</span> &lt;- <span class="id">check_rval</span> <span class="id">r1</span>; <span class="tactic">do</span> <span class="id">x2</span> &lt;- <span class="id">check_rval</span> <span class="id">r2</span>;<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">y1</span> &lt;- <span class="id">check_bool</span> (<span class="id">typeof</span> <span class="id">r1</span>); <span class="tactic">do</span> <span class="id">y2</span> &lt;- <span class="id">check_bool</span> (<span class="id">typeof</span> <span class="id">r2</span>);<br/>
&nbsp;&nbsp;<span class="id">OK</span> (<span class="id">Eseqand</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">type_int32s</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">eseqor</span> (<span class="id">r1</span> <span class="id">r2</span>: <span class="id">expr</span>) : <span class="id">res</span> <span class="id">expr</span> :=<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">x1</span> &lt;- <span class="id">check_rval</span> <span class="id">r1</span>; <span class="tactic">do</span> <span class="id">x2</span> &lt;- <span class="id">check_rval</span> <span class="id">r2</span>;<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">y1</span> &lt;- <span class="id">check_bool</span> (<span class="id">typeof</span> <span class="id">r1</span>); <span class="tactic">do</span> <span class="id">y2</span> &lt;- <span class="id">check_bool</span> (<span class="id">typeof</span> <span class="id">r2</span>);<br/>
&nbsp;&nbsp;<span class="id">OK</span> (<span class="id">Eseqor</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">type_int32s</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">econdition</span> (<span class="id">r1</span> <span class="id">r2</span> <span class="id">r3</span>: <span class="id">expr</span>) : <span class="id">res</span> <span class="id">expr</span> :=<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">x1</span> &lt;- <span class="id">check_rval</span> <span class="id">r1</span>; <span class="tactic">do</span> <span class="id">x2</span> &lt;- <span class="id">check_rval</span> <span class="id">r2</span>; <span class="tactic">do</span> <span class="id">x3</span> &lt;- <span class="id">check_rval</span> <span class="id">r3</span>;<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">y1</span> &lt;- <span class="id">check_bool</span> (<span class="id">typeof</span> <span class="id">r1</span>);<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">ty</span> &lt;- <span class="id">type_conditional</span> (<span class="id">typeof</span> <span class="id">r2</span>) (<span class="id">typeof</span> <span class="id">r3</span>);<br/>
&nbsp;&nbsp;<span class="id">OK</span> (<span class="id">Econdition</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">r3</span> <span class="id">ty</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">econdition</span>' (<span class="id">r1</span> <span class="id">r2</span> <span class="id">r3</span>: <span class="id">expr</span>) (<span class="id">ty</span>: <span class="id">type</span>) : <span class="id">res</span> <span class="id">expr</span> :=<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">x1</span> &lt;- <span class="id">check_rval</span> <span class="id">r1</span>; <span class="tactic">do</span> <span class="id">x2</span> &lt;- <span class="id">check_rval</span> <span class="id">r2</span>; <span class="tactic">do</span> <span class="id">x3</span> &lt;- <span class="id">check_rval</span> <span class="id">r3</span>;<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">y1</span> &lt;- <span class="id">check_bool</span> (<span class="id">typeof</span> <span class="id">r1</span>);<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">y2</span> &lt;- <span class="id">check_cast</span> (<span class="id">typeof</span> <span class="id">r2</span>) <span class="id">ty</span>;<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">y3</span> &lt;- <span class="id">check_cast</span> (<span class="id">typeof</span> <span class="id">r3</span>) <span class="id">ty</span>;<br/>
&nbsp;&nbsp;<span class="id">OK</span> (<span class="id">Econdition</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">r3</span> <span class="id">ty</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">esizeof</span> (<span class="id">ty</span>: <span class="id">type</span>) : <span class="id">expr</span> :=<br/>
&nbsp;&nbsp;<span class="id">Esizeof</span> <span class="id">ty</span> <span class="id">size_t</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">ealignof</span> (<span class="id">ty</span>: <span class="id">type</span>) : <span class="id">expr</span> :=<br/>
&nbsp;&nbsp;<span class="id">Ealignof</span> <span class="id">ty</span> <span class="id">size_t</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">eassign</span> (<span class="id">l</span> <span class="id">r</span>: <span class="id">expr</span>) : <span class="id">res</span> <span class="id">expr</span> :=<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">x1</span> &lt;- <span class="id">check_lval</span> <span class="id">l</span>; <span class="tactic">do</span> <span class="id">x2</span> &lt;- <span class="id">check_rval</span> <span class="id">r</span>;<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">y1</span> &lt;- <span class="id">check_cast</span> (<span class="id">typeof</span> <span class="id">r</span>) (<span class="id">typeof</span> <span class="id">l</span>);<br/>
&nbsp;&nbsp;<span class="id">OK</span> (<span class="id">Eassign</span> <span class="id">l</span> <span class="id">r</span> (<span class="id">typeof</span> <span class="id">l</span>)).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">eassignop</span> (<span class="id">op</span>: <span class="id">binary_operation</span>) (<span class="id">l</span> <span class="id">r</span>: <span class="id">expr</span>) : <span class="id">res</span> <span class="id">expr</span> :=<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">x1</span> &lt;- <span class="id">check_lval</span> <span class="id">l</span>; <span class="tactic">do</span> <span class="id">x2</span> &lt;- <span class="id">check_rval</span> <span class="id">r</span>;<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">ty</span> &lt;- <span class="id">type_binop</span> <span class="id">op</span> (<span class="id">typeof</span> <span class="id">l</span>) (<span class="id">typeof</span> <span class="id">r</span>);<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">y1</span> &lt;- <span class="id">check_cast</span> <span class="id">ty</span> (<span class="id">typeof</span> <span class="id">l</span>);<br/>
&nbsp;&nbsp;<span class="id">OK</span> (<span class="id">Eassignop</span> <span class="id">op</span> <span class="id">l</span> <span class="id">r</span> <span class="id">ty</span> (<span class="id">typeof</span> <span class="id">l</span>)).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">epostincrdecr</span> (<span class="id">id</span>: <span class="id">incr_or_decr</span>) (<span class="id">l</span>: <span class="id">expr</span>) : <span class="id">res</span> <span class="id">expr</span> :=<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">x1</span> &lt;- <span class="id">check_lval</span> <span class="id">l</span>;<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">ty</span> &lt;- <span class="id">type_binop</span> (<span class="kwd">match</span> <span class="id">id</span> <span class="kwd">with</span> <span class="id">Incr</span> =&gt; <span class="id">Oadd</span> | <span class="id">Decr</span> =&gt; <span class="id">Osub</span> <span class="kwd">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">typeof</span> <span class="id">l</span>) <span class="id">type_int32s</span>;<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">y1</span> &lt;- <span class="id">check_cast</span> (<span class="id">incrdecr_type</span> (<span class="id">typeof</span> <span class="id">l</span>)) (<span class="id">typeof</span> <span class="id">l</span>);<br/>
&nbsp;&nbsp;<span class="id">OK</span> (<span class="id">Epostincr</span> <span class="id">id</span> <span class="id">l</span> (<span class="id">typeof</span> <span class="id">l</span>)).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">epostincr</span> (<span class="id">l</span>: <span class="id">expr</span>) := <span class="id">epostincrdecr</span> <span class="id">Incr</span> <span class="id">l</span>.<br/>
<span class="kwd">Definition</span> <span class="id">epostdecr</span> (<span class="id">l</span>: <span class="id">expr</span>) := <span class="id">epostincrdecr</span> <span class="id">Decr</span> <span class="id">l</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">epreincr</span> (<span class="id">l</span>: <span class="id">expr</span>) := <span class="id">eassignop</span> <span class="id">Oadd</span> <span class="id">l</span> (<span class="kwd">Eval</span> (<span class="id">Vint</span> <span class="id">Int.one</span>) <span class="id">type_int32s</span>).<br/>
<span class="kwd">Definition</span> <span class="id">epredecr</span> (<span class="id">l</span>: <span class="id">expr</span>) := <span class="id">eassignop</span> <span class="id">Osub</span> <span class="id">l</span> (<span class="kwd">Eval</span> (<span class="id">Vint</span> <span class="id">Int.one</span>) <span class="id">type_int32s</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">ecomma</span> (<span class="id">r1</span> <span class="id">r2</span>: <span class="id">expr</span>) : <span class="id">res</span> <span class="id">expr</span> :=<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">x1</span> &lt;- <span class="id">check_rval</span> <span class="id">r1</span>; <span class="tactic">do</span> <span class="id">x2</span> &lt;- <span class="id">check_rval</span> <span class="id">r2</span>;<br/>
&nbsp;&nbsp;<span class="id">OK</span> (<span class="id">Ecomma</span> <span class="id">r1</span> <span class="id">r2</span> (<span class="id">typeof</span> <span class="id">r2</span>)).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">ecall</span> (<span class="id">fn</span>: <span class="id">expr</span>) (<span class="id">args</span>: <span class="id">exprlist</span>) : <span class="id">res</span> <span class="id">expr</span> :=<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">x1</span> &lt;- <span class="id">check_rval</span> <span class="id">fn</span>; <span class="tactic">do</span> <span class="id">x2</span> &lt;- <span class="id">check_rvals</span> <span class="id">args</span>;<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">classify_fun</span> (<span class="id">typeof</span> <span class="id">fn</span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">fun_case_f</span> <span class="id">tyargs</span> <span class="id">tyres</span> <span class="id">cconv</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">y1</span> &lt;- <span class="id">check_arguments</span> <span class="id">args</span> <span class="id">tyargs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">OK</span> (<span class="id">Ecall</span> <span class="id">fn</span> <span class="id">args</span> <span class="id">tyres</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Error</span> (<span class="id">msg</span> "<span class="id">call</span>: <span class="id">not</span> <span class="id">a</span> <span class="id">function</span>")<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">ebuiltin</span> (<span class="id">ef</span>: <span class="id">external_function</span>) (<span class="id">tyargs</span>: <span class="id">typelist</span>) (<span class="id">args</span>: <span class="id">exprlist</span>) (<span class="id">tyres</span>: <span class="id">type</span>) : <span class="id">res</span> <span class="id">expr</span> :=<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">x1</span> &lt;- <span class="id">check_rvals</span> <span class="id">args</span>;<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">x2</span> &lt;- <span class="id">check_arguments</span> <span class="id">args</span> <span class="id">tyargs</span>;<br/>
&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">type_eq</span> <span class="id">tyres</span> <span class="id">Tvoid</span><br/>
&nbsp;&nbsp;&amp;&amp; <span class="id">opt_typ_eq</span> (<span class="id">sig_res</span> (<span class="id">ef_sig</span> <span class="id">ef</span>)) <span class="id">None</span><br/>
&nbsp;&nbsp;<span class="kwd">then</span> <span class="id">OK</span> (<span class="id">Ebuiltin</span> <span class="id">ef</span> <span class="id">tyargs</span> <span class="id">args</span> <span class="id">tyres</span>)<br/>
&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">Error</span> (<span class="id">msg</span> "<span class="id">builtin</span>: <span class="id">wrong</span> <span class="id">type</span> <span class="id">decoration</span>").<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">sdo</span> (<span class="id">a</span>: <span class="id">expr</span>) : <span class="id">res</span> <span class="id">statement</span> :=<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">x</span> &lt;- <span class="id">check_rval</span> <span class="id">a</span>; <span class="id">OK</span> (<span class="id">Sdo</span> <span class="id">a</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">sifthenelse</span> (<span class="id">a</span>: <span class="id">expr</span>) (<span class="id">s1</span> <span class="id">s2</span>: <span class="id">statement</span>) : <span class="id">res</span> <span class="id">statement</span> :=<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">x</span> &lt;- <span class="id">check_rval</span> <span class="id">a</span>; <span class="tactic">do</span> <span class="id">y</span> &lt;- <span class="id">check_bool</span> (<span class="id">typeof</span> <span class="id">a</span>); <span class="id">OK</span> (<span class="id">Sifthenelse</span> <span class="id">a</span> <span class="id">s1</span> <span class="id">s2</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">swhile</span> (<span class="id">a</span>: <span class="id">expr</span>) (<span class="id">s</span>: <span class="id">statement</span>) : <span class="id">res</span> <span class="id">statement</span> :=<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">x</span> &lt;- <span class="id">check_rval</span> <span class="id">a</span>; <span class="tactic">do</span> <span class="id">y</span> &lt;- <span class="id">check_bool</span> (<span class="id">typeof</span> <span class="id">a</span>); <span class="id">OK</span> (<span class="id">Swhile</span> <span class="id">a</span> <span class="id">s</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">sdowhile</span> (<span class="id">a</span>: <span class="id">expr</span>) (<span class="id">s</span>: <span class="id">statement</span>) : <span class="id">res</span> <span class="id">statement</span> :=<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">x</span> &lt;- <span class="id">check_rval</span> <span class="id">a</span>; <span class="tactic">do</span> <span class="id">y</span> &lt;- <span class="id">check_bool</span> (<span class="id">typeof</span> <span class="id">a</span>); <span class="id">OK</span> (<span class="id">Sdowhile</span> <span class="id">a</span> <span class="id">s</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">sfor</span> (<span class="id">s1</span>: <span class="id">statement</span>) (<span class="id">a</span>: <span class="id">expr</span>) (<span class="id">s2</span> <span class="id">s3</span>: <span class="id">statement</span>) : <span class="id">res</span> <span class="id">statement</span> :=<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">x</span> &lt;- <span class="id">check_rval</span> <span class="id">a</span>; <span class="tactic">do</span> <span class="id">y</span> &lt;- <span class="id">check_bool</span> (<span class="id">typeof</span> <span class="id">a</span>); <span class="id">OK</span> (<span class="id">Sfor</span> <span class="id">s1</span> <span class="id">a</span> <span class="id">s2</span> <span class="id">s3</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">sreturn</span> (<span class="id">rt</span>: <span class="id">type</span>) (<span class="id">a</span>: <span class="id">expr</span>) : <span class="id">res</span> <span class="id">statement</span> :=<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">x</span> &lt;- <span class="id">check_rval</span> <span class="id">a</span>; <span class="tactic">do</span> <span class="id">y</span> &lt;- <span class="id">check_cast</span> (<span class="id">typeof</span> <span class="id">a</span>) <span class="id">rt</span>;<br/>
&nbsp;&nbsp;<span class="id">OK</span> (<span class="id">Sreturn</span> (<span class="id">Some</span> <span class="id">a</span>)).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">sswitch</span> (<span class="id">a</span>: <span class="id">expr</span>) (<span class="id">sl</span>: <span class="id">labeled_statements</span>) : <span class="id">res</span> <span class="id">statement</span> :=<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">x</span> &lt;- <span class="id">check_rval</span> <span class="id">a</span>;<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">typeof</span> <span class="id">a</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Tint</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> | <span class="id">Tlong</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">OK</span> (<span class="id">Sswitch</span> <span class="id">a</span> <span class="id">sl</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">Error</span> (<span class="id">msg</span> "<span class="id">wrong</span> <span class="id">type</span> <span class="kwd">for</span> <span class="id">argument</span> <span class="id">of</span> <span class="id">switch</span>")<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">Using the smart constructors, we define a type checker that rebuilds
    a correctly-type-annotated program. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id">retype_expr</span> (<span class="id">ce</span>: <span class="id">composite_env</span>) (<span class="id">e</span>: <span class="id">typenv</span>) (<span class="id">a</span>: <span class="id">expr</span>) : <span class="id">res</span> <span class="id">expr</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">a</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="kwd">Eval</span> (<span class="id">Vint</span> <span class="id">n</span>) (<span class="id">Tint</span> <span class="id">_</span> <span class="id">sg</span> <span class="id">_</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">OK</span> (<span class="id">econst_int</span> <span class="id">n</span> <span class="id">sg</span>)<br/>
&nbsp;&nbsp;| <span class="kwd">Eval</span> (<span class="id">Vint</span> <span class="id">n</span>) (<span class="id">Tpointer</span> <span class="id">ty</span> <span class="id">_</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">OK</span> (<span class="id">econst_ptr_int</span> <span class="id">n</span> <span class="id">ty</span>)<br/>
&nbsp;&nbsp;| <span class="kwd">Eval</span> (<span class="id">Vlong</span> <span class="id">n</span>) (<span class="id">Tlong</span> <span class="id">sg</span> <span class="id">_</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">OK</span> (<span class="id">econst_long</span> <span class="id">n</span> <span class="id">sg</span>)<br/>
&nbsp;&nbsp;| <span class="kwd">Eval</span> (<span class="id">Vfloat</span> <span class="id">n</span>) <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">OK</span> (<span class="id">econst_float</span> <span class="id">n</span>)<br/>
&nbsp;&nbsp;| <span class="kwd">Eval</span> (<span class="id">Vsingle</span> <span class="id">n</span>) <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">OK</span> (<span class="id">econst_single</span> <span class="id">n</span>)<br/>
&nbsp;&nbsp;| <span class="kwd">Eval</span> <span class="id">_</span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Error</span> (<span class="id">msg</span> "<span class="id">bad</span> <span class="id">literal</span>")<br/>
&nbsp;&nbsp;| <span class="id">Evar</span> <span class="id">x</span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">evar</span> <span class="id">e</span> <span class="id">x</span><br/>
&nbsp;&nbsp;| <span class="id">Efield</span> <span class="id">r</span> <span class="id">f</span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">r</span>' &lt;- <span class="id">retype_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">r</span>; <span class="id">efield</span> <span class="id">ce</span> <span class="id">r</span>' <span class="id">f</span><br/>
&nbsp;&nbsp;| <span class="id">Evalof</span> <span class="id">l</span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">l</span>' &lt;- <span class="id">retype_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">l</span>; <span class="id">evalof</span> <span class="id">l</span>'<br/>
&nbsp;&nbsp;| <span class="id">Ederef</span> <span class="id">r</span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">r</span>' &lt;- <span class="id">retype_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">r</span>; <span class="id">ederef</span> <span class="id">r</span>'<br/>
&nbsp;&nbsp;| <span class="id">Eaddrof</span> <span class="id">l</span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">l</span>' &lt;- <span class="id">retype_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">l</span>; <span class="id">eaddrof</span> <span class="id">l</span>'<br/>
&nbsp;&nbsp;| <span class="id">Eunop</span> <span class="id">op</span> <span class="id">r</span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">r</span>' &lt;- <span class="id">retype_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">r</span>; <span class="id">eunop</span> <span class="id">op</span> <span class="id">r</span>'<br/>
&nbsp;&nbsp;| <span class="id">Ebinop</span> <span class="id">op</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">r1</span>' &lt;- <span class="id">retype_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">r1</span>; <span class="tactic">do</span> <span class="id">r2</span>' &lt;- <span class="id">retype_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">r2</span>; <span class="id">ebinop</span> <span class="id">op</span> <span class="id">r1</span>' <span class="id">r2</span>'<br/>
&nbsp;&nbsp;| <span class="id">Ecast</span> <span class="id">r</span> <span class="id">ty</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">r</span>' &lt;- <span class="id">retype_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">r</span>; <span class="id">ecast</span> <span class="id">ty</span> <span class="id">r</span>'<br/>
&nbsp;&nbsp;| <span class="id">Eseqand</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">r1</span>' &lt;- <span class="id">retype_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">r1</span>; <span class="tactic">do</span> <span class="id">r2</span>' &lt;- <span class="id">retype_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">r2</span>; <span class="id">eseqand</span> <span class="id">r1</span>' <span class="id">r2</span>'<br/>
&nbsp;&nbsp;| <span class="id">Eseqor</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">r1</span>' &lt;- <span class="id">retype_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">r1</span>; <span class="tactic">do</span> <span class="id">r2</span>' &lt;- <span class="id">retype_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">r2</span>; <span class="id">eseqor</span> <span class="id">r1</span>' <span class="id">r2</span>'<br/>
&nbsp;&nbsp;| <span class="id">Econdition</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">r3</span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">r1</span>' &lt;- <span class="id">retype_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">r1</span>; <span class="tactic">do</span> <span class="id">r2</span>' &lt;- <span class="id">retype_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">r2</span>; <span class="tactic">do</span> <span class="id">r3</span>' &lt;- <span class="id">retype_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">r3</span>; <span class="id">econdition</span> <span class="id">r1</span>' <span class="id">r2</span>' <span class="id">r3</span>'<br/>
&nbsp;&nbsp;| <span class="id">Esizeof</span> <span class="id">ty</span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">OK</span> (<span class="id">esizeof</span> <span class="id">ty</span>)<br/>
&nbsp;&nbsp;| <span class="id">Ealignof</span> <span class="id">ty</span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">OK</span> (<span class="id">ealignof</span> <span class="id">ty</span>)<br/>
&nbsp;&nbsp;| <span class="id">Eassign</span> <span class="id">l</span> <span class="id">r</span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">l</span>' &lt;- <span class="id">retype_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">l</span>; <span class="tactic">do</span> <span class="id">r</span>' &lt;- <span class="id">retype_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">r</span>; <span class="id">eassign</span> <span class="id">l</span>' <span class="id">r</span>'<br/>
&nbsp;&nbsp;| <span class="id">Eassignop</span> <span class="id">op</span> <span class="id">l</span> <span class="id">r</span> <span class="id">_</span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">l</span>' &lt;- <span class="id">retype_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">l</span>; <span class="tactic">do</span> <span class="id">r</span>' &lt;- <span class="id">retype_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">r</span>; <span class="id">eassignop</span> <span class="id">op</span> <span class="id">l</span>' <span class="id">r</span>'<br/>
&nbsp;&nbsp;| <span class="id">Epostincr</span> <span class="id">id</span> <span class="id">l</span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">l</span>' &lt;- <span class="id">retype_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">l</span>; <span class="id">epostincrdecr</span> <span class="id">id</span> <span class="id">l</span>'<br/>
&nbsp;&nbsp;| <span class="id">Ecomma</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">r1</span>' &lt;- <span class="id">retype_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">r1</span>; <span class="tactic">do</span> <span class="id">r2</span>' &lt;- <span class="id">retype_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">r2</span>; <span class="id">ecomma</span> <span class="id">r1</span>' <span class="id">r2</span>'<br/>
&nbsp;&nbsp;| <span class="id">Ecall</span> <span class="id">r1</span> <span class="id">rl</span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">r1</span>' &lt;- <span class="id">retype_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">r1</span>; <span class="tactic">do</span> <span class="id">rl</span>' &lt;- <span class="id">retype_exprlist</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rl</span>; <span class="id">ecall</span> <span class="id">r1</span>' <span class="id">rl</span>'<br/>
&nbsp;&nbsp;| <span class="id">Ebuiltin</span> <span class="id">ef</span> <span class="id">tyargs</span> <span class="id">rl</span> <span class="id">tyres</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">rl</span>' &lt;- <span class="id">retype_exprlist</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rl</span>; <span class="id">ebuiltin</span> <span class="id">ef</span> <span class="id">tyargs</span> <span class="id">rl</span>' <span class="id">tyres</span><br/>
&nbsp;&nbsp;| <span class="id">Eloc</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Error</span> (<span class="id">msg</span> "<span class="id">Eloc</span> <span class="kwd">in</span> <span class="id">source</span>")<br/>
&nbsp;&nbsp;| <span class="id">Eparen</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Error</span> (<span class="id">msg</span> "<span class="id">Eparen</span> <span class="kwd">in</span> <span class="id">source</span>")<br/>
&nbsp;&nbsp;<span class="kwd">end</span><br/>
<br/>
<span class="kwd">with</span> <span class="id">retype_exprlist</span> (<span class="id">ce</span>: <span class="id">composite_env</span>) (<span class="id">e</span>: <span class="id">typenv</span>) (<span class="id">al</span>: <span class="id">exprlist</span>) : <span class="id">res</span> <span class="id">exprlist</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">al</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Enil</span> =&gt; <span class="id">OK</span> <span class="id">Enil</span><br/>
&nbsp;&nbsp;| <span class="id">Econs</span> <span class="id">a1</span> <span class="id">al</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">a1</span>' &lt;- <span class="id">retype_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">a1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">al</span>' &lt;- <span class="id">retype_exprlist</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">al</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">x1</span> &lt;- <span class="id">check_rval</span> <span class="id">a1</span>';<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">OK</span> (<span class="id">Econs</span> <span class="id">a1</span>' <span class="id">al</span>')<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id">retype_stmt</span> (<span class="id">ce</span>: <span class="id">composite_env</span>) (<span class="id">e</span>: <span class="id">typenv</span>) (<span class="id">rt</span>: <span class="id">type</span>) (<span class="id">s</span>: <span class="id">statement</span>) : <span class="id">res</span> <span class="id">statement</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">s</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Sskip</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">OK</span> <span class="id">Sskip</span><br/>
&nbsp;&nbsp;| <span class="id">Sdo</span> <span class="id">a</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">a</span>' &lt;- <span class="id">retype_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">a</span>; <span class="id">sdo</span> <span class="id">a</span>'<br/>
&nbsp;&nbsp;| <span class="id">Ssequence</span> <span class="id">s1</span> <span class="id">s2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">s1</span>' &lt;- <span class="id">retype_stmt</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rt</span> <span class="id">s1</span>; <span class="tactic">do</span> <span class="id">s2</span>' &lt;- <span class="id">retype_stmt</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rt</span> <span class="id">s2</span>; <span class="id">OK</span> (<span class="id">Ssequence</span> <span class="id">s1</span>' <span class="id">s2</span>')<br/>
&nbsp;&nbsp;| <span class="id">Sifthenelse</span> <span class="id">a</span> <span class="id">s1</span> <span class="id">s2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">a</span>' &lt;- <span class="id">retype_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">a</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">s1</span>' &lt;- <span class="id">retype_stmt</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rt</span> <span class="id">s1</span>; <span class="tactic">do</span> <span class="id">s2</span>' &lt;- <span class="id">retype_stmt</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rt</span> <span class="id">s2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sifthenelse</span> <span class="id">a</span>' <span class="id">s1</span>' <span class="id">s2</span>'<br/>
&nbsp;&nbsp;| <span class="id">Swhile</span> <span class="id">a</span> <span class="id">s</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">a</span>' &lt;- <span class="id">retype_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">a</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">s</span>' &lt;- <span class="id">retype_stmt</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rt</span> <span class="id">s</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">swhile</span> <span class="id">a</span>' <span class="id">s</span>'<br/>
&nbsp;&nbsp;| <span class="id">Sdowhile</span> <span class="id">a</span> <span class="id">s</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">a</span>' &lt;- <span class="id">retype_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">a</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">s</span>' &lt;- <span class="id">retype_stmt</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rt</span> <span class="id">s</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sdowhile</span> <span class="id">a</span>' <span class="id">s</span>'<br/>
&nbsp;&nbsp;| <span class="id">Sfor</span> <span class="id">s1</span> <span class="id">a</span> <span class="id">s2</span> <span class="id">s3</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">a</span>' &lt;- <span class="id">retype_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">a</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">s1</span>' &lt;- <span class="id">retype_stmt</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rt</span> <span class="id">s1</span>; <span class="tactic">do</span> <span class="id">s2</span>' &lt;- <span class="id">retype_stmt</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rt</span> <span class="id">s2</span>; <span class="tactic">do</span> <span class="id">s3</span>' &lt;- <span class="id">retype_stmt</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rt</span> <span class="id">s3</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sfor</span> <span class="id">s1</span>' <span class="id">a</span>' <span class="id">s2</span>' <span class="id">s3</span>'<br/>
&nbsp;&nbsp;| <span class="id">Sbreak</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">OK</span> <span class="id">Sbreak</span><br/>
&nbsp;&nbsp;| <span class="id">Scontinue</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">OK</span> <span class="id">Scontinue</span><br/>
&nbsp;&nbsp;| <span class="id">Sreturn</span> <span class="id">None</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">OK</span> (<span class="id">Sreturn</span> <span class="id">None</span>)<br/>
&nbsp;&nbsp;| <span class="id">Sreturn</span> (<span class="id">Some</span> <span class="id">a</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">a</span>' &lt;- <span class="id">retype_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">a</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sreturn</span> <span class="id">rt</span> <span class="id">a</span>'<br/>
&nbsp;&nbsp;| <span class="id">Sswitch</span> <span class="id">a</span> <span class="id">sl</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">a</span>' &lt;- <span class="id">retype_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">a</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">sl</span>' &lt;- <span class="id">retype_lblstmts</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rt</span> <span class="id">sl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sswitch</span> <span class="id">a</span>' <span class="id">sl</span>'<br/>
&nbsp;&nbsp;| <span class="id">Slabel</span> <span class="id">lbl</span> <span class="id">s</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">s</span>' &lt;- <span class="id">retype_stmt</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rt</span> <span class="id">s</span>; <span class="id">OK</span> (<span class="id">Slabel</span> <span class="id">lbl</span> <span class="id">s</span>')<br/>
&nbsp;&nbsp;| <span class="id">Sgoto</span> <span class="id">lbl</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">OK</span> (<span class="id">Sgoto</span> <span class="id">lbl</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span><br/>
<br/>
<span class="kwd">with</span> <span class="id">retype_lblstmts</span> (<span class="id">ce</span>: <span class="id">composite_env</span>) (<span class="id">e</span>: <span class="id">typenv</span>) (<span class="id">rt</span>: <span class="id">type</span>) (<span class="id">sl</span>: <span class="id">labeled_statements</span>) : <span class="id">res</span> <span class="id">labeled_statements</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">sl</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">LSnil</span> =&gt; <span class="id">OK</span> <span class="id">LSnil</span><br/>
&nbsp;&nbsp;| <span class="id">LScons</span> <span class="tactic">case</span> <span class="id">s</span> <span class="id">sl</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">s</span>' &lt;- <span class="id">retype_stmt</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rt</span> <span class="id">s</span>; <span class="tactic">do</span> <span class="id">sl</span>' &lt;- <span class="id">retype_lblstmts</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rt</span> <span class="id">sl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">OK</span> (<span class="id">LScons</span> <span class="tactic">case</span> <span class="id">s</span>' <span class="id">sl</span>')<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">retype_function</span> (<span class="id">ce</span>: <span class="id">composite_env</span>) (<span class="id">e</span>: <span class="id">typenv</span>) (<span class="id">f</span>: <span class="id">function</span>) : <span class="id">res</span> <span class="id">function</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">e</span> := <span class="id">bind_vars</span> (<span class="id">bind_vars</span> <span class="id">e</span> <span class="id">f</span>.(<span class="id">fn_params</span>)) <span class="id">f</span>.(<span class="id">fn_vars</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">s</span> &lt;- <span class="id">retype_stmt</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">f</span>.(<span class="id">fn_return</span>) <span class="id">f</span>.(<span class="id">fn_body</span>);<br/>
&nbsp;&nbsp;<span class="id">OK</span> (<span class="id">mkfunction</span> <span class="id">f</span>.(<span class="id">fn_return</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f</span>.(<span class="id">fn_callconv</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f</span>.(<span class="id">fn_params</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f</span>.(<span class="id">fn_vars</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">s</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">retype_fundef</span> (<span class="id">ce</span>: <span class="id">composite_env</span>) (<span class="id">e</span>: <span class="id">typenv</span>) (<span class="id">fd</span>: <span class="id">fundef</span>) : <span class="id">res</span> <span class="id">fundef</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">fd</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Internal</span> <span class="id">f</span> =&gt; <span class="tactic">do</span> <span class="id">f</span>' &lt;- <span class="id">retype_function</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">f</span>; <span class="id">OK</span> (<span class="id">Internal</span> <span class="id">f</span>')<br/>
&nbsp;&nbsp;| <span class="id">External</span> <span class="id">id</span> <span class="id">args</span> <span class="id">res</span> <span class="id">cc</span> =&gt; <span class="id">OK</span> <span class="id">fd</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">typecheck_program</span> (<span class="id">p</span>: <span class="id">program</span>) : <span class="id">res</span> <span class="id">program</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">e</span> := <span class="id">bind_globdef</span> (<span class="id">PTree.empty</span> <span class="id">_</span>) <span class="id">p</span>.(<span class="id">prog_defs</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ce</span> := <span class="id">p</span>.(<span class="id">prog_comp_env</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">tp</span> &lt;- <span class="id">transform_partial_program</span> (<span class="id">retype_fundef</span> <span class="id">ce</span> <span class="id">e</span>) <span class="id">p</span>;<br/>
&nbsp;&nbsp;<span class="id">OK</span> {| <span class="id">prog_defs</span> := <span class="id">tp</span>.(<span class="id">AST.prog_defs</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">prog_public</span> := <span class="id">p</span>.(<span class="id">prog_public</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">prog_main</span> := <span class="id">p</span>.(<span class="id">prog_main</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">prog_types</span> := <span class="id">p</span>.(<span class="id">prog_types</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">prog_comp_env</span> := <span class="id">ce</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">prog_comp_env_eq</span> := <span class="id">p</span>.(<span class="id">prog_comp_env_eq</span>) |}.<br/>
<br/>
<div class="doc">Soundness of the smart constructors.  </div>
<br/>
<span class="kwd">Lemma</span> <span class="id">check_cast_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">x</span>, <span class="id">check_cast</span> <span class="id">t1</span> <span class="id">t2</span> = <span class="id">OK</span> <span class="id">x</span> -&gt; <span class="id">wt_cast</span> <span class="id">t1</span> <span class="id">t2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4050')">Proof.</div>
<div class="proofscript" id="proof4050">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">check_cast</span>, <span class="id">wt_cast</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">classify_cast</span> <span class="id">t1</span> <span class="id">t2</span>); <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">check_bool_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">x</span>, <span class="id">check_bool</span> <span class="id">t</span> = <span class="id">OK</span> <span class="id">x</span> -&gt; <span class="id">wt_bool</span> <span class="id">t</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4051')">Proof.</div>
<div class="proofscript" id="proof4051">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">check_bool</span>, <span class="id">wt_bool</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">classify_bool</span> <span class="id">t</span>); <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">check_cast_sound</span> <span class="id">check_bool_sound</span>: <span class="id">ty</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">check_arguments_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">el</span> <span class="id">tl</span> <span class="id">x</span>, <span class="id">check_arguments</span> <span class="id">el</span> <span class="id">tl</span> = <span class="id">OK</span> <span class="id">x</span> -&gt; <span class="id">wt_arguments</span> <span class="id">el</span> <span class="id">tl</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4052')">Proof.</div>
<div class="proofscript" id="proof4052">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">el</span> <span class="id">tl</span>; <span class="id">revert</span> <span class="id">tl</span> <span class="id">el</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">tl</span>; <span class="tactic">destruct</span> <span class="id">el</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">strict</span> <span class="id">eqn</span>:<span class="id">S</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>. <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">monadInv</span> <span class="id">H</span>. <span class="id">constructor</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">check_rval_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">a</span> <span class="id">x</span>, <span class="id">check_rval</span> <span class="id">a</span> = <span class="id">OK</span> <span class="id">x</span> -&gt; <span class="id">expr_kind</span> <span class="id">a</span> = <span class="id">RV</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4053')">Proof.</div>
<div class="proofscript" id="proof4053">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">check_rval</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">reflexivity</span> || <span class="tactic">discriminate</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">check_lval_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">a</span> <span class="id">x</span>, <span class="id">check_lval</span> <span class="id">a</span> = <span class="id">OK</span> <span class="id">x</span> -&gt; <span class="id">expr_kind</span> <span class="id">a</span> = <span class="id">LV</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4054')">Proof.</div>
<div class="proofscript" id="proof4054">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">check_lval</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">reflexivity</span> || <span class="tactic">discriminate</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">binarith_type_cast</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">m</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;<span class="id">binarith_type</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">m</span> = <span class="id">OK</span> <span class="id">t</span> -&gt; <span class="id">wt_cast</span> <span class="id">t1</span> <span class="id">t</span> /\ <span class="id">wt_cast</span> <span class="id">t2</span> <span class="id">t</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4055')">Proof.</div>
<div class="proofscript" id="proof4055">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">wt_cast</span>, <span class="id">binarith_type</span>, <span class="id">classify_binarith</span>; <span class="tactic">intros</span>; <span class="id">DestructCases</span>;<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>;<br/>
&nbsp;&nbsp;<span class="tactic">try</span> (<span class="tactic">destruct</span> <span class="id">Archi.ptr64</span>; <span class="tactic">congruence</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">f0</span>; <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">typeconv_cast</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t1</span> <span class="id">t2</span>, <span class="id">wt_cast</span> (<span class="id">typeconv</span> <span class="id">t1</span>) <span class="id">t2</span> -&gt; <span class="id">wt_cast</span> <span class="id">t1</span> <span class="id">t2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4056')">Proof.</div>
<div class="proofscript" id="proof4056">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">typeconv</span>, <span class="id">wt_cast</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">t1</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">classify_cast</span> (<span class="id">Tint</span> <span class="id">I32</span> <span class="id">Signed</span> <span class="id">a</span>) <span class="id">t2</span> &lt;&gt; <span class="id">cast_case_default</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">classify_cast</span> (<span class="id">Tint</span> <span class="id">i</span> <span class="id">s</span> <span class="id">a</span>) <span class="id">t2</span> &lt;&gt; <span class="id">cast_case_default</span>).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">classify_cast</span>. <span class="tactic">destruct</span> <span class="id">t2</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>. <span class="tactic">destruct</span> <span class="id">f</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">i</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">wt_cast_int</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">i1</span> <span class="id">s1</span> <span class="id">a1</span> <span class="id">i2</span> <span class="id">s2</span> <span class="id">a2</span>, <span class="id">wt_cast</span> (<span class="id">Tint</span> <span class="id">i1</span> <span class="id">s1</span> <span class="id">a1</span>) (<span class="id">Tint</span> <span class="id">i2</span> <span class="id">s2</span> <span class="id">a2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4057')">Proof.</div>
<div class="proofscript" id="proof4057">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Archi.ptr64</span>; [ | <span class="tactic">destruct</span> (<span class="id">Ctypes.intsize_eq</span> <span class="id">i2</span> <span class="id">I32</span>)].<br/>
- <span class="tactic">destruct</span> <span class="id">i2</span>; <span class="tactic">congruence</span>.<br/>
- <span class="tactic">subst</span> <span class="id">i2</span>; <span class="tactic">congruence</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">i2</span>; <span class="tactic">congruence</span>.<br/>
Qed.</div>
&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id">type_combine_cast</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;<span class="id">type_combine</span> <span class="id">t1</span> <span class="id">t2</span> = <span class="id">OK</span> <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">t1</span> <span class="kwd">with</span> <span class="id">Tarray</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">False</span> | <span class="id">Tfunction</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">False</span> | <span class="id">_</span> =&gt; <span class="id">True</span> <span class="kwd">end</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">t2</span> <span class="kwd">with</span> <span class="id">Tarray</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">False</span> | <span class="id">Tfunction</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">False</span> | <span class="id">_</span> =&gt; <span class="id">True</span> <span class="kwd">end</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">wt_cast</span> <span class="id">t1</span> <span class="id">t</span> /\ <span class="id">wt_cast</span> <span class="id">t2</span> <span class="id">t</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4058')">Proof.</div>
<div class="proofscript" id="proof4058">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">wt_cast</span>; <span class="tactic">destruct</span> <span class="id">t1</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>; <span class="tactic">destruct</span> <span class="id">t2</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H</span>.<br/>
- <span class="tactic">simpl</span>; <span class="tactic">split</span>; <span class="tactic">congruence</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">intsize_eq</span> <span class="id">i</span> <span class="id">i0</span> &amp;&amp; <span class="id">signedness_eq</span> <span class="id">s</span> <span class="id">s0</span>); <span class="id">inv</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">apply</span> <span class="id">wt_cast_int</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">signedness_eq</span> <span class="id">s</span> <span class="id">s0</span>); <span class="id">inv</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">destruct</span> <span class="id">Archi.ptr64</span>; <span class="tactic">congruence</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">floatsize_eq</span> <span class="id">f</span> <span class="id">f0</span>); <span class="id">inv</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">destruct</span> <span class="id">f0</span>; <span class="tactic">split</span>; <span class="tactic">congruence</span>.<br/>
- <span class="id">monadInv</span> <span class="id">H3</span>. <span class="tactic">simpl</span>; <span class="tactic">split</span>; <span class="tactic">congruence</span>.<br/>
- <span class="id">contradiction</span>.<br/>
- <span class="id">contradiction</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">ident_eq</span> <span class="id">i</span> <span class="id">i0</span>); <span class="id">inv</span> <span class="id">H3</span>. <span class="tactic">simpl</span>; <span class="tactic">split</span>; <span class="tactic">congruence</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">ident_eq</span> <span class="id">i</span> <span class="id">i0</span>); <span class="id">inv</span> <span class="id">H3</span>. <span class="tactic">simpl</span>; <span class="tactic">split</span>; <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">type_conditional_cast</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;<span class="id">type_conditional</span> <span class="id">t1</span> <span class="id">t2</span> = <span class="id">OK</span> <span class="id">t</span> -&gt; <span class="id">wt_cast</span> <span class="id">t1</span> <span class="id">t</span> /\ <span class="id">wt_cast</span> <span class="id">t2</span> <span class="id">t</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4059')">Proof.</div>
<div class="proofscript" id="proof4059">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">A</span>: <span class="kwd">forall</span> <span class="id">x</span>, <span class="kwd">match</span> <span class="id">typeconv</span> <span class="id">x</span> <span class="kwd">with</span> <span class="id">Tarray</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">False</span> | <span class="id">Tfunction</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">False</span> | <span class="id">_</span> =&gt; <span class="id">True</span> <span class="kwd">end</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>. <span class="tactic">destruct</span> <span class="id">i</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">D</span>: <span class="id">type_combine</span> (<span class="id">typeconv</span> <span class="id">t1</span>) (<span class="id">typeconv</span> <span class="id">t2</span>) = <span class="id">OK</span> <span class="id">t</span> -&gt; <span class="id">wt_cast</span> <span class="id">t1</span> <span class="id">t</span> /\ <span class="id">wt_cast</span> <span class="id">t2</span> <span class="id">t</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">type_combine_cast</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> <span class="id">H0</span>; <span class="tactic">split</span>; <span class="tactic">apply</span> <span class="id">typeconv_cast</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">A</span>. <span class="tactic">apply</span> <span class="id">A</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">A</span>. <span class="tactic">unfold</span> <span class="id">type_conditional</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">typeconv</span> <span class="id">t1</span>) <span class="id">eqn</span>:<span class="id">T1</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>;<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">typeconv</span> <span class="id">t2</span>) <span class="id">eqn</span>:<span class="id">T2</span>; <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id">D</span>, <span class="id">binarith_type_cast</span>.<br/>
- <span class="tactic">split</span>; <span class="tactic">apply</span> <span class="id">typeconv_cast</span>; <span class="tactic">unfold</span> <span class="id">wt_cast</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">T1</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">destruct</span> <span class="id">Archi.ptr64</span>; <span class="tactic">congruence</span>. <br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">T2</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">destruct</span> <span class="id">Archi.ptr64</span>; <span class="tactic">congruence</span>. <br/>
- <span class="tactic">split</span>; <span class="tactic">apply</span> <span class="id">typeconv_cast</span>; <span class="tactic">unfold</span> <span class="id">wt_cast</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">T1</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">destruct</span> <span class="id">Archi.ptr64</span>; <span class="tactic">congruence</span>. <br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">T2</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">destruct</span> <span class="id">Archi.ptr64</span>; <span class="tactic">congruence</span>. <br/>
- <span class="tactic">split</span>; <span class="tactic">apply</span> <span class="id">typeconv_cast</span>; <span class="tactic">unfold</span> <span class="id">wt_cast</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">T1</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">destruct</span> <span class="id">Archi.ptr64</span>; <span class="tactic">congruence</span>. <br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">T2</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">destruct</span> <span class="id">Archi.ptr64</span>; <span class="tactic">congruence</span>. <br/>
Qed.</div>
<br/>
<span class="kwd">Section</span> <span class="id">SOUNDNESS_CONSTRUCTORS</span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id">ce</span>: <span class="id">composite_env</span>.<br/>
<span class="kwd">Variable</span> <span class="id">e</span>: <span class="id">typenv</span>.<br/>
<span class="kwd">Variable</span> <span class="id">rt</span>: <span class="id">type</span>.<br/>
<br/>
<span class="kwd">Corollary</span> <span class="id">check_rval_wt</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">a</span> <span class="id">x</span>, <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">a</span> -&gt; <span class="id">check_rval</span> <span class="id">a</span> = <span class="id">OK</span> <span class="id">x</span> -&gt; <span class="id">wt_rvalue</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">a</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4060')">Proof.</div>
<div class="proofscript" id="proof4060">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">wt_expr</span>; <span class="tactic">intros</span>. <span class="id">erewrite</span> <span class="id">check_rval_sound</span> <span class="kwd">in</span> <span class="id">H</span> <span class="tactic">by</span> <span class="tactic">eauto</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Corollary</span> <span class="id">check_lval_wt</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">a</span> <span class="id">x</span>, <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">a</span> -&gt; <span class="id">check_lval</span> <span class="id">a</span> = <span class="id">OK</span> <span class="id">x</span> -&gt; <span class="id">wt_lvalue</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">a</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4061')">Proof.</div>
<div class="proofscript" id="proof4061">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">wt_expr</span>; <span class="tactic">intros</span>. <span class="id">erewrite</span> <span class="id">check_lval_sound</span> <span class="kwd">in</span> <span class="id">H</span> <span class="tactic">by</span> <span class="tactic">eauto</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">check_rval_wt</span> <span class="id">check_lval_wt</span>: <span class="id">ty</span>.<br/>
<span class="kwd">Hint</span> <span class="kwd">Extern</span> 1 (<span class="id">wt_expr</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>) =&gt; (<span class="tactic">unfold</span> <span class="id">wt_expr</span>; <span class="tactic">simpl</span>): <span class="id">ty</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">evar_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">a</span>, <span class="id">evar</span> <span class="id">e</span> <span class="id">x</span> = <span class="id">OK</span> <span class="id">a</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">a</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4062')">Proof.</div>
<div class="proofscript" id="proof4062">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">evar</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> (<span class="id">e</span>!<span class="id">x</span>) <span class="kwd">as</span> [<span class="id">ty</span>|] <span class="id">eqn</span>:<span class="id">E</span>; <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">ederef_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r</span> <span class="id">a</span>, <span class="id">ederef</span> <span class="id">r</span> = <span class="id">OK</span> <span class="id">a</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">r</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">a</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4063')">Proof.</div>
<div class="proofscript" id="proof4063">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">monadInv</span> <span class="id">H</span>. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">efield_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r</span> <span class="id">f</span> <span class="id">a</span>, <span class="id">efield</span> <span class="id">ce</span> <span class="id">r</span> <span class="id">f</span> = <span class="id">OK</span> <span class="id">a</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">r</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">a</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4064')">Proof.</div>
<div class="proofscript" id="proof4064">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">monadInv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">typeof</span> <span class="id">r</span>) <span class="id">eqn</span>:<span class="id">TR</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>;<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">ce</span>!<span class="id">i</span>) <span class="kwd">as</span> [<span class="id">co</span>|] <span class="id">eqn</span>:<span class="id">CE</span>; <span class="id">monadInv</span> <span class="id">EQ0</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">econst_int_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">sg</span>, <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> (<span class="id">econst_int</span> <span class="id">n</span> <span class="id">sg</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4065')">Proof.</div>
<div class="proofscript" id="proof4065">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">econst_int</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">econst_ptr_int_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">ty</span>, <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> (<span class="id">econst_ptr_int</span> <span class="id">n</span> <span class="id">ty</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4066')">Proof.</div>
<div class="proofscript" id="proof4066">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">econst_ptr_int</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">Archi.ptr64</span> <span class="id">eqn</span>:<span class="id">SF</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">econst_long_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">sg</span>, <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> (<span class="id">econst_long</span> <span class="id">n</span> <span class="id">sg</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4067')">Proof.</div>
<div class="proofscript" id="proof4067">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">econst_long</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">econst_ptr_long_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">ty</span>, <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> (<span class="id">econst_ptr_long</span> <span class="id">n</span> <span class="id">ty</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4068')">Proof.</div>
<div class="proofscript" id="proof4068">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">econst_ptr_long</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">Archi.ptr64</span> <span class="id">eqn</span>:<span class="id">SF</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">econst_float_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span>, <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> (<span class="id">econst_float</span> <span class="id">n</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4069')">Proof.</div>
<div class="proofscript" id="proof4069">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">econst_float</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">econst_single_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span>, <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> (<span class="id">econst_single</span> <span class="id">n</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4070')">Proof.</div>
<div class="proofscript" id="proof4070">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">econst_single</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">evalof_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l</span> <span class="id">a</span>, <span class="id">evalof</span> <span class="id">l</span> = <span class="id">OK</span> <span class="id">a</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">l</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">a</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4071')">Proof.</div>
<div class="proofscript" id="proof4071">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">monadInv</span> <span class="id">H</span>. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">eaddrof_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l</span> <span class="id">a</span>, <span class="id">eaddrof</span> <span class="id">l</span> = <span class="id">OK</span> <span class="id">a</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">l</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">a</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4072')">Proof.</div>
<div class="proofscript" id="proof4072">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">monadInv</span> <span class="id">H</span>. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">eunop_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">op</span> <span class="id">r</span> <span class="id">a</span>, <span class="id">eunop</span> <span class="id">op</span> <span class="id">r</span> = <span class="id">OK</span> <span class="id">a</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">r</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">a</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4073')">Proof.</div>
<div class="proofscript" id="proof4073">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">monadInv</span> <span class="id">H</span>. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">ebinop_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">op</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">a</span>, <span class="id">ebinop</span> <span class="id">op</span> <span class="id">r1</span> <span class="id">r2</span> = <span class="id">OK</span> <span class="id">a</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">r1</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">r2</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">a</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4074')">Proof.</div>
<div class="proofscript" id="proof4074">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">monadInv</span> <span class="id">H</span>. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">ecast_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ty</span> <span class="id">r</span> <span class="id">a</span>, <span class="id">ecast</span> <span class="id">ty</span> <span class="id">r</span> = <span class="id">OK</span> <span class="id">a</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">r</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">a</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4075')">Proof.</div>
<div class="proofscript" id="proof4075">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">monadInv</span> <span class="id">H</span>. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">eseqand_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">a</span>, <span class="id">eseqand</span> <span class="id">r1</span> <span class="id">r2</span> = <span class="id">OK</span> <span class="id">a</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">r1</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">r2</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">a</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4076')">Proof.</div>
<div class="proofscript" id="proof4076">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">monadInv</span> <span class="id">H</span>. <span class="tactic">eauto</span> 10 <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">eseqor_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">a</span>, <span class="id">eseqor</span> <span class="id">r1</span> <span class="id">r2</span> = <span class="id">OK</span> <span class="id">a</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">r1</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">r2</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">a</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4077')">Proof.</div>
<div class="proofscript" id="proof4077">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">monadInv</span> <span class="id">H</span>. <span class="tactic">eauto</span> 10 <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">econdition_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">r3</span> <span class="id">a</span>, <span class="id">econdition</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">r3</span> = <span class="id">OK</span> <span class="id">a</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">r1</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">r2</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">r3</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">a</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4078')">Proof.</div>
<div class="proofscript" id="proof4078">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">monadInv</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id">type_conditional_cast</span> <span class="kwd">in</span> <span class="id">EQ3</span>. <span class="tactic">destruct</span> <span class="id">EQ3</span>. <span class="tactic">eauto</span> 10 <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">econdition</span>'<span class="id">_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">r3</span> <span class="id">ty</span> <span class="id">a</span>, <span class="id">econdition</span>' <span class="id">r1</span> <span class="id">r2</span> <span class="id">r3</span> <span class="id">ty</span> = <span class="id">OK</span> <span class="id">a</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">r1</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">r2</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">r3</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">a</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4079')">Proof.</div>
<div class="proofscript" id="proof4079">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">monadInv</span> <span class="id">H</span>. <span class="tactic">eauto</span> 10 <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">esizeof_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ty</span>, <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> (<span class="id">esizeof</span> <span class="id">ty</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4080')">Proof.</div>
<div class="proofscript" id="proof4080">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">esizeof</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">ealignof_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ty</span>, <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> (<span class="id">ealignof</span> <span class="id">ty</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4081')">Proof.</div>
<div class="proofscript" id="proof4081">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">ealignof</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">eassign_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l</span> <span class="id">r</span> <span class="id">a</span>, <span class="id">eassign</span> <span class="id">l</span> <span class="id">r</span> = <span class="id">OK</span> <span class="id">a</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">l</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">r</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">a</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4082')">Proof.</div>
<div class="proofscript" id="proof4082">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">monadInv</span> <span class="id">H</span>. <span class="tactic">eauto</span> 10 <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">eassignop_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">op</span> <span class="id">l</span> <span class="id">r</span> <span class="id">a</span>, <span class="id">eassignop</span> <span class="id">op</span> <span class="id">l</span> <span class="id">r</span> = <span class="id">OK</span> <span class="id">a</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">l</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">r</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">a</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4083')">Proof.</div>
<div class="proofscript" id="proof4083">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">monadInv</span> <span class="id">H</span>. <span class="tactic">eauto</span> 10 <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">epostincrdecr_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">id</span> <span class="id">l</span> <span class="id">a</span>, <span class="id">epostincrdecr</span> <span class="id">id</span> <span class="id">l</span> = <span class="id">OK</span> <span class="id">a</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">l</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">a</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4084')">Proof.</div>
<div class="proofscript" id="proof4084">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">monadInv</span> <span class="id">H</span>. <span class="tactic">eauto</span> 10 <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">ecomma_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">a</span>, <span class="id">ecomma</span> <span class="id">r1</span> <span class="id">r2</span> = <span class="id">OK</span> <span class="id">a</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">r1</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">r2</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">a</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4085')">Proof.</div>
<div class="proofscript" id="proof4085">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">monadInv</span> <span class="id">H</span>. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">ecall_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fn</span> <span class="id">args</span> <span class="id">a</span>, <span class="id">ecall</span> <span class="id">fn</span> <span class="id">args</span> = <span class="id">OK</span> <span class="id">a</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">fn</span> -&gt; <span class="id">wt_exprlist</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">args</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">a</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4086')">Proof.</div>
<div class="proofscript" id="proof4086">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">monadInv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">classify_fun</span> (<span class="id">typeof</span> <span class="id">fn</span>)) <span class="id">eqn</span>:<span class="id">CF</span>; <span class="id">monadInv</span> <span class="id">EQ2</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>. <span class="tactic">eapply</span> <span class="id">check_arguments_sound</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">ebuiltin_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ef</span> <span class="id">tyargs</span> <span class="id">args</span> <span class="id">tyres</span> <span class="id">a</span>,<br/>
&nbsp;&nbsp;<span class="id">ebuiltin</span> <span class="id">ef</span> <span class="id">tyargs</span> <span class="id">args</span> <span class="id">tyres</span> = <span class="id">OK</span> <span class="id">a</span> -&gt; <span class="id">wt_exprlist</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">args</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">a</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4087')">Proof.</div>
<div class="proofscript" id="proof4087">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">monadInv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">type_eq</span> <span class="id">tyres</span> <span class="id">Tvoid</span>); <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">EQ2</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">opt_typ_eq</span> (<span class="id">sig_res</span> (<span class="id">ef_sig</span> <span class="id">ef</span>)) <span class="id">None</span>); <span class="id">inv</span> <span class="id">EQ2</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">check_arguments_sound</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">sdo_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">a</span> <span class="id">s</span>, <span class="id">sdo</span> <span class="id">a</span> = <span class="id">OK</span> <span class="id">s</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">a</span> -&gt; <span class="id">wt_stmt</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rt</span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4088')">Proof.</div>
<div class="proofscript" id="proof4088">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">monadInv</span> <span class="id">H</span>. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">sifthenelse_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">a</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">s</span>, <span class="id">sifthenelse</span> <span class="id">a</span> <span class="id">s1</span> <span class="id">s2</span> = <span class="id">OK</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">a</span> -&gt; <span class="id">wt_stmt</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rt</span> <span class="id">s1</span> -&gt; <span class="id">wt_stmt</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rt</span> <span class="id">s2</span> -&gt; <span class="id">wt_stmt</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rt</span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4089')">Proof.</div>
<div class="proofscript" id="proof4089">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">monadInv</span> <span class="id">H</span>. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">swhile_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">a</span> <span class="id">s1</span> <span class="id">s</span>, <span class="id">swhile</span> <span class="id">a</span> <span class="id">s1</span> = <span class="id">OK</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">a</span> -&gt; <span class="id">wt_stmt</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rt</span> <span class="id">s1</span> -&gt; <span class="id">wt_stmt</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rt</span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4090')">Proof.</div>
<div class="proofscript" id="proof4090">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">monadInv</span> <span class="id">H</span>. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">sdowhile_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">a</span> <span class="id">s1</span> <span class="id">s</span>, <span class="id">sdowhile</span> <span class="id">a</span> <span class="id">s1</span> = <span class="id">OK</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">a</span> -&gt; <span class="id">wt_stmt</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rt</span> <span class="id">s1</span> -&gt; <span class="id">wt_stmt</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rt</span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4091')">Proof.</div>
<div class="proofscript" id="proof4091">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">monadInv</span> <span class="id">H</span>. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">sfor_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s1</span> <span class="id">a</span> <span class="id">s2</span> <span class="id">s3</span> <span class="id">s</span>, <span class="id">sfor</span> <span class="id">s1</span> <span class="id">a</span> <span class="id">s2</span> <span class="id">s3</span> = <span class="id">OK</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">wt_stmt</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rt</span> <span class="id">s1</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">a</span> -&gt; <span class="id">wt_stmt</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rt</span> <span class="id">s2</span> -&gt; <span class="id">wt_stmt</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rt</span> <span class="id">s3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">wt_stmt</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rt</span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4092')">Proof.</div>
<div class="proofscript" id="proof4092">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">monadInv</span> <span class="id">H</span>. <span class="tactic">eauto</span> 10 <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">sreturn_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">a</span> <span class="id">s</span>, <span class="id">sreturn</span> <span class="id">rt</span> <span class="id">a</span> = <span class="id">OK</span> <span class="id">s</span> -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">a</span> -&gt; <span class="id">wt_stmt</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rt</span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4093')">Proof.</div>
<div class="proofscript" id="proof4093">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">monadInv</span> <span class="id">H</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">sswitch_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">a</span> <span class="id">sl</span> <span class="id">s</span>, <span class="id">sswitch</span> <span class="id">a</span> <span class="id">sl</span> = <span class="id">OK</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">a</span> -&gt; <span class="id">wt_lblstmts</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rt</span> <span class="id">sl</span> -&gt; <span class="id">wt_stmt</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rt</span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4094')">Proof.</div>
<div class="proofscript" id="proof4094">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">monadInv</span> <span class="id">H</span>. <span class="tactic">destruct</span> (<span class="id">typeof</span> <span class="id">a</span>) <span class="id">eqn</span>:<span class="id">TA</span>; <span class="id">inv</span> <span class="id">EQ0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">wt_Sswitch</span> <span class="kwd">with</span> (<span class="id">sz</span> := <span class="id">I32</span>); <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">retype_expr_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">a</span> <span class="id">a</span>', <span class="id">retype_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">a</span> = <span class="id">OK</span> <span class="id">a</span>' -&gt; <span class="id">wt_expr</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">a</span>'<br/>
<span class="kwd">with</span> <span class="id">retype_exprlist_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">al</span> <span class="id">al</span>', <span class="id">retype_exprlist</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">al</span> = <span class="id">OK</span> <span class="id">al</span>' -&gt; <span class="id">wt_exprlist</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">al</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4095')">Proof.</div>
<div class="proofscript" id="proof4095">
- <span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span> <span class="id">a</span>' <span class="id">RT</span>; <span class="tactic">try</span> (<span class="id">monadInv</span> <span class="id">RT</span>).<br/>
+ <span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">ty</span>; <span class="id">inv</span> <span class="id">RT</span>. <span class="tactic">apply</span> <span class="id">econst_int_sound</span>. <span class="tactic">apply</span> <span class="id">econst_ptr_int_sound</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">ty</span>; <span class="id">inv</span> <span class="id">RT</span>. <span class="tactic">apply</span> <span class="id">econst_long_sound</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">RT</span>. <span class="tactic">apply</span> <span class="id">econst_float_sound</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">RT</span>. <span class="tactic">apply</span> <span class="id">econst_single_sound</span>.<br/>
+ <span class="tactic">eapply</span> <span class="id">evar_sound</span>; <span class="tactic">eauto</span>.<br/>
+ <span class="tactic">eapply</span> <span class="id">efield_sound</span>; <span class="tactic">eauto</span>.<br/>
+ <span class="tactic">eapply</span> <span class="id">evalof_sound</span>; <span class="tactic">eauto</span>.<br/>
+ <span class="tactic">eapply</span> <span class="id">ederef_sound</span>; <span class="tactic">eauto</span>.<br/>
+ <span class="tactic">eapply</span> <span class="id">eaddrof_sound</span>; <span class="tactic">eauto</span>.<br/>
+ <span class="tactic">eapply</span> <span class="id">eunop_sound</span>; <span class="tactic">eauto</span>.<br/>
+ <span class="tactic">eapply</span> <span class="id">ebinop_sound</span>; <span class="tactic">eauto</span>.<br/>
+ <span class="tactic">eapply</span> <span class="id">ecast_sound</span>; <span class="tactic">eauto</span>.<br/>
+ <span class="tactic">eapply</span> <span class="id">eseqand_sound</span>; <span class="tactic">eauto</span>.<br/>
+ <span class="tactic">eapply</span> <span class="id">eseqor_sound</span>; <span class="tactic">eauto</span>.<br/>
+ <span class="tactic">eapply</span> <span class="id">econdition_sound</span>; <span class="tactic">eauto</span>.<br/>
+ <span class="tactic">apply</span> <span class="id">esizeof_sound</span>.<br/>
+ <span class="tactic">apply</span> <span class="id">ealignof_sound</span>.<br/>
+ <span class="tactic">eapply</span> <span class="id">eassign_sound</span>; <span class="tactic">eauto</span>.<br/>
+ <span class="tactic">eapply</span> <span class="id">eassignop_sound</span>; <span class="tactic">eauto</span>.<br/>
+ <span class="tactic">eapply</span> <span class="id">epostincrdecr_sound</span>; <span class="tactic">eauto</span>.<br/>
+ <span class="tactic">eapply</span> <span class="id">ecomma_sound</span>; <span class="tactic">eauto</span>.<br/>
+ <span class="tactic">eapply</span> <span class="id">ecall_sound</span>; <span class="tactic">eauto</span>.<br/>
+ <span class="tactic">eapply</span> <span class="id">ebuiltin_sound</span>; <span class="tactic">eauto</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">al</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span> <span class="id">al</span>' <span class="id">RT</span>; <span class="id">monadInv</span> <span class="id">RT</span>.<br/>
+ <span class="id">constructor</span>.<br/>
+ <span class="id">constructor</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">retype_stmt_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">s</span>', <span class="id">retype_stmt</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rt</span> <span class="id">s</span> = <span class="id">OK</span> <span class="id">s</span>' -&gt; <span class="id">wt_stmt</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rt</span> <span class="id">s</span>'<br/>
<span class="kwd">with</span> <span class="id">retype_lblstmts_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sl</span> <span class="id">sl</span>', <span class="id">retype_lblstmts</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rt</span> <span class="id">sl</span> = <span class="id">OK</span> <span class="id">sl</span>' -&gt; <span class="id">wt_lblstmts</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rt</span> <span class="id">sl</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4096')">Proof.</div>
<div class="proofscript" id="proof4096">
- <span class="tactic">destruct</span> <span class="id">s</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span> <span class="id">s</span>' <span class="id">RT</span>; <span class="tactic">try</span> (<span class="id">monadInv</span> <span class="id">RT</span>).<br/>
+ <span class="id">constructor</span>.<br/>
+ <span class="tactic">eapply</span> <span class="id">sdo_sound</span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id">retype_expr_sound</span>.<br/>
+ <span class="id">constructor</span>; <span class="tactic">eauto</span>.<br/>
+ <span class="tactic">eapply</span> <span class="id">sifthenelse_sound</span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id">retype_expr_sound</span>.<br/>
+ <span class="tactic">eapply</span> <span class="id">swhile_sound</span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id">retype_expr_sound</span>.<br/>
+ <span class="tactic">eapply</span> <span class="id">sdowhile_sound</span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id">retype_expr_sound</span>.<br/>
+ <span class="tactic">eapply</span> <span class="id">sfor_sound</span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id">retype_expr_sound</span>.<br/>
+ <span class="id">constructor</span>.<br/>
+ <span class="id">constructor</span>.<br/>
+ <span class="tactic">destruct</span> <span class="id">o</span>; <span class="id">monadInv</span> <span class="id">RT</span>. <span class="tactic">eapply</span> <span class="id">sreturn_sound</span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id">retype_expr_sound</span>. <span class="id">constructor</span>.<br/>
+ <span class="tactic">eapply</span> <span class="id">sswitch_sound</span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id">retype_expr_sound</span>.<br/>
+ <span class="id">constructor</span>; <span class="tactic">eauto</span>.<br/>
+ <span class="id">constructor</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">sl</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span> <span class="id">sl</span>' <span class="id">RT</span>; <span class="id">monadInv</span> <span class="id">RT</span>.<br/>
+ <span class="id">constructor</span>.<br/>
+ <span class="id">constructor</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">SOUNDNESS_CONSTRUCTORS</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">retype_function_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">f</span> <span class="id">f</span>', <span class="id">retype_function</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">f</span> = <span class="id">OK</span> <span class="id">f</span>' -&gt; <span class="id">wt_function</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">f</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4097')">Proof.</div>
<div class="proofscript" id="proof4097">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">monadInv</span> <span class="id">H</span>. <span class="id">constructor</span>; <span class="tactic">simpl</span>. <span class="tactic">eapply</span> <span class="id">retype_stmt_sound</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id">typecheck_program_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">p</span> <span class="id">p</span>', <span class="id">typecheck_program</span> <span class="id">p</span> = <span class="id">OK</span> <span class="id">p</span>' -&gt; <span class="id">wt_program</span> <span class="id">p</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4098')">Proof.</div>
<div class="proofscript" id="proof4098">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">typecheck_program</span>; <span class="tactic">intros</span>. <span class="id">monadInv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">x</span> <span class="id">into</span> <span class="id">tp</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">ce</span> := <span class="id">prog_comp_env</span> <span class="id">p</span>) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">e</span> := <span class="id">bind_globdef</span> (<span class="id">PTree.empty</span> <span class="id">type</span>) (<span class="id">prog_defs</span> <span class="id">p</span>)) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">e</span>' := <span class="id">bind_globdef</span> (<span class="id">PTree.empty</span> <span class="id">type</span>) (<span class="id">AST.prog_defs</span> <span class="id">tp</span>)) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">M</span>: <span class="id">match_program</span> (<span class="kwd">fun</span> <span class="id">ctx</span> <span class="id">f</span> <span class="id">tf</span> =&gt; <span class="id">retype_fundef</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">f</span> = <span class="id">OK</span> <span class="id">tf</span>) <span class="id">eq</span> <span class="id">p</span> <span class="id">tp</span>)<br/>
&nbsp;&nbsp;<span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id">match_transform_partial_program</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">M</span> <span class="kwd">as</span> (<span class="id">MATCH</span> &amp; <span class="id">_</span>). <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">MATCH</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">ENVS</span>: <span class="id">e</span>' = <span class="id">e</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id">e</span>, <span class="id">e</span>'. <span class="id">revert</span> <span class="id">MATCH</span>; <span class="tactic">generalize</span> (<span class="id">prog_defs</span> <span class="id">p</span>) (<span class="id">AST.prog_defs</span> <span class="id">tp</span>) (<span class="id">PTree.empty</span> <span class="id">type</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span> <span class="kwd">as</span> [ | [<span class="id">id</span> <span class="id">gd</span>] <span class="id">l</span> ]; <span class="tactic">intros</span> <span class="id">l</span>' <span class="id">t</span> <span class="id">M</span>; <span class="id">inv</span> <span class="id">M</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">b1</span> <span class="kwd">as</span> [<span class="id">id</span>' <span class="id">gd</span>']; <span class="tactic">destruct</span> <span class="id">H1</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">H0</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">type_of_fundef</span> <span class="id">f2</span>) <span class="kwd">with</span> (<span class="id">type_of_fundef</span> <span class="id">f1</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">retype_fundef</span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="tactic">destruct</span> <span class="id">f1</span>; <span class="id">monadInv</span> <span class="id">H2</span>; <span class="tactic">auto</span>. <span class="id">monadInv</span> <span class="id">EQ0</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>. <span class="tactic">simpl</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">ENVS</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">id</span> <span class="id">f</span>. <span class="id">revert</span> <span class="id">MATCH</span>; <span class="tactic">generalize</span> (<span class="id">prog_defs</span> <span class="id">p</span>) (<span class="id">AST.prog_defs</span> <span class="id">tp</span>).<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span>; <span class="tactic">auto</span>. <span class="tactic">subst</span> <span class="id">b1</span>; <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="id">inv</span> <span class="id">H1</span>. <br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">f1</span>; <span class="id">monadInv</span> <span class="id">H4</span>. <span class="tactic">eapply</span> <span class="id">retype_function_sound</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<h1> Subject reduction </h1>
<br/>
<div class="doc">We show that reductions preserve well-typedness </div>
<br/>
<span class="kwd">Lemma</span> <span class="id">pres_cast_int_int</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sz</span> <span class="id">sg</span> <span class="id">n</span>, <span class="id">wt_int</span> (<span class="id">cast_int_int</span> <span class="id">sz</span> <span class="id">sg</span> <span class="id">n</span>) <span class="id">sz</span> <span class="id">sg</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4099')">Proof.</div>
<div class="proofscript" id="proof4099">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">cast_int_int</span>. <span class="tactic">destruct</span> <span class="id">sz</span>; <span class="tactic">simpl</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">sg</span>. <span class="tactic">apply</span> <span class="id">Int.sign_ext_idem</span>; <span class="tactic">omega</span>. <span class="tactic">apply</span> <span class="id">Int.zero_ext_idem</span>; <span class="tactic">omega</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">sg</span>. <span class="tactic">apply</span> <span class="id">Int.sign_ext_idem</span>; <span class="tactic">omega</span>. <span class="tactic">apply</span> <span class="id">Int.zero_ext_idem</span>; <span class="tactic">omega</span>.<br/>
- <span class="tactic">auto</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">Int.eq</span> <span class="id">n</span> <span class="id">Int.zero</span>); <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">wt_val_casted</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">ty</span>, <span class="id">val_casted</span> <span class="id">v</span> <span class="id">ty</span> -&gt; <span class="id">wt_val</span> <span class="id">v</span> <span class="id">ty</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4100')">Proof.</div>
<div class="proofscript" id="proof4100">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="id">constructor</span>; <span class="tactic">auto</span>. <br/>
- <span class="tactic">rewrite</span> &lt;- <span class="id">H</span>; <span class="tactic">apply</span> <span class="id">pres_cast_int_int</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">pres_sem_cast</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">v2</span> <span class="id">ty2</span> <span class="id">v1</span> <span class="id">ty1</span>, <span class="id">wt_val</span> <span class="id">v1</span> <span class="id">ty1</span> -&gt; <span class="id">sem_cast</span> <span class="id">v1</span> <span class="id">ty1</span> <span class="id">ty2</span> <span class="id">m</span> = <span class="id">Some</span> <span class="id">v2</span> -&gt; <span class="id">wt_val</span> <span class="id">v2</span> <span class="id">ty2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4101')">Proof.</div>
<div class="proofscript" id="proof4101">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">wt_val_casted</span>. <span class="tactic">eapply</span> <span class="id">cast_val_is_casted</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">pres_sem_binarith</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">sem_int</span>: <span class="id">signedness</span> -&gt; <span class="id">int</span> -&gt; <span class="id">int</span> -&gt; <span class="id">option</span> <span class="id">val</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">sem_long</span>: <span class="id">signedness</span> -&gt; <span class="id">int64</span> -&gt; <span class="id">int64</span> -&gt; <span class="id">option</span> <span class="id">val</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">sem_float</span>: <span class="id">float</span> -&gt; <span class="id">float</span> -&gt; <span class="id">option</span> <span class="id">val</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">sem_single</span>: <span class="id">float32</span> -&gt; <span class="id">float32</span> -&gt; <span class="id">option</span> <span class="id">val</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">v1</span> <span class="id">ty1</span> <span class="id">v2</span> <span class="id">ty2</span> <span class="id">m</span> <span class="id">v</span> <span class="id">ty</span> <span class="id">msg</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">sg</span> <span class="id">n1</span> <span class="id">n2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">sem_int</span> <span class="id">sg</span> <span class="id">n1</span> <span class="id">n2</span> <span class="kwd">with</span> <span class="id">None</span> | <span class="id">Some</span> (<span class="id">Vint</span> <span class="id">_</span>) | <span class="id">Some</span> <span class="id">Vundef</span> =&gt; <span class="id">True</span> | <span class="id">_</span> =&gt; <span class="id">False</span> <span class="kwd">end</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">sg</span> <span class="id">n1</span> <span class="id">n2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">sem_long</span> <span class="id">sg</span> <span class="id">n1</span> <span class="id">n2</span> <span class="kwd">with</span> <span class="id">None</span> | <span class="id">Some</span> (<span class="id">Vlong</span> <span class="id">_</span>) | <span class="id">Some</span> <span class="id">Vundef</span> =&gt; <span class="id">True</span> | <span class="id">_</span> =&gt; <span class="id">False</span> <span class="kwd">end</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">n1</span> <span class="id">n2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">sem_float</span> <span class="id">n1</span> <span class="id">n2</span> <span class="kwd">with</span> <span class="id">None</span> | <span class="id">Some</span> (<span class="id">Vfloat</span> <span class="id">_</span>) | <span class="id">Some</span> <span class="id">Vundef</span> =&gt; <span class="id">True</span> | <span class="id">_</span> =&gt; <span class="id">False</span> <span class="kwd">end</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">n1</span> <span class="id">n2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">sem_single</span> <span class="id">n1</span> <span class="id">n2</span> <span class="kwd">with</span> <span class="id">None</span> | <span class="id">Some</span> (<span class="id">Vsingle</span> <span class="id">_</span>) | <span class="id">Some</span> <span class="id">Vundef</span> =&gt; <span class="id">True</span> | <span class="id">_</span> =&gt; <span class="id">False</span> <span class="kwd">end</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sem_binarith</span> <span class="id">sem_int</span> <span class="id">sem_long</span> <span class="id">sem_float</span> <span class="id">sem_single</span> <span class="id">v1</span> <span class="id">ty1</span> <span class="id">v2</span> <span class="id">ty2</span> <span class="id">m</span> = <span class="id">Some</span> <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">binarith_type</span> <span class="id">ty1</span> <span class="id">ty2</span> <span class="id">msg</span> = <span class="id">OK</span> <span class="id">ty</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_val</span> <span class="id">v</span> <span class="id">ty</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4102')">Proof with</div>
<div class="proofscript" id="proof4102">
 (<span class="tactic">try</span> <span class="tactic">discriminate</span>).<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">sem_binarith</span>, <span class="id">binarith_type</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">ty</span>' := <span class="id">Cop.binarith_type</span> (<span class="id">classify_binarith</span> <span class="id">ty1</span> <span class="id">ty2</span>)) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">sem_cast</span> <span class="id">v1</span> <span class="id">ty1</span> <span class="id">ty</span>' <span class="id">m</span>) <span class="kwd">as</span> [<span class="id">v1</span>'|] <span class="id">eqn</span>:<span class="id">CAST1</span>...<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">sem_cast</span> <span class="id">v2</span> <span class="id">ty2</span> <span class="id">ty</span>' <span class="id">m</span>) <span class="kwd">as</span> [<span class="id">v2</span>'|] <span class="id">eqn</span>:<span class="id">CAST2</span>...<br/>
&nbsp;&nbsp;<span class="id">DestructCases</span>.<br/>
- <span class="id">specialize</span> (<span class="id">H</span> <span class="id">s</span> <span class="id">i</span> <span class="id">i0</span>). <span class="tactic">rewrite</span> <span class="id">H3</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>; <span class="id">contradiction</span>.<br/>
- <span class="id">specialize</span> (<span class="id">H0</span> <span class="id">s</span> <span class="id">i</span> <span class="id">i0</span>). <span class="tactic">rewrite</span> <span class="id">H3</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>; <span class="id">contradiction</span>.<br/>
- <span class="id">specialize</span> (<span class="id">H1</span> <span class="id">f</span> <span class="id">f0</span>). <span class="tactic">rewrite</span> <span class="id">H3</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>; <span class="id">contradiction</span>.<br/>
- <span class="id">specialize</span> (<span class="id">H2</span> <span class="id">f</span> <span class="id">f0</span>). <span class="tactic">rewrite</span> <span class="id">H3</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>; <span class="id">contradiction</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">pres_sem_binarith_int</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">sem_int</span>: <span class="id">signedness</span> -&gt; <span class="id">int</span> -&gt; <span class="id">int</span> -&gt; <span class="id">option</span> <span class="id">val</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">sem_long</span>: <span class="id">signedness</span> -&gt; <span class="id">int64</span> -&gt; <span class="id">int64</span> -&gt; <span class="id">option</span> <span class="id">val</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">v1</span> <span class="id">ty1</span> <span class="id">v2</span> <span class="id">ty2</span> <span class="id">m</span> <span class="id">v</span> <span class="id">ty</span> <span class="id">msg</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">sg</span> <span class="id">n1</span> <span class="id">n2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">sem_int</span> <span class="id">sg</span> <span class="id">n1</span> <span class="id">n2</span> <span class="kwd">with</span> <span class="id">None</span> | <span class="id">Some</span> (<span class="id">Vint</span> <span class="id">_</span>) | <span class="id">Some</span> <span class="id">Vundef</span> =&gt; <span class="id">True</span> | <span class="id">_</span> =&gt; <span class="id">False</span> <span class="kwd">end</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">sg</span> <span class="id">n1</span> <span class="id">n2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">sem_long</span> <span class="id">sg</span> <span class="id">n1</span> <span class="id">n2</span> <span class="kwd">with</span> <span class="id">None</span> | <span class="id">Some</span> (<span class="id">Vlong</span> <span class="id">_</span>) | <span class="id">Some</span> <span class="id">Vundef</span> =&gt; <span class="id">True</span> | <span class="id">_</span> =&gt; <span class="id">False</span> <span class="kwd">end</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sem_binarith</span> <span class="id">sem_int</span> <span class="id">sem_long</span> (<span class="kwd">fun</span> <span class="id">n1</span> <span class="id">n2</span> =&gt; <span class="id">None</span>) (<span class="kwd">fun</span> <span class="id">n1</span> <span class="id">n2</span> =&gt; <span class="id">None</span>) <span class="id">v1</span> <span class="id">ty1</span> <span class="id">v2</span> <span class="id">ty2</span> <span class="id">m</span> = <span class="id">Some</span> <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">binarith_int_type</span> <span class="id">ty1</span> <span class="id">ty2</span> <span class="id">msg</span> = <span class="id">OK</span> <span class="id">ty</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_val</span> <span class="id">v</span> <span class="id">ty</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4103')">Proof.</div>
<div class="proofscript" id="proof4103">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id">pres_sem_binarith</span> <span class="kwd">with</span> (<span class="id">msg</span> := <span class="id">msg</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">auto</span>. <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">binarith_int_type</span>, <span class="id">binarith_type</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">classify_binarith</span> <span class="id">ty1</span> <span class="id">ty2</span>); <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">pres_sem_shift</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sem_int</span> <span class="id">sem_long</span> <span class="id">ty1</span> <span class="id">ty2</span> <span class="id">m</span> <span class="id">ty</span> <span class="id">v1</span> <span class="id">v2</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;<span class="id">shift_op_type</span> <span class="id">ty1</span> <span class="id">ty2</span> <span class="id">m</span> = <span class="id">OK</span> <span class="id">ty</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">sem_shift</span> <span class="id">sem_int</span> <span class="id">sem_long</span> <span class="id">v1</span> <span class="id">ty1</span> <span class="id">v2</span> <span class="id">ty2</span> = <span class="id">Some</span> <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">wt_val</span> <span class="id">v</span> <span class="id">ty</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4104')">Proof.</div>
<div class="proofscript" id="proof4104">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">shift_op_type</span>, <span class="id">sem_shift</span> <span class="kwd">in</span> *. <span class="id">DestructCases</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">pres_sem_cmp</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ty1</span> <span class="id">ty2</span> <span class="id">msg</span> <span class="id">ty</span> <span class="id">c</span> <span class="id">v1</span> <span class="id">v2</span> <span class="id">m</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;<span class="id">comparison_type</span> <span class="id">ty1</span> <span class="id">ty2</span> <span class="id">msg</span> = <span class="id">OK</span> <span class="id">ty</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">sem_cmp</span> <span class="id">c</span> <span class="id">v1</span> <span class="id">ty1</span> <span class="id">v2</span> <span class="id">ty2</span> <span class="id">m</span> = <span class="id">Some</span> <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">wt_val</span> <span class="id">v</span> <span class="id">ty</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4105')">Proof with</div>
<div class="proofscript" id="proof4105">
 (<span class="tactic">try</span> <span class="tactic">discriminate</span>).<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">comparison_type</span>, <span class="id">sem_cmp</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">X</span>: <span class="kwd">forall</span> <span class="id">b</span>, <span class="id">wt_val</span> (<span class="id">Val.of_bool</span> <span class="id">b</span>) (<span class="id">Tint</span> <span class="id">I32</span> <span class="id">Signed</span> <span class="id">noattr</span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">b</span>; <span class="tactic">destruct</span> <span class="id">b</span>; <span class="id">constructor</span>; <span class="tactic">exact</span> <span class="id">I</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Y</span>: <span class="kwd">forall</span> <span class="id">ob</span>, <span class="id">option_map</span> <span class="id">Val.of_bool</span> <span class="id">ob</span> = <span class="id">Some</span> <span class="id">v</span> -&gt; <span class="id">wt_val</span> <span class="id">v</span> (<span class="id">Tint</span> <span class="id">I32</span> <span class="id">Signed</span> <span class="id">noattr</span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">ob</span> <span class="id">EQ</span>. <span class="tactic">destruct</span> <span class="id">ob</span> <span class="kwd">as</span> [<span class="id">b</span>|]; <span class="id">inv</span> <span class="id">EQ</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">classify_cmp</span> <span class="id">ty1</span> <span class="id">ty2</span>).<br/>
- <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
- <span class="id">DestructCases</span>; <span class="tactic">eauto</span>.<br/>
- <span class="id">DestructCases</span>; <span class="tactic">eauto</span>.<br/>
- <span class="id">DestructCases</span>; <span class="tactic">eauto</span>.<br/>
- <span class="id">DestructCases</span>; <span class="tactic">eauto</span>.<br/>
- <span class="tactic">unfold</span> <span class="id">sem_binarith</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">ty</span>' := <span class="id">Cop.binarith_type</span> (<span class="id">classify_binarith</span> <span class="id">ty1</span> <span class="id">ty2</span>)) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">sem_cast</span> <span class="id">v1</span> <span class="id">ty1</span> <span class="id">ty</span>') <span class="kwd">as</span> [<span class="id">v1</span>'|]...<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">sem_cast</span> <span class="id">v2</span> <span class="id">ty2</span> <span class="id">ty</span>') <span class="kwd">as</span> [<span class="id">v2</span>'|]...<br/>
&nbsp;&nbsp;<span class="id">DestructCases</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">pres_sem_binop</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ce</span> <span class="id">op</span> <span class="id">ty1</span> <span class="id">ty2</span> <span class="id">ty</span> <span class="id">v1</span> <span class="id">v2</span> <span class="id">v</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;<span class="id">type_binop</span> <span class="id">op</span> <span class="id">ty1</span> <span class="id">ty2</span> = <span class="id">OK</span> <span class="id">ty</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">sem_binary_operation</span> <span class="id">ce</span> <span class="id">op</span> <span class="id">v1</span> <span class="id">ty1</span> <span class="id">v2</span> <span class="id">ty2</span> <span class="id">m</span> = <span class="id">Some</span> <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">wt_val</span> <span class="id">v1</span> <span class="id">ty1</span> -&gt; <span class="id">wt_val</span> <span class="id">v2</span> <span class="id">ty2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">wt_val</span> <span class="id">v</span> <span class="id">ty</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4106')">Proof.</div>
<div class="proofscript" id="proof4106">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">m</span>; <span class="tactic">intros</span> <span class="id">TY</span> <span class="id">SEM</span> <span class="id">WT1</span> <span class="id">WT2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">op</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">TY</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">SEM</span>.<br/>
- <span class="comment">(*&nbsp;add&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">sem_add</span>, <span class="id">sem_add_ptr_int</span>, <span class="id">sem_add_ptr_long</span> <span class="kwd">in</span> <span class="id">SEM</span>; <span class="id">DestructCases</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">pres_sem_binarith</span>; <span class="tactic">eauto</span>; <span class="tactic">intros</span>; <span class="tactic">exact</span> <span class="id">I</span>.<br/>
- <span class="comment">(*&nbsp;sub&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">sem_sub</span> <span class="kwd">in</span> <span class="id">SEM</span>; <span class="id">DestructCases</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">ptrdiff_t</span>, <span class="id">Vptrofs</span>. <span class="tactic">destruct</span> <span class="id">Archi.ptr64</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">pres_sem_binarith</span>; <span class="tactic">eauto</span>; <span class="tactic">intros</span>; <span class="tactic">exact</span> <span class="id">I</span>.<br/>
- <span class="comment">(*&nbsp;mul&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">sem_mul</span> <span class="kwd">in</span> <span class="id">SEM</span>. <span class="tactic">eapply</span> <span class="id">pres_sem_binarith</span>; <span class="tactic">eauto</span>; <span class="tactic">intros</span>; <span class="tactic">exact</span> <span class="id">I</span>.<br/>
- <span class="comment">(*&nbsp;div&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">sem_div</span> <span class="kwd">in</span> <span class="id">SEM</span>. <span class="tactic">eapply</span> <span class="id">pres_sem_binarith</span>; <span class="tactic">eauto</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="id">DestructMatch</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="id">DestructMatch</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="id">DestructMatch</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="id">DestructMatch</span>; <span class="tactic">auto</span>.<br/>
- <span class="comment">(*&nbsp;mod&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">sem_mod</span> <span class="kwd">in</span> <span class="id">SEM</span>. <span class="tactic">eapply</span> <span class="id">pres_sem_binarith_int</span>; <span class="tactic">eauto</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="id">DestructMatch</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="id">DestructMatch</span>; <span class="tactic">auto</span>.<br/>
- <span class="comment">(*&nbsp;and&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">sem_and</span> <span class="kwd">in</span> <span class="id">SEM</span>. <span class="tactic">eapply</span> <span class="id">pres_sem_binarith_int</span>; <span class="tactic">eauto</span>; <span class="tactic">intros</span>; <span class="tactic">exact</span> <span class="id">I</span>.<br/>
- <span class="comment">(*&nbsp;or&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">sem_or</span> <span class="kwd">in</span> <span class="id">SEM</span>. <span class="tactic">eapply</span> <span class="id">pres_sem_binarith_int</span>; <span class="tactic">eauto</span>; <span class="tactic">intros</span>; <span class="tactic">exact</span> <span class="id">I</span>.<br/>
- <span class="comment">(*&nbsp;xor&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">sem_xor</span> <span class="kwd">in</span> <span class="id">SEM</span>. <span class="tactic">eapply</span> <span class="id">pres_sem_binarith_int</span>; <span class="tactic">eauto</span>; <span class="tactic">intros</span>; <span class="tactic">exact</span> <span class="id">I</span>.<br/>
- <span class="comment">(*&nbsp;shl&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">sem_shl</span> <span class="kwd">in</span> <span class="id">SEM</span>. <span class="tactic">eapply</span> <span class="id">pres_sem_shift</span>; <span class="tactic">eauto</span>.<br/>
- <span class="comment">(*&nbsp;shr&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">sem_shr</span> <span class="kwd">in</span> <span class="id">SEM</span>. <span class="tactic">eapply</span> <span class="id">pres_sem_shift</span>; <span class="tactic">eauto</span>.<br/>
- <span class="comment">(*&nbsp;comparisons&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">pres_sem_cmp</span>; <span class="tactic">eauto</span>.<br/>
- <span class="tactic">eapply</span> <span class="id">pres_sem_cmp</span>; <span class="tactic">eauto</span>.<br/>
- <span class="tactic">eapply</span> <span class="id">pres_sem_cmp</span>; <span class="tactic">eauto</span>.<br/>
- <span class="tactic">eapply</span> <span class="id">pres_sem_cmp</span>; <span class="tactic">eauto</span>.<br/>
- <span class="tactic">eapply</span> <span class="id">pres_sem_cmp</span>; <span class="tactic">eauto</span>.<br/>
- <span class="tactic">eapply</span> <span class="id">pres_sem_cmp</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">pres_sem_unop</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">op</span> <span class="id">ty1</span> <span class="id">ty</span> <span class="id">v1</span> <span class="id">m</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;<span class="id">type_unop</span> <span class="id">op</span> <span class="id">ty1</span> = <span class="id">OK</span> <span class="id">ty</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">sem_unary_operation</span> <span class="id">op</span> <span class="id">v1</span> <span class="id">ty1</span> <span class="id">m</span> = <span class="id">Some</span> <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">wt_val</span> <span class="id">v1</span> <span class="id">ty1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">wt_val</span> <span class="id">v</span> <span class="id">ty</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4107')">Proof.</div>
<div class="proofscript" id="proof4107">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">v</span>; <span class="tactic">intros</span> <span class="id">TY</span> <span class="id">SEM</span> <span class="id">WT1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">op</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">TY</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">SEM</span>.<br/>
- <span class="comment">(*&nbsp;notbool&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">sem_notbool</span> <span class="kwd">in</span> <span class="id">SEM</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">A</span>: <span class="id">ty</span> = <span class="id">Tint</span> <span class="id">I32</span> <span class="id">Signed</span> <span class="id">noattr</span>) <span class="tactic">by</span> (<span class="tactic">destruct</span> (<span class="id">classify_bool</span> <span class="id">ty1</span>); <span class="id">inv</span> <span class="id">TY</span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">B</span>: <span class="id">exists</span> <span class="id">b</span>, <span class="id">v</span> = <span class="id">Val.of_bool</span> <span class="id">b</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">destruct</span> (<span class="id">bool_val</span> <span class="id">v1</span> <span class="id">ty1</span> <span class="id">m</span>); <span class="id">inv</span> <span class="id">SEM</span>. <span class="id">exists</span> (<span class="id">negb</span> <span class="id">b</span>); <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">B</span> <span class="kwd">as</span> [<span class="id">b</span> <span class="id">B</span>].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">A</span>, <span class="id">B</span>. <span class="tactic">destruct</span> <span class="id">b</span>; <span class="id">constructor</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="comment">(*&nbsp;notint&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">sem_notint</span> <span class="kwd">in</span> <span class="id">SEM</span>; <span class="id">DestructCases</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="comment">(*&nbsp;neg&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">sem_neg</span> <span class="kwd">in</span> <span class="id">SEM</span>; <span class="id">DestructCases</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="comment">(*&nbsp;absfloat&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">sem_absfloat</span> <span class="kwd">in</span> <span class="id">SEM</span>; <span class="id">DestructCases</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">wt_load_result</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ty</span> <span class="id">chunk</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;<span class="id">access_mode</span> <span class="id">ty</span> = <span class="id">By_value</span> <span class="id">chunk</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">wt_val</span> (<span class="id">Val.load_result</span> <span class="id">chunk</span> <span class="id">v</span>) <span class="id">ty</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4108')">Proof.</div>
<div class="proofscript" id="proof4108">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">access_mode</span>, <span class="id">Val.load_result</span>. <span class="id">remember</span> <span class="id">Archi.ptr64</span> <span class="kwd">as</span> <span class="id">ptr64</span>. <br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">v</span>; <span class="tactic">intros</span> <span class="id">AC</span>. <span class="tactic">destruct</span> <span class="id">ty</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">AC</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span> <span class="id">AC</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">i</span>; [<span class="tactic">destruct</span> <span class="id">s</span>|<span class="tactic">destruct</span> <span class="id">s</span>|<span class="id">idtac</span>|<span class="id">idtac</span>]; <span class="id">inv</span> <span class="id">AC</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>. <span class="id">constructor</span>; <span class="tactic">red</span>. <span class="tactic">apply</span> <span class="id">Int.sign_ext_idem</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>. <span class="id">constructor</span>; <span class="tactic">red</span>. <span class="tactic">apply</span> <span class="id">Int.zero_ext_idem</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>. <span class="id">constructor</span>; <span class="tactic">red</span>. <span class="tactic">apply</span> <span class="id">Int.sign_ext_idem</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>. <span class="id">constructor</span>; <span class="tactic">red</span>. <span class="tactic">apply</span> <span class="id">Int.zero_ext_idem</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Archi.ptr64</span> <span class="id">eqn</span>:<span class="id">SF</span>; <span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>. <span class="id">constructor</span>; <span class="tactic">red</span>. <span class="tactic">apply</span> <span class="id">Int.zero_ext_idem</span>; <span class="tactic">omega</span>.<br/>
- <span class="id">inv</span> <span class="id">AC</span>. <span class="tactic">destruct</span> <span class="id">Archi.ptr64</span> <span class="id">eqn</span>:<span class="id">SF</span>; <span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">f</span>; <span class="id">inv</span> <span class="id">AC</span>; <span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="id">inv</span> <span class="id">AC</span>. <span class="tactic">unfold</span> <span class="id">Mptr</span>. <span class="tactic">destruct</span> <span class="id">Archi.ptr64</span> <span class="id">eqn</span>:<span class="id">SF</span>; <span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">wt_decode_val</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ty</span> <span class="id">chunk</span> <span class="id">vl</span>,<br/>
&nbsp;&nbsp;<span class="id">access_mode</span> <span class="id">ty</span> = <span class="id">By_value</span> <span class="id">chunk</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">wt_val</span> (<span class="id">decode_val</span> <span class="id">chunk</span> <span class="id">vl</span>) <span class="id">ty</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4109')">Proof.</div>
<div class="proofscript" id="proof4109">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">vl</span>; <span class="tactic">intros</span> <span class="id">ACC</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">LR</span>: <span class="kwd">forall</span> <span class="id">v</span>, <span class="id">wt_val</span> (<span class="id">Val.load_result</span> <span class="id">chunk</span> <span class="id">v</span>) <span class="id">ty</span>) <span class="tactic">by</span> (<span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id">wt_load_result</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">ty</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">ACC</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>. <br/>
- <span class="tactic">destruct</span> <span class="id">i</span>; [<span class="tactic">destruct</span> <span class="id">s</span>|<span class="tactic">destruct</span> <span class="id">s</span>|<span class="id">idtac</span>|<span class="id">idtac</span>]; <span class="id">inv</span> <span class="id">ACC</span>; <span class="tactic">unfold</span> <span class="id">decode_val</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">proj_bytes</span> <span class="id">vl</span>); <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">red</span>. <span class="tactic">apply</span> <span class="id">Int.sign_ext_idem</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">proj_bytes</span> <span class="id">vl</span>); <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">red</span>. <span class="tactic">apply</span> <span class="id">Int.zero_ext_idem</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">proj_bytes</span> <span class="id">vl</span>); <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">red</span>. <span class="tactic">apply</span> <span class="id">Int.sign_ext_idem</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">proj_bytes</span> <span class="id">vl</span>); <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">red</span>. <span class="tactic">apply</span> <span class="id">Int.zero_ext_idem</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">proj_bytes</span> <span class="id">vl</span>). <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>. <span class="tactic">destruct</span> <span class="id">Archi.ptr64</span> <span class="id">eqn</span>:<span class="id">SF</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>. <br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">proj_bytes</span> <span class="id">vl</span>); <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">red</span>. <span class="tactic">apply</span> <span class="id">Int.zero_ext_idem</span>; <span class="tactic">omega</span>.<br/>
- <span class="id">inv</span> <span class="id">ACC</span>. <span class="tactic">unfold</span> <span class="id">decode_val</span>. <span class="tactic">destruct</span> (<span class="id">proj_bytes</span> <span class="id">vl</span>). <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Archi.ptr64</span> <span class="id">eqn</span>:<span class="id">SF</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>. <br/>
- <span class="tactic">destruct</span> <span class="id">f</span>; <span class="id">inv</span> <span class="id">ACC</span>; <span class="tactic">unfold</span> <span class="id">decode_val</span>; <span class="tactic">destruct</span> (<span class="id">proj_bytes</span> <span class="id">vl</span>); <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="id">inv</span> <span class="id">ACC</span>. <span class="tactic">unfold</span> <span class="id">decode_val</span>. <span class="tactic">destruct</span> (<span class="id">proj_bytes</span> <span class="id">vl</span>).<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Mptr</span> <span class="kwd">in</span> *. <span class="tactic">destruct</span> <span class="id">Archi.ptr64</span> <span class="id">eqn</span>:<span class="id">SF</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Mptr</span> <span class="kwd">in</span> *. <span class="tactic">destruct</span> <span class="id">Archi.ptr64</span> <span class="id">eqn</span>:<span class="id">SF</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">wt_deref_loc</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ge</span> <span class="id">ty</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">t</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;<span class="id">deref_loc</span> <span class="id">ge</span> <span class="id">ty</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">t</span> <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">wt_val</span> <span class="id">v</span> <span class="id">ty</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4110')">Proof.</div>
<div class="proofscript" id="proof4110">
&nbsp;&nbsp;<span class="tactic">induction</span> 1.<br/>
- <span class="comment">(*&nbsp;by&nbsp;value,&nbsp;non&nbsp;volatile&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="id">exploit</span> <span class="id">Mem.load_result</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> <span class="id">EQ</span>; <span class="tactic">rewrite</span> <span class="id">EQ</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">wt_decode_val</span>; <span class="tactic">auto</span>.<br/>
- <span class="comment">(*&nbsp;by&nbsp;value,&nbsp;volatile&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;truly&nbsp;volatile&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">wt_load_result</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;not&nbsp;really&nbsp;volatile&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Mem.load_result</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> <span class="id">EQ</span>; <span class="tactic">rewrite</span> <span class="id">EQ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">wt_decode_val</span>; <span class="tactic">auto</span>.<br/>
- <span class="comment">(*&nbsp;by&nbsp;reference&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">ty</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">i</span>; <span class="tactic">destruct</span> <span class="id">s</span>; <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">f</span>; <span class="tactic">discriminate</span>.<br/>
- <span class="comment">(*&nbsp;by&nbsp;copy&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">ty</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">i</span>; <span class="tactic">destruct</span> <span class="id">s</span>; <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">f</span>; <span class="tactic">discriminate</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">wt_bool_cast</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ty</span>, <span class="id">wt_bool</span> <span class="id">ty</span> -&gt; <span class="id">wt_cast</span> <span class="id">ty</span> <span class="id">type_bool</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4111')">Proof.</div>
<div class="proofscript" id="proof4111">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">wt_bool</span>, <span class="id">wt_cast</span>; <span class="tactic">unfold</span> <span class="id">classify_bool</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">ty</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>;<br/>
&nbsp;&nbsp;<span class="tactic">try</span> (<span class="tactic">destruct</span> <span class="id">Archi.ptr64</span>; <span class="tactic">congruence</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">f</span>; <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">wt_cast_self</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t1</span> <span class="id">t2</span>, <span class="id">wt_cast</span> <span class="id">t1</span> <span class="id">t2</span> -&gt; <span class="id">wt_cast</span> <span class="id">t2</span> <span class="id">t2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4112')">Proof.</div>
<div class="proofscript" id="proof4112">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">wt_cast</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">t2</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
- <span class="tactic">apply</span> (<span class="id">wt_cast_int</span> <span class="id">i</span> <span class="id">s</span> <span class="id">a</span> <span class="id">i</span> <span class="id">s</span> <span class="id">a</span>).<br/>
- <span class="tactic">destruct</span> <span class="id">Archi.ptr64</span>; <span class="tactic">congruence</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">f</span>; <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">binarith_type_int32s</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ty1</span> <span class="id">msg</span> <span class="id">ty2</span>,<br/>
&nbsp;&nbsp;<span class="id">binarith_type</span> <span class="id">ty1</span> <span class="id">type_int32s</span> <span class="id">msg</span> = <span class="id">OK</span> <span class="id">ty2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">ty2</span> = <span class="id">incrdecr_type</span> <span class="id">ty1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4113')">Proof.</div>
<div class="proofscript" id="proof4113">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">incrdecr_type</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">binarith_type</span>, <span class="id">classify_binarith</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">ty1</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">i</span>; <span class="tactic">destruct</span> <span class="id">s</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">s</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">f</span>; <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">type_add_int32s</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ty1</span> <span class="id">ty2</span>,<br/>
&nbsp;&nbsp;<span class="id">type_binop</span> <span class="id">Oadd</span> <span class="id">ty1</span> <span class="id">type_int32s</span> = <span class="id">OK</span> <span class="id">ty2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">ty2</span> = <span class="id">incrdecr_type</span> <span class="id">ty1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4114')">Proof.</div>
<div class="proofscript" id="proof4114">
&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">classify_add</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">destruct</span> <span class="id">ty1</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;<span class="tactic">try</span> (<span class="tactic">eapply</span> <span class="id">binarith_type_int32s</span>; <span class="tactic">eauto</span>; <span class="tactic">fail</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">i</span>; <span class="tactic">eapply</span> <span class="id">binarith_type_int32s</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">type_sub_int32s</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ty1</span> <span class="id">ty2</span>,<br/>
&nbsp;&nbsp;<span class="id">type_binop</span> <span class="id">Osub</span> <span class="id">ty1</span> <span class="id">type_int32s</span> = <span class="id">OK</span> <span class="id">ty2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">ty2</span> = <span class="id">incrdecr_type</span> <span class="id">ty1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4115')">Proof.</div>
<div class="proofscript" id="proof4115">
&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">classify_sub</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">destruct</span> <span class="id">ty1</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;<span class="tactic">try</span> (<span class="tactic">eapply</span> <span class="id">binarith_type_int32s</span>; <span class="tactic">eauto</span>; <span class="tactic">fail</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">i</span>; <span class="tactic">eapply</span> <span class="id">binarith_type_int32s</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">wt_rred</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ge</span> <span class="id">tenv</span> <span class="id">a</span> <span class="id">m</span> <span class="id">t</span> <span class="id">a</span>' <span class="id">m</span>',<br/>
&nbsp;&nbsp;<span class="id">rred</span> <span class="id">ge</span> <span class="id">a</span> <span class="id">m</span> <span class="id">t</span> <span class="id">a</span>' <span class="id">m</span>' -&gt; <span class="id">wt_rvalue</span> <span class="id">ge</span> <span class="id">tenv</span> <span class="id">a</span> -&gt; <span class="id">wt_rvalue</span> <span class="id">ge</span> <span class="id">tenv</span> <span class="id">a</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4116')">Proof.</div>
<div class="proofscript" id="proof4116">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">intros</span> <span class="id">WT</span>; <span class="tactic">inversion</span> <span class="id">WT</span>.<br/>
- <span class="comment">(*&nbsp;valof&nbsp;*)</span> <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">constructor</span>. <span class="tactic">eapply</span> <span class="id">wt_deref_loc</span>; <span class="tactic">eauto</span>.<br/>
- <span class="comment">(*&nbsp;addrof&nbsp;*)</span> <span class="id">constructor</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="comment">(*&nbsp;unop&nbsp;*)</span> <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H4</span>. <span class="id">inv</span> <span class="id">H2</span>. <span class="id">constructor</span>. <span class="tactic">eapply</span> <span class="id">pres_sem_unop</span>; <span class="tactic">eauto</span>.<br/>
- <span class="comment">(*&nbsp;binop&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H6</span>. <span class="id">inv</span> <span class="id">H3</span>. <span class="id">inv</span> <span class="id">H5</span>. <span class="id">constructor</span>. <span class="tactic">eapply</span> <span class="id">pres_sem_binop</span>; <span class="tactic">eauto</span>.<br/>
- <span class="comment">(*&nbsp;cast&nbsp;*)</span> <span class="id">inv</span> <span class="id">H2</span>. <span class="id">constructor</span>. <span class="tactic">eapply</span> <span class="id">pres_sem_cast</span>; <span class="tactic">eauto</span>.<br/>
- <span class="comment">(*&nbsp;sequand&nbsp;true&nbsp;*)</span> <span class="tactic">subst</span>. <span class="id">constructor</span>. <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">wt_bool_cast</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H0</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="comment">(*&nbsp;sequand&nbsp;false&nbsp;*)</span> <span class="id">constructor</span>. <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="comment">(*&nbsp;seqor&nbsp;true&nbsp;*)</span> <span class="id">constructor</span>. <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="comment">(*&nbsp;seqor&nbsp;false&nbsp;*)</span> <span class="tactic">subst</span>. <span class="id">constructor</span>. <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">wt_bool_cast</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H0</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="comment">(*&nbsp;condition&nbsp;*)</span> <span class="id">constructor</span>. <span class="tactic">destruct</span> <span class="id">b</span>; <span class="tactic">auto</span>. <span class="tactic">destruct</span> <span class="id">b</span>; <span class="tactic">auto</span>. <span class="tactic">red</span>; <span class="tactic">auto</span>.<br/>
- <span class="comment">(*&nbsp;sizeof&nbsp;*)</span>  <span class="tactic">unfold</span> <span class="id">size_t</span>, <span class="id">Vptrofs</span>; <span class="tactic">destruct</span> <span class="id">Archi.ptr64</span>; <span class="id">constructor</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="comment">(*&nbsp;alignof&nbsp;*)</span>  <span class="tactic">unfold</span> <span class="id">size_t</span>, <span class="id">Vptrofs</span>; <span class="tactic">destruct</span> <span class="id">Archi.ptr64</span>; <span class="id">constructor</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="comment">(*&nbsp;assign&nbsp;*)</span> <span class="tactic">inversion</span> <span class="id">H5</span>. <span class="id">constructor</span>. <span class="tactic">eapply</span> <span class="id">pres_sem_cast</span>; <span class="tactic">eauto</span>.<br/>
- <span class="comment">(*&nbsp;assignop&nbsp;*)</span> <span class="tactic">subst</span> <span class="id">tyres</span> <span class="id">l</span> <span class="id">r</span>. <span class="id">constructor</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>. <span class="id">constructor</span>. <span class="tactic">eapply</span> <span class="id">wt_deref_loc</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>. <span class="tactic">auto</span>. <span class="tactic">auto</span>.<br/>
- <span class="comment">(*&nbsp;postincr&nbsp;*)</span> <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">subst</span> <span class="id">id0</span> <span class="id">l</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">wt_deref_loc</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> <span class="id">WTV1</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>. <span class="tactic">auto</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H5</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">auto</span>. <span class="id">constructor</span>. <span class="id">constructor</span>. <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">op</span>. <span class="tactic">destruct</span> <span class="id">id</span>.<br/>
&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id">type_add_int32s</span> <span class="tactic">by</span> <span class="tactic">eauto</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id">type_sub_int32s</span> <span class="tactic">by</span> <span class="tactic">eauto</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
- <span class="comment">(*&nbsp;comma&nbsp;*)</span> <span class="tactic">auto</span>.<br/>
- <span class="comment">(*&nbsp;paren&nbsp;*)</span> <span class="id">inv</span> <span class="id">H3</span>. <span class="id">constructor</span>. <span class="tactic">apply</span> <span class="id">H5</span>. <span class="tactic">eapply</span> <span class="id">pres_sem_cast</span>; <span class="tactic">eauto</span>.<br/>
- <span class="comment">(*&nbsp;builtin&nbsp;*)</span> <span class="tactic">subst</span>. <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">wt_lred</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tenv</span> <span class="id">ge</span> <span class="id">e</span> <span class="id">a</span> <span class="id">m</span> <span class="id">a</span>' <span class="id">m</span>',<br/>
&nbsp;&nbsp;<span class="id">lred</span> <span class="id">ge</span> <span class="id">e</span> <span class="id">a</span> <span class="id">m</span> <span class="id">a</span>' <span class="id">m</span>' -&gt; <span class="id">wt_lvalue</span> <span class="id">ge</span> <span class="id">tenv</span> <span class="id">a</span> -&gt; <span class="id">wt_lvalue</span> <span class="id">ge</span> <span class="id">tenv</span> <span class="id">a</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4117')">Proof.</div>
<div class="proofscript" id="proof4117">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">intros</span> <span class="id">WT</span>; <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">rred_same_type</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ge</span> <span class="id">a</span> <span class="id">m</span> <span class="id">t</span> <span class="id">a</span>' <span class="id">m</span>',<br/>
&nbsp;&nbsp;<span class="id">rred</span> <span class="id">ge</span> <span class="id">a</span> <span class="id">m</span> <span class="id">t</span> <span class="id">a</span>' <span class="id">m</span>' -&gt; <span class="id">typeof</span> <span class="id">a</span>' = <span class="id">typeof</span> <span class="id">a</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4118')">Proof.</div>
<div class="proofscript" id="proof4118">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">lred_same_type</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ge</span> <span class="id">e</span> <span class="id">a</span> <span class="id">m</span> <span class="id">a</span>' <span class="id">m</span>',<br/>
&nbsp;&nbsp;<span class="id">lred</span> <span class="id">ge</span> <span class="id">e</span> <span class="id">a</span> <span class="id">m</span> <span class="id">a</span>' <span class="id">m</span>' -&gt; <span class="id">typeof</span> <span class="id">a</span>' = <span class="id">typeof</span> <span class="id">a</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4119')">Proof.</div>
<div class="proofscript" id="proof4119">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Section</span> <span class="id">WT_CONTEXT</span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id">cenv</span>: <span class="id">composite_env</span>.<br/>
<span class="kwd">Variable</span> <span class="id">tenv</span>: <span class="id">typenv</span>.<br/>
<span class="kwd">Variable</span> <span class="id">a</span> <span class="id">a</span>': <span class="id">expr</span>.<br/>
<span class="kwd">Hypothesis</span> <span class="id">SAMETY</span>: <span class="id">typeof</span> <span class="id">a</span>' = <span class="id">typeof</span> <span class="id">a</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">wt_subexpr</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">from</span> <span class="id">to</span> <span class="id">C</span>,<br/>
&nbsp;&nbsp;<span class="id">context</span> <span class="id">from</span> <span class="id">to</span> <span class="id">C</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">wt_expr_kind</span> <span class="id">cenv</span> <span class="id">tenv</span> <span class="id">to</span> (<span class="id">C</span> <span class="id">a</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">wt_expr_kind</span> <span class="id">cenv</span> <span class="id">tenv</span> <span class="id">from</span> <span class="id">a</span><br/>
<span class="kwd">with</span> <span class="id">wt_subexprlist</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">from</span> <span class="id">C</span>,<br/>
&nbsp;&nbsp;<span class="id">contextlist</span> <span class="id">from</span> <span class="id">C</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">wt_exprlist</span> <span class="id">cenv</span> <span class="id">tenv</span> (<span class="id">C</span> <span class="id">a</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">wt_expr_kind</span> <span class="id">cenv</span> <span class="id">tenv</span> <span class="id">from</span> <span class="id">a</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4120')">Proof.</div>
<div class="proofscript" id="proof4120">
&nbsp;&nbsp;<span class="tactic">destruct</span> 1; <span class="tactic">intros</span> <span class="id">WT</span>; <span class="tactic">auto</span>; <span class="id">inv</span> <span class="id">WT</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> 1; <span class="tactic">intros</span> <span class="id">WT</span>; <span class="id">inv</span> <span class="id">WT</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">typeof_context</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">from</span> <span class="id">to</span> <span class="id">C</span>, <span class="id">context</span> <span class="id">from</span> <span class="id">to</span> <span class="id">C</span> -&gt; <span class="id">typeof</span> (<span class="id">C</span> <span class="id">a</span>') = <span class="id">typeof</span> (<span class="id">C</span> <span class="id">a</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4121')">Proof.</div>
<div class="proofscript" id="proof4121">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">wt_arguments_context</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">k</span> <span class="id">C</span>, <span class="id">contextlist</span> <span class="id">k</span> <span class="id">C</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tyl</span>, <span class="id">wt_arguments</span> (<span class="id">C</span> <span class="id">a</span>) <span class="id">tyl</span> -&gt; <span class="id">wt_arguments</span> (<span class="id">C</span> <span class="id">a</span>') <span class="id">tyl</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4122')">Proof.</div>
<div class="proofscript" id="proof4122">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">intros</span>.<br/>
- <span class="id">inv</span> <span class="id">H0</span>. <span class="id">constructor</span>; <span class="tactic">auto</span>. <span class="tactic">rewrite</span> (<span class="id">typeof_context</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
- <span class="id">inv</span> <span class="id">H0</span>. <span class="id">constructor</span>; <span class="tactic">auto</span>. <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">wt_context</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">from</span> <span class="id">to</span> <span class="id">C</span>,<br/>
&nbsp;&nbsp;<span class="id">context</span> <span class="id">from</span> <span class="id">to</span> <span class="id">C</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">wt_expr_kind</span> <span class="id">cenv</span> <span class="id">tenv</span> <span class="id">to</span> (<span class="id">C</span> <span class="id">a</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">wt_expr_kind</span> <span class="id">cenv</span> <span class="id">tenv</span> <span class="id">from</span> <span class="id">a</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">wt_expr_kind</span> <span class="id">cenv</span> <span class="id">tenv</span> <span class="id">to</span> (<span class="id">C</span> <span class="id">a</span>')<br/>
<span class="kwd">with</span> <span class="id">wt_contextlist</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">from</span> <span class="id">C</span>,<br/>
&nbsp;&nbsp;<span class="id">contextlist</span> <span class="id">from</span> <span class="id">C</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">wt_exprlist</span> <span class="id">cenv</span> <span class="id">tenv</span> (<span class="id">C</span> <span class="id">a</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">wt_expr_kind</span> <span class="id">cenv</span> <span class="id">tenv</span> <span class="id">from</span> <span class="id">a</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">wt_exprlist</span> <span class="id">cenv</span> <span class="id">tenv</span> (<span class="id">C</span> <span class="id">a</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4123')">Proof.</div>
<div class="proofscript" id="proof4123">
- <span class="tactic">induction</span> 1; <span class="tactic">intros</span> <span class="id">WT</span> <span class="id">BASE</span>;<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">WT</span>;<br/>
&nbsp;&nbsp;<span class="tactic">try</span> (<span class="id">pose</span> (<span class="id">EQTY</span> := <span class="id">typeof_context</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span>); <span class="tactic">rewrite</span> &lt;- ? <span class="id">EQTY</span>; <span class="id">econstructor</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> (<span class="tactic">apply</span> <span class="id">IHcontext</span>; <span class="tactic">assumption</span>); <span class="tactic">rewrite</span> ? <span class="id">EQTY</span>; <span class="tactic">eauto</span>).<br/>
* <span class="tactic">red</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">wt_arguments_context</span>; <span class="tactic">eauto</span>.<br/>
* <span class="tactic">red</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">wt_arguments_context</span>; <span class="tactic">eauto</span>.<br/>
- <span class="tactic">induction</span> 1; <span class="tactic">intros</span> <span class="id">WT</span> <span class="id">BASE</span>.<br/>
* <span class="id">inv</span> <span class="id">WT</span>. <span class="id">constructor</span>. <span class="tactic">apply</span> (<span class="id">wt_context</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span>); <span class="tactic">auto</span>. <span class="tactic">auto</span>.<br/>
* <span class="id">inv</span> <span class="id">WT</span>. <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">WT_CONTEXT</span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id">WT_SWITCH</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">wt_select_switch</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rt</span> <span class="id">sl</span>,<br/>
&nbsp;&nbsp;<span class="id">wt_lblstmts</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rt</span> <span class="id">sl</span> -&gt; <span class="id">wt_lblstmts</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rt</span> (<span class="id">select_switch</span> <span class="id">n</span> <span class="id">sl</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4124')">Proof.</div>
<div class="proofscript" id="proof4124">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">select_switch</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">A</span>: <span class="id">wt_lblstmts</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rt</span> (<span class="id">select_switch_default</span> <span class="id">sl</span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">sl</span> <span class="id">H</span>. <span class="tactic">induction</span> 1; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="tactic">case</span>. <span class="tactic">auto</span>. <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">B</span>: <span class="kwd">forall</span> <span class="id">sl</span>', <span class="id">select_switch_case</span> <span class="id">n</span> <span class="id">sl</span> = <span class="id">Some</span> <span class="id">sl</span>' -&gt; <span class="id">wt_lblstmts</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rt</span> <span class="id">sl</span>').<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H</span>. <span class="tactic">generalize</span> <span class="id">sl</span>. <span class="tactic">induction</span> 1; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="tactic">case</span>; <span class="tactic">eauto</span>. <span class="tactic">destruct</span> (<span class="id">zeq</span> <span class="id">z</span> <span class="id">n</span>); <span class="tactic">eauto</span>. <span class="id">inv</span> <span class="id">H1</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">select_switch_case</span> <span class="id">n</span> <span class="id">sl</span>); <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">wt_seq_of_ls</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rt</span> <span class="id">sl</span>,<br/>
&nbsp;&nbsp;<span class="id">wt_lblstmts</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rt</span> <span class="id">sl</span> -&gt; <span class="id">wt_stmt</span> <span class="id">ce</span> <span class="id">e</span> <span class="id">rt</span> (<span class="id">seq_of_labeled_statement</span> <span class="id">sl</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4125')">Proof.</div>
<div class="proofscript" id="proof4125">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">WT_SWITCH</span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id">PRESERVATION</span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id">prog</span>: <span class="id">program</span>.<br/>
<span class="kwd">Hypothesis</span> <span class="id">WTPROG</span>: <span class="id">wt_program</span> <span class="id">prog</span>.<br/>
<span class="kwd">Let</span> <span class="id">ge</span> := <span class="id">globalenv</span> <span class="id">prog</span>.<br/>
<span class="kwd">Let</span> <span class="id">gtenv</span> := <span class="id">bind_globdef</span> (<span class="id">PTree.empty</span> <span class="id">_</span>) <span class="id">prog</span>.(<span class="id">prog_defs</span>).<br/>
<br/>
<span class="kwd">Hypothesis</span> <span class="id">WT_EXTERNAL</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">id</span> <span class="id">ef</span> <span class="id">args</span> <span class="id">res</span> <span class="id">cc</span> <span class="id">vargs</span> <span class="id">m</span> <span class="id">t</span> <span class="id">vres</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;<span class="id">In</span> (<span class="id">id</span>, <span class="id">Gfun</span> (<span class="id">External</span> <span class="id">ef</span> <span class="id">args</span> <span class="id">res</span> <span class="id">cc</span>)) <span class="id">prog</span>.(<span class="id">prog_defs</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">external_call</span> <span class="id">ef</span> <span class="id">ge</span> <span class="id">vargs</span> <span class="id">m</span> <span class="id">t</span> <span class="id">vres</span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">wt_val</span> <span class="id">vres</span> <span class="id">res</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">wt_expr_cont</span>: <span class="id">typenv</span> -&gt; <span class="id">function</span> -&gt; <span class="id">cont</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id">wt_Kdo</span>: <span class="kwd">forall</span> <span class="id">te</span> <span class="id">f</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_stmt_cont</span> <span class="id">te</span> <span class="id">f</span> <span class="id">k</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_expr_cont</span> <span class="id">te</span> <span class="id">f</span> (<span class="id">Kdo</span> <span class="id">k</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_Kifthenelse</span>: <span class="kwd">forall</span> <span class="id">te</span> <span class="id">f</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_stmt_cont</span> <span class="id">te</span> <span class="id">f</span> <span class="id">k</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_stmt</span> <span class="id">ge</span> <span class="id">te</span> <span class="id">f</span>.(<span class="id">fn_return</span>) <span class="id">s1</span> -&gt; <span class="id">wt_stmt</span> <span class="id">ge</span> <span class="id">te</span> <span class="id">f</span>.(<span class="id">fn_return</span>) <span class="id">s2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_expr_cont</span> <span class="id">te</span> <span class="id">f</span> (<span class="id">Kifthenelse</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">k</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_Kwhile1</span>: <span class="kwd">forall</span> <span class="id">te</span> <span class="id">f</span> <span class="id">r</span> <span class="id">s</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_stmt_cont</span> <span class="id">te</span> <span class="id">f</span> <span class="id">k</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> <span class="id">ge</span> <span class="id">te</span> <span class="id">r</span> -&gt; <span class="id">wt_stmt</span> <span class="id">ge</span> <span class="id">te</span> <span class="id">f</span>.(<span class="id">fn_return</span>) <span class="id">s</span> -&gt; <span class="id">wt_bool</span> (<span class="id">typeof</span> <span class="id">r</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_expr_cont</span> <span class="id">te</span> <span class="id">f</span> (<span class="id">Kwhile1</span> <span class="id">r</span> <span class="id">s</span> <span class="id">k</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_Kdowhile2</span>: <span class="kwd">forall</span> <span class="id">te</span> <span class="id">f</span> <span class="id">r</span> <span class="id">s</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_stmt_cont</span> <span class="id">te</span> <span class="id">f</span> <span class="id">k</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> <span class="id">ge</span> <span class="id">te</span> <span class="id">r</span> -&gt; <span class="id">wt_stmt</span> <span class="id">ge</span> <span class="id">te</span> <span class="id">f</span>.(<span class="id">fn_return</span>) <span class="id">s</span> -&gt; <span class="id">wt_bool</span> (<span class="id">typeof</span> <span class="id">r</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_expr_cont</span> <span class="id">te</span> <span class="id">f</span> (<span class="id">Kdowhile2</span> <span class="id">r</span> <span class="id">s</span> <span class="id">k</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_Kfor2</span>: <span class="kwd">forall</span> <span class="id">te</span> <span class="id">f</span> <span class="id">r</span> <span class="id">s2</span> <span class="id">s3</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_stmt_cont</span> <span class="id">te</span> <span class="id">f</span> <span class="id">k</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> <span class="id">ge</span> <span class="id">te</span> <span class="id">r</span> -&gt; <span class="id">wt_stmt</span> <span class="id">ge</span> <span class="id">te</span> <span class="id">f</span>.(<span class="id">fn_return</span>) <span class="id">s2</span> -&gt; <span class="id">wt_stmt</span> <span class="id">ge</span> <span class="id">te</span> <span class="id">f</span>.(<span class="id">fn_return</span>) <span class="id">s3</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">classify_bool</span> (<span class="id">typeof</span> <span class="id">r</span>) &lt;&gt; <span class="id">bool_default</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_expr_cont</span> <span class="id">te</span> <span class="id">f</span> (<span class="id">Kfor2</span> <span class="id">r</span> <span class="id">s2</span> <span class="id">s3</span> <span class="id">k</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_Kswitch1</span>: <span class="kwd">forall</span> <span class="id">te</span> <span class="id">f</span> <span class="id">ls</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_stmt_cont</span> <span class="id">te</span> <span class="id">f</span> <span class="id">k</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_lblstmts</span> <span class="id">ge</span> <span class="id">te</span> <span class="id">f</span>.(<span class="id">fn_return</span>) <span class="id">ls</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_expr_cont</span> <span class="id">te</span> <span class="id">f</span> (<span class="id">Kswitch1</span> <span class="id">ls</span> <span class="id">k</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_Kreturn</span>: <span class="kwd">forall</span> <span class="id">te</span> <span class="id">f</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_stmt_cont</span> <span class="id">te</span> <span class="id">f</span> <span class="id">k</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_expr_cont</span> <span class="id">te</span> <span class="id">f</span> (<span class="id">Kreturn</span> <span class="id">k</span>)<br/>
<br/>
<span class="kwd">with</span> <span class="id">wt_stmt_cont</span>: <span class="id">typenv</span> -&gt; <span class="id">function</span> -&gt; <span class="id">cont</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id">wt_Kseq</span>: <span class="kwd">forall</span> <span class="id">te</span> <span class="id">f</span> <span class="id">s</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_stmt_cont</span> <span class="id">te</span> <span class="id">f</span> <span class="id">k</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_stmt</span> <span class="id">ge</span> <span class="id">te</span> <span class="id">f</span>.(<span class="id">fn_return</span>) <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_stmt_cont</span> <span class="id">te</span> <span class="id">f</span> (<span class="id">Kseq</span> <span class="id">s</span> <span class="id">k</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_Kwhile2</span>: <span class="kwd">forall</span> <span class="id">te</span> <span class="id">f</span> <span class="id">r</span> <span class="id">s</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_stmt_cont</span> <span class="id">te</span> <span class="id">f</span> <span class="id">k</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> <span class="id">ge</span> <span class="id">te</span> <span class="id">r</span> -&gt; <span class="id">wt_stmt</span> <span class="id">ge</span> <span class="id">te</span> <span class="id">f</span>.(<span class="id">fn_return</span>) <span class="id">s</span> -&gt; <span class="id">wt_bool</span> (<span class="id">typeof</span> <span class="id">r</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_stmt_cont</span> <span class="id">te</span> <span class="id">f</span> (<span class="id">Kwhile2</span> <span class="id">r</span> <span class="id">s</span> <span class="id">k</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_Kdowhile1</span>: <span class="kwd">forall</span> <span class="id">te</span> <span class="id">f</span> <span class="id">r</span> <span class="id">s</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_stmt_cont</span> <span class="id">te</span> <span class="id">f</span> <span class="id">k</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> <span class="id">ge</span> <span class="id">te</span> <span class="id">r</span> -&gt; <span class="id">wt_stmt</span> <span class="id">ge</span> <span class="id">te</span> <span class="id">f</span>.(<span class="id">fn_return</span>) <span class="id">s</span> -&gt; <span class="id">wt_bool</span> (<span class="id">typeof</span> <span class="id">r</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_stmt_cont</span> <span class="id">te</span> <span class="id">f</span> (<span class="id">Kdowhile1</span> <span class="id">r</span> <span class="id">s</span> <span class="id">k</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_Kfor3</span>: <span class="kwd">forall</span> <span class="id">te</span> <span class="id">f</span> <span class="id">r</span> <span class="id">s2</span> <span class="id">s3</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_stmt_cont</span> <span class="id">te</span> <span class="id">f</span> <span class="id">k</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> <span class="id">ge</span> <span class="id">te</span> <span class="id">r</span> -&gt; <span class="id">wt_stmt</span> <span class="id">ge</span> <span class="id">te</span> <span class="id">f</span>.(<span class="id">fn_return</span>) <span class="id">s2</span> -&gt; <span class="id">wt_stmt</span> <span class="id">ge</span> <span class="id">te</span> <span class="id">f</span>.(<span class="id">fn_return</span>) <span class="id">s3</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_bool</span> (<span class="id">typeof</span> <span class="id">r</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_stmt_cont</span> <span class="id">te</span> <span class="id">f</span> (<span class="id">Kfor3</span> <span class="id">r</span> <span class="id">s2</span> <span class="id">s3</span> <span class="id">k</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_Kfor4</span>: <span class="kwd">forall</span> <span class="id">te</span> <span class="id">f</span> <span class="id">r</span> <span class="id">s2</span> <span class="id">s3</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_stmt_cont</span> <span class="id">te</span> <span class="id">f</span> <span class="id">k</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_rvalue</span> <span class="id">ge</span> <span class="id">te</span> <span class="id">r</span> -&gt; <span class="id">wt_stmt</span> <span class="id">ge</span> <span class="id">te</span> <span class="id">f</span>.(<span class="id">fn_return</span>) <span class="id">s2</span> -&gt; <span class="id">wt_stmt</span> <span class="id">ge</span> <span class="id">te</span> <span class="id">f</span>.(<span class="id">fn_return</span>) <span class="id">s3</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_bool</span> (<span class="id">typeof</span> <span class="id">r</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_stmt_cont</span> <span class="id">te</span> <span class="id">f</span> (<span class="id">Kfor4</span> <span class="id">r</span> <span class="id">s2</span> <span class="id">s3</span> <span class="id">k</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_Kswitch2</span>: <span class="kwd">forall</span> <span class="id">te</span> <span class="id">f</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_stmt_cont</span> <span class="id">te</span> <span class="id">f</span> <span class="id">k</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_stmt_cont</span> <span class="id">te</span> <span class="id">f</span> (<span class="id">Kswitch2</span> <span class="id">k</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_Kstop</span>': <span class="kwd">forall</span> <span class="id">te</span> <span class="id">f</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_stmt_cont</span> <span class="id">te</span> <span class="id">f</span> <span class="id">Kstop</span><br/>
&nbsp;&nbsp;| <span class="id">wt_Kcall</span>': <span class="kwd">forall</span> <span class="id">te</span> <span class="id">f</span> <span class="id">f</span>' <span class="id">e</span> <span class="id">C</span> <span class="id">ty</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_call_cont</span> (<span class="id">Kcall</span> <span class="id">f</span>' <span class="id">e</span> <span class="id">C</span> <span class="id">ty</span> <span class="id">k</span>) <span class="id">ty</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ty</span> = <span class="id">f</span>.(<span class="id">fn_return</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_stmt_cont</span> <span class="id">te</span> <span class="id">f</span> (<span class="id">Kcall</span> <span class="id">f</span>' <span class="id">e</span> <span class="id">C</span> <span class="id">ty</span> <span class="id">k</span>)<br/>
<br/>
<span class="kwd">with</span> <span class="id">wt_call_cont</span>: <span class="id">cont</span> -&gt; <span class="id">type</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id">wt_Kstop</span>: <span class="kwd">forall</span> <span class="id">ty</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_call_cont</span> <span class="id">Kstop</span> <span class="id">ty</span><br/>
&nbsp;&nbsp;| <span class="id">wt_Kcall</span>: <span class="kwd">forall</span> <span class="id">te</span> <span class="id">f</span> <span class="id">e</span> <span class="id">C</span> <span class="id">ty</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_expr_cont</span> <span class="id">te</span> <span class="id">f</span> <span class="id">k</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_stmt</span> <span class="id">ge</span> <span class="id">te</span> <span class="id">f</span>.(<span class="id">fn_return</span>) <span class="id">f</span>.(<span class="id">fn_body</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">v</span>, <span class="id">wt_val</span> <span class="id">v</span> <span class="id">ty</span> -&gt; <span class="id">wt_rvalue</span> <span class="id">ge</span> <span class="id">te</span> (<span class="id">C</span> (<span class="kwd">Eval</span> <span class="id">v</span> <span class="id">ty</span>))) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_call_cont</span> (<span class="id">Kcall</span> <span class="id">f</span> <span class="id">e</span> <span class="id">C</span> <span class="id">ty</span> <span class="id">k</span>) <span class="id">ty</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">is_wt_call_cont</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">te</span> <span class="id">f</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;<span class="id">is_call_cont</span> <span class="id">k</span> -&gt; <span class="id">wt_stmt_cont</span> <span class="id">te</span> <span class="id">f</span> <span class="id">k</span> -&gt; <span class="id">wt_call_cont</span> <span class="id">k</span> <span class="id">f</span>.(<span class="id">fn_return</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4126')">Proof.</div>
<div class="proofscript" id="proof4126">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H0</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="id">contradiction</span>. <span class="id">constructor</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">wt_call_cont_stmt_cont</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">te</span> <span class="id">f</span> <span class="id">k</span>, <span class="id">wt_call_cont</span> <span class="id">k</span> <span class="id">f</span>.(<span class="id">fn_return</span>) -&gt; <span class="id">wt_stmt_cont</span> <span class="id">te</span> <span class="id">f</span> <span class="id">k</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4127')">Proof.</div>
<div class="proofscript" id="proof4127">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>. <span class="id">constructor</span>. <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">call_cont_wt</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">e</span> <span class="id">f</span> <span class="id">k</span>, <span class="id">wt_stmt_cont</span> <span class="id">e</span> <span class="id">f</span> <span class="id">k</span> -&gt; <span class="id">wt_call_cont</span> (<span class="id">call_cont</span> <span class="id">k</span>) <span class="id">f</span>.(<span class="id">fn_return</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4128')">Proof.</div>
<div class="proofscript" id="proof4128">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">call_cont_wt</span>':<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">e</span> <span class="id">f</span> <span class="id">k</span>, <span class="id">wt_stmt_cont</span> <span class="id">e</span> <span class="id">f</span> <span class="id">k</span> -&gt; <span class="id">wt_stmt_cont</span> <span class="id">e</span> <span class="id">f</span> (<span class="id">call_cont</span> <span class="id">k</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4129')">Proof.</div>
<div class="proofscript" id="proof4129">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">simpl</span>; <span class="tactic">auto</span>; <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">wt_fundef</span> (<span class="id">fd</span>: <span class="id">fundef</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">fd</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Internal</span> <span class="id">f</span> =&gt; <span class="id">wt_function</span> <span class="id">ge</span> <span class="id">gtenv</span> <span class="id">f</span><br/>
&nbsp;&nbsp;| <span class="id">External</span> <span class="id">ef</span> <span class="id">targs</span> <span class="id">tres</span> <span class="id">cc</span> =&gt; <span class="id">True</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">fundef_return</span> (<span class="id">fd</span>: <span class="id">fundef</span>) : <span class="id">type</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">fd</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Internal</span> <span class="id">f</span> =&gt; <span class="id">f</span>.(<span class="id">fn_return</span>)<br/>
&nbsp;&nbsp;| <span class="id">External</span> <span class="id">ef</span> <span class="id">targs</span> <span class="id">tres</span> <span class="id">cc</span> =&gt; <span class="id">tres</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">wt_find_funct</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">fd</span>, <span class="id">Genv.find_funct</span> <span class="id">ge</span> <span class="id">v</span> = <span class="id">Some</span> <span class="id">fd</span> -&gt; <span class="id">wt_fundef</span> <span class="id">fd</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4130')">Proof.</div>
<div class="proofscript" id="proof4130">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">Genv.find_funct_prop</span> <span class="kwd">with</span> (<span class="id">p</span> := <span class="id">prog</span>) (<span class="id">v</span> := <span class="id">v</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">WTPROG</span>. <span class="tactic">destruct</span> <span class="id">f</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">H1</span> <span class="kwd">with</span> <span class="id">id</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Inductive</span> <span class="id">wt_state</span>: <span class="id">state</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id">wt_stmt_state</span>: <span class="kwd">forall</span> <span class="id">f</span> <span class="id">s</span> <span class="id">k</span> <span class="id">e</span> <span class="id">m</span> <span class="id">te</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">WTK</span>: <span class="id">wt_stmt_cont</span> <span class="id">te</span> <span class="id">f</span> <span class="id">k</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">WTB</span>: <span class="id">wt_stmt</span> <span class="id">ge</span> <span class="id">te</span> <span class="id">f</span>.(<span class="id">fn_return</span>) <span class="id">f</span>.(<span class="id">fn_body</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">WTS</span>: <span class="id">wt_stmt</span> <span class="id">ge</span> <span class="id">te</span> <span class="id">f</span>.(<span class="id">fn_return</span>) <span class="id">s</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_state</span> (<span class="id">State</span> <span class="id">f</span> <span class="id">s</span> <span class="id">k</span> <span class="id">e</span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_expr_state</span>: <span class="kwd">forall</span> <span class="id">f</span> <span class="id">r</span> <span class="id">k</span> <span class="id">e</span> <span class="id">m</span> <span class="id">te</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">WTK</span>: <span class="id">wt_expr_cont</span> <span class="id">te</span> <span class="id">f</span> <span class="id">k</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">WTB</span>: <span class="id">wt_stmt</span> <span class="id">ge</span> <span class="id">te</span> <span class="id">f</span>.(<span class="id">fn_return</span>) <span class="id">f</span>.(<span class="id">fn_body</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">WTE</span>: <span class="id">wt_rvalue</span> <span class="id">ge</span> <span class="id">te</span> <span class="id">r</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_state</span> (<span class="id">ExprState</span> <span class="id">f</span> <span class="id">r</span> <span class="id">k</span> <span class="id">e</span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_call_state</span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">fd</span> <span class="id">vargs</span> <span class="id">k</span> <span class="id">m</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">WTK</span>: <span class="id">wt_call_cont</span> <span class="id">k</span> (<span class="id">fundef_return</span> <span class="id">fd</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">WTFD</span>: <span class="id">wt_fundef</span> <span class="id">fd</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FIND</span>: <span class="id">Genv.find_funct</span> <span class="id">ge</span> <span class="id">b</span> = <span class="id">Some</span> <span class="id">fd</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_state</span> (<span class="id">Callstate</span> <span class="id">fd</span> <span class="id">vargs</span> <span class="id">k</span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_return_state</span>: <span class="kwd">forall</span> <span class="id">v</span> <span class="id">k</span> <span class="id">m</span> <span class="id">ty</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">WTK</span>: <span class="id">wt_call_cont</span> <span class="id">k</span> <span class="id">ty</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">VAL</span>: <span class="id">wt_val</span> <span class="id">v</span> <span class="id">ty</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_state</span> (<span class="id">Returnstate</span> <span class="id">v</span> <span class="id">k</span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;| <span class="id">wt_stuck_state</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_state</span> <span class="id">Stuckstate</span>.<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">wt_expr_cont</span> <span class="id">wt_stmt_cont</span> <span class="id">wt_stmt</span> <span class="id">wt_state</span>: <span class="id">ty</span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id">WT_FIND_LABEL</span>.<br/>
<br/>
<span class="kwd">Scheme</span> <span class="id">wt_stmt_ind2</span> := <span class="id">Minimality</span> <span class="kwd">for</span> <span class="id">wt_stmt</span> <span class="kwd">Sort</span> <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">wt_lblstmts2_ind2</span> := <span class="id">Minimality</span> <span class="kwd">for</span> <span class="id">wt_lblstmts</span> <span class="kwd">Sort</span> <span class="kwd">Prop</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">wt_find_label</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">lbl</span> <span class="id">e</span> <span class="id">f</span> <span class="id">s</span>, <span class="id">wt_stmt</span> <span class="id">ge</span> <span class="id">e</span> <span class="id">f</span>.(<span class="id">fn_return</span>) <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">k</span> <span class="id">s</span>' <span class="id">k</span>',<br/>
&nbsp;&nbsp;<span class="id">find_label</span> <span class="id">lbl</span> <span class="id">s</span> <span class="id">k</span> = <span class="id">Some</span> (<span class="id">s</span>', <span class="id">k</span>') -&gt;<br/>
&nbsp;&nbsp;<span class="id">wt_stmt_cont</span> <span class="id">e</span> <span class="id">f</span> <span class="id">k</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">wt_stmt</span> <span class="id">ge</span> <span class="id">e</span> <span class="id">f</span>.(<span class="id">fn_return</span>) <span class="id">s</span>' /\ <span class="id">wt_stmt_cont</span> <span class="id">e</span> <span class="id">f</span> <span class="id">k</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4131')">Proof.</div>
<div class="proofscript" id="proof4131">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">lbl</span> <span class="id">e</span> <span class="id">f</span> <span class="id">s0</span> <span class="id">WTS0</span>. <span class="tactic">pattern</span> <span class="id">s0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">wt_stmt_ind2</span> <span class="id">ge</span> <span class="id">e</span> <span class="id">f</span>.(<span class="id">fn_return</span>)) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">P0</span> := <span class="kwd">fun</span> <span class="id">ls</span> =&gt; <span class="id">wt_lblstmts</span> <span class="id">ge</span> <span class="id">e</span> <span class="id">f</span>.(<span class="id">fn_return</span>) <span class="id">ls</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">k</span> <span class="id">s</span>' <span class="id">k</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">find_label_ls</span> <span class="id">lbl</span> <span class="id">ls</span> <span class="id">k</span> = <span class="id">Some</span> (<span class="id">s</span>', <span class="id">k</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_stmt_cont</span> <span class="id">e</span> <span class="id">f</span> <span class="id">k</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wt_stmt</span> <span class="id">ge</span> <span class="id">e</span> <span class="id">f</span>.(<span class="id">fn_return</span>) <span class="id">s</span>' /\ <span class="id">wt_stmt_cont</span> <span class="id">e</span> <span class="id">f</span> <span class="id">k</span>');<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id">find_label</span> <span class="id">lbl</span> <span class="id">s1</span> (<span class="id">Kseq</span> <span class="id">s2</span> <span class="id">k</span>)) <span class="kwd">as</span> [[<span class="id">sx</span> <span class="id">kx</span>] | ] <span class="id">eqn</span>:<span class="id">F</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H3</span>. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id">find_label</span> <span class="id">lbl</span> <span class="id">s1</span> <span class="id">k</span>) <span class="kwd">as</span> [[<span class="id">sx</span> <span class="id">kx</span>] | ] <span class="id">eqn</span>:<span class="id">F</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H5</span>. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id">find_label</span> <span class="id">lbl</span> <span class="id">s1</span> (<span class="id">Kseq</span> (<span class="id">Sfor</span> <span class="id">Sskip</span> <span class="id">r</span> <span class="id">s2</span> <span class="id">s3</span>) <span class="id">k</span>)) <span class="kwd">as</span> [[<span class="id">sx</span> <span class="id">kx</span>] | ] <span class="id">eqn</span>:<span class="id">F</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H7</span>. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">find_label</span> <span class="id">lbl</span> <span class="id">s3</span> (<span class="id">Kfor3</span> <span class="id">r</span> <span class="id">s2</span> <span class="id">s3</span> <span class="id">k</span>)) <span class="kwd">as</span> [[<span class="id">sx</span> <span class="id">kx</span>] | ] <span class="id">eqn</span>:<span class="id">F2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H7</span>. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id">ident_eq</span> <span class="id">lbl</span> <span class="id">lbl0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id">find_label</span> <span class="id">lbl</span> <span class="id">s</span> (<span class="id">Kseq</span> (<span class="id">seq_of_labeled_statement</span> <span class="id">ls</span>) <span class="id">k</span>)) <span class="kwd">as</span> [[<span class="id">sx</span> <span class="id">kx</span>] | ] <span class="id">eqn</span>:<span class="id">F</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H4</span>. <span class="tactic">eapply</span> <span class="id">H0</span>; <span class="tactic">eauto</span>. <span class="id">constructor</span>. <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">wt_seq_of_ls</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">WT_FIND_LABEL</span>.<br/>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">preservation_estep</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">S</span> <span class="id">t</span> <span class="id">S</span>', <span class="id">estep</span> <span class="id">ge</span> <span class="id">S</span> <span class="id">t</span> <span class="id">S</span>' -&gt; <span class="id">wt_state</span> <span class="id">S</span> -&gt; <span class="id">wt_state</span> <span class="id">S</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4132')">Proof.</div>
<div class="proofscript" id="proof4132">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">intros</span> <span class="id">WT</span>; <span class="id">inv</span> <span class="id">WT</span>.<br/>
- <span class="comment">(*&nbsp;lred&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="id">change</span> (<span class="id">wt_expr_kind</span> <span class="id">ge</span> <span class="id">te</span> <span class="id">RV</span> (<span class="id">C</span> <span class="id">a</span>')).<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">wt_context</span> <span class="kwd">with</span> (<span class="id">a</span> := <span class="id">a</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">lred_same_type</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">wt_lred</span>; <span class="tactic">eauto</span>. <span class="id">change</span> (<span class="id">wt_expr_kind</span> <span class="id">ge</span> <span class="id">te</span> <span class="id">LV</span> <span class="id">a</span>). <span class="tactic">eapply</span> <span class="id">wt_subexpr</span>; <span class="tactic">eauto</span>.<br/>
- <span class="comment">(*&nbsp;rred&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="id">change</span> (<span class="id">wt_expr_kind</span> <span class="id">ge</span> <span class="id">te</span> <span class="id">RV</span> (<span class="id">C</span> <span class="id">a</span>')).<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">wt_context</span> <span class="kwd">with</span> (<span class="id">a</span> := <span class="id">a</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">rred_same_type</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">wt_rred</span>; <span class="tactic">eauto</span>. <span class="id">change</span> (<span class="id">wt_expr_kind</span> <span class="id">ge</span> <span class="id">te</span> <span class="id">RV</span> <span class="id">a</span>). <span class="tactic">eapply</span> <span class="id">wt_subexpr</span>; <span class="tactic">eauto</span>.<br/>
- <span class="comment">(*&nbsp;call&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">A</span>: <span class="id">wt_expr_kind</span> <span class="id">ge</span> <span class="id">te</span> <span class="id">RV</span> <span class="id">a</span>) <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id">wt_subexpr</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">A</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">A</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H9</span>; <span class="tactic">rewrite</span> <span class="id">H4</span> <span class="kwd">in</span> <span class="id">H9</span>; <span class="id">inv</span> <span class="id">H9</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">fundef_return</span> <span class="id">fd</span> = <span class="id">ty</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">fd</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">type_of_function</span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">change</span> (<span class="id">wt_expr_kind</span> <span class="id">ge</span> <span class="id">te</span> <span class="id">RV</span> (<span class="id">C</span> (<span class="kwd">Eval</span> <span class="id">v</span> <span class="id">ty</span>))).<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">wt_context</span> <span class="kwd">with</span> (<span class="id">a</span> := <span class="id">Ecall</span> (<span class="kwd">Eval</span> <span class="id">vf</span> <span class="id">tyf</span>) <span class="id">el</span> <span class="id">ty</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">red</span>; <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">wt_find_funct</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
- <span class="comment">(*&nbsp;stuck&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">preservation_sstep</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">S</span> <span class="id">t</span> <span class="id">S</span>', <span class="id">sstep</span> <span class="id">ge</span> <span class="id">S</span> <span class="id">t</span> <span class="id">S</span>' -&gt; <span class="id">wt_state</span> <span class="id">S</span> -&gt; <span class="id">wt_state</span> <span class="id">S</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4133')">Proof.</div>
<div class="proofscript" id="proof4133">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">intros</span> <span class="id">WT</span>; <span class="id">inv</span> <span class="id">WT</span>.<br/>
- <span class="id">inv</span> <span class="id">WTS</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="id">inv</span> <span class="id">WTK</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="id">inv</span> <span class="id">WTS</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="id">inv</span> <span class="id">WTK</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="id">inv</span> <span class="id">WTK</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="id">inv</span> <span class="id">WTK</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="id">inv</span> <span class="id">WTS</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="id">inv</span> <span class="id">WTK</span>; <span class="tactic">destruct</span> <span class="id">b</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="id">inv</span> <span class="id">WTS</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="id">inv</span> <span class="id">WTK</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="id">inv</span> <span class="id">WTK</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="id">inv</span> <span class="id">WTK</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="id">inv</span> <span class="id">WTK</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="id">inv</span> <span class="id">WTS</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="id">inv</span> <span class="id">WTK</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="id">inv</span> <span class="id">WTK</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="id">inv</span> <span class="id">WTK</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="id">inv</span> <span class="id">WTK</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="id">inv</span> <span class="id">WTS</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="id">inv</span> <span class="id">WTS</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="id">inv</span> <span class="id">WTK</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="id">inv</span> <span class="id">WTK</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="id">inv</span> <span class="id">WTK</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="id">inv</span> <span class="id">WTK</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="id">inv</span> <span class="id">WTK</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="id">econstructor</span>. <span class="tactic">eapply</span> <span class="id">call_cont_wt</span>; <span class="tactic">eauto</span>. <span class="id">constructor</span>.<br/>
- <span class="id">inv</span> <span class="id">WTS</span>. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="id">inv</span> <span class="id">WTK</span>. <span class="id">econstructor</span>. <span class="tactic">eapply</span> <span class="id">call_cont_wt</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">WTE</span>. <span class="tactic">eapply</span> <span class="id">pres_sem_cast</span>; <span class="tactic">eauto</span>.<br/>
- <span class="id">econstructor</span>. <span class="tactic">eapply</span> <span class="id">is_wt_call_cont</span>; <span class="tactic">eauto</span>. <span class="id">constructor</span>.<br/>
- <span class="id">inv</span> <span class="id">WTS</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="id">inv</span> <span class="id">WTK</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">wt_seq_of_ls</span>. <span class="tactic">apply</span> <span class="id">wt_select_switch</span>; <span class="tactic">auto</span>.<br/>
- <span class="id">inv</span> <span class="id">WTK</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="id">inv</span> <span class="id">WTK</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="id">inv</span> <span class="id">WTS</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="id">exploit</span> <span class="id">wt_find_label</span>. <span class="id">eexact</span> <span class="id">WTB</span>. <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">call_cont_wt</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">A</span> <span class="id">B</span>]. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">WTFD</span>; <span class="id">inv</span> <span class="id">WTFD</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">wt_call_cont_stmt_cont</span>; <span class="tactic">auto</span>.<br/>
- <span class="id">exploit</span> (<span class="id">Genv.find_funct_inversion</span> <span class="id">prog</span>); <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">id</span> &amp; <span class="id">A</span>).<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
- <span class="id">inv</span> <span class="id">WTK</span>. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id">preservation</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">S</span> <span class="id">t</span> <span class="id">S</span>', <span class="id">step</span> <span class="id">ge</span> <span class="id">S</span> <span class="id">t</span> <span class="id">S</span>' -&gt; <span class="id">wt_state</span> <span class="id">S</span> -&gt; <span class="id">wt_state</span> <span class="id">S</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4134')">Proof.</div>
<div class="proofscript" id="proof4134">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H</span>. <span class="tactic">eapply</span> <span class="id">preservation_estep</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">preservation_sstep</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id">wt_initial_state</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">S</span>, <span class="id">initial_state</span> <span class="id">prog</span> <span class="id">S</span> -&gt; <span class="id">wt_state</span> <span class="id">S</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4135')">Proof.</div>
<div class="proofscript" id="proof4135">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="id">econstructor</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Genv.find_funct_ptr_prop</span> <span class="kwd">with</span> (<span class="id">p</span> := <span class="id">prog</span>) (<span class="id">b</span> := <span class="id">b</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">WTPROG</span>. <span class="tactic">destruct</span> <span class="id">f0</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">H4</span> <span class="kwd">with</span> <span class="id">id</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">instantiate</span> (1 := (<span class="id">Vptr</span> <span class="id">b</span> <span class="id">Ptrofs.zero</span>)). <span class="tactic">rewrite</span> <span class="id">Genv.find_funct_find_funct_ptr</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">PRESERVATION</span>.<br/>
</div>
<div class="footer"><hr/>Generated by coq2html</div>
</body>
</html>
