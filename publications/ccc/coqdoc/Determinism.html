<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module Determinism</title>
<meta name="description" content="Documentation of Coq module Determinism" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module Determinism</h1>
<div class="coq">
<br/>
<div class="doc">Characterization and properties of deterministic external worlds
  and deterministic semantics </div>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">String</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Coqlib</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">AST</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Integers</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Events</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Globalenvs</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Smallstep</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Behaviors</span>.<br/>
<br/>
<h1> Deterministic worlds </h1>
<br/>
<div class="doc">One source of possible nondeterminism is that our semantics leave
  unspecified the results of system calls.
  Different results to e.g. a "read" operation can of
  course lead to different behaviors for the program.
  We address this issue by modeling a notion of deterministic
  external world that uniquely determines the results of external calls. </div>
<br/>
<div class="doc">An external world is a function that, given the name of an
  external call and its arguments, returns either <span class="bracket"><span class="id">None</span></span>, meaning
  that this external call gets stuck, or <span class="bracket"><span class="id">Some</span>(<span class="id">r</span>,<span class="id">w</span>)</span>, meaning
  that this external call succeeds, has result <span class="bracket"><span class="id">r</span></span>, and changes
  the world to <span class="bracket"><span class="id">w</span></span>. </div>
<br/>
<span class="kwd">CoInductive</span> <span class="id">world</span>: <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;<span class="id">World</span> (<span class="id">io</span>: <span class="id">string</span> -&gt; <span class="id">list</span> <span class="id">eventval</span> -&gt; <span class="id">option</span> (<span class="id">eventval</span> * <span class="id">world</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">vload</span>: <span class="id">memory_chunk</span> -&gt; <span class="id">ident</span> -&gt; <span class="id">ptrofs</span> -&gt; <span class="id">option</span> (<span class="id">eventval</span> * <span class="id">world</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">vstore</span>: <span class="id">memory_chunk</span> -&gt; <span class="id">ident</span> -&gt; <span class="id">ptrofs</span> -&gt; <span class="id">eventval</span> -&gt; <span class="id">option</span> <span class="id">world</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">nextworld_io</span> (<span class="id">w</span>: <span class="id">world</span>) (<span class="id">evname</span>: <span class="id">string</span>) (<span class="id">evargs</span>: <span class="id">list</span> <span class="id">eventval</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">option</span> (<span class="id">eventval</span> * <span class="id">world</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">w</span> <span class="kwd">with</span> <span class="id">World</span> <span class="id">io</span> <span class="id">vl</span> <span class="id">vs</span> =&gt; <span class="id">io</span> <span class="id">evname</span> <span class="id">evargs</span> <span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">nextworld_vload</span> (<span class="id">w</span>: <span class="id">world</span>) (<span class="id">chunk</span>: <span class="id">memory_chunk</span>) (<span class="id">id</span>: <span class="id">ident</span>) (<span class="id">ofs</span>: <span class="id">ptrofs</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">option</span> (<span class="id">eventval</span> * <span class="id">world</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">w</span> <span class="kwd">with</span> <span class="id">World</span> <span class="id">io</span> <span class="id">vl</span> <span class="id">vs</span> =&gt; <span class="id">vl</span> <span class="id">chunk</span> <span class="id">id</span> <span class="id">ofs</span> <span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">nextworld_vstore</span> (<span class="id">w</span>: <span class="id">world</span>) (<span class="id">chunk</span>: <span class="id">memory_chunk</span>) (<span class="id">id</span>: <span class="id">ident</span>) (<span class="id">ofs</span>: <span class="id">ptrofs</span>) (<span class="id">v</span>: <span class="id">eventval</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">option</span> <span class="id">world</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">w</span> <span class="kwd">with</span> <span class="id">World</span> <span class="id">io</span> <span class="id">vl</span> <span class="id">vs</span> =&gt; <span class="id">vs</span> <span class="id">chunk</span> <span class="id">id</span> <span class="id">ofs</span> <span class="id">v</span> <span class="kwd">end</span>.<br/>
<br/>
<div class="doc">A trace is possible in a given world if all events correspond
  to non-stuck external calls according to the given world.
  Two predicates are defined, for finite and infinite traces respectively:
<ul>
<li>
 <span class="bracket"><span class="id">possible_trace</span> <span class="id">w</span> <span class="id">t</span> <span class="id">w</span>'</span>, where <span class="bracket"><span class="id">w</span></span> is the initial state of the
  world, <span class="bracket"><span class="id">t</span></span> the finite trace of interest, and <span class="bracket"><span class="id">w</span>'</span> the state of the
  world after performing trace <span class="bracket"><span class="id">t</span></span>.
</li>
<li>
 <span class="bracket"><span class="id">possible_traceinf</span> <span class="id">w</span> <span class="id">T</span></span>, where <span class="bracket"><span class="id">w</span></span> is the initial state of the
  world and <span class="bracket"><span class="id">T</span></span> the infinite trace of interest.
</li>
</ul>
</div>
<br/>
<span class="kwd">Inductive</span> <span class="id">possible_event</span>: <span class="id">world</span> -&gt; <span class="id">event</span> -&gt; <span class="id">world</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id">possible_event_syscall</span>: <span class="kwd">forall</span> <span class="id">w1</span> <span class="id">evname</span> <span class="id">evargs</span> <span class="id">evres</span> <span class="id">w2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">nextworld_io</span> <span class="id">w1</span> <span class="id">evname</span> <span class="id">evargs</span> = <span class="id">Some</span> (<span class="id">evres</span>, <span class="id">w2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">possible_event</span> <span class="id">w1</span> (<span class="id">Event_syscall</span> <span class="id">evname</span> <span class="id">evargs</span> <span class="id">evres</span>) <span class="id">w2</span><br/>
&nbsp;&nbsp;| <span class="id">possible_event_vload</span>: <span class="kwd">forall</span> <span class="id">w1</span> <span class="id">chunk</span> <span class="id">id</span> <span class="id">ofs</span> <span class="id">evres</span> <span class="id">w2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">nextworld_vload</span> <span class="id">w1</span> <span class="id">chunk</span> <span class="id">id</span> <span class="id">ofs</span> = <span class="id">Some</span> (<span class="id">evres</span>, <span class="id">w2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">possible_event</span> <span class="id">w1</span> (<span class="id">Event_vload</span> <span class="id">chunk</span> <span class="id">id</span> <span class="id">ofs</span> <span class="id">evres</span>) <span class="id">w2</span><br/>
&nbsp;&nbsp;| <span class="id">possible_event_vstore</span>: <span class="kwd">forall</span> <span class="id">w1</span> <span class="id">chunk</span> <span class="id">id</span> <span class="id">ofs</span> <span class="id">evarg</span> <span class="id">w2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">nextworld_vstore</span> <span class="id">w1</span> <span class="id">chunk</span> <span class="id">id</span> <span class="id">ofs</span> <span class="id">evarg</span> = <span class="id">Some</span> <span class="id">w2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">possible_event</span> <span class="id">w1</span> (<span class="id">Event_vstore</span> <span class="id">chunk</span> <span class="id">id</span> <span class="id">ofs</span> <span class="id">evarg</span>) <span class="id">w2</span><br/>
&nbsp;&nbsp;| <span class="id">possible_event_annot</span>: <span class="kwd">forall</span> <span class="id">w1</span> <span class="id">id</span> <span class="id">args</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">possible_event</span> <span class="id">w1</span> (<span class="id">Event_annot</span> <span class="id">id</span> <span class="id">args</span>) <span class="id">w1</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">possible_trace</span>: <span class="id">world</span> -&gt; <span class="id">trace</span> -&gt; <span class="id">world</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id">possible_trace_nil</span>: <span class="kwd">forall</span> <span class="id">w</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">possible_trace</span> <span class="id">w</span> <span class="id">E0</span> <span class="id">w</span><br/>
&nbsp;&nbsp;| <span class="id">possible_trace_cons</span>: <span class="kwd">forall</span> <span class="id">w1</span> <span class="id">ev</span> <span class="id">w2</span> <span class="id">t</span> <span class="id">w3</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">possible_event</span> <span class="id">w1</span> <span class="id">ev</span> <span class="id">w2</span> -&gt; <span class="id">possible_trace</span> <span class="id">w2</span> <span class="id">t</span> <span class="id">w3</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">possible_trace</span> <span class="id">w1</span> (<span class="id">ev</span> :: <span class="id">t</span>) <span class="id">w3</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">possible_trace_app</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t2</span> <span class="id">w2</span> <span class="id">w0</span> <span class="id">t1</span> <span class="id">w1</span>,<br/>
&nbsp;&nbsp;<span class="id">possible_trace</span> <span class="id">w0</span> <span class="id">t1</span> <span class="id">w1</span> -&gt; <span class="id">possible_trace</span> <span class="id">w1</span> <span class="id">t2</span> <span class="id">w2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">possible_trace</span> <span class="id">w0</span> (<span class="id">t1</span> ** <span class="id">t2</span>) <span class="id">w2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2020')">Proof.</div>
<div class="proofscript" id="proof2020">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">possible_trace_app_inv</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t2</span> <span class="id">w2</span> <span class="id">t1</span> <span class="id">w0</span>,<br/>
&nbsp;&nbsp;<span class="id">possible_trace</span> <span class="id">w0</span> (<span class="id">t1</span> ** <span class="id">t2</span>) <span class="id">w2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">w1</span>, <span class="id">possible_trace</span> <span class="id">w0</span> <span class="id">t1</span> <span class="id">w1</span> /\ <span class="id">possible_trace</span> <span class="id">w1</span> <span class="id">t2</span> <span class="id">w2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2021')">Proof.</div>
<div class="proofscript" id="proof2021">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">t1</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">w0</span>; <span class="tactic">split</span>. <span class="id">constructor</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="id">exploit</span> <span class="id">IHt1</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">w1</span> [<span class="id">A</span> <span class="id">B</span>]].<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">w1</span>; <span class="tactic">split</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">match_possible_traces</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ge</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">w0</span> <span class="id">w1</span> <span class="id">w2</span>,<br/>
&nbsp;&nbsp;<span class="id">match_traces</span> <span class="id">ge</span> <span class="id">t1</span> <span class="id">t2</span> -&gt; <span class="id">possible_trace</span> <span class="id">w0</span> <span class="id">t1</span> <span class="id">w1</span> -&gt; <span class="id">possible_trace</span> <span class="id">w0</span> <span class="id">t2</span> <span class="id">w2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">t1</span> = <span class="id">t2</span> /\ <span class="id">w1</span> = <span class="id">w2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2022')">Proof.</div>
<div class="proofscript" id="proof2022">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H1</span>; <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H7</span>; <span class="id">inv</span> <span class="id">H6</span>. <span class="id">inv</span> <span class="id">H9</span>; <span class="id">inv</span> <span class="id">H10</span>. <span class="tactic">split</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H7</span>; <span class="id">inv</span> <span class="id">H6</span>. <span class="id">inv</span> <span class="id">H9</span>; <span class="id">inv</span> <span class="id">H10</span>. <span class="tactic">split</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H4</span>; <span class="id">inv</span> <span class="id">H3</span>. <span class="id">inv</span> <span class="id">H6</span>; <span class="id">inv</span> <span class="id">H7</span>. <span class="tactic">split</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H4</span>; <span class="id">inv</span> <span class="id">H3</span>. <span class="id">inv</span> <span class="id">H7</span>; <span class="id">inv</span> <span class="id">H6</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">CoInductive</span> <span class="id">possible_traceinf</span>: <span class="id">world</span> -&gt; <span class="id">traceinf</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id">possible_traceinf_cons</span>: <span class="kwd">forall</span> <span class="id">w1</span> <span class="id">ev</span> <span class="id">w2</span> <span class="id">T</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">possible_event</span> <span class="id">w1</span> <span class="id">ev</span> <span class="id">w2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">possible_traceinf</span> <span class="id">w2</span> <span class="id">T</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">possible_traceinf</span> <span class="id">w1</span> (<span class="id">Econsinf</span> <span class="id">ev</span> <span class="id">T</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">possible_traceinf_app</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t2</span> <span class="id">w0</span> <span class="id">t1</span> <span class="id">w1</span>,<br/>
&nbsp;&nbsp;<span class="id">possible_trace</span> <span class="id">w0</span> <span class="id">t1</span> <span class="id">w1</span> -&gt; <span class="id">possible_traceinf</span> <span class="id">w1</span> <span class="id">t2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">possible_traceinf</span> <span class="id">w0</span> (<span class="id">t1</span> *** <span class="id">t2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2023')">Proof.</div>
<div class="proofscript" id="proof2023">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">possible_traceinf_app_inv</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t2</span> <span class="id">t1</span> <span class="id">w0</span>,<br/>
&nbsp;&nbsp;<span class="id">possible_traceinf</span> <span class="id">w0</span> (<span class="id">t1</span> *** <span class="id">t2</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">w1</span>, <span class="id">possible_trace</span> <span class="id">w0</span> <span class="id">t1</span> <span class="id">w1</span> /\ <span class="id">possible_traceinf</span> <span class="id">w1</span> <span class="id">t2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2024')">Proof.</div>
<div class="proofscript" id="proof2024">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">t1</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">w0</span>; <span class="tactic">split</span>. <span class="id">constructor</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="id">exploit</span> <span class="id">IHt1</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">w1</span> [<span class="id">A</span> <span class="id">B</span>]].<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">w1</span>; <span class="tactic">split</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Ltac</span> <span class="id">possibleTraceInv</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span>: <span class="id">possible_trace</span> <span class="id">_</span> <span class="id">E0</span> <span class="id">_</span> |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">clear</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="id">possibleTraceInv</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span>: <span class="id">possible_trace</span> <span class="id">_</span> (<span class="id">_</span> ** <span class="id">_</span>) <span class="id">_</span> |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">P1</span> := <span class="tactic">fresh</span> "<span class="id">P</span>" <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">w</span> := <span class="tactic">fresh</span> "<span class="id">w</span>" <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">P2</span> := <span class="tactic">fresh</span> "<span class="id">P</span>" <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">possible_trace_app_inv</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span>); <span class="tactic">clear</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">w</span> [<span class="id">P1</span> <span class="id">P2</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">possibleTraceInv</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span>: <span class="id">possible_traceinf</span> <span class="id">_</span> (<span class="id">_</span> *** <span class="id">_</span>) |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">P1</span> := <span class="tactic">fresh</span> "<span class="id">P</span>" <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">w</span> := <span class="tactic">fresh</span> "<span class="id">w</span>" <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">P2</span> := <span class="tactic">fresh</span> "<span class="id">P</span>" <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">possible_traceinf_app_inv</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span>); <span class="tactic">clear</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">w</span> [<span class="id">P1</span> <span class="id">P2</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">possibleTraceInv</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span>: <span class="id">exists</span> <span class="id">w</span>, <span class="id">possible_trace</span> <span class="id">_</span> <span class="id">_</span> <span class="id">w</span> |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">P</span> := <span class="tactic">fresh</span> "<span class="id">P</span>" <span class="kwd">in</span> <span class="kwd">let</span> <span class="id">w</span> := <span class="tactic">fresh</span> "<span class="id">w</span>" <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">w</span> <span class="id">P</span>]; <span class="id">possibleTraceInv</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">idtac</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">possible_behavior</span> (<span class="id">w</span>: <span class="id">world</span>) (<span class="id">b</span>: <span class="id">program_behavior</span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">b</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Terminates</span> <span class="id">t</span> <span class="id">r</span> =&gt; <span class="id">exists</span> <span class="id">w</span>', <span class="id">possible_trace</span> <span class="id">w</span> <span class="id">t</span> <span class="id">w</span>'<br/>
&nbsp;&nbsp;| <span class="id">Diverges</span> <span class="id">t</span> =&gt; <span class="id">exists</span> <span class="id">w</span>', <span class="id">possible_trace</span> <span class="id">w</span> <span class="id">t</span> <span class="id">w</span>'<br/>
&nbsp;&nbsp;| <span class="id">Reacts</span> <span class="id">T</span> =&gt; <span class="id">possible_traceinf</span> <span class="id">w</span> <span class="id">T</span><br/>
&nbsp;&nbsp;| <span class="id">Goes_wrong</span> <span class="id">t</span> =&gt; <span class="id">exists</span> <span class="id">w</span>', <span class="id">possible_trace</span> <span class="id">w</span> <span class="id">t</span> <span class="id">w</span>'<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">CoInductive</span> <span class="id">possible_traceinf</span>': <span class="id">world</span> -&gt; <span class="id">traceinf</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id">possible_traceinf</span>'<span class="id">_app</span>: <span class="kwd">forall</span> <span class="id">w1</span> <span class="id">t</span> <span class="id">w2</span> <span class="id">T</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">possible_trace</span> <span class="id">w1</span> <span class="id">t</span> <span class="id">w2</span> -&gt; <span class="id">t</span> &lt;&gt; <span class="id">E0</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">possible_traceinf</span>' <span class="id">w2</span> <span class="id">T</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">possible_traceinf</span>' <span class="id">w1</span> (<span class="id">t</span> *** <span class="id">T</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">possible_traceinf</span>'<span class="id">_traceinf</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">w</span> <span class="id">T</span>, <span class="id">possible_traceinf</span>' <span class="id">w</span> <span class="id">T</span> -&gt; <span class="id">possible_traceinf</span> <span class="id">w</span> <span class="id">T</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2025')">Proof.</div>
<div class="proofscript" id="proof2025">
&nbsp;&nbsp;<span class="id">cofix</span> <span class="id">COINDHYP</span>; <span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">H0</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">econstructor</span>. <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">COINDHYP</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H3</span>. <span class="tactic">simpl</span>. <span class="tactic">auto</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">unfold</span> <span class="id">E0</span>; <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<h1> Definition and properties of deterministic semantics </h1>
<br/>
<span class="kwd">Record</span> <span class="id">sem_deterministic</span> (<span class="id">L</span>: <span class="id">semantics</span>) := <span class="id">mk_deterministic</span> {<br/>
&nbsp;&nbsp;<span class="id">det_step</span>: <span class="kwd">forall</span> <span class="id">s0</span> <span class="id">t1</span> <span class="id">s1</span> <span class="id">t2</span> <span class="id">s2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Step</span> <span class="id">L</span> <span class="id">s0</span> <span class="id">t1</span> <span class="id">s1</span> -&gt; <span class="id">Step</span> <span class="id">L</span> <span class="id">s0</span> <span class="id">t2</span> <span class="id">s2</span> -&gt; <span class="id">s1</span> = <span class="id">s2</span> /\ <span class="id">t1</span> = <span class="id">t2</span>;<br/>
&nbsp;&nbsp;<span class="id">det_initial_state</span>: <span class="kwd">forall</span> <span class="id">s1</span> <span class="id">s2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">initial_state</span> <span class="id">L</span> <span class="id">s1</span> -&gt; <span class="id">initial_state</span> <span class="id">L</span> <span class="id">s2</span> -&gt; <span class="id">s1</span> = <span class="id">s2</span>;<br/>
&nbsp;&nbsp;<span class="id">det_final_state</span>: <span class="kwd">forall</span> <span class="id">s</span> <span class="id">r1</span> <span class="id">r2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">final_state</span> <span class="id">L</span> <span class="id">s</span> <span class="id">r1</span> -&gt; <span class="id">final_state</span> <span class="id">L</span> <span class="id">s</span> <span class="id">r2</span> -&gt; <span class="id">r1</span> = <span class="id">r2</span>;<br/>
&nbsp;&nbsp;<span class="id">det_final_nostep</span>: <span class="kwd">forall</span> <span class="id">s</span> <span class="id">r</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">final_state</span> <span class="id">L</span> <span class="id">s</span> <span class="id">r</span> -&gt; <span class="id">Nostep</span> <span class="id">L</span> <span class="id">s</span><br/>
}.<br/>
<br/>
<span class="kwd">Section</span> <span class="id">DETERM_SEM</span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id">L</span>: <span class="id">semantics</span>.<br/>
<span class="kwd">Hypothesis</span> <span class="id">DET</span>: <span class="id">sem_deterministic</span> <span class="id">L</span>.<br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">use_step_deterministic</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [ <span class="id">S1</span>: <span class="id">Step</span> <span class="id">L</span> <span class="id">_</span> ?<span class="id">t1</span> <span class="id">_</span>, <span class="id">S2</span>: <span class="id">Step</span> <span class="id">L</span> <span class="id">_</span> ?<span class="id">t2</span> <span class="id">_</span> |- <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">det_step</span> <span class="id">L</span> <span class="id">DET</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">S1</span> <span class="id">S2</span>) <span class="kwd">as</span> [<span class="id">EQ1</span> <span class="id">EQ2</span>]; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">Determinism for finite transition sequences. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id">star_step_diamond</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s0</span> <span class="id">t1</span> <span class="id">s1</span>, <span class="id">Star</span> <span class="id">L</span> <span class="id">s0</span> <span class="id">t1</span> <span class="id">s1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t2</span> <span class="id">s2</span>, <span class="id">Star</span> <span class="id">L</span> <span class="id">s0</span> <span class="id">t2</span> <span class="id">s2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Star</span> <span class="id">L</span> <span class="id">s1</span> <span class="id">t</span> <span class="id">s2</span> /\ <span class="id">t2</span> = <span class="id">t1</span> ** <span class="id">t</span>)<br/>
&nbsp;&nbsp;\/ (<span class="id">Star</span> <span class="id">L</span> <span class="id">s2</span> <span class="id">t</span> <span class="id">s1</span> /\ <span class="id">t1</span> = <span class="id">t2</span> ** <span class="id">t</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2026')">Proof.</div>
<div class="proofscript" id="proof2026">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">t2</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>. <span class="id">exists</span> (<span class="id">t1</span> ** <span class="id">t2</span>); <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">use_step_deterministic</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">IHstar</span>. <span class="id">eexact</span> <span class="id">H4</span>. <span class="tactic">intros</span> [<span class="id">t</span> <span class="id">A</span>]. <span class="id">exists</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">A</span>. <span class="id">left</span>; <span class="tactic">intuition</span>. <span class="id">traceEq</span>. <span class="id">right</span>; <span class="tactic">intuition</span>. <span class="id">traceEq</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Ltac</span> <span class="id">use_star_step_diamond</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [ <span class="id">S1</span>: <span class="id">Star</span> <span class="id">L</span> <span class="id">_</span> ?<span class="id">t1</span> <span class="id">_</span>, <span class="id">S2</span>: <span class="id">Star</span> <span class="id">L</span> <span class="id">_</span> ?<span class="id">t2</span> <span class="id">_</span> |- <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">t</span> := <span class="tactic">fresh</span> "<span class="id">t</span>" <span class="kwd">in</span> <span class="kwd">let</span> <span class="id">P</span> := <span class="tactic">fresh</span> "<span class="id">P</span>" <span class="kwd">in</span> <span class="kwd">let</span> <span class="id">EQ</span> := <span class="tactic">fresh</span> "<span class="id">EQ</span>" <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">star_step_diamond</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">S1</span> <span class="id">_</span> <span class="id">_</span> <span class="id">S2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> [<span class="id">t</span> [ [<span class="id">P</span> <span class="id">EQ</span>] | [<span class="id">P</span> <span class="id">EQ</span>] ]]; <span class="tactic">subst</span><br/>
&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">use_nostep</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [ <span class="id">S</span>: <span class="id">Step</span> <span class="id">L</span> ?<span class="id">s</span> <span class="id">_</span> <span class="id">_</span>, <span class="id">NO</span>: <span class="id">Nostep</span> <span class="id">L</span> ?<span class="id">s</span> |- <span class="id">_</span> ] =&gt; <span class="tactic">elim</span> (<span class="id">NO</span> <span class="id">_</span> <span class="id">_</span> <span class="id">S</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">star_step_triangle</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s0</span> <span class="id">t1</span> <span class="id">s1</span> <span class="id">t2</span> <span class="id">s2</span>,<br/>
&nbsp;&nbsp;<span class="id">Star</span> <span class="id">L</span> <span class="id">s0</span> <span class="id">t1</span> <span class="id">s1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">Star</span> <span class="id">L</span> <span class="id">s0</span> <span class="id">t2</span> <span class="id">s2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">Nostep</span> <span class="id">L</span> <span class="id">s2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;<span class="id">Star</span> <span class="id">L</span> <span class="id">s1</span> <span class="id">t</span> <span class="id">s2</span> /\ <span class="id">t2</span> = <span class="id">t1</span> ** <span class="id">t</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2027')">Proof.</div>
<div class="proofscript" id="proof2027">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">use_star_step_diamond</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">t</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">P</span>. <span class="id">exists</span> <span class="id">E0</span>. <span class="tactic">split</span>. <span class="id">constructor</span>. <span class="id">traceEq</span>.<br/>
&nbsp;&nbsp;<span class="id">use_nostep</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Ltac</span> <span class="id">use_star_step_triangle</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [ <span class="id">S1</span>: <span class="id">Star</span> <span class="id">L</span> <span class="id">_</span> ?<span class="id">t1</span> <span class="id">_</span>, <span class="id">S2</span>: <span class="id">Star</span> <span class="id">L</span> <span class="id">_</span> ?<span class="id">t2</span> ?<span class="id">s2</span>, <span class="id">NO</span>: <span class="id">Nostep</span> <span class="id">L</span> ?<span class="id">s2</span> |- <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">t</span> := <span class="tactic">fresh</span> "<span class="id">t</span>" <span class="kwd">in</span> <span class="kwd">let</span> <span class="id">P</span> := <span class="tactic">fresh</span> "<span class="id">P</span>" <span class="kwd">in</span> <span class="kwd">let</span> <span class="id">EQ</span> := <span class="tactic">fresh</span> "<span class="id">EQ</span>" <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">star_step_triangle</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">S1</span> <span class="id">S2</span> <span class="id">NO</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> [<span class="id">t</span> [<span class="id">P</span> <span class="id">EQ</span>]]; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">steps_deterministic</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s0</span> <span class="id">t1</span> <span class="id">s1</span> <span class="id">t2</span> <span class="id">s2</span>,<br/>
&nbsp;&nbsp;<span class="id">Star</span> <span class="id">L</span> <span class="id">s0</span> <span class="id">t1</span> <span class="id">s1</span> -&gt; <span class="id">Star</span> <span class="id">L</span> <span class="id">s0</span> <span class="id">t2</span> <span class="id">s2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">Nostep</span> <span class="id">L</span> <span class="id">s1</span> -&gt; <span class="id">Nostep</span> <span class="id">L</span> <span class="id">s2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">t1</span> = <span class="id">t2</span> /\ <span class="id">s1</span> = <span class="id">s2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2028')">Proof.</div>
<div class="proofscript" id="proof2028">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">use_star_step_triangle</span>. <span class="id">inv</span> <span class="id">P</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">auto</span>; <span class="id">traceEq</span>. <span class="id">use_nostep</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">terminates_not_goes_wrong</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">t1</span> <span class="id">s1</span> <span class="id">r</span> <span class="id">t2</span> <span class="id">s2</span>,<br/>
&nbsp;&nbsp;<span class="id">Star</span> <span class="id">L</span> <span class="id">s</span> <span class="id">t1</span> <span class="id">s1</span> -&gt; <span class="id">final_state</span> <span class="id">L</span> <span class="id">s1</span> <span class="id">r</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">Star</span> <span class="id">L</span> <span class="id">s</span> <span class="id">t2</span> <span class="id">s2</span> -&gt; <span class="id">Nostep</span> <span class="id">L</span> <span class="id">s2</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">r</span>, ~<span class="id">final_state</span> <span class="id">L</span> <span class="id">s2</span> <span class="id">r</span>) -&gt; <span class="id">False</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2029')">Proof.</div>
<div class="proofscript" id="proof2029">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">t1</span> = <span class="id">t2</span> /\ <span class="id">s1</span> = <span class="id">s2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">steps_deterministic</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">det_final_nostep</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H4</span>; <span class="tactic">subst</span>. <span class="tactic">elim</span> (<span class="id">H3</span> <span class="id">_</span> <span class="id">H0</span>).<br/>
Qed.</div>
<br/>
<div class="doc">Determinism for infinite transition sequences. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id">star_final_not_forever_silent</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">t</span> <span class="id">s</span>', <span class="id">Star</span> <span class="id">L</span> <span class="id">s</span> <span class="id">t</span> <span class="id">s</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">Nostep</span> <span class="id">L</span> <span class="id">s</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">Forever_silent</span> <span class="id">L</span> <span class="id">s</span> -&gt; <span class="id">False</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2030')">Proof.</div>
<div class="proofscript" id="proof2030">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>. <span class="id">use_nostep</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H3</span>. <span class="id">use_step_deterministic</span>. <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">star2_final_not_forever_silent</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">t1</span> <span class="id">s1</span> <span class="id">t2</span> <span class="id">s2</span>,<br/>
&nbsp;&nbsp;<span class="id">Star</span> <span class="id">L</span> <span class="id">s</span> <span class="id">t1</span> <span class="id">s1</span> -&gt; <span class="id">Nostep</span> <span class="id">L</span> <span class="id">s1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">Star</span> <span class="id">L</span> <span class="id">s</span> <span class="id">t2</span> <span class="id">s2</span> -&gt; <span class="id">Forever_silent</span> <span class="id">L</span> <span class="id">s2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">False</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2031')">Proof.</div>
<div class="proofscript" id="proof2031">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">use_star_step_triangle</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_final_not_forever_silent</span>. <span class="id">eexact</span> <span class="id">P</span>. <span class="tactic">eauto</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">star_final_not_forever_reactive</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">t</span> <span class="id">s</span>', <span class="id">Star</span> <span class="id">L</span> <span class="id">s</span> <span class="id">t</span> <span class="id">s</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">T</span>, <span class="id">Nostep</span> <span class="id">L</span> <span class="id">s</span>' -&gt; <span class="id">Forever_reactive</span> <span class="id">L</span> <span class="id">s</span> <span class="id">T</span> -&gt; <span class="id">False</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2032')">Proof.</div>
<div class="proofscript" id="proof2032">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>. <span class="id">inv</span> <span class="id">H1</span>. <span class="tactic">congruence</span>. <span class="id">use_nostep</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H3</span>. <span class="id">inv</span> <span class="id">H4</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="id">use_step_deterministic</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHstar</span> <span class="kwd">with</span> (<span class="id">T</span> := <span class="id">t4</span> *** <span class="id">T0</span>). <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_forever_reactive</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">star_forever_silent_inv</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">t</span> <span class="id">s</span>', <span class="id">Star</span> <span class="id">L</span> <span class="id">s</span> <span class="id">t</span> <span class="id">s</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">Forever_silent</span> <span class="id">L</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">t</span> = <span class="id">E0</span> /\ <span class="id">Forever_silent</span> <span class="id">L</span> <span class="id">s</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2033')">Proof.</div>
<div class="proofscript" id="proof2033">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="id">inv</span> <span class="id">H2</span>. <span class="id">use_step_deterministic</span>. <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">forever_silent_reactive_exclusive</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">T</span>,<br/>
&nbsp;&nbsp;<span class="id">Forever_silent</span> <span class="id">L</span> <span class="id">s</span> -&gt; <span class="id">Forever_reactive</span> <span class="id">L</span> <span class="id">s</span> <span class="id">T</span> -&gt; <span class="id">False</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2034')">Proof.</div>
<div class="proofscript" id="proof2034">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H0</span>. <span class="id">exploit</span> <span class="id">star_forever_silent_inv</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">A</span> <span class="id">B</span>]. <span class="id">contradiction</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">forever_reactive_inv2</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">t1</span> <span class="id">s1</span>, <span class="id">Star</span> <span class="id">L</span> <span class="id">s</span> <span class="id">t1</span> <span class="id">s1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t2</span> <span class="id">s2</span> <span class="id">T1</span> <span class="id">T2</span>,<br/>
&nbsp;&nbsp;<span class="id">Star</span> <span class="id">L</span> <span class="id">s</span> <span class="id">t2</span> <span class="id">s2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">t1</span> &lt;&gt; <span class="id">E0</span> -&gt; <span class="id">t2</span> &lt;&gt; <span class="id">E0</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">Forever_reactive</span> <span class="id">L</span> <span class="id">s1</span> <span class="id">T1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">Forever_reactive</span> <span class="id">L</span> <span class="id">s2</span> <span class="id">T2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">s</span>', <span class="id">exists</span> <span class="id">t</span>, <span class="id">exists</span> <span class="id">T1</span>', <span class="id">exists</span> <span class="id">T2</span>',<br/>
&nbsp;&nbsp;<span class="id">t</span> &lt;&gt; <span class="id">E0</span> /\<br/>
&nbsp;&nbsp;<span class="id">Forever_reactive</span> <span class="id">L</span> <span class="id">s</span>' <span class="id">T1</span>' /\<br/>
&nbsp;&nbsp;<span class="id">Forever_reactive</span> <span class="id">L</span> <span class="id">s</span>' <span class="id">T2</span>' /\<br/>
&nbsp;&nbsp;<span class="id">t1</span> *** <span class="id">T1</span> = <span class="id">t</span> *** <span class="id">T1</span>' /\<br/>
&nbsp;&nbsp;<span class="id">t2</span> *** <span class="id">T2</span> = <span class="id">t</span> *** <span class="id">T2</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2035')">Proof.</div>
<div class="proofscript" id="proof2035">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>. <span class="tactic">congruence</span>. <span class="id">use_step_deterministic</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">t3</span>.<br/>
&nbsp;inductive&nbsp;case&nbsp;*)</span>&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">eapply</span> <span class="id">IHstar</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;base&nbsp;case&nbsp;*)</span>&nbsp;&nbsp;<span class="id">exists</span> <span class="id">s5</span>; <span class="id">exists</span> (<span class="id">e</span> :: <span class="id">t3</span>);<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">t2</span> *** <span class="id">T1</span>); <span class="id">exists</span> (<span class="id">t4</span> *** <span class="id">T2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">unfold</span> <span class="id">E0</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">eapply</span> <span class="id">star_forever_reactive</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">eapply</span> <span class="id">star_forever_reactive</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="id">traceEq</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">forever_reactive_determ</span>':<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">T1</span> <span class="id">T2</span>,<br/>
&nbsp;&nbsp;<span class="id">Forever_reactive</span> <span class="id">L</span> <span class="id">s</span> <span class="id">T1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">Forever_reactive</span> <span class="id">L</span> <span class="id">s</span> <span class="id">T2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">traceinf_sim</span>' <span class="id">T1</span> <span class="id">T2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2036')">Proof.</div>
<div class="proofscript" id="proof2036">
&nbsp;&nbsp;<span class="id">cofix</span> <span class="id">COINDHYP</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">forever_reactive_inv2</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span> <span class="id">t</span> <span class="id">s2</span> <span class="id">T0</span> <span class="id">T</span>)<br/>
&nbsp;&nbsp;<span class="kwd">as</span> [<span class="id">s</span>' [<span class="id">t</span>' [<span class="id">T1</span>' [<span class="id">T2</span>' [<span class="id">A</span> [<span class="id">B</span> [<span class="id">C</span> [<span class="id">D</span> <span class="id">E</span>]]]]]]]]; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">D</span>; <span class="tactic">rewrite</span> <span class="id">E</span>. <span class="id">constructor</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">COINDHYP</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">forever_reactive_determ</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">T1</span> <span class="id">T2</span>,<br/>
&nbsp;&nbsp;<span class="id">Forever_reactive</span> <span class="id">L</span> <span class="id">s</span> <span class="id">T1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">Forever_reactive</span> <span class="id">L</span> <span class="id">s</span> <span class="id">T2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">traceinf_sim</span> <span class="id">T1</span> <span class="id">T2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2037')">Proof.</div>
<div class="proofscript" id="proof2037">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">traceinf_sim</span>'<span class="id">_sim</span>. <span class="tactic">eapply</span> <span class="id">forever_reactive_determ</span>'; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">star_forever_reactive_inv</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">t</span> <span class="id">s</span>', <span class="id">Star</span> <span class="id">L</span> <span class="id">s</span> <span class="id">t</span> <span class="id">s</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">T</span>, <span class="id">Forever_reactive</span> <span class="id">L</span> <span class="id">s</span> <span class="id">T</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">T</span>', <span class="id">Forever_reactive</span> <span class="id">L</span> <span class="id">s</span>' <span class="id">T</span>' /\ <span class="id">T</span> = <span class="id">t</span> *** <span class="id">T</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2038')">Proof.</div>
<div class="proofscript" id="proof2038">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">T</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>. <span class="id">inv</span> <span class="id">H3</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="id">use_step_deterministic</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">IHstar</span>. <span class="tactic">eapply</span> <span class="id">star_forever_reactive</span>. 2: <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">T</span>' [<span class="id">A</span> <span class="id">B</span>]]. <span class="id">exists</span> <span class="id">T</span>'; <span class="tactic">intuition</span>. <span class="id">traceEq</span>. <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">forever_silent_reactive_exclusive2</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">t</span> <span class="id">s</span>' <span class="id">T</span>,<br/>
&nbsp;&nbsp;<span class="id">Star</span> <span class="id">L</span> <span class="id">s</span> <span class="id">t</span> <span class="id">s</span>' -&gt; <span class="id">Forever_silent</span> <span class="id">L</span> <span class="id">s</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">Forever_reactive</span> <span class="id">L</span> <span class="id">s</span> <span class="id">T</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">False</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2039')">Proof.</div>
<div class="proofscript" id="proof2039">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id">star_forever_reactive_inv</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">T</span>' [<span class="id">A</span> <span class="id">B</span>]]. <span class="tactic">subst</span> <span class="id">T</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">forever_silent_reactive_exclusive</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Determinism for program executions </div>
<br/>
<span class="kwd">Definition</span> <span class="id">same_behaviors</span> (<span class="id">beh1</span> <span class="id">beh2</span>: <span class="id">program_behavior</span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">beh1</span>, <span class="id">beh2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Terminates</span> <span class="id">t1</span> <span class="id">r1</span>, <span class="id">Terminates</span> <span class="id">t2</span> <span class="id">r2</span> =&gt; <span class="id">t1</span> = <span class="id">t2</span> /\ <span class="id">r1</span> = <span class="id">r2</span><br/>
&nbsp;&nbsp;| <span class="id">Diverges</span> <span class="id">t1</span>, <span class="id">Diverges</span> <span class="id">t2</span> =&gt; <span class="id">t1</span> = <span class="id">t2</span><br/>
&nbsp;&nbsp;| <span class="id">Reacts</span> <span class="id">t1</span>, <span class="id">Reacts</span> <span class="id">t2</span> =&gt; <span class="id">traceinf_sim</span> <span class="id">t1</span> <span class="id">t2</span><br/>
&nbsp;&nbsp;| <span class="id">Goes_wrong</span> <span class="id">t1</span>, <span class="id">Goes_wrong</span> <span class="id">t2</span> =&gt; <span class="id">t1</span> = <span class="id">t2</span><br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">False</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">state_behaves_deterministic</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">beh1</span> <span class="id">beh2</span>,<br/>
&nbsp;&nbsp;<span class="id">state_behaves</span> <span class="id">L</span> <span class="id">s</span> <span class="id">beh1</span> -&gt; <span class="id">state_behaves</span> <span class="id">L</span> <span class="id">s</span> <span class="id">beh2</span> -&gt; <span class="id">same_behaviors</span> <span class="id">beh1</span> <span class="id">beh2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2040')">Proof.</div>
<div class="proofscript" id="proof2040">
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">det_final_nostep</span> <span class="id">L</span> <span class="id">DET</span>); <span class="tactic">intro</span> <span class="id">dfns</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">beh2</span>; <span class="tactic">intros</span> <span class="id">BEH1</span> <span class="id">BEH2</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">BEH1</span>; <span class="id">inv</span> <span class="id">BEH2</span>; <span class="tactic">red</span>.<br/>
&nbsp;terminates,&nbsp;terminates&nbsp;*)</span>&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">t</span> = <span class="id">t0</span> /\ <span class="id">s</span>' = <span class="id">s</span>'0). <span class="tactic">eapply</span> <span class="id">steps_deterministic</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H3</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">subst</span>. <span class="tactic">eapply</span> <span class="id">det_final_state</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;terminates,&nbsp;diverges&nbsp;*)</span>&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star2_final_not_forever_silent</span> <span class="kwd">with</span> (<span class="id">s1</span> := <span class="id">s</span>') (<span class="id">s2</span> := <span class="id">s</span>'0); <span class="tactic">eauto</span>.<br/>
&nbsp;terminates,&nbsp;reacts&nbsp;*)</span>&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_final_not_forever_reactive</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;terminates,&nbsp;goes_wrong&nbsp;*)</span>&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">terminates_not_goes_wrong</span> <span class="kwd">with</span> (<span class="id">s1</span> := <span class="id">s</span>') (<span class="id">s2</span> := <span class="id">s</span>'0); <span class="tactic">eauto</span>.<br/>
&nbsp;diverges,&nbsp;terminates&nbsp;*)</span>&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star2_final_not_forever_silent</span> <span class="kwd">with</span> (<span class="id">s2</span> := <span class="id">s</span>') (<span class="id">s1</span> := <span class="id">s</span>'0); <span class="tactic">eauto</span>.<br/>
&nbsp;diverges,&nbsp;diverges&nbsp;*)</span>&nbsp;&nbsp;<span class="id">use_star_step_diamond</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">star_forever_silent_inv</span>. <span class="id">eexact</span> <span class="id">P</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">A</span> <span class="id">B</span>]. <span class="tactic">subst</span>; <span class="id">traceEq</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">star_forever_silent_inv</span>. <span class="id">eexact</span> <span class="id">P</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">A</span> <span class="id">B</span>]. <span class="tactic">subst</span>; <span class="id">traceEq</span>.<br/>
&nbsp;diverges,&nbsp;reacts&nbsp;*)</span>&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">forever_silent_reactive_exclusive2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;diverges,&nbsp;goes&nbsp;wrong&nbsp;*)</span>&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star2_final_not_forever_silent</span> <span class="kwd">with</span> (<span class="id">s1</span> := <span class="id">s</span>'0) (<span class="id">s2</span> := <span class="id">s</span>'); <span class="tactic">eauto</span>.<br/>
&nbsp;reacts,&nbsp;terminates&nbsp;*)</span>&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_final_not_forever_reactive</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;reacts,&nbsp;diverges&nbsp;*)</span>&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">forever_silent_reactive_exclusive2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;reacts,&nbsp;reacts&nbsp;*)</span>&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">forever_reactive_determ</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;reacts,&nbsp;goes&nbsp;wrong&nbsp;*)</span>&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_final_not_forever_reactive</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;goes&nbsp;wrong,&nbsp;terminate&nbsp;*)</span>&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">terminates_not_goes_wrong</span> <span class="kwd">with</span> (<span class="id">s1</span> := <span class="id">s</span>'0) (<span class="id">s2</span> := <span class="id">s</span>'); <span class="tactic">eauto</span>.<br/>
&nbsp;goes&nbsp;wrong,&nbsp;diverges&nbsp;*)</span>&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star2_final_not_forever_silent</span> <span class="kwd">with</span> (<span class="id">s1</span> := <span class="id">s</span>') (<span class="id">s2</span> := <span class="id">s</span>'0); <span class="tactic">eauto</span>.<br/>
&nbsp;goes&nbsp;wrong,&nbsp;reacts&nbsp;*)</span>&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">star_final_not_forever_reactive</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;goes&nbsp;wrong,&nbsp;goes&nbsp;wrong&nbsp;*)</span>&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">t</span> = <span class="id">t0</span> /\ <span class="id">s</span>' = <span class="id">s</span>'0). <span class="tactic">eapply</span> <span class="id">steps_deterministic</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id">program_behaves_deterministic</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">beh1</span> <span class="id">beh2</span>,<br/>
&nbsp;&nbsp;<span class="id">program_behaves</span> <span class="id">L</span> <span class="id">beh1</span> -&gt; <span class="id">program_behaves</span> <span class="id">L</span> <span class="id">beh2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">same_behaviors</span> <span class="id">beh1</span> <span class="id">beh2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2041')">Proof.</div>
<div class="proofscript" id="proof2041">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">beh2</span>; <span class="tactic">intros</span> <span class="id">BEH1</span> <span class="id">BEH2</span>. <span class="id">inv</span> <span class="id">BEH1</span>; <span class="id">inv</span> <span class="id">BEH2</span>.<br/>
&nbsp;both&nbsp;initial&nbsp;states&nbsp;defined&nbsp;*)</span>&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">s</span> = <span class="id">s0</span>) <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id">det_initial_state</span>; <span class="tactic">eauto</span>). <span class="tactic">subst</span> <span class="id">s0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">state_behaves_deterministic</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;one&nbsp;initial&nbsp;state&nbsp;defined,&nbsp;the&nbsp;other&nbsp;undefined&nbsp;*)</span>&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">H1</span> <span class="id">_</span> <span class="id">H</span>).<br/>
&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">H</span> <span class="id">_</span> <span class="id">H0</span>).<br/>
&nbsp;both&nbsp;initial&nbsp;states&nbsp;undefined&nbsp;*)</span>&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">DETERM_SEM</span>.<br/>
<br/>
<h1> Integrating an external world in a semantics. </h1>
<br/>
<div class="doc">Given a transition semantics, we can build another semantics that
  integrates an external world in its state and allows only world-possible
  transitions. </div>
<br/>
<span class="kwd">Section</span> <span class="id">WORLD_SEM</span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id">L</span>: <span class="id">semantics</span>.<br/>
<span class="kwd">Variable</span> <span class="id">initial_world</span>: <span class="id">world</span>.<br/>
<br/>
<span class="kwd">Notation</span> "<span class="id">s</span> #1" := (<span class="id">fst</span> <span class="id">s</span>) (<span class="tactic">at</span> <span class="id">level</span> 9, <span class="id">format</span> "<span class="id">s</span> '#1'") : <span class="id">pair_scope</span>.<br/>
<span class="kwd">Notation</span> "<span class="id">s</span> #2" := (<span class="id">snd</span> <span class="id">s</span>) (<span class="tactic">at</span> <span class="id">level</span> 9, <span class="id">format</span> "<span class="id">s</span> '#2'") : <span class="id">pair_scope</span>.<br/>
<span class="kwd">Local</span> <span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">pair_scope</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">world_sem</span> : <span class="id">semantics</span> := @<span class="id">Semantics_gen</span><br/>
&nbsp;&nbsp;(<span class="id">state</span> <span class="id">L</span> * <span class="id">world</span>)%<span class="id">type</span><br/>
&nbsp;&nbsp;(<span class="id">genvtype</span> <span class="id">L</span>)<br/>
&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">ge</span> <span class="id">s</span> <span class="id">t</span> <span class="id">s</span>' =&gt; <span class="id">step</span> <span class="id">L</span> <span class="id">ge</span> <span class="id">s</span>#1 <span class="id">t</span> <span class="id">s</span>'#1 /\ <span class="id">possible_trace</span> <span class="id">s</span>#2 <span class="id">t</span> <span class="id">s</span>'#2)<br/>
&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">s</span> =&gt; <span class="id">initial_state</span> <span class="id">L</span> <span class="id">s</span>#1 /\ <span class="id">s</span>#2 = <span class="id">initial_world</span>)<br/>
&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">s</span> <span class="id">r</span> =&gt; <span class="id">final_state</span> <span class="id">L</span> <span class="id">s</span>#1 <span class="id">r</span>)<br/>
&nbsp;&nbsp;(<span class="id">globalenv</span> <span class="id">L</span>)<br/>
&nbsp;&nbsp;(<span class="id">symbolenv</span> <span class="id">L</span>).<br/>
<br/>
<div class="doc">If the original semantics is determinate, the world-aware semantics is deterministic. </div>
<br/>
<span class="kwd">Hypothesis</span> <span class="id">D</span>: <span class="id">determinate</span> <span class="id">L</span>.<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id">world_sem_deterministic</span>: <span class="id">sem_deterministic</span> <span class="id">world_sem</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2042')">Proof.</div>
<div class="proofscript" id="proof2042">
&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;steps&nbsp;*)</span>&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">destruct</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">sd_determ</span> <span class="id">D</span>). <span class="id">eexact</span> <span class="id">H</span>. <span class="id">eexact</span> <span class="id">H0</span>. <span class="tactic">intros</span> [<span class="id">A</span> <span class="id">B</span>].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">match_possible_traces</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">EQ1</span> <span class="id">EQ2</span>]. <span class="tactic">subst</span> <span class="id">t2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">surjective_pairing</span> <span class="id">s1</span>). <span class="tactic">rewrite</span> (<span class="id">surjective_pairing</span> <span class="id">s2</span>). <span class="tactic">intuition</span> <span class="tactic">congruence</span>.<br/>
&nbsp;initial&nbsp;states&nbsp;*)</span>&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">destruct</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">surjective_pairing</span> <span class="id">s1</span>). <span class="tactic">rewrite</span> (<span class="id">surjective_pairing</span> <span class="id">s2</span>). <span class="id">decEq</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> (<span class="id">sd_initial_determ</span> <span class="id">D</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;final&nbsp;states&nbsp;*)</span>&nbsp;&nbsp;<span class="tactic">eapply</span> (<span class="id">sd_final_determ</span> <span class="id">D</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;final&nbsp;no&nbsp;step&nbsp;*)</span>&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>. <span class="tactic">red</span>; <span class="tactic">intros</span> [<span class="id">A</span> <span class="id">B</span>]. <span class="id">exploit</span> (<span class="id">sd_final_nostep</span> <span class="id">D</span>); <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">WORLD_SEM</span>.<br/>
<br/>
<br/>
</div>
<div class="footer"><hr/>Generated by coq2html</div>
</body>
</html>
