<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module TSOMem</title>
<meta name="description" content="Documentation of Coq module TSOMem" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module TSOMem</h1>
<div class="coq">
<div class="doc">This file gives the definitions of the TSO memory and some operations 
on tso memory </div>
<div class="doc">The TSO model is defined following the approach of CompCertTSO </div>
<br/>
<span class="id">From</span> <span class="id">mathcomp.ssreflect</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">fintype</span> <span class="id">ssrnat</span>. <br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Coqlib.html">Coqlib</a></span> <span class="id"><a href="Maps.html">Maps</a></span> <span class="id"><a href="Axioms.html">Axioms</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="AST.html">AST</a></span> <span class="id"><a href="Integers.html">Integers</a></span> <span class="id"><a href="Floats.html">Floats</a></span> <span class="id"><a href="Values.html">Values</a></span> <span class="id"><a href="Events.html">Events</a></span> <span class="id"><a href="Globalenvs.html">Globalenvs</a></span> <span class="id"><a href="Smallstep.html">Smallstep</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Locations.html">Locations</a></span> <span class="id"><a href="Stacklayout.html">Stacklayout</a></span> <span class="id"><a href="Conventions.html">Conventions</a></span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Asm.html">Asm</a></span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="CUAST.html">CUAST</a></span> <span class="id"><a href="FMemOpFP.html">FMemOpFP</a></span> <span class="id"><a href="ValFP.html">ValFP</a></span> <span class="id"><a href="Op_fp.html">Op_fp</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Strings.String.html">String</a></span> <span class="id"><a href="val_casted.html">val_casted</a></span> <span class="id"><a href="helpers.html">helpers</a></span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Footprint.html">Footprint</a></span> <span class="id"><a href="GMemory.html">GMemory</a></span> <span class="id"><a href="FMemory.html">FMemory</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="GAST.html">GAST</a></span> <span class="id"><a href="GlobDefs.html">GlobDefs</a></span> <span class="id"><a href="ETrace.html">ETrace</a></span> <span class="id"><a href="Blockset.html">Blockset</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="loadframe.html">loadframe</a></span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html">Coq.Lists.Streams</a></span> <span class="id"><a href="InteractionSemantics.html">InteractionSemantics</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zwf.html">Zwf</a></span>.<br/>
<br/>
<span class="kwd">Set</span> <span class="kwd">Implicit</span> <span class="id">Arguments</span>.<br/>
&nbsp;<br/>
<span class="kwd">Definition</span> <span class="id"><a name="perm_dec">perm_dec</a></span> (<span class="id">gm</span> : <span class="id"><a href="GMemory.html#gmem">gmem</a></span>) (<span class="id">b</span> : <span class="id"><a href="Values.html#block">block</a></span>) (<span class="id">ofs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">k</span> : <span class="id"><a href="Memperm.html#perm_kind">Memperm.perm_kind</a></span>) (<span class="id">p</span> : <span class="id"><a href="Memperm.html#permission">Memperm.permission</a></span>) :=<br/>
&nbsp;&nbsp;<span class="id">Mem.perm_order</span>'<span class="id">_dec</span> (<span class="id"><a href="Maps.html#PMap.get">Maps.PMap.get</a></span> <span class="id"><a href="TSOMem.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMem.html#gm">gm</a></span>) <span class="id"><a href="TSOMem.html#ofs">ofs</a></span> <span class="id"><a href="TSOMem.html#k">k</a></span>) <span class="id"><a href="TSOMem.html#p">p</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="range_perm">range_perm</a></span> (<span class="id">m</span> : <span class="id"><a href="GMemory.html#gmem">gmem</a></span>) (<span class="id">b</span> : <span class="id"><a href="Values.html#block">block</a></span>) (<span class="id">lo</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">hi</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) (<span class="id">k</span> : <span class="id"><a href="Memperm.html#perm_kind">Memperm.perm_kind</a></span>) (<span class="id">p</span> : <span class="id"><a href="Memperm.html#permission">Memperm.permission</a></span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ofs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>, <span class="id"><a href="TSOMem.html#lo">lo</a></span> &lt;= <span class="id"><a href="TSOMem.html#ofs">ofs</a></span> &lt; <span class="id"><a href="TSOMem.html#hi">hi</a></span> -&gt; <span class="id">Mem.perm_order</span>' ((<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMem.html#m">m</a></span>) !! <span class="id"><a href="TSOMem.html#b">b</a></span> <span class="id"><a href="TSOMem.html#ofs">ofs</a></span> <span class="id"><a href="TSOMem.html#k">k</a></span>) <span class="id"><a href="TSOMem.html#p">p</a></span>.<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="range_perm_dec">range_perm_dec</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">m</span> : <span class="id"><a href="GMemory.html#gmem">gmem</a></span>) (<span class="id">b</span> : <span class="id"><a href="Values.html#block">block</a></span>) (<span class="id">lo</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">hi</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) (<span class="id">k</span> : <span class="id"><a href="Memperm.html#perm_kind">Memperm.perm_kind</a></span>) (<span class="id">p</span> : <span class="id"><a href="Memperm.html#permission">Memperm.permission</a></span>),<br/>
&nbsp;&nbsp;{<span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> <span class="id"><a href="TSOMem.html#m">m</a></span> <span class="id"><a href="TSOMem.html#b">b</a></span> <span class="id"><a href="TSOMem.html#lo">lo</a></span> <span class="id"><a href="TSOMem.html#hi">hi</a></span> <span class="id"><a href="TSOMem.html#k">k</a></span> <span class="id"><a href="TSOMem.html#p">p</a></span>} + {~ <span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> <span class="id"><a href="TSOMem.html#m">m</a></span> <span class="id"><a href="TSOMem.html#b">b</a></span> <span class="id"><a href="TSOMem.html#lo">lo</a></span> <span class="id"><a href="TSOMem.html#hi">hi</a></span> <span class="id"><a href="TSOMem.html#k">k</a></span> <span class="id"><a href="TSOMem.html#p">p</a></span>}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9202')">Proof.</div>
<div class="proofscript" id="proof9202">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">lo</span> <span class="kwd">using</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Wf.html#well_founded_induction_type">well_founded_induction_type</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zwf.html#Zwf_up_well_founded">Zwf_up_well_founded</a></span> <span class="id">hi</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zlt">zlt</a></span> <span class="id">lo</span> <span class="id">hi</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#perm_dec">perm_dec</a></span> <span class="id">m</span> <span class="id">b</span> <span class="id">lo</span> <span class="id">k</span> <span class="id">p</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">H</span> (<span class="id">lo</span> + 1)). <span class="tactic">red</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="id">left</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zeq">zeq</a></span> <span class="id">lo</span> <span class="id">ofs</span>). <span class="tactic">congruence</span>. <span class="tactic">apply</span> <span class="id">r</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">elim</span> <span class="id">n</span>. <span class="tactic">red</span>; <span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id">H0</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">elim</span> <span class="id">n</span>. <span class="tactic">apply</span> <span class="id">H0</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="id">left</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="id">omegaContradiction</span>.<br/>
Qed.</div>
<span class="kwd">Definition</span> <span class="id"><a name="valid_access">valid_access</a></span> <span class="id">m</span> <span class="id">chunk</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">p</span>:=<br/>
&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> <span class="id"><a href="TSOMem.html#m">m</a></span> <span class="id"><a href="TSOMem.html#b">b</a></span> <span class="id"><a href="TSOMem.html#ofs">ofs</a></span> (<span class="id"><a href="TSOMem.html#ofs">ofs</a></span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id"><a href="TSOMem.html#chunk">chunk</a></span>) <span class="id"><a href="Memperm.html#Max">Memperm.Max</a></span> <span class="id"><a href="TSOMem.html#p">p</a></span> /\<br/>
&nbsp;&nbsp;(<span class="id"><a href="Memdata.html#align_chunk">align_chunk</a></span> <span class="id"><a href="TSOMem.html#chunk">chunk</a></span>|<span class="id"><a href="TSOMem.html#ofs">ofs</a></span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="valid_access_dec">valid_access_dec</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">chunk</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">p</span>,<br/>
&nbsp;&nbsp;{<span class="id"><a href="TSOMem.html#valid_access">valid_access</a></span> <span class="id"><a href="TSOMem.html#m">m</a></span> <span class="id"><a href="TSOMem.html#chunk">chunk</a></span> <span class="id"><a href="TSOMem.html#b">b</a></span> <span class="id"><a href="TSOMem.html#ofs">ofs</a></span> <span class="id"><a href="TSOMem.html#p">p</a></span>} + {~ <span class="id"><a href="TSOMem.html#valid_access">valid_access</a></span> <span class="id"><a href="TSOMem.html#m">m</a></span> <span class="id"><a href="TSOMem.html#chunk">chunk</a></span> <span class="id"><a href="TSOMem.html#b">b</a></span> <span class="id"><a href="TSOMem.html#ofs">ofs</a></span> <span class="id"><a href="TSOMem.html#p">p</a></span>}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9203')">Proof.</div>
<div class="proofscript" id="proof9203">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#range_perm_dec">range_perm_dec</a></span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> (<span class="id">ofs</span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id">chunk</span>) <span class="id"><a href="Memperm.html#Max">Memperm.Max</a></span> <span class="id">p</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#Zdivide_dec">Zdivide_dec</a></span> (<span class="id"><a href="Memdata.html#align_chunk">align_chunk</a></span> <span class="id">chunk</span>) <span class="id">ofs</span> (<span class="id"><a href="Memdata.html#align_chunk_pos">align_chunk_pos</a></span> <span class="id">chunk</span>)).<br/>
&nbsp;&nbsp;<span class="id">left</span>; <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">red</span>; <span class="tactic">intro</span> <span class="id">V</span>; <span class="id">inv</span> <span class="id">V</span>; <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">red</span>; <span class="tactic">intro</span> <span class="id">V</span>; <span class="id">inv</span> <span class="id">V</span>; <span class="id">contradiction</span>.<br/>
Defined.</div>
<br/>
<div class="doc">There are three types of buffer item : 
  1. <span class="bracket"><span class="id">Alloc</span></span>
  2. <span class="bracket"><span class="id">Free</span></span>
  3. <span class="bracket"><span class="id">Store</span></span>
</div>
<span class="kwd">Inductive</span> <span class="id"><a name="buffer_item">buffer_item</a></span> : <span class="kwd">Type</span> :=<br/>
| <span class="id"><a name="BufferedAlloc">BufferedAlloc</a></span> : <span class="id"><a href="Values.html#block">block</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span> -&gt; <span class="id"><a href="TSOMem.html#buffer_item">buffer_item</a></span><br/>
| <span class="id"><a name="BufferedFree">BufferedFree</a></span> : <span class="id"><a href="Values.html#block">block</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span> -&gt; <span class="id"><a href="TSOMem.html#buffer_item">buffer_item</a></span><br/>
| <span class="id"><a name="BufferedStore">BufferedStore</a></span> : <span class="id"><a href="AST.html#memory_chunk">memory_chunk</a></span> -&gt; <span class="id"><a href="Values.html#block">block</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span> -&gt; <span class="id"><a href="Values.html#val">val</a></span> -&gt; <span class="id"><a href="TSOMem.html#buffer_item">buffer_item</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="loadbytes">loadbytes</a></span> (<span class="id">m</span> : <span class="id"><a href="GMemory.html#gmem">gmem</a></span>) (<span class="id">b</span> : <span class="id"><a href="Values.html#block">block</a></span>) (<span class="id">ofs</span> <span class="id">n</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="TSOMem.html#range_perm_dec">range_perm_dec</a></span> <span class="id"><a href="TSOMem.html#m">m</a></span> <span class="id"><a href="TSOMem.html#b">b</a></span> <span class="id"><a href="TSOMem.html#ofs">ofs</a></span> (<span class="id"><a href="TSOMem.html#ofs">ofs</a></span> + <span class="id"><a href="TSOMem.html#n">n</a></span>) <span class="id"><a href="Memperm.html#Max">Memperm.Max</a></span> <span class="id"><a href="Memperm.html#Readable">Memperm.Readable</a></span> <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="FMemory.html#Mem.getN">Mem.getN</a></span> (<span class="id"><a href="Coqlib.html#nat_of_Z">nat_of_Z</a></span> <span class="id"><a href="TSOMem.html#n">n</a></span>) <span class="id"><a href="TSOMem.html#ofs">ofs</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id"><a href="TSOMem.html#m">m</a></span>) !! <span class="id"><a href="TSOMem.html#b">b</a></span>)<br/>
&nbsp;&nbsp;<span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
<br/>
<div class="doc">
Here, we define <span class="bracket"><span class="id">load</span></span>, <span class="bracket"><span class="id">store</span></span>, <span class="bracket"><span class="id">alloc</span></span> and <span class="bracket"><span class="id">free</span></span> operations on GMemory.
<ul>
<li>
 <span class="bracket"><span class="id">load</span></span>  : read a memory chunk at a given address in GMemory.
</li>
<li>
 <span class="bracket"><span class="id">store</span></span> : store a memory chunk at a given address in GMemory.   
</li>
<li>
 <span class="bracket"><span class="id">alloc</span></span> : alloc a fresh memory block in GMemory.
</li>
<li>
 <span class="bracket"><span class="id">free</span></span>  : invalidate a memory block in GMemory.
 </li>
</ul>
</div>
<br/>
<div class="doc">Load a value from GMemory. </div>
<span class="kwd">Definition</span> <span class="id"><a name="load">load</a></span> (<span class="id">c</span> : <span class="id"><a href="AST.html#memory_chunk">memory_chunk</a></span>) (<span class="id">m</span> : <span class="id"><a href="GMemory.html#gmem">gmem</a></span>) (<span class="id">b</span> : <span class="id"><a href="Values.html#block">block</a></span>) (<span class="id">ofs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="TSOMem.html#valid_access_dec">valid_access_dec</a></span> <span class="id"><a href="TSOMem.html#m">m</a></span> <span class="id"><a href="TSOMem.html#c">c</a></span> <span class="id"><a href="TSOMem.html#b">b</a></span> <span class="id"><a href="TSOMem.html#ofs">ofs</a></span> <span class="id"><a href="Memperm.html#Readable">Memperm.Readable</a></span><br/>
&nbsp;&nbsp;<span class="kwd">then</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="Memdata.html#decode_val">decode_val</a></span> <span class="id"><a href="TSOMem.html#c">c</a></span> (<span class="id"><a href="FMemory.html#Mem.getN">Mem.getN</a></span> (<span class="id"><a href="Memdata.html#size_chunk_nat">size_chunk_nat</a></span> <span class="id"><a href="TSOMem.html#c">c</a></span>) <span class="id"><a href="TSOMem.html#ofs">ofs</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id"><a href="TSOMem.html#m">m</a></span>) !! <span class="id"><a href="TSOMem.html#b">b</a></span>))<br/>
&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
<br/>
<div class="doc">Store a value in GMemory. </div>
<span class="kwd">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="store">store</a></span> (<span class="id">c</span> : <span class="id"><a href="AST.html#memory_chunk">memory_chunk</a></span>) (<span class="id">m</span>: <span class="id"><a href="GMemory.html#gmem">gmem</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">b</span>: <span class="id"><a href="Values.html#block">block</a></span>) (<span class="id">ofs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) (<span class="id">v</span>: <span class="id"><a href="Values.html#val">val</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="GMemory.html#gmem">gmem</a></span> :=<br/>
<span class="kwd">if</span> <span class="id"><a href="TSOMem.html#valid_access_dec">valid_access_dec</a></span> <span class="id"><a href="TSOMem.html#m">m</a></span> <span class="id"><a href="TSOMem.html#c">c</a></span> <span class="id"><a href="TSOMem.html#b">b</a></span> <span class="id"><a href="TSOMem.html#ofs">ofs</a></span> <span class="id"><a href="Memperm.html#Writable">Memperm.Writable</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="GMemory.html#GMem.mk_gmem">GMem.mk_gmem</a></span> (<span class="id"><a href="Maps.html#PMap.set">PMap.set</a></span> <span class="id"><a href="TSOMem.html#b">b</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="FMemory.html#Mem.setN">Mem.setN</a></span> (<span class="id"><a href="Memdata.html#encode_val">encode_val</a></span> <span class="id"><a href="TSOMem.html#c">c</a></span> <span class="id"><a href="TSOMem.html#v">v</a></span>) <span class="id"><a href="TSOMem.html#ofs">ofs</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Maps.html#PMap.get">PMap.get</a></span> <span class="id"><a href="TSOMem.html#b">b</a></span> <span class="id"><a href="TSOMem.html#m">m</a></span>.(<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#m">m</a></span>.(<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOMem.html#m">m</a></span>.(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOMem.html#m">m</a></span>.(<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">_</span> <span class="id">_</span> <span class="id">_</span>)<br/>
<span class="kwd">else</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9204')">Next Obligation.</div>
<div class="proofscript" id="proof9204">
 <span class="tactic">apply</span> <span class="id"><a href="GMemory.html#GMem.access_max">GMem.access_max</a></span>. Qed.</div>
<div class="toggleproof" onclick="toggleDisplay('proof9205')">Next Obligation.</div>
<div class="proofscript" id="proof9205">
 <span class="tactic">apply</span> <span class="id"><a href="GMemory.html#GMem.invalid_noaccess">GMem.invalid_noaccess</a></span>; <span class="tactic">auto</span>. Qed.</div>
<div class="toggleproof" onclick="toggleDisplay('proof9206')">Next Obligation.</div>
<div class="proofscript" id="proof9206">
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span>. <span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">b0</span> <span class="id">b</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="FMemory.html#Mem.setN_default">Mem.setN_default</a></span>. <span class="tactic">apply</span> <span class="id"><a href="GMemory.html#GMem.contents_default">GMem.contents_default</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="GMemory.html#GMem.contents_default">GMem.contents_default</a></span>.<br/>
Qed.</div>
<div class="doc">Alloc a block in GMemory. </div>
<span class="kwd">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="alloc">alloc</a></span> (<span class="id">m</span>: <span class="id"><a href="GMemory.html#gmem">gmem</a></span>)(<span class="id">b</span>:<span class="id"><a href="Values.html#block">block</a></span>) (<span class="id">lo</span> <span class="id">hi</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) :=<br/>
&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span>  (<span class="id"><a href="GMemory.html#GMem.mk_gmem">GMem.mk_gmem</a></span> (<span class="id"><a href="Maps.html#PMap.set">PMap.set</a></span> <span class="id"><a href="TSOMem.html#b">b</a></span> (<span class="id"><a href="Maps.html#ZMap.init">ZMap.init</a></span> <span class="id"><a href="Memdata.html#Undef">Undef</a></span>) <span class="id"><a href="TSOMem.html#m">m</a></span>.(<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Maps.html#PMap.set">PMap.set</a></span> <span class="id"><a href="TSOMem.html#b">b</a></span> (<span class="kwd">fun</span> <span class="id">ofs</span> <span class="id">k</span> =&gt; <span class="kwd">if</span> <span class="id"><a href="Coqlib.html#zle">zle</a></span> <span class="id"><a href="TSOMem.html#lo">lo</a></span> <span class="id"><a href="TSOMem.html#ofs">ofs</a></span> &amp;&amp; <span class="id"><a href="Coqlib.html#zlt">zlt</a></span> <span class="id"><a href="TSOMem.html#ofs">ofs</a></span> <span class="id"><a href="TSOMem.html#hi">hi</a></span> <span class="kwd">then</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="Memperm.html#Freeable">Memperm.Freeable</a></span> <span class="kwd">else</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>) <span class="id"><a href="TSOMem.html#m">m</a></span>.(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOMem.html#b">b</a></span> :: <span class="id"><a href="TSOMem.html#m">m</a></span>.(<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">_</span> <span class="id">_</span> <span class="id">_</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9207')">Next Obligation.</div>
<div class="proofscript" id="proof9207">
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="GMemory.html#GMem.access_max">GMem.access_max</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zle">zle</a></span> <span class="id">lo</span> <span class="id">ofs</span> &amp;&amp; <span class="id"><a href="Coqlib.html#zlt">zlt</a></span> <span class="id">ofs</span> <span class="id">hi</span>);<span class="id">constructor</span>.<br/>
Qed.</div>
<div class="toggleproof" onclick="toggleDisplay('proof9208')">Next Obligation.</div>
<div class="proofscript" id="proof9208">
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span>;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>.<br/>
&nbsp;&nbsp;<span class="id">contradict</span> <span class="id">H</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="GMemory.html#GMem.invalid_noaccess">GMem.invalid_noaccess</a></span>;<span class="tactic">auto</span>.<br/>
Qed.</div>
<div class="toggleproof" onclick="toggleDisplay('proof9209')">Next Obligation.</div>
<div class="proofscript" id="proof9209">
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span>;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="GMemory.html#GMem.contents_default">GMem.contents_default</a></span>.<br/>
Qed.</div>
<span class="kwd">Local</span> <span class="kwd">Notation</span> "<span class="id">a</span> # <span class="id">b</span>" := (<span class="id"><a href="Maps.html#PMap.get">PMap.get</a></span> <span class="id">b</span> <span class="id">a</span>) (<span class="tactic">at</span> <span class="id">level</span> 1).<br/>
<span class="kwd">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="unchecked_free">unchecked_free</a></span> (<span class="id">m</span>:<span class="id"><a href="GMemory.html#gmem">gmem</a></span>)(<span class="id">b</span>:<span class="id"><a href="Values.html#block">block</a></span>)(<span class="id">lo</span> <span class="id">hi</span>:<span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>):=<br/>
&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.mk_gmem">GMem.mk_gmem</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#m">m</a></span>.(<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Maps.html#PMap.set">PMap.set</a></span> <span class="id"><a href="TSOMem.html#b">b</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">ofs</span> <span class="id">k</span> =&gt; <span class="kwd">if</span> <span class="id"><a href="Coqlib.html#zle">zle</a></span> <span class="id"><a href="TSOMem.html#lo">lo</a></span> <span class="id"><a href="TSOMem.html#ofs">ofs</a></span> &amp;&amp; <span class="id"><a href="Coqlib.html#zlt">zlt</a></span> <span class="id"><a href="TSOMem.html#ofs">ofs</a></span> <span class="id"><a href="TSOMem.html#hi">hi</a></span> <span class="kwd">then</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> <span class="kwd">else</span> <span class="id"><a href="TSOMem.html#m">m</a></span>.(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span>)#<span class="id"><a href="TSOMem.html#b">b</a></span> <span class="id"><a href="TSOMem.html#ofs">ofs</a></span> <span class="id"><a href="TSOMem.html#k">k</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#m">m</a></span>.(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOMem.html#m">m</a></span>.(<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span>))<br/>
<span class="id">_</span> <span class="id">_</span> <span class="id">_</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9210')">Next Obligation.</div>
<div class="proofscript" id="proof9210">
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span>;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="GMemory.html#GMem.access_max">GMem.access_max</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zle">zle</a></span> <span class="id">lo</span> <span class="id">ofs</span> &amp;&amp; <span class="id"><a href="Coqlib.html#zlt">zlt</a></span> <span class="id">ofs</span> <span class="id">hi</span>);<span class="tactic">try</span> <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="GMemory.html#GMem.access_max">GMem.access_max</a></span>.<br/>
Qed.</div>
<div class="toggleproof" onclick="toggleDisplay('proof9211')">Next Obligation.</div>
<div class="proofscript" id="proof9211">
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gsspec">PMap.gsspec</a></span>;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="GMemory.html#GMem.invalid_noaccess">GMem.invalid_noaccess</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zle">zle</a></span> <span class="id">lo</span> <span class="id">ofs</span> &amp;&amp; <span class="id"><a href="Coqlib.html#zlt">zlt</a></span> <span class="id">ofs</span> <span class="id">hi</span>) ;<span class="tactic">auto</span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="GMemory.html#GMem.invalid_noaccess">GMem.invalid_noaccess</a></span>;<span class="tactic">auto</span>;<span class="tactic">congruence</span>.<br/>
Qed.</div>
<div class="toggleproof" onclick="toggleDisplay('proof9212')">Next Obligation.</div>
<div class="proofscript" id="proof9212">
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="GMemory.html#GMem.contents_default">GMem.contents_default</a></span>.<br/>
Qed.</div>
<div class="doc">Free a segment of memory in GMemory. </div>
<span class="kwd">Definition</span> <span class="id"><a name="free">free</a></span> (<span class="id">m</span>: <span class="id"><a href="GMemory.html#gmem">gmem</a></span>) (<span class="id">b</span>: <span class="id"><a href="Values.html#block">block</a></span>) (<span class="id">lo</span> <span class="id">hi</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>): <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="GMemory.html#gmem">gmem</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="TSOMem.html#range_perm_dec">range_perm_dec</a></span> <span class="id"><a href="TSOMem.html#m">m</a></span> <span class="id"><a href="TSOMem.html#b">b</a></span> <span class="id"><a href="TSOMem.html#lo">lo</a></span> <span class="id"><a href="TSOMem.html#hi">hi</a></span> <span class="id"><a href="Memperm.html#Max">Memperm.Max</a></span> <span class="id"><a href="Memperm.html#Freeable">Memperm.Freeable</a></span><br/>
&nbsp;&nbsp;<span class="kwd">then</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span>(<span class="id"><a href="TSOMem.html#unchecked_free">unchecked_free</a></span> <span class="id"><a href="TSOMem.html#m">m</a></span> <span class="id"><a href="TSOMem.html#b">b</a></span> <span class="id"><a href="TSOMem.html#lo">lo</a></span> <span class="id"><a href="TSOMem.html#hi">hi</a></span>)<br/>
&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
<br/>
<h1> TSO Memory Model </h1>
<div class="doc"><span class="bracket"><span class="id">apply_buffer_item</span></span> : applies a given buffer item to the given memory state. </div>
<span class="kwd">Definition</span> <span class="id"><a name="apply_buffer_item">apply_buffer_item</a></span> (<span class="id">bi</span>: <span class="id"><a href="TSOMem.html#buffer_item">buffer_item</a></span>) (<span class="id">gm</span>: <span class="id"><a href="GMemory.html#gmem">gmem</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="GMemory.html#gmem">gmem</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="TSOMem.html#bi">bi</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span> =&gt; <span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="id"><a href="TSOMem.html#gm">gm</a></span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="TSOMem.html#BufferedFree">BufferedFree</a></span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span> =&gt; <span class="id"><a href="TSOMem.html#free">free</a></span> <span class="id"><a href="TSOMem.html#gm">gm</a></span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="TSOMem.html#BufferedStore">BufferedStore</a></span> <span class="id">chunk</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span> =&gt; <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id">chunk</span> <span class="id"><a href="TSOMem.html#gm">gm</a></span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="buffer_item_eq">buffer_item_eq</a></span> (<span class="id">i</span> <span class="id">i</span>':<span class="id"><a href="TSOMem.html#buffer_item">buffer_item</a></span>) : {<span class="id"><a href="TSOMem.html#i">i</a></span> = <span class="id">i</span>'} + {<span class="id"><a href="TSOMem.html#i">i</a></span> &lt;&gt; <span class="id">i</span>'}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9213')">Proof.</div>
<div class="proofscript" id="proof9213">
&nbsp;&nbsp;<span class="id">decide</span> <span class="id">equality</span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="Coqlib.html#zeq">zeq</a></span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="Values.html#Val.eq">Val.eq</a></span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="AST.html#chunk_eq">chunk_eq</a></span>.<br/>
Qed.</div>
<span class="kwd">Definition</span> <span class="id"><a name="buffer">buffer</a></span> : <span class="kwd">Type</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="TSOMem.html#buffer_item">buffer_item</a></span>.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="buffer_eq">buffer_eq</a></span> (<span class="id">i</span> <span class="id">i</span>':<span class="id"><a href="TSOMem.html#buffer">buffer</a></span>): {<span class="id"><a href="TSOMem.html#i">i</a></span>=<span class="id">i</span>'} + {<span class="id"><a href="TSOMem.html#i">i</a></span>&lt;&gt;<span class="id">i</span>'}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9214')">Proof.</div>
<div class="proofscript" id="proof9214">
 <span class="id">decide</span> <span class="id">equality</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOMem.html#buffer_item_eq">buffer_item_eq</a></span>. Qed.</div>
<div class="doc"><span class="bracket"><span class="id">buffers</span></span> : the collection of thread buffers and corresponding to the definition 
of <span class="bracket"><span class="id">B</span></span> defined in Figure 17 in submission #15 supplemental text </div>
<span class="kwd">Definition</span> <span class="id"><a name="buffers">buffers</a></span> : <span class="kwd">Type</span> := <span class="id"><a href="GlobDefs.html#tid">tid</a></span> -&gt; <span class="id"><a href="TSOMem.html#buffer">buffer</a></span>.<br/>
<br/>
<div class="doc"><span class="bracket"><span class="id">tsomem</span></span> : consists of each thread's buffer and global memory. </div>
<span class="kwd">Record</span> <span class="id"><a name="tsomem">tsomem</a></span>: <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a name="mktsomem">mktsomem</a></span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="tso_buffers">tso_buffers</a></span> : <span class="id"><a href="TSOMem.html#buffers">buffers</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="memory">memory</a></span> : <span class="id"><a href="GMemory.html#gmem">gmem</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
<br/>
<div class="doc"><span class="bracket"><span class="id">tsomem_init</span></span> : in the initial state, each thread's buffer is empty. </div>
<span class="kwd">Definition</span> <span class="id"><a name="tsomem_init">tsomem_init</a></span> (<span class="id">gm</span>: <span class="id"><a href="GMemory.html#gmem">gmem</a></span>) : <span class="id"><a href="TSOMem.html#tsomem">tsomem</a></span> := <span class="id"><a href="TSOMem.html#mktsomem">mktsomem</a></span> (<span class="kwd">fun</span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id"><a href="TSOMem.html#gm">gm</a></span>.<br/>
<br/>
<div class="doc"><span class="bracket"><span class="id">tupdate</span></span> : updates the buffer of given thread with the given buffer.  </div>
<span class="kwd">Definition</span> <span class="id"><a name="tupdate">tupdate</a></span> (<span class="id">t</span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span>) (<span class="id">b</span>': <span class="id"><a href="TSOMem.html#buffer">buffer</a></span>) (<span class="id">B</span>: <span class="id"><a href="TSOMem.html#buffers">buffers</a></span>) : <span class="id"><a href="TSOMem.html#buffers">buffers</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">t</span>' =&gt; <span class="kwd">if</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span>' <span class="id"><a href="TSOMem.html#t">t</a></span> <span class="kwd">then</span> <span class="id">b</span>' <span class="kwd">else</span> <span class="id"><a href="TSOMem.html#B">B</a></span> <span class="id">t</span>'.<br/>
<br/>
<div class="doc">Buffer item is applied by global semantics. </div>
<span class="kwd">Definition</span> <span class="id"><a name="unbuffer">unbuffer</a></span> (<span class="id">tm</span>: <span class="id"><a href="TSOMem.html#tsomem">tsomem</a></span>) (<span class="id">t</span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="TSOMem.html#tsomem">tsomem</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">b</span> := <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOMem.html#tm">tm</a></span> <span class="id"><a href="TSOMem.html#t">t</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">gm</span> := <span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOMem.html#tm">tm</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="TSOMem.html#b">b</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">bi</span> :: <span class="id">b</span>' =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">bi</span> <span class="id"><a href="TSOMem.html#gm">gm</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">gm</span>' =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOMem.html#mktsomem">mktsomem</a></span> (<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="TSOMem.html#t">t</a></span> <span class="id">b</span>' (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOMem.html#tm">tm</a></span>)) <span class="id">gm</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">State is <span class="bracket"><span class="id">unbuffer_safe</span></span> if all possible unbufferings succeed. </div>
<span class="kwd">Inductive</span> <span class="id"><a name="unbuffer_safe">unbuffer_safe</a></span>: <span class="id"><a href="TSOMem.html#tsomem">tsomem</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id"><a name="unbuffer_safe_unbuffer">unbuffer_safe_unbuffer</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tso</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ABIS</span>: <span class="kwd">forall</span> <span class="id">t</span> <span class="id">bi</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso">tso</a></span>.(<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span>) <span class="id"><a href="TSOMem.html#t">t</a></span> = <span class="id"><a href="TSOMem.html#bi">bi</a></span> :: <span class="id"><a href="TSOMem.html#b">b</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m</span>', <span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMem.html#bi">bi</a></span> <span class="id"><a href="TSOMem.html#tso">tso</a></span>.(<span class="id"><a href="TSOMem.html#memory">memory</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">UNBS</span>: <span class="kwd">forall</span> <span class="id">t</span> <span class="id">bi</span> <span class="id">b</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso">tso</a></span>.(<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span>) <span class="id"><a href="TSOMem.html#t">t</a></span> = <span class="id"><a href="TSOMem.html#bi">bi</a></span> :: <span class="id"><a href="TSOMem.html#b">b</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMem.html#bi">bi</a></span> <span class="id"><a href="TSOMem.html#tso">tso</a></span>.(<span class="id"><a href="TSOMem.html#memory">memory</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> (<span class="id"><a href="TSOMem.html#mktsomem">mktsomem</a></span> (<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="TSOMem.html#t">t</a></span> <span class="id"><a href="TSOMem.html#b">b</a></span> <span class="id"><a href="TSOMem.html#tso">tso</a></span>.(<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">m</span>')),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> <span class="id"><a href="TSOMem.html#tso">tso</a></span>.<br/>
<br/>
<div class="doc">Module local view : <span class="bracket"><span class="id">buffer</span></span> + <span class="bracket"><span class="id">fmemory</span></span>. </div>
<span class="kwd">Record</span> <span class="id"><a name="tsofmem">tsofmem</a></span>: <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a name="mktsofmem">mktsofmem</a></span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="tbuffer">tbuffer</a></span> : <span class="id"><a href="TSOMem.html#buffer">buffer</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="fmemory">fmemory</a></span> : <span class="id"><a href="FMemory.html#mem">mem</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
<br/>
<div class="doc"><span class="bracket"><span class="id">buffer_insert</span></span> : adds a given buffer item to the end of the buffer. </div>
<span class="kwd">Definition</span> <span class="id"><a name="buffer_insert">buffer_insert</a></span> (<span class="id">tfm</span> : <span class="id"><a href="TSOMem.html#tsofmem">tsofmem</a></span>) (<span class="id">bi</span> : <span class="id"><a href="TSOMem.html#buffer_item">buffer_item</a></span>) :=<br/>
&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#mktsofmem">mktsofmem</a></span> (<span class="id"><a href="TSOMem.html#tfm">tfm</a></span>.(<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span>) ++ <span class="id"><a href="TSOMem.html#bi">bi</a></span> :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id"><a href="TSOMem.html#tfm">tfm</a></span>.(<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="optbind">optbind</a></span> (<span class="id">A</span> <span class="id">B</span> : <span class="kwd">Type</span>) (<span class="id">g</span> : <span class="id"><a href="TSOMem.html#A">A</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="TSOMem.html#B">B</a></span>) (<span class="id">f</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="TSOMem.html#A">A</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="TSOMem.html#B">B</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="TSOMem.html#f">f</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span> =&gt; <span class="id"><a href="TSOMem.html#g">g</a></span> <span class="id">v</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<div class="doc">
<span class="bracket"><span class="id">apply_buffer</span></span> : 
corresponds to the 'apply_buffer' defined in 
submission #115 supplemental text in Figure 19 on page 20. 
It applies a given buffer item to the given memory state. 
The buffer is applied from left to right (i.e., starting with the head).
</div>
<span class="kwd">Fixpoint</span> <span class="id"><a name="apply_buffer">apply_buffer</a></span> (<span class="id">b</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="TSOMem.html#buffer_item">buffer_item</a></span>) (<span class="id">gm</span> : <span class="id"><a href="GMemory.html#gmem">gmem</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="GMemory.html#gmem">gmem</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="TSOMem.html#b">b</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOMem.html#gm">gm</a></span><br/>
&nbsp;&nbsp;| <span class="id">bi</span> :: <span class="id">rest</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#optbind">optbind</a></span> (<span class="kwd">fun</span> <span class="id">gm</span>' =&gt; <span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id">rest</span> <span class="id">gm</span>') (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">bi</span> <span class="id"><a href="TSOMem.html#gm">gm</a></span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="tso_valid_pointer">tso_valid_pointer</a></span> (<span class="id">tfm</span> : <span class="id"><a href="TSOMem.html#tsofmem">tsofmem</a></span>) (<span class="id">b</span> : <span class="id"><a href="Values.html#block">block</a></span>) (<span class="id">ofs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="TSOMem.html#tfm">tfm</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="TSOMem.html#mktsofmem">mktsofmem</a></span> <span class="id">bf</span> <span class="id">fm</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id">bf</span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm</span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">gm</span>' =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Coqlib.html#proj_sumbool">proj_sumbool</a></span> (<span class="id"><a href="TSOMem.html#perm_dec">perm_dec</a></span> <span class="id">gm</span>' <span class="id"><a href="TSOMem.html#b">b</a></span> <span class="id"><a href="TSOMem.html#ofs">ofs</a></span> <span class="id"><a href="Memperm.html#Cur">Memperm.Cur</a></span> <span class="id"><a href="Memperm.html#Nonempty">Memperm.Nonempty</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc"><span class="bracket"><span class="id">tsoupd</span></span> : updates the buffer of the given thread t with b' 
and the goal memory with gm' in tso memory. </div>
<span class="kwd">Definition</span> <span class="id"><a name="tsoupd">tsoupd</a></span> (<span class="id">tm</span>: <span class="id"><a href="TSOMem.html#tsomem">tsomem</a></span>) (<span class="id">t</span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span>) (<span class="id">b</span>': <span class="id"><a href="TSOMem.html#buffer">buffer</a></span>) (<span class="id">gm</span>': <span class="id"><a href="GMemory.html#gmem">gmem</a></span>) : <span class="id"><a href="TSOMem.html#tsomem">tsomem</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#mktsomem">mktsomem</a></span> (<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="TSOMem.html#t">t</a></span> <span class="id">b</span>' (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOMem.html#tm">tm</a></span>)) <span class="id">gm</span>'.<br/>
<br/>
<div class="doc">Here, we define <span class="bracket"><span class="id">alloc</span></span>, <span class="bracket"><span class="id">free</span></span>, <span class="bracket"><span class="id">load</span></span> and <span class="bracket"><span class="id">store</span></span> operations on TSO memory : 
<ul>
<li>
 <span class="bracket"><span class="id">tsoalloc</span></span> : alloc a fresh block in TSO memory. It doesn't take effect immediately, but is inserted into buffer first.
</li>
<li>
 <span class="bracket"><span class="id">tsofree</span></span>  : invalidate a segment of memory in TSO memory. It doesn't take effect immediately, but is inserted into buffer first.
</li>
<li>
 <span class="bracket"><span class="id">tsoload</span></span>  : load a memory chunk from TSO memory. Note that we do not buffer reads; reads are satisfied directly from buffers, or from the main memory if the buffer of the reading thread does not contain a corresponding write.  
</li>
<li>
 <span class="bracket"><span class="id">tsostore</span></span> : store a memory chunk in TSO memory. It doesn't take effect immediately, but is inserted into buffer first. 
</li>
</ul>
</div>
<span class="kwd">Inductive</span> <span class="id"><a name="tsoalloc">tsoalloc</a></span> : <span class="id"><a href="TSOMem.html#tsofmem">tsofmem</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span> -&gt; <span class="id"><a href="TSOMem.html#tsofmem">tsofmem</a></span> * <span class="id"><a href="Values.html#block">block</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id"><a name="TSOAlloc">TSOAlloc</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">fm</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">fm</span>' <span class="id">gm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOMem.html#bf">bf</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="TSOMem.html#fm">fm</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">gm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">gm</span>' (<span class="id"><a href="FMemory.html#Mem.freelist">Mem.freelist</a></span> <span class="id"><a href="TSOMem.html#fm">fm</a></span>) <span class="id">fm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tsoalloc">tsoalloc</a></span> (<span class="id"><a href="TSOMem.html#mktsofmem">mktsofmem</a></span> <span class="id"><a href="TSOMem.html#bf">bf</a></span> <span class="id"><a href="TSOMem.html#fm">fm</a></span>) <span class="id"><a href="TSOMem.html#lo">lo</a></span> <span class="id"><a href="TSOMem.html#hi">hi</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOMem.html#buffer_insert">buffer_insert</a></span> (<span class="id"><a href="TSOMem.html#mktsofmem">mktsofmem</a></span> <span class="id"><a href="TSOMem.html#bf">bf</a></span> <span class="id"><a href="TSOMem.html#fm">fm</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> (<span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id">fm</span>') <span class="id"><a href="TSOMem.html#lo">lo</a></span> <span class="id"><a href="TSOMem.html#hi">hi</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id">fm</span>').<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="tsofree">tsofree</a></span> (<span class="id">tfm</span> : <span class="id"><a href="TSOMem.html#tsofmem">tsofmem</a></span>) (<span class="id">b</span> : <span class="id"><a href="Values.html#block">block</a></span>) (<span class="id">lo</span> <span class="id">hi</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="TSOMem.html#tsofmem">tsofmem</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOMem.html#buffer_insert">buffer_insert</a></span> <span class="id"><a href="TSOMem.html#tfm">tfm</a></span> (<span class="id"><a href="TSOMem.html#BufferedFree">BufferedFree</a></span> <span class="id"><a href="TSOMem.html#b">b</a></span> <span class="id"><a href="TSOMem.html#lo">lo</a></span> <span class="id"><a href="TSOMem.html#hi">hi</a></span>)).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="tsoload">tsoload</a></span> (<span class="id">c</span> : <span class="id"><a href="AST.html#memory_chunk">memory_chunk</a></span>) (<span class="id">tfm</span> : <span class="id"><a href="TSOMem.html#tsofmem">tsofmem</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">b</span> : <span class="id"><a href="Values.html#block">block</a></span>) (<span class="id">ofs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Values.html#val">val</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="TSOMem.html#tfm">tfm</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="TSOMem.html#mktsofmem">mktsofmem</a></span> <span class="id">bf</span> <span class="id">fm</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id">bf</span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm</span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">gm</span> =&gt; <span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="TSOMem.html#c">c</a></span> <span class="id">gm</span> <span class="id"><a href="TSOMem.html#b">b</a></span> <span class="id"><a href="TSOMem.html#ofs">ofs</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="tsoloadv">tsoloadv</a></span> (<span class="id">c</span> : <span class="id"><a href="AST.html#memory_chunk">memory_chunk</a></span>) (<span class="id">tfm</span> : <span class="id"><a href="TSOMem.html#tsofmem">tsofmem</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">addr</span> : <span class="id"><a href="Values.html#val">val</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Values.html#val">val</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="TSOMem.html#addr">addr</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Values.html#Vundef">Vundef</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Values.html#Vlong">Vlong</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Values.html#Vfloat">Vfloat</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Values.html#Vsingle">Vsingle</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id">b</span> <span class="id">ofs</span> =&gt; <span class="id"><a href="TSOMem.html#tsoload">tsoload</a></span> <span class="id"><a href="TSOMem.html#c">c</a></span> <span class="id"><a href="TSOMem.html#tfm">tfm</a></span> <span class="id">b</span> (<span class="id"><a href="Integers.html#Ptrofs.unsigned">Integers.Ptrofs.unsigned</a></span> <span class="id">ofs</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="tsostore">tsostore</a></span> (<span class="id">c</span> : <span class="id"><a href="AST.html#memory_chunk">memory_chunk</a></span>) (<span class="id">tfm</span> : <span class="id"><a href="TSOMem.html#tsofmem">tsofmem</a></span>) (<span class="id">b</span> : <span class="id"><a href="Values.html#block">block</a></span>) (<span class="id">ofs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">v</span> : <span class="id"><a href="Values.html#val">val</a></span>) :=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOMem.html#buffer_insert">buffer_insert</a></span> <span class="id"><a href="TSOMem.html#tfm">tfm</a></span> (<span class="id"><a href="TSOMem.html#BufferedStore">BufferedStore</a></span> <span class="id"><a href="TSOMem.html#c">c</a></span> <span class="id"><a href="TSOMem.html#b">b</a></span> <span class="id"><a href="TSOMem.html#ofs">ofs</a></span> <span class="id"><a href="TSOMem.html#v">v</a></span>)).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="tsostorev">tsostorev</a></span> (<span class="id">c</span> : <span class="id"><a href="AST.html#memory_chunk">memory_chunk</a></span>) (<span class="id">tfm</span> : <span class="id"><a href="TSOMem.html#tsofmem">tsofmem</a></span>) (<span class="id">addr</span> <span class="id">v</span> : <span class="id"><a href="Values.html#val">val</a></span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="TSOMem.html#addr">addr</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Values.html#Vundef">Vundef</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Values.html#Vlong">Vlong</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Values.html#Vfloat">Vfloat</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Values.html#Vsingle">Vsingle</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id">b</span> <span class="id">ofs</span> =&gt; <span class="id"><a href="TSOMem.html#tsostore">tsostore</a></span> <span class="id"><a href="TSOMem.html#c">c</a></span> <span class="id"><a href="TSOMem.html#tfm">tfm</a></span> <span class="id">b</span> (<span class="id"><a href="Integers.html#Ptrofs.unsigned">Integers.Ptrofs.unsigned</a></span> <span class="id">ofs</span>) <span class="id"><a href="TSOMem.html#v">v</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="get_buffer_b">get_buffer_b</a></span> (<span class="id">bf</span> : <span class="id"><a href="TSOMem.html#buffer">buffer</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Values.html#block">block</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="TSOMem.html#bf">bf</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span><br/>
&nbsp;&nbsp;| <span class="id">bi</span> :: <span class="id">bf</span>' =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">bi</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id">b</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">b</span> :: <span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> <span class="id">bf</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="TSOMem.html#BufferedFree">BufferedFree</a></span> <span class="id">b</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">b</span> :: <span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> <span class="id">bf</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="TSOMem.html#BufferedStore">BufferedStore</a></span> <span class="id">_</span> <span class="id">b</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">b</span> :: <span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> <span class="id">bf</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="in_buffer_item">in_buffer_item</a></span> : <span class="id"><a href="TSOMem.html#buffer_item">buffer_item</a></span> -&gt; <span class="id"><a href="Values.html#block">block</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id"><a name="in_alloc_bi">in_alloc_bi</a></span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">lo</span> <span class="id">hi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#in_buffer_item">in_buffer_item</a></span> (<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id"><a href="TSOMem.html#b">b</a></span> <span class="id"><a href="TSOMem.html#lo">lo</a></span> <span class="id"><a href="TSOMem.html#hi">hi</a></span>) <span class="id"><a href="TSOMem.html#b">b</a></span> <span class="id"><a href="TSOMem.html#ofs">ofs</a></span><br/>
| <span class="id"><a name="in_free_bi">in_free_bi</a></span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">lo</span> <span class="id">hi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#lo">lo</a></span> &lt;= <span class="id"><a href="TSOMem.html#ofs">ofs</a></span> &lt; <span class="id"><a href="TSOMem.html#hi">hi</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#in_buffer_item">in_buffer_item</a></span> (<span class="id"><a href="TSOMem.html#BufferedFree">BufferedFree</a></span> <span class="id"><a href="TSOMem.html#b">b</a></span> <span class="id"><a href="TSOMem.html#lo">lo</a></span> <span class="id"><a href="TSOMem.html#hi">hi</a></span>) <span class="id"><a href="TSOMem.html#b">b</a></span> <span class="id"><a href="TSOMem.html#ofs">ofs</a></span><br/>
| <span class="id"><a name="in_store_bi">in_store_bi</a></span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">chunk</span> <span class="id">ofs</span>' <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ofs</span>' &lt;= <span class="id"><a href="TSOMem.html#ofs">ofs</a></span> &lt; <span class="id">ofs</span>' + (<span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id"><a href="TSOMem.html#chunk">chunk</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#in_buffer_item">in_buffer_item</a></span> (<span class="id"><a href="TSOMem.html#BufferedStore">BufferedStore</a></span> <span class="id"><a href="TSOMem.html#chunk">chunk</a></span> <span class="id"><a href="TSOMem.html#b">b</a></span> <span class="id">ofs</span>' <span class="id"><a href="TSOMem.html#v">v</a></span>) <span class="id"><a href="TSOMem.html#b">b</a></span> <span class="id"><a href="TSOMem.html#ofs">ofs</a></span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="in_buffer">in_buffer</a></span> (<span class="id">buf</span>: <span class="id"><a href="TSOMem.html#buffer">buffer</a></span>) (<span class="id">b</span>: <span class="id"><a href="Values.html#block">block</a></span>) (<span class="id">ofs</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) : <span class="kwd">Prop</span> :=<br/>
| <span class="id"><a name="in_buffer_intro">in_buffer_intro</a></span>: <span class="kwd">forall</span> <span class="id">bi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMem.html#bi">bi</a></span> <span class="id">buf</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#in_buffer_item">in_buffer_item</a></span> <span class="id"><a href="TSOMem.html#bi">bi</a></span> <span class="id">b</span> <span class="id">ofs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#in_buffer">in_buffer</a></span> <span class="id">buf</span> <span class="id">b</span> <span class="id">ofs</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="wfbi">wfbi</a></span> (<span class="id">bi</span> : <span class="id"><a href="TSOMem.html#buffer_item">buffer_item</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="TSOMem.html#bi">bi</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span> =&gt; <span class="id">lo</span> &lt; <span class="id">hi</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="TSOMem.html#BufferedFree">BufferedFree</a></span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span> =&gt; <span class="id">lo</span> &lt; <span class="id">hi</span> <br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="wfbis">wfbis</a></span> (<span class="id">bis</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="TSOMem.html#buffer_item">buffer_item</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOMem.html#bi">bi</a></span> <span class="id"><a href="TSOMem.html#bis">bis</a></span> -&gt; <span class="id"><a href="TSOMem.html#wfbi">wfbi</a></span> <span class="id"><a href="TSOMem.html#bi">bi</a></span>.<br/>
<br/>
<h1> Auxiliary operation </h1>
<span class="kwd">Definition</span> <span class="id"><a name="get_tsom_b">get_tsom_b</a></span> (<span class="id">t</span> : <span class="id"><a href="GlobDefs.html#tid">tid</a></span>) (<span class="id">tm</span> : <span class="id"><a href="TSOMem.html#tsomem">tsomem</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Values.html#block">block</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="TSOMem.html#tm">tm</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="TSOMem.html#mktsomem">mktsomem</a></span> <span class="id">bfs</span> <span class="id">gm</span> =&gt; <span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> (<span class="id">bfs</span> <span class="id"><a href="TSOMem.html#t">t</a></span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="load_tsomem">load_tsomem</a></span> (<span class="id">c</span> : <span class="id"><a href="AST.html#memory_chunk">memory_chunk</a></span>) (<span class="id">tm</span> : <span class="id"><a href="TSOMem.html#tsomem">tsomem</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">b</span> : <span class="id"><a href="Values.html#block">block</a></span>) (<span class="id">pos</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Values.html#val">val</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="TSOMem.html#tm">tm</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="TSOMem.html#mktsomem">mktsomem</a></span> <span class="id">bfs</span> <span class="id">gm</span> =&gt; <span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="TSOMem.html#c">c</a></span> <span class="id">gm</span> <span class="id"><a href="TSOMem.html#b">b</a></span> <span class="id"><a href="TSOMem.html#pos">pos</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="store_tsomem">store_tsomem</a></span> (<span class="id">c</span> : <span class="id"><a href="AST.html#memory_chunk">memory_chunk</a></span>) (<span class="id">tm</span> : <span class="id"><a href="TSOMem.html#tsomem">tsomem</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">b</span> : <span class="id"><a href="Values.html#block">block</a></span>) (<span class="id">pos</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) (<span class="id">v</span> : <span class="id"><a href="Values.html#val">val</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="TSOMem.html#tsomem">tsomem</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="TSOMem.html#tm">tm</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="TSOMem.html#mktsomem">mktsomem</a></span> <span class="id">bfs</span> <span class="id">gm</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="TSOMem.html#c">c</a></span> <span class="id">gm</span> <span class="id"><a href="TSOMem.html#b">b</a></span> <span class="id"><a href="TSOMem.html#pos">pos</a></span> <span class="id"><a href="TSOMem.html#v">v</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">gm</span>' =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOMem.html#mktsomem">mktsomem</a></span> <span class="id">bfs</span> <span class="id">gm</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">Apply the whole content of the thread buffer </div>
<span class="kwd">Definition</span> <span class="id"><a name="append_t_buffer">append_t_buffer</a></span> (<span class="id">t</span> : <span class="id"><a href="GlobDefs.html#tid">tid</a></span>) (<span class="id">tm</span> : <span class="id"><a href="TSOMem.html#tsomem">tsomem</a></span>) (<span class="id">bi</span>: <span class="id"><a href="TSOMem.html#buffer_item">buffer_item</a></span>) : <span class="id"><a href="TSOMem.html#tsomem">tsomem</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">bf</span> := <span class="id"><a href="TSOMem.html#tm">tm</a></span>.(<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span>) <span class="id"><a href="TSOMem.html#t">t</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">gm</span> := <span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOMem.html#tm">tm</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#mktsomem">mktsomem</a></span> (<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="TSOMem.html#t">t</a></span> (<span class="id"><a href="TSOMem.html#bf">bf</a></span>++(<span class="id"><a href="TSOMem.html#bi">bi</a></span>::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)) <span class="id"><a href="TSOMem.html#tm">tm</a></span>.(<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span>)) <span class="id"><a href="TSOMem.html#gm">gm</a></span>.<br/>
<br/>
<div class="doc">Get gmem from <span class="bracket"><span class="id">tsomem</span></span> </div>
<span class="kwd">Definition</span> <span class="id"><a name="get_gm">get_gm</a></span> (<span class="id">tm</span> : <span class="id"><a href="TSOMem.html#tsomem">tsomem</a></span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="TSOMem.html#tm">tm</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="TSOMem.html#mktsomem">mktsomem</a></span> <span class="id">bf</span> <span class="id">m</span> =&gt; <span class="id">m</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="no_perm">no_perm</a></span> (<span class="id">m</span> : <span class="id"><a href="GMemory.html#gmem">gmem</a></span>) (<span class="id">b</span> : <span class="id"><a href="Values.html#block">block</a></span>) (<span class="id">ofs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) :=<br/>
&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMem.html#m">m</a></span>) !! <span class="id"><a href="TSOMem.html#b">b</a></span> <span class="id"><a href="TSOMem.html#ofs">ofs</a></span> <span class="id"><a href="Memperm.html#Max">Memperm.Max</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> /\<br/>
&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMem.html#m">m</a></span>) !! <span class="id"><a href="TSOMem.html#b">b</a></span> <span class="id"><a href="TSOMem.html#ofs">ofs</a></span> <span class="id"><a href="Memperm.html#Cur">Memperm.Cur</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="inrange">inrange</a></span> (<span class="id">b</span> : <span class="id"><a href="Values.html#block">block</a></span>) (<span class="id">ofs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) (<span class="id">sz</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">b</span>' <span class="id">ofs</span>' =&gt; <span class="kwd">if</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> <span class="id"><a href="TSOMem.html#b">b</a></span> <span class="id">b</span>' <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> (<span class="id"><a href="Coqlib.html#zle">zle</a></span> <span class="id"><a href="TSOMem.html#ofs">ofs</a></span> <span class="id">ofs</span>') &amp;&amp; (<span class="id"><a href="Coqlib.html#zlt">zlt</a></span> <span class="id">ofs</span>' (<span class="id"><a href="TSOMem.html#ofs">ofs</a></span> + <span class="id"><a href="TSOMem.html#sz">sz</a></span>)%<span class="id">Z</span>) <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="outrange">outrange</a></span> (<span class="id">b</span> : <span class="id"><a href="Values.html#block">block</a></span>) (<span class="id">ofs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) (<span class="id">sz</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">b</span>' <span class="id">ofs</span>' =&gt; <span class="kwd">if</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> <span class="id"><a href="TSOMem.html#b">b</a></span> <span class="id">b</span>' <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> (<span class="id"><a href="Coqlib.html#zle">zle</a></span> <span class="id"><a href="TSOMem.html#ofs">ofs</a></span> <span class="id">ofs</span>') &amp;&amp; (<span class="id"><a href="Coqlib.html#zlt">zlt</a></span> <span class="id">ofs</span>' (<span class="id"><a href="TSOMem.html#ofs">ofs</a></span> + <span class="id"><a href="TSOMem.html#sz">sz</a></span>)%<span class="id">Z</span>) <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="gmem_loc_content_eq">gmem_loc_content_eq</a></span> (<span class="id">P</span> : <span class="id"><a href="Footprint.html#Locs.t">Locs.t</a></span>) (<span class="id">m</span> <span class="id">m</span>' : <span class="id"><a href="GMemory.html#gmem">gmem</a></span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs0</span>, <span class="id"><a href="Footprint.html#Locs.belongsto">Locs.belongsto</a></span> <span class="id"><a href="TSOMem.html#P">P</a></span> <span class="id"><a href="TSOMem.html#b">b</a></span> <span class="id"><a href="TSOMem.html#ofs0">ofs0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#ZMap.get">ZMap.get</a></span> <span class="id"><a href="TSOMem.html#ofs0">ofs0</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id"><a href="TSOMem.html#m">m</a></span>) !! <span class="id"><a href="TSOMem.html#b">b</a></span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#ZMap.get">ZMap.get</a></span> <span class="id"><a href="TSOMem.html#ofs0">ofs0</a></span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id">m</span>') !! <span class="id"><a href="TSOMem.html#b">b</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="gmem_loc_perm_eq">gmem_loc_perm_eq</a></span> (<span class="id">P</span> : <span class="id"><a href="Footprint.html#Locs.t">Locs.t</a></span>) (<span class="id">m</span> <span class="id">m</span>' : <span class="id"><a href="GMemory.html#gmem">gmem</a></span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs0</span> <span class="id">k</span>, <span class="id"><a href="Footprint.html#Locs.belongsto">Locs.belongsto</a></span> <span class="id"><a href="TSOMem.html#P">P</a></span> <span class="id"><a href="TSOMem.html#b">b</a></span> <span class="id"><a href="TSOMem.html#ofs0">ofs0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id"><a href="TSOMem.html#m">m</a></span>) !! <span class="id"><a href="TSOMem.html#b">b</a></span> <span class="id"><a href="TSOMem.html#ofs0">ofs0</a></span> <span class="id"><a href="TSOMem.html#k">k</a></span> = (<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m</span>') !! <span class="id"><a href="TSOMem.html#b">b</a></span> <span class="id"><a href="TSOMem.html#ofs0">ofs0</a></span> <span class="id"><a href="TSOMem.html#k">k</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="gmem_loc_eq">gmem_loc_eq</a></span> (<span class="id">P</span> : <span class="id"><a href="Footprint.html#Locs.t">Locs.t</a></span>) (<span class="id">m</span> <span class="id">m</span>' : <span class="id"><a href="GMemory.html#gmem">gmem</a></span>) :=<br/>
&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#gmem_loc_content_eq">gmem_loc_content_eq</a></span> <span class="id"><a href="TSOMem.html#P">P</a></span> <span class="id"><a href="TSOMem.html#m">m</a></span> <span class="id">m</span>' /\ <span class="id"><a href="TSOMem.html#gmem_loc_perm_eq">gmem_loc_perm_eq</a></span> <span class="id"><a href="TSOMem.html#P">P</a></span> <span class="id"><a href="TSOMem.html#m">m</a></span> <span class="id">m</span>'.<br/>
<br/>
<span class="kwd">Local</span> <span class="kwd">Notation</span> <span class="id"><a name="footprint">footprint</a></span> := <span class="id"><a href="Footprint.html#FP.t">FP.t</a></span>.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="bi_footprint">bi_footprint</a></span> (<span class="id">bi</span>: <span class="id"><a href="TSOMem.html#buffer_item">buffer_item</a></span>) : <span class="id"><a href="TSOMem.html#footprint">footprint</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="TSOMem.html#bi">bi</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span> =&gt; <span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="TSOMem.html#BufferedFree">BufferedFree</a></span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span> =&gt; <span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="TSOMem.html#BufferedStore">BufferedStore</a></span> <span class="id">chunk</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span> =&gt; <span class="id"><a href="FMemOpFP.html#store_fp">store_fp</a></span> <span class="id">chunk</span> <span class="id">b</span> <span class="id">ofs</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="unbuf_locality_1">unbuf_locality_1</a></span> (<span class="id">bi</span> : <span class="id"><a href="TSOMem.html#buffer_item">buffer_item</a></span>) (<span class="id">m</span> <span class="id">m</span>' : <span class="id"><a href="GMemory.html#gmem">gmem</a></span>) :=<br/>
&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMem.html#bi">bi</a></span> <span class="id"><a href="TSOMem.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m0</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#MemPre">MemPre</a></span> <span class="id"><a href="TSOMem.html#m">m</a></span> <span class="id"><a href="TSOMem.html#m0">m0</a></span> (<span class="id"><a href="TSOMem.html#bi_footprint">bi_footprint</a></span> <span class="id"><a href="TSOMem.html#bi">bi</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m0</span>', <span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOMem.html#bi">bi</a></span> <span class="id"><a href="TSOMem.html#m0">m0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m0</span>' /\ <span class="id"><a href="InteractionSemantics.html#MemPost">MemPost</a></span> <span class="id">m</span>' <span class="id">m0</span>' (<span class="id"><a href="TSOMem.html#bi_footprint">bi_footprint</a></span> <span class="id"><a href="TSOMem.html#bi">bi</a></span>).<br/>
<br/>
<br/>
</div>
<div class="footer"><hr/>Generated by coq2html</div>
</body>
</html>
