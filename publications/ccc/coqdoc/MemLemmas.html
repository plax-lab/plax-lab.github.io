<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module MemLemmas</title>
<meta name="description" content="Documentation of Coq module MemLemmas" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module MemLemmas</h1>
<div class="coq">
<div class="doc">This file contains a set of lemmas for lock correctness proof.  </div>
<span class="id">From</span> <span class="id">mathcomp.ssreflect</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">fintype</span> <span class="id">ssrnat</span>.                <br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Coqlib.html">Coqlib</a></span> <span class="id"><a href="Maps.html">Maps</a></span> <span class="id"><a href="Axioms.html">Axioms</a></span>.  <br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="AST.html">AST</a></span> <span class="id"><a href="Integers.html">Integers</a></span> <span class="id"><a href="Floats.html">Floats</a></span> <span class="id"><a href="Values.html">Values</a></span> <span class="id"><a href="Events.html">Events</a></span> <span class="id"><a href="Globalenvs.html">Globalenvs</a></span> <span class="id"><a href="Smallstep.html">Smallstep</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Locations.html">Locations</a></span> <span class="id"><a href="Stacklayout.html">Stacklayout</a></span> <span class="id"><a href="Conventions.html">Conventions</a></span>.<br/>
&nbsp;<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Asm.html">Asm</a></span>. <br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="CUAST.html">CUAST</a></span> <span class="id"><a href="FMemOpFP.html">FMemOpFP</a></span> <span class="id"><a href="ValFP.html">ValFP</a></span> <span class="id"><a href="Op_fp.html">Op_fp</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Strings.String.html">String</a></span> <span class="id"><a href="val_casted.html">val_casted</a></span> <span class="id"><a href="helpers.html">helpers</a></span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Memdata.html">Memdata</a></span> <span class="id"><a href="Memperm.html">Memperm</a></span> <span class="id"><a href="MemAux.html">MemAux</a></span> <span class="id"><a href="FMemLemmas.html">FMemLemmas</a></span> <span class="id"><a href="GMemory.html">GMemory</a></span> <span class="id"><a href="FMemory.html">FMemory</a></span> <span class="id"><a href="Footprint.html">Footprint</a></span> <span class="id"><a href="TSOMem.html">TSOMem</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="GAST.html">GAST</a></span> <span class="id"><a href="GlobDefs.html">GlobDefs</a></span> <span class="id"><a href="ETrace.html">ETrace</a></span> <span class="id"><a href="Blockset.html">Blockset</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="loadframe.html">loadframe</a></span>. <br/>
&nbsp;<br/>
<span class="kwd">Require</span> <span class="id"><a href="CminorLang.html">CminorLang</a></span>. <br/>
<span class="kwd">Require</span> <span class="id"><a href="SpecLang.html">SpecLang</a></span>. <br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="ASM_local.html">ASM_local</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="AsmLang.html">AsmLang</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="AsmTSO.html">AsmTSO</a></span> <span class="id"><a href="TSOMem.html">TSOMem</a></span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html">Coq.Lists.Streams</a></span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="RGRels.html">RGRels</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="LibTactics.html">LibTactics</a></span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="code.html">code</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="ObjectSim.html">ObjectSim</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="TSOGlobSem.html">TSOGlobSem</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="InvRG.html">InvRG</a></span>.  <br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="AuxTacLemmas.html">AuxTacLemmas</a></span> <span class="id"><a href="TSOMemLemmas.html">TSOMemLemmas</a></span> <span class="id"><a href="TSOStepAuxLemmas.html">TSOStepAuxLemmas</a></span> <span class="id"><a href="TSOAuxDefs.html">TSOAuxDefs</a></span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="FMemLemmas.html">FMemLemmas</a></span>.<br/>
<br/>
<span class="kwd">Local</span> <span class="id">Transparent</span> <span class="id"><a href="FMemory.html#Mem.load">Mem.load</a></span> <span class="id"><a href="FMemory.html#Mem.alloc">Mem.alloc</a></span> <span class="id"><a href="FMemory.html#Mem.store">Mem.store</a></span> <span class="id"><a href="FMemory.html#Mem.free">Mem.free</a></span>.<br/>
<br/>
<h2> Auxiliary Lemmas </h2>
<span class="kwd">Lemma</span> <span class="id"><a name="genv_defs_fun_find_fun_eq">genv_defs_fun_find_fun_eq</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">F</span> <span class="id">V</span> (<span class="id">ge</span> : <span class="id"><a href="Globalenvs.html#Genv.t">Genv.t</a></span> <span class="id"><a href="MemLemmas.html#F">F</a></span> <span class="id"><a href="MemLemmas.html#V">V</a></span>) <span class="id">b</span> (<span class="id">f</span> <span class="id">f</span>' : <span class="id"><a href="MemLemmas.html#F">F</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hfind_func</span> : <span class="id"><a href="Globalenvs.html#Genv.find_funct_ptr">Genv.find_funct_ptr</a></span> <span class="id"><a href="MemLemmas.html#ge">ge</a></span> <span class="id"><a href="MemLemmas.html#b">b</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="MemLemmas.html#f">f</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hgenv_defs</span> : (<span class="id"><a href="Globalenvs.html#Genv.genv_defs">Genv.genv_defs</a></span> <span class="id"><a href="MemLemmas.html#ge">ge</a></span>) ! <span class="id"><a href="MemLemmas.html#b">b</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="AST.html#Gfun">Gfun</a></span> <span class="id">f</span>')),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="MemLemmas.html#f">f</a></span> = <span class="id">f</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9901')">Proof.</div>
<div class="proofscript" id="proof9901">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Genv.find_funct_ptr</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Genv.find_def</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hgenv_defs</span> <span class="kwd">in</span> <span class="id">Hfind_func</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hfind_func</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="ogenv_match_L_addr_eq">ogenv_match_L_addr_eq</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sge</span> <span class="id">tge</span> <span class="id">sG</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#init_genv">InteractionSemantics.init_genv</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="code.html#lock_comp_unit">lock_comp_unit</a></span> <span class="id"><a href="MemLemmas.html#sge">sge</a></span> <span class="id"><a href="MemLemmas.html#sG">sG</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#init_genv">init_genv</a></span> <span class="id"><a href="code.html#lock_comp_tso_unit">lock_comp_tso_unit</a></span> <span class="id"><a href="MemLemmas.html#tge">tge</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#genv_match">genv_match</a></span> (<span class="id"><a href="InteractionSemantics.html#F">InteractionSemantics.F</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="InteractionSemantics.html#V">InteractionSemantics.V</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span>) <span class="id"><a href="MemLemmas.html#sge">sge</a></span> <span class="id"><a href="MemLemmas.html#tge">tge</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">L</span>, <span class="id"><a href="Globalenvs.html#Genv.find_symbol">Genv.find_symbol</a></span> <span class="id"><a href="MemLemmas.html#tge">tge</a></span> <span class="id"><a href="code.html#lock_L_ident">lock_L_ident</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">L</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Globalenvs.html#Genv.find_symbol">Genv.find_symbol</a></span> <span class="id"><a href="MemLemmas.html#sge">sge</a></span> <span class="id"><a href="code.html#lock_L_ident">lock_L_ident</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">L</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9902')">Proof.</div>
<div class="proofscript" id="proof9902">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H3</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H6</span> <span class="id"><a href="code.html#lock_L_ident">lock_L_ident</a></span>).<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H6</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H3</span> <span class="id">H2</span> <span class="id">H4</span> <span class="id">H5</span> <span class="id">H6</span> <span class="id">H7</span> <span class="id">H8</span> <span class="id">H9</span> <span class="id">H10</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H5</span> <span class="id"><a href="code.html#lock_L_ident">lock_L_ident</a></span>).<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H5</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H2</span> <span class="id">H3</span> <span class="id">H4</span> <span class="id">H5</span> <span class="id">H6</span> <span class="id">H7</span> <span class="id">H8</span> <span class="id">H9</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H1</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Globalenvs.html#Genv.find_symbol">Genv.find_symbol</a></span> <span class="kwd">in</span> <span class="id">H13</span>, <span class="id">H12</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">genv_symb_eq</span> <span class="id"><a href="code.html#lock_L_ident">lock_L_ident</a></span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H13</span> <span class="kwd">in</span> <span class="id">genv_symb_eq</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H12</span> <span class="kwd">in</span> <span class="id">genv_symb_eq</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">genv_symb_eq</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="get_lock_ident_from_ge">get_lock_ident_from_ge</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tge</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Himp_init</span> : <span class="id"><a href="AsmTSO.html#init_genv">init_genv</a></span> <span class="id"><a href="code.html#lock_comp_tso_unit">lock_comp_tso_unit</a></span> <span class="id"><a href="MemLemmas.html#tge">tge</a></span>),<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">L</span>, <span class="id"><a href="Globalenvs.html#Genv.find_symbol">Genv.find_symbol</a></span> <span class="id"><a href="MemLemmas.html#tge">tge</a></span> <span class="id"><a href="code.html#lock_L_ident">lock_L_ident</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">L</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9903')">Proof.</div>
<div class="proofscript" id="proof9903">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Himp_init</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H2</span> <span class="id"><a href="code.html#lock_L_ident">lock_L_ident</a></span>).<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H5</span> <span class="kwd">in</span> <span class="id">H10</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="R_impl_I_I">R_impl_I_I</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tge</span> <span class="id">t</span> <span class="id">sm</span> <span class="id">tm</span> <span class="id">sm</span>' <span class="id">tm</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">HRobj</span> : <span class="id"><a href="InvRG.html#Robj">Robj</a></span> <span class="id"><a href="MemLemmas.html#tge">tge</a></span> <span class="id"><a href="MemLemmas.html#t">t</a></span> <span class="id"><a href="MemLemmas.html#sm">sm</a></span> <span class="id"><a href="MemLemmas.html#tm">tm</a></span> <span class="id">sm</span>' <span class="id">tm</span>'),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span> <span class="id"><a href="MemLemmas.html#tge">tge</a></span> <span class="id"><a href="MemLemmas.html#sm">sm</a></span> <span class="id"><a href="MemLemmas.html#tm">tm</a></span> /\ <span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span> <span class="id"><a href="MemLemmas.html#tge">tge</a></span> <span class="id">sm</span>' <span class="id">tm</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9904')">Proof.</div>
<div class="proofscript" id="proof9904">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Robj</span>.<br/>
&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">HRobj</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Gclt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Gobj</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">G_lock</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">G_unlock</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Id</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">G_alloc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="spec_init_not_none">spec_init_not_none</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sG</span> <span class="id">id</span> <span class="id">args</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#init_core">InteractionSemantics.init_core</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span> <span class="id"><a href="MemLemmas.html#sG">sG</a></span> <span class="id"><a href="MemLemmas.html#id">id</a></span> <span class="id"><a href="MemLemmas.html#args">args</a></span> &lt;&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">tc</span>, <span class="id"><a href="InteractionSemantics.html#init_core">InteractionSemantics.init_core</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span> <span class="id"><a href="MemLemmas.html#sG">sG</a></span> <span class="id"><a href="MemLemmas.html#id">id</a></span> <span class="id"><a href="MemLemmas.html#args">args</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">tc</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9905')">Proof.</div>
<div class="proofscript" id="proof9905">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">SpecLang.init_core</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">generic_init_core</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Globalenvs.html#Genv.find_symbol">Genv.find_symbol</a></span> <span class="id">sG</span> <span class="id">id</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">Heqo</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Globalenvs.html#Genv.find_funct_ptr">Genv.find_funct_ptr</a></span> <span class="id">sG</span> <span class="id">b</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">SpecLang.fundef_init</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">f</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">args</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="obj_inv_impl_unbuffer_safe">obj_inv_impl_unbuffer_safe</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tge</span> <span class="id">sm</span> <span class="id">tm</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span> <span class="id"><a href="MemLemmas.html#tge">tge</a></span> <span class="id"><a href="MemLemmas.html#sm">sm</a></span> <span class="id"><a href="MemLemmas.html#tm">tm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> <span class="id"><a href="MemLemmas.html#tm">tm</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9906')">Proof.</div>
<div class="proofscript" id="proof9906">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">obj_inv</span>.<br/>
&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="b_not_bf_item_not1">b_not_bf_item_not1</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">L</span> <span class="id">c</span> <span class="id">ofs</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="TSOMem.html#BufferedStore">BufferedStore</a></span> <span class="id"><a href="MemLemmas.html#c">c</a></span> <span class="id"><a href="MemLemmas.html#L">L</a></span> <span class="id"><a href="MemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="MemLemmas.html#v">v</a></span>) <span class="id"><a href="MemLemmas.html#bf">bf</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="MemLemmas.html#L">L</a></span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> <span class="id"><a href="MemLemmas.html#bf">bf</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9907')">Proof.</div>
<div class="proofscript" id="proof9907">
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">bf</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="perm_w_store">perm_w_store</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fm</span> <span class="id">b</span> <span class="id">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.range_perm">Mem.range_perm</a></span> <span class="id"><a href="MemLemmas.html#fm">fm</a></span> <span class="id"><a href="MemLemmas.html#b">b</a></span> 0 4 <span class="id"><a href="Memperm.html#Cur">Memperm.Cur</a></span> <span class="id"><a href="Memperm.html#Writable">Memperm.Writable</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">gm</span>, <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="MemLemmas.html#fm">fm</a></span>) <span class="id"><a href="MemLemmas.html#b">b</a></span> 0 (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="MemLemmas.html#n">n</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">gm</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9908')">Proof.</div>
<div class="proofscript" id="proof9908">
&nbsp;&nbsp;<span class="id">memunfolds</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Hx</span>;<span class="id">contradict</span> <span class="id">n0</span>;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">memunfolds</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOMemLemmas.html#range_perm_cur_max">range_perm_cur_max</a></span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.mod_divide">Z.mod_divide</a></span>;<span class="tactic">auto</span>;<span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="item_in_bf_add_count_one_block_neq">item_in_bf_add_count_one_block_neq</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span>' <span class="id">bf</span> <span class="id">c</span> <span class="id">L</span> <span class="id">ofs</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="TSOMem.html#BufferedStore">BufferedStore</a></span> <span class="id"><a href="MemLemmas.html#c">c</a></span> <span class="id"><a href="MemLemmas.html#L">L</a></span> <span class="id"><a href="MemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="MemLemmas.html#v">v</a></span>) <span class="id"><a href="MemLemmas.html#bf">bf</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ">count_occ</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> (<span class="id">bi</span>' :: <span class="id"><a href="MemLemmas.html#bf">bf</a></span>)) <span class="id"><a href="MemLemmas.html#L">L</a></span> = 1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMemLemmas.html#get_bi_block">get_bi_block</a></span> <span class="id">bi</span>' &lt;&gt; <span class="id"><a href="MemLemmas.html#L">L</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9909')">Proof.</div>
<div class="proofscript" id="proof9909">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>'; <span class="tactic">intro</span>; <span class="id">simpls</span>; <span class="tactic">subst</span>; <span class="id">dis_if_else</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#nat_add_nochange_zero">nat_add_nochange_zero</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ_not_In">count_occ_not_In</a></span> <span class="kwd">in</span> <span class="id">H0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id"><a href="MemLemmas.html#b_not_bf_item_not1">b_not_bf_item_not1</a></span> <span class="kwd">in</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">contradiction</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">in_buffer_count_one_load</span>' :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">L</span> <span class="id">n</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="TSOMem.html#BufferedStore">BufferedStore</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id"><a href="MemLemmas.html#L">L</a></span> 0 (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="MemLemmas.html#n">n</a></span>)) <span class="id"><a href="MemLemmas.html#bf">bf</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ">count_occ</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> <span class="id"><a href="MemLemmas.html#bf">bf</a></span>) <span class="id"><a href="MemLemmas.html#L">L</a></span> = 1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="MemLemmas.html#bf">bf</a></span> <span class="id"><a href="MemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id">m</span>' <span class="id"><a href="MemLemmas.html#L">L</a></span> 0 = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="MemLemmas.html#v">v</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="MemLemmas.html#v">v</a></span> = <span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="MemLemmas.html#n">n</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9910')">Proof.</div>
<div class="proofscript" id="proof9910">
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">bf</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;-   <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">optbind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> <span class="id">L</span> <span class="id">L</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id">m</span> <span class="id">L</span> 0 (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id">n</span>)) <span class="id">eqn</span>:<span class="id">Hstore</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id">g</span> <span class="id">L</span> 0 = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id">n</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#gm_store_v_load_same">gm_store_v_load_same</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#not_in_apply_buffer_load_eq_rev">not_in_apply_buffer_load_eq_rev</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H1</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ">count_occ</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> <span class="id">bf</span>) <span class="id">L</span> = 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ_not_In">count_occ_not_In</a></span> <span class="kwd">in</span> <span class="id">H3</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hblock_neq</span> : <span class="id"><a href="TSOMemLemmas.html#get_bi_block">get_bi_block</a></span> <span class="id">a</span> &lt;&gt; <span class="id">L</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="MemLemmas.html#item_in_bf_add_count_one_block_neq">item_in_bf_add_count_one_block_neq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>; <span class="id">unfolds</span> <span class="id">optbind</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="id">m</span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>) <span class="id">eqn</span>:<span class="id">Halloc</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf</span> <span class="kwd">with</span> (<span class="id">m</span> := <span class="id">g</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> <span class="id">b</span> <span class="id">L</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="kwd">in</span> <span class="id">Halloc</span>. <span class="id">inv</span> <span class="id">Halloc</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#free">free</a></span> <span class="id">m</span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>) <span class="id">eqn</span>:<span class="id">Hfree</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf</span> <span class="kwd">with</span> (<span class="id">m</span> := <span class="id">g</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> <span class="id">b</span> <span class="id">L</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id">m0</span> <span class="id">m</span> <span class="id">b</span> <span class="id">z</span> <span class="id">v0</span>) <span class="id">eqn</span>:<span class="id">Hfree</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf</span> <span class="kwd">with</span> (<span class="id">m</span> := <span class="id">g</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> <span class="id">b</span> <span class="id">L</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_buffer_count_one_load">in_buffer_count_one_load</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">L</span> <span class="id">n</span> <span class="id">bf</span> <span class="id">fm</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="TSOMem.html#BufferedStore">BufferedStore</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id"><a href="MemLemmas.html#L">L</a></span> 0 (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="MemLemmas.html#n">n</a></span>)) <span class="id"><a href="MemLemmas.html#bf">bf</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ">count_occ</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> <span class="id"><a href="MemLemmas.html#bf">bf</a></span>) <span class="id"><a href="MemLemmas.html#L">L</a></span> = 1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tsoloadv">tsoloadv</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> {| <span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span> := <span class="id"><a href="MemLemmas.html#bf">bf</a></span>; <span class="id">fmemory</span> := <span class="id"><a href="MemLemmas.html#fm">fm</a></span> |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id"><a href="MemLemmas.html#L">L</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0)) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="MemLemmas.html#v">v</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="MemLemmas.html#v">v</a></span> = <span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="MemLemmas.html#n">n</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9911')">Proof.</div>
<div class="proofscript" id="proof9911">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">tsoloadv</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">tsoload</span>.<br/>
&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="Integers.html#Ptrofs.unsigned">Ptrofs.unsigned</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0)) <span class="kwd">with</span> 0%<span class="id">Z</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id">bf</span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm</span>)) <span class="id">eqn</span>:<span class="id">Happly_buffer</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">in_buffer_count_one_load</span>'; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">in_buffer_count_one_load2</span>' :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf1</span> <span class="id">bf2</span> <span class="id">bf</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span> <span class="id">n</span> <span class="id">m</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="MemLemmas.html#bf">bf</a></span> = <span class="id"><a href="MemLemmas.html#bf1">bf1</a></span> ++ (<span class="id"><a href="TSOMem.html#BufferedStore">BufferedStore</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id"><a href="MemLemmas.html#b">b</a></span> <span class="id"><a href="MemLemmas.html#ofs">ofs</a></span> (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="MemLemmas.html#n">n</a></span>) :: <span class="id"><a href="MemLemmas.html#bf2">bf2</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">ofs</span>, ~ <span class="id"><a href="TSOMem.html#in_buffer">in_buffer</a></span> (<span class="id"><a href="MemLemmas.html#bf1">bf1</a></span> ++ <span class="id"><a href="MemLemmas.html#bf2">bf2</a></span>) <span class="id"><a href="MemLemmas.html#b">b</a></span> <span class="id"><a href="MemLemmas.html#ofs">ofs</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="MemLemmas.html#bf">bf</a></span> <span class="id"><a href="MemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt; <span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id">m</span>' <span class="id"><a href="MemLemmas.html#b">b</a></span> <span class="id"><a href="MemLemmas.html#ofs">ofs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="MemLemmas.html#v">v</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="MemLemmas.html#v">v</a></span> = <span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="MemLemmas.html#n">n</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9912')">Proof.</div>
<div class="proofscript" id="proof9912">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf1</span>; <span class="id">simpls</span>; <span class="tactic">intros</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id">n</span>)) <span class="id">eqn</span>:?; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#gm_store_v_load_same">gm_store_v_load_same</a></span> <span class="kwd">in</span> <span class="id">Heqo</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#load_orignal_loc_not_in_bf_apply_buf_same_val">load_orignal_loc_not_in_bf_apply_buf_same_val</a></span> <span class="kwd">in</span> <span class="id">Heqo</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqo</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">m</span>); <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H0</span> <span class="id">ofs0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
&nbsp;&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_buffer_count_one_load2">in_buffer_count_one_load2</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf1</span> <span class="id">bf2</span> <span class="id">bf</span> <span class="id">L</span> <span class="id">n</span> <span class="id">fm</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="MemLemmas.html#bf">bf</a></span> = <span class="id"><a href="MemLemmas.html#bf1">bf1</a></span> ++ (<span class="id"><a href="TSOMem.html#BufferedStore">BufferedStore</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id"><a href="MemLemmas.html#L">L</a></span> 0 (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="MemLemmas.html#n">n</a></span>)) :: <span class="id"><a href="MemLemmas.html#bf2">bf2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">ofs</span>, ~ <span class="id"><a href="TSOMem.html#in_buffer">in_buffer</a></span> (<span class="id"><a href="MemLemmas.html#bf1">bf1</a></span> ++ <span class="id"><a href="MemLemmas.html#bf2">bf2</a></span>) <span class="id"><a href="MemLemmas.html#L">L</a></span> <span class="id"><a href="MemLemmas.html#ofs">ofs</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tsoloadv">tsoloadv</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> {| <span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span> := <span class="id"><a href="MemLemmas.html#bf">bf</a></span>; <span class="id">fmemory</span> := <span class="id"><a href="MemLemmas.html#fm">fm</a></span> |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id"><a href="MemLemmas.html#L">L</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0)) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="MemLemmas.html#v">v</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="MemLemmas.html#v">v</a></span> = <span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="MemLemmas.html#n">n</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9913')">Proof.</div>
<div class="proofscript" id="proof9913">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">tsoloadv</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">tsoload</span>.<br/>
&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="Integers.html#Ptrofs.unsigned">Ptrofs.unsigned</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0)) <span class="kwd">with</span> 0%<span class="id">Z</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id">bf</span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm</span>)) <span class="id">eqn</span>:<span class="id">Happly_buffer</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">in_buffer_count_one_load2</span>'; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">not_in_apply_buffer_load_eq</span>' :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bf</span> <span class="id">c</span> <span class="id">gm</span> <span class="id">gm</span>' <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="MemLemmas.html#bf">bf</a></span> <span class="id"><a href="MemLemmas.html#gm">gm</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">gm</span>' -&gt; ~ (<span class="id">exists</span> <span class="id">ofs</span>, <span class="id"><a href="TSOMem.html#in_buffer">in_buffer</a></span> <span class="id"><a href="MemLemmas.html#bf">bf</a></span> <span class="id"><a href="MemLemmas.html#b">b</a></span> <span class="id"><a href="MemLemmas.html#ofs">ofs</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="MemLemmas.html#c">c</a></span> <span class="id">gm</span>' <span class="id"><a href="MemLemmas.html#b">b</a></span> <span class="id"><a href="MemLemmas.html#ofs">ofs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="MemLemmas.html#v">v</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="MemLemmas.html#c">c</a></span> <span class="id"><a href="MemLemmas.html#gm">gm</a></span> <span class="id"><a href="MemLemmas.html#b">b</a></span> <span class="id"><a href="MemLemmas.html#ofs">ofs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="MemLemmas.html#v">v</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9914')">Proof.</div>
<div class="proofscript" id="proof9914">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">optbind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">gm</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbf</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H0</span> <span class="id">Heqo</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">apply_buffer_item</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">b</span> &lt;&gt; <span class="id">b0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">z</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id">b0</span> <span class="id">z</span> <span class="id">z0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#load_alloc_val_same_rev">load_alloc_val_same_rev</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">free</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Heqo</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">unchecked_free</span>, <span class="id">load</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H0</span> <span class="id">v0</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">valid_access</span>, <span class="id">range_perm</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">n</span>; <span class="tactic">clear</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">b0</span> <span class="id">b</span>); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">ofs0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id"><a href="TSOMem.html#BufferedFree">BufferedFree</a></span> <span class="id">b</span> <span class="id">z</span> <span class="id">z0</span>); <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">andb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zle">zle</a></span> <span class="id">z</span> <span class="id">ofs0</span>); <span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zlt">zlt</a></span> <span class="id">ofs0</span> <span class="id">z0</span>); <span class="id">simpls</span>; <span class="tactic">eauto</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Heqo</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">load</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">b0</span> <span class="id">b</span>); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">v2</span> <span class="id">H0</span> <span class="id">v1</span> <span class="id">v3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">valid_access</span>, <span class="id">range_perm</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="FMemory.html#Mem.getN">Mem.getN</a></span> (<span class="id"><a href="Memdata.html#size_chunk_nat">size_chunk_nat</a></span> <span class="id">c</span>) <span class="id">ofs</span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id">gm</span>) !! <span class="id">b</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.getN">Mem.getN</a></span> (<span class="id"><a href="Memdata.html#size_chunk_nat">size_chunk_nat</a></span> <span class="id">c</span>) <span class="id">ofs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="FMemory.html#Mem.setN">Mem.setN</a></span> (<span class="id"><a href="Memdata.html#encode_val">encode_val</a></span> <span class="id">m</span> <span class="id">v0</span>) <span class="id">z</span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id">gm</span>) !! <span class="id">b</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="FMemLemmas.html#get_eq_getN_eq">get_eq_getN_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="FMemory.html#Mem.setN_outside">Mem.setN_outside</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="TSOMemLemmas.html#inrange_or_not1">inrange_or_not1</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Memdata.html#encode_val_length">encode_val_length</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="Memdata.html#size_chunk_conv">size_chunk_conv</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H1</span> <span class="id">ofs0</span> <span class="id">z</span> (<span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id">m</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">ofs0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id"><a href="TSOMem.html#BufferedStore">BufferedStore</a></span> <span class="id">m</span> <span class="id">b</span> <span class="id">z</span> <span class="id">v0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">v2</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>; <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="tsoloadv_not_in_bf_load_gm_eq">tsoloadv_not_in_bf_load_gm_eq</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">fm</span> <span class="id">L</span> <span class="id">v</span> <span class="id">m</span> <span class="id">fl</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tsoloadv">tsoloadv</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> {| <span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span> := <span class="id"><a href="MemLemmas.html#b">b</a></span>; <span class="id">fmemory</span> := <span class="id"><a href="MemLemmas.html#fm">fm</a></span> |} (<span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id"><a href="MemLemmas.html#L">L</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="MemLemmas.html#v">v</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id"><a href="MemLemmas.html#m">m</a></span> <span class="id"><a href="MemLemmas.html#fl">fl</a></span> <span class="id"><a href="MemLemmas.html#fm">fm</a></span> -&gt; ~ (<span class="id">exists</span> <span class="id">ofs</span>, <span class="id"><a href="TSOMem.html#in_buffer">in_buffer</a></span> <span class="id"><a href="MemLemmas.html#b">b</a></span> <span class="id"><a href="MemLemmas.html#L">L</a></span> <span class="id">ofs</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id"><a href="MemLemmas.html#m">m</a></span> <span class="id"><a href="MemLemmas.html#L">L</a></span> 0 = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="MemLemmas.html#v">v</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9915')">Proof.</div>
<div class="proofscript" id="proof9915">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">tsoloadv</span>.<br/>
&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="Integers.html#Ptrofs.unsigned">Ptrofs.unsigned</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0)) <span class="kwd">with</span> 0%<span class="id">Z</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">tsoload</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id">b</span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm</span>)) <span class="id">eqn</span>:<span class="id">Happly_buffer</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">not_in_apply_buffer_load_eq</span>'; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="unbuffer_safe_store_preserve">unbuffer_safe_store_preserve</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">b</span> <span class="id">bfs</span> <span class="id">ofs</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="MemLemmas.html#bfs">bfs</a></span>; <span class="id">memory</span> := <span class="id"><a href="MemLemmas.html#m">m</a></span> |} -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="MemLemmas.html#c">c</a></span> <span class="id"><a href="MemLemmas.html#m">m</a></span> <span class="id"><a href="MemLemmas.html#b">b</a></span> <span class="id"><a href="MemLemmas.html#ofs">ofs</a></span> <span class="id"><a href="MemLemmas.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">t</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="MemLemmas.html#b">b</a></span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> (<span class="id"><a href="MemLemmas.html#bfs">bfs</a></span> <span class="id"><a href="MemLemmas.html#t">t</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> <span class="id">v</span>', <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="TSOMem.html#BufferedStore">BufferedStore</a></span> <span class="id"><a href="MemLemmas.html#c">c</a></span> <span class="id"><a href="MemLemmas.html#b">b</a></span> <span class="id"><a href="MemLemmas.html#ofs">ofs</a></span> <span class="id">v</span>') (<span class="id"><a href="MemLemmas.html#bfs">bfs</a></span> <span class="id"><a href="MemLemmas.html#t">t</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ">count_occ</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> (<span class="id"><a href="MemLemmas.html#bfs">bfs</a></span> <span class="id"><a href="MemLemmas.html#t">t</a></span>)) <span class="id"><a href="MemLemmas.html#b">b</a></span> = 1)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="MemLemmas.html#bfs">bfs</a></span>; <span class="id">memory</span> := <span class="id">m</span>' |}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9916')">Proof.</div>
<div class="proofscript" id="proof9916">
&nbsp;&nbsp;<span class="id">introv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">m</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">c</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">b</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">ofs</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">v</span>.<br/>
&nbsp;&nbsp;<span class="id">remember</span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id">bfs</span>; <span class="id">memory</span> := <span class="id">m</span> |} <span class="kwd">as</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">m</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">bfs</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">H</span>; <span class="id">simpls</span>; <span class="tactic">intros</span>. <br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">intros</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ABIS</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> [<span class="id">m</span>'' <span class="id">H2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buffer_item_store_still">apply_buffer_item_store_still</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">b1</span> &lt;&gt; <span class="id">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H1</span> <span class="id">t</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Ht</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">b</span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> (<span class="id">bfs</span> <span class="id">t</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ht</span> <span class="kwd">as</span> [<span class="id">v</span>' [<span class="id">Hin_buf</span> <span class="id">Hcount</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">Hin_buf</span>, <span class="id">Hcount</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hin_buf</span>, <span class="id">Hcount</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> <span class="id">b</span> <span class="id">b</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin_buf</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ">count_occ</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> <span class="id">b0</span>) <span class="id">b</span> = 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H4</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ_not_In">count_occ_not_In</a></span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="MemLemmas.html#b_not_bf_item_not1">b_not_bf_item_not1</a></span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H5</span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Halloc</span> : <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Halloc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#alloc_store_still_rev">alloc_store_still_rev</a></span> <span class="kwd">in</span> <span class="id">Halloc</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Halloc</span> <span class="kwd">as</span> [<span class="id">m</span>'' <span class="id">Halloc</span>]. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hstore</span> : <span class="id"><a href="TSOMemLemmas.html#store_alloc_still">store_alloc_still</a></span> <span class="id">___</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hstore</span> <span class="kwd">as</span> [<span class="id">m</span>''' <span class="id">Hstore</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">m</span>'0 = <span class="id">m</span>''').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#store_alloc_eq_alloc_store">store_alloc_eq_alloc_store</a></span> <span class="kwd">with</span> (<span class="id">m</span> := <span class="id">m</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t0</span> <span class="id">t</span>) <span class="id">eqn</span>:?; <span class="tactic">subst</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">b</span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> (<span class="id">bfs</span> <span class="id">t</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H6</span> <span class="kwd">as</span> [<span class="id">v</span>' [<span class="id">Hin</span> <span class="id">Hcount_occ</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hin</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">Hcount_occ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hcount_occ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> <span class="id">b1</span> <span class="id">b</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t0</span> <span class="id">t</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">b1</span> &lt;&gt; <span class="id">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H1</span> <span class="id">t</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Ht</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">b</span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> (<span class="id">bfs</span> <span class="id">t</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ht</span> <span class="kwd">as</span> [<span class="id">v</span>' [<span class="id">Hin_buf</span> <span class="id">Hcount</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">Hin_buf</span>, <span class="id">Hcount</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hin_buf</span>, <span class="id">Hcount</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> <span class="id">b</span> <span class="id">b</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin_buf</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ">count_occ</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> <span class="id">b0</span>) <span class="id">b</span> = 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H4</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ_not_In">count_occ_not_In</a></span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="MemLemmas.html#b_not_bf_item_not1">b_not_bf_item_not1</a></span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H5</span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hfree</span> : <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hfree</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#free_store_still_rev">free_store_still_rev</a></span> <span class="kwd">in</span> <span class="id">Hfree</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hfree</span> <span class="kwd">as</span> [<span class="id">m</span>'' <span class="id">Hfree</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hstore</span> : <span class="id"><a href="TSOMemLemmas.html#store_free_other_still">store_free_other_still</a></span> <span class="id">___</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hstore</span> <span class="kwd">as</span> [<span class="id">m</span>''' <span class="id">Hstore</span>].<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">m</span>'0 = <span class="id">m</span>''').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#store_free_eq_free_store">store_free_eq_free_store</a></span> <span class="kwd">with</span> (<span class="id">m</span> := <span class="id">m</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t0</span> <span class="id">t</span>) <span class="id">eqn</span>:?; <span class="tactic">subst</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">b</span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> (<span class="id">bfs</span> <span class="id">t</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H6</span> <span class="kwd">as</span> [<span class="id">v</span>' [<span class="id">Hin</span> <span class="id">Hcount_occ</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">Hcount_occ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hcount_occ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> <span class="id">b1</span> <span class="id">b</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t0</span> <span class="id">t</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">b1</span> <span class="id">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">b</span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> (<span class="id">bfs</span> <span class="id">t</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H4</span> <span class="kwd">as</span> [<span class="id">v</span>' [<span class="id">Hin_bf</span> <span class="id">Hcount</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">Hin_bf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hin_bf</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin_bf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H4</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hstore1</span> : <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hstore1</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">exists</span> <span class="id">m</span>'', <span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> (<span class="id"><a href="TSOMem.html#BufferedStore">BufferedStore</a></span> <span class="id">c</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span>') <span class="id">m</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#store_store_other_val">store_store_other_val</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H4</span> <span class="kwd">as</span> [<span class="id">m</span>'' <span class="id">H4</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">with</span> (<span class="id">m</span>' := <span class="id">m</span>''); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">m</span>'0 = <span class="id">m</span>'').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#store_twice_eq_store_dir">store_twice_eq_store_dir</a></span> <span class="kwd">with</span> (<span class="id">m</span> := <span class="id">m</span>) (<span class="id">m</span>' := <span class="id">m</span>') <span class="kwd">in</span> <span class="id">H0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H4</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#store_again_mem_eq">store_again_mem_eq</a></span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t0</span> <span class="id">t</span>) <span class="id">eqn</span>:?; <span class="tactic">subst</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">Hcount</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hcount</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> <span class="id">b</span> <span class="id">b</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ">count_occ</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> <span class="id">b0</span>) <span class="id">b</span> = 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ_not_In">count_occ_not_In</a></span> <span class="kwd">in</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H6</span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t0</span> <span class="id">t</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">Hcount</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hcount</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> <span class="id">b</span> <span class="id">b</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ">count_occ</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> <span class="id">b0</span>) <span class="id">b</span> = 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ_not_In">count_occ_not_In</a></span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="MemLemmas.html#b_not_bf_item_not1">b_not_bf_item_not1</a></span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H5</span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hstore</span> : <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hstore</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">m0</span> <span class="id">to</span> <span class="id">c0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#store_store_still_rev">store_store_still_rev</a></span> <span class="kwd">in</span> <span class="id">Hstore</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hstore</span> <span class="kwd">as</span> [<span class="id">m</span>'' <span class="id">Hstore</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">with</span> (<span class="id">m</span>' := <span class="id">m</span>''); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id">v</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id">c</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H0</span> <span class="id">H3</span> <span class="id">Hstore</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id">Hstore</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#store_store_still">store_store_still</a></span> <span class="kwd">with</span> (<span class="id">c</span> := <span class="id">c</span>) (<span class="id">m</span> := <span class="id">m</span>) <span class="kwd">in</span> <span class="id">Ht</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ht</span> <span class="kwd">as</span> [<span class="id">m</span>''' <span class="id">Ht</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">m</span>'0 = <span class="id">m</span>''').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#store_store_eq_store_store">store_store_eq_store_store</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">Hstore</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t0</span> <span class="id">t</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">b</span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> (<span class="id">bfs</span> <span class="id">t</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H5</span> <span class="kwd">as</span> [<span class="id">v</span>' [<span class="id">Hin_buf</span> <span class="id">Hcount</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">Hin_buf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hin_buf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin_buf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H5</span>; <span class="tactic">subst</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">Hcount</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hcount</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> <span class="id">b1</span> <span class="id">b</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t0</span> <span class="id">t</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="unbuffer_safe_Mem_store_stable">unbuffer_safe_Mem_store_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tm</span> <span class="id">fl</span> <span class="id">fm</span> <span class="id">b</span> <span class="id">n</span> <span class="id">fm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="MemLemmas.html#tm">tm</a></span>) <span class="id"><a href="MemLemmas.html#fl">fl</a></span> <span class="id"><a href="MemLemmas.html#fm">fm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> <span class="id"><a href="MemLemmas.html#tm">tm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">t</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="MemLemmas.html#b">b</a></span> (<span class="id"><a href="TSOMem.html#get_tsom_b">get_tsom_b</a></span> <span class="id"><a href="MemLemmas.html#t">t</a></span> <span class="id"><a href="MemLemmas.html#tm">tm</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> <span class="id">v</span>', <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="TSOMem.html#BufferedStore">BufferedStore</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id"><a href="MemLemmas.html#b">b</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Integers.html#Ptrofs.unsigned">Ptrofs.unsigned</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0))  <span class="id">v</span>') (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="MemLemmas.html#tm">tm</a></span> <span class="id"><a href="MemLemmas.html#t">t</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ">count_occ</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> (<span class="id"><a href="TSOMem.html#get_tsom_b">get_tsom_b</a></span> <span class="id"><a href="MemLemmas.html#t">t</a></span> <span class="id"><a href="MemLemmas.html#tm">tm</a></span>) <span class="id"><a href="MemLemmas.html#b">b</a></span> = 1)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.storev">Mem.storev</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id"><a href="MemLemmas.html#fm">fm</a></span> (<span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id"><a href="MemLemmas.html#b">b</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> 0)) (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="MemLemmas.html#n">n</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">fm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="MemLemmas.html#tm">tm</a></span>; <span class="id">memory</span> := <span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm</span>' |}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9917')">Proof.</div>
<div class="proofscript" id="proof9917">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>. <br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#store_fm_eq_store_gm">store_fm_eq_store_gm</a></span> <span class="kwd">in</span> <span class="id">H2</span>. <br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="MemLemmas.html#unbuffer_safe_store_preserve">unbuffer_safe_store_preserve</a></span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Can remove to TSOMemlemmas </div>
<span class="kwd">Lemma</span> <span class="id"><a name="alloc_apply_buf_block_neq_reorder_succ1">alloc_apply_buf_block_neq_reorder_succ1</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">bi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ (<span class="id">exists</span> <span class="id">lo</span>' <span class="id">hi</span>', <span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id"><a href="MemLemmas.html#b">b</a></span> <span class="id">lo</span>' <span class="id">hi</span>' = <span class="id"><a href="MemLemmas.html#bi">bi</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="id"><a href="MemLemmas.html#m">m</a></span> <span class="id"><a href="MemLemmas.html#b">b</a></span> <span class="id"><a href="MemLemmas.html#lo">lo</a></span> <span class="id"><a href="MemLemmas.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="MemLemmas.html#m1">m1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="MemLemmas.html#bi">bi</a></span> <span class="id"><a href="MemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="MemLemmas.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="MemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="MemLemmas.html#m">m</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m3</span>, <span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="MemLemmas.html#bi">bi</a></span> <span class="id"><a href="MemLemmas.html#m1">m1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m3</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9918')">Proof.</div>
<div class="proofscript" id="proof9918">
&nbsp;&nbsp;<span class="id">introv</span> <span class="id">Hnot_alloc_b</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hstep</span> : <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#buf_item_unbuf_locality_1">buf_item_unbuf_locality_1</a></span> <span class="kwd">in</span> <span class="id">Hstep</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hstep</span> <span class="id">m1</span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="InteractionSemantics.html#MemPre">InteractionSemantics.MemPre</a></span> <span class="id">m</span> <span class="id">m1</span> (<span class="id"><a href="TSOMem.html#bi_footprint">bi_footprint</a></span> <span class="id">bi</span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOAuxDefs.html#apply_buf_item_outside_stable">apply_buf_item_outside_stable</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">bi</span> := <span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H0</span> <span class="id">H1</span> <span class="id">Hnot_alloc_b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#uncheck_alloc_fp">uncheck_alloc_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>; <span class="tactic">unfold</span> <span class="id"><a href="Footprint.html#Locs.smile">Locs.smile</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#Locs.locs_intersect_emp_sym">Locs.locs_intersect_emp_sym</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">split</span>; <span class="tactic">eapply</span> <span class="id"><a href="Footprint.html#Locs.eq_refl">Locs.eq_refl</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Footprint.html#Locs.eq">Locs.eq</a></span>; <span class="tactic">intros</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Locs.intersect</span>, <span class="id">Locs.emp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">Hnot_alloc_b</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#free_fp">free_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>; <span class="tactic">simpl</span>; <span class="tactic">unfold</span> <span class="id"><a href="Footprint.html#Locs.smile">Locs.smile</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#Locs.locs_intersect_emp_sym">Locs.locs_intersect_emp_sym</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">split</span>; <span class="tactic">eapply</span> <span class="id"><a href="Footprint.html#Locs.eq_refl">Locs.eq_refl</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#range_locset">range_locset</a></span>, <span class="id"><a href="Footprint.html#Locs.eq">Locs.eq</a></span>, <span class="id"><a href="Footprint.html#Locs.intersect">Locs.intersect</a></span>, <span class="id"><a href="Footprint.html#Locs.emp">Locs.emp</a></span>; <span class="tactic">intros</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Zplus_minus">Zplus_minus</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zle">zle</a></span> <span class="id">z</span> <span class="id">ofs</span>); <span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zlt">zlt</a></span> <span class="id">ofs</span> <span class="id">z0</span>); <span class="id">simpls</span>; <span class="id">tryfalse</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H0</span> <span class="id">H1</span> <span class="id">l</span> <span class="id">l0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">free</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">r</span> <span class="id">H1</span> <span class="id">l</span> <span class="id">l0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">range_perm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> ((<span class="id">z</span> &lt;= <span class="id">ofs</span> &lt; <span class="id">z0</span>)%<span class="id">Z</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">r</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="GMemory.html#GMem.invalid_noaccess">GMem.invalid_noaccess</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.perm_order</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">simpl</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#store_fp">store_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>; <span class="tactic">simpl</span>; <span class="tactic">unfold</span> <span class="id"><a href="Footprint.html#Locs.smile">Locs.smile</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#Locs.locs_intersect_emp_sym">Locs.locs_intersect_emp_sym</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">split</span>; <span class="tactic">eapply</span> <span class="id"><a href="Footprint.html#Locs.eq_refl">Locs.eq_refl</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Footprint.html#Locs.eq_refl">Locs.eq_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#range_locset">range_locset</a></span>, <span class="id"><a href="Footprint.html#Locs.eq">Locs.eq</a></span>, <span class="id"><a href="Footprint.html#Locs.intersect">Locs.intersect</a></span>, <span class="id"><a href="Footprint.html#Locs.emp">Locs.emp</a></span>; <span class="tactic">intros</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">simpl</span>; <span class="tactic">subst</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zle">zle</a></span> <span class="id">z</span> <span class="id">ofs</span>); <span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zlt">zlt</a></span> <span class="id">ofs</span> (<span class="id">z</span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id">m0</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">v0</span> <span class="id">H1</span> <span class="id">l</span> <span class="id">l0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">valid_access</span>, <span class="id">range_perm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> ((<span class="id">z</span> &lt;= <span class="id">ofs</span> &lt; <span class="id">z</span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id">m0</span>)%<span class="id">Z</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="GMemory.html#GMem.invalid_noaccess">GMem.invalid_noaccess</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.perm_order</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zle">zle</a></span> <span class="id">z</span> <span class="id">ofs</span>); <span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zlt">zlt</a></span> <span class="id">ofs</span> (<span class="id">z</span> + <span class="id"><a href="Memdata.html#size_chunk">size_chunk</a></span> <span class="id">m0</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemOpFP.html#range_locset">range_locset</a></span>, <span class="id"><a href="Footprint.html#Locs.eq">Locs.eq</a></span>, <span class="id"><a href="Footprint.html#Locs.intersect">Locs.intersect</a></span>, <span class="id"><a href="Footprint.html#Locs.emp">Locs.emp</a></span>; <span class="tactic">intros</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hstep</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> (<span class="id">m</span>'0 &amp; <span class="id">Happly_buf</span> &amp; <span class="id">HMemPost</span>).<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="alloc_newblk_apply_buf_on_original_block_reorder">alloc_newblk_apply_buf_on_original_block_reorder</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">m</span>'0 <span class="id">m1</span> <span class="id">bi</span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ (<span class="id">exists</span> <span class="id">lo</span>' <span class="id">hi</span>', <span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id"><a href="MemLemmas.html#b">b</a></span> <span class="id">lo</span>' <span class="id">hi</span>' = <span class="id"><a href="MemLemmas.html#bi">bi</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="MemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="MemLemmas.html#m">m</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="id"><a href="MemLemmas.html#m">m</a></span> <span class="id"><a href="MemLemmas.html#b">b</a></span> <span class="id"><a href="MemLemmas.html#lo">lo</a></span> <span class="id"><a href="MemLemmas.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="MemLemmas.html#bi">bi</a></span> <span class="id">m</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="MemLemmas.html#bi">bi</a></span> <span class="id"><a href="MemLemmas.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="MemLemmas.html#m1">m1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m</span>'1, <span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="id"><a href="MemLemmas.html#m1">m1</a></span> <span class="id"><a href="MemLemmas.html#b">b</a></span> <span class="id"><a href="MemLemmas.html#lo">lo</a></span> <span class="id"><a href="MemLemmas.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'1 /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m</span>'0 = <span class="id"><a href="GMemory.html#GMem.mem_access">GMem.mem_access</a></span> <span class="id">m</span>'1.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9919')">Proof.</div>
<div class="proofscript" id="proof9919">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>; <span class="id">inv</span> <span class="id">H2</span>; <span class="id">inv</span> <span class="id">H3</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">b</span> &lt;&gt; <span class="id">b0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#PMap_set_twice_not_same_reorder_eq">PMap_set_twice_not_same_reorder_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>, <span class="id">free</span>, <span class="id">unchecked_free</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>; <span class="id">inv</span> <span class="id">H2</span>; <span class="id">inv</span> <span class="id">H3</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">b0</span> <span class="id">b</span>) <span class="id">eqn</span>:?; <span class="id">simpls</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.set2">PMap.set2</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> ((<span class="kwd">fun</span> (<span class="id">ofs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) (<span class="id">_</span> : <span class="id"><a href="Memperm.html#perm_kind">perm_kind</a></span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="Coqlib.html#zle">zle</a></span> <span class="id">z</span> <span class="id"><a href="MemLemmas.html#ofs">ofs</a></span> &amp;&amp; <span class="id"><a href="Coqlib.html#zlt">zlt</a></span> <span class="id"><a href="MemLemmas.html#ofs">ofs</a></span> <span class="id">z0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="kwd">if</span> <span class="id"><a href="Coqlib.html#zle">zle</a></span> <span class="id">lo</span> <span class="id"><a href="MemLemmas.html#ofs">ofs</a></span> &amp;&amp; <span class="id"><a href="Coqlib.html#zlt">zlt</a></span> <span class="id"><a href="MemLemmas.html#ofs">ofs</a></span> <span class="id">hi</span> <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="Memperm.html#Freeable">Freeable</a></span> <span class="kwd">else</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>) = <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> (<span class="id">ofs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) (<span class="id">_</span> : <span class="id"><a href="Memperm.html#perm_kind">perm_kind</a></span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="Coqlib.html#zle">zle</a></span> <span class="id">lo</span> <span class="id"><a href="MemLemmas.html#ofs">ofs</a></span> &amp;&amp; <span class="id"><a href="Coqlib.html#zlt">zlt</a></span> <span class="id"><a href="MemLemmas.html#ofs">ofs</a></span> <span class="id">hi</span> <span class="kwd">then</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="Memperm.html#Freeable">Freeable</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Axioms.html#functional_extensionality">functional_extensionality</a></span>; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Axioms.html#functional_extensionality">functional_extensionality</a></span>; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">r</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zle">zle</a></span> <span class="id">z</span> <span class="id">x</span>); <span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zlt">zlt</a></span> <span class="id">x</span> <span class="id">z0</span>); <span class="id">simpls</span>; <span class="id">tryfalse</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">range_perm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> ((<span class="id">z</span> &lt;= <span class="id">x</span> &lt; <span class="id">z0</span>)%<span class="id">Z</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">r</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">invalid_noaccess</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Mem.perm_order</span>' <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#PMap_set_twice_not_same_reorder_eq">PMap_set_twice_not_same_reorder_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>, <span class="id">store</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>; <span class="id">inv</span> <span class="id">H2</span>; <span class="id">inv</span> <span class="id">H3</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
&nbsp;&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id">unbuffer_safe_alloc_preserve</span>' :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>' <span class="id">bfs</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="MemLemmas.html#bfs">bfs</a></span>; <span class="id">memory</span> := <span class="id"><a href="MemLemmas.html#m">m</a></span> |} -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="id"><a href="MemLemmas.html#m">m</a></span> <span class="id"><a href="MemLemmas.html#b">b</a></span> <span class="id"><a href="MemLemmas.html#lo">lo</a></span> <span class="id"><a href="MemLemmas.html#hi">hi</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="MemLemmas.html#b">b</a></span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id"><a href="MemLemmas.html#m">m</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">t</span> <span class="id">lo</span>' <span class="id">hi</span>', ~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id"><a href="MemLemmas.html#b">b</a></span> <span class="id">lo</span>' <span class="id">hi</span>') (<span class="id"><a href="MemLemmas.html#bfs">bfs</a></span> <span class="id"><a href="MemLemmas.html#t">t</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="MemLemmas.html#bfs">bfs</a></span>; <span class="id">memory</span> := <span class="id">m</span>' |}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9920')">Proof.</div>
<div class="proofscript" id="proof9920">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">remember</span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id">bfs</span>; <span class="id">memory</span> := <span class="id">m</span> |} <span class="kwd">as</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">bfs</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">m</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">m</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">H</span>; <span class="id">simpls</span>; <span class="tactic">intros</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">intros</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hbf</span> : <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ABIS</span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H3</span> <span class="kwd">as</span> [<span class="id">m</span>'' <span class="id">H3</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H0</span> <span class="id">H1</span> <span class="id">H2</span> <span class="id">H3</span> <span class="id">Hbf</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="MemLemmas.html#alloc_apply_buf_block_neq_reorder_succ1">alloc_apply_buf_block_neq_reorder_succ1</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">lo</span>' &amp; <span class="id">hi</span>' &amp; <span class="id">Hub_alloc</span>); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H2</span> <span class="id">t</span> <span class="id">lo</span>' <span class="id">hi</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H2</span>; <span class="tactic">rewrite</span> <span class="id">Hbf</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Happly_buf</span> : <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ABIS</span> <span class="kwd">in</span> <span class="id">Happly_buf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Happly_buf</span> <span class="kwd">as</span> [<span class="id">m1</span> <span class="id">Happly_buf</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hcons</span> : <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Halloc</span> : <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="MemLemmas.html#alloc_newblk_apply_buf_on_original_block_reorder">alloc_newblk_apply_buf_on_original_block_reorder</a></span> <span class="kwd">in</span> <span class="id">Halloc</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Halloc</span> <span class="kwd">as</span> (<span class="id">m</span>'1 &amp; <span class="id">Halloc</span> &amp; <span class="id">Hmem_access</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Hcons</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2 : <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;4 : <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2 : <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#unbuffer_safe_mem_access_same_stable">unbuffer_safe_mem_access_same_stable</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H1</span> <span class="id">Happly_buf</span> <span class="id">H2</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">alloc</span>; <span class="id">inv</span> <span class="id">Happly_buf</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> (<span class="id">H2</span> <span class="id">t</span> <span class="id">z</span> <span class="id">z0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H3</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">free</span>, <span class="id">unchecked_free</span>; <span class="id">ex_match2</span>; <span class="id">inv</span> <span class="id">Happly_buf</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>; <span class="id">ex_match2</span>; <span class="id">inv</span> <span class="id">Happly_buf</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t0</span>); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H2</span> <span class="id">t0</span> <span class="id">lo</span>' <span class="id">hi</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">H3</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_not_eq_get">tupdate_not_eq_get</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H2</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">lo</span> &amp; <span class="id">hi</span> &amp; <span class="id">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> (<span class="id">H2</span> <span class="id">t</span> <span class="id">lo</span> <span class="id">hi</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H3</span>; <span class="tactic">subst</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">unbuffer_safe_tsoalloc_0_stable</span>' :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tm</span> <span class="id">gm</span> <span class="id">fl</span> <span class="id">gm</span>' <span class="id">fm</span>' <span class="id">lo</span> <span class="id">hi</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> <span class="id"><a href="MemLemmas.html#tm">tm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">t</span>' <span class="id">blk</span> <span class="id">n</span> <span class="id">lo</span> <span class="id">hi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">t</span>' &lt;&gt; <span class="id"><a href="MemLemmas.html#t">t</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id"><a href="MemLemmas.html#blk">blk</a></span> <span class="id"><a href="MemLemmas.html#lo">lo</a></span> <span class="id"><a href="MemLemmas.html#hi">hi</a></span>) (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="MemLemmas.html#tm">tm</a></span> <span class="id">t</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="MemLemmas.html#blk">blk</a></span> &lt;&gt; <span class="id"><a href="MemAux.html#get_block">get_block</a></span> <span class="id"><a href="MemLemmas.html#fl">fl</a></span> <span class="id"><a href="MemLemmas.html#n">n</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="MemLemmas.html#tm">tm</a></span> <span class="id"><a href="MemLemmas.html#t">t</a></span>) <span class="id"><a href="MemLemmas.html#gm">gm</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">gm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">gm</span>' <span class="id"><a href="MemLemmas.html#fl">fl</a></span> <span class="id">fm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="MemLemmas.html#gm">gm</a></span> = <span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="MemLemmas.html#tm">tm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="MemLemmas.html#t">t</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="MemLemmas.html#tm">tm</a></span> <span class="id"><a href="MemLemmas.html#t">t</a></span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> (<span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id">fm</span>') <span class="id"><a href="MemLemmas.html#lo">lo</a></span> <span class="id"><a href="MemLemmas.html#hi">hi</a></span> :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="MemLemmas.html#tm">tm</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">memory</span> := <span class="id"><a href="MemLemmas.html#gm">gm</a></span> |}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9921')">Proof.</div>
<div class="proofscript" id="proof9921">
&nbsp;&nbsp;<span class="id">introv</span> <span class="id">Hp</span>.<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id">Hp</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">gm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">gm</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">fm</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">lo</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">hi</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hp</span>; <span class="tactic">intros</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">intros</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t0</span> <span class="id">t</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tso</span> <span class="id">t</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H4</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H4</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ABIS</span> <span class="kwd">in</span> <span class="id">H4</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t0</span> <span class="id">t</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_tid_eq">tupdate_same_tid_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tso</span> <span class="id">t</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H4</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H1</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">subst</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tso</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_eq">tupdate_same_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id">tso_buffers</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">memory</span> := (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm</span>') |}).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="TSOMemLemmas.html#next_block_not_in_validblock">next_block_not_in_validblock</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H6</span> <span class="id">fm</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#mem_strip_gm_vb_eq">mem_strip_gm_vb_eq</a></span> <span class="kwd">in</span> <span class="id">H6</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">unbuffer_safe_alloc_preserve</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t0</span>); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqb0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>; <span class="id">simpls</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H7</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H7</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H4</span>; <span class="tactic">subst</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H4</span> <span class="id">Heqs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H</span> <span class="id">t</span> <span class="id">bi</span> <span class="id">b1</span> <span class="id">m</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hcons</span> : <span class="id">Heqb0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Hcons</span>.  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 : <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 : <span class="tactic">eapply</span> <span class="id">UNBS</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Focus</span> 3.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id">gm</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id">m</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id">t</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H5</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3 : <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3 : <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span> <span class="kwd">in</span> <span class="id">Hcons</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_tid_eq">tupdate_same_tid_eq</a></span> <span class="kwd">in</span> <span class="id">Hcons</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H0</span> <span class="id">Hcons</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span>' <span class="id">t</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H</span> <span class="id">t0</span> <span class="id">bi</span> <span class="id">b</span> <span class="id">m</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hcons</span> : <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Happly_buffer</span> : <span class="id">H5</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#unbuffer_safe_apply_buffer_stable">unbuffer_safe_apply_buffer_stable</a></span> <span class="kwd">in</span> <span class="id">Happly_buffer</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 : <span class="tactic">destruct</span> <span class="id">tso</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Happly_buffer</span> <span class="kwd">as</span> [<span class="id">gm</span>'' <span class="id">Happly_buffer</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hembed</span> : <span class="id">Happly_buffer</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">embed_appply_buffer_update_not_in_freelist_stable</span>' <span class="kwd">in</span> <span class="id">Hembed</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Focus</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H0</span> <span class="id">Hcons</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">n</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hcons</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hembed</span> <span class="kwd">as</span> [<span class="id">fm</span>'' [<span class="id">Hembed</span> <span class="id">Hnext_blk_eq</span>]]. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Hcons</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 : <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 : <span class="tactic">eapply</span> <span class="id">UNBS</span>; <span class="tactic">eauto</span>.   <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Focus</span> 3.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (3 := <span class="id">t</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (2 := <span class="id">m</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id">gm</span>'').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#in_tbf_upd_oth_stillin">in_tbf_upd_oth_stillin</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4 : <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Focus</span> 2. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H0</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span>' <span class="id">t0</span>) <span class="id">eqn</span>:?; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H4</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 : <span class="id">instantiate</span> (1 := <span class="id">fm</span>''); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hnext_blk_eq</span> <span class="kwd">in</span> <span class="id">Hcons</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_not_eq_get">tupdate_not_eq_get</a></span> <span class="kwd">in</span> <span class="id">Hcons</span>; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_tid_neq_twice_rev">tupdate_tid_neq_twice_rev</a></span> <span class="kwd">in</span> <span class="id">Hcons</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
&nbsp;&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="unbuffer_safe_tsoalloc_0_stable">unbuffer_safe_tsoalloc_0_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tm</span> <span class="id">fl</span> <span class="id">fm</span> <span class="id">tsofm</span>' <span class="id">stk</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="MemLemmas.html#tm">tm</a></span>) <span class="id"><a href="MemLemmas.html#fl">fl</a></span> <span class="id"><a href="MemLemmas.html#fm">fm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">t</span>' <span class="id">blk</span> <span class="id">n</span> <span class="id">lo</span> <span class="id">hi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">t</span>' &lt;&gt; <span class="id"><a href="MemLemmas.html#t">t</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id"><a href="MemLemmas.html#blk">blk</a></span> <span class="id"><a href="MemLemmas.html#lo">lo</a></span> <span class="id"><a href="MemLemmas.html#hi">hi</a></span>) (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="MemLemmas.html#tm">tm</a></span> <span class="id">t</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="MemLemmas.html#blk">blk</a></span> &lt;&gt; <span class="id"><a href="MemAux.html#get_block">get_block</a></span> <span class="id"><a href="MemLemmas.html#fl">fl</a></span> <span class="id"><a href="MemLemmas.html#n">n</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tsoalloc">tsoalloc</a></span> {| <span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span> := <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="MemLemmas.html#tm">tm</a></span> <span class="id"><a href="MemLemmas.html#t">t</a></span>; <span class="id">fmemory</span> := <span class="id"><a href="MemLemmas.html#fm">fm</a></span> |} 0 0 (<span class="id">tsofm</span>', <span class="id"><a href="MemLemmas.html#stk">stk</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> <span class="id"><a href="MemLemmas.html#tm">tm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="MemLemmas.html#t">t</a></span> (<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">tsofm</span>') (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="MemLemmas.html#tm">tm</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">memory</span> := <span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id">tsofm</span>') |}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9922')">Proof.</div>
<div class="proofscript" id="proof9922">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H1</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">unbuffer_safe_tsoalloc_0_stable</span>';  <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">unbuffer_safe_tsostore_stable</span>' :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">bfs</span> <span class="id">ofs</span> <span class="id">b</span> <span class="id">n</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="MemLemmas.html#bfs">bfs</a></span>; <span class="id">memory</span> := <span class="id"><a href="MemLemmas.html#m">m</a></span> |} -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">n</span>' : <span class="id"><a href="Integers.html#int">int</a></span>, <span class="id">exists</span> <span class="id">m</span>', <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id"><a href="MemLemmas.html#m">m</a></span> <span class="id"><a href="MemLemmas.html#b">b</a></span> (<span class="id"><a href="Integers.html#Ptrofs.unsigned">Ptrofs.unsigned</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> <span class="id"><a href="MemLemmas.html#ofs">ofs</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id">n</span>') = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> : <span class="id"><a href="GlobDefs.html#tid">tid</a></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="MemLemmas.html#b">b</a></span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> (<span class="id"><a href="MemLemmas.html#bfs">bfs</a></span> <span class="id"><a href="MemLemmas.html#t">t</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">v</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="TSOMem.html#BufferedStore">BufferedStore</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id"><a href="MemLemmas.html#b">b</a></span> (<span class="id"><a href="Integers.html#Ptrofs.unsigned">Ptrofs.unsigned</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> <span class="id"><a href="MemLemmas.html#ofs">ofs</a></span>)) <span class="id">v</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="MemLemmas.html#bfs">bfs</a></span> <span class="id"><a href="MemLemmas.html#t">t</a></span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ">count_occ</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> (<span class="id"><a href="MemLemmas.html#bfs">bfs</a></span> <span class="id"><a href="MemLemmas.html#t">t</a></span>)) <span class="id"><a href="MemLemmas.html#b">b</a></span> = 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="MemLemmas.html#t">t</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="MemLemmas.html#bfs">bfs</a></span> <span class="id"><a href="MemLemmas.html#t">t</a></span> ++ <span class="id"><a href="TSOMem.html#BufferedStore">BufferedStore</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id"><a href="MemLemmas.html#b">b</a></span> (<span class="id"><a href="Integers.html#Ptrofs.unsigned">Ptrofs.unsigned</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> <span class="id"><a href="MemLemmas.html#ofs">ofs</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="MemLemmas.html#n">n</a></span>) :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id"><a href="MemLemmas.html#bfs">bfs</a></span>; <span class="id">memory</span> := <span class="id"><a href="MemLemmas.html#m">m</a></span> |}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9923')">Proof.</div>
<div class="proofscript" id="proof9923">
&nbsp;&nbsp;<span class="id">introv</span> <span class="id">H</span>. <br/>
&nbsp;&nbsp;<span class="id">remember</span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id">bfs</span>; <span class="id">memory</span> := <span class="id">m</span> |} <span class="kwd">as</span> <span class="id">tsofm</span>.<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">bfs</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">m</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">ofs</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">b</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">H</span>; <span class="tactic">intros</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>. <br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="id">simpls</span>; <span class="tactic">intros</span>. <br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t0</span> <span class="id">t</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">bfs</span> <span class="id">t</span>) <span class="id">eqn</span> : ?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H0</span> <span class="id">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ABIS</span> <span class="kwd">in</span> <span class="id">Heqb1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ABIS</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t0</span> <span class="id">t</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">bfs</span> <span class="id">t</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_tid_eq">tupdate_same_tid_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_eq">tupdate_same_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="MemLemmas.html#unbuffer_safe_store_preserve">unbuffer_safe_store_preserve</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear_trivial_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht1</span> : <span class="id">Heqb1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Heqb1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_tid_eq">tupdate_same_tid_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Focus</span> 3.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Focus</span> 2. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id">t</span> <span class="id">b2</span> <span class="id">bfs</span> <span class="id">t</span> = <span class="id">b2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">Heqb1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_same_tid_eq">tupdate_same_tid_eq</a></span> <span class="kwd">in</span> <span class="id">Heqb1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H0</span> <span class="id">n</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">m</span>'' <span class="id">Hstore</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hstore</span> <span class="id">H1</span> <span class="id">Heqb1</span> <span class="id">H3</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">b0</span> &lt;&gt; <span class="id">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">b</span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> (<span class="id">bfs</span> <span class="id">t</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqb1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">v</span>' [<span class="id">Hin</span> <span class="id">Hcount</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqb1</span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqb1</span> <span class="kwd">in</span> <span class="id">Hcount</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hcount</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> <span class="id">b</span> <span class="id">b</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ">count_occ</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> <span class="id">b2</span>) <span class="id">b</span> = 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ_not_In">count_occ_not_In</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="MemLemmas.html#b_not_bf_item_not1">b_not_bf_item_not1</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#store_alloc_still">store_alloc_still</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">b0</span> &lt;&gt; <span class="id">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">b</span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> (<span class="id">bfs</span> <span class="id">t</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqb1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">v</span>' [<span class="id">Hin</span> <span class="id">Hcount</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqb1</span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqb1</span> <span class="kwd">in</span> <span class="id">Hcount</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hcount</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> <span class="id">b</span> <span class="id">b</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ">count_occ</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> <span class="id">b2</span>) <span class="id">b</span> = 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ_not_In">count_occ_not_In</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="MemLemmas.html#b_not_bf_item_not1">b_not_bf_item_not1</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#store_free_other_still">store_free_other_still</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#store_store_other_still">store_store_other_still</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t0</span> <span class="id">t</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Ht2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">b</span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> (<span class="id">bfs</span> <span class="id">t</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqb1</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">Ht2</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ht2</span> <span class="kwd">as</span> [<span class="id">v</span>' [<span class="id">Hin</span>' <span class="id">Hcount</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqb1</span> <span class="kwd">in</span> <span class="id">Hin</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hin</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span>'; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqb1</span> <span class="kwd">in</span> <span class="id">Hcount</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hcount</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> <span class="id">b</span> <span class="id">b</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ">count_occ</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> <span class="id">b2</span>) <span class="id">b</span> = 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ_not_In">count_occ_not_In</a></span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H4</span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ht1</span> <span class="kwd">in</span> <span class="id">Hcount</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hcount</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hcount</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> <span class="id">b0</span> <span class="id">b</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ">count_occ</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> <span class="id">b2</span>) <span class="id">b</span> = 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ_not_In">count_occ_not_In</a></span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H5</span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hcount</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> <span class="id">b0</span> <span class="id">b</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ">count_occ</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> <span class="id">b2</span>) <span class="id">b</span> = 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ_not_In">count_occ_not_In</a></span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H5</span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hcount</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> <span class="id">b0</span> <span class="id">b</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ">count_occ</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> <span class="id">b2</span>) <span class="id">b</span> = 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ_not_In">count_occ_not_In</a></span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H5</span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t0</span> <span class="id">t</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht1</span> : <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Ht1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Focus</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Focus</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id">t0</span> <span class="id">b0</span> <span class="id">bfs</span> <span class="id">t</span> = <span class="id">bfs</span> <span class="id">t</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_not_eq_get">tupdate_not_eq_get</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H4</span> <span class="kwd">in</span> <span class="id">Ht1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_tid_neq_twice_rev">tupdate_tid_neq_twice_rev</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H0</span> <span class="id">n</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">m</span>'' <span class="id">Hstore</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hstore</span> <span class="id">H1</span> <span class="id">Ht1</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">b1</span> &lt;&gt; <span class="id">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">b</span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> (<span class="id">bfs</span> <span class="id">t0</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ht1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">v</span>' [<span class="id">Hin</span> <span class="id">Hcount</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ht1</span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ht1</span> <span class="kwd">in</span> <span class="id">Hcount</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hcount</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> <span class="id">b</span> <span class="id">b</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ">count_occ</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> <span class="id">b0</span>) <span class="id">b</span> = 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ_not_In">count_occ_not_In</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="MemLemmas.html#b_not_bf_item_not1">b_not_bf_item_not1</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#store_alloc_still">store_alloc_still</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">b1</span> &lt;&gt; <span class="id">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">b</span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> (<span class="id">bfs</span> <span class="id">t0</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ht1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">v</span>' [<span class="id">Hin</span> <span class="id">Hcount</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ht1</span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ht1</span> <span class="kwd">in</span> <span class="id">Hcount</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hcount</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> <span class="id">b</span> <span class="id">b</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ">count_occ</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> <span class="id">b0</span>) <span class="id">b</span> = 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ_not_In">count_occ_not_In</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="MemLemmas.html#b_not_bf_item_not1">b_not_bf_item_not1</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#store_free_other_still">store_free_other_still</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#store_store_other_still">store_store_other_still</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t1</span> <span class="id">t0</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t0</span> <span class="id">t0</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Ht2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">b</span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> (<span class="id">bfs</span> <span class="id">t0</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ht1</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">Ht2</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ht2</span> <span class="kwd">as</span> [<span class="id">v</span>' [<span class="id">Hin</span>' <span class="id">Hcount</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ht1</span> <span class="kwd">in</span> <span class="id">Hin</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hin</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span>'; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ht1</span> <span class="kwd">in</span> <span class="id">Hcount</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hcount</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> <span class="id">b</span> <span class="id">b</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ">count_occ</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> <span class="id">b0</span>) <span class="id">b</span> = 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ_not_In">count_occ_not_In</a></span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H5</span> <span class="kwd">in</span> <span class="id">H4</span>. <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ht1</span> <span class="kwd">in</span> <span class="id">Hcount</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hcount</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hcount</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> <span class="id">b1</span> <span class="id">b</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ">count_occ</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> <span class="id">b0</span>) <span class="id">b</span> = 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ_not_In">count_occ_not_In</a></span> <span class="kwd">in</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H6</span> <span class="kwd">in</span> <span class="id">H4</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hcount</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> <span class="id">b1</span> <span class="id">b</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ">count_occ</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> <span class="id">b0</span>) <span class="id">b</span> = 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ_not_In">count_occ_not_In</a></span> <span class="kwd">in</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H6</span> <span class="kwd">in</span> <span class="id">H4</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hcount</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> <span class="id">b1</span> <span class="id">b</span>) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ">count_occ</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> (<span class="id"><a href="TSOMem.html#get_buffer_b">get_buffer_b</a></span> <span class="id">b0</span>) <span class="id">b</span> = 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ_not_In">count_occ_not_In</a></span> <span class="kwd">in</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H6</span> <span class="kwd">in</span> <span class="id">H4</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t1</span> <span class="id">t0</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
&nbsp;&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="unbuffer_safe_tsostore_stable">unbuffer_safe_tsostore_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tm</span> <span class="id">fl</span> <span class="id">fm</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">n</span> <span class="id">tsofm</span>' <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="MemLemmas.html#tm">tm</a></span>) <span class="id"><a href="MemLemmas.html#fl">fl</a></span> <span class="id"><a href="MemLemmas.html#fm">fm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">n</span>', <span class="id">exists</span> <span class="id">m</span>', <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="MemLemmas.html#tm">tm</a></span>) <span class="id"><a href="MemLemmas.html#b">b</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Integers.html#Ptrofs.unsigned">Ptrofs.unsigned</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> <span class="id"><a href="MemLemmas.html#ofs">ofs</a></span>)) (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id">n</span>') = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">t</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="MemLemmas.html#b">b</a></span> (<span class="id"><a href="TSOMem.html#get_tsom_b">get_tsom_b</a></span> <span class="id"><a href="MemLemmas.html#t">t</a></span> <span class="id"><a href="MemLemmas.html#tm">tm</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> <span class="id">v</span>', <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="TSOMem.html#BufferedStore">BufferedStore</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id"><a href="MemLemmas.html#b">b</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Integers.html#Ptrofs.unsigned">Ptrofs.unsigned</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> <span class="id"><a href="MemLemmas.html#ofs">ofs</a></span>))  <span class="id">v</span>') (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="MemLemmas.html#tm">tm</a></span> <span class="id"><a href="MemLemmas.html#t">t</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#count_occ">count_occ</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> (<span class="id"><a href="TSOMem.html#get_tsom_b">get_tsom_b</a></span> <span class="id"><a href="MemLemmas.html#t">t</a></span> <span class="id"><a href="MemLemmas.html#tm">tm</a></span>) <span class="id"><a href="MemLemmas.html#b">b</a></span> = 1)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tsostorev">tsostorev</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> {| <span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span> := <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="MemLemmas.html#tm">tm</a></span> <span class="id"><a href="MemLemmas.html#t">t</a></span>; <span class="id">fmemory</span> := <span class="id"><a href="MemLemmas.html#fm">fm</a></span> |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Values.html#Vptr">Vptr</a></span> <span class="id"><a href="MemLemmas.html#b">b</a></span> (<span class="id"><a href="Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> <span class="id"><a href="MemLemmas.html#ofs">ofs</a></span>)) (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="MemLemmas.html#n">n</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">tsofm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> <span class="id"><a href="MemLemmas.html#tm">tm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="MemLemmas.html#t">t</a></span> (<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">tsofm</span>') (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="MemLemmas.html#tm">tm</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">memory</span> := <span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id">tsofm</span>') |}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9924')">Proof.</div>
<div class="proofscript" id="proof9924">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">tsostorev</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">tsostore</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">unbuffer_safe_tsostore_stable</span>'; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="spec_init_lock_one">spec_init_lock_one</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sge</span> <span class="id">sG</span> <span class="id">sm</span> <span class="id">L</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#init_genv">InteractionSemantics.init_genv</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="code.html#lock_comp_unit">lock_comp_unit</a></span> <span class="id"><a href="MemLemmas.html#sge">sge</a></span> <span class="id"><a href="MemLemmas.html#sG">sG</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#init_gmem">InteractionSemantics.init_gmem</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span> <span class="id"><a href="MemLemmas.html#sge">sge</a></span> <span class="id"><a href="MemLemmas.html#sm">sm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Globalenvs.html#Genv.find_symbol">Genv.find_symbol</a></span> <span class="id"><a href="MemLemmas.html#sge">sge</a></span> <span class="id"><a href="code.html#lock_L_ident">lock_L_ident</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="MemLemmas.html#L">L</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id"><a href="MemLemmas.html#sm">sm</a></span> <span class="id"><a href="MemLemmas.html#L">L</a></span> 0 = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="Integers.html#Int.one">Int.one</a></span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">n</span>, <span class="id">exists</span> <span class="id">M</span>', <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> <span class="id"><a href="MemLemmas.html#sm">sm</a></span> <span class="id"><a href="MemLemmas.html#L">L</a></span> 0 (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id"><a href="MemLemmas.html#n">n</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">M</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9925')">Proof.</div>
<div class="proofscript" id="proof9925">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">renames</span> <span class="id">x</span> <span class="id">to</span> <span class="id">fm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> [<span class="id">Hfm</span> <span class="id">Hinit_fmem</span>].<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hinit_fmem</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">SpecLang.globals_initialized_fmem_speclang</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H3</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H6</span> <span class="id"><a href="code.html#lock_L_ident">lock_L_ident</a></span>).<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H6</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H13</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H13</span>; <span class="tactic">subst</span> <span class="id">b</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H13</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H9</span> <span class="kwd">in</span> <span class="id">H14</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H14</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">globdef_initialized_fm</span> <span class="id">H14</span>.<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id">H14</span>.<br/>
&nbsp;&nbsp;<span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Genv.find_def</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">globdef_initialized_fm</span> <span class="kwd">in</span> <span class="id">Ht</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hload</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">Hload</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">Hload</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#store">store</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">n0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#valid_access">valid_access</a></span>; <span class="tactic">simpl</span>; <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Znumtheory.html#Zmod_divide">Zmod_divide</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="spec_init_obj_mem">spec_init_obj_mem</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sge</span> <span class="id">sG</span> <span class="id">sm</span> <span class="id">ofs</span> <span class="id">L</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#init_genv">InteractionSemantics.init_genv</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="code.html#lock_comp_unit">lock_comp_unit</a></span> <span class="id"><a href="MemLemmas.html#sge">sge</a></span> <span class="id"><a href="MemLemmas.html#sG">sG</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#init_gmem">InteractionSemantics.init_gmem</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span> <span class="id"><a href="MemLemmas.html#sge">sge</a></span> <span class="id"><a href="MemLemmas.html#sm">sm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Globalenvs.html#Genv.find_symbol">Genv.find_symbol</a></span> <span class="id"><a href="MemLemmas.html#sge">sge</a></span> <span class="id"><a href="code.html#lock_L_ident">lock_L_ident</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="MemLemmas.html#L">L</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(0 &lt;= <span class="id"><a href="MemLemmas.html#ofs">ofs</a></span> &lt; 4)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html#obj_mem">obj_mem</a></span> <span class="id"><a href="MemLemmas.html#sm">sm</a></span> <span class="id"><a href="MemLemmas.html#L">L</a></span> <span class="id"><a href="MemLemmas.html#ofs">ofs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9926')">Proof.</div>
<div class="proofscript" id="proof9926">
&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H4</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H7</span> <span class="id"><a href="code.html#lock_L_ident">lock_L_ident</a></span>).<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H7</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H14</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H14</span>; <span class="tactic">subst</span> <span class="id">b</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H14</span>.<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id">H15</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H10</span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H0</span> <span class="id">H1</span> <span class="id">H2</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">renames</span> <span class="id">x</span> <span class="id">to</span> <span class="id">fm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">Hfm</span> <span class="id">Hinit_mem</span>]; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hinit_mem</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">SpecLang.globals_initialized_fmem_speclang</span>.<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hvar</span> : <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Globalenvs.html#Genv.find_def">Genv.find_def</a></span> <span class="kwd">in</span> <span class="id">globdef_initialized_fm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">Hvar</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">globdef_initialized_fm</span> <span class="kwd">in</span> <span class="id">Hvar</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hvar</span>.<br/>
&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">Hvar</span>.<br/>
&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hcur_perm_none</span> : <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H4</span> <span class="kwd">in</span> <span class="id">Hcur_perm_none</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="RGRels.html#obj_mem">obj_mem</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H2</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.range_perm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.perm</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.perm_order</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="TSOMemLemmas.html#Mem_GMem_access_eq">Mem_GMem_access_eq</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="id">tryfalse</span>.<br/>
Qed.</div>
<br/>
<div class="doc"><span class="bracket"><span class="id">Io</span></span> still holds after allocation </div>
<span class="kwd">Lemma</span> <span class="id"><a name="obj_inv_alloc_stable">obj_inv_alloc_stable</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fsm</span> <span class="id">fsm</span>' <span class="id">tm</span> <span class="id">fm</span> <span class="id">bm1</span> <span class="id">fl</span> <span class="id">t</span> <span class="id">tge</span> <span class="id">stk</span>' <span class="id">stk</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">t</span>' <span class="id">blk</span> <span class="id">n</span> <span class="id">lo</span> <span class="id">hi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">t</span>' &lt;&gt; <span class="id"><a href="MemLemmas.html#t">t</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id"><a href="MemLemmas.html#blk">blk</a></span> <span class="id"><a href="MemLemmas.html#lo">lo</a></span> <span class="id"><a href="MemLemmas.html#hi">hi</a></span>) (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="MemLemmas.html#tm">tm</a></span> <span class="id">t</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="MemLemmas.html#blk">blk</a></span> &lt;&gt; <span class="id"><a href="MemAux.html#get_block">get_block</a></span> <span class="id"><a href="MemLemmas.html#fl">fl</a></span> <span class="id"><a href="MemLemmas.html#n">n</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span> <span class="id"><a href="MemLemmas.html#tge">tge</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="MemLemmas.html#fsm">fsm</a></span>) <span class="id"><a href="MemLemmas.html#tm">tm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="MemLemmas.html#tm">tm</a></span>) <span class="id"><a href="MemLemmas.html#fl">fl</a></span> <span class="id"><a href="MemLemmas.html#fm">fm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#embed">embed</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id"><a href="MemLemmas.html#fsm">fsm</a></span>) <span class="id"><a href="MemLemmas.html#fl">fl</a></span> <span class="id"><a href="MemLemmas.html#fsm">fsm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tsoalloc">tsoalloc</a></span> {| <span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span> := <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="MemLemmas.html#tm">tm</a></span> <span class="id"><a href="MemLemmas.html#t">t</a></span>; <span class="id">fmemory</span> := <span class="id"><a href="MemLemmas.html#fm">fm</a></span> |} 0 0 (<span class="id"><a href="MemLemmas.html#bm1">bm1</a></span>, <span class="id"><a href="MemLemmas.html#stk">stk</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.alloc">Mem.alloc</a></span> <span class="id"><a href="MemLemmas.html#fsm">fsm</a></span> 0 0 = (<span class="id">fsm</span>', <span class="id">stk</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span> <span class="id"><a href="MemLemmas.html#tge">tge</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fsm</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="MemLemmas.html#t">t</a></span> (<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="MemLemmas.html#bm1">bm1</a></span>) (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="MemLemmas.html#tm">tm</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">memory</span> := <span class="id"><a href="FMemory.html#strip">strip</a></span> (<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id"><a href="MemLemmas.html#bm1">bm1</a></span>) |}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9927')">Proof.</div>
<div class="proofscript" id="proof9927">
&nbsp;&nbsp;<span class="id">introv</span> <span class="id">Hno_conflict</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H1</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="id">get_gm</span>. <br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">L</span> [<span class="id">H_L</span> [<span class="id">Hlock_st</span> [<span class="id">H_spec_store</span> [<span class="id">Htso_store</span> [<span class="id">Hunbuffer_safe</span> <span class="id">H</span>]]]]]].<br/>
&nbsp;&nbsp;<span class="id">eexists</span>; <span class="tactic">split</span>; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hlock_st</span> <span class="kwd">as</span> [<span class="id">H_lock</span> | <span class="id">H_unlock</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>.   <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H_lock</span> <span class="id">H2</span> <span class="id">H3</span> <span class="id">H4</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">lock_st</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">H_lock</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hload</span> : <span class="id"><a href="TSOMemLemmas.html#load_Mem_alloc_still">load_Mem_alloc_still</a></span> <span class="id">___</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>; <span class="tactic">clear</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">tupdate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">ofs</span> <span class="id">H0</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H1</span> <span class="id">t</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#in_buffer_app_or">in_buffer_app_or</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H7</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H7</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="id">inv</span> <span class="id">H8</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">load_tsomem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H5</span> <span class="kwd">in</span> <span class="id">H11</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#load_in_validblocks">load_in_validblocks</a></span> <span class="kwd">in</span> <span class="id">Ht</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Hin_valid_block</span> : <span class="id"><a href="TSOMemLemmas.html#apply_buffer_in_validblocks_stable">apply_buffer_in_validblocks_stable</a></span> <span class="id">___</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H13</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fm</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">strip</span>, <span class="id">Mem.nextblock</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">valid_wd</span> <span class="id">Hin_valid_block</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="MemAux.html#get_block">get_block</a></span> (<span class="id"><a href="FMemory.html#Mem.freelist">Mem.freelist</a></span> <span class="id">fm</span>) <span class="id">nextblockid</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="MemAux.html#get_block">get_block</a></span> (<span class="id"><a href="FMemory.html#Mem.freelist">Mem.freelist</a></span> <span class="id">fm</span>) <span class="id">nextblockid</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">valid_wd</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Hin_valid_block</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> (<span class="id">H1</span> <span class="id">t0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H6</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">load_tsomem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>; <span class="id">simpls</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">unlock_st</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">H_unlock</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#load_Mem_alloc_still">load_Mem_alloc_still</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H7</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{        <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H7</span> <span class="kwd">as</span> [<span class="id">t0</span> [<span class="id">bf1</span> [<span class="id">bf2</span> <span class="id">H7</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">H7</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">t0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t0</span> <span class="id">t</span>) <span class="id">eqn</span>:?; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_b_get">tupdate_b_get</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H8</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc_reverse">app_assoc_reverse</a></span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_not_eq_get">tupdate_not_eq_get</a></span> <span class="kwd">in</span> <span class="id">H12</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H7</span> <span class="kwd">with</span> (<span class="id">ofs</span> := <span class="id">ofs</span>) <span class="kwd">in</span> <span class="id">H10</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tryfalse</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc_reverse">app_assoc_reverse</a></span> <span class="kwd">in</span> <span class="id">H10</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#in_buffer_app_or">in_buffer_app_or</a></span> <span class="kwd">in</span> <span class="id">H10</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H10</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H9</span> <span class="id">H10</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H9</span> <span class="id">ofs</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H10</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H12</span>; <span class="tactic">destruct</span> <span class="id">H12</span>; <span class="id">tryfalse</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H14</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">load_tsomem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>; <span class="id">simpls</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H15</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id"><a href="TSOMemLemmas.html#load_in_validblocks">load_in_validblocks</a></span> <span class="id">___</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buffer_in_validblocks_stable">apply_buffer_in_validblocks_stable</a></span> <span class="kwd">in</span> <span class="id">Ht</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="TSOMemLemmas.html#mem_strip_gm_vb_eq">mem_strip_gm_vb_eq</a></span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#next_block_not_in_validblock">next_block_not_in_validblock</a></span> <span class="kwd">in</span> <span class="id">Ht</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H11</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>; <span class="id">simpls</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="TSOMemLemmas.html#tupdate_not_eq_get">tupdate_not_eq_get</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">H12</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span>' <span class="id">t</span>); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H7</span> <span class="kwd">with</span> (<span class="id">ofs</span> := <span class="id">ofs</span>) <span class="kwd">in</span> <span class="id">H10</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H10</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#in_buffer_app_or">in_buffer_app_or</a></span> <span class="kwd">in</span> <span class="id">H12</span>; <span class="tactic">destruct</span> <span class="id">H12</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H12</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H14</span>; <span class="tactic">destruct</span> <span class="id">H14</span>; <span class="id">tryfalse</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H16</span>. <span class="id">inv</span> <span class="id">H15</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H11</span> <span class="id">H13</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">load_tsomem</span>; <span class="tactic">destruct</span> <span class="id">tm</span>; <span class="id">simpls</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id"><a href="TSOMemLemmas.html#load_in_validblocks">load_in_validblocks</a></span> <span class="id">___</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buffer_in_validblocks_stable">apply_buffer_in_validblocks_stable</a></span> <span class="kwd">in</span> <span class="id">Ht</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="TSOMemLemmas.html#mem_strip_gm_vb_eq">mem_strip_gm_vb_eq</a></span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#next_block_not_in_validblock">next_block_not_in_validblock</a></span> <span class="kwd">in</span> <span class="id">Ht</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H7</span> <span class="kwd">with</span> (<span class="id">ofs</span> := <span class="id">ofs</span>) <span class="kwd">in</span> <span class="id">H10</span>; <span class="id">tryfalse</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H5</span> <span class="id">H11</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>; <span class="id">simpls</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H7</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H7</span> <span class="id">H5</span> <span class="id">H8</span> <span class="id">H13</span> <span class="id">H15</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">load_tsomem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>; <span class="id">simpls</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 <span class="tactic">intro</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">tupdate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#in_buffer_app_or">in_buffer_app_or</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H8</span> <span class="id">t</span> <span class="id">ofs</span>); <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">destruct</span> <span class="id">H1</span>; <span class="id">tryfalse</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>. <span class="id">inv</span> <span class="id">H15</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>; <span class="id">simpls</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id"><a href="TSOMemLemmas.html#load_in_validblocks">load_in_validblocks</a></span> <span class="id">___</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#apply_buffer_in_validblocks_stable">apply_buffer_in_validblocks_stable</a></span> <span class="kwd">in</span> <span class="id">Ht</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="TSOMemLemmas.html#mem_strip_gm_vb_eq">mem_strip_gm_vb_eq</a></span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#next_block_not_in_validblock">next_block_not_in_validblock</a></span> <span class="kwd">in</span> <span class="id">Ht</span>; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> (<span class="id">H8</span> <span class="id">t0</span> <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#get_tsom_b">get_tsom_b</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>; <span class="id">simpls</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H_spec_store</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H_spec_store</span> <span class="id">n</span>). <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_spec_store</span> <span class="kwd">as</span> [<span class="id">M</span>' <span class="id">H_spec_store</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#GMem_store_alloc_store">GMem_store_alloc_store</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Htso_store</span> <span class="id">H2</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Htso_store</span> <span class="id">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htso_store</span> <span class="kwd">as</span> [<span class="id">bm</span>' <span class="id">Htso_store</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store_tsomem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>; <span class="id">simpls</span>; <span class="tactic">subst</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#store">store</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> (<span class="id"><a href="FMemory.html#strip">strip</a></span> <span class="id">fm</span>) <span class="id">L</span> 0 (<span class="id"><a href="Values.html#Vint">Vint</a></span> <span class="id">n</span>)) <span class="id">eqn</span>:?; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="MemLemmas.html#unbuffer_safe_tsoalloc_0_stable">unbuffer_safe_tsoalloc_0_stable</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#obj_mem_alloc_stable">obj_mem_alloc_stable</a></span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H6</span> <span class="kwd">in</span> <span class="id">H8</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H0</span> <span class="id">H2</span> <span class="id">H8</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>; <span class="id">simpls</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">buffer_insert</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">renames</span> <span class="id">H2</span> <span class="id">to</span> <span class="id">Htso_alloc</span>, <span class="id">H0</span> <span class="id">to</span> <span class="id">Hembed</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H7</span> <span class="id">H3</span> <span class="id">H8</span> <span class="id">H_spec_store</span> <span class="id">Htso_alloc</span> <span class="id">Hembed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H7</span> <span class="kwd">in</span> <span class="id">H8</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H8</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (2 := <span class="id">k</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id">p</span>). <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H_spec_store</span> <span class="id">H1</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H_spec_store</span> <span class="id"><a href="Integers.html#Int.zero">Int.zero</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_spec_store</span> <span class="kwd">as</span> [<span class="id">M</span>' <span class="id">H_spec_store</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.alloc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H3</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">strip</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">GMem.perm</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">store</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dis_if_else</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H_spec_store</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H_spec_store</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="TSOMemLemmas.html#next_block_not_in_validblock">next_block_not_in_validblock</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H</span> <span class="id">fsm</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">L</span> &lt;&gt; <span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id">fsm</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">fsm</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.nextblock</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#valid_access">valid_access</a></span>, <span class="id"><a href="TSOMem.html#range_perm">range_perm</a></span> <span class="kwd">in</span> <span class="id">v</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lets</span> <span class="id">Ht</span> : <span class="id">v</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> ((0 &lt;= 0 &lt; 4)%<span class="id">Z</span>). <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">invalid_noaccess</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">Mem.perm_order</span>'; <span class="id">tryfalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Htso_alloc</span> <span class="id">H1</span> <span class="id">Hembed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hembed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Htso_alloc</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="obj_inv_impl_load_zero_or_one">obj_inv_impl_load_zero_or_one</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sm</span> <span class="id">tm</span> <span class="id">tge</span> <span class="id">b</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Globalenvs.html#Genv.find_symbol">Genv.find_symbol</a></span> <span class="id"><a href="MemLemmas.html#tge">tge</a></span> <span class="id"><a href="code.html#lock_L_ident">lock_L_ident</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="MemLemmas.html#b">b</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InvRG.html#obj_inv">obj_inv</a></span> <span class="id"><a href="MemLemmas.html#tge">tge</a></span> <span class="id"><a href="MemLemmas.html#sm">sm</a></span> <span class="id"><a href="MemLemmas.html#tm">tm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#load">load</a></span> <span class="id"><a href="AST.html#Mint32">Mint32</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="MemLemmas.html#tm">tm</a></span>) <span class="id"><a href="MemLemmas.html#b">b</a></span> 0 = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="MemLemmas.html#v">v</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="MemLemmas.html#v">v</a></span> = <span class="id"><a href="Values.html#Vone">Vone</a></span> \/ <span class="id"><a href="MemLemmas.html#v">v</a></span> = <span class="id"><a href="Values.html#Vzero">Vzero</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9928')">Proof.</div>
<div class="proofscript" id="proof9928">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">obj_inv</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> (<span class="id">L</span> &amp; <span class="id">H0</span>).<br/>
&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="id">inv</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">lock_st</span>.<br/>
&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">load_tsomem</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H10</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">unlock_st</span>.<br/>
&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H8</span>.<br/>
&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">load_tsomem</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H15</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="id">inv</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">split_and</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">unfolds</span> <span class="id">load_tsomem</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>; <span class="id">simpls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H8</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="id">inv</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
</div>
<div class="footer"><hr/>Generated by coq2html</div>
</body>
</html>
