<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module SimplExpr</title>
<meta name="description" content="Documentation of Coq module SimplExpr" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module SimplExpr</h1>
<div class="coq">
<br/>
<div class="doc">Translation from Compcert C to Clight.
    Side effects are pulled out of Compcert C expressions. </div>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Coqlib</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Errors</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Integers</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Floats</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Values</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Memory</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">AST</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Ctypes</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Cop</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Csyntax</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Clight</span>.<br/>
<br/>
<span class="kwd">Local</span> <span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">string_scope</span>.<br/>
<br/>
<div class="doc">State and error monad for generating fresh identifiers. </div>
<br/>
<span class="kwd">Record</span> <span class="id">generator</span> : <span class="kwd">Type</span> := <span class="id">mkgenerator</span> {<br/>
&nbsp;&nbsp;<span class="id">gen_next</span>: <span class="id">ident</span>;<br/>
&nbsp;&nbsp;<span class="id">gen_trail</span>: <span class="id">list</span> (<span class="id">ident</span> * <span class="id">type</span>)<br/>
}.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">result</span> (<span class="id">A</span>: <span class="kwd">Type</span>) (<span class="id">g</span>: <span class="id">generator</span>) : <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id">Err</span>: <span class="id">Errors.errmsg</span> -&gt; <span class="id">result</span> <span class="id">A</span> <span class="id">g</span><br/>
&nbsp;&nbsp;| <span class="id">Res</span>: <span class="id">A</span> -&gt; <span class="kwd">forall</span> (<span class="id">g</span>': <span class="id">generator</span>), <span class="id">Ple</span> (<span class="id">gen_next</span> <span class="id">g</span>) (<span class="id">gen_next</span> <span class="id">g</span>') -&gt; <span class="id">result</span> <span class="id">A</span> <span class="id">g</span>.<br/>
<br/>
<span class="id">Arguments</span> <span class="id">Err</span> [<span class="id">A</span> <span class="id">g</span>].<br/>
<span class="id">Arguments</span> <span class="id">Res</span> [<span class="id">A</span> <span class="id">g</span>].<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">mon</span> (<span class="id">A</span>: <span class="kwd">Type</span>) := <span class="kwd">forall</span> (<span class="id">g</span>: <span class="id">generator</span>), <span class="id">result</span> <span class="id">A</span> <span class="id">g</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">ret</span> {<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">x</span>: <span class="id">A</span>) : <span class="id">mon</span> <span class="id">A</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">g</span> =&gt; <span class="id">Res</span> <span class="id">x</span> <span class="id">g</span> (<span class="id">Ple_refl</span> (<span class="id">gen_next</span> <span class="id">g</span>)).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">error</span> {<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">msg</span>: <span class="id">Errors.errmsg</span>) : <span class="id">mon</span> <span class="id">A</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">g</span> =&gt; <span class="id">Err</span> <span class="id">msg</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">bind</span> {<span class="id">A</span> <span class="id">B</span>: <span class="kwd">Type</span>} (<span class="id">x</span>: <span class="id">mon</span> <span class="id">A</span>) (<span class="id">f</span>: <span class="id">A</span> -&gt; <span class="id">mon</span> <span class="id">B</span>) : <span class="id">mon</span> <span class="id">B</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">g</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span> <span class="id">g</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Err</span> <span class="id">msg</span> =&gt; <span class="id">Err</span> <span class="id">msg</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Res</span> <span class="id">a</span> <span class="id">g</span>' <span class="id">i</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">f</span> <span class="id">a</span> <span class="id">g</span>' <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Err</span> <span class="id">msg</span> =&gt; <span class="id">Err</span> <span class="id">msg</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Res</span> <span class="id">b</span> <span class="id">g</span>'' <span class="id">i</span>' =&gt; <span class="id">Res</span> <span class="id">b</span> <span class="id">g</span>'' (<span class="id">Ple_trans</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">i</span> <span class="id">i</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">bind2</span> {<span class="id">A</span> <span class="id">B</span> <span class="id">C</span>: <span class="kwd">Type</span>} (<span class="id">x</span>: <span class="id">mon</span> (<span class="id">A</span> * <span class="id">B</span>)) (<span class="id">f</span>: <span class="id">A</span> -&gt; <span class="id">B</span> -&gt; <span class="id">mon</span> <span class="id">C</span>) : <span class="id">mon</span> <span class="id">C</span> :=<br/>
&nbsp;&nbsp;<span class="id">bind</span> <span class="id">x</span> (<span class="kwd">fun</span> <span class="id">p</span> =&gt; <span class="id">f</span> (<span class="id">fst</span> <span class="id">p</span>) (<span class="id">snd</span> <span class="id">p</span>)).<br/>
<br/>
<span class="kwd">Notation</span> "'<span class="tactic">do</span>' <span class="id">X</span> &lt;- <span class="id">A</span> ; <span class="id">B</span>" := (<span class="id">bind</span> <span class="id">A</span> (<span class="kwd">fun</span> <span class="id">X</span> =&gt; <span class="id">B</span>))<br/>
&nbsp;&nbsp;&nbsp;(<span class="tactic">at</span> <span class="id">level</span> 200, <span class="id">X</span> <span class="id">ident</span>, <span class="id">A</span> <span class="tactic">at</span> <span class="id">level</span> 100, <span class="id">B</span> <span class="tactic">at</span> <span class="id">level</span> 200)<br/>
&nbsp;&nbsp;&nbsp;: <span class="id">gensym_monad_scope</span>.<br/>
<span class="kwd">Notation</span> "'<span class="tactic">do</span>' ( <span class="id">X</span> , <span class="id">Y</span> ) &lt;- <span class="id">A</span> ; <span class="id">B</span>" := (<span class="id">bind2</span> <span class="id">A</span> (<span class="kwd">fun</span> <span class="id">X</span> <span class="id">Y</span> =&gt; <span class="id">B</span>))<br/>
&nbsp;&nbsp;&nbsp;(<span class="tactic">at</span> <span class="id">level</span> 200, <span class="id">X</span> <span class="id">ident</span>, <span class="id">Y</span> <span class="id">ident</span>, <span class="id">A</span> <span class="tactic">at</span> <span class="id">level</span> 100, <span class="id">B</span> <span class="tactic">at</span> <span class="id">level</span> 200)<br/>
&nbsp;&nbsp;&nbsp;: <span class="id">gensym_monad_scope</span>.<br/>
<br/>
<span class="kwd">Local</span> <span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">gensym_monad_scope</span>.<br/>
<br/>
<span class="kwd">Parameter</span> <span class="id">first_unused_ident</span>: <span class="id">unit</span> -&gt; <span class="id">ident</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">initial_generator</span> (<span class="id">x</span>: <span class="id">unit</span>) : <span class="id">generator</span> :=<br/>
&nbsp;&nbsp;<span class="id">mkgenerator</span> (<span class="id">first_unused_ident</span> <span class="id">x</span>) <span class="id">nil</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">gensym</span> (<span class="id">ty</span>: <span class="id">type</span>): <span class="id">mon</span> <span class="id">ident</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> (<span class="id">g</span>: <span class="id">generator</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Res</span> (<span class="id">gen_next</span> <span class="id">g</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">mkgenerator</span> (<span class="id">Psucc</span> (<span class="id">gen_next</span> <span class="id">g</span>)) ((<span class="id">gen_next</span> <span class="id">g</span>, <span class="id">ty</span>) :: <span class="id">gen_trail</span> <span class="id">g</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ple_succ</span> (<span class="id">gen_next</span> <span class="id">g</span>)).<br/>
<br/>
<div class="doc">Construct a sequence from a list of statements.  To facilitate the
   proof, the sequence is nested to the left and starts with a <span class="bracket"><span class="id">Sskip</span></span>. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id">makeseq_rec</span> (<span class="id">s</span>: <span class="id">statement</span>) (<span class="id">l</span>: <span class="id">list</span> <span class="id">statement</span>) : <span class="id">statement</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">l</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">nil</span> =&gt; <span class="id">s</span><br/>
&nbsp;&nbsp;| <span class="id">s</span>' :: <span class="id">l</span>' =&gt; <span class="id">makeseq_rec</span> (<span class="id">Ssequence</span> <span class="id">s</span> <span class="id">s</span>') <span class="id">l</span>'<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">makeseq</span> (<span class="id">l</span>: <span class="id">list</span> <span class="id">statement</span>) : <span class="id">statement</span> :=<br/>
&nbsp;&nbsp;<span class="id">makeseq_rec</span> <span class="id">Sskip</span> <span class="id">l</span>.<br/>
<br/>
<div class="doc">Smart constructor for <span class="bracket"><span class="kwd">if</span> ... <span class="kwd">then</span> ... <span class="kwd">else</span></span>. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id">eval_simpl_expr</span> (<span class="id">a</span>: <span class="id">expr</span>) : <span class="id">option</span> <span class="id">val</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">a</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Econst_int</span> <span class="id">n</span> <span class="id">_</span> =&gt; <span class="id">Some</span>(<span class="id">Vint</span> <span class="id">n</span>)<br/>
&nbsp;&nbsp;| <span class="id">Econst_float</span> <span class="id">n</span> <span class="id">_</span> =&gt; <span class="id">Some</span>(<span class="id">Vfloat</span> <span class="id">n</span>)<br/>
&nbsp;&nbsp;| <span class="id">Econst_single</span> <span class="id">n</span> <span class="id">_</span> =&gt; <span class="id">Some</span>(<span class="id">Vsingle</span> <span class="id">n</span>)<br/>
&nbsp;&nbsp;| <span class="id">Econst_long</span> <span class="id">n</span> <span class="id">_</span> =&gt; <span class="id">Some</span>(<span class="id">Vlong</span> <span class="id">n</span>)<br/>
&nbsp;&nbsp;| <span class="id">Ecast</span> <span class="id">b</span> <span class="id">ty</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">eval_simpl_expr</span> <span class="id">b</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">v</span> =&gt; <span class="id">sem_cast</span> <span class="id">v</span> (<span class="id">typeof</span> <span class="id">b</span>) <span class="id">ty</span> <span class="id">Mem.empty</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="id">Function</span> <span class="id">makeif</span> (<span class="id">a</span>: <span class="id">expr</span>) (<span class="id">s1</span> <span class="id">s2</span>: <span class="id">statement</span>) : <span class="id">statement</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">eval_simpl_expr</span> <span class="id">a</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">v</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">bool_val</span> <span class="id">v</span> (<span class="id">typeof</span> <span class="id">a</span>) <span class="id">Mem.empty</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">b</span> =&gt; <span class="kwd">if</span> <span class="id">b</span> <span class="kwd">then</span> <span class="id">s1</span> <span class="kwd">else</span> <span class="id">s2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span>   =&gt; <span class="id">Sifthenelse</span> <span class="id">a</span> <span class="id">s1</span> <span class="id">s2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">Sifthenelse</span> <span class="id">a</span> <span class="id">s1</span> <span class="id">s2</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">Translation of pre/post-increment/decrement. </div>
<br/>
<span class="kwd">Definition</span> <span class="id">transl_incrdecr</span> (<span class="id">id</span>: <span class="id">incr_or_decr</span>) (<span class="id">a</span>: <span class="id">expr</span>) (<span class="id">ty</span>: <span class="id">type</span>) : <span class="id">expr</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">id</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Incr</span> =&gt; <span class="id">Ebinop</span> <span class="id">Oadd</span> <span class="id">a</span> (<span class="id">Econst_int</span> <span class="id">Int.one</span> <span class="id">type_int32s</span>) (<span class="id">incrdecr_type</span> <span class="id">ty</span>)<br/>
&nbsp;&nbsp;| <span class="id">Decr</span> =&gt; <span class="id">Ebinop</span> <span class="id">Osub</span> <span class="id">a</span> (<span class="id">Econst_int</span> <span class="id">Int.one</span> <span class="id">type_int32s</span>) (<span class="id">incrdecr_type</span> <span class="id">ty</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">Generate a <span class="bracket"><span class="id">Sset</span></span> or <span class="bracket"><span class="id">Sbuiltin</span></span> operation as appropriate
  to dereference a l-value <span class="bracket"><span class="id">l</span></span> and store its result in temporary variable <span class="bracket"><span class="id">id</span></span>. </div>
<br/>
<span class="kwd">Definition</span> <span class="id">chunk_for_volatile_type</span> (<span class="id">ty</span>: <span class="id">type</span>) : <span class="id">option</span> <span class="id">memory_chunk</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">type_is_volatile</span> <span class="id">ty</span><br/>
&nbsp;&nbsp;<span class="kwd">then</span> <span class="kwd">match</span> <span class="id">access_mode</span> <span class="id">ty</span> <span class="kwd">with</span> <span class="id">By_value</span> <span class="id">chunk</span> =&gt; <span class="id">Some</span> <span class="id">chunk</span> | <span class="id">_</span> =&gt; <span class="id">None</span> <span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">None</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">make_set</span> (<span class="id">id</span>: <span class="id">ident</span>) (<span class="id">l</span>: <span class="id">expr</span>) : <span class="id">statement</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">chunk_for_volatile_type</span> (<span class="id">typeof</span> <span class="id">l</span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">Sset</span> <span class="id">id</span> <span class="id">l</span><br/>
&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">chunk</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">typtr</span> := <span class="id">Tpointer</span> (<span class="id">typeof</span> <span class="id">l</span>) <span class="id">noattr</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Sbuiltin</span> (<span class="id">Some</span> <span class="id">id</span>) (<span class="id">EF_vload</span> <span class="id">chunk</span>) (<span class="id">Tcons</span> <span class="id">typtr</span> <span class="id">Tnil</span>) ((<span class="id">Eaddrof</span> <span class="id">l</span> <span class="id">typtr</span>):: <span class="id">nil</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">Translation of a "valof" operation.
  If the l-value accessed is of volatile type, we go through a temporary. </div>
<br/>
<span class="kwd">Definition</span> <span class="id">transl_valof</span> (<span class="id">ty</span>: <span class="id">type</span>) (<span class="id">l</span>: <span class="id">expr</span>) : <span class="id">mon</span> (<span class="id">list</span> <span class="id">statement</span> * <span class="id">expr</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">type_is_volatile</span> <span class="id">ty</span><br/>
&nbsp;&nbsp;<span class="kwd">then</span> <span class="tactic">do</span> <span class="id">t</span> &lt;- <span class="id">gensym</span> <span class="id">ty</span>; <span class="id">ret</span> (<span class="id">make_set</span> <span class="id">t</span> <span class="id">l</span> :: <span class="id">nil</span>, <span class="id">Etempvar</span> <span class="id">t</span> <span class="id">ty</span>)<br/>
&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">ret</span> (<span class="id">nil</span>, <span class="id">l</span>).<br/>
<br/>
<div class="doc">Translation of an assignment. </div>
<br/>
<span class="kwd">Definition</span> <span class="id">make_assign</span> (<span class="id">l</span> <span class="id">r</span>: <span class="id">expr</span>) : <span class="id">statement</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">chunk_for_volatile_type</span> (<span class="id">typeof</span> <span class="id">l</span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">None</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Sassign</span> <span class="id">l</span> <span class="id">r</span><br/>
&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">chunk</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ty</span> := <span class="id">typeof</span> <span class="id">l</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">typtr</span> := <span class="id">Tpointer</span> <span class="id">ty</span> <span class="id">noattr</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Sbuiltin</span> <span class="id">None</span> (<span class="id">EF_vstore</span> <span class="id">chunk</span>) (<span class="id">Tcons</span> <span class="id">typtr</span> (<span class="id">Tcons</span> <span class="id">ty</span> <span class="id">Tnil</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Eaddrof</span> <span class="id">l</span> <span class="id">typtr</span> :: <span class="id">r</span> :: <span class="id">nil</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">Translation of expressions.  Return a pair <span class="bracket">(<span class="id">sl</span>, <span class="id">a</span>)</span> of
    a list of statements <span class="bracket"><span class="id">sl</span></span> and a pure expression <span class="bracket"><span class="id">a</span></span>.
<ul>
<li>
 If the <span class="bracket"><span class="id">dst</span></span> argument is <span class="bracket"><span class="id">For_val</span></span>, the statements <span class="bracket"><span class="id">sl</span></span>
  perform the side effects of the original expression,
  and <span class="bracket"><span class="id">a</span></span> evaluates to the same value as the original expression.
</li>
<li>
 If the <span class="bracket"><span class="id">dst</span></span> argument is <span class="bracket"><span class="id">For_effects</span></span>, the statements <span class="bracket"><span class="id">sl</span></span>
  perform the side effects of the original expression,
  and <span class="bracket"><span class="id">a</span></span> is meaningless.
</li>
<li>
 If the <span class="bracket"><span class="id">dst</span></span> argument is <span class="bracket"><span class="id">For_set</span> <span class="id">tyl</span> <span class="id">tvar</span></span>, the statements <span class="bracket"><span class="id">sl</span></span>
  perform the side effects of the original expression, then
  assign the value of the original expression to the temporary <span class="bracket"><span class="id">tvar</span></span>.
  The value is casted according to the list of types <span class="bracket"><span class="id">tyl</span></span> before
  assignment.  In this case, <span class="bracket"><span class="id">a</span></span> is meaningless.
</li>
</ul>
</div>
<br/>
<span class="kwd">Inductive</span> <span class="id">set_destination</span> : <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id">SDbase</span> (<span class="id">tycast</span> <span class="id">ty</span>: <span class="id">type</span>) (<span class="id">tmp</span>: <span class="id">ident</span>)<br/>
&nbsp;&nbsp;| <span class="id">SDcons</span> (<span class="id">tycast</span> <span class="id">ty</span>: <span class="id">type</span>) (<span class="id">tmp</span>: <span class="id">ident</span>) (<span class="id">sd</span>: <span class="id">set_destination</span>).<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">destination</span> : <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id">For_val</span><br/>
&nbsp;&nbsp;| <span class="id">For_effects</span><br/>
&nbsp;&nbsp;| <span class="id">For_set</span> (<span class="id">sd</span>: <span class="id">set_destination</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">dummy_expr</span> := <span class="id">Econst_int</span> <span class="id">Int.zero</span> <span class="id">type_int32s</span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id">do_set</span> (<span class="id">sd</span>: <span class="id">set_destination</span>) (<span class="id">a</span>: <span class="id">expr</span>) : <span class="id">list</span> <span class="id">statement</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">sd</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">SDbase</span> <span class="id">tycast</span> <span class="id">ty</span> <span class="id">tmp</span> =&gt; <span class="id">Sset</span> <span class="id">tmp</span> (<span class="id">Ecast</span> <span class="id">a</span> <span class="id">tycast</span>) :: <span class="id">nil</span><br/>
&nbsp;&nbsp;| <span class="id">SDcons</span> <span class="id">tycast</span> <span class="id">ty</span> <span class="id">tmp</span> <span class="id">sd</span>' =&gt; <span class="id">Sset</span> <span class="id">tmp</span> (<span class="id">Ecast</span> <span class="id">a</span> <span class="id">tycast</span>) :: <span class="id">do_set</span> <span class="id">sd</span>' (<span class="id">Etempvar</span> <span class="id">tmp</span> <span class="id">ty</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">finish</span> (<span class="id">dst</span>: <span class="id">destination</span>) (<span class="id">sl</span>: <span class="id">list</span> <span class="id">statement</span>) (<span class="id">a</span>: <span class="id">expr</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">dst</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">For_val</span> =&gt; (<span class="id">sl</span>, <span class="id">a</span>)<br/>
&nbsp;&nbsp;| <span class="id">For_effects</span> =&gt; (<span class="id">sl</span>, <span class="id">a</span>)<br/>
&nbsp;&nbsp;| <span class="id">For_set</span> <span class="id">sd</span> =&gt; (<span class="id">sl</span> ++ <span class="id">do_set</span> <span class="id">sd</span> <span class="id">a</span>, <span class="id">a</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">sd_temp</span> (<span class="id">sd</span>: <span class="id">set_destination</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">sd</span> <span class="kwd">with</span> <span class="id">SDbase</span> <span class="id">_</span> <span class="id">_</span> <span class="id">tmp</span> =&gt; <span class="id">tmp</span> | <span class="id">SDcons</span> <span class="id">_</span> <span class="id">_</span> <span class="id">tmp</span> <span class="id">_</span> =&gt; <span class="id">tmp</span> <span class="kwd">end</span>.<br/>
<span class="kwd">Definition</span> <span class="id">sd_seqbool_val</span> (<span class="id">tmp</span>: <span class="id">ident</span>) (<span class="id">ty</span>: <span class="id">type</span>) :=<br/>
&nbsp;&nbsp;<span class="id">SDbase</span> <span class="id">type_bool</span> <span class="id">ty</span> <span class="id">tmp</span>.<br/>
<span class="kwd">Definition</span> <span class="id">sd_seqbool_set</span> (<span class="id">ty</span>: <span class="id">type</span>) (<span class="id">sd</span>: <span class="id">set_destination</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">tmp</span> :=  <span class="id">sd_temp</span> <span class="id">sd</span> <span class="kwd">in</span> <span class="id">SDcons</span> <span class="id">type_bool</span> <span class="id">ty</span> <span class="id">tmp</span> <span class="id">sd</span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id">transl_expr</span> (<span class="id">dst</span>: <span class="id">destination</span>) (<span class="id">a</span>: <span class="id">Csyntax.expr</span>) : <span class="id">mon</span> (<span class="id">list</span> <span class="id">statement</span> * <span class="id">expr</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">a</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Eloc</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">ty</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">error</span> (<span class="id">msg</span> "<span class="id">SimplExpr.transl_expr</span>: <span class="id">Eloc</span>")<br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Evar</span> <span class="id">x</span> <span class="id">ty</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">finish</span> <span class="id">dst</span> <span class="id">nil</span> (<span class="id">Evar</span> <span class="id">x</span> <span class="id">ty</span>))<br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Ederef</span> <span class="id">r</span> <span class="id">ty</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">sl</span>, <span class="id">a</span>) &lt;- <span class="id">transl_expr</span> <span class="id">For_val</span> <span class="id">r</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">finish</span> <span class="id">dst</span> <span class="id">sl</span> (<span class="id">Ederef</span> <span class="id">a</span> <span class="id">ty</span>))<br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Efield</span> <span class="id">r</span> <span class="id">f</span> <span class="id">ty</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">sl</span>, <span class="id">a</span>) &lt;- <span class="id">transl_expr</span> <span class="id">For_val</span> <span class="id">r</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">finish</span> <span class="id">dst</span> <span class="id">sl</span> (<span class="id">Efield</span> <span class="id">a</span> <span class="id">f</span> <span class="id">ty</span>))<br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Eval</span> (<span class="id">Vint</span> <span class="id">n</span>) <span class="id">ty</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">finish</span> <span class="id">dst</span> <span class="id">nil</span> (<span class="id">Econst_int</span> <span class="id">n</span> <span class="id">ty</span>))<br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Eval</span> (<span class="id">Vfloat</span> <span class="id">n</span>) <span class="id">ty</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">finish</span> <span class="id">dst</span> <span class="id">nil</span> (<span class="id">Econst_float</span> <span class="id">n</span> <span class="id">ty</span>))<br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Eval</span> (<span class="id">Vsingle</span> <span class="id">n</span>) <span class="id">ty</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">finish</span> <span class="id">dst</span> <span class="id">nil</span> (<span class="id">Econst_single</span> <span class="id">n</span> <span class="id">ty</span>))<br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Eval</span> (<span class="id">Vlong</span> <span class="id">n</span>) <span class="id">ty</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">finish</span> <span class="id">dst</span> <span class="id">nil</span> (<span class="id">Econst_long</span> <span class="id">n</span> <span class="id">ty</span>))<br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Eval</span> <span class="id">_</span> <span class="id">ty</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">error</span> (<span class="id">msg</span> "<span class="id">SimplExpr.transl_expr</span>: <span class="kwd">Eval</span>")<br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Esizeof</span> <span class="id">ty</span>' <span class="id">ty</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">finish</span> <span class="id">dst</span> <span class="id">nil</span> (<span class="id">Esizeof</span> <span class="id">ty</span>' <span class="id">ty</span>))<br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Ealignof</span> <span class="id">ty</span>' <span class="id">ty</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">finish</span> <span class="id">dst</span> <span class="id">nil</span> (<span class="id">Ealignof</span> <span class="id">ty</span>' <span class="id">ty</span>))<br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Evalof</span> <span class="id">l</span> <span class="id">ty</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">sl1</span>, <span class="id">a1</span>) &lt;- <span class="id">transl_expr</span> <span class="id">For_val</span> <span class="id">l</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">sl2</span>, <span class="id">a2</span>) &lt;- <span class="id">transl_valof</span> (<span class="id">Csyntax.typeof</span> <span class="id">l</span>) <span class="id">a1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">finish</span> <span class="id">dst</span> (<span class="id">sl1</span> ++ <span class="id">sl2</span>) <span class="id">a2</span>)<br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Eaddrof</span> <span class="id">l</span> <span class="id">ty</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">sl</span>, <span class="id">a</span>) &lt;- <span class="id">transl_expr</span> <span class="id">For_val</span> <span class="id">l</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">finish</span> <span class="id">dst</span> <span class="id">sl</span> (<span class="id">Eaddrof</span> <span class="id">a</span> <span class="id">ty</span>))<br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Eunop</span> <span class="id">op</span> <span class="id">r1</span> <span class="id">ty</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">sl1</span>, <span class="id">a1</span>) &lt;- <span class="id">transl_expr</span> <span class="id">For_val</span> <span class="id">r1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">finish</span> <span class="id">dst</span> <span class="id">sl1</span> (<span class="id">Eunop</span> <span class="id">op</span> <span class="id">a1</span> <span class="id">ty</span>))<br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Ebinop</span> <span class="id">op</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">ty</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">sl1</span>, <span class="id">a1</span>) &lt;- <span class="id">transl_expr</span> <span class="id">For_val</span> <span class="id">r1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">sl2</span>, <span class="id">a2</span>) &lt;- <span class="id">transl_expr</span> <span class="id">For_val</span> <span class="id">r2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">finish</span> <span class="id">dst</span> (<span class="id">sl1</span> ++ <span class="id">sl2</span>) (<span class="id">Ebinop</span> <span class="id">op</span> <span class="id">a1</span> <span class="id">a2</span> <span class="id">ty</span>))<br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Ecast</span> <span class="id">r1</span> <span class="id">ty</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">sl1</span>, <span class="id">a1</span>) &lt;- <span class="id">transl_expr</span> <span class="id">For_val</span> <span class="id">r1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">finish</span> <span class="id">dst</span> <span class="id">sl1</span> (<span class="id">Ecast</span> <span class="id">a1</span> <span class="id">ty</span>))<br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Eseqand</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">ty</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">sl1</span>, <span class="id">a1</span>) &lt;- <span class="id">transl_expr</span> <span class="id">For_val</span> <span class="id">r1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">dst</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">For_val</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">t</span> &lt;- <span class="id">gensym</span> <span class="id">ty</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">sl2</span>, <span class="id">a2</span>) &lt;- <span class="id">transl_expr</span> (<span class="id">For_set</span> (<span class="id">sd_seqbool_val</span> <span class="id">t</span> <span class="id">ty</span>)) <span class="id">r2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">sl1</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">makeif</span> <span class="id">a1</span> (<span class="id">makeseq</span> <span class="id">sl2</span>) (<span class="id">Sset</span> <span class="id">t</span> (<span class="id">Econst_int</span> <span class="id">Int.zero</span> <span class="id">ty</span>)) :: <span class="id">nil</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Etempvar</span> <span class="id">t</span> <span class="id">ty</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">For_effects</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">sl2</span>, <span class="id">a2</span>) &lt;- <span class="id">transl_expr</span> <span class="id">For_effects</span> <span class="id">r2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">sl1</span> ++ <span class="id">makeif</span> <span class="id">a1</span> (<span class="id">makeseq</span> <span class="id">sl2</span>) <span class="id">Sskip</span> :: <span class="id">nil</span>, <span class="id">dummy_expr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">For_set</span> <span class="id">sd</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">sl2</span>, <span class="id">a2</span>) &lt;- <span class="id">transl_expr</span> (<span class="id">For_set</span> (<span class="id">sd_seqbool_set</span> <span class="id">ty</span> <span class="id">sd</span>)) <span class="id">r2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">sl1</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">makeif</span> <span class="id">a1</span> (<span class="id">makeseq</span> <span class="id">sl2</span>) (<span class="id">makeseq</span> (<span class="id">do_set</span> <span class="id">sd</span> (<span class="id">Econst_int</span> <span class="id">Int.zero</span> <span class="id">ty</span>))) :: <span class="id">nil</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dummy_expr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Eseqor</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">ty</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">sl1</span>, <span class="id">a1</span>) &lt;- <span class="id">transl_expr</span> <span class="id">For_val</span> <span class="id">r1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">dst</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">For_val</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">t</span> &lt;- <span class="id">gensym</span> <span class="id">ty</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">sl2</span>, <span class="id">a2</span>) &lt;- <span class="id">transl_expr</span> (<span class="id">For_set</span> (<span class="id">sd_seqbool_val</span> <span class="id">t</span> <span class="id">ty</span>)) <span class="id">r2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">sl1</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">makeif</span> <span class="id">a1</span> (<span class="id">Sset</span> <span class="id">t</span> (<span class="id">Econst_int</span> <span class="id">Int.one</span> <span class="id">ty</span>)) (<span class="id">makeseq</span> <span class="id">sl2</span>) :: <span class="id">nil</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Etempvar</span> <span class="id">t</span> <span class="id">ty</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">For_effects</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">sl2</span>, <span class="id">a2</span>) &lt;- <span class="id">transl_expr</span> <span class="id">For_effects</span> <span class="id">r2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">sl1</span> ++ <span class="id">makeif</span> <span class="id">a1</span> <span class="id">Sskip</span> (<span class="id">makeseq</span> <span class="id">sl2</span>) :: <span class="id">nil</span>, <span class="id">dummy_expr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">For_set</span> <span class="id">sd</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">sl2</span>, <span class="id">a2</span>) &lt;- <span class="id">transl_expr</span> (<span class="id">For_set</span> (<span class="id">sd_seqbool_set</span> <span class="id">ty</span> <span class="id">sd</span>)) <span class="id">r2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">sl1</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">makeif</span> <span class="id">a1</span> (<span class="id">makeseq</span> (<span class="id">do_set</span> <span class="id">sd</span> (<span class="id">Econst_int</span> <span class="id">Int.one</span> <span class="id">ty</span>))) (<span class="id">makeseq</span> <span class="id">sl2</span>) :: <span class="id">nil</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dummy_expr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Econdition</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">r3</span> <span class="id">ty</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">sl1</span>, <span class="id">a1</span>) &lt;- <span class="id">transl_expr</span> <span class="id">For_val</span> <span class="id">r1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">dst</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">For_val</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">t</span> &lt;- <span class="id">gensym</span> <span class="id">ty</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">sl2</span>, <span class="id">a2</span>) &lt;- <span class="id">transl_expr</span> (<span class="id">For_set</span> (<span class="id">SDbase</span> <span class="id">ty</span> <span class="id">ty</span> <span class="id">t</span>)) <span class="id">r2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">sl3</span>, <span class="id">a3</span>) &lt;- <span class="id">transl_expr</span> (<span class="id">For_set</span> (<span class="id">SDbase</span> <span class="id">ty</span> <span class="id">ty</span> <span class="id">t</span>)) <span class="id">r3</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">sl1</span> ++ <span class="id">makeif</span> <span class="id">a1</span> (<span class="id">makeseq</span> <span class="id">sl2</span>) (<span class="id">makeseq</span> <span class="id">sl3</span>) :: <span class="id">nil</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Etempvar</span> <span class="id">t</span> <span class="id">ty</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">For_effects</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">sl2</span>, <span class="id">a2</span>) &lt;- <span class="id">transl_expr</span> <span class="id">For_effects</span> <span class="id">r2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">sl3</span>, <span class="id">a3</span>) &lt;- <span class="id">transl_expr</span> <span class="id">For_effects</span> <span class="id">r3</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">sl1</span> ++ <span class="id">makeif</span> <span class="id">a1</span> (<span class="id">makeseq</span> <span class="id">sl2</span>) (<span class="id">makeseq</span> <span class="id">sl3</span>) :: <span class="id">nil</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dummy_expr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">For_set</span> <span class="id">sd</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">t</span> &lt;- <span class="id">gensym</span> <span class="id">ty</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">sl2</span>, <span class="id">a2</span>) &lt;- <span class="id">transl_expr</span> (<span class="id">For_set</span> (<span class="id">SDcons</span> <span class="id">ty</span> <span class="id">ty</span> <span class="id">t</span> <span class="id">sd</span>)) <span class="id">r2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">sl3</span>, <span class="id">a3</span>) &lt;- <span class="id">transl_expr</span> (<span class="id">For_set</span> (<span class="id">SDcons</span> <span class="id">ty</span> <span class="id">ty</span> <span class="id">t</span> <span class="id">sd</span>)) <span class="id">r3</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">sl1</span> ++ <span class="id">makeif</span> <span class="id">a1</span> (<span class="id">makeseq</span> <span class="id">sl2</span>) (<span class="id">makeseq</span> <span class="id">sl3</span>) :: <span class="id">nil</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dummy_expr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Eassign</span> <span class="id">l1</span> <span class="id">r2</span> <span class="id">ty</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">sl1</span>, <span class="id">a1</span>) &lt;- <span class="id">transl_expr</span> <span class="id">For_val</span> <span class="id">l1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">sl2</span>, <span class="id">a2</span>) &lt;- <span class="id">transl_expr</span> <span class="id">For_val</span> <span class="id">r2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ty1</span> := <span class="id">Csyntax.typeof</span> <span class="id">l1</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ty2</span> := <span class="id">Csyntax.typeof</span> <span class="id">r2</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">dst</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">For_val</span> | <span class="id">For_set</span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">t</span> &lt;- <span class="id">gensym</span> <span class="id">ty1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">finish</span> <span class="id">dst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">sl1</span> ++ <span class="id">sl2</span> ++ <span class="id">Sset</span> <span class="id">t</span> (<span class="id">Ecast</span> <span class="id">a2</span> <span class="id">ty1</span>) :: <span class="id">make_assign</span> <span class="id">a1</span> (<span class="id">Etempvar</span> <span class="id">t</span> <span class="id">ty1</span>) :: <span class="id">nil</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Etempvar</span> <span class="id">t</span> <span class="id">ty1</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">For_effects</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">sl1</span> ++ <span class="id">sl2</span> ++ <span class="id">make_assign</span> <span class="id">a1</span> <span class="id">a2</span> :: <span class="id">nil</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dummy_expr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Eassignop</span> <span class="id">op</span> <span class="id">l1</span> <span class="id">r2</span> <span class="id">tyres</span> <span class="id">ty</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ty1</span> := <span class="id">Csyntax.typeof</span> <span class="id">l1</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">sl1</span>, <span class="id">a1</span>) &lt;- <span class="id">transl_expr</span> <span class="id">For_val</span> <span class="id">l1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">sl2</span>, <span class="id">a2</span>) &lt;- <span class="id">transl_expr</span> <span class="id">For_val</span> <span class="id">r2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">sl3</span>, <span class="id">a3</span>) &lt;- <span class="id">transl_valof</span> <span class="id">ty1</span> <span class="id">a1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">dst</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">For_val</span> | <span class="id">For_set</span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">t</span> &lt;- <span class="id">gensym</span> <span class="id">ty1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">finish</span> <span class="id">dst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">sl1</span> ++ <span class="id">sl2</span> ++ <span class="id">sl3</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Sset</span> <span class="id">t</span> (<span class="id">Ecast</span> (<span class="id">Ebinop</span> <span class="id">op</span> <span class="id">a3</span> <span class="id">a2</span> <span class="id">tyres</span>) <span class="id">ty1</span>) ::<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">make_assign</span> <span class="id">a1</span> (<span class="id">Etempvar</span> <span class="id">t</span> <span class="id">ty1</span>) :: <span class="id">nil</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Etempvar</span> <span class="id">t</span> <span class="id">ty1</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">For_effects</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">sl1</span> ++ <span class="id">sl2</span> ++ <span class="id">sl3</span> ++ <span class="id">make_assign</span> <span class="id">a1</span> (<span class="id">Ebinop</span> <span class="id">op</span> <span class="id">a3</span> <span class="id">a2</span> <span class="id">tyres</span>) :: <span class="id">nil</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dummy_expr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Epostincr</span> <span class="id">id</span> <span class="id">l1</span> <span class="id">ty</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ty1</span> := <span class="id">Csyntax.typeof</span> <span class="id">l1</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">sl1</span>, <span class="id">a1</span>) &lt;- <span class="id">transl_expr</span> <span class="id">For_val</span> <span class="id">l1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">dst</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">For_val</span> | <span class="id">For_set</span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">t</span> &lt;- <span class="id">gensym</span> <span class="id">ty1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">finish</span> <span class="id">dst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">sl1</span> ++ <span class="id">make_set</span> <span class="id">t</span> <span class="id">a1</span> ::<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">make_assign</span> <span class="id">a1</span> (<span class="id">transl_incrdecr</span> <span class="id">id</span> (<span class="id">Etempvar</span> <span class="id">t</span> <span class="id">ty1</span>) <span class="id">ty1</span>) :: <span class="id">nil</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Etempvar</span> <span class="id">t</span> <span class="id">ty1</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">For_effects</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">sl2</span>, <span class="id">a2</span>) &lt;- <span class="id">transl_valof</span> <span class="id">ty1</span> <span class="id">a1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">sl1</span> ++ <span class="id">sl2</span> ++ <span class="id">make_assign</span> <span class="id">a1</span> (<span class="id">transl_incrdecr</span> <span class="id">id</span> <span class="id">a2</span> <span class="id">ty1</span>) :: <span class="id">nil</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dummy_expr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Ecomma</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">ty</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">sl1</span>, <span class="id">a1</span>) &lt;- <span class="id">transl_expr</span> <span class="id">For_effects</span> <span class="id">r1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">sl2</span>, <span class="id">a2</span>) &lt;- <span class="id">transl_expr</span> <span class="id">dst</span> <span class="id">r2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">sl1</span> ++ <span class="id">sl2</span>, <span class="id">a2</span>)<br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Ecall</span> <span class="id">r1</span> <span class="id">rl2</span> <span class="id">ty</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">sl1</span>, <span class="id">a1</span>) &lt;- <span class="id">transl_expr</span> <span class="id">For_val</span> <span class="id">r1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">sl2</span>, <span class="id">al2</span>) &lt;- <span class="id">transl_exprlist</span> <span class="id">rl2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">dst</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">For_val</span> | <span class="id">For_set</span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">t</span> &lt;- <span class="id">gensym</span> <span class="id">ty</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">finish</span> <span class="id">dst</span> (<span class="id">sl1</span> ++ <span class="id">sl2</span> ++ <span class="id">Scall</span> (<span class="id">Some</span> <span class="id">t</span>) <span class="id">a1</span> <span class="id">al2</span> :: <span class="id">nil</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Etempvar</span> <span class="id">t</span> <span class="id">ty</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">For_effects</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">sl1</span> ++ <span class="id">sl2</span> ++ <span class="id">Scall</span> <span class="id">None</span> <span class="id">a1</span> <span class="id">al2</span> :: <span class="id">nil</span>, <span class="id">dummy_expr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Ebuiltin</span> <span class="id">ef</span> <span class="id">tyargs</span> <span class="id">rl</span> <span class="id">ty</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">sl</span>, <span class="id">al</span>) &lt;- <span class="id">transl_exprlist</span> <span class="id">rl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">dst</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">For_val</span> | <span class="id">For_set</span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">t</span> &lt;- <span class="id">gensym</span> <span class="id">ty</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">finish</span> <span class="id">dst</span> (<span class="id">sl</span> ++ <span class="id">Sbuiltin</span> (<span class="id">Some</span> <span class="id">t</span>) <span class="id">ef</span> <span class="id">tyargs</span> <span class="id">al</span> :: <span class="id">nil</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Etempvar</span> <span class="id">t</span> <span class="id">ty</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">For_effects</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">sl</span> ++ <span class="id">Sbuiltin</span> <span class="id">None</span> <span class="id">ef</span> <span class="id">tyargs</span> <span class="id">al</span> :: <span class="id">nil</span>, <span class="id">dummy_expr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Eparen</span> <span class="id">r1</span> <span class="id">tycast</span> <span class="id">ty</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">error</span> (<span class="id">msg</span> "<span class="id">SimplExpr.transl_expr</span>: <span class="id">paren</span>")<br/>
&nbsp;&nbsp;<span class="kwd">end</span><br/>
<br/>
<span class="kwd">with</span> <span class="id">transl_exprlist</span> (<span class="id">rl</span>: <span class="id">exprlist</span>) : <span class="id">mon</span> (<span class="id">list</span> <span class="id">statement</span> * <span class="id">list</span> <span class="id">expr</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">rl</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Enil</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">nil</span>, <span class="id">nil</span>)<br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Econs</span> <span class="id">r1</span> <span class="id">rl2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">sl1</span>, <span class="id">a1</span>) &lt;- <span class="id">transl_expr</span> <span class="id">For_val</span> <span class="id">r1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">sl2</span>, <span class="id">al2</span>) &lt;- <span class="id">transl_exprlist</span> <span class="id">rl2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">sl1</span> ++ <span class="id">sl2</span>, <span class="id">a1</span> :: <span class="id">al2</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">transl_expression</span> (<span class="id">r</span>: <span class="id">Csyntax.expr</span>) : <span class="id">mon</span> (<span class="id">statement</span> * <span class="id">expr</span>) :=<br/>
&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">sl</span>, <span class="id">a</span>) &lt;- <span class="id">transl_expr</span> <span class="id">For_val</span> <span class="id">r</span>; <span class="id">ret</span> (<span class="id">makeseq</span> <span class="id">sl</span>, <span class="id">a</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">transl_expr_stmt</span> (<span class="id">r</span>: <span class="id">Csyntax.expr</span>) : <span class="id">mon</span> <span class="id">statement</span> :=<br/>
&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">sl</span>, <span class="id">a</span>) &lt;- <span class="id">transl_expr</span> <span class="id">For_effects</span> <span class="id">r</span>; <span class="id">ret</span> (<span class="id">makeseq</span> <span class="id">sl</span>).<br/>
<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">transl_if</span> (<span class="id">r</span>: <span class="id">Csyntax.expr</span>) (<span class="id">s1</span> <span class="id">s2</span>: <span class="id">statement</span>) : <span class="id">mon</span> <span class="id">statement</span> :=<br/>
&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">sl</span>, <span class="id">a</span>) &lt;- <span class="id">transl_expr</span> <span class="id">For_val</span> <span class="id">r</span>;<br/>
&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">makeseq</span> (<span class="id">sl</span> ++ <span class="id">makeif</span> <span class="id">a</span> <span class="id">s1</span> <span class="id">s2</span> :: <span class="id">nil</span>)).<br/>
<br/>
<div class="doc">Translation of statements </div>
<br/>
<span class="kwd">Definition</span> <span class="id">expr_true</span> := <span class="id">Econst_int</span> <span class="id">Int.one</span> <span class="id">type_int32s</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">is_Sskip</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span>, {<span class="id">s</span> = <span class="id">Csyntax.Sskip</span>} + {<span class="id">s</span> &lt;&gt; <span class="id">Csyntax.Sskip</span>}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4284')">Proof.</div>
<div class="proofscript" id="proof4284">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">s</span>; ((<span class="id">left</span>; <span class="tactic">reflexivity</span>) || (<span class="id">right</span>; <span class="tactic">congruence</span>)).<br/>
Defined.</div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id">transl_stmt</span> (<span class="id">s</span>: <span class="id">Csyntax.statement</span>) : <span class="id">mon</span> <span class="id">statement</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">s</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Sskip</span> =&gt; <span class="id">ret</span> <span class="id">Sskip</span><br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Sdo</span> <span class="id">e</span> =&gt; <span class="id">transl_expr_stmt</span> <span class="id">e</span><br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Ssequence</span> <span class="id">s1</span> <span class="id">s2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">ts1</span> &lt;- <span class="id">transl_stmt</span> <span class="id">s1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">ts2</span> &lt;- <span class="id">transl_stmt</span> <span class="id">s2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">Ssequence</span> <span class="id">ts1</span> <span class="id">ts2</span>)<br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Sifthenelse</span> <span class="id">e</span> <span class="id">s1</span> <span class="id">s2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">ts1</span> &lt;- <span class="id">transl_stmt</span> <span class="id">s1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">ts2</span> &lt;- <span class="id">transl_stmt</span> <span class="id">s2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">s</span>', <span class="id">a</span>) &lt;- <span class="id">transl_expression</span> <span class="id">e</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">Ssequence</span> <span class="id">s</span>' (<span class="id">Sifthenelse</span> <span class="id">a</span> <span class="id">ts1</span> <span class="id">ts2</span>))<br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Swhile</span> <span class="id">e</span> <span class="id">s1</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">s</span>' &lt;- <span class="id">transl_if</span> <span class="id">e</span> <span class="id">Sskip</span> <span class="id">Sbreak</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">ts1</span> &lt;- <span class="id">transl_stmt</span> <span class="id">s1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">Sloop</span> (<span class="id">Ssequence</span> <span class="id">s</span>' <span class="id">ts1</span>) <span class="id">Sskip</span>)<br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Sdowhile</span> <span class="id">e</span> <span class="id">s1</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">s</span>' &lt;- <span class="id">transl_if</span> <span class="id">e</span> <span class="id">Sskip</span> <span class="id">Sbreak</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">ts1</span> &lt;- <span class="id">transl_stmt</span> <span class="id">s1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">Sloop</span> <span class="id">ts1</span> <span class="id">s</span>')<br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Sfor</span> <span class="id">s1</span> <span class="id">e2</span> <span class="id">s3</span> <span class="id">s4</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">ts1</span> &lt;- <span class="id">transl_stmt</span> <span class="id">s1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">s</span>' &lt;- <span class="id">transl_if</span> <span class="id">e2</span> <span class="id">Sskip</span> <span class="id">Sbreak</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">ts3</span> &lt;- <span class="id">transl_stmt</span> <span class="id">s3</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">ts4</span> &lt;- <span class="id">transl_stmt</span> <span class="id">s4</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">is_Sskip</span> <span class="id">s1</span> <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">Sloop</span> (<span class="id">Ssequence</span> <span class="id">s</span>' <span class="id">ts4</span>) <span class="id">ts3</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">Ssequence</span> <span class="id">ts1</span> (<span class="id">Sloop</span> (<span class="id">Ssequence</span> <span class="id">s</span>' <span class="id">ts4</span>) <span class="id">ts3</span>))<br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Sbreak</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> <span class="id">Sbreak</span><br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Scontinue</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> <span class="id">Scontinue</span><br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Sreturn</span> <span class="id">None</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">Sreturn</span> <span class="id">None</span>)<br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Sreturn</span> (<span class="id">Some</span> <span class="id">e</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">s</span>', <span class="id">a</span>) &lt;- <span class="id">transl_expression</span> <span class="id">e</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">Ssequence</span> <span class="id">s</span>' (<span class="id">Sreturn</span> (<span class="id">Some</span> <span class="id">a</span>)))<br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Sswitch</span> <span class="id">e</span> <span class="id">ls</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">s</span>', <span class="id">a</span>) &lt;- <span class="id">transl_expression</span> <span class="id">e</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">tls</span> &lt;- <span class="id">transl_lblstmt</span> <span class="id">ls</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">Ssequence</span> <span class="id">s</span>' (<span class="id">Sswitch</span> <span class="id">a</span> <span class="id">tls</span>))<br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Slabel</span> <span class="id">lbl</span> <span class="id">s1</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">ts1</span> &lt;- <span class="id">transl_stmt</span> <span class="id">s1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">Slabel</span> <span class="id">lbl</span> <span class="id">ts1</span>)<br/>
&nbsp;&nbsp;| <span class="id">Csyntax.Sgoto</span> <span class="id">lbl</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">Sgoto</span> <span class="id">lbl</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span><br/>
<br/>
<span class="kwd">with</span> <span class="id">transl_lblstmt</span> (<span class="id">ls</span>: <span class="id">Csyntax.labeled_statements</span>) : <span class="id">mon</span> <span class="id">labeled_statements</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">ls</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Csyntax.LSnil</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> <span class="id">LSnil</span><br/>
&nbsp;&nbsp;| <span class="id">Csyntax.LScons</span> <span class="id">c</span> <span class="id">s</span> <span class="id">ls1</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">ts</span> &lt;- <span class="id">transl_stmt</span> <span class="id">s</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">tls1</span> &lt;- <span class="id">transl_lblstmt</span> <span class="id">ls1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ret</span> (<span class="id">LScons</span> <span class="id">c</span> <span class="id">ts</span> <span class="id">tls1</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">Translation of a function </div>
<br/>
<span class="kwd">Definition</span> <span class="id">transl_function</span> (<span class="id">f</span>: <span class="id">Csyntax.function</span>) : <span class="id">res</span> <span class="id">function</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">transl_stmt</span> <span class="id">f</span>.(<span class="id">Csyntax.fn_body</span>) (<span class="id">initial_generator</span> <span class="id">tt</span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Err</span> <span class="id">msg</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Error</span> <span class="id">msg</span><br/>
&nbsp;&nbsp;| <span class="id">Res</span> <span class="id">tbody</span> <span class="id">g</span> <span class="id">i</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">OK</span> (<span class="id">mkfunction</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f</span>.(<span class="id">Csyntax.fn_return</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f</span>.(<span class="id">Csyntax.fn_callconv</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f</span>.(<span class="id">Csyntax.fn_params</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f</span>.(<span class="id">Csyntax.fn_vars</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">g</span>.(<span class="id">gen_trail</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tbody</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Local</span> <span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">error_monad_scope</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">transl_fundef</span> (<span class="id">fd</span>: <span class="id">Csyntax.fundef</span>) : <span class="id">res</span> <span class="id">fundef</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">fd</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Internal</span> <span class="id">f</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">tf</span> &lt;- <span class="id">transl_function</span> <span class="id">f</span>; <span class="id">OK</span> (<span class="id">Internal</span> <span class="id">tf</span>)<br/>
&nbsp;&nbsp;| <span class="id">External</span> <span class="id">ef</span> <span class="id">targs</span> <span class="id">tres</span> <span class="id">cc</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">OK</span> (<span class="id">External</span> <span class="id">ef</span> <span class="id">targs</span> <span class="id">tres</span> <span class="id">cc</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">transl_program</span> (<span class="id">p</span>: <span class="id">Csyntax.program</span>) : <span class="id">res</span> <span class="id">program</span> :=<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">p1</span> &lt;- <span class="id">AST.transform_partial_program</span> <span class="id">transl_fundef</span> <span class="id">p</span>;<br/>
&nbsp;&nbsp;<span class="id">OK</span> {| <span class="id">prog_defs</span> := <span class="id">AST.prog_defs</span> <span class="id">p1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">prog_public</span> := <span class="id">AST.prog_public</span> <span class="id">p1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">prog_main</span> := <span class="id">AST.prog_main</span> <span class="id">p1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">prog_types</span> := <span class="id">prog_types</span> <span class="id">p</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">prog_comp_env</span> := <span class="id">prog_comp_env</span> <span class="id">p</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">prog_comp_env_eq</span> := <span class="id">prog_comp_env_eq</span> <span class="id">p</span> |}.<br/>
</div>
<div class="footer"><hr/>Generated by coq2html</div>
</body>
</html>
