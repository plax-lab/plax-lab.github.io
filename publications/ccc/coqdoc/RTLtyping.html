<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module RTLtyping</title>
<meta name="description" content="Documentation of Coq module RTLtyping" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module RTLtyping</h1>
<div class="coq">
<br/>
<div class="doc">Typing rules and a type inference algorithm for RTL. </div>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Coqlib.html">Coqlib</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Errors.html">Errors</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Unityping.html">Unityping</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Maps.html">Maps</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="AST.html">AST</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Op.html">Op</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Registers.html">Registers</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Globalenvs.html">Globalenvs</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Values.html">Values</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Integers.html">Integers</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Memory.html">Memory</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Events.html">Events</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="RTL.html">RTL</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Conventions.html">Conventions</a></span>.<br/>
<br/>
<h1> The type system </h1>
<br/>
<div class="doc">Like Cminor and all intermediate languages, RTL can be equipped with
  a simple type system that statically guarantees that operations
  and addressing modes are applied to the right number of arguments
  and that the arguments are of the correct types.   The type algebra
  is very simple, consisting of the four types <span class="bracket"><span class="id">Tint</span></span> (for integers
  and pointers), <span class="bracket"><span class="id">Tfloat</span></span> (for double-precision floats), <span class="bracket"><span class="id">Tlong</span></span>
  (for 64-bit integers) and <span class="bracket"><span class="id">Tsingle</span></span> (for single-precision floats).
  Additionally, we impose that each pseudo-register has the same type
  throughout the function.  This requirement helps with register allocation,
  enabling each pseudo-register to be mapped to a single hardware register
  or stack location of the correct type.
  Finally, we also check that the successors of instructions
  are valid, i.e. refer to non-empty nodes in the CFG.
  The typing judgement for instructions is of the form <span class="bracket"><span class="id">wt_instr</span> <span class="id">f</span> <span class="id">env</span>
  <span class="id">instr</span></span>, where <span class="bracket"><span class="id">f</span></span> is the current function (used to type-check
  <span class="bracket"><span class="id">Ireturn</span></span> instructions) and <span class="bracket"><span class="id">env</span></span> is a typing environment
  associating types to pseudo-registers.  Since pseudo-registers have
  unique types throughout the function, the typing environment does
  not change during type-checking of individual instructions.  One
  point to note is that we have one polymorphic operator, <span class="bracket"><span class="id">Omove</span></span>,
  which can work over both integers and floats.
</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="regenv">regenv</a></span> := <span class="id"><a href="Registers.html#reg">reg</a></span> -&gt; <span class="id"><a href="AST.html#typ">typ</a></span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="WT_INSTR">WT_INSTR</a></span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id"><a name="WT_INSTR.funct">funct</a></span>: <span class="id"><a href="RTL.html#function">function</a></span>.<br/>
<span class="kwd">Variable</span> <span class="id"><a name="WT_INSTR.env">env</a></span>: <span class="id"><a href="RTLtyping.html#regenv">regenv</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="valid_successor">valid_successor</a></span> (<span class="id">s</span>: <span class="id"><a href="RTL.html#node">node</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">i</span>, <span class="id"><a href="RTLtyping.html#WT_INSTR.funct">funct</a></span>.(<span class="id"><a href="RTL.html#fn_code">fn_code</a></span>)!<span class="id"><a href="RTLtyping.html#s">s</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="RTLtyping.html#i">i</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="type_of_builtin_arg">type_of_builtin_arg</a></span> (<span class="id">a</span>: <span class="id"><a href="AST.html#builtin_arg">builtin_arg</a></span> <span class="id"><a href="Registers.html#reg">reg</a></span>) : <span class="id"><a href="AST.html#typ">typ</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="RTLtyping.html#a">a</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="AST.html#BA">BA</a></span> <span class="id">r</span> =&gt; <span class="id"><a href="RTLtyping.html#WT_INSTR.env">env</a></span> <span class="id">r</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="AST.html#BA_int">BA_int</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="AST.html#Tint">Tint</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="AST.html#BA_long">BA_long</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="AST.html#Tlong">Tlong</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="AST.html#BA_float">BA_float</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="AST.html#Tfloat">Tfloat</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="AST.html#BA_single">BA_single</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="AST.html#Tsingle">Tsingle</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="AST.html#BA_loadstack">BA_loadstack</a></span> <span class="id">chunk</span> <span class="id">ofs</span> =&gt; <span class="id"><a href="AST.html#type_of_chunk">type_of_chunk</a></span> <span class="id">chunk</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="AST.html#BA_addrstack">BA_addrstack</a></span> <span class="id">ofs</span> =&gt; <span class="id"><a href="AST.html#Tptr">Tptr</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="AST.html#BA_loadglobal">BA_loadglobal</a></span> <span class="id">chunk</span> <span class="id">id</span> <span class="id">ofs</span> =&gt; <span class="id"><a href="AST.html#type_of_chunk">type_of_chunk</a></span> <span class="id">chunk</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="AST.html#BA_addrglobal">BA_addrglobal</a></span> <span class="id">id</span> <span class="id">ofs</span> =&gt; <span class="id"><a href="AST.html#Tptr">Tptr</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="AST.html#BA_splitlong">BA_splitlong</a></span> <span class="id">hi</span> <span class="id">lo</span> =&gt; <span class="id"><a href="AST.html#Tlong">Tlong</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="type_of_builtin_res">type_of_builtin_res</a></span> (<span class="id">r</span>: <span class="id"><a href="AST.html#builtin_res">builtin_res</a></span> <span class="id"><a href="Registers.html#reg">reg</a></span>) : <span class="id"><a href="AST.html#typ">typ</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="RTLtyping.html#r">r</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="AST.html#BR">BR</a></span> <span class="id">r</span> =&gt; <span class="id"><a href="RTLtyping.html#WT_INSTR.env">env</a></span> <span class="id"><a href="RTLtyping.html#r">r</a></span><br/>
&nbsp;&nbsp;| <span class="id">_</span>    =&gt; <span class="id"><a href="AST.html#Tint">Tint</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="wt_instr">wt_instr</a></span> : <span class="id"><a href="RTL.html#instruction">instruction</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="wt_Inop">wt_Inop</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#valid_successor">valid_successor</a></span> <span class="id"><a href="RTLtyping.html#s">s</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_instr">wt_instr</a></span> (<span class="id"><a href="RTL.html#Inop">Inop</a></span> <span class="id"><a href="RTLtyping.html#s">s</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="wt_Iopmove">wt_Iopmove</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r1</span> <span class="id">r</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#WT_INSTR.env">env</a></span> <span class="id"><a href="RTLtyping.html#r">r</a></span> = <span class="id"><a href="RTLtyping.html#WT_INSTR.env">env</a></span> <span class="id"><a href="RTLtyping.html#r1">r1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#valid_successor">valid_successor</a></span> <span class="id"><a href="RTLtyping.html#s">s</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_instr">wt_instr</a></span> (<span class="id"><a href="RTL.html#Iop">Iop</a></span> <span class="id"><a href="Op.html#Omove">Omove</a></span> (<span class="id"><a href="RTLtyping.html#r1">r1</a></span> :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id"><a href="RTLtyping.html#r">r</a></span> <span class="id"><a href="RTLtyping.html#s">s</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="wt_Iop">wt_Iop</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">op</span> <span class="id">args</span> <span class="id">res</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#op">op</a></span> &lt;&gt; <span class="id"><a href="Op.html#Omove">Omove</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="RTLtyping.html#WT_INSTR.env">env</a></span> <span class="id"><a href="RTLtyping.html#args">args</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Op.html#type_of_operation">type_of_operation</a></span> <span class="id"><a href="RTLtyping.html#op">op</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#WT_INSTR.env">env</a></span> <span class="id"><a href="RTLtyping.html#res">res</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="Op.html#type_of_operation">type_of_operation</a></span> <span class="id"><a href="RTLtyping.html#op">op</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#valid_successor">valid_successor</a></span> <span class="id"><a href="RTLtyping.html#s">s</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_instr">wt_instr</a></span> (<span class="id"><a href="RTL.html#Iop">Iop</a></span> <span class="id"><a href="RTLtyping.html#op">op</a></span> <span class="id"><a href="RTLtyping.html#args">args</a></span> <span class="id"><a href="RTLtyping.html#res">res</a></span> <span class="id"><a href="RTLtyping.html#s">s</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="wt_Iload">wt_Iload</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">chunk</span> <span class="id">addr</span> <span class="id">args</span> <span class="id">dst</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="RTLtyping.html#WT_INSTR.env">env</a></span> <span class="id"><a href="RTLtyping.html#args">args</a></span> = <span class="id"><a href="Op.html#type_of_addressing">type_of_addressing</a></span> <span class="id"><a href="RTLtyping.html#addr">addr</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#WT_INSTR.env">env</a></span> <span class="id"><a href="RTLtyping.html#dst">dst</a></span> = <span class="id"><a href="AST.html#type_of_chunk">type_of_chunk</a></span> <span class="id"><a href="RTLtyping.html#chunk">chunk</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#valid_successor">valid_successor</a></span> <span class="id"><a href="RTLtyping.html#s">s</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_instr">wt_instr</a></span> (<span class="id"><a href="RTL.html#Iload">Iload</a></span> <span class="id"><a href="RTLtyping.html#chunk">chunk</a></span> <span class="id"><a href="RTLtyping.html#addr">addr</a></span> <span class="id"><a href="RTLtyping.html#args">args</a></span> <span class="id"><a href="RTLtyping.html#dst">dst</a></span> <span class="id"><a href="RTLtyping.html#s">s</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="wt_Istore">wt_Istore</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">chunk</span> <span class="id">addr</span> <span class="id">args</span> <span class="id">src</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="RTLtyping.html#WT_INSTR.env">env</a></span> <span class="id"><a href="RTLtyping.html#args">args</a></span> = <span class="id"><a href="Op.html#type_of_addressing">type_of_addressing</a></span> <span class="id"><a href="RTLtyping.html#addr">addr</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#WT_INSTR.env">env</a></span> <span class="id"><a href="RTLtyping.html#src">src</a></span> = <span class="id"><a href="AST.html#type_of_chunk">type_of_chunk</a></span> <span class="id"><a href="RTLtyping.html#chunk">chunk</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#valid_successor">valid_successor</a></span> <span class="id"><a href="RTLtyping.html#s">s</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_instr">wt_instr</a></span> (<span class="id"><a href="RTL.html#Istore">Istore</a></span> <span class="id"><a href="RTLtyping.html#chunk">chunk</a></span> <span class="id"><a href="RTLtyping.html#addr">addr</a></span> <span class="id"><a href="RTLtyping.html#args">args</a></span> <span class="id"><a href="RTLtyping.html#src">src</a></span> <span class="id"><a href="RTLtyping.html#s">s</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="wt_Icall">wt_Icall</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sig</span> <span class="id">ros</span> <span class="id">args</span> <span class="id">res</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="RTLtyping.html#ros">ros</a></span> <span class="kwd">with</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inl">inl</a></span> <span class="id">r</span> =&gt; <span class="id"><a href="RTLtyping.html#WT_INSTR.env">env</a></span> <span class="id">r</span> = <span class="id"><a href="AST.html#Tptr">Tptr</a></span> | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inr">inr</a></span> <span class="id">s</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span> <span class="kwd">end</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="RTLtyping.html#WT_INSTR.env">env</a></span> <span class="id"><a href="RTLtyping.html#args">args</a></span> = <span class="id"><a href="RTLtyping.html#sig">sig</a></span>.(<span class="id"><a href="AST.html#sig_args">sig_args</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#WT_INSTR.env">env</a></span> <span class="id"><a href="RTLtyping.html#res">res</a></span> = <span class="id"><a href="AST.html#proj_sig_res">proj_sig_res</a></span> <span class="id"><a href="RTLtyping.html#sig">sig</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#valid_successor">valid_successor</a></span> <span class="id"><a href="RTLtyping.html#s">s</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_instr">wt_instr</a></span> (<span class="id"><a href="RTL.html#Icall">Icall</a></span> <span class="id"><a href="RTLtyping.html#sig">sig</a></span> <span class="id"><a href="RTLtyping.html#ros">ros</a></span> <span class="id"><a href="RTLtyping.html#args">args</a></span> <span class="id"><a href="RTLtyping.html#res">res</a></span> <span class="id"><a href="RTLtyping.html#s">s</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="wt_Itailcall">wt_Itailcall</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sig</span> <span class="id">ros</span> <span class="id">args</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="RTLtyping.html#ros">ros</a></span> <span class="kwd">with</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inl">inl</a></span> <span class="id">r</span> =&gt; <span class="id"><a href="RTLtyping.html#WT_INSTR.env">env</a></span> <span class="id">r</span> = <span class="id"><a href="AST.html#Tptr">Tptr</a></span> | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inr">inr</a></span> <span class="id">s</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span> <span class="kwd">end</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="RTLtyping.html#WT_INSTR.env">env</a></span> <span class="id"><a href="RTLtyping.html#args">args</a></span> = <span class="id"><a href="RTLtyping.html#sig">sig</a></span>.(<span class="id"><a href="AST.html#sig_args">sig_args</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#sig">sig</a></span>.(<span class="id"><a href="AST.html#sig_res">sig_res</a></span>) = <span class="id"><a href="RTLtyping.html#WT_INSTR.funct">funct</a></span>.(<span class="id"><a href="RTL.html#fn_sig">fn_sig</a></span>).(<span class="id"><a href="AST.html#sig_res">sig_res</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Conventions.html#tailcall_possible">tailcall_possible</a></span> <span class="id"><a href="RTLtyping.html#sig">sig</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_instr">wt_instr</a></span> (<span class="id"><a href="RTL.html#Itailcall">Itailcall</a></span> <span class="id"><a href="RTLtyping.html#sig">sig</a></span> <span class="id"><a href="RTLtyping.html#ros">ros</a></span> <span class="id"><a href="RTLtyping.html#args">args</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="wt_Ibuiltin">wt_Ibuiltin</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ef</span> <span class="id">args</span> <span class="id">res</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="RTLtyping.html#ef">ef</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="AST.html#EF_annot">EF_annot</a></span> <span class="id">_</span> <span class="id">_</span> | <span class="id"><a href="AST.html#EF_debug">EF_debug</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="RTLtyping.html#type_of_builtin_arg">type_of_builtin_arg</a></span> <span class="id"><a href="RTLtyping.html#args">args</a></span> = (<span class="id"><a href="AST.html#ef_sig">ef_sig</a></span> <span class="id"><a href="RTLtyping.html#ef">ef</a></span>).(<span class="id"><a href="AST.html#sig_args">sig_args</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#type_of_builtin_res">type_of_builtin_res</a></span> <span class="id"><a href="RTLtyping.html#res">res</a></span> = <span class="id"><a href="AST.html#proj_sig_res">proj_sig_res</a></span> (<span class="id"><a href="AST.html#ef_sig">ef_sig</a></span> <span class="id"><a href="RTLtyping.html#ef">ef</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#valid_successor">valid_successor</a></span> <span class="id"><a href="RTLtyping.html#s">s</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_instr">wt_instr</a></span> (<span class="id"><a href="RTL.html#Ibuiltin">Ibuiltin</a></span> <span class="id"><a href="RTLtyping.html#ef">ef</a></span> <span class="id"><a href="RTLtyping.html#args">args</a></span> <span class="id"><a href="RTLtyping.html#res">res</a></span> <span class="id"><a href="RTLtyping.html#s">s</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="wt_Icond">wt_Icond</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">cond</span> <span class="id">args</span> <span class="id">s1</span> <span class="id">s2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="RTLtyping.html#WT_INSTR.env">env</a></span> <span class="id"><a href="RTLtyping.html#args">args</a></span> = <span class="id"><a href="Op.html#type_of_condition">type_of_condition</a></span> <span class="id"><a href="RTLtyping.html#cond">cond</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#valid_successor">valid_successor</a></span> <span class="id"><a href="RTLtyping.html#s1">s1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#valid_successor">valid_successor</a></span> <span class="id"><a href="RTLtyping.html#s2">s2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_instr">wt_instr</a></span> (<span class="id"><a href="RTL.html#Icond">Icond</a></span> <span class="id"><a href="RTLtyping.html#cond">cond</a></span> <span class="id"><a href="RTLtyping.html#args">args</a></span> <span class="id"><a href="RTLtyping.html#s1">s1</a></span> <span class="id"><a href="RTLtyping.html#s2">s2</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="wt_Ijumptable">wt_Ijumptable</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">arg</span> <span class="id">tbl</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#WT_INSTR.env">env</a></span> <span class="id"><a href="RTLtyping.html#arg">arg</a></span> = <span class="id"><a href="AST.html#Tint">Tint</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">s</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="RTLtyping.html#s">s</a></span> <span class="id"><a href="RTLtyping.html#tbl">tbl</a></span> -&gt; <span class="id"><a href="RTLtyping.html#valid_successor">valid_successor</a></span> <span class="id"><a href="RTLtyping.html#s">s</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Coqlib.html#list_length_z">list_length_z</a></span> <span class="id"><a href="RTLtyping.html#tbl">tbl</a></span> * 4 &lt;= <span class="id"><a href="Integers.html#Int.max_unsigned">Int.max_unsigned</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_instr">wt_instr</a></span> (<span class="id"><a href="RTL.html#Ijumptable">Ijumptable</a></span> <span class="id"><a href="RTLtyping.html#arg">arg</a></span> <span class="id"><a href="RTLtyping.html#tbl">tbl</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="wt_Ireturn_none">wt_Ireturn_none</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#WT_INSTR.funct">funct</a></span>.(<span class="id"><a href="RTL.html#fn_sig">fn_sig</a></span>).(<span class="id"><a href="AST.html#sig_res">sig_res</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_instr">wt_instr</a></span> (<span class="id"><a href="RTL.html#Ireturn">Ireturn</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="wt_Ireturn_some">wt_Ireturn_some</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">arg</span> <span class="id">ty</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#WT_INSTR.funct">funct</a></span>.(<span class="id"><a href="RTL.html#fn_sig">fn_sig</a></span>).(<span class="id"><a href="AST.html#sig_res">sig_res</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="RTLtyping.html#ty">ty</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#WT_INSTR.env">env</a></span> <span class="id"><a href="RTLtyping.html#arg">arg</a></span> = <span class="id"><a href="RTLtyping.html#ty">ty</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_instr">wt_instr</a></span> (<span class="id"><a href="RTL.html#Ireturn">Ireturn</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="RTLtyping.html#arg">arg</a></span>)).<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="RTLtyping.html#WT_INSTR">WT_INSTR</a></span>.<br/>
<br/>
<div class="doc">A function <span class="bracket"><span class="id">f</span></span> is well-typed w.r.t. a typing environment <span class="bracket"><span class="id">env</span></span>,
   written <span class="bracket"><span class="id">wt_function</span> <span class="id">env</span> <span class="id">f</span></span>, if all instructions are well-typed,
   parameters agree in types with the function signature, and
   parameters are pairwise distinct. </div>
<br/>
<span class="kwd">Record</span> <span class="id"><a name="wt_function">wt_function</a></span> (<span class="id">f</span>: <span class="id"><a href="RTL.html#function">function</a></span>) (<span class="id">env</span>: <span class="id"><a href="RTLtyping.html#regenv">regenv</a></span>): <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a name="mk_wt_function">mk_wt_function</a></span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="wt_params">wt_params</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="RTLtyping.html#env">env</a></span> <span class="id"><a href="RTLtyping.html#f">f</a></span>.(<span class="id"><a href="RTL.html#fn_params">fn_params</a></span>) = <span class="id"><a href="RTLtyping.html#f">f</a></span>.(<span class="id"><a href="RTL.html#fn_sig">fn_sig</a></span>).(<span class="id"><a href="AST.html#sig_args">sig_args</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="wt_norepet">wt_norepet</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Coqlib.html#list_norepet">list_norepet</a></span> <span class="id"><a href="RTLtyping.html#f">f</a></span>.(<span class="id"><a href="RTL.html#fn_params">fn_params</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="wt_instrs">wt_instrs</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">pc</span> <span class="id">instr</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#f">f</a></span>.(<span class="id"><a href="RTL.html#fn_code">fn_code</a></span>)!<span class="id"><a href="RTLtyping.html#pc">pc</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="RTLtyping.html#instr">instr</a></span> -&gt; <span class="id"><a href="RTLtyping.html#wt_instr">wt_instr</a></span> <span class="id"><a href="RTLtyping.html#f">f</a></span> <span class="id"><a href="RTLtyping.html#env">env</a></span> <span class="id"><a href="RTLtyping.html#instr">instr</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="wt_entrypoint">wt_entrypoint</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#valid_successor">valid_successor</a></span> <span class="id"><a href="RTLtyping.html#f">f</a></span> <span class="id"><a href="RTLtyping.html#f">f</a></span>.(<span class="id"><a href="RTL.html#fn_entrypoint">fn_entrypoint</a></span>)<br/>
}.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="wt_fundef">wt_fundef</a></span>: <span class="id"><a href="RTL.html#fundef">fundef</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="wt_fundef_external">wt_fundef_external</a></span>: <span class="kwd">forall</span> <span class="id">ef</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_fundef">wt_fundef</a></span> (<span class="id"><a href="AST.html#External">External</a></span> <span class="id"><a href="RTLtyping.html#ef">ef</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="wt_function_internal">wt_function_internal</a></span>: <span class="kwd">forall</span> <span class="id">f</span> <span class="id">env</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_function">wt_function</a></span> <span class="id"><a href="RTLtyping.html#f">f</a></span> <span class="id"><a href="RTLtyping.html#env">env</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_fundef">wt_fundef</a></span> (<span class="id"><a href="AST.html#Internal">Internal</a></span> <span class="id"><a href="RTLtyping.html#f">f</a></span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="wt_program">wt_program</a></span> (<span class="id">p</span>: <span class="id"><a href="RTL.html#program">program</a></span>): <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">i</span> <span class="id">f</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="RTLtyping.html#i">i</a></span>, <span class="id"><a href="AST.html#Gfun">Gfun</a></span> <span class="id"><a href="RTLtyping.html#f">f</a></span>) (<span class="id"><a href="AST.html#prog_defs">prog_defs</a></span> <span class="id"><a href="RTLtyping.html#p">p</a></span>) -&gt; <span class="id"><a href="RTLtyping.html#wt_fundef">wt_fundef</a></span> <span class="id"><a href="RTLtyping.html#f">f</a></span>.<br/>
<br/>
<h1> Type inference </h1>
<br/>
<div class="doc">Type inference reuses the generic solver for unification constraints
  defined in module <span class="bracket"><span class="id">Unityping</span></span>. </div>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="RTLtypes">RTLtypes</a></span> &lt;: <span class="id"><a href="Unityping.html#TYPE_ALGEBRA">TYPE_ALGEBRA</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="RTLtypes.t">t</a></span> := <span class="id"><a href="AST.html#typ">typ</a></span>.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="RTLtypes.eq">eq</a></span> := <span class="id"><a href="AST.html#typ_eq">typ_eq</a></span>.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="RTLtypes.default">default</a></span> := <span class="id"><a href="AST.html#Tint">Tint</a></span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="RTLtyping.html#RTLtypes">RTLtypes</a></span>.<br/>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="S">S</a></span> := <span class="id"><a href="Unityping.html#UniSolver">UniSolver</a></span>(<span class="id"><a href="RTLtyping.html#RTLtypes">RTLtypes</a></span>).<br/>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="INFERENCE">INFERENCE</a></span>.<br/>
<br/>
<span class="kwd">Local</span> <span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">error_monad_scope</span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id"><a name="INFERENCE.f">f</a></span>: <span class="id"><a href="RTL.html#function">function</a></span>.<br/>
<br/>
<div class="doc">Checking the validity of successor nodes. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="check_successor">check_successor</a></span> (<span class="id">s</span>: <span class="id"><a href="RTL.html#node">node</a></span>): <span class="id"><a href="Errors.html#res">res</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="RTLtyping.html#INFERENCE.f">f</a></span>.(<span class="id"><a href="RTL.html#fn_code">fn_code</a></span>)!<span class="id"><a href="RTLtyping.html#s">s</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="Errors.html#Error">Error</a></span> (<span class="id"><a href="Errors.html#MSG">MSG</a></span> "<span class="id">bad</span> <span class="id">successor</span> " :: <span class="id"><a href="Errors.html#POS">POS</a></span> <span class="id"><a href="RTLtyping.html#s">s</a></span> :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">i</span> =&gt; <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="check_successors">check_successors</a></span> (<span class="id">sl</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="RTL.html#node">node</a></span>): <span class="id"><a href="Errors.html#res">res</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="RTLtyping.html#sl">sl</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span><br/>
&nbsp;&nbsp;| <span class="id">s1</span> :: <span class="id">sl</span>' =&gt; <span class="tactic">do</span> <span class="id">x</span> &lt;- <span class="id"><a href="RTLtyping.html#check_successor">check_successor</a></span> <span class="id">s1</span>; <span class="id"><a href="RTLtyping.html#check_successors">check_successors</a></span> <span class="id">sl</span>'<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">Check structural constraints and process / record all type constraints. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="type_ros">type_ros</a></span> (<span class="id">e</span>: <span class="id"><a href="RTLtyping.html#typenv">S.typenv</a></span>) (<span class="id">ros</span>: <span class="id"><a href="Registers.html#reg">reg</a></span> + <span class="id"><a href="AST.html#ident">ident</a></span>) : <span class="id"><a href="Errors.html#res">res</a></span> <span class="id"><a href="RTLtyping.html#typenv">S.typenv</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="RTLtyping.html#ros">ros</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inl">inl</a></span> <span class="id">r</span> =&gt; <span class="id"><a href="RTLtyping.html#set">S.set</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id">r</span> <span class="id"><a href="AST.html#Tptr">Tptr</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inr">inr</a></span> <span class="id">s</span> =&gt; <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="is_move">is_move</a></span> (<span class="id">op</span>: <span class="id"><a href="Op.html#operation">operation</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="RTLtyping.html#op">op</a></span> <span class="kwd">with</span> <span class="id"><a href="Op.html#Omove">Omove</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> | <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> <span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="type_expect">type_expect</a></span> (<span class="id">e</span>: <span class="id"><a href="RTLtyping.html#typenv">S.typenv</a></span>) (<span class="id">t1</span> <span class="id">t2</span>: <span class="id"><a href="AST.html#typ">typ</a></span>) : <span class="id"><a href="Errors.html#res">res</a></span> <span class="id"><a href="RTLtyping.html#typenv">S.typenv</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="AST.html#typ_eq">typ_eq</a></span> <span class="id"><a href="RTLtyping.html#t1">t1</a></span> <span class="id"><a href="RTLtyping.html#t2">t2</a></span> <span class="kwd">then</span> <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="kwd">else</span> <span class="id"><a href="Errors.html#Error">Error</a></span>(<span class="id"><a href="Errors.html#msg">msg</a></span> "<span class="id">unexpected</span> <span class="id">type</span>").<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="type_builtin_arg">type_builtin_arg</a></span> (<span class="id">e</span>: <span class="id"><a href="RTLtyping.html#typenv">S.typenv</a></span>) (<span class="id">a</span>: <span class="id"><a href="AST.html#builtin_arg">builtin_arg</a></span> <span class="id"><a href="Registers.html#reg">reg</a></span>) (<span class="id">ty</span>: <span class="id"><a href="AST.html#typ">typ</a></span>) : <span class="id"><a href="Errors.html#res">res</a></span> <span class="id"><a href="RTLtyping.html#typenv">S.typenv</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="RTLtyping.html#a">a</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="AST.html#BA">BA</a></span> <span class="id">r</span> =&gt; <span class="id"><a href="RTLtyping.html#set">S.set</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id">r</span> <span class="id"><a href="RTLtyping.html#ty">ty</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="AST.html#BA_int">BA_int</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="RTLtyping.html#type_expect">type_expect</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id"><a href="RTLtyping.html#ty">ty</a></span> <span class="id"><a href="AST.html#Tint">Tint</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="AST.html#BA_long">BA_long</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="RTLtyping.html#type_expect">type_expect</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id"><a href="RTLtyping.html#ty">ty</a></span> <span class="id"><a href="AST.html#Tlong">Tlong</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="AST.html#BA_float">BA_float</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="RTLtyping.html#type_expect">type_expect</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id"><a href="RTLtyping.html#ty">ty</a></span> <span class="id"><a href="AST.html#Tfloat">Tfloat</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="AST.html#BA_single">BA_single</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="RTLtyping.html#type_expect">type_expect</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id"><a href="RTLtyping.html#ty">ty</a></span> <span class="id"><a href="AST.html#Tsingle">Tsingle</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="AST.html#BA_loadstack">BA_loadstack</a></span> <span class="id">chunk</span> <span class="id">ofs</span> =&gt; <span class="id"><a href="RTLtyping.html#type_expect">type_expect</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id"><a href="RTLtyping.html#ty">ty</a></span> (<span class="id"><a href="AST.html#type_of_chunk">type_of_chunk</a></span> <span class="id">chunk</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="AST.html#BA_addrstack">BA_addrstack</a></span> <span class="id">ofs</span> =&gt; <span class="id"><a href="RTLtyping.html#type_expect">type_expect</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id"><a href="RTLtyping.html#ty">ty</a></span> <span class="id"><a href="AST.html#Tptr">Tptr</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="AST.html#BA_loadglobal">BA_loadglobal</a></span> <span class="id">chunk</span> <span class="id">id</span> <span class="id">ofs</span> =&gt; <span class="id"><a href="RTLtyping.html#type_expect">type_expect</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id"><a href="RTLtyping.html#ty">ty</a></span> (<span class="id"><a href="AST.html#type_of_chunk">type_of_chunk</a></span> <span class="id">chunk</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="AST.html#BA_addrglobal">BA_addrglobal</a></span> <span class="id">id</span> <span class="id">ofs</span> =&gt; <span class="id"><a href="RTLtyping.html#type_expect">type_expect</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id"><a href="RTLtyping.html#ty">ty</a></span> <span class="id"><a href="AST.html#Tptr">Tptr</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="AST.html#BA_splitlong">BA_splitlong</a></span> <span class="id">hi</span> <span class="id">lo</span> =&gt; <span class="id"><a href="RTLtyping.html#type_expect">type_expect</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id"><a href="RTLtyping.html#ty">ty</a></span> <span class="id"><a href="AST.html#Tlong">Tlong</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="type_builtin_args">type_builtin_args</a></span> (<span class="id">e</span>: <span class="id"><a href="RTLtyping.html#typenv">S.typenv</a></span>) (<span class="id">al</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="AST.html#builtin_arg">builtin_arg</a></span> <span class="id"><a href="Registers.html#reg">reg</a></span>)) (<span class="id">tyl</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="AST.html#typ">typ</a></span>) : <span class="id"><a href="Errors.html#res">res</a></span> <span class="id"><a href="RTLtyping.html#typenv">S.typenv</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="RTLtyping.html#al">al</a></span>, <span class="id"><a href="RTLtyping.html#tyl">tyl</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span><br/>
&nbsp;&nbsp;| <span class="id">a1</span> :: <span class="id">al</span>, <span class="id">ty1</span> :: <span class="id">tyl</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">e1</span> &lt;- <span class="id"><a href="RTLtyping.html#type_builtin_arg">type_builtin_arg</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id">a1</span> <span class="id">ty1</span>; <span class="id"><a href="RTLtyping.html#type_builtin_args">type_builtin_args</a></span> <span class="id">e1</span> <span class="id"><a href="RTLtyping.html#al">al</a></span> <span class="id"><a href="RTLtyping.html#tyl">tyl</a></span><br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Errors.html#Error">Error</a></span> (<span class="id"><a href="Errors.html#msg">msg</a></span> "<span class="id">builtin</span> <span class="id">arity</span> <span class="id">mismatch</span>")<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="type_builtin_res">type_builtin_res</a></span> (<span class="id">e</span>: <span class="id"><a href="RTLtyping.html#typenv">S.typenv</a></span>) (<span class="id">a</span>: <span class="id"><a href="AST.html#builtin_res">builtin_res</a></span> <span class="id"><a href="Registers.html#reg">reg</a></span>) (<span class="id">ty</span>: <span class="id"><a href="AST.html#typ">typ</a></span>) : <span class="id"><a href="Errors.html#res">res</a></span> <span class="id"><a href="RTLtyping.html#typenv">S.typenv</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="RTLtyping.html#a">a</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="AST.html#BR">BR</a></span> <span class="id">r</span> =&gt; <span class="id"><a href="RTLtyping.html#set">S.set</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id">r</span> <span class="id"><a href="RTLtyping.html#ty">ty</a></span><br/>
&nbsp;&nbsp;| <span class="id">_</span>    =&gt; <span class="id"><a href="RTLtyping.html#type_expect">type_expect</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id"><a href="RTLtyping.html#ty">ty</a></span> <span class="id"><a href="AST.html#Tint">Tint</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="type_instr">type_instr</a></span> (<span class="id">e</span>: <span class="id"><a href="RTLtyping.html#typenv">S.typenv</a></span>) (<span class="id">i</span>: <span class="id"><a href="RTL.html#instruction">instruction</a></span>) : <span class="id"><a href="Errors.html#res">res</a></span> <span class="id"><a href="RTLtyping.html#typenv">S.typenv</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="RTLtyping.html#i">i</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="RTL.html#Inop">Inop</a></span> <span class="id">s</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">x</span> &lt;- <span class="id"><a href="RTLtyping.html#check_successor">check_successor</a></span> <span class="id">s</span>; <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="RTL.html#Iop">Iop</a></span> <span class="id">op</span> <span class="id">args</span> <span class="id">res</span> <span class="id">s</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">x</span> &lt;- <span class="id"><a href="RTLtyping.html#check_successor">check_successor</a></span> <span class="id">s</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="RTLtyping.html#is_move">is_move</a></span> <span class="id">op</span> <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">args</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">arg</span> :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; <span class="tactic">do</span> (<span class="id">changed</span>, <span class="id">e</span>') &lt;- <span class="id"><a href="RTLtyping.html#move">S.move</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id">res</span> <span class="id">arg</span>; <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id">e</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="Errors.html#Error">Error</a></span> (<span class="id"><a href="Errors.html#msg">msg</a></span> "<span class="id">ill</span>-<span class="id">formed</span> <span class="tactic">move</span>")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">let</span> (<span class="id">targs</span>, <span class="id">tres</span>) := <span class="id"><a href="Op.html#type_of_operation">type_of_operation</a></span> <span class="id">op</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">e1</span> &lt;- <span class="id"><a href="RTLtyping.html#set_list">S.set_list</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id">args</span> <span class="id"><a href="RTLtyping.html#targs">targs</a></span>; <span class="id"><a href="RTLtyping.html#set">S.set</a></span> <span class="id">e1</span> <span class="id">res</span> <span class="id"><a href="RTLtyping.html#tres">tres</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="RTL.html#Iload">Iload</a></span> <span class="id">chunk</span> <span class="id">addr</span> <span class="id">args</span> <span class="id">dst</span> <span class="id">s</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">x</span> &lt;- <span class="id"><a href="RTLtyping.html#check_successor">check_successor</a></span> <span class="id">s</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">e1</span> &lt;- <span class="id"><a href="RTLtyping.html#set_list">S.set_list</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id">args</span> (<span class="id"><a href="Op.html#type_of_addressing">type_of_addressing</a></span> <span class="id">addr</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#set">S.set</a></span> <span class="id">e1</span> <span class="id">dst</span> (<span class="id"><a href="AST.html#type_of_chunk">type_of_chunk</a></span> <span class="id">chunk</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="RTL.html#Istore">Istore</a></span> <span class="id">chunk</span> <span class="id">addr</span> <span class="id">args</span> <span class="id">src</span> <span class="id">s</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">x</span> &lt;- <span class="id"><a href="RTLtyping.html#check_successor">check_successor</a></span> <span class="id">s</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">e1</span> &lt;- <span class="id"><a href="RTLtyping.html#set_list">S.set_list</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id">args</span> (<span class="id"><a href="Op.html#type_of_addressing">type_of_addressing</a></span> <span class="id">addr</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#set">S.set</a></span> <span class="id">e1</span> <span class="id">src</span> (<span class="id"><a href="AST.html#type_of_chunk">type_of_chunk</a></span> <span class="id">chunk</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="RTL.html#Icall">Icall</a></span> <span class="id">sig</span> <span class="id">ros</span> <span class="id">args</span> <span class="id">res</span> <span class="id">s</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">x</span> &lt;- <span class="id"><a href="RTLtyping.html#check_successor">check_successor</a></span> <span class="id">s</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">e1</span> &lt;- <span class="id"><a href="RTLtyping.html#type_ros">type_ros</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id">ros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">e2</span> &lt;- <span class="id"><a href="RTLtyping.html#set_list">S.set_list</a></span> <span class="id">e1</span> <span class="id">args</span> <span class="id">sig</span>.(<span class="id"><a href="AST.html#sig_args">sig_args</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#set">S.set</a></span> <span class="id">e2</span> <span class="id">res</span> (<span class="id"><a href="AST.html#proj_sig_res">proj_sig_res</a></span> <span class="id">sig</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="RTL.html#Itailcall">Itailcall</a></span> <span class="id">sig</span> <span class="id">ros</span> <span class="id">args</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">e1</span> &lt;- <span class="id"><a href="RTLtyping.html#type_ros">type_ros</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id">ros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">e2</span> &lt;- <span class="id"><a href="RTLtyping.html#set_list">S.set_list</a></span> <span class="id">e1</span> <span class="id">args</span> <span class="id">sig</span>.(<span class="id"><a href="AST.html#sig_args">sig_args</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="AST.html#opt_typ_eq">opt_typ_eq</a></span> <span class="id">sig</span>.(<span class="id"><a href="AST.html#sig_res">sig_res</a></span>) <span class="id"><a href="RTLtyping.html#INFERENCE.f">f</a></span>.(<span class="id"><a href="RTL.html#fn_sig">fn_sig</a></span>).(<span class="id"><a href="AST.html#sig_res">sig_res</a></span>) <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="Conventions.html#tailcall_is_possible">tailcall_is_possible</a></span> <span class="id">sig</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id">e2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="Errors.html#Error">Error</a></span>(<span class="id"><a href="Errors.html#msg">msg</a></span> "<span class="id">tailcall</span> <span class="id">not</span> <span class="id">possible</span>")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="Errors.html#Error">Error</a></span>(<span class="id"><a href="Errors.html#msg">msg</a></span> "<span class="id">bad</span> <span class="kwd">return</span> <span class="id">type</span> <span class="kwd">in</span> <span class="id">tailcall</span>")<br/>
&nbsp;&nbsp;| <span class="id"><a href="RTL.html#Ibuiltin">Ibuiltin</a></span> <span class="id">ef</span> <span class="id">args</span> <span class="id">res</span> <span class="id">s</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">sig</span> := <span class="id"><a href="AST.html#ef_sig">ef_sig</a></span> <span class="id">ef</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">x</span> &lt;- <span class="id"><a href="RTLtyping.html#check_successor">check_successor</a></span> <span class="id">s</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">e1</span> &lt;-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">ef</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="AST.html#EF_annot">EF_annot</a></span> <span class="id">_</span> <span class="id">_</span> | <span class="id"><a href="AST.html#EF_debug">EF_debug</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="RTLtyping.html#type_builtin_args">type_builtin_args</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id">args</span> <span class="id"><a href="RTLtyping.html#sig">sig</a></span>.(<span class="id"><a href="AST.html#sig_args">sig_args</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#type_builtin_res">type_builtin_res</a></span> <span class="id">e1</span> <span class="id">res</span> (<span class="id"><a href="AST.html#proj_sig_res">proj_sig_res</a></span> <span class="id"><a href="RTLtyping.html#sig">sig</a></span>)<br/>
&nbsp;| <span class="id"><a href="RTL.html#Icond">Icond</a></span> <span class="id">cond</span> <span class="id">args</span> <span class="id">s1</span> <span class="id">s2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">x1</span> &lt;- <span class="id"><a href="RTLtyping.html#check_successor">check_successor</a></span> <span class="id">s1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">x2</span> &lt;- <span class="id"><a href="RTLtyping.html#check_successor">check_successor</a></span> <span class="id">s2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#set_list">S.set_list</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id">args</span> (<span class="id"><a href="Op.html#type_of_condition">type_of_condition</a></span> <span class="id">cond</span>)<br/>
&nbsp;| <span class="id"><a href="RTL.html#Ijumptable">Ijumptable</a></span> <span class="id">arg</span> <span class="id">tbl</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">x</span> &lt;- <span class="id"><a href="RTLtyping.html#check_successors">check_successors</a></span> <span class="id">tbl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">e1</span> &lt;- <span class="id"><a href="RTLtyping.html#set">S.set</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id">arg</span> <span class="id"><a href="AST.html#Tint">Tint</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="Coqlib.html#zle">zle</a></span> (<span class="id"><a href="Coqlib.html#list_length_z">list_length_z</a></span> <span class="id">tbl</span> * 4) <span class="id"><a href="Integers.html#Int.max_unsigned">Int.max_unsigned</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id">e1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="Errors.html#Error">Error</a></span>(<span class="id"><a href="Errors.html#msg">msg</a></span> "<span class="id">jumptable</span> <span class="id">too</span> <span class="id">big</span>")<br/>
&nbsp;&nbsp;| <span class="id"><a href="RTL.html#Ireturn">Ireturn</a></span> <span class="id">optres</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">optres</span>, <span class="id"><a href="RTLtyping.html#INFERENCE.f">f</a></span>.(<span class="id"><a href="RTL.html#fn_sig">fn_sig</a></span>).(<span class="id"><a href="AST.html#sig_res">sig_res</a></span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">r</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">t</span> =&gt; <span class="id"><a href="RTLtyping.html#set">S.set</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id">r</span> <span class="id">t</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id"><a href="Errors.html#Error">Error</a></span>(<span class="id"><a href="Errors.html#msg">msg</a></span> "<span class="id">bad</span> <span class="kwd">return</span>")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="type_code">type_code</a></span> (<span class="id">e</span>: <span class="id"><a href="RTLtyping.html#typenv">S.typenv</a></span>): <span class="id"><a href="Errors.html#res">res</a></span> <span class="id"><a href="RTLtyping.html#typenv">S.typenv</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="Maps.html#PTree.fold">PTree.fold</a></span> (<span class="kwd">fun</span> <span class="id">re</span> <span class="id">pc</span> <span class="id">i</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="RTLtyping.html#re">re</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Errors.html#Error">Error</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="RTLtyping.html#re">re</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id">e</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="RTLtyping.html#type_instr">type_instr</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id"><a href="RTLtyping.html#i">i</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Errors.html#Error">Error</a></span> <span class="id">msg</span> =&gt; <span class="id"><a href="Errors.html#Error">Error</a></span>(<span class="id"><a href="Errors.html#MSG">MSG</a></span> "<span class="id">At</span> <span class="id">PC</span> " :: <span class="id"><a href="Errors.html#POS">POS</a></span> <span class="id"><a href="RTLtyping.html#pc">pc</a></span> :: <span class="id"><a href="Errors.html#MSG">MSG</a></span> ": " :: <span class="id">msg</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id">e</span>' =&gt; <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id">e</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>)<br/>
&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#INFERENCE.f">f</a></span>.(<span class="id"><a href="RTL.html#fn_code">fn_code</a></span>) (<span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span>).<br/>
<br/>
<div class="doc">Solve remaining constraints </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="check_params_norepet">check_params_norepet</a></span> (<span class="id">params</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Registers.html#reg">reg</a></span>): <span class="id"><a href="Errors.html#res">res</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="Coqlib.html#list_norepet_dec">list_norepet_dec</a></span> <span class="id"><a href="Registers.html#Reg.eq">Reg.eq</a></span> <span class="id"><a href="RTLtyping.html#params">params</a></span><br/>
&nbsp;&nbsp;<span class="kwd">then</span> <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span><br/>
&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="Errors.html#Error">Error</a></span>(<span class="id"><a href="Errors.html#msg">msg</a></span> "<span class="id">duplicate</span> <span class="id">parameters</span>").<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="type_function">type_function</a></span> : <span class="id"><a href="Errors.html#res">res</a></span> <span class="id"><a href="RTLtyping.html#regenv">regenv</a></span> :=<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">e1</span> &lt;- <span class="id"><a href="RTLtyping.html#type_code">type_code</a></span> <span class="id"><a href="RTLtyping.html#initial">S.initial</a></span>;<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">e2</span> &lt;- <span class="id"><a href="RTLtyping.html#set_list">S.set_list</a></span> <span class="id">e1</span> <span class="id"><a href="RTLtyping.html#INFERENCE.f">f</a></span>.(<span class="id"><a href="RTL.html#fn_params">fn_params</a></span>) <span class="id"><a href="RTLtyping.html#INFERENCE.f">f</a></span>.(<span class="id"><a href="RTL.html#fn_sig">fn_sig</a></span>).(<span class="id"><a href="AST.html#sig_args">sig_args</a></span>);<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">te</span> &lt;- <span class="id"><a href="RTLtyping.html#solve">S.solve</a></span> <span class="id">e2</span>;<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">x1</span> &lt;- <span class="id"><a href="RTLtyping.html#check_params_norepet">check_params_norepet</a></span> <span class="id"><a href="RTLtyping.html#INFERENCE.f">f</a></span>.(<span class="id"><a href="RTL.html#fn_params">fn_params</a></span>);<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">x2</span> &lt;- <span class="id"><a href="RTLtyping.html#check_successor">check_successor</a></span> <span class="id"><a href="RTLtyping.html#INFERENCE.f">f</a></span>.(<span class="id"><a href="RTL.html#fn_entrypoint">fn_entrypoint</a></span>);<br/>
&nbsp;&nbsp;<span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id">te</span>.<br/>
<br/>
<h2> Soundness proof </h2>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="type_ros_incr">type_ros_incr</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">e</span> <span class="id">ros</span> <span class="id">e</span>' <span class="id">te</span>, <span class="id"><a href="RTLtyping.html#type_ros">type_ros</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id"><a href="RTLtyping.html#ros">ros</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id">e</span>' -&gt; <span class="id"><a href="RTLtyping.html#satisf">S.satisf</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span> <span class="id">e</span>' -&gt; <span class="id"><a href="RTLtyping.html#satisf">S.satisf</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2669')">Proof.</div>
<div class="proofscript" id="proof2669">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="RTLtyping.html#type_ros">type_ros</a></span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">ros</span>. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">type_ros_incr</span>: <span class="id">ty</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="type_ros_sound">type_ros_sound</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">e</span> <span class="id">ros</span> <span class="id">e</span>' <span class="id">te</span>, <span class="id"><a href="RTLtyping.html#type_ros">type_ros</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id"><a href="RTLtyping.html#ros">ros</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id">e</span>' -&gt; <span class="id"><a href="RTLtyping.html#satisf">S.satisf</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span> <span class="id">e</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="RTLtyping.html#ros">ros</a></span> <span class="kwd">with</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inl">inl</a></span> <span class="id">r</span> =&gt; <span class="id"><a href="RTLtyping.html#te">te</a></span> <span class="id">r</span> = <span class="id"><a href="AST.html#Tptr">Tptr</a></span> | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inr">inr</a></span> <span class="id">s</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span> <span class="kwd">end</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2670')">Proof.</div>
<div class="proofscript" id="proof2670">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="RTLtyping.html#type_ros">type_ros</a></span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">ros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="RTLtyping.html#set_sound">S.set_sound</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="check_successor_sound">check_successor_sound</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">x</span>, <span class="id"><a href="RTLtyping.html#check_successor">check_successor</a></span> <span class="id"><a href="RTLtyping.html#s">s</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id"><a href="RTLtyping.html#x">x</a></span> -&gt; <span class="id"><a href="RTLtyping.html#valid_successor">valid_successor</a></span> <span class="id"><a href="RTLtyping.html#INFERENCE.f">f</a></span> <span class="id"><a href="RTLtyping.html#s">s</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2671')">Proof.</div>
<div class="proofscript" id="proof2671">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="RTLtyping.html#check_successor">check_successor</a></span>, <span class="id"><a href="RTLtyping.html#valid_successor">valid_successor</a></span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="RTL.html#fn_code">fn_code</a></span> <span class="id"><a href="RTLtyping.html#INFERENCE.f">f</a></span>)!<span class="id">s</span>; <span class="id">inv</span> <span class="id">H</span>. <span class="id">exists</span> <span class="id">i</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">check_successor_sound</span>: <span class="id">ty</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="check_successors_sound">check_successors_sound</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sl</span> <span class="id">x</span>, <span class="id"><a href="RTLtyping.html#check_successors">check_successors</a></span> <span class="id"><a href="RTLtyping.html#sl">sl</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id"><a href="RTLtyping.html#x">x</a></span> -&gt; <span class="kwd">forall</span> <span class="id">s</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="RTLtyping.html#s">s</a></span> <span class="id"><a href="RTLtyping.html#sl">sl</a></span> -&gt; <span class="id"><a href="RTLtyping.html#valid_successor">valid_successor</a></span> <span class="id"><a href="RTLtyping.html#INFERENCE.f">f</a></span> <span class="id"><a href="RTLtyping.html#s">s</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2672')">Proof.</div>
<div class="proofscript" id="proof2672">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">sl</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;<span class="id">monadInv</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H0</span>. <span class="tactic">subst</span> <span class="id">a</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>. <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="type_expect_incr">type_expect_incr</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">e</span> <span class="id">ty1</span> <span class="id">ty2</span> <span class="id">e</span>' <span class="id">te</span>, <span class="id"><a href="RTLtyping.html#type_expect">type_expect</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id"><a href="RTLtyping.html#ty1">ty1</a></span> <span class="id"><a href="RTLtyping.html#ty2">ty2</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id">e</span>' -&gt; <span class="id"><a href="RTLtyping.html#satisf">S.satisf</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span> <span class="id">e</span>' -&gt; <span class="id"><a href="RTLtyping.html#satisf">S.satisf</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2673')">Proof.</div>
<div class="proofscript" id="proof2673">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="RTLtyping.html#type_expect">type_expect</a></span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> (<span class="id"><a href="AST.html#typ_eq">typ_eq</a></span> <span class="id">ty1</span> <span class="id">ty2</span>); <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">type_expect_incr</span>: <span class="id">ty</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="type_expect_sound">type_expect_sound</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">e</span> <span class="id">ty1</span> <span class="id">ty2</span> <span class="id">e</span>', <span class="id"><a href="RTLtyping.html#type_expect">type_expect</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id"><a href="RTLtyping.html#ty1">ty1</a></span> <span class="id"><a href="RTLtyping.html#ty2">ty2</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id">e</span>' -&gt; <span class="id"><a href="RTLtyping.html#ty1">ty1</a></span> = <span class="id"><a href="RTLtyping.html#ty2">ty2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2674')">Proof.</div>
<div class="proofscript" id="proof2674">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="RTLtyping.html#type_expect">type_expect</a></span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> (<span class="id"><a href="AST.html#typ_eq">typ_eq</a></span> <span class="id">ty1</span> <span class="id">ty2</span>); <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="type_builtin_arg_incr">type_builtin_arg_incr</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">e</span> <span class="id">a</span> <span class="id">ty</span> <span class="id">e</span>' <span class="id">te</span>, <span class="id"><a href="RTLtyping.html#type_builtin_arg">type_builtin_arg</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id"><a href="RTLtyping.html#a">a</a></span> <span class="id"><a href="RTLtyping.html#ty">ty</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id">e</span>' -&gt; <span class="id"><a href="RTLtyping.html#satisf">S.satisf</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span> <span class="id">e</span>' -&gt; <span class="id"><a href="RTLtyping.html#satisf">S.satisf</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2675')">Proof.</div>
<div class="proofscript" id="proof2675">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="RTLtyping.html#type_builtin_arg">type_builtin_arg</a></span>; <span class="tactic">intros</span>; <span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="type_builtin_args_incr">type_builtin_args_incr</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">a</span> <span class="id">ty</span> <span class="id">e</span> <span class="id">e</span>' <span class="id">te</span>, <span class="id"><a href="RTLtyping.html#type_builtin_args">type_builtin_args</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id"><a href="RTLtyping.html#a">a</a></span> <span class="id"><a href="RTLtyping.html#ty">ty</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id">e</span>' -&gt; <span class="id"><a href="RTLtyping.html#satisf">S.satisf</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span> <span class="id">e</span>' -&gt; <span class="id"><a href="RTLtyping.html#satisf">S.satisf</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2676')">Proof.</div>
<div class="proofscript" id="proof2676">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">a</span>; <span class="tactic">destruct</span> <span class="id">ty</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">monadInv</span> <span class="id">H</span>. <span class="tactic">eapply</span> <span class="id"><a href="RTLtyping.html#type_builtin_arg_incr">type_builtin_arg_incr</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="type_builtin_res_incr">type_builtin_res_incr</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">e</span> <span class="id">a</span> <span class="id">ty</span> <span class="id">e</span>' <span class="id">te</span>, <span class="id"><a href="RTLtyping.html#type_builtin_res">type_builtin_res</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id"><a href="RTLtyping.html#a">a</a></span> <span class="id"><a href="RTLtyping.html#ty">ty</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id">e</span>' -&gt; <span class="id"><a href="RTLtyping.html#satisf">S.satisf</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span> <span class="id">e</span>' -&gt; <span class="id"><a href="RTLtyping.html#satisf">S.satisf</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2677')">Proof.</div>
<div class="proofscript" id="proof2677">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="RTLtyping.html#type_builtin_res">type_builtin_res</a></span>; <span class="tactic">intros</span>; <span class="tactic">destruct</span> <span class="id">a</span>; <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">type_builtin_args_incr</span> <span class="id">type_builtin_res_incr</span>: <span class="id">ty</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="type_builtin_arg_sound">type_builtin_arg_sound</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">e</span> <span class="id">a</span> <span class="id">ty</span> <span class="id">e</span>' <span class="id">te</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#type_builtin_arg">type_builtin_arg</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id"><a href="RTLtyping.html#a">a</a></span> <span class="id"><a href="RTLtyping.html#ty">ty</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id">e</span>' -&gt; <span class="id"><a href="RTLtyping.html#satisf">S.satisf</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span> <span class="id">e</span>' -&gt; <span class="id"><a href="RTLtyping.html#type_of_builtin_arg">type_of_builtin_arg</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span> <span class="id"><a href="RTLtyping.html#a">a</a></span> = <span class="id"><a href="RTLtyping.html#ty">ty</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2678')">Proof.</div>
<div class="proofscript" id="proof2678">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> (<span class="tactic">symmetry</span>; <span class="tactic">eapply</span> <span class="id"><a href="RTLtyping.html#type_expect_sound">type_expect_sound</a></span>; <span class="id">eassumption</span>).<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="RTLtyping.html#set_sound">S.set_sound</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="type_builtin_args_sound">type_builtin_args_sound</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">al</span> <span class="id">tyl</span> <span class="id">e</span> <span class="id">e</span>' <span class="id">te</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#type_builtin_args">type_builtin_args</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id"><a href="RTLtyping.html#al">al</a></span> <span class="id"><a href="RTLtyping.html#tyl">tyl</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id">e</span>' -&gt; <span class="id"><a href="RTLtyping.html#satisf">S.satisf</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span> <span class="id">e</span>' -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="id"><a href="RTLtyping.html#type_of_builtin_arg">type_of_builtin_arg</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span>) <span class="id"><a href="RTLtyping.html#al">al</a></span> = <span class="id"><a href="RTLtyping.html#tyl">tyl</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2679')">Proof.</div>
<div class="proofscript" id="proof2679">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">al</span> <span class="kwd">as</span> [|<span class="id">a</span> <span class="id">al</span>]; <span class="tactic">destruct</span> <span class="id">tyl</span> <span class="kwd">as</span> [|<span class="id">ty</span> <span class="id">tyl</span>]; <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
- <span class="tactic">auto</span>.<br/>
- <span class="id">monadInv</span> <span class="id">H</span>. <span class="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="RTLtyping.html#type_builtin_arg_sound">type_builtin_arg_sound</a></span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="type_builtin_res_sound">type_builtin_res_sound</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">e</span> <span class="id">a</span> <span class="id">ty</span> <span class="id">e</span>' <span class="id">te</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#type_builtin_res">type_builtin_res</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id"><a href="RTLtyping.html#a">a</a></span> <span class="id"><a href="RTLtyping.html#ty">ty</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id">e</span>' -&gt; <span class="id"><a href="RTLtyping.html#satisf">S.satisf</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span> <span class="id">e</span>' -&gt; <span class="id"><a href="RTLtyping.html#type_of_builtin_res">type_of_builtin_res</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span> <span class="id"><a href="RTLtyping.html#a">a</a></span> = <span class="id"><a href="RTLtyping.html#ty">ty</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2680')">Proof.</div>
<div class="proofscript" id="proof2680">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="RTLtyping.html#set_sound">S.set_sound</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">symmetry</span>; <span class="tactic">eapply</span> <span class="id"><a href="RTLtyping.html#type_expect_sound">type_expect_sound</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">symmetry</span>; <span class="tactic">eapply</span> <span class="id"><a href="RTLtyping.html#type_expect_sound">type_expect_sound</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="type_instr_incr">type_instr_incr</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">e</span> <span class="id">i</span> <span class="id">e</span>' <span class="id">te</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#type_instr">type_instr</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id"><a href="RTLtyping.html#i">i</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id">e</span>' -&gt; <span class="id"><a href="RTLtyping.html#satisf">S.satisf</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span> <span class="id">e</span>' -&gt; <span class="id"><a href="RTLtyping.html#satisf">S.satisf</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2681')">Proof.</div>
<div class="proofscript" id="proof2681">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">destruct</span> <span class="id">i</span>; <span class="tactic">try</span> (<span class="id">monadInv</span> <span class="id">H</span>); <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="comment">(*&nbsp;op&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="RTLtyping.html#is_move">is_move</a></span> <span class="id">o</span>) <span class="id">eqn</span>:<span class="id">ISMOVE</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>. <span class="tactic">destruct</span> <span class="id">l</span>; <span class="id">monadInv</span> <span class="id">EQ0</span>. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Op.html#type_of_operation">type_of_operation</a></span> <span class="id">o</span>) <span class="kwd">as</span> [<span class="id">targs</span> <span class="id">tres</span>] <span class="id">eqn</span>:<span class="id">TYOP</span>. <span class="id">monadInv</span> <span class="id">EQ0</span>. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="comment">(*&nbsp;tailcall&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="AST.html#opt_typ_eq">opt_typ_eq</a></span> (<span class="id"><a href="AST.html#sig_res">sig_res</a></span> <span class="id">s</span>) (<span class="id"><a href="AST.html#sig_res">sig_res</a></span> (<span class="id"><a href="RTL.html#fn_sig">fn_sig</a></span> <span class="id"><a href="RTLtyping.html#INFERENCE.f">f</a></span>))); <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Conventions.html#tailcall_is_possible">tailcall_is_possible</a></span> <span class="id">s</span>) <span class="id">eqn</span>:<span class="id">TCIP</span>; <span class="id">inv</span> <span class="id">EQ2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="comment">(*&nbsp;builtin&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">e0</span>; <span class="tactic">try</span> <span class="id">monadInv</span> <span class="id">EQ1</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="comment">(*&nbsp;jumptable&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zle">zle</a></span> (<span class="id"><a href="Coqlib.html#list_length_z">list_length_z</a></span> <span class="id">l</span> * 4) <span class="id"><a href="Integers.html#Int.max_unsigned">Int.max_unsigned</a></span>); <span class="id">inv</span> <span class="id">EQ2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="comment">(*&nbsp;return&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">o</span> <span class="kwd">as</span> [<span class="id">r</span>|] <span class="id">eqn</span>: <span class="id">RET</span>; <span class="tactic">destruct</span> (<span class="id"><a href="AST.html#sig_res">sig_res</a></span> (<span class="id"><a href="RTL.html#fn_sig">fn_sig</a></span> <span class="id"><a href="RTLtyping.html#INFERENCE.f">f</a></span>)) <span class="kwd">as</span> [<span class="id">t</span>|] <span class="id">eqn</span>: <span class="id">RES</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="type_instr_sound">type_instr_sound</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">e</span> <span class="id">i</span> <span class="id">e</span>' <span class="id">te</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#type_instr">type_instr</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id"><a href="RTLtyping.html#i">i</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id">e</span>' -&gt; <span class="id"><a href="RTLtyping.html#satisf">S.satisf</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span> <span class="id">e</span>' -&gt; <span class="id"><a href="RTLtyping.html#wt_instr">wt_instr</a></span> <span class="id"><a href="RTLtyping.html#INFERENCE.f">f</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span> <span class="id"><a href="RTLtyping.html#i">i</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2682')">Proof.</div>
<div class="proofscript" id="proof2682">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">destruct</span> <span class="id">i</span>; <span class="tactic">try</span> (<span class="id">monadInv</span> <span class="id">H</span>); <span class="tactic">simpl</span>.<br/>
- <span class="comment">(*&nbsp;nop&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="comment">(*&nbsp;op&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="RTLtyping.html#is_move">is_move</a></span> <span class="id">o</span>) <span class="id">eqn</span>:<span class="id">ISMOVE</span>.<br/>
&nbsp;move&nbsp;*)</span>&nbsp;&nbsp;+ <span class="tactic">assert</span> (<span class="id">o</span> = <span class="id"><a href="Op.html#Omove">Omove</a></span>) <span class="tactic">by</span> (<span class="tactic">unfold</span> <span class="id"><a href="RTLtyping.html#is_move">is_move</a></span> <span class="kwd">in</span> <span class="id">ISMOVE</span>; <span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">congruence</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">o</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>. <span class="tactic">destruct</span> <span class="id">l</span>; <span class="id">monadInv</span> <span class="id">EQ0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>. <span class="tactic">eapply</span> <span class="id"><a href="RTLtyping.html#move_sound">S.move_sound</a></span>; <span class="tactic">eauto</span>. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id"><a href="Op.html#type_of_operation">type_of_operation</a></span> <span class="id">o</span>) <span class="kwd">as</span> [<span class="id">targs</span> <span class="id">tres</span>] <span class="id">eqn</span>:<span class="id">TYOP</span>. <span class="id">monadInv</span> <span class="id">EQ0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="RTLtyping.html#wt_Iop">wt_Iop</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="RTLtyping.html#is_move">is_move</a></span> <span class="kwd">in</span> <span class="id">ISMOVE</span>; <span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">TYOP</span>. <span class="tactic">eapply</span> <span class="id"><a href="RTLtyping.html#set_list_sound">S.set_list_sound</a></span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">TYOP</span>. <span class="tactic">eapply</span> <span class="id"><a href="RTLtyping.html#set_sound">S.set_sound</a></span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="comment">(*&nbsp;load&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="RTLtyping.html#set_list_sound">S.set_list_sound</a></span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="RTLtyping.html#set_sound">S.set_sound</a></span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="comment">(*&nbsp;store&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="RTLtyping.html#set_list_sound">S.set_list_sound</a></span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="RTLtyping.html#set_sound">S.set_sound</a></span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="comment">(*&nbsp;call&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="RTLtyping.html#type_ros_sound">type_ros_sound</a></span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="RTLtyping.html#set_list_sound">S.set_list_sound</a></span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="RTLtyping.html#set_sound">S.set_sound</a></span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="comment">(*&nbsp;tailcall&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="AST.html#opt_typ_eq">opt_typ_eq</a></span> (<span class="id"><a href="AST.html#sig_res">sig_res</a></span> <span class="id">s</span>) (<span class="id"><a href="AST.html#sig_res">sig_res</a></span> (<span class="id"><a href="RTL.html#fn_sig">fn_sig</a></span> <span class="id"><a href="RTLtyping.html#INFERENCE.f">f</a></span>))); <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Conventions.html#tailcall_is_possible">tailcall_is_possible</a></span> <span class="id">s</span>) <span class="id">eqn</span>:<span class="id">TCIP</span>; <span class="id">inv</span> <span class="id">EQ2</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="RTLtyping.html#type_ros_sound">type_ros_sound</a></span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="RTLtyping.html#set_list_sound">S.set_list_sound</a></span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Conventions.html#tailcall_is_possible_correct">tailcall_is_possible_correct</a></span>; <span class="tactic">auto</span>.<br/>
- <span class="comment">(*&nbsp;builtin&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">e0</span>; <span class="tactic">auto</span>; <span class="tactic">eapply</span> <span class="id"><a href="RTLtyping.html#type_builtin_args_sound">type_builtin_args_sound</a></span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="RTLtyping.html#type_builtin_res_sound">type_builtin_res_sound</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="comment">(*&nbsp;cond&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="RTLtyping.html#set_list_sound">S.set_list_sound</a></span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
- <span class="comment">(*&nbsp;jumptable&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#zle">zle</a></span> (<span class="id"><a href="Coqlib.html#list_length_z">list_length_z</a></span> <span class="id">l</span> * 4) <span class="id"><a href="Integers.html#Int.max_unsigned">Int.max_unsigned</a></span>); <span class="id">inv</span> <span class="id">EQ2</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="RTLtyping.html#set_sound">S.set_sound</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="RTLtyping.html#check_successors_sound">check_successors_sound</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
- <span class="comment">(*&nbsp;return&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">o</span> <span class="kwd">as</span> [<span class="id">r</span>|] <span class="id">eqn</span>: <span class="id">RET</span>; <span class="tactic">destruct</span> (<span class="id"><a href="AST.html#sig_res">sig_res</a></span> (<span class="id"><a href="RTL.html#fn_sig">fn_sig</a></span> <span class="id"><a href="RTLtyping.html#INFERENCE.f">f</a></span>)) <span class="kwd">as</span> [<span class="id">t</span>|] <span class="id">eqn</span>: <span class="id">RES</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="RTLtyping.html#set_sound">S.set_sound</a></span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="id">constructor</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="type_code_sound">type_code_sound</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">pc</span> <span class="id">i</span> <span class="id">e</span> <span class="id">e</span>' <span class="id">te</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#type_code">type_code</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id">e</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#INFERENCE.f">f</a></span>.(<span class="id"><a href="RTL.html#fn_code">fn_code</a></span>)!<span class="id"><a href="RTLtyping.html#pc">pc</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="RTLtyping.html#i">i</a></span> -&gt; <span class="id"><a href="RTLtyping.html#satisf">S.satisf</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span> <span class="id">e</span>' -&gt; <span class="id"><a href="RTLtyping.html#wt_instr">wt_instr</a></span> <span class="id"><a href="RTLtyping.html#INFERENCE.f">f</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span> <span class="id"><a href="RTLtyping.html#i">i</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2683')">Proof.</div>
<div class="proofscript" id="proof2683">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">pc</span> <span class="id">i</span> <span class="id">e0</span> <span class="id">e1</span> <span class="id">te</span> <span class="id">TCODE</span>.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">P</span> := <span class="kwd">fun</span> <span class="id">c</span> <span class="id">opte</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="RTLtyping.html#opte">opte</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Errors.html#Error">Error</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id">e</span>' =&gt; <span class="id"><a href="RTLtyping.html#c">c</a></span>!<span class="id">pc</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">i</span> -&gt; <span class="id"><a href="RTLtyping.html#satisf">S.satisf</a></span> <span class="id">te</span> <span class="id">e</span>' -&gt; <span class="id"><a href="RTLtyping.html#wt_instr">wt_instr</a></span> <span class="id"><a href="RTLtyping.html#INFERENCE.f">f</a></span> <span class="id">te</span> <span class="id">i</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>).<br/>
&nbsp;&nbsp;<span class="id">change</span> (<span class="id">P</span> <span class="id"><a href="RTLtyping.html#INFERENCE.f">f</a></span>.(<span class="id"><a href="RTL.html#fn_code">fn_code</a></span>) (<span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id">e1</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">TCODE</span>. <span class="tactic">unfold</span> <span class="id"><a href="RTLtyping.html#type_code">type_code</a></span>. <span class="tactic">apply</span> <span class="id"><a href="Maps.html#PTree_Properties.fold_rec">PTree_Properties.fold_rec</a></span>; <span class="tactic">unfold</span> <span class="id">P</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;extensionality&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">auto</span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">eapply</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;base&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PTree.gempty">PTree.gempty</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;inductive&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span> <span class="kwd">as</span> [<span class="id">e</span>|?]; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="RTLtyping.html#type_instr">type_instr</a></span> <span class="id">e</span> <span class="id">v</span>) <span class="kwd">as</span> [<span class="id">e</span>'|?] <span class="id">eqn</span>:<span class="id">TYINSTR</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PTree.gsspec">PTree.gsspec</a></span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">pc</span> <span class="id">k</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>. <span class="tactic">eapply</span> <span class="id"><a href="RTLtyping.html#type_instr_sound">type_instr_sound</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H1</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="RTLtyping.html#type_instr_incr">type_instr_incr</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="type_function_correct">type_function_correct</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span>, <span class="id"><a href="RTLtyping.html#type_function">type_function</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id"><a href="RTLtyping.html#env">env</a></span> -&gt; <span class="id"><a href="RTLtyping.html#wt_function">wt_function</a></span> <span class="id"><a href="RTLtyping.html#INFERENCE.f">f</a></span> <span class="id"><a href="RTLtyping.html#env">env</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2684')">Proof.</div>
<div class="proofscript" id="proof2684">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="RTLtyping.html#type_function">type_function</a></span>; <span class="tactic">intros</span>. <span class="id">monadInv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">SAT0</span>: <span class="id"><a href="RTLtyping.html#satisf">S.satisf</a></span> <span class="id">env</span> <span class="id">x0</span>) <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id"><a href="RTLtyping.html#solve_sound">S.solve_sound</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">SAT1</span>: <span class="id"><a href="RTLtyping.html#satisf">S.satisf</a></span> <span class="id">env</span> <span class="id">x</span>) <span class="tactic">by</span> (<span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>).<br/>
&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
- <span class="comment">(*&nbsp;type&nbsp;of&nbsp;parameters&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="RTLtyping.html#set_list_sound">S.set_list_sound</a></span>; <span class="tactic">eauto</span>.<br/>
- <span class="comment">(*&nbsp;parameters&nbsp;are&nbsp;unique&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="RTLtyping.html#check_params_norepet">check_params_norepet</a></span> <span class="kwd">in</span> <span class="id">EQ2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#list_norepet_dec">list_norepet_dec</a></span> <span class="id"><a href="Registers.html#Reg.eq">Reg.eq</a></span> (<span class="id"><a href="RTL.html#fn_params">fn_params</a></span> <span class="id"><a href="RTLtyping.html#INFERENCE.f">f</a></span>)); <span class="id">inv</span> <span class="id">EQ2</span>; <span class="tactic">auto</span>.<br/>
- <span class="comment">(*&nbsp;instructions&nbsp;are&nbsp;well&nbsp;typed&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id"><a href="RTLtyping.html#type_code_sound">type_code_sound</a></span>; <span class="tactic">eauto</span>.<br/>
- <span class="comment">(*&nbsp;entry&nbsp;point&nbsp;is&nbsp;valid&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<h2> Completeness proof </h2>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="type_ros_complete">type_ros_complete</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">te</span> <span class="id">ros</span> <span class="id">e</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#satisf">S.satisf</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="RTLtyping.html#ros">ros</a></span> <span class="kwd">with</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inl">inl</a></span> <span class="id">r</span> =&gt; <span class="id"><a href="RTLtyping.html#te">te</a></span> <span class="id">r</span> = <span class="id"><a href="AST.html#Tptr">Tptr</a></span> | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inr">inr</a></span> <span class="id">s</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span> <span class="kwd">end</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">e</span>', <span class="id"><a href="RTLtyping.html#type_ros">type_ros</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id"><a href="RTLtyping.html#ros">ros</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id">e</span>' /\ <span class="id"><a href="RTLtyping.html#satisf">S.satisf</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span> <span class="id">e</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2685')">Proof.</div>
<div class="proofscript" id="proof2685">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">destruct</span> <span class="id">ros</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="RTLtyping.html#set_complete">S.set_complete</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">e</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="check_successor_complete">check_successor_complete</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span>, <span class="id"><a href="RTLtyping.html#valid_successor">valid_successor</a></span> <span class="id"><a href="RTLtyping.html#INFERENCE.f">f</a></span> <span class="id"><a href="RTLtyping.html#s">s</a></span> -&gt; <span class="id"><a href="RTLtyping.html#check_successor">check_successor</a></span> <span class="id"><a href="RTLtyping.html#s">s</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2686')">Proof.</div>
<div class="proofscript" id="proof2686">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="RTLtyping.html#valid_successor">valid_successor</a></span>, <span class="id"><a href="RTLtyping.html#check_successor">check_successor</a></span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">i</span> <span class="id">EQ</span>]; <span class="tactic">rewrite</span> <span class="id">EQ</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="type_expect_complete">type_expect_complete</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">e</span> <span class="id">ty</span>, <span class="id"><a href="RTLtyping.html#type_expect">type_expect</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id"><a href="RTLtyping.html#ty">ty</a></span> <span class="id"><a href="RTLtyping.html#ty">ty</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2687')">Proof.</div>
<div class="proofscript" id="proof2687">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="RTLtyping.html#type_expect">type_expect</a></span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Coqlib.html#dec_eq_true">dec_eq_true</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="type_builtin_arg_complete">type_builtin_arg_complete</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">te</span> <span class="id">a</span> <span class="id">e</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#satisf">S.satisf</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">e</span>', <span class="id"><a href="RTLtyping.html#type_builtin_arg">type_builtin_arg</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id"><a href="RTLtyping.html#a">a</a></span> (<span class="id"><a href="RTLtyping.html#type_of_builtin_arg">type_of_builtin_arg</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span> <span class="id"><a href="RTLtyping.html#a">a</a></span>) = <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id">e</span>' /\ <span class="id"><a href="RTLtyping.html#satisf">S.satisf</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span> <span class="id">e</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2688')">Proof.</div>
<div class="proofscript" id="proof2688">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> (<span class="id">exists</span> <span class="id">e</span>; <span class="tactic">split</span>; [<span class="tactic">apply</span> <span class="id"><a href="RTLtyping.html#type_expect_complete">type_expect_complete</a></span>|<span class="tactic">assumption</span>]).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="RTLtyping.html#set_complete">S.set_complete</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="type_builtin_args_complete">type_builtin_args_complete</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">te</span> <span class="id">al</span> <span class="id">e</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#satisf">S.satisf</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">e</span>', <span class="id"><a href="RTLtyping.html#type_builtin_args">type_builtin_args</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id"><a href="RTLtyping.html#al">al</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="id"><a href="RTLtyping.html#type_of_builtin_arg">type_of_builtin_arg</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span>) <span class="id"><a href="RTLtyping.html#al">al</a></span>) = <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id">e</span>' /\ <span class="id"><a href="RTLtyping.html#satisf">S.satisf</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span> <span class="id">e</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2689')">Proof.</div>
<div class="proofscript" id="proof2689">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">al</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
- <span class="id">exists</span> <span class="id">e</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id"><a href="RTLtyping.html#type_builtin_arg_complete">type_builtin_arg_complete</a></span> <span class="id">te</span> <span class="id">a</span> <span class="id">e</span>) <span class="kwd">as</span> (<span class="id">e1</span> &amp; <span class="id">A</span> &amp; <span class="id">B</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">IHal</span> <span class="id">e1</span>) <span class="kwd">as</span> (<span class="id">e2</span> &amp; <span class="id">C</span> &amp; <span class="id">D</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">e2</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">rewrite</span> <span class="id">A</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="type_builtin_res_complete">type_builtin_res_complete</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">te</span> <span class="id">a</span> <span class="id">e</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#satisf">S.satisf</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">e</span>', <span class="id"><a href="RTLtyping.html#type_builtin_res">type_builtin_res</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id"><a href="RTLtyping.html#a">a</a></span> (<span class="id"><a href="RTLtyping.html#type_of_builtin_res">type_of_builtin_res</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span> <span class="id"><a href="RTLtyping.html#a">a</a></span>) = <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id">e</span>' /\ <span class="id"><a href="RTLtyping.html#satisf">S.satisf</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span> <span class="id">e</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2690')">Proof.</div>
<div class="proofscript" id="proof2690">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="RTLtyping.html#set_complete">S.set_complete</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">e</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">e</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="type_instr_complete">type_instr_complete</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">te</span> <span class="id">e</span> <span class="id">i</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#satisf">S.satisf</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_instr">wt_instr</a></span> <span class="id"><a href="RTLtyping.html#INFERENCE.f">f</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span> <span class="id"><a href="RTLtyping.html#i">i</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">e</span>', <span class="id"><a href="RTLtyping.html#type_instr">type_instr</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> <span class="id"><a href="RTLtyping.html#i">i</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id">e</span>' /\ <span class="id"><a href="RTLtyping.html#satisf">S.satisf</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span> <span class="id">e</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2691')">Proof.</div>
<div class="proofscript" id="proof2691">
&nbsp;&nbsp;<span class="tactic">induction</span> 2; <span class="tactic">simpl</span>.<br/>
- <span class="comment">(*&nbsp;nop&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>. <span class="tactic">rewrite</span> <span class="id"><a href="RTLtyping.html#check_successor_complete">check_successor_complete</a></span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>. <span class="tactic">auto</span>.<br/>
- <span class="comment">(*&nbsp;move&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="RTLtyping.html#move_complete">S.move_complete</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">changed</span> &amp; <span class="id">e</span>' &amp; <span class="id">A</span> &amp; <span class="id">B</span>).<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">e</span>'; <span class="tactic">split</span>. <span class="tactic">rewrite</span> <span class="id"><a href="RTLtyping.html#check_successor_complete">check_successor_complete</a></span> <span class="tactic">by</span> <span class="tactic">auto</span>; <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">A</span>; <span class="tactic">auto</span>. <span class="tactic">auto</span>.<br/>
- <span class="comment">(*&nbsp;other&nbsp;op&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Op.html#type_of_operation">type_of_operation</a></span> <span class="id">op</span>) <span class="kwd">as</span> [<span class="id">targ</span> <span class="id">tres</span>]. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="RTLtyping.html#set_list_complete">S.set_list_complete</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">e1</span> [<span class="id">A</span> <span class="id">B</span>]].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="RTLtyping.html#set_complete">S.set_complete</a></span>. <span class="id">eexact</span> <span class="id">B</span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">e2</span> [<span class="id">C</span> <span class="id">D</span>]].<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">e2</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="RTLtyping.html#check_successor_complete">check_successor_complete</a></span> <span class="tactic">by</span> <span class="tactic">auto</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id"><a href="RTLtyping.html#is_move">is_move</a></span> <span class="id">op</span>) <span class="kwd">with</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>. <span class="tactic">rewrite</span> <span class="id">A</span>; <span class="tactic">simpl</span>; <span class="tactic">rewrite</span> <span class="id">C</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">op</span>; <span class="tactic">reflexivity</span> || <span class="tactic">congruence</span>.<br/>
- <span class="comment">(*&nbsp;load&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="RTLtyping.html#set_list_complete">S.set_list_complete</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">e1</span> [<span class="id">A</span> <span class="id">B</span>]].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="RTLtyping.html#set_complete">S.set_complete</a></span>. <span class="id">eexact</span> <span class="id">B</span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">e2</span> [<span class="id">C</span> <span class="id">D</span>]].<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">e2</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="RTLtyping.html#check_successor_complete">check_successor_complete</a></span> <span class="tactic">by</span> <span class="tactic">auto</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">A</span>; <span class="tactic">simpl</span>; <span class="tactic">rewrite</span> <span class="id">C</span>; <span class="tactic">auto</span>.<br/>
- <span class="comment">(*&nbsp;store&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="RTLtyping.html#set_list_complete">S.set_list_complete</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">e1</span> [<span class="id">A</span> <span class="id">B</span>]].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="RTLtyping.html#set_complete">S.set_complete</a></span>. <span class="id">eexact</span> <span class="id">B</span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">e2</span> [<span class="id">C</span> <span class="id">D</span>]].<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">e2</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="RTLtyping.html#check_successor_complete">check_successor_complete</a></span> <span class="tactic">by</span> <span class="tactic">auto</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">A</span>; <span class="tactic">simpl</span>; <span class="tactic">rewrite</span> <span class="id">C</span>; <span class="tactic">auto</span>.<br/>
- <span class="comment">(*&nbsp;call&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="RTLtyping.html#type_ros_complete">type_ros_complete</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">e1</span> [<span class="id">A</span> <span class="id">B</span>]].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="RTLtyping.html#set_list_complete">S.set_list_complete</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">e2</span> [<span class="id">C</span> <span class="id">D</span>]].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="RTLtyping.html#set_complete">S.set_complete</a></span>. <span class="id">eexact</span> <span class="id">D</span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">e3</span> [<span class="id">E</span> <span class="id">F</span>]].<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">e3</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="RTLtyping.html#check_successor_complete">check_successor_complete</a></span> <span class="tactic">by</span> <span class="tactic">auto</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">A</span>; <span class="tactic">simpl</span>; <span class="tactic">rewrite</span> <span class="id">C</span>; <span class="tactic">simpl</span>; <span class="tactic">rewrite</span> <span class="id">E</span>; <span class="tactic">auto</span>.<br/>
- <span class="comment">(*&nbsp;tailcall&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="RTLtyping.html#type_ros_complete">type_ros_complete</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">e1</span> [<span class="id">A</span> <span class="id">B</span>]].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="RTLtyping.html#set_list_complete">S.set_list_complete</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">e2</span> [<span class="id">C</span> <span class="id">D</span>]].<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">e2</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">A</span>; <span class="tactic">simpl</span>; <span class="tactic">rewrite</span> <span class="id">C</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span>; <span class="tactic">rewrite</span> <span class="id"><a href="Coqlib.html#dec_eq_true">dec_eq_true</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id"><a href="Conventions.html#tailcall_is_possible">tailcall_is_possible</a></span> <span class="id">sig</span>) <span class="kwd">with</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">symmetry</span>. <span class="tactic">unfold</span> <span class="id"><a href="Conventions.html#tailcall_is_possible">tailcall_is_possible</a></span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#forallb_forall">forallb_forall</a></span>. <br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">H3</span> <span class="kwd">in</span> <span class="id">H4</span>. <span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">intuition</span> <span class="tactic">auto</span>.<br/>
- <span class="comment">(*&nbsp;builtin&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="RTLtyping.html#type_builtin_args_complete">type_builtin_args_complete</a></span>; <span class="tactic">eauto</span>. <span class="id">instantiate</span> (1 := <span class="id">args</span>). <span class="tactic">intros</span> [<span class="id">e1</span> [<span class="id">A</span> <span class="id">B</span>]].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="RTLtyping.html#type_builtin_res_complete">type_builtin_res_complete</a></span>; <span class="tactic">eauto</span>. <span class="id">instantiate</span> (1 := <span class="id">res</span>). <span class="tactic">intros</span> [<span class="id">e2</span> [<span class="id">C</span> <span class="id">D</span>]].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="RTLtyping.html#type_builtin_res_complete">type_builtin_res_complete</a></span>. <span class="id">eexact</span> <span class="id">H</span>. <span class="id">instantiate</span> (1 := <span class="id">res</span>). <span class="tactic">intros</span> [<span class="id">e3</span> [<span class="id">E</span> <span class="id">F</span>]].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="RTLtyping.html#check_successor_complete">check_successor_complete</a></span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="kwd">match</span> <span class="id">ef</span> <span class="kwd">with</span> <span class="id"><a href="AST.html#EF_annot">EF_annot</a></span> <span class="id">_</span> <span class="id">_</span> | <span class="id"><a href="AST.html#EF_debug">EF_debug</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">e3</span> | <span class="id">_</span> =&gt; <span class="id">e2</span> <span class="kwd">end</span>); <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">C</span>, <span class="id">E</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">ef</span>; <span class="tactic">try</span> (<span class="tactic">rewrite</span> &lt;- <span class="id">H0</span>; <span class="tactic">rewrite</span> <span class="id">A</span>); <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">ef</span>; <span class="tactic">auto</span>.<br/>
- <span class="comment">(*&nbsp;cond&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="RTLtyping.html#set_list_complete">S.set_list_complete</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">e1</span> [<span class="id">A</span> <span class="id">B</span>]].<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">e1</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="RTLtyping.html#check_successor_complete">check_successor_complete</a></span> <span class="tactic">by</span> <span class="tactic">auto</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="RTLtyping.html#check_successor_complete">check_successor_complete</a></span> <span class="tactic">by</span> <span class="tactic">auto</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
- <span class="comment">(*&nbsp;jumptbl&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="RTLtyping.html#set_complete">S.set_complete</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">e1</span> [<span class="id">A</span> <span class="id">B</span>]].<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">e1</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id"><a href="RTLtyping.html#check_successors">check_successors</a></span> <span class="id">tbl</span>) <span class="kwd">with</span> (<span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span>). <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">A</span>; <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="Coqlib.html#zle_true">zle_true</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H1</span>. <span class="tactic">generalize</span> <span class="id">tbl</span>. <span class="tactic">induction</span> <span class="id">tbl0</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="RTLtyping.html#check_successor_complete">check_successor_complete</a></span> <span class="tactic">by</span> <span class="tactic">auto</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHtbl0</span>; <span class="tactic">intros</span>; <span class="tactic">auto</span>.<br/>
- <span class="comment">(*&nbsp;return&nbsp;none&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span>. <span class="id">exists</span> <span class="id">e</span>; <span class="tactic">auto</span>.<br/>
- <span class="comment">(*&nbsp;return&nbsp;some&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span>. <span class="tactic">apply</span> <span class="id"><a href="RTLtyping.html#set_complete">S.set_complete</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="type_code_complete">type_code_complete</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">te</span> <span class="id">e</span>,<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">pc</span> <span class="id">instr</span>, <span class="id"><a href="RTLtyping.html#INFERENCE.f">f</a></span>.(<span class="id"><a href="RTL.html#fn_code">fn_code</a></span>)!<span class="id"><a href="RTLtyping.html#pc">pc</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="RTLtyping.html#instr">instr</a></span> -&gt; <span class="id"><a href="RTLtyping.html#wt_instr">wt_instr</a></span> <span class="id"><a href="RTLtyping.html#INFERENCE.f">f</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span> <span class="id"><a href="RTLtyping.html#instr">instr</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#satisf">S.satisf</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">e</span>', <span class="id"><a href="RTLtyping.html#type_code">type_code</a></span> <span class="id"><a href="RTLtyping.html#e">e</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id">e</span>' /\ <span class="id"><a href="RTLtyping.html#satisf">S.satisf</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span> <span class="id">e</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2692')">Proof.</div>
<div class="proofscript" id="proof2692">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">te</span> <span class="id">e0</span> <span class="id">WTC</span> <span class="id">SAT0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">P</span> := <span class="kwd">fun</span> <span class="id">c</span> <span class="id">res</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">pc</span> <span class="id">i</span>, <span class="id"><a href="RTLtyping.html#c">c</a></span>!<span class="id"><a href="RTLtyping.html#pc">pc</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="RTLtyping.html#i">i</a></span> -&gt; <span class="id"><a href="RTLtyping.html#wt_instr">wt_instr</a></span> <span class="id"><a href="RTLtyping.html#INFERENCE.f">f</a></span> <span class="id">te</span> <span class="id"><a href="RTLtyping.html#i">i</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">e</span>', <span class="id"><a href="RTLtyping.html#res">res</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id">e</span>' /\ <span class="id"><a href="RTLtyping.html#satisf">S.satisf</a></span> <span class="id">te</span> <span class="id">e</span>').<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">P</span> <span class="id"><a href="RTLtyping.html#INFERENCE.f">f</a></span>.(<span class="id"><a href="RTL.html#fn_code">fn_code</a></span>) (<span class="id"><a href="RTLtyping.html#type_code">type_code</a></span> <span class="id">e0</span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="RTLtyping.html#type_code">type_code</a></span>. <span class="tactic">apply</span> <span class="id"><a href="Maps.html#PTree_Properties.fold_rec">PTree_Properties.fold_rec</a></span>; <span class="tactic">unfold</span> <span class="id">P</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">H0</span>. <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">H1</span> <span class="kwd">with</span> <span class="id">pc</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">exists</span> <span class="id">e0</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">e</span> [<span class="id">A</span> <span class="id">B</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">H2</span> <span class="kwd">with</span> <span class="id">pc</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PTree.gso">PTree.gso</a></span>; <span class="tactic">auto</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="RTLtyping.html#type_instr_complete">type_instr_complete</a></span> <span class="id">te</span> <span class="id">e</span> <span class="id">v</span>) <span class="kwd">as</span> [<span class="id">e</span>' [<span class="id">C</span> <span class="id">D</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">H2</span> <span class="kwd">with</span> <span class="id">k</span>. <span class="tactic">apply</span> <span class="id"><a href="Maps.html#PTree.gss">PTree.gss</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">e</span>'; <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">rewrite</span> <span class="id">C</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="type_function_complete">type_function_complete</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">te</span>, <span class="id"><a href="RTLtyping.html#wt_function">wt_function</a></span> <span class="id"><a href="RTLtyping.html#INFERENCE.f">f</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span> -&gt; <span class="id">exists</span> <span class="id">te</span>, <span class="id"><a href="RTLtyping.html#type_function">type_function</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id"><a href="RTLtyping.html#te">te</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2693')">Proof.</div>
<div class="proofscript" id="proof2693">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="RTLtyping.html#type_code_complete">type_code_complete</a></span> <span class="id">te</span> <span class="id"><a href="RTLtyping.html#initial">S.initial</a></span>) <span class="kwd">as</span> (<span class="id">e1</span> &amp; <span class="id">A</span> &amp; <span class="id">B</span>).<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="RTLtyping.html#satisf_initial">S.satisf_initial</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="RTLtyping.html#set_list_complete">S.set_list_complete</a></span> <span class="id">te</span> <span class="id"><a href="RTLtyping.html#INFERENCE.f">f</a></span>.(<span class="id"><a href="RTL.html#fn_params">fn_params</a></span>) <span class="id"><a href="RTLtyping.html#INFERENCE.f">f</a></span>.(<span class="id"><a href="RTL.html#fn_sig">fn_sig</a></span>).(<span class="id"><a href="AST.html#sig_args">sig_args</a></span>) <span class="id">e1</span>) <span class="kwd">as</span> (<span class="id">e2</span> &amp; <span class="id">C</span> &amp; <span class="id">D</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="RTLtyping.html#solve_complete">S.solve_complete</a></span> <span class="id">te</span> <span class="id">e2</span>) <span class="kwd">as</span> (<span class="id">te</span>' &amp; <span class="id">E</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">te</span>'; <span class="tactic">unfold</span> <span class="id"><a href="RTLtyping.html#type_function">type_function</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">A</span>; <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">C</span>; <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">E</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="RTLtyping.html#check_params_norepet">check_params_norepet</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="Coqlib.html#pred_dec_true">pred_dec_true</a></span>; <span class="tactic">auto</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="RTLtyping.html#check_successor_complete">check_successor_complete</a></span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="RTLtyping.html#INFERENCE">INFERENCE</a></span>.<br/>
<br/>
<h1> Type preservation during evaluation </h1>
<br/>
<div class="doc">The type system for RTL is not sound in that it does not guarantee
  progress: well-typed instructions such as <span class="bracket"><span class="id">Icall</span></span> can fail because
  of run-time type tests (such as the equality between callee and caller's
  signatures).  However, the type system guarantees a type preservation
  property: if the execution does not fail because of a failed run-time
  test, the result values and register states match the static
  typing assumptions.  This preservation property will be useful
  later for the proof of semantic equivalence between <span class="bracket"><span class="id">Linear</span></span> and <span class="bracket"><span class="id">Mach</span></span>.
  Even though we do not need it for <span class="bracket"><span class="id">RTL</span></span>, we show preservation for <span class="bracket"><span class="id">RTL</span></span>
  here, as a warm-up exercise and because some of the lemmas will be
  useful later. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="wt_regset">wt_regset</a></span> (<span class="id">env</span>: <span class="id"><a href="RTLtyping.html#regenv">regenv</a></span>) (<span class="id">rs</span>: <span class="id"><a href="RTL.html#regset">regset</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r</span>, <span class="id"><a href="Values.html#Val.has_type">Val.has_type</a></span> (<span class="id"><a href="RTLtyping.html#rs">rs</a></span>#<span class="id"><a href="RTLtyping.html#r">r</a></span>) (<span class="id"><a href="RTLtyping.html#env">env</a></span> <span class="id"><a href="RTLtyping.html#r">r</a></span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="wt_regset_assign">wt_regset_assign</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span> <span class="id">rs</span> <span class="id">v</span> <span class="id">r</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_regset">wt_regset</a></span> <span class="id"><a href="RTLtyping.html#env">env</a></span> <span class="id"><a href="RTLtyping.html#rs">rs</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="Values.html#Val.has_type">Val.has_type</a></span> <span class="id"><a href="RTLtyping.html#v">v</a></span> (<span class="id"><a href="RTLtyping.html#env">env</a></span> <span class="id"><a href="RTLtyping.html#r">r</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_regset">wt_regset</a></span> <span class="id"><a href="RTLtyping.html#env">env</a></span> (<span class="id"><a href="RTLtyping.html#rs">rs</a></span>#<span class="id"><a href="RTLtyping.html#r">r</a></span> &lt;- <span class="id"><a href="RTLtyping.html#v">v</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2694')">Proof.</div>
<div class="proofscript" id="proof2694">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Registers.html#Regmap.gsspec">Regmap.gsspec</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">case</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">r0</span> <span class="id">r</span>); <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">r0</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="wt_regset_list">wt_regset_list</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span> <span class="id">rs</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_regset">wt_regset</a></span> <span class="id"><a href="RTLtyping.html#env">env</a></span> <span class="id"><a href="RTLtyping.html#rs">rs</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">rl</span>, <span class="id"><a href="Values.html#Val.has_type_list">Val.has_type_list</a></span> (<span class="id"><a href="RTLtyping.html#rs">rs</a></span>##<span class="id"><a href="RTLtyping.html#rl">rl</a></span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="RTLtyping.html#env">env</a></span> <span class="id"><a href="RTLtyping.html#rl">rl</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2695')">Proof.</div>
<div class="proofscript" id="proof2695">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">rl</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">apply</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id">IHrl</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="wt_regset_setres">wt_regset_setres</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span> <span class="id">rs</span> <span class="id">v</span> <span class="id">res</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_regset">wt_regset</a></span> <span class="id"><a href="RTLtyping.html#env">env</a></span> <span class="id"><a href="RTLtyping.html#rs">rs</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="Values.html#Val.has_type">Val.has_type</a></span> <span class="id"><a href="RTLtyping.html#v">v</a></span> (<span class="id"><a href="RTLtyping.html#type_of_builtin_res">type_of_builtin_res</a></span> <span class="id"><a href="RTLtyping.html#env">env</a></span> <span class="id"><a href="RTLtyping.html#res">res</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_regset">wt_regset</a></span> <span class="id"><a href="RTLtyping.html#env">env</a></span> (<span class="id"><a href="Registers.html#regmap_setres">regmap_setres</a></span> <span class="id"><a href="RTLtyping.html#res">res</a></span> <span class="id"><a href="RTLtyping.html#v">v</a></span> <span class="id"><a href="RTLtyping.html#rs">rs</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2696')">Proof.</div>
<div class="proofscript" id="proof2696">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">res</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="RTLtyping.html#wt_regset_assign">wt_regset_assign</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="wt_init_regs">wt_init_regs</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span> <span class="id">rl</span> <span class="id">args</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="Values.html#Val.has_type_list">Val.has_type_list</a></span> <span class="id"><a href="RTLtyping.html#args">args</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="RTLtyping.html#env">env</a></span> <span class="id"><a href="RTLtyping.html#rl">rl</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_regset">wt_regset</a></span> <span class="id"><a href="RTLtyping.html#env">env</a></span> (<span class="id"><a href="RTL.html#init_regs">init_regs</a></span> <span class="id"><a href="RTLtyping.html#args">args</a></span> <span class="id"><a href="RTLtyping.html#rl">rl</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2697')">Proof.</div>
<div class="proofscript" id="proof2697">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">rl</span>; <span class="tactic">destruct</span> <span class="id">args</span>; <span class="tactic">simpl</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Registers.html#Regmap.gi">Regmap.gi</a></span>. <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="RTLtyping.html#wt_regset_assign">wt_regset_assign</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="wt_exec_Iop">wt_exec_Iop</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">ge</span>: <span class="id"><a href="RTL.html#genv">genv</a></span>) <span class="id">env</span> <span class="id">f</span> <span class="id">sp</span> <span class="id">op</span> <span class="id">args</span> <span class="id">res</span> <span class="id">s</span> <span class="id">rs</span> <span class="id">m</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_instr">wt_instr</a></span> <span class="id"><a href="RTLtyping.html#f">f</a></span> <span class="id"><a href="RTLtyping.html#env">env</a></span> (<span class="id"><a href="RTL.html#Iop">Iop</a></span> <span class="id"><a href="RTLtyping.html#op">op</a></span> <span class="id"><a href="RTLtyping.html#args">args</a></span> <span class="id"><a href="RTLtyping.html#res">res</a></span> <span class="id"><a href="RTLtyping.html#s">s</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="Op.html#eval_operation">eval_operation</a></span> <span class="id"><a href="RTLtyping.html#ge">ge</a></span> <span class="id"><a href="RTLtyping.html#sp">sp</a></span> <span class="id"><a href="RTLtyping.html#op">op</a></span> <span class="id"><a href="RTLtyping.html#rs">rs</a></span>##<span class="id"><a href="RTLtyping.html#args">args</a></span> <span class="id"><a href="RTLtyping.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="RTLtyping.html#v">v</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_regset">wt_regset</a></span> <span class="id"><a href="RTLtyping.html#env">env</a></span> <span class="id"><a href="RTLtyping.html#rs">rs</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_regset">wt_regset</a></span> <span class="id"><a href="RTLtyping.html#env">env</a></span> (<span class="id"><a href="RTLtyping.html#rs">rs</a></span>#<span class="id"><a href="RTLtyping.html#res">res</a></span> &lt;- <span class="id"><a href="RTLtyping.html#v">v</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2698')">Proof.</div>
<div class="proofscript" id="proof2698">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">inv</span> <span class="id">H0</span>. <span class="tactic">apply</span> <span class="id"><a href="RTLtyping.html#wt_regset_assign">wt_regset_assign</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H4</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="RTLtyping.html#wt_regset_assign">wt_regset_assign</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H8</span>. <span class="tactic">eapply</span> <span class="id"><a href="Op.html#type_of_operation_sound">type_of_operation_sound</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="wt_exec_Iload">wt_exec_Iload</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span> <span class="id">f</span> <span class="id">chunk</span> <span class="id">addr</span> <span class="id">args</span> <span class="id">dst</span> <span class="id">s</span> <span class="id">m</span> <span class="id">a</span> <span class="id">v</span> <span class="id">rs</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_instr">wt_instr</a></span> <span class="id"><a href="RTLtyping.html#f">f</a></span> <span class="id"><a href="RTLtyping.html#env">env</a></span> (<span class="id"><a href="RTL.html#Iload">Iload</a></span> <span class="id"><a href="RTLtyping.html#chunk">chunk</a></span> <span class="id"><a href="RTLtyping.html#addr">addr</a></span> <span class="id"><a href="RTLtyping.html#args">args</a></span> <span class="id"><a href="RTLtyping.html#dst">dst</a></span> <span class="id"><a href="RTLtyping.html#s">s</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="Memory.html#Mem.loadv">Mem.loadv</a></span> <span class="id"><a href="RTLtyping.html#chunk">chunk</a></span> <span class="id"><a href="RTLtyping.html#m">m</a></span> <span class="id"><a href="RTLtyping.html#a">a</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="RTLtyping.html#v">v</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_regset">wt_regset</a></span> <span class="id"><a href="RTLtyping.html#env">env</a></span> <span class="id"><a href="RTLtyping.html#rs">rs</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_regset">wt_regset</a></span> <span class="id"><a href="RTLtyping.html#env">env</a></span> (<span class="id"><a href="RTLtyping.html#rs">rs</a></span>#<span class="id"><a href="RTLtyping.html#dst">dst</a></span> &lt;- <span class="id"><a href="RTLtyping.html#v">v</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2699')">Proof.</div>
<div class="proofscript" id="proof2699">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>. <span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="RTLtyping.html#wt_regset_assign">wt_regset_assign</a></span>; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">H8</span>; <span class="tactic">eapply</span> <span class="id"><a href="Memory.html#Mem.load_type">Mem.load_type</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="wt_exec_Ibuiltin">wt_exec_Ibuiltin</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span> <span class="id">f</span> <span class="id">ef</span> (<span class="id">ge</span>: <span class="id"><a href="RTL.html#genv">genv</a></span>) <span class="id">args</span> <span class="id">res</span> <span class="id">s</span> <span class="id">vargs</span> <span class="id">m</span> <span class="id">t</span> <span class="id">vres</span> <span class="id">m</span>' <span class="id">rs</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_instr">wt_instr</a></span> <span class="id"><a href="RTLtyping.html#f">f</a></span> <span class="id"><a href="RTLtyping.html#env">env</a></span> (<span class="id"><a href="RTL.html#Ibuiltin">Ibuiltin</a></span> <span class="id"><a href="RTLtyping.html#ef">ef</a></span> <span class="id"><a href="RTLtyping.html#args">args</a></span> <span class="id"><a href="RTLtyping.html#res">res</a></span> <span class="id"><a href="RTLtyping.html#s">s</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="Events.html#external_call">external_call</a></span> <span class="id"><a href="RTLtyping.html#ef">ef</a></span> <span class="id"><a href="RTLtyping.html#ge">ge</a></span> <span class="id"><a href="RTLtyping.html#vargs">vargs</a></span> <span class="id"><a href="RTLtyping.html#m">m</a></span> <span class="id"><a href="RTLtyping.html#t">t</a></span> <span class="id"><a href="RTLtyping.html#vres">vres</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_regset">wt_regset</a></span> <span class="id"><a href="RTLtyping.html#env">env</a></span> <span class="id"><a href="RTLtyping.html#rs">rs</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_regset">wt_regset</a></span> <span class="id"><a href="RTLtyping.html#env">env</a></span> (<span class="id"><a href="Registers.html#regmap_setres">regmap_setres</a></span> <span class="id"><a href="RTLtyping.html#res">res</a></span> <span class="id"><a href="RTLtyping.html#vres">vres</a></span> <span class="id"><a href="RTLtyping.html#rs">rs</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2700')">Proof.</div>
<div class="proofscript" id="proof2700">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="RTLtyping.html#wt_regset_setres">wt_regset_setres</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H7</span>. <span class="tactic">eapply</span> <span class="id"><a href="Events.html#external_call_well_typed">external_call_well_typed</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="wt_instr_at">wt_instr_at</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> <span class="id">env</span> <span class="id">pc</span> <span class="id">i</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_function">wt_function</a></span> <span class="id"><a href="RTLtyping.html#f">f</a></span> <span class="id"><a href="RTLtyping.html#env">env</a></span> -&gt; <span class="id"><a href="RTLtyping.html#f">f</a></span>.(<span class="id"><a href="RTL.html#fn_code">fn_code</a></span>)!<span class="id"><a href="RTLtyping.html#pc">pc</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="RTLtyping.html#i">i</a></span> -&gt; <span class="id"><a href="RTLtyping.html#wt_instr">wt_instr</a></span> <span class="id"><a href="RTLtyping.html#f">f</a></span> <span class="id"><a href="RTLtyping.html#env">env</a></span> <span class="id"><a href="RTLtyping.html#i">i</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2701')">Proof.</div>
<div class="proofscript" id="proof2701">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="wt_stackframes">wt_stackframes</a></span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="RTL.html#stackframe">stackframe</a></span> -&gt; <span class="id"><a href="AST.html#signature">signature</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="wt_stackframes_nil">wt_stackframes_nil</a></span>: <span class="kwd">forall</span> <span class="id">sg</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#sg">sg</a></span>.(<span class="id"><a href="AST.html#sig_res">sig_res</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="AST.html#Tint">Tint</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_stackframes">wt_stackframes</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> <span class="id"><a href="RTLtyping.html#sg">sg</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a name="wt_stackframes_cons">wt_stackframes_cons</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">res</span> <span class="id">f</span> <span class="id">sp</span> <span class="id">pc</span> <span class="id">rs</span> <span class="id">env</span> <span class="id">sg</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_function">wt_function</a></span> <span class="id"><a href="RTLtyping.html#f">f</a></span> <span class="id"><a href="RTLtyping.html#env">env</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_regset">wt_regset</a></span> <span class="id"><a href="RTLtyping.html#env">env</a></span> <span class="id"><a href="RTLtyping.html#rs">rs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#env">env</a></span> <span class="id"><a href="RTLtyping.html#res">res</a></span> = <span class="id"><a href="AST.html#proj_sig_res">proj_sig_res</a></span> <span class="id"><a href="RTLtyping.html#sg">sg</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_stackframes">wt_stackframes</a></span> <span class="id"><a href="RTLtyping.html#s">s</a></span> (<span class="id"><a href="RTL.html#fn_sig">fn_sig</a></span> <span class="id"><a href="RTLtyping.html#f">f</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_stackframes">wt_stackframes</a></span> (<span class="id"><a href="RTL.html#Stackframe">Stackframe</a></span> <span class="id"><a href="RTLtyping.html#res">res</a></span> <span class="id"><a href="RTLtyping.html#f">f</a></span> <span class="id"><a href="RTLtyping.html#sp">sp</a></span> <span class="id"><a href="RTLtyping.html#pc">pc</a></span> <span class="id"><a href="RTLtyping.html#rs">rs</a></span> :: <span class="id"><a href="RTLtyping.html#s">s</a></span>) <span class="id"><a href="RTLtyping.html#sg">sg</a></span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="wt_state">wt_state</a></span>: <span class="id"><a href="RTL.html#state">state</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="wt_state_intro">wt_state_intro</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">f</span> <span class="id">sp</span> <span class="id">pc</span> <span class="id">rs</span> <span class="id">m</span> <span class="id">env</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">WT_STK</span>: <span class="id"><a href="RTLtyping.html#wt_stackframes">wt_stackframes</a></span> <span class="id"><a href="RTLtyping.html#s">s</a></span> (<span class="id"><a href="RTL.html#fn_sig">fn_sig</a></span> <span class="id"><a href="RTLtyping.html#f">f</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">WT_FN</span>: <span class="id"><a href="RTLtyping.html#wt_function">wt_function</a></span> <span class="id"><a href="RTLtyping.html#f">f</a></span> <span class="id"><a href="RTLtyping.html#env">env</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">WT_RS</span>: <span class="id"><a href="RTLtyping.html#wt_regset">wt_regset</a></span> <span class="id"><a href="RTLtyping.html#env">env</a></span> <span class="id"><a href="RTLtyping.html#rs">rs</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_state">wt_state</a></span> (<span class="id"><a href="RTL.html#State">State</a></span> <span class="id"><a href="RTLtyping.html#s">s</a></span> <span class="id"><a href="RTLtyping.html#f">f</a></span> <span class="id"><a href="RTLtyping.html#sp">sp</a></span> <span class="id"><a href="RTLtyping.html#pc">pc</a></span> <span class="id"><a href="RTLtyping.html#rs">rs</a></span> <span class="id"><a href="RTLtyping.html#m">m</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="wt_state_call">wt_state_call</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">f</span> <span class="id">args</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_stackframes">wt_stackframes</a></span> <span class="id"><a href="RTLtyping.html#s">s</a></span> (<span class="id"><a href="RTL.html#funsig">funsig</a></span> <span class="id"><a href="RTLtyping.html#f">f</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_fundef">wt_fundef</a></span> <span class="id"><a href="RTLtyping.html#f">f</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Values.html#Val.has_type_list">Val.has_type_list</a></span> <span class="id"><a href="RTLtyping.html#args">args</a></span> (<span class="id"><a href="AST.html#sig_args">sig_args</a></span> (<span class="id"><a href="RTL.html#funsig">funsig</a></span> <span class="id"><a href="RTLtyping.html#f">f</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_state">wt_state</a></span> (<span class="id"><a href="RTL.html#Callstate">Callstate</a></span> <span class="id"><a href="RTLtyping.html#s">s</a></span> <span class="id"><a href="RTLtyping.html#f">f</a></span> <span class="id"><a href="RTLtyping.html#args">args</a></span> <span class="id"><a href="RTLtyping.html#m">m</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="wt_state_return">wt_state_return</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">v</span> <span class="id">m</span> <span class="id">sg</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_stackframes">wt_stackframes</a></span> <span class="id"><a href="RTLtyping.html#s">s</a></span> <span class="id"><a href="RTLtyping.html#sg">sg</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Values.html#Val.has_type">Val.has_type</a></span> <span class="id"><a href="RTLtyping.html#v">v</a></span> (<span class="id"><a href="AST.html#proj_sig_res">proj_sig_res</a></span> <span class="id"><a href="RTLtyping.html#sg">sg</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_state">wt_state</a></span> (<span class="id"><a href="RTL.html#Returnstate">Returnstate</a></span> <span class="id"><a href="RTLtyping.html#s">s</a></span> <span class="id"><a href="RTLtyping.html#v">v</a></span> <span class="id"><a href="RTLtyping.html#m">m</a></span>).<br/>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="wt_stackframes_change_sig">wt_stackframes_change_sig</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">sg1</span> <span class="id">sg2</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#sg1">sg1</a></span>.(<span class="id"><a href="AST.html#sig_res">sig_res</a></span>) = <span class="id"><a href="RTLtyping.html#sg2">sg2</a></span>.(<span class="id"><a href="AST.html#sig_res">sig_res</a></span>) -&gt; <span class="id"><a href="RTLtyping.html#wt_stackframes">wt_stackframes</a></span> <span class="id"><a href="RTLtyping.html#s">s</a></span> <span class="id"><a href="RTLtyping.html#sg1">sg1</a></span> -&gt; <span class="id"><a href="RTLtyping.html#wt_stackframes">wt_stackframes</a></span> <span class="id"><a href="RTLtyping.html#s">s</a></span> <span class="id"><a href="RTLtyping.html#sg2">sg2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2702')">Proof.</div>
<div class="proofscript" id="proof2702">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H0</span>.<br/>
- <span class="id">constructor</span>; <span class="tactic">congruence</span>.<br/>
- <span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">H3</span>. <span class="tactic">unfold</span> <span class="id"><a href="AST.html#proj_sig_res">proj_sig_res</a></span>. <span class="tactic">rewrite</span> <span class="id">H</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="SUBJECT_REDUCTION">SUBJECT_REDUCTION</a></span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id"><a name="SUBJECT_REDUCTION.p">p</a></span>: <span class="id"><a href="RTL.html#program">program</a></span>.<br/>
<br/>
<span class="kwd">Hypothesis</span> <span class="id"><a name="SUBJECT_REDUCTION.wt_p">wt_p</a></span>: <span class="id"><a href="RTLtyping.html#wt_program">wt_program</a></span> <span class="id"><a href="RTLtyping.html#SUBJECT_REDUCTION.p">p</a></span>.<br/>
<br/>
<span class="kwd">Let</span> <span class="id"><a name="SUBJECT_REDUCTION.ge">ge</a></span> := <span class="id"><a href="Globalenvs.html#Genv.globalenv">Genv.globalenv</a></span> <span class="id"><a href="RTLtyping.html#SUBJECT_REDUCTION.p">p</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="subject_reduction">subject_reduction</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st1</span> <span class="id">t</span> <span class="id">st2</span>, <span class="id"><a href="RTL.html#step">step</a></span> <span class="id"><a href="RTLtyping.html#SUBJECT_REDUCTION.ge">ge</a></span> <span class="id"><a href="RTLtyping.html#st1">st1</a></span> <span class="id"><a href="RTLtyping.html#t">t</a></span> <span class="id"><a href="RTLtyping.html#st2">st2</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">WT</span>: <span class="id"><a href="RTLtyping.html#wt_state">wt_state</a></span> <span class="id"><a href="RTLtyping.html#st1">st1</a></span>), <span class="id"><a href="RTLtyping.html#wt_state">wt_state</a></span> <span class="id"><a href="RTLtyping.html#st2">st2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2703')">Proof.</div>
<div class="proofscript" id="proof2703">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">intros</span>; <span class="id">inv</span> <span class="id">WT</span>;<br/>
&nbsp;&nbsp;<span class="tactic">try</span> (<span class="tactic">generalize</span> (<span class="id"><a href="RTLtyping.html#wt_instrs">wt_instrs</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">WT_FN</span> <span class="id">pc</span> <span class="id">_</span> <span class="id">H</span>); <span class="tactic">intros</span> <span class="id">WTI</span>).<br/>
&nbsp;Inop&nbsp;*)</span>&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;Iop&nbsp;*)</span>&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="RTLtyping.html#wt_exec_Iop">wt_exec_Iop</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;Iload&nbsp;*)</span>&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="RTLtyping.html#wt_exec_Iload">wt_exec_Iload</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;Istore&nbsp;*)</span>&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;Icall&nbsp;*)</span>&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="RTLtyping.html#wt_fundef">wt_fundef</a></span> <span class="id">fd</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">ros</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">pattern</span> <span class="id">fd</span>. <span class="tactic">apply</span> <span class="id"><a href="Globalenvs.html#Genv.find_funct_prop">Genv.find_funct_prop</a></span> <span class="kwd">with</span> <span class="id"><a href="RTL.html#fundef">fundef</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> <span class="id"><a href="RTLtyping.html#SUBJECT_REDUCTION.p">p</a></span> (<span class="id">rs</span>#<span class="id">r</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id"><a href="RTLtyping.html#SUBJECT_REDUCTION.wt_p">wt_p</a></span>. <span class="tactic">exact</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">caseEq</span> (<span class="id"><a href="Globalenvs.html#Genv.find_symbol">Genv.find_symbol</a></span> <span class="id"><a href="RTLtyping.html#SUBJECT_REDUCTION.ge">ge</a></span> <span class="id">i</span>); <span class="tactic">intros</span>; <span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">pattern</span> <span class="id">fd</span>. <span class="tactic">apply</span> <span class="id"><a href="Globalenvs.html#Genv.find_funct_ptr_prop">Genv.find_funct_ptr_prop</a></span> <span class="kwd">with</span> <span class="id"><a href="RTL.html#fundef">fundef</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> <span class="id"><a href="RTLtyping.html#SUBJECT_REDUCTION.p">p</a></span> <span class="id">b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id"><a href="RTLtyping.html#SUBJECT_REDUCTION.wt_p">wt_p</a></span>. <span class="tactic">exact</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="id">inv</span> <span class="id">WTI</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">WTI</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H8</span>. <span class="tactic">apply</span> <span class="id"><a href="RTLtyping.html#wt_regset_list">wt_regset_list</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;Itailcall&nbsp;*)</span>&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="RTLtyping.html#wt_fundef">wt_fundef</a></span> <span class="id">fd</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">ros</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">pattern</span> <span class="id">fd</span>. <span class="tactic">apply</span> <span class="id"><a href="Globalenvs.html#Genv.find_funct_prop">Genv.find_funct_prop</a></span> <span class="kwd">with</span> <span class="id"><a href="RTL.html#fundef">fundef</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> <span class="id"><a href="RTLtyping.html#SUBJECT_REDUCTION.p">p</a></span> (<span class="id">rs</span>#<span class="id">r</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id"><a href="RTLtyping.html#SUBJECT_REDUCTION.wt_p">wt_p</a></span>. <span class="tactic">exact</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">caseEq</span> (<span class="id"><a href="Globalenvs.html#Genv.find_symbol">Genv.find_symbol</a></span> <span class="id"><a href="RTLtyping.html#SUBJECT_REDUCTION.ge">ge</a></span> <span class="id">i</span>); <span class="tactic">intros</span>; <span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">pattern</span> <span class="id">fd</span>. <span class="tactic">apply</span> <span class="id"><a href="Globalenvs.html#Genv.find_funct_ptr_prop">Genv.find_funct_ptr_prop</a></span> <span class="kwd">with</span> <span class="id"><a href="RTL.html#fundef">fundef</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> <span class="id"><a href="RTLtyping.html#SUBJECT_REDUCTION.p">p</a></span> <span class="id">b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id"><a href="RTLtyping.html#SUBJECT_REDUCTION.wt_p">wt_p</a></span>. <span class="tactic">exact</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">WTI</span>. <span class="tactic">apply</span> <span class="id"><a href="RTLtyping.html#wt_stackframes_change_sig">wt_stackframes_change_sig</a></span> <span class="kwd">with</span> (<span class="id"><a href="RTL.html#fn_sig">fn_sig</a></span> <span class="id">f</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">WTI</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H7</span>. <span class="tactic">apply</span> <span class="id"><a href="RTLtyping.html#wt_regset_list">wt_regset_list</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;Ibuiltin&nbsp;*)</span>&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="RTLtyping.html#wt_exec_Ibuiltin">wt_exec_Ibuiltin</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;Icond&nbsp;*)</span>&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;Ijumptable&nbsp;*)</span>&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;Ireturn&nbsp;*)</span>&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">WTI</span>; <span class="tactic">simpl</span>. <span class="tactic">auto</span>. <span class="tactic">unfold</span> <span class="id"><a href="AST.html#proj_sig_res">proj_sig_res</a></span>; <span class="tactic">rewrite</span> <span class="id">H2</span>. <span class="tactic">auto</span>.<br/>
&nbsp;internal&nbsp;function&nbsp;*)</span>&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>. <span class="tactic">apply</span> <span class="id"><a href="RTLtyping.html#wt_init_regs">wt_init_regs</a></span>; <span class="tactic">auto</span>. <span class="tactic">rewrite</span> <span class="id">wt_params0</span>. <span class="tactic">auto</span>.<br/>
&nbsp;external&nbsp;function&nbsp;*)</span>&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Events.html#external_call_well_typed">external_call_well_typed</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;return&nbsp;*)</span>&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="RTLtyping.html#wt_regset_assign">wt_regset_assign</a></span>; <span class="tactic">auto</span>. <span class="tactic">rewrite</span> <span class="id">H10</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="wt_initial_state">wt_initial_state</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">S</span>, <span class="id"><a href="RTL.html#initial_state">initial_state</a></span> <span class="id"><a href="RTLtyping.html#SUBJECT_REDUCTION.p">p</a></span> <span class="id"><a href="RTLtyping.html#S">S</a></span> -&gt; <span class="id"><a href="RTLtyping.html#wt_state">wt_state</a></span> <span class="id"><a href="RTLtyping.html#S">S</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2704')">Proof.</div>
<div class="proofscript" id="proof2704">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="id">constructor</span>. <span class="id">constructor</span>. <span class="tactic">rewrite</span> <span class="id">H3</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">pattern</span> <span class="id">f</span>. <span class="tactic">apply</span> <span class="id"><a href="Globalenvs.html#Genv.find_funct_ptr_prop">Genv.find_funct_ptr_prop</a></span> <span class="kwd">with</span> <span class="id"><a href="RTL.html#fundef">fundef</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> <span class="id"><a href="RTLtyping.html#SUBJECT_REDUCTION.p">p</a></span> <span class="id">b</span>.<br/>
&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id"><a href="RTLtyping.html#SUBJECT_REDUCTION.wt_p">wt_p</a></span>. <span class="tactic">exact</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H3</span>. <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="wt_instr_inv">wt_instr_inv</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">f</span> <span class="id">sp</span> <span class="id">pc</span> <span class="id">rs</span> <span class="id">m</span> <span class="id">i</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#wt_state">wt_state</a></span> (<span class="id"><a href="RTL.html#State">State</a></span> <span class="id"><a href="RTLtyping.html#s">s</a></span> <span class="id"><a href="RTLtyping.html#f">f</a></span> <span class="id"><a href="RTLtyping.html#sp">sp</a></span> <span class="id"><a href="RTLtyping.html#pc">pc</a></span> <span class="id"><a href="RTLtyping.html#rs">rs</a></span> <span class="id"><a href="RTLtyping.html#m">m</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="RTLtyping.html#f">f</a></span>.(<span class="id"><a href="RTL.html#fn_code">fn_code</a></span>)!<span class="id"><a href="RTLtyping.html#pc">pc</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="RTLtyping.html#i">i</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">env</span>, <span class="id"><a href="RTLtyping.html#wt_instr">wt_instr</a></span> <span class="id"><a href="RTLtyping.html#f">f</a></span> <span class="id"><a href="RTLtyping.html#env">env</a></span> <span class="id"><a href="RTLtyping.html#i">i</a></span> /\ <span class="id"><a href="RTLtyping.html#wt_regset">wt_regset</a></span> <span class="id"><a href="RTLtyping.html#env">env</a></span> <span class="id"><a href="RTLtyping.html#rs">rs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2705')">Proof.</div>
<div class="proofscript" id="proof2705">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="id">exists</span> <span class="id">env</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">WT_FN</span>. <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="RTLtyping.html#SUBJECT_REDUCTION">SUBJECT_REDUCTION</a></span>.<br/>
<br/>
<br/>
</div>
<div class="footer"><hr/>Generated by coq2html</div>
</body>
</html>
