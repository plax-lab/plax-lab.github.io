<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module TSOCompInvs</title>
<meta name="description" content="Documentation of Coq module TSOCompInvs" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module TSOCompInvs</h1>
<div class="coq">
<span class="id">From</span> <span class="id">mathcomp.ssreflect</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">fintype</span> <span class="id">ssrnat</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Coqlib.html">Coqlib</a></span> <span class="id"><a href="Maps.html">Maps</a></span> <span class="id"><a href="Axioms.html">Axioms</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="AST.html">AST</a></span> <span class="id"><a href="Integers.html">Integers</a></span> <span class="id"><a href="Floats.html">Floats</a></span> <span class="id"><a href="Values.html">Values</a></span> <span class="id"><a href="Events.html">Events</a></span> <span class="id"><a href="Globalenvs.html">Globalenvs</a></span> <span class="id"><a href="Smallstep.html">Smallstep</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Locations.html">Locations</a></span> <span class="id"><a href="Stacklayout.html">Stacklayout</a></span> <span class="id"><a href="Conventions.html">Conventions</a></span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="CUAST.html">CUAST</a></span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Footprint.html">Footprint</a></span> <span class="id"><a href="GMemory.html">GMemory</a></span> <span class="id"><a href="FMemory.html">FMemory</a></span> <span class="id"><a href="TSOMem.html">TSOMem</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="GAST.html">GAST</a></span> <span class="id"><a href="GlobDefs.html">GlobDefs</a></span> <span class="id"><a href="ETrace.html">ETrace</a></span> <span class="id"><a href="Blockset.html">Blockset</a></span> <span class="id"><a href="DRF.html">DRF</a></span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Languages.html">Languages</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="TSOGlobSem.html">TSOGlobSem</a></span> <span class="id"><a href="GlobSemantics.html">GlobSemantics</a></span> <span class="id"><a href="TSOGlobUSim.html">TSOGlobUSim</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html">RGRels</a></span> <span class="id"><a href="ClientSim.html">ClientSim</a></span> <span class="id"><a href="AsmClientSim.html">AsmClientSim</a></span> <span class="id"><a href="ObjectSim.html">ObjectSim</a></span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="ASM_local.html">ASM_local</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="AsmLang.html">AsmLang</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="AsmTSO.html">AsmTSO</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="InteractionSemantics.html">InteractionSemantics</a></span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="SCSemLemmas.html">SCSemLemmas</a></span> <span class="id"><a href="TSOStepAuxLemmas.html">TSOStepAuxLemmas</a></span> <span class="id"><a href="TSOSemLemmas.html">TSOSemLemmas</a></span>.<br/>
<br/>
<div class="doc">Lemmas.. </div>
<span class="kwd">Lemma</span> <span class="id"><a name="ordinal_eq_dec">ordinal_eq_dec</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M</span> (<span class="id">i1</span> <span class="id">i2</span>: '<span class="id">I_M</span>), {<span class="id"><a href="TSOCompInvs.html#i1">i1</a></span> = <span class="id"><a href="TSOCompInvs.html#i2">i2</a></span>} + {<span class="id"><a href="TSOCompInvs.html#i1">i1</a></span> &lt;&gt; <span class="id"><a href="TSOCompInvs.html#i2">i2</a></span>}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10188')">Proof.</div>
<div class="proofscript" id="proof10188">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">i1</span>, <span class="id">i2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eq_dec">Nat.eq_dec</a></span> <span class="id">m</span> <span class="id">m0</span>); <span class="tactic">subst</span>; [<span class="id">left</span>|<span class="id">right</span>].<br/>
&nbsp;&nbsp;<span class="tactic">f_equal</span>. <span class="tactic">apply</span> <span class="id"><a href="Axioms.html#proof_irr">proof_irr</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="helper1">helper1</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span>: <span class="kwd">Type</span>,<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span>: <span class="id"><a href="TSOCompInvs.html#A">A</a></span> -&gt; <span class="kwd">Prop</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> (<span class="id">x</span>: <span class="id"><a href="TSOCompInvs.html#A">A</a></span>), <span class="id"><a href="TSOCompInvs.html#P">P</a></span> <span class="id"><a href="TSOCompInvs.html#x">x</a></span> /\ (<span class="id"><a href="TSOCompInvs.html#P">P</a></span> <span class="id"><a href="TSOCompInvs.html#x">x</a></span> -&gt; <span class="id"><a href="TSOCompInvs.html#Q">Q</a></span> <span class="id"><a href="TSOCompInvs.html#x">x</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> (<span class="id">x</span>: <span class="id"><a href="TSOCompInvs.html#A">A</a></span>), <span class="id"><a href="TSOCompInvs.html#P">P</a></span> <span class="id"><a href="TSOCompInvs.html#x">x</a></span> /\ <span class="id"><a href="TSOCompInvs.html#Q">Q</a></span> <span class="id"><a href="TSOCompInvs.html#x">x</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10189')">Proof.</div>
<div class="proofscript" id="proof10189">
 <span class="tactic">clear</span>. <span class="tactic">intros</span> <span class="id">A</span> <span class="id">P</span> <span class="id">Q</span> (<span class="id">x</span> &amp; <span class="id">HP</span> &amp; <span class="id">HQ</span>). <span class="tactic">eauto</span>. Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="helper2">helper2</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span> <span class="id">B</span>: <span class="kwd">Type</span>,<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span>: <span class="id"><a href="TSOCompInvs.html#A">A</a></span> -&gt; <span class="id"><a href="TSOCompInvs.html#B">B</a></span> -&gt; <span class="kwd">Prop</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> (<span class="id">x</span>: <span class="id"><a href="TSOCompInvs.html#A">A</a></span>) (<span class="id">y</span>: <span class="id"><a href="TSOCompInvs.html#B">B</a></span>), <span class="id"><a href="TSOCompInvs.html#P">P</a></span> <span class="id"><a href="TSOCompInvs.html#x">x</a></span> <span class="id"><a href="TSOCompInvs.html#y">y</a></span> /\ (<span class="id"><a href="TSOCompInvs.html#P">P</a></span> <span class="id"><a href="TSOCompInvs.html#x">x</a></span> <span class="id"><a href="TSOCompInvs.html#y">y</a></span> -&gt; <span class="id"><a href="TSOCompInvs.html#Q">Q</a></span> <span class="id"><a href="TSOCompInvs.html#x">x</a></span> <span class="id"><a href="TSOCompInvs.html#y">y</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> (<span class="id">x</span>: <span class="id"><a href="TSOCompInvs.html#A">A</a></span>) (<span class="id">y</span>: <span class="id"><a href="TSOCompInvs.html#B">B</a></span>), <span class="id"><a href="TSOCompInvs.html#P">P</a></span> <span class="id"><a href="TSOCompInvs.html#x">x</a></span> <span class="id"><a href="TSOCompInvs.html#y">y</a></span> /\ <span class="id"><a href="TSOCompInvs.html#Q">Q</a></span> <span class="id"><a href="TSOCompInvs.html#x">x</a></span> <span class="id"><a href="TSOCompInvs.html#y">y</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10190')">Proof.</div>
<div class="proofscript" id="proof10190">
 <span class="tactic">clear</span>. <span class="tactic">intros</span> <span class="id">A</span> <span class="id">B</span> <span class="id">P</span> <span class="id">Q</span> (<span class="id">x</span> &amp; <span class="id">y</span> &amp; <span class="id">HP</span> &amp; <span class="id">HQ</span>). <span class="tactic">eauto</span>. Qed.</div>
<br/>
<span class="kwd">Require</span> <span class="id"><a href="GDefLemmas.html">GDefLemmas</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="unbuffer_safe_unbuffer">unbuffer_safe_unbuffer</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tm</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> &lt;&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer">unbuffer</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> &lt;&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10191')">Proof.</div>
<div class="proofscript" id="proof10191">
&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="id">specialize</span> (<span class="id">ABIS</span> <span class="id">t</span>). <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unbuffer">unbuffer</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span> <span class="id">t</span>). <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id">ABIS</span>; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">H</span>. <span class="tactic">intro</span>; <span class="tactic">discriminate</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="tso_sc_initRel_Ic">tso_sc_initRel_Ic</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">sgm</span> <span class="id">tgm</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_sc_initRel">tso_sc_initRel</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#sgm">sgm</a></span> <span class="id"><a href="TSOCompInvs.html#tgm">tgm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#Ic">Ic</a></span> <span class="id"><a href="TSOCompInvs.html#sgm">sgm</a></span> (<span class="id"><a href="TSOMem.html#tsomem_init">tsomem_init</a></span> <span class="id"><a href="TSOCompInvs.html#tgm">tgm</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10192')">Proof.</div>
<div class="proofscript" id="proof10192">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsomem_init">tsomem_init</a></span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;{ <span class="tactic">clear</span>.  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="tactic">discriminate</span>. }<br/>
&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">H2</span>. <span class="id">inv</span> <span class="id">H4</span>. }<br/>
&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">H0</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id"><a href="ClientSim.html#buf_alloc_invalid">buf_alloc_invalid</a></span>. <span class="tactic">intros</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id"><a href="ClientSim.html#buf_alloc_norep">buf_alloc_norep</a></span>. <span class="tactic">simpl</span>. <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">j</span>; <span class="id">inv</span> <span class="id">H1</span>. }<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="ptree_set_reorder">ptree_set_reorder</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span> <span class="id">i</span> <span class="id">j</span> <span class="id">m</span> (<span class="id">v1</span> <span class="id">v2</span>:<span class="id"><a href="TSOCompInvs.html#A">A</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#i">i</a></span> &lt;&gt; <span class="id"><a href="TSOCompInvs.html#j">j</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#PTree.set">Maps.PTree.set</a></span> <span class="id"><a href="TSOCompInvs.html#i">i</a></span> <span class="id"><a href="TSOCompInvs.html#v1">v1</a></span> (<span class="id"><a href="Maps.html#PTree.set">Maps.PTree.set</a></span> <span class="id"><a href="TSOCompInvs.html#j">j</a></span> <span class="id"><a href="TSOCompInvs.html#v2">v2</a></span> <span class="id"><a href="TSOCompInvs.html#m">m</a></span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#PTree.set">Maps.PTree.set</a></span> <span class="id"><a href="TSOCompInvs.html#j">j</a></span> <span class="id"><a href="TSOCompInvs.html#v2">v2</a></span> (<span class="id"><a href="Maps.html#PTree.set">Maps.PTree.set</a></span> <span class="id"><a href="TSOCompInvs.html#i">i</a></span> <span class="id"><a href="TSOCompInvs.html#v1">v1</a></span> <span class="id"><a href="TSOCompInvs.html#m">m</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10193')">Proof.</div>
<div class="proofscript" id="proof10193">
 <span class="tactic">induction</span> <span class="id">i</span>;<span class="tactic">intros</span>;<span class="tactic">destruct</span> <span class="id">m</span>,<span class="id">j</span>;<span class="tactic">simpl</span>;<span class="tactic">auto</span>;<span class="tactic">try</span> (<span class="tactic">rewrite</span> <span class="id">IHi</span>;<span class="tactic">auto</span>;<span class="tactic">intro</span>;<span class="tactic">subst</span>);<span class="id">contradiction</span>. Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="pmap_set_reorder">pmap_set_reorder</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span> <span class="id">i</span> <span class="id">j</span> <span class="id">m</span> (<span class="id">v1</span> <span class="id">v2</span>:<span class="id"><a href="TSOCompInvs.html#A">A</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#i">i</a></span> &lt;&gt; <span class="id"><a href="TSOCompInvs.html#j">j</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#PMap.set">Maps.PMap.set</a></span> <span class="id"><a href="TSOCompInvs.html#i">i</a></span> <span class="id"><a href="TSOCompInvs.html#v1">v1</a></span> (<span class="id"><a href="Maps.html#PMap.set">Maps.PMap.set</a></span> <span class="id"><a href="TSOCompInvs.html#j">j</a></span> <span class="id"><a href="TSOCompInvs.html#v2">v2</a></span> <span class="id"><a href="TSOCompInvs.html#m">m</a></span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Maps.html#PMap.set">Maps.PMap.set</a></span> <span class="id"><a href="TSOCompInvs.html#j">j</a></span> <span class="id"><a href="TSOCompInvs.html#v2">v2</a></span> (<span class="id"><a href="Maps.html#PMap.set">Maps.PMap.set</a></span> <span class="id"><a href="TSOCompInvs.html#i">i</a></span> <span class="id"><a href="TSOCompInvs.html#v1">v1</a></span> <span class="id"><a href="TSOCompInvs.html#m">m</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10194')">Proof.</div>
<div class="proofscript" id="proof10194">
 <span class="tactic">unfold</span> <span class="id"><a href="Maps.html#PMap.set">Maps.PMap.set</a></span>;<span class="tactic">simpl</span>;<span class="tactic">intros</span>;<span class="tactic">f_equal</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#ptree_set_reorder">ptree_set_reorder</a></span>;<span class="tactic">eauto</span>. Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="star_corestep_LocalAlloc">star_corestep_LocalAlloc</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">Lang</span> <span class="id">Ge</span> <span class="id">fl</span> <span class="id">c</span> <span class="id">m</span> <span class="id">fp</span> <span class="id">c</span>' <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#wd">wd</a></span> <span class="id"><a href="TSOCompInvs.html#Lang">Lang</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#star">star</a></span> (<span class="id"><a href="InteractionSemantics.html#step">step</a></span> <span class="id"><a href="TSOCompInvs.html#Lang">Lang</a></span> <span class="id"><a href="TSOCompInvs.html#Ge">Ge</a></span> <span class="id"><a href="TSOCompInvs.html#fl">fl</a></span>) <span class="id"><a href="TSOCompInvs.html#c">c</a></span> <span class="id"><a href="TSOCompInvs.html#m">m</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">c</span>' <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#LocalAlloc">LocalAlloc</a></span> <span class="id"><a href="TSOCompInvs.html#m">m</a></span> <span class="id">m</span>' <span class="id"><a href="TSOCompInvs.html#fl">fl</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10195')">Proof.</div>
<div class="proofscript" id="proof10195">
&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span> <span class="id">Lang</span> <span class="id">Ge</span> <span class="id">fl</span> <span class="id">c</span> <span class="id">m</span> <span class="id">fp</span> <span class="id">c</span>' <span class="id">m</span>' <span class="id">Hwd</span> <span class="id">Hstep</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hstep</span>. <span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#LocalAlloc_refl">LocalAlloc_refl</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#LocalAlloc_trans">LocalAlloc_trans</a></span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id"><a href="InteractionSemantics.html#step_local_eff">step_local_eff</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>. <span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<div class="doc">end lemmas... </div>
<br/>
<br/>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="Invs">Invs</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Variable</span> (<span class="id"><a name="Invs.scunits">scunits</a></span>: @<span class="id"><a href="GAST.html#cunits">cunits</a></span> <span class="id"><a href="Languages.html#NL">NL</a></span> <span class="id"><a href="Languages.html#L">L</a></span>).<br/>
&nbsp;&nbsp;<span class="kwd">Variable</span> (<span class="id"><a name="Invs.tcunits">tcunits</a></span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="AsmTSO.html#comp_unit">AsmTSO.comp_unit</a></span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="client_id">client_id</a></span> : @<span class="id"><a href="GAST.html#cunits">cunits</a></span> <span class="id"><a href="Languages.html#NL">NL</a></span> <span class="id"><a href="Languages.html#L">L</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="AsmTSO.html#comp_unit">AsmTSO.comp_unit</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="client_cu_nil">client_cu_nil</a></span>: <span class="id"><a href="TSOCompInvs.html#client_id">client_id</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a name="client_cu_cons">client_cu_cons</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">cu</span> <span class="id">scus</span> <span class="id">tcus</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#client_id">client_id</a></span> <span class="id"><a href="TSOCompInvs.html#scus">scus</a></span> <span class="id"><a href="TSOCompInvs.html#tcus">tcus</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CUAST.html#nodup_gd_ident">nodup_gd_ident</a></span> (<span class="id"><a href="CUAST.html#cu_defs">cu_defs</a></span> <span class="id"><a href="TSOCompInvs.html#cu">cu</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CUAST.html#nodup_ef">nodup_ef</a></span> (<span class="id"><a href="CUAST.html#cu_defs">cu_defs</a></span> <span class="id"><a href="TSOCompInvs.html#cu">cu</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#client_id">client_id</a></span> ((<span class="id"><a href="GAST.html#Build_cunit">Build_cunit</a></span> <span class="id"><a href="Languages.html#NL">NL</a></span> <span class="id"><a href="Languages.html#L">L</a></span> <span class="id"><a href="Languages.html#id1">id1</a></span> <span class="id"><a href="TSOCompInvs.html#cu">cu</a></span>) :: <span class="id"><a href="TSOCompInvs.html#scus">scus</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOCompInvs.html#cu">cu</a></span> :: <span class="id"><a href="TSOCompInvs.html#tcus">tcus</a></span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="client_id_cunit_eq">client_id_cunit_eq</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">scunits</span> <span class="id">tcunits</span> <span class="id">x</span> <span class="id">scu</span> <span class="id">tcu</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#client_id">client_id</a></span> <span class="id"><a href="TSOCompInvs.html#scunits">scunits</a></span> <span class="id"><a href="TSOCompInvs.html#tcunits">tcunits</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id"><a href="TSOCompInvs.html#scunits">scunits</a></span> <span class="id"><a href="TSOCompInvs.html#x">x</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> {| <span class="id"><a href="GAST.html#Build_cunit">lid</a></span> := <span class="id"><a href="Languages.html#id1">id1</a></span> ; <span class="id">cu</span> := <span class="id"><a href="TSOCompInvs.html#scu">scu</a></span> |} -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id"><a href="TSOCompInvs.html#tcunits">tcunits</a></span> <span class="id"><a href="TSOCompInvs.html#x">x</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOCompInvs.html#tcu">tcu</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#scu">scu</a></span> = <span class="id"><a href="TSOCompInvs.html#tcu">tcu</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10196')">Proof.</div>
<div class="proofscript" id="proof10196">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">unfold</span> <span class="id"><a href="Languages.html#L">L</a></span>. <span class="tactic">simpl</span>. <span class="tactic">intros</span> <span class="id">until</span> 1. <span class="id">revert</span> <span class="id">x</span> <span class="id">scu</span> <span class="id">tcu</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>. <span class="tactic">simpl</span>. <span class="tactic">clear</span>. <span class="tactic">unfold</span> <span class="id"><a href="Languages.html#L">L</a></span>, <span class="id"><a href="Languages.html#id1">id1</a></span> <span class="kwd">in</span> *. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="kwd">forall</span> <span class="id">T</span> (<span class="id">x</span> <span class="id">y</span>: <span class="id"><a href="TSOCompInvs.html#T">T</a></span>) , <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOCompInvs.html#x">x</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOCompInvs.html#y">y</a></span> -&gt; <span class="id"><a href="TSOCompInvs.html#x">x</a></span> = <span class="id"><a href="TSOCompInvs.html#y">y</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">clear</span>. <span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">clear</span> <span class="id">H1</span>. <span class="id">inv</span> <span class="id">H0</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="kwd">forall</span> <span class="id">id</span> <span class="id">cu1</span> <span class="id">cu2</span>, <span class="id"><a href="GAST.html#Build_cunit">Build_cunit</a></span> <span class="id">_</span> <span class="id"><a href="Languages.html#L">L</a></span> <span class="id"><a href="TSOCompInvs.html#id">id</a></span> <span class="id"><a href="TSOCompInvs.html#cu1">cu1</a></span> = <span class="id"><a href="GAST.html#Build_cunit">Build_cunit</a></span> <span class="id">_</span> <span class="id"><a href="Languages.html#L">L</a></span> <span class="id"><a href="TSOCompInvs.html#id">id</a></span> <span class="id"><a href="TSOCompInvs.html#cu2">cu2</a></span> -&gt; <span class="id"><a href="TSOCompInvs.html#cu1">cu1</a></span> = <span class="id"><a href="TSOCompInvs.html#cu2">cu2</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">clear</span>. <span class="tactic">intros</span>. <span class="tactic">inversion</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Eqdep_dec.html#inj_pair2_eq_dec">Eqdep_dec.inj_pair2_eq_dec</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#ordinal_eq_dec">ordinal_eq_dec</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id">IHclient_id</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="client_id_nodup">client_id_nodup</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">scunits</span> <span class="id">tcunits</span> <span class="id">x</span> <span class="id">scu</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#client_id">client_id</a></span> <span class="id"><a href="TSOCompInvs.html#scunits">scunits</a></span> <span class="id"><a href="TSOCompInvs.html#tcunits">tcunits</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id"><a href="TSOCompInvs.html#scunits">scunits</a></span> <span class="id"><a href="TSOCompInvs.html#x">x</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> {| <span class="id"><a href="GAST.html#Build_cunit">lid</a></span> := <span class="id"><a href="Languages.html#id1">id1</a></span> ; <span class="id">cu</span> := <span class="id"><a href="TSOCompInvs.html#scu">scu</a></span> |} -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CUAST.html#nodup_gd_ident">nodup_gd_ident</a></span> (<span class="id"><a href="CUAST.html#cu_defs">cu_defs</a></span> <span class="id"><a href="TSOCompInvs.html#scu">scu</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> /\ <span class="id"><a href="CUAST.html#nodup_ef">nodup_ef</a></span> (<span class="id"><a href="CUAST.html#cu_defs">cu_defs</a></span> <span class="id"><a href="TSOCompInvs.html#scu">scu</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10197')">Proof.</div>
<div class="proofscript" id="proof10197">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">unfold</span> <span class="id"><a href="Languages.html#L">L</a></span>. <span class="tactic">simpl</span>. <span class="tactic">intros</span> <span class="id">until</span> 1. <span class="id">revert</span> <span class="id">x</span> <span class="id">scu</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>. <span class="tactic">simpl</span>. <span class="id">revert</span> <span class="id">H0</span> <span class="id">H1</span>. <span class="tactic">clear</span>. <span class="tactic">unfold</span> <span class="id"><a href="Languages.html#L">L</a></span>, <span class="id"><a href="Languages.html#id1">id1</a></span> <span class="kwd">in</span> *. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="kwd">forall</span> <span class="id">T</span> (<span class="id">x</span> <span class="id">y</span>: <span class="id"><a href="TSOCompInvs.html#T">T</a></span>) , <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOCompInvs.html#x">x</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOCompInvs.html#y">y</a></span> -&gt; <span class="id"><a href="TSOCompInvs.html#x">x</a></span> = <span class="id"><a href="TSOCompInvs.html#y">y</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">clear</span>. <span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">clear</span> <span class="id">H2</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="kwd">forall</span> <span class="id">id</span> <span class="id">cu1</span> <span class="id">cu2</span>, <span class="id"><a href="GAST.html#Build_cunit">Build_cunit</a></span> <span class="id">_</span> <span class="id"><a href="Languages.html#L">L</a></span> <span class="id"><a href="TSOCompInvs.html#id">id</a></span> <span class="id"><a href="TSOCompInvs.html#cu1">cu1</a></span> = <span class="id"><a href="GAST.html#Build_cunit">Build_cunit</a></span> <span class="id">_</span> <span class="id"><a href="Languages.html#L">L</a></span> <span class="id"><a href="TSOCompInvs.html#id">id</a></span> <span class="id"><a href="TSOCompInvs.html#cu2">cu2</a></span> -&gt; <span class="id"><a href="TSOCompInvs.html#cu1">cu1</a></span> = <span class="id"><a href="TSOCompInvs.html#cu2">cu2</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">clear</span>. <span class="tactic">intros</span>. <span class="tactic">inversion</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Eqdep_dec.html#inj_pair2_eq_dec">Eqdep_dec.inj_pair2_eq_dec</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#ordinal_eq_dec">ordinal_eq_dec</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">subst</span> <span class="id">scu</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id">IHclient_id</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Hypothesis</span> (<span class="id"><a name="Invs.H_client_code">H_client_code</a></span>: <span class="id"><a href="TSOCompInvs.html#client_id">client_id</a></span> <span class="id"><a href="TSOCompInvs.html#Invs.scunits">scunits</a></span> <span class="id"><a href="TSOCompInvs.html#Invs.tcunits">tcunits</a></span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Variable</span> (<span class="id"><a name="Invs.oscu">oscu</a></span>: @<span class="id"><a href="GAST.html#cunit">cunit</a></span> <span class="id"><a href="Languages.html#NL">NL</a></span> <span class="id"><a href="Languages.html#L">L</a></span>).<br/>
&nbsp;&nbsp;<span class="kwd">Variable</span> (<span class="id"><a name="Invs.otcu">otcu</a></span>: <span class="id"><a href="AsmTSO.html#comp_unit">AsmTSO.comp_unit</a></span>).<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="objcu_sim">objcu_sim</a></span> (<span class="id">Ro</span> <span class="id">Go</span>: <span class="id"><a href="ASM_local.html#genv">ASM_local.genv</a></span> -&gt; <span class="id"><a href="GlobDefs.html#tid">tid</a></span> -&gt; <span class="id"><a href="RGRels.html#stRel">stRel</a></span>) (<span class="id">Io</span>: <span class="id"><a href="ASM_local.html#genv">ASM_local.genv</a></span> -&gt; <span class="id"><a href="RGRels.html#stInv">stInv</a></span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="GAST.html#cunit">cunit</a></span> <span class="id"><a href="Languages.html#NL">NL</a></span> <span class="id"><a href="Languages.html#L">L</a></span> -&gt; <span class="id"><a href="AsmTSO.html#comp_unit">AsmTSO.comp_unit</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="Objcu_sim">Objcu_sim</a></span>: <span class="kwd">forall</span> (<span class="id">scu</span>: <span class="id"><a href="SpecLang.html#comp_unit">SpecLang.comp_unit</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tcu</span>: <span class="id"><a href="AsmTSO.html#comp_unit">AsmTSO.comp_unit</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ObjectSim.html#objectsim">objectsim</a></span> <span class="id">Ro</span> <span class="id">Go</span> <span class="id">Io</span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span> <span class="id"><a href="TSOCompInvs.html#scu">scu</a></span> <span class="id"><a href="TSOCompInvs.html#tcu">tcu</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#objcu_sim">objcu_sim</a></span> <span class="id">Ro</span> <span class="id">Go</span> <span class="id">Io</span> (<span class="id"><a href="GAST.html#Build_cunit">Build_cunit</a></span> <span class="id"><a href="Languages.html#NL">NL</a></span> <span class="id"><a href="Languages.html#L">L</a></span> <span class="id"><a href="Languages.html#id2">id2</a></span> <span class="id"><a href="TSOCompInvs.html#scu">scu</a></span>) <span class="id"><a href="TSOCompInvs.html#tcu">tcu</a></span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Variable</span> (<span class="id"><a name="Invs.Ro">Ro</a></span> <span class="id"><a name="Invs.Go">Go</a></span>: <span class="id"><a href="ASM_local.html#genv">ASM_local.genv</a></span> -&gt; <span class="id"><a href="GlobDefs.html#tid">tid</a></span> -&gt; <span class="id"><a href="RGRels.html#stRel">stRel</a></span>).<br/>
&nbsp;&nbsp;<span class="kwd">Variable</span> (<span class="id"><a name="Invs.Io">Io</a></span>: <span class="id"><a href="ASM_local.html#genv">ASM_local.genv</a></span> -&gt; <span class="id"><a href="RGRels.html#stInv">stInv</a></span>).<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Hypothesis</span> (<span class="id"><a name="Invs.H_object_sim">H_object_sim</a></span>: <span class="id"><a href="TSOCompInvs.html#objcu_sim">objcu_sim</a></span> <span class="id"><a href="TSOCompInvs.html#Invs.Ro">Ro</a></span> <span class="id"><a href="TSOCompInvs.html#Invs.Go">Go</a></span> <span class="id"><a href="TSOCompInvs.html#Invs.Io">Io</a></span> <span class="id"><a href="TSOCompInvs.html#Invs.oscu">oscu</a></span> <span class="id"><a href="TSOCompInvs.html#Invs.otcu">otcu</a></span>).<br/>
&nbsp;&nbsp;<span class="kwd">Hypothesis</span> (<span class="id"><a name="Invs.H_RP">H_RP</a></span>: <span class="id"><a href="ObjectSim.html#RespectPerm">RespectPerm</a></span> <span class="id"><a href="TSOCompInvs.html#Invs.Io">Io</a></span> <span class="id"><a href="TSOCompInvs.html#Invs.Ro">Ro</a></span> <span class="id"><a href="TSOCompInvs.html#Invs.Go">Go</a></span>).<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Variable</span> (<span class="id"><a name="Invs.e">e</a></span>: <span class="id"><a href="GAST.html#entries">entries</a></span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Hypothesis</span> (<span class="id"><a name="Invs.H_sta_co">H_sta_co</a></span>: <span class="kwd">forall</span> <span class="id">ge</span> <span class="id">t</span>, <span class="id"><a href="RGRels.html#Sta">Sta</a></span> <span class="id"><a href="ClientSim.html#Ic">Ic</a></span> (<span class="id"><a href="TSOCompInvs.html#Invs.Go">Go</a></span> <span class="id"><a href="TSOCompInvs.html#ge">ge</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span>)).<br/>
&nbsp;&nbsp;<span class="kwd">Hypothesis</span> (<span class="id"><a name="Invs.H_sta_cc">H_sta_cc</a></span>: <span class="kwd">forall</span> <span class="id">t</span>, <span class="id"><a href="RGRels.html#Sta">Sta</a></span> <span class="id"><a href="ClientSim.html#Ic">Ic</a></span> (<span class="id"><a href="ClientSim.html#Gc">Gc</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span>)).<br/>
&nbsp;&nbsp;<span class="kwd">Hypothesis</span> (<span class="id"><a name="Invs.H_sta_oc">H_sta_oc</a></span>: <span class="kwd">forall</span> <span class="id">ge</span> <span class="id">t</span>, <span class="id"><a href="RGRels.html#Sta">Sta</a></span> (<span class="id"><a href="TSOCompInvs.html#Invs.Io">Io</a></span> <span class="id"><a href="TSOCompInvs.html#ge">ge</a></span>) (<span class="id"><a href="ClientSim.html#Gc">Gc</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span>)).<br/>
&nbsp;&nbsp;<span class="kwd">Hypothesis</span> (<span class="id"><a name="Invs.H_sta_oo">H_sta_oo</a></span>: <span class="kwd">forall</span> <span class="id">ge</span> <span class="id">t</span>, <span class="id"><a href="RGRels.html#Sta">Sta</a></span> (<span class="id"><a href="TSOCompInvs.html#Invs.Io">Io</a></span> <span class="id"><a href="TSOCompInvs.html#ge">ge</a></span>) (<span class="id"><a href="TSOCompInvs.html#Invs.Go">Go</a></span> <span class="id"><a href="TSOCompInvs.html#ge">ge</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span>)).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Hypothesis</span> (<span class="id"><a name="Invs.H_rg_cc">H_rg_cc</a></span>: <span class="kwd">forall</span> <span class="id">t</span> <span class="id">t</span>', <span class="id"><a href="RGRels.html#Implies">Implies</a></span> (<span class="id"><a href="ClientSim.html#Gc">Gc</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span>) (<span class="id"><a href="ClientSim.html#Rc">Rc</a></span> <span class="id">t</span>')).<br/>
&nbsp;&nbsp;<span class="kwd">Hypothesis</span> (<span class="id"><a name="Invs.H_rg_oc">H_rg_oc</a></span>: <span class="kwd">forall</span> <span class="id">ge</span> <span class="id">t</span> <span class="id">t</span>', <span class="id">Implies</span>' <span class="id"><a href="ClientSim.html#Ic">Ic</a></span> (<span class="id"><a href="TSOCompInvs.html#Invs.Go">Go</a></span> <span class="id"><a href="TSOCompInvs.html#ge">ge</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span>) (<span class="id"><a href="ClientSim.html#Rc">Rc</a></span> <span class="id">t</span>')).<br/>
&nbsp;&nbsp;<span class="kwd">Hypothesis</span> (<span class="id"><a name="Invs.H_rg_co">H_rg_co</a></span>: <span class="kwd">forall</span> <span class="id">t</span> <span class="id">ge</span> <span class="id">t</span>', <span class="id"><a href="TSOCompInvs.html#t">t</a></span> &lt;&gt; <span class="id">t</span>' -&gt; <span class="id">Implies</span>' (<span class="id"><a href="TSOCompInvs.html#Invs.Io">Io</a></span> <span class="id"><a href="TSOCompInvs.html#ge">ge</a></span>) (<span class="id"><a href="ClientSim.html#Gc">Gc</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span>) (<span class="id"><a href="TSOCompInvs.html#Invs.Ro">Ro</a></span> <span class="id"><a href="TSOCompInvs.html#ge">ge</a></span> <span class="id">t</span>')).<br/>
&nbsp;&nbsp;<span class="kwd">Hypothesis</span> (<span class="id"><a name="Invs.H_rg_oo">H_rg_oo</a></span>: <span class="kwd">forall</span> <span class="id">ge</span> <span class="id">t</span> <span class="id">t</span>', <span class="id"><a href="TSOCompInvs.html#t">t</a></span> &lt;&gt; <span class="id">t</span>' -&gt; <span class="id"><a href="RGRels.html#Implies">Implies</a></span> (<span class="id"><a href="TSOCompInvs.html#Invs.Go">Go</a></span> <span class="id"><a href="TSOCompInvs.html#ge">ge</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span>) (<span class="id"><a href="TSOCompInvs.html#Invs.Ro">Ro</a></span> <span class="id"><a href="TSOCompInvs.html#ge">ge</a></span> <span class="id">t</span>')).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Hypothesis</span> (<span class="id"><a name="Invs.H_sta_c_ub">H_sta_c_ub</a></span>: <span class="id"><a href="RGRels.html#UBSta">UBSta</a></span> <span class="id"><a href="ClientSim.html#Ic">Ic</a></span>).<br/>
&nbsp;&nbsp;<span class="kwd">Hypothesis</span> (<span class="id"><a name="Invs.H_sta_o_ub">H_sta_o_ub</a></span>: <span class="kwd">forall</span> <span class="id">ge</span>, <span class="id"><a href="RGRels.html#UBSta">UBSta</a></span> (<span class="id"><a href="TSOCompInvs.html#Invs.Io">Io</a></span> <span class="id"><a href="TSOCompInvs.html#ge">ge</a></span>)).<br/>
&nbsp;&nbsp;<span class="kwd">Hypothesis</span> (<span class="id"><a name="Invs.H_rg_ub_c">H_rg_ub_c</a></span>: <span class="kwd">forall</span> <span class="id">t</span>, <span class="id"><a href="RGRels.html#UBImplies">UBImplies</a></span> <span class="id"><a href="ClientSim.html#Ic">Ic</a></span> (<span class="id"><a href="ClientSim.html#Rc">Rc</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span>)).<br/>
&nbsp;&nbsp;<span class="kwd">Hypothesis</span> (<span class="id"><a name="Invs.H_rg_ub_o">H_rg_ub_o</a></span>: <span class="kwd">forall</span> <span class="id">ge</span> <span class="id">t</span>, <span class="id"><a href="RGRels.html#UBImplies">UBImplies</a></span> (<span class="id"><a href="TSOCompInvs.html#Invs.Io">Io</a></span> <span class="id"><a href="TSOCompInvs.html#ge">ge</a></span>) (<span class="id"><a href="TSOCompInvs.html#Invs.Ro">Ro</a></span> <span class="id"><a href="TSOCompInvs.html#ge">ge</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span>)).<br/>
<br/>
<div class="doc">This section defines invariants on global environments </div>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id"><a name="Invs.GEInvs">GEInvs</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="mod_sim_client">mod_sim_client</a></span>: <span class="id"><a href="InteractionSemantics.html#ModSem.t">ModSem.t</a></span> -&gt; <span class="id"><a href="ASM_local.html#genv">ASM_local.genv</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a name="Mod_sim_client">Mod_sim_client</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sge</span> <span class="id">tge</span> <span class="id">ms</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="ClientSim.html#clientsim_properties">clientsim_properties</a></span> <span class="id"><a href="ClientSim.html#Rc">Rc</a></span> <span class="id"><a href="ClientSim.html#Gc">Gc</a></span> <span class="id"><a href="ClientSim.html#Ic">Ic</a></span> <span class="id"><a href="AsmLang.html#AsmLang">AsmLang</a></span> <span class="id"><a href="TSOCompInvs.html#sge">sge</a></span> <span class="id"><a href="TSOCompInvs.html#sge">sge</a></span> <span class="id"><a href="TSOCompInvs.html#tge">tge</a></span> <span class="id"><a href="TSOCompInvs.html#ms">ms</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#mod_sim_client">mod_sim_client</a></span> (<span class="id"><a href="InteractionSemantics.html#ModSem.Build_t">ModSem.Build_t</a></span> <span class="id"><a href="AsmLang.html#AsmLang">AsmLang</a></span> <span class="id"><a href="TSOCompInvs.html#sge">sge</a></span> <span class="id"><a href="TSOCompInvs.html#sge">sge</a></span>) <span class="id"><a href="TSOCompInvs.html#tge">tge</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="mod_sim_object">mod_sim_object</a></span>: <span class="id"><a href="InteractionSemantics.html#ModSem.t">ModSem.t</a></span> -&gt; <span class="id"><a href="ASM_local.html#genv">ASM_local.genv</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a name="Mod_sim_object">Mod_sim_object</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sge</span> <span class="id">tge</span> <span class="id">ms</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="ObjectSim.html#objectsim_properties">objectsim_properties</a></span> <span class="id"><a href="TSOCompInvs.html#Invs.Ro">Ro</a></span> <span class="id"><a href="TSOCompInvs.html#Invs.Go">Go</a></span> <span class="id"><a href="TSOCompInvs.html#Invs.Io">Io</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span> <span class="id"><a href="TSOCompInvs.html#sge">sge</a></span> <span class="id"><a href="TSOCompInvs.html#sge">sge</a></span> <span class="id"><a href="TSOCompInvs.html#tge">tge</a></span> <span class="id"><a href="TSOCompInvs.html#ms">ms</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#mod_sim_object">mod_sim_object</a></span> (<span class="id"><a href="InteractionSemantics.html#ModSem.Build_t">ModSem.Build_t</a></span> <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span> <span class="id"><a href="TSOCompInvs.html#sge">sge</a></span> <span class="id"><a href="TSOCompInvs.html#sge">sge</a></span>) <span class="id"><a href="TSOCompInvs.html#tge">tge</a></span>.<br/>
<br/>
<div class="doc">TODO: i_obj property </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="GE_mod_sim">GE_mod_sim</a></span> (<span class="id">M</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) : '<span class="id">I_M</span> -&gt; <span class="id"><a href="GlobDefs.html#GlobEnv.t">GlobEnv.t</a></span> -&gt; <span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.t">TSOGlobEnv.t</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a name="GE_mod_sim_intro">GE_mod_sim_intro</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">i_obj</span> <span class="id">get_mod</span> <span class="id">get_mod</span>' <span class="id">modules</span> <span class="id">modules</span>' <span class="id">bound</span> <span class="id">fls</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">fnid</span>, <span class="id">get_mod</span>' <span class="id"><a href="TSOCompInvs.html#fnid">fnid</a></span> = <span class="id"><a href="TSOCompInvs.html#get_mod">get_mod</a></span> <span class="id"><a href="TSOCompInvs.html#fnid">fnid</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">i_x</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( <span class="id"><a href="TSOCompInvs.html#mod_sim_client">mod_sim_client</a></span> (<span class="id"><a href="TSOCompInvs.html#modules">modules</a></span> <span class="id"><a href="TSOCompInvs.html#i_x">i_x</a></span>) (<span class="id">modules</span>' <span class="id"><a href="TSOCompInvs.html#i_x">i_x</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id">nat_of_ord</span> <span class="id"><a href="TSOCompInvs.html#i_x">i_x</a></span> &lt;&gt; <span class="id">nat_of_ord</span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> )<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( <span class="id"><a href="TSOCompInvs.html#mod_sim_object">mod_sim_object</a></span> (<span class="id"><a href="TSOCompInvs.html#modules">modules</a></span> <span class="id"><a href="TSOCompInvs.html#i_x">i_x</a></span>) (<span class="id">modules</span>' <span class="id"><a href="TSOCompInvs.html#i_x">i_x</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="TSOCompInvs.html#i_x">i_x</a></span> = <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> )<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#GE_mod_sim">GE_mod_sim</a></span> <span class="id">M</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GlobDefs.html#GlobEnv.Build_t">GlobEnv.Build_t</a></span> <span class="id">M</span> <span class="id"><a href="TSOCompInvs.html#modules">modules</a></span> <span class="id"><a href="TSOCompInvs.html#get_mod">get_mod</a></span> <span class="id"><a href="TSOCompInvs.html#bound">bound</a></span> <span class="id"><a href="TSOCompInvs.html#fls">fls</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.Build_t">TSOGlobEnv.Build_t</a></span> <span class="id">M</span> <span class="id">modules</span>' <span class="id">get_mod</span>' <span class="id"><a href="TSOCompInvs.html#bound">bound</a></span> <span class="id"><a href="TSOCompInvs.html#fls">fls</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="init_genvs_sim">init_genvs_sim</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">sgm</span> <span class="id">tgm</span> <span class="id">spc</span> <span class="id">tpc</span> <span class="id">ts</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_sc_initRel">tso_sc_initRel</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#sgm">sgm</a></span> <span class="id"><a href="TSOCompInvs.html#tgm">tgm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#init_config">init_config</a></span> (<span class="id"><a href="TSOCompInvs.html#Invs.oscu">oscu</a></span> :: <span class="id"><a href="TSOCompInvs.html#Invs.scunits">scunits</a></span>, <span class="id"><a href="TSOCompInvs.html#Invs.e">e</a></span>) <span class="id"><a href="TSOCompInvs.html#sgm">sgm</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id"><a href="TSOCompInvs.html#ts">ts</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_initconfig">tso_initconfig</a></span> (<span class="id"><a href="TSOCompInvs.html#Invs.otcu">otcu</a></span> :: <span class="id"><a href="TSOCompInvs.html#Invs.tcunits">tcunits</a></span>, <span class="id"><a href="TSOCompInvs.html#Invs.e">e</a></span>) <span class="id"><a href="TSOCompInvs.html#tgm">tgm</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">i_obj</span> : '<span class="id">I_</span>(<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.M">TSOGlobEnv.M</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#GE_mod_sim">GE_mod_sim</a></span> <span class="id">_</span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10198')">Proof.</div>
<div class="proofscript" id="proof10198">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H_client_code</span> <span class="id">H_object_sim</span>. <span class="tactic">clear</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">SGE</span>, <span class="id">TGE</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>. <span class="tactic">clear</span> <span class="id">H3</span> <span class="id">H4</span> <span class="id">H5</span> <span class="id">H6</span> <span class="id">H7</span> <span class="id">H9</span> <span class="id">H10</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>. <span class="tactic">clear</span> <span class="id">H3</span> <span class="id">H4</span> <span class="id">H5</span> <span class="id">H6</span> <span class="id">H7</span> <span class="id">H9</span> <span class="id">H10</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> (@<span class="id"><a href="GlobDefs.html#GlobEnv.mod_num">GlobEnv.mod_num</a></span> <span class="id"><a href="Languages.html#NL">NL</a></span> <span class="id"><a href="Languages.html#L">L</a></span>). <span class="tactic">eauto</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.mod_num">TSOGlobEnv.mod_num</a></span>. <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">M</span> = <span class="id">M0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">revert</span> <span class="id">H_client_code</span> <span class="id">H1</span> <span class="id">H3</span>. <span class="tactic">clear</span>. <span class="tactic">intro</span> <span class="id">H</span>. <span class="id">revert</span> <span class="id">M</span> <span class="id">M0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">H</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">f_equal</span>. <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOGlobSem.html#init_rel_ge_bound">init_rel_ge_bound</a></span>. <span class="tactic">eauto</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOGlobSem.html#init_rel_freelists">init_rel_freelists</a></span>. <span class="tactic">eauto</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="TSOGlobSem.html#init_rel_ge_match">init_rel_ge_match</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span>) <span class="kwd">as</span> <span class="id">Hgenvmatch</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">revert</span> <span class="id">Hgenvmatch</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="TSOGlobSem.html#init_rel_get_mod">init_rel_get_mod</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span>) <span class="kwd">as</span> <span class="id">Hgetmod</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">revert</span> <span class="id">Hgetmod</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">subst</span> <span class="id">freelists0</span> <span class="id">ge_bound0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">spc</span> <span class="id">tpc</span> <span class="id">H</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">clear</span> <span class="id">get_mod_init</span> <span class="id">ge_wd</span> <span class="id">mod_num</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">clear</span> <span class="id">get_mod_init</span> <span class="id">mod_num</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">get_mod</span> <span class="id">modules</span> <span class="id">get_mod0</span> <span class="id">modules0</span> <span class="id">ge_init</span> <span class="id">ge_init0</span> <span class="id">Hgenvmatch</span> <span class="id">Hgetmod</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">H4</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span> (@<span class="id">Ordinal</span> <span class="id">_</span> 0%<span class="id">nat</span> <span class="id">_</span>). <span class="id">Unshelve</span>. 2: <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>.<br/>
&nbsp;get&nbsp;mod&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">destruct</span> (<span class="id">Hgetmod</span> <span class="id">fnid</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">f_equal</span>. <span class="tactic">destruct</span> <span class="id">x</span>, <span class="id">y</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">subst</span>. <span class="tactic">assert</span> (<span class="id">i</span> = <span class="id">i0</span>) <span class="tactic">by</span> <span class="tactic">apply</span> <span class="id"><a href="Axioms.html#proof_irr">proof_irr</a></span>. <span class="tactic">subst</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">specialize</span> (<span class="id">ge_init</span> <span class="id">i_x</span>). <span class="id">specialize</span> (<span class="id">ge_init0</span> <span class="id">i_x</span>).<br/>
&nbsp;modsim&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">ge_init</span> <span class="kwd">as</span> [<span class="id">scu</span> [<span class="id">Hscu</span> <span class="id">Hsinit</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">ge_init0</span> <span class="kwd">as</span> [<span class="id">tcu</span> [<span class="id">Htcu</span> <span class="id">Htinit</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">i_x</span> <span class="kwd">as</span> [<span class="id">x</span> <span class="id">I</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">get_mod</span> <span class="id">get_mod0</span> <span class="id">Hgetmod</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>; [<span class="id">right</span>|<span class="id">left</span>].<br/>
&nbsp;object&nbsp;sim&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">Hscu</span>. <span class="id">inv</span> <span class="id">Htcu</span>. <span class="tactic">split</span>. <span class="id">inv</span> <span class="id">Hsinit</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id"><a href="TSOCompInvs.html#Invs.H_object_sim">H_object_sim</a></span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">revert</span> <span class="id">H</span>. <span class="tactic">unfold</span> <span class="id"><a href="Languages.html#L">L</a></span>. <span class="tactic">simpl</span>. <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>. <span class="tactic">subst</span>. <span class="id">exploit</span> <span class="id">H1</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hgenvmatch</span> (<span class="id">Ordinal</span> <span class="id">I</span>) (<span class="id">Ordinal</span> <span class="id">I</span>)). <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H</span> <span class="kwd">in</span> <span class="id">Hgenvmatch</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">apply</span> <span class="id">Hgenvmatch</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">ms</span> <span class="id">Hsim</span>]. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">f_equal</span>. <span class="tactic">apply</span> <span class="id"><a href="Axioms.html#proof_irr">proof_irr</a></span>.<br/>
&nbsp;client&nbsp;sim&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">clear</span> <span class="id">H_object_sim</span> <span class="id">Ro</span> <span class="id">Go</span> <span class="id">Io</span> <span class="id">oscu</span> <span class="id">otcu</span> <span class="id">e</span> <span class="id">ge_bound</span> <span class="id">freelists</span> <span class="id">tgm</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="GAST.html#lid">lid</a></span> <span class="id"><a href="Languages.html#L">L</a></span> <span class="id">scu</span> = <span class="id"><a href="Languages.html#id1">id1</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">revert</span> <span class="id">Hscu</span> <span class="id">H_client_code</span>. <span class="tactic">clear</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error_In">nth_error_In</a></span> <span class="kwd">in</span> <span class="id">Hscu</span>. <span class="tactic">clear</span> <span class="id">x</span>. <span class="id">revert</span> <span class="id">scu</span> <span class="id">Hscu</span>. <span class="tactic">induction</span> <span class="id"><a href="TSOCompInvs.html#Invs.H_client_code">H_client_code</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">Hscu</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">Hscu</span>. <span class="tactic">simpl</span>. <span class="tactic">auto</span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">scu</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">subst</span> <span class="id">lid</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hsinit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#client_id_cunit_eq">client_id_cunit_eq</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#client_id_nodup">client_id_nodup</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [? ?].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hsinit</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">unfold</span> <span class="id"><a href="Languages.html#L">L</a></span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H3</span>. <span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="AsmClientSim.html#clientsim_hold">clientsim_hold</a></span> <span class="id">tcu</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">H</span>; <span class="tactic">simpl</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="id">econstructor</span>. 2: <span class="tactic">exact</span> <span class="id">H4</span>. <span class="tactic">eauto</span>. <span class="tactic">exact</span> <span class="id">Htinit</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hgenvmatch</span> (<span class="id">Ordinal</span> <span class="id">I</span>) (<span class="id">Ordinal</span> <span class="id">I</span>)). <span class="tactic">rewrite</span> &lt;- <span class="id">H2</span> <span class="kwd">in</span> <span class="id">Hgenvmatch</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hgenvmatch</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">ms</span> <span class="id">Hsim</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="id">inv</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id"><a href="TSOCompInvs.html#Invs.GEInvs">GEInvs</a></span>.<br/>
&nbsp;&nbsp;<br/>
<div class="doc">runtime module invariants </div>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id"><a name="Invs.RMInvs">RMInvs</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">SGE</span>: <span class="id"><a href="GlobDefs.html#GlobEnv.t">GlobEnv.t</a></span>}.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">TGE</span>: <span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.t">TSOGlobEnv.t</a></span>}.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="core_sim_client">core_sim_client</a></span> (<span class="id">iobj</span>: '<span class="id">I_</span>(<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.M">TSOGlobEnv.M</a></span> <span class="id"><a href="TSOCompInvs.html#Invs.RMInvs.TGE">TGE</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="GlobDefs.html#tid">tid</a></span> -&gt; @<span class="id"><a href="GlobDefs.html#Core.t">Core.t</a></span> <span class="id"><a href="TSOCompInvs.html#Invs.RMInvs.SGE">SGE</a></span> -&gt; <span class="id"><a href="GMemory.html#gmem">gmem</a></span> -&gt; @<span class="id"><a href="TSOGlobSem.html#TSOCore.t">TSOCore.t</a></span> <span class="id"><a href="TSOCompInvs.html#Invs.RMInvs.TGE">TGE</a></span> -&gt; <span class="id"><a href="TSOMem.html#tsomem">tsomem</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a name="Core_sim_client">Core_sim_client</a></span>: <span class="kwd">forall</span> (<span class="id">t</span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span>) <span class="id">ix</span> <span class="id">ix</span>' <span class="id">sc</span> <span class="id">tc</span> <span class="id">ms</span> <span class="id">sm</span> <span class="id">tm</span> <span class="id">sg</span> <span class="id">flid</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">H_clientlang</span>: (<span class="id"><a href="InteractionSemantics.html#ModSem.lang">ModSem.lang</a></span> (<span class="id"><a href="GlobDefs.html#GlobEnv.modules">GlobEnv.modules</a></span> <span class="id"><a href="TSOCompInvs.html#Invs.RMInvs.SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#ix">ix</a></span>)) = <span class="id"><a href="AsmLang.html#AsmLang">AsmLang</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">nat_of_ord</span> <span class="id">ix</span>' &lt;&gt; <span class="id">iobj</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="ClientSim.html#clientsim_properties">clientsim_properties</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#Rc">Rc</a></span> <span class="id"><a href="ClientSim.html#Gc">Gc</a></span> <span class="id"><a href="ClientSim.html#Ic">Ic</a></span> (<span class="id"><a href="InteractionSemantics.html#ModSem.lang">ModSem.lang</a></span> (<span class="id"><a href="GlobDefs.html#GlobEnv.modules">GlobEnv.modules</a></span> <span class="id"><a href="TSOCompInvs.html#Invs.RMInvs.SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#ix">ix</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="InteractionSemantics.html#ModSem.Ge">ModSem.Ge</a></span> (<span class="id"><a href="GlobDefs.html#GlobEnv.modules">GlobEnv.modules</a></span> <span class="id"><a href="TSOCompInvs.html#Invs.RMInvs.SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#ix">ix</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="InteractionSemantics.html#ModSem.ge">ModSem.ge</a></span> (<span class="id"><a href="GlobDefs.html#GlobEnv.modules">GlobEnv.modules</a></span> <span class="id"><a href="TSOCompInvs.html#Invs.RMInvs.SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#ix">ix</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.modules">TSOGlobEnv.modules</a></span> <span class="id"><a href="TSOCompInvs.html#Invs.RMInvs.TGE">TGE</a></span> <span class="id">ix</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#ms">ms</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#ms">ms</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> (<span class="id"><a href="TSOCompInvs.html#sc">sc</a></span>, <span class="id"><a href="TSOCompInvs.html#sm">sm</a></span>) (<span class="id"><a href="TSOCompInvs.html#tc">tc</a></span>, <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#core_sim_client">core_sim_client</a></span> <span class="id">iobj</span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> (<span class="id"><a href="GlobDefs.html#Core.Build_t">Core.Build_t</a></span> <span class="id"><a href="TSOCompInvs.html#ix">ix</a></span> <span class="id"><a href="TSOCompInvs.html#sc">sc</a></span> <span class="id"><a href="TSOCompInvs.html#sg">sg</a></span> <span class="id"><a href="TSOCompInvs.html#flid">flid</a></span>) <span class="id"><a href="TSOCompInvs.html#sm">sm</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOCore.Build_t">TSOCore.Build_t</a></span> <span class="id"><a href="TSOCompInvs.html#Invs.RMInvs.TGE">TGE</a></span> <span class="id">ix</span>' <span class="id"><a href="TSOCompInvs.html#tc">tc</a></span> <span class="id"><a href="TSOCompInvs.html#sg">sg</a></span> <span class="id"><a href="TSOCompInvs.html#flid">flid</a></span>) <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="core_sim_object">core_sim_object</a></span> (<span class="id">iobj</span>: '<span class="id">I_</span>(<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.M">TSOGlobEnv.M</a></span> <span class="id"><a href="TSOCompInvs.html#Invs.RMInvs.TGE">TGE</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:  <span class="id"><a href="GlobDefs.html#tid">tid</a></span> -&gt; @<span class="id"><a href="GlobDefs.html#Core.t">Core.t</a></span> <span class="id"><a href="TSOCompInvs.html#Invs.RMInvs.SGE">SGE</a></span> -&gt; <span class="id"><a href="GMemory.html#gmem">gmem</a></span> -&gt; @<span class="id"><a href="TSOGlobSem.html#TSOCore.t">TSOCore.t</a></span> <span class="id"><a href="TSOCompInvs.html#Invs.RMInvs.TGE">TGE</a></span> -&gt; <span class="id"><a href="TSOMem.html#tsomem">tsomem</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a name="Core_sim_object">Core_sim_object</a></span>: <span class="kwd">forall</span> <span class="id">t</span> <span class="id">ix</span> <span class="id">sc</span> <span class="id">tc</span> <span class="id">ms</span> <span class="id">sm</span> <span class="id">tm</span> <span class="id">sg</span> <span class="id">flid</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">H_objectlang</span>: (<span class="id"><a href="InteractionSemantics.html#ModSem.lang">ModSem.lang</a></span> (<span class="id"><a href="GlobDefs.html#GlobEnv.modules">GlobEnv.modules</a></span> <span class="id"><a href="TSOCompInvs.html#Invs.RMInvs.SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#ix">ix</a></span>)) = <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="ObjectSim.html#objectsim_properties">objectsim_properties</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#Invs.Ro">Ro</a></span> <span class="id"><a href="TSOCompInvs.html#Invs.Go">Go</a></span> <span class="id"><a href="TSOCompInvs.html#Invs.Io">Io</a></span> (<span class="id"><a href="InteractionSemantics.html#ModSem.lang">ModSem.lang</a></span> (<span class="id"><a href="GlobDefs.html#GlobEnv.modules">GlobEnv.modules</a></span> <span class="id"><a href="TSOCompInvs.html#Invs.RMInvs.SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#ix">ix</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="InteractionSemantics.html#ModSem.ge">ModSem.ge</a></span> (<span class="id"><a href="GlobDefs.html#GlobEnv.modules">GlobEnv.modules</a></span> <span class="id"><a href="TSOCompInvs.html#Invs.RMInvs.SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#ix">ix</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="InteractionSemantics.html#ModSem.Ge">ModSem.Ge</a></span> (<span class="id"><a href="GlobDefs.html#GlobEnv.modules">GlobEnv.modules</a></span> <span class="id"><a href="TSOCompInvs.html#Invs.RMInvs.SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#ix">ix</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.modules">TSOGlobEnv.modules</a></span> <span class="id"><a href="TSOCompInvs.html#Invs.RMInvs.TGE">TGE</a></span> <span class="id">iobj</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#ms">ms</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#ms">ms</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> (<span class="id"><a href="TSOCompInvs.html#sc">sc</a></span>, <span class="id"><a href="TSOCompInvs.html#sm">sm</a></span>) (<span class="id"><a href="TSOCompInvs.html#tc">tc</a></span>, <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#core_sim_object">core_sim_object</a></span> <span class="id">iobj</span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> (<span class="id"><a href="GlobDefs.html#Core.Build_t">Core.Build_t</a></span> <span class="id"><a href="TSOCompInvs.html#ix">ix</a></span> <span class="id"><a href="TSOCompInvs.html#sc">sc</a></span> <span class="id"><a href="TSOCompInvs.html#sg">sg</a></span> <span class="id"><a href="TSOCompInvs.html#flid">flid</a></span>) <span class="id"><a href="TSOCompInvs.html#sm">sm</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOCore.Build_t">TSOCore.Build_t</a></span> <span class="id"><a href="TSOCompInvs.html#Invs.RMInvs.TGE">TGE</a></span> <span class="id">iobj</span> <span class="id"><a href="TSOCompInvs.html#tc">tc</a></span> <span class="id"><a href="TSOCompInvs.html#sg">sg</a></span> <span class="id"><a href="TSOCompInvs.html#flid">flid</a></span>) <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id"><a href="TSOCompInvs.html#Invs.RMInvs">RMInvs</a></span>.<br/>
<br/>
<div class="doc">thread pool invariants </div>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="ThreadClientSim">ThreadClientSim</a></span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">sm</span>: <span class="id"><a href="GMemory.html#gmem">gmem</a></span>) (<span class="id">tm</span>: <span class="id"><a href="TSOMem.html#tsomem">tsomem</a></span>) (<span class="id">t</span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">scs</span>: @<span class="id"><a href="GlobDefs.html#CallStack.t">CallStack.t</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span>) (<span class="id">tcs</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (@<span class="id"><a href="TSOGlobSem.html#TSOCore.t">TSOCore.t</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span>)) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">List.Forall2</a></span> (<span class="kwd">fun</span> <span class="id">sc</span> <span class="id">tc</span> =&gt; <span class="id"><a href="TSOCompInvs.html#core_sim_client">core_sim_client</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#sc">sc</a></span> <span class="id"><a href="TSOCompInvs.html#sm">sm</a></span> <span class="id"><a href="TSOCompInvs.html#tc">tc</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span>) <span class="id"><a href="TSOCompInvs.html#scs">scs</a></span> <span class="id"><a href="TSOCompInvs.html#tcs">tcs</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="ThreadClientSim_Sta_Gc">ThreadClientSim_Sta_Gc</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">sm</span> <span class="id">tm</span> <span class="id">t</span> <span class="id">scs</span> <span class="id">tcs</span> <span class="id">sm</span>' <span class="id">tm</span>' <span class="id">t</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hsep</span>: <span class="id"><a href="RGRels.html#sep_obj_client_block">sep_obj_client_block</a></span> <span class="id">sm</span>'),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#Gc">Gc</a></span> <span class="id">t</span>' <span class="id"><a href="TSOCompInvs.html#sm">sm</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span> <span class="id">sm</span>' <span class="id">tm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#ThreadClientSim">ThreadClientSim</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#sm">sm</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#scs">scs</a></span> <span class="id"><a href="TSOCompInvs.html#tcs">tcs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#ThreadClientSim">ThreadClientSim</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id">sm</span>' <span class="id">tm</span>' <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#scs">scs</a></span> <span class="id"><a href="TSOCompInvs.html#tcs">tcs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10199')">Proof.</div>
<div class="proofscript" id="proof10199">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">induction</span> <span class="id">H0</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="ClientSim.html#match_rely">ClientSim.match_rely</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#Invs.H_rg_cc">H_rg_cc</a></span>; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="ThreadClientSim_Sta_Go">ThreadClientSim_Sta_Go</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">ge</span> <span class="id">sm</span> <span class="id">tm</span> <span class="id">t</span> <span class="id">scs</span> <span class="id">tcs</span> <span class="id">sm</span>' <span class="id">tm</span>' <span class="id">t</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hsep</span>: <span class="id"><a href="RGRels.html#sep_obj_client_block">sep_obj_client_block</a></span> <span class="id">sm</span>'),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#Ic">Ic</a></span> <span class="id"><a href="TSOCompInvs.html#sm">sm</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#Invs.Go">Go</a></span> <span class="id"><a href="TSOCompInvs.html#ge">ge</a></span> <span class="id">t</span>' <span class="id"><a href="TSOCompInvs.html#sm">sm</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span> <span class="id">sm</span>' <span class="id">tm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#ThreadClientSim">ThreadClientSim</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#sm">sm</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#scs">scs</a></span> <span class="id"><a href="TSOCompInvs.html#tcs">tcs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#ThreadClientSim">ThreadClientSim</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id">sm</span>' <span class="id">tm</span>' <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#scs">scs</a></span> <span class="id"><a href="TSOCompInvs.html#tcs">tcs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10200')">Proof.</div>
<div class="proofscript" id="proof10200">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">induction</span> <span class="id">H1</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="ClientSim.html#match_rely">ClientSim.match_rely</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#Invs.H_rg_oc">H_rg_oc</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="ThreadClientSim_Sta_UB">ThreadClientSim_Sta_UB</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">sm</span> <span class="id">tm</span> <span class="id">t</span> <span class="id">scs</span> <span class="id">tcs</span> <span class="id">sm</span>' <span class="id">tm</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hsep</span>: <span class="id"><a href="RGRels.html#sep_obj_client_block">sep_obj_client_block</a></span> <span class="id">sm</span>'),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#Ic">Ic</a></span> <span class="id"><a href="TSOCompInvs.html#sm">sm</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html#G_ub">G_ub</a></span> <span class="id"><a href="TSOCompInvs.html#sm">sm</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span> <span class="id">sm</span>' <span class="id">tm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#ThreadClientSim">ThreadClientSim</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#sm">sm</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#scs">scs</a></span> <span class="id"><a href="TSOCompInvs.html#tcs">tcs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#ThreadClientSim">ThreadClientSim</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id">sm</span>' <span class="id">tm</span>' <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#scs">scs</a></span> <span class="id"><a href="TSOCompInvs.html#tcs">tcs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10201')">Proof.</div>
<div class="proofscript" id="proof10201">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">induction</span> <span class="id">H1</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="ClientSim.html#match_rely">ClientSim.match_rely</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#Invs.H_rg_ub_c">H_rg_ub_c</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="ThreadSim">ThreadSim</a></span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">iobj</span> (<span class="id">sm</span>: <span class="id"><a href="GMemory.html#gmem">gmem</a></span>) (<span class="id">tm</span>: <span class="id"><a href="TSOMem.html#tsomem">tsomem</a></span>) (<span class="id">t</span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: @<span class="id"><a href="GlobDefs.html#CallStack.t">CallStack.t</a></span> <span class="id">SGE</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (@<span class="id"><a href="TSOGlobSem.html#TSOCore.t">TSOCore.t</a></span> <span class="id">TGE</span>) -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="ThreadSimClient">ThreadSimClient</a></span>: <span class="kwd">forall</span> <span class="id">scs</span> <span class="id">tcs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#ThreadClientSim">ThreadClientSim</a></span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">iobj</span> <span class="id">sm</span> <span class="id">tm</span> <span class="id">t</span> <span class="id"><a href="TSOCompInvs.html#scs">scs</a></span> <span class="id"><a href="TSOCompInvs.html#tcs">tcs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#ThreadSim">ThreadSim</a></span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">iobj</span> <span class="id">sm</span> <span class="id">tm</span> <span class="id">t</span> <span class="id"><a href="TSOCompInvs.html#scs">scs</a></span> <span class="id"><a href="TSOCompInvs.html#tcs">tcs</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a name="ThreadSimObject">ThreadSimObject</a></span>: <span class="kwd">forall</span> <span class="id">sc</span> <span class="id">scs</span> <span class="id">tc</span> <span class="id">tcs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#core_sim_object">core_sim_object</a></span> <span class="id">iobj</span> <span class="id">t</span> <span class="id"><a href="TSOCompInvs.html#sc">sc</a></span> <span class="id">sm</span> <span class="id"><a href="TSOCompInvs.html#tc">tc</a></span> <span class="id">tm</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#ThreadClientSim">ThreadClientSim</a></span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">iobj</span> <span class="id">sm</span> <span class="id">tm</span> <span class="id">t</span> <span class="id"><a href="TSOCompInvs.html#scs">scs</a></span> <span class="id"><a href="TSOCompInvs.html#tcs">tcs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#ThreadSim">ThreadSim</a></span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">iobj</span> <span class="id">sm</span> <span class="id">tm</span> <span class="id">t</span> (<span class="id"><a href="TSOCompInvs.html#sc">sc</a></span> :: <span class="id"><a href="TSOCompInvs.html#scs">scs</a></span>) (<span class="id"><a href="TSOCompInvs.html#tc">tc</a></span> :: <span class="id"><a href="TSOCompInvs.html#tcs">tcs</a></span>).<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Record</span> <span class="id"><a name="ThreadSims">ThreadSims</a></span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">iobj</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">stp</span>: @<span class="id"><a href="GlobDefs.html#ThreadPool.t">ThreadPool.t</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span>) (<span class="id">ttp</span>: @<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.t">TSOThrdPool.t</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">sm</span>: <span class="id"><a href="GMemory.html#gmem">gmem</a></span>) (<span class="id">tm</span>: <span class="id"><a href="TSOMem.html#tsomem">tsomem</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="thread_simulation">thread_simulation</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Coqlib.html#option_rel">option_rel</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOCompInvs.html#ThreadSim">ThreadSim</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#iobj">iobj</a></span> <span class="id"><a href="TSOCompInvs.html#sm">sm</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span> <span class="id"><a href="TSOCompInvs.html#stp">stp</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Maps.html#PMap.get">PMap.get</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> (<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id"><a href="TSOCompInvs.html#ttp">ttp</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="tp_inv_src">tp_inv_src</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#ThreadPool.inv">ThreadPool.inv</a></span> <span class="id"><a href="TSOCompInvs.html#stp">stp</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="valid_tid_eq">valid_tid_eq</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#ThreadPool.next_tid">ThreadPool.next_tid</a></span> <span class="id"><a href="TSOCompInvs.html#stp">stp</a></span> = <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.next_tid">TSOThrdPool.next_tid</a></span> <span class="id"><a href="TSOCompInvs.html#ttp">ttp</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="next_fmap_eq">next_fmap_eq</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span>, <span class="id"><a href="GlobDefs.html#ThreadPool.next_fmap">ThreadPool.next_fmap</a></span> <span class="id"><a href="TSOCompInvs.html#stp">stp</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> = <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.next_fmap">TSOThrdPool.next_fmap</a></span> <span class="id"><a href="TSOCompInvs.html#ttp">ttp</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="ge_mod_sim_thdp_init_thrdsims">ge_mod_sim_thdp_init_thrdsims</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">stp</span> <span class="id">ttp</span> <span class="id">sm</span> <span class="id">tm</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#GE_mod_sim">GE_mod_sim</a></span> <span class="id">_</span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="GlobDefs.html#ThreadPool.init">ThreadPool.init</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#Invs.e">e</a></span> <span class="id"><a href="TSOCompInvs.html#stp">stp</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.init">TSOThrdPool.init</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#Invs.e">e</a></span> <span class="id"><a href="TSOCompInvs.html#ttp">ttp</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#GlobEnv.init_mem">GlobEnv.init_mem</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#sm">sm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.init_mem">TSOGlobEnv.init_mem</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_sc_initRel">tso_sc_initRel</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#sm">sm</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#ThreadSims">ThreadSims</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#stp">stp</a></span> <span class="id"><a href="TSOCompInvs.html#ttp">ttp</a></span> <span class="id"><a href="TSOCompInvs.html#sm">sm</a></span> (<span class="id"><a href="TSOMem.html#tsomem_init">tsomem_init</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10202')">Proof.</div>
<div class="proofscript" id="proof10202">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">stp</span> <span class="id">ttp</span> <span class="id">sm</span> <span class="id">tm</span> <span class="id">GEMODSIM</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">SGE</span>, <span class="id">TGE</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">GEMODSIM</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Eqdep.html#EqdepTheory.inj_pair2">Eqdep.EqdepTheory.inj_pair2</a></span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Eqdep.html#EqdepTheory.inj_pair2">Eqdep.EqdepTheory.inj_pair2</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Eqdep.html#EqdepTheory.inj_pair2">Eqdep.EqdepTheory.inj_pair2</a></span> <span class="kwd">in</span> <span class="id">H7</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Eqdep.html#EqdepTheory.inj_pair2">Eqdep.EqdepTheory.inj_pair2</a></span> <span class="kwd">in</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">get_mod2</span> <span class="id">modules2</span> <span class="id">get_mod0</span> <span class="id">modules0</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H10</span> <span class="id">H2</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">H10</span> <span class="id">H2</span> <span class="id">STPINIT</span> <span class="id">TTPINIT</span> <span class="id">SINITMEM</span> <span class="id">TINITMEM</span> <span class="id">Hinitrel</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#tso_sc_initRel_Ic">tso_sc_initRel_Ic</a></span>. <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">HIc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">get_mod</span>' = <span class="id">get_mod</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="Axioms.html#functional_extensionality">functional_extensionality</a></span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">get_mod</span>'. <span class="tactic">clear</span> <span class="id">H2</span>. <span class="tactic">rename</span> <span class="id">H10</span> <span class="id">into</span> <span class="id">Hsim</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> (<span class="id">Hsim</span> <span class="id">i_obj</span>). <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [[<span class="id">_</span> <span class="id">H</span>]|[<span class="id">H</span> <span class="id">_</span>]]; [<span class="tactic">congruence</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="tactic">rename</span> <span class="id">H0</span> <span class="id">into</span> <span class="id">Hobj</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="ObjectSim.html#match_initmem">match_initmem</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">SINITMEM</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">specialize</span> (<span class="id">H</span> <span class="id">i_obj</span>). <span class="tactic">rewrite</span> &lt;-<span class="id">Hobj</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">eapply</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">TINITMEM</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">specialize</span> (<span class="id">H</span> <span class="id">i_obj</span>). <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">HIo</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">stp</span> <span class="id">ttp</span> <span class="id">STPINIT</span> <span class="id">TTPINIT</span>. <span class="tactic">induction</span> <span class="id"><a href="TSOCompInvs.html#Invs.e">e</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">STPINIT</span>; <span class="id">inv</span> <span class="id">TTPINIT</span>. <span class="id">econstructor</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span>. <span class="tactic">simpl</span>. <span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gi">PMap.gi</a></span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="GlobDefs.html#ThreadPool.emp_inv">ThreadPool.emp_inv</a></span>. <span class="tactic">auto</span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">STPINIT</span>. <span class="id">inv</span> <span class="id">TTPINIT</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">IHe0</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">H</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.spawn">ThreadPool.spawn</a></span>, <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.spawn">TSOThrdPool.spawn</a></span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#valid_tid_eq">valid_tid_eq</a></span>. <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">Hnext</span>. <span class="tactic">rewrite</span> <span class="id">Hnext</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">t</span>. <span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> (<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.next_tid">TSOThrdPool.next_tid</a></span> <span class="id">thdp0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;new&nbsp;core&nbsp;sim&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H</span>. <span class="tactic">subst</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span>; <span class="tactic">simpl</span>. <span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#next_fmap_eq">next_fmap_eq</a></span>. <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">Hfmap</span>. <span class="tactic">rewrite</span> <span class="id">Hfmap</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H4</span>. <span class="id">inv</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOCompInvs.html#ordinal_eq_dec">ordinal_eq_dec</a></span> <span class="id">_</span> <span class="id">m_id0</span> <span class="id">i_obj</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;object&nbsp;core&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">exists</span> <span class="id">ms</span>, <span class="id"><a href="ObjectSim.html#objectsim_properties">objectsim_properties</a></span> <span class="id"><a href="TSOCompInvs.html#Invs.Ro">Ro</a></span> <span class="id"><a href="TSOCompInvs.html#Invs.Go">Go</a></span> <span class="id"><a href="TSOCompInvs.html#Invs.Io">Io</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="InteractionSemantics.html#ModSem.ge">ModSem.ge</a></span> (<span class="id">modules</span> <span class="id">i_obj</span>)) (<span class="id"><a href="InteractionSemantics.html#ModSem.Ge">ModSem.Ge</a></span> (<span class="id">modules</span> <span class="id">i_obj</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">modules</span>' <span class="id">i_obj</span>) <span class="id"><a href="TSOCompInvs.html#ms">ms</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> &lt;- <span class="id">Hobj</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">ms</span>' <span class="id">Hobjsim</span>]. <span class="tactic">clear</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">m_id0</span>. <span class="id">exploit</span> <span class="id"><a href="ObjectSim.html#match_init">match_init</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">sc</span> &amp; <span class="id">Hinit</span> &amp; <span class="id">Hmatch</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#ThreadSimObject">ThreadSimObject</a></span>. <span class="id">econstructor</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">Hobj</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">sc</span> = <span class="id">cc</span>). <span class="tactic">rewrite</span> <span class="id">H5</span> <span class="kwd">in</span> <span class="id">Hinit</span>. <span class="id">inv</span> <span class="id">Hinit</span>. <span class="tactic">auto</span>. <span class="tactic">subst</span> <span class="id">sc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hmatch</span>. <span class="tactic">auto</span>. <span class="id">econstructor</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;client&nbsp;core&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> (<span class="id">Hsim</span> <span class="id">m_id0</span>) <span class="kwd">as</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [[<span class="id">H</span> <span class="id">_</span>] | [<span class="id">_</span> <span class="id">H</span>]]; [|<span class="tactic">congruence</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">exists</span> <span class="id">ms0</span>',  <span class="id"><a href="ClientSim.html#clientsim_properties">clientsim_properties</a></span> <span class="id"><a href="ClientSim.html#Rc">Rc</a></span> <span class="id"><a href="ClientSim.html#Gc">Gc</a></span> <span class="id"><a href="ClientSim.html#Ic">Ic</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="InteractionSemantics.html#ModSem.Ge">ModSem.Ge</a></span> (<span class="id">modules</span> <span class="id">m_id0</span>)) (<span class="id"><a href="InteractionSemantics.html#ModSem.ge">ModSem.ge</a></span> (<span class="id">modules</span> <span class="id">m_id0</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">modules</span>' <span class="id">m_id0</span>) <span class="id">ms0</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> &lt;- <span class="id">H0</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">ms0</span>' <span class="id">Hcltsim</span>]. <span class="tactic">clear</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="ClientSim.html#match_init">ClientSim.match_init</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">sc</span> &amp; <span class="id">Hinit</span> &amp; <span class="id">Hmatch</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#ThreadSimClient">ThreadSimClient</a></span>. <span class="id">econstructor</span>. <span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H0</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id">n</span>. <span class="id">revert</span> <span class="id">H</span>; <span class="tactic">clear</span>. <span class="tactic">destruct</span> <span class="id">m_id0</span>, <span class="id">i_obj</span>. <span class="tactic">simpl</span>. <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">f_equal</span>. <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="Axioms.html#proof_irr">proof_irr</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">sc</span> = <span class="id">cc</span>). <span class="tactic">rewrite</span> <span class="id">H5</span> <span class="kwd">in</span> <span class="id">Hinit</span>. <span class="id">inv</span> <span class="id">Hinit</span>. <span class="tactic">auto</span>. <span class="tactic">subst</span> <span class="id">sc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hmatch</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOGlobSem.html#init_rel_sgm_sep">init_rel_sgm_sep</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;old&nbsp;core&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thread_simulation">thread_simulation</a></span>. <span class="tactic">eauto</span>. <span class="id">instantiate</span> (1:= <span class="id">t</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span>; <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">auto</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#ThreadPool.spawn_inv">ThreadPool.spawn_inv</a></span>. <span class="tactic">eauto</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">simpl</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">simpl</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">intro</span>. <span class="id">specialize</span> (<span class="id">next_fmap_eq0</span> <span class="id">t</span>). <span class="tactic">rewrite</span> <span class="id">next_fmap_eq0</span>, <span class="id">valid_tid_eq0</span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="GE_mod_sim_source_lang_asm_or_spec">GE_mod_sim_source_lang_asm_or_spec</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">M</span> <span class="id">i_obj</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#GE_mod_sim">GE_mod_sim</a></span> <span class="id"><a href="TSOCompInvs.html#M">M</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ix</span>, <span class="id"><a href="InteractionSemantics.html#ModSem.lang">ModSem.lang</a></span> (<span class="id"><a href="GlobDefs.html#GlobEnv.modules">GlobEnv.modules</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#ix">ix</a></span>) = <span class="id"><a href="AsmLang.html#AsmLang">AsmLang</a></span> \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#ModSem.lang">ModSem.lang</a></span> (<span class="id"><a href="GlobDefs.html#GlobEnv.modules">GlobEnv.modules</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#ix">ix</a></span>) = <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10203')">Proof.</div>
<div class="proofscript" id="proof10203">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">H1</span> <span class="id">ix</span>) <span class="kwd">as</span> [[<span class="id">Hasm</span> <span class="id">_</span>]|[<span class="id">Hspec</span> <span class="id">_</span>]]; [<span class="id">inv</span> <span class="id">Hasm</span>|<span class="id">inv</span> <span class="id">Hspec</span>]; <span class="tactic">simpl</span>; [<span class="id">left</span>|<span class="id">right</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="fl_valid_eq">fl_valid_eq</a></span> (<span class="id">t</span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span>) (<span class="id">fl</span>: <span class="id"><a href="MemAux.html#freelist">MemAux.freelist</a></span>) (<span class="id">sm</span>: <span class="id"><a href="GMemory.html#gmem">gmem</a></span>) (<span class="id">tm</span>: <span class="id"><a href="TSOMem.html#tsomem">tsomem</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tgm</span>', <span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span>) (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">tgm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">b</span> <span class="id">n</span>, <span class="id"><a href="GlobDefs.html#FLists.get_block">FLists.get_block</a></span> <span class="id"><a href="TSOCompInvs.html#fl">fl</a></span> <span class="id"><a href="TSOCompInvs.html#n">n</a></span> = <span class="id"><a href="TSOCompInvs.html#b">b</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span> <span class="id"><a href="TSOCompInvs.html#sm">sm</a></span> <span class="id"><a href="TSOCompInvs.html#b">b</a></span> &lt;-&gt; <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span> <span class="id">tgm</span>' <span class="id"><a href="TSOCompInvs.html#b">b</a></span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="thread_buffered_alloc_local">thread_buffered_alloc_local</a></span> <span class="id">fls</span> <span class="id">tm</span> : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id"><a href="TSOCompInvs.html#b">b</a></span> <span class="id"><a href="TSOCompInvs.html#lo">lo</a></span> <span class="id"><a href="TSOCompInvs.html#hi">hi</a></span>) (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">fn</span> <span class="id">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">fl</span> := <span class="id"><a href="GlobDefs.html#FLists.get_tfl">FLists.get_tfl</a></span> <span class="id"><a href="TSOCompInvs.html#fls">fls</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#fn">fn</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#b">b</a></span> = <span class="id"><a href="GlobDefs.html#FLists.get_block">FLists.get_block</a></span> <span class="id"><a href="TSOCompInvs.html#fl">fl</a></span> <span class="id"><a href="TSOCompInvs.html#n">n</a></span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Record</span> <span class="id"><a name="MS">MS</a></span> (<span class="id">SGE</span>: <span class="id"><a href="GlobDefs.html#GlobEnv.t">GlobEnv.t</a></span>) (<span class="id">TGE</span>: <span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.t">TSOGlobEnv.t</a></span>) (<span class="id">i_obj</span>: '<span class="id">I_</span>(<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.M">TSOGlobEnv.M</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">spc</span>: @<span class="id"><a href="GlobDefs.html#ProgConfig">ProgConfig</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span>) (<span class="id">tpc</span>: @<span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span>): <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="GE_wd">GE_wd</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#GlobEnv.wd">GlobEnv.wd</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="GE_eq">GE_eq</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#GE_mod_sim">GE_mod_sim</a></span> (<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.M">TSOGlobEnv.M</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span>) <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="tid_eq">tid_eq</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#cur_tid">cur_tid</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> = <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="atom_bit_0">atom_bit_0</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#atom_bit">atom_bit</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> = <span class="id"><a href="GlobDefs.html#O">O</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="mem_inv_client">mem_inv_client</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#Ic">Ic</a></span> (<span class="id"><a href="GlobDefs.html#gm">gm</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span>) (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="mem_inv_object">mem_inv_object</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#Invs.Io">Io</a></span> (<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.modules">TSOGlobEnv.modules</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GlobDefs.html#gm">gm</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span>) (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>);<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="source_safe">source_safe</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ETrace.html#safe_state">safe_state</a></span> <span class="id"><a href="GlobSemantics.html#glob_step">glob_step</a></span> <span class="id"><a href="GlobSemantics.html#abort">GlobSemantics.abort</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="source_drf">source_drf</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="DRF.html#star_race_config">star_race_config</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="thdp_sims">thdp_sims</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#ThreadSims">ThreadSims</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> (<span class="id"><a href="GlobDefs.html#thread_pool">thread_pool</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span>) (<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) (<span class="id"><a href="GlobDefs.html#gm">gm</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span>) (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>);<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="fls_embed">fls_embed</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOStepAuxLemmas.html#FLs_embed">FLs_embed</a></span> (<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.freelists">TSOGlobEnv.freelists</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span>) <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>.(<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="inv_thdp">inv_thdp</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#inv">inv</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> (<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="buffered_alloc_local">buffered_alloc_local</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#thread_buffered_alloc_local">thread_buffered_alloc_local</a></span> (<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.freelists">TSOGlobEnv.freelists</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span>) (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>);<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="fl_valid_match">fl_valid_match</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">fn</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">fl</span> := <span class="id"><a href="GlobDefs.html#FLists.get_tfl">FLists.get_tfl</a></span> (<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.freelists">TSOGlobEnv.freelists</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span>) <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#fn">fn</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#fl_valid_eq">fl_valid_eq</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#fl">fl</a></span> (<span class="id"><a href="GlobDefs.html#gm">gm</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span>) (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="MS_sep_obj_client_blocks">MS_sep_obj_client_blocks</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html#sep_obj_client_block">sep_obj_client_block</a></span> (<span class="id"><a href="GlobDefs.html#gm">gm</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="MS_tge_flwd">MS_tge_flwd</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i</span> <span class="id">spc</span> <span class="id">tpc</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#MS">MS</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i">i</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#FLists.wd">FLists.wd</a></span> (<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.freelists">TSOGlobEnv.freelists</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10204')">Proof.</div>
<div class="proofscript" id="proof10204">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> 1. <span class="tactic">destruct</span> <span class="id">GE_wd0</span>. <span class="id">inv</span> <span class="id">GE_eq0</span>. <span class="tactic">destruct</span> <span class="id">TGE</span>;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">H3</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="apply_buffer_item_validity_eq_stable">apply_buffer_item_validity_eq_stable</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">tm1</span> <span class="id">tm2</span> <span class="id">bi</span> <span class="id">tm1</span>' <span class="id">tm2</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span> <span class="id"><a href="TSOCompInvs.html#tm1">tm1</a></span> <span class="id"><a href="TSOCompInvs.html#b">b</a></span> &lt;-&gt; <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span> <span class="id"><a href="TSOCompInvs.html#tm2">tm2</a></span> <span class="id"><a href="TSOCompInvs.html#b">b</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span> <span class="id"><a href="TSOCompInvs.html#tm1">tm1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">tm1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span> <span class="id"><a href="TSOCompInvs.html#tm2">tm2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">tm2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span> <span class="id">tm1</span>' <span class="id"><a href="TSOCompInvs.html#b">b</a></span> &lt;-&gt; <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span> <span class="id">tm2</span>' <span class="id"><a href="TSOCompInvs.html#b">b</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10205')">Proof.</div>
<div class="proofscript" id="proof10205">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span> <span class="id">b</span> <span class="id">tm1</span> <span class="id">tm2</span> <span class="id">bi</span> <span class="id">tm1</span>' <span class="id">tm2</span>' <span class="id">Heq</span> <span class="id">A</span> <span class="id">B</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;alloc&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="kwd">in</span> *. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">A</span>; <span class="id">inv</span> <span class="id">B</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>. <span class="tactic">simpl</span>. <span class="tactic">tauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#free">free</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="TSOMem.html#range_perm_dec">range_perm_dec</a></span>; <span class="id">inv</span> <span class="id">A</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="TSOMem.html#range_perm_dec">range_perm_dec</a></span>; <span class="id">inv</span> <span class="id">B</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unchecked_free">unchecked_free</a></span>; <span class="tactic">simpl</span>. <span class="tactic">tauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="TSOMem.html#valid_access_dec">valid_access_dec</a></span>; <span class="id">inv</span> <span class="id">A</span>. <span class="tactic">destruct</span> <span class="id"><a href="TSOMem.html#valid_access_dec">valid_access_dec</a></span>; <span class="id">inv</span> <span class="id">B</span>. <span class="tactic">tauto</span>. }<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="apply_buffer_validity_eq_stable">apply_buffer_validity_eq_stable</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">tm1</span> <span class="id">tm2</span> <span class="id">buf</span> <span class="id">tm1</span>' <span class="id">tm2</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span> <span class="id"><a href="TSOCompInvs.html#tm1">tm1</a></span> <span class="id"><a href="TSOCompInvs.html#b">b</a></span> &lt;-&gt; <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span> <span class="id"><a href="TSOCompInvs.html#tm2">tm2</a></span> <span class="id"><a href="TSOCompInvs.html#b">b</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOCompInvs.html#buf">buf</a></span> <span class="id"><a href="TSOCompInvs.html#tm1">tm1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">tm1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOCompInvs.html#buf">buf</a></span> <span class="id"><a href="TSOCompInvs.html#tm2">tm2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">tm2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span> <span class="id">tm1</span>' <span class="id"><a href="TSOCompInvs.html#b">b</a></span> &lt;-&gt; <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span> <span class="id">tm2</span>' <span class="id"><a href="TSOCompInvs.html#b">b</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10206')">Proof.</div>
<div class="proofscript" id="proof10206">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span> <span class="id">b</span> <span class="id">tm1</span> <span class="id">tm2</span> <span class="id">buf</span>. <span class="id">revert</span> <span class="id">tm1</span> <span class="id">tm2</span>. <span class="tactic">induction</span> <span class="id">buf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H0</span>; <span class="id">inv</span> <span class="id">H1</span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">tm1</span> <span class="id">tm2</span> <span class="id">tm2</span>' <span class="id">tm1</span>' <span class="id">Heq</span> <span class="id">Happly2</span> <span class="id">Happly1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Happly1</span>. <span class="id">inv</span> <span class="id">Happly2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">tm1</span>) <span class="id">eqn</span>:<span class="id">A</span>; [|<span class="tactic">discriminate</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">tm2</span>) <span class="id">eqn</span>:<span class="id">B</span>; [|<span class="tactic">discriminate</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">eapply</span> <span class="id">IHbuf</span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H1</span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H0</span>; <span class="tactic">clear</span> <span class="id">H0</span> <span class="id">H1</span> <span class="id">IHbuf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#apply_buffer_item_validity_eq_stable">apply_buffer_item_validity_eq_stable</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="buffered_alloc_local_fl_valid_match_preserve_by_unbuffer">buffered_alloc_local_fl_valid_match_preserve_by_unbuffer</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fls</span> <span class="id">sm</span> <span class="id">tm</span> <span class="id">t</span> <span class="id">tm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#FLists.wd">FLists.wd</a></span> <span class="id"><a href="TSOCompInvs.html#fls">fls</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#thread_buffered_alloc_local">thread_buffered_alloc_local</a></span> <span class="id"><a href="TSOCompInvs.html#fls">fls</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">t</span> <span class="id">fn</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">fl</span> := <span class="id"><a href="GlobDefs.html#FLists.get_tfl">FLists.get_tfl</a></span> <span class="id"><a href="TSOCompInvs.html#fls">fls</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#fn">fn</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#fl_valid_eq">fl_valid_eq</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#fl">fl</a></span> <span class="id"><a href="TSOCompInvs.html#sm">sm</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer">unbuffer</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">tm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">t</span> <span class="id">fn</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">fl</span> := <span class="id"><a href="GlobDefs.html#FLists.get_tfl">FLists.get_tfl</a></span> <span class="id"><a href="TSOCompInvs.html#fls">fls</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#fn">fn</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#fl_valid_eq">fl_valid_eq</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#fl">fl</a></span> <span class="id"><a href="TSOCompInvs.html#sm">sm</a></span> <span class="id">tm</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10207')">Proof.</div>
<div class="proofscript" id="proof10207">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span> <span class="id">fls</span> <span class="id">sm</span> <span class="id">tm</span> <span class="id">t</span> <span class="id">tm</span>' <span class="id">Hwd</span> <span class="id">HUBS</span> <span class="id">Hbuffered_local</span> <span class="id">Hvalid_eq</span> <span class="id">Hunbuffer</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hvalid_eq</span>. <span class="id">specialize</span> (<span class="id">Hvalid_eq</span> <span class="id">t0</span> <span class="id">fn</span>). <span class="tactic">subst</span> <span class="id">fl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unbuffer">unbuffer</a></span> <span class="kwd">in</span> <span class="id">Hunbuffer</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">subst</span>. <span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span> <span class="id">t0</span>) <span class="id">eqn</span>:<span class="id">Hbuffer</span>. <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">b</span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">tm</span>)) <span class="id">eqn</span>:<span class="id">Happly</span>; <span class="id">inv</span> <span class="id">Hunbuffer</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Hvalid_eq</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOCompInvs.html#fl_valid_eq">fl_valid_eq</a></span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>;[|<span class="id">contradiction</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hbuffer</span> <span class="kwd">in</span> <span class="id">Hvalid_eq</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hvalid_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Happly</span> <span class="kwd">in</span> <span class="id">Hvalid_eq</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hvalid_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hvalid_eq</span> <span class="id">tgm</span>' <span class="id">H</span> <span class="id">b1</span> <span class="id">n</span> <span class="id">H0</span>). <span class="tactic">tauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span> <span class="id">t</span>) <span class="id">eqn</span>:<span class="id">Hbuffer</span>. <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">b</span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">tm</span>)) <span class="id">eqn</span>: <span class="id">Happly</span>; <span class="id">inv</span> <span class="id">Hunbuffer</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOCompInvs.html#fl_valid_eq">fl_valid_eq</a></span> <span class="kwd">in</span> *. <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>. <span class="tactic">congruence</span>. <span class="tactic">clear</span> <span class="id">n1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span> <span class="kwd">as</span> [<span class="id">bufs</span> <span class="id">tgm</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOMemLemmas.html#unbuffer_safe_apply_buffer">TSOMemLemmas.unbuffer_safe_apply_buffer</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1:= <span class="id">t0</span>). <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">intros</span> [<span class="id">tgm</span>'' <span class="id">Happlybuf</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hvalid_eq</span> <span class="id">tgm</span>'' <span class="id">Happlybuf</span> <span class="id">b1</span> <span class="id">n0</span> <span class="id">H0</span>). <span class="tactic">rewrite</span> <span class="id">Hvalid_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Happly</span> <span class="id">H</span> <span class="id">Happlybuf</span>. <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span> <span class="id">g</span> <span class="id">b1</span> &lt;-&gt; <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span> <span class="id">tgm</span> <span class="id">b1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">b</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;alloc&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Hbuffered_local</span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">Hbuffer</span>. <span class="tactic">simpl</span>. <span class="id">left</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">intros</span> (<span class="id">fn</span>' &amp; <span class="id">n</span>' &amp; <span class="id">Hb</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">b</span> &lt;&gt; <span class="id">b1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">subst</span> <span class="id">b</span> <span class="id">b1</span>. <span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#FLists.flist_disj">FLists.flist_disj</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#FLists.thread_fl_disj">FLists.thread_fl_disj</a></span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Hb</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Happly</span>. <span class="id">inv</span> <span class="id">Happly</span>. <span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Happly</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#free">free</a></span> <span class="kwd">in</span> <span class="id">Happly</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="TSOMem.html#range_perm_dec">range_perm_dec</a></span>; <span class="id">inv</span> <span class="id">Happly</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unchecked_free">unchecked_free</a></span>; <span class="tactic">simpl</span>. <span class="tactic">tauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Happly</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="kwd">in</span> <span class="id">Happly</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="TSOMem.html#valid_access_dec">valid_access_dec</a></span>; <span class="id">inv</span> <span class="id">Happly</span>. <span class="tactic">tauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H</span>. <span class="tactic">clear</span>. <span class="tactic">generalize</span> (<span class="id">bufs</span> <span class="id">t0</span>). <span class="tactic">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#apply_buffer_validity_eq_stable">apply_buffer_validity_eq_stable</a></span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H0</span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">Happlybuf</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="abort_condition_abort">abort_condition_abort</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">SGE</span> <span class="id">spc</span> <span class="id">ix</span> <span class="id">sc</span> <span class="id">sg</span> <span class="id">flid</span> <span class="id">scs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span> (<span class="id"><a href="GlobDefs.html#thread_pool">thread_pool</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span>) (<span class="id"><a href="GlobDefs.html#cur_tid">cur_tid</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> ({| <span class="id"><a href="GlobDefs.html#Core.Build_t">Core.i</a></span> := <span class="id"><a href="TSOCompInvs.html#ix">ix</a></span>; <span class="id">Core.c</span> := <span class="id"><a href="TSOCompInvs.html#sc">sc</a></span>; <span class="id">Core.sg</span> := <span class="id"><a href="TSOCompInvs.html#sg">sg</a></span>; <span class="id">Core.F</span> := <span class="id"><a href="TSOCompInvs.html#flid">flid</a></span> |} :: <span class="id"><a href="TSOCompInvs.html#scs">scs</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">FP</span> <span class="id">sc</span>' <span class="id">sm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="InteractionSemantics.html#step">step</a></span> (<span class="id"><a href="InteractionSemantics.html#ModSem.lang">ModSem.lang</a></span> (<span class="id"><a href="GlobDefs.html#GlobEnv.modules">GlobEnv.modules</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#ix">ix</a></span>)) (<span class="id"><a href="InteractionSemantics.html#ModSem.Ge">ModSem.Ge</a></span> (<span class="id"><a href="GlobDefs.html#GlobEnv.modules">GlobEnv.modules</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#ix">ix</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GlobDefs.html#FLists.get_fl">FLists.get_fl</a></span> (<span class="id"><a href="GlobDefs.html#GlobEnv.freelists">GlobEnv.freelists</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span>) <span class="id"><a href="TSOCompInvs.html#flid">flid</a></span>) <span class="id"><a href="TSOCompInvs.html#sc">sc</a></span> (<span class="id"><a href="GlobDefs.html#gm">gm</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span>) <span class="id"><a href="TSOCompInvs.html#FP">FP</a></span> <span class="id">sc</span>' <span class="id">sm</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="InteractionSemantics.html#at_external">at_external</a></span> (<span class="id"><a href="InteractionSemantics.html#ModSem.lang">ModSem.lang</a></span> (<span class="id"><a href="GlobDefs.html#GlobEnv.modules">GlobEnv.modules</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#ix">ix</a></span>)) (<span class="id"><a href="InteractionSemantics.html#ModSem.Ge">ModSem.Ge</a></span> (<span class="id"><a href="GlobDefs.html#GlobEnv.modules">GlobEnv.modules</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#ix">ix</a></span>)) <span class="id"><a href="TSOCompInvs.html#sc">sc</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">ores</span>, <span class="id"><a href="InteractionSemantics.html#after_external">after_external</a></span> (<span class="id"><a href="InteractionSemantics.html#ModSem.lang">ModSem.lang</a></span> (<span class="id"><a href="GlobDefs.html#GlobEnv.modules">GlobEnv.modules</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#ix">ix</a></span>)) <span class="id"><a href="TSOCompInvs.html#sc">sc</a></span> <span class="id"><a href="TSOCompInvs.html#ores">ores</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="InteractionSemantics.html#halt">halt</a></span> (<span class="id"><a href="InteractionSemantics.html#ModSem.lang">ModSem.lang</a></span> (<span class="id"><a href="GlobDefs.html#GlobEnv.modules">GlobEnv.modules</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#ix">ix</a></span>)) <span class="id"><a href="TSOCompInvs.html#sc">sc</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobSemantics.html#abort">GlobSemantics.abort</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10208')">Proof.</div>
<div class="proofscript" id="proof10208">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">intro</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">H4</span>. <span class="id">GDefLemmas.solv_thread</span>. <span class="id">inv</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H4</span>; <span class="tactic">auto</span>; <span class="id">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">GDefLemmas.solv_thread</span>'. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">eapply</span> <span class="id">H0</span>. <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">GDefLemmas.solv_thread</span>'. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">GDefLemmas.solv_thread</span>'. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">GDefLemmas.solv_thread</span>'. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">GDefLemmas.solv_thread</span>'. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">GDefLemmas.solv_thread</span>'. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">GDefLemmas.solv_thread</span>'. }<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="buffered_alloc_local_tm_alloc_not_fl">buffered_alloc_local_tm_alloc_not_fl</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fls</span> <span class="id">t</span> <span class="id">fn</span> <span class="id">tm</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#FLists.wd">FLists.wd</a></span> <span class="id"><a href="TSOCompInvs.html#fls">fls</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#thread_buffered_alloc_local">thread_buffered_alloc_local</a></span> <span class="id"><a href="TSOCompInvs.html#fls">fls</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html#tm_alloc_not_fl">tm_alloc_not_fl</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span> (<span class="id"><a href="GlobDefs.html#FLists.get_tfl">FLists.get_tfl</a></span> <span class="id"><a href="TSOCompInvs.html#fls">fls</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#fn">fn</a></span>) <span class="id"><a href="TSOCompInvs.html#t">t</a></span> .<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10209')">Proof.</div>
<div class="proofscript" id="proof10209">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOCompInvs.html#thread_buffered_alloc_local">thread_buffered_alloc_local</a></span>, <span class="id"><a href="RGRels.html#tm_alloc_not_fl">tm_alloc_not_fl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">fls</span> <span class="id">t</span> <span class="id">fn</span> <span class="id">tm</span> <span class="id">WD</span> <span class="id">H</span> <span class="id">t</span>' <span class="id">blk</span> <span class="id">n</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">Htid</span> <span class="id">Hinbuffer</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Hinbuffer</span>. <span class="tactic">destruct</span> <span class="id">Hinbuffer</span> <span class="kwd">as</span> [<span class="id">fn</span>' [<span class="id">n</span>' <span class="id">Hblk</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="id">inv</span> <span class="id">WD</span>. <span class="tactic">intro</span>. <span class="tactic">eapply</span> <span class="id">flist_disj</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">thread_fl_disj</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="tso_client_step_fp">tso_client_step_fp</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">TGE</span>: <span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.t">TSOGlobEnv.t</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i_obj</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tpc</span>: @<span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">fp</span>: <span class="id"><a href="Footprint.html#FP.t">FP.t</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="tso_client_step_intro">tso_client_step_intro</a></span> : <span class="kwd">forall</span> <span class="id">tC</span> <span class="id">tcs</span> <span class="id">tc</span>' <span class="id">b</span>' <span class="id">tm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> (<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id">tpc</span>)) !! (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOCompInvs.html#tC">tC</a></span> :: <span class="id"><a href="TSOCompInvs.html#tcs">tcs</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">nat_of_ord</span> (<span class="id"><a href="TSOGlobSem.html#TSOCore.i">TSOCore.i</a></span> <span class="id"><a href="TSOCompInvs.html#tC">tC</a></span>) &lt;&gt; <span class="id">i_obj</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#tsostep">tsostep</a></span> (<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.modules">TSOGlobEnv.modules</a></span> <span class="id">TGE</span> (<span class="id"><a href="TSOGlobSem.html#TSOCore.i">TSOCore.i</a></span> <span class="id"><a href="TSOCompInvs.html#tC">tC</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GlobDefs.html#FLists.get_fl">FLists.get_fl</a></span> (<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.freelists">TSOGlobEnv.freelists</a></span> <span class="id">TGE</span>) (<span class="id"><a href="TSOGlobSem.html#TSOCore.F">TSOCore.F</a></span> <span class="id"><a href="TSOCompInvs.html#tC">tC</a></span>)) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOCore.c">TSOCore.c</a></span> <span class="id"><a href="TSOCompInvs.html#tC">tC</a></span>) (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">tpc</span>) (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc</span>), <span class="id"><a href="TSOMem.html#memory">memory</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">tpc</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fp</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tc</span>' (<span class="id">b</span>', <span class="id">tm</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#tso_client_step_fp">tso_client_step_fp</a></span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">tpc</span> <span class="id">fp</span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="no_conflicting_client_fp">no_conflicting_client_fp</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">TGE</span>: <span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.t">TSOGlobEnv.t</a></span>) <span class="id">i_obj</span> (<span class="id">tpc</span>: @<span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fp</span>, <span class="id"><a href="TSOCompInvs.html#tso_client_step_fp">tso_client_step_fp</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="ClientSim.html#conflictc">conflictc</a></span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>)).<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="client_core">client_core</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">TGE</span>: <span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.t">TSOGlobEnv.t</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">i_obj</span>: '<span class="id">I_</span>(<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.M">TSOGlobEnv.M</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">t</span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tpc</span>: @<span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="client_core_intro">client_core_intro</a></span>: <span class="kwd">forall</span> <span class="id">tC</span> <span class="id">tcs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> (<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id">tpc</span>)) !! <span class="id">t</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOCompInvs.html#tC">tC</a></span> :: <span class="id"><a href="TSOCompInvs.html#tcs">tcs</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">nat_of_ord</span> (<span class="id"><a href="TSOGlobSem.html#TSOCore.i">TSOCore.i</a></span> <span class="id"><a href="TSOCompInvs.html#tC">tC</a></span>) &lt;&gt; <span class="id">i_obj</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#client_core">client_core</a></span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">t</span> <span class="id">tpc</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="eq_config_eq_client_core">eq_config_eq_client_core</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">t</span> <span class="id">tpc</span> <span class="id">tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_config">eq_config</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#client_core">client_core</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#client_core">client_core</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id">tpc</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10210')">Proof.</div>
<div class="proofscript" id="proof10210">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">tpc</span>, <span class="id">tpc</span>'. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="client_core_dec">client_core_dec</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">tpc</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id"><a href="TSOCompInvs.html#client_core">client_core</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>} +<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{~ <span class="id"><a href="TSOCompInvs.html#client_core">client_core</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10211')">Proof.</div>
<div class="proofscript" id="proof10211">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">tpc</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> ((<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thrdpool</span>) !! <span class="id">cid</span>) <span class="id">eqn</span>:<span class="id">Hcs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>. <span class="id">right</span>. <span class="tactic">intro</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">t</span>. <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eq_dec">Nat.eq_dec</a></span> <span class="id">i</span> <span class="id">i_obj</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>. <span class="tactic">intro</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">Hcs</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">inv</span> <span class="id">H0</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">apply</span> <span class="id">H1</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>. <span class="tactic">intro</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="match_fls_eq">match_fls_eq</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">iobj</span> <span class="id">spc</span> <span class="id">tpc</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#MS">MS</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#iobj">iobj</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#GlobEnv.freelists">GlobEnv.freelists</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> = <span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.freelists">TSOGlobEnv.freelists</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10212')">Proof.</div>
<div class="proofscript" id="proof10212">
 <span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">GE_eq0</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> &lt;- <span class="id">H3</span>. <span class="tactic">auto</span>. Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="id"><a href="AsmWD.html">AsmWD</a></span> <span class="id"><a href="SpecLangWDDET.html">SpecLangWDDET</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="GE_mod_sim_source_lang_wd">GE_mod_sim_source_lang_wd</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">M</span> <span class="id">i_obj</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#GE_mod_sim">GE_mod_sim</a></span> <span class="id"><a href="TSOCompInvs.html#M">M</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ix</span>, <span class="id"><a href="InteractionSemantics.html#mod_wd">mod_wd</a></span> (<span class="id"><a href="GlobDefs.html#GlobEnv.modules">GlobEnv.modules</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#ix">ix</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10213')">Proof.</div>
<div class="proofscript" id="proof10213">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">unfold</span> <span class="id"><a href="InteractionSemantics.html#mod_wd">mod_wd</a></span>. <span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#GE_mod_sim_source_lang_asm_or_spec">GE_mod_sim_source_lang_asm_or_spec</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">H</span>|<span class="id">H</span>]; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">rewrite</span> <span class="id">H</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="AsmWD.html#Asm_wd">AsmWD.Asm_wd</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="SpecLangWDDET.html#SpecLang_wd">SpecLangWDDET.SpecLang_wd</a></span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="MS_src_step_gmem_forward">MS_src_step_gmem_forward</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">spc</span> <span class="id">tpc</span> <span class="id">l</span> <span class="id">fp</span> <span class="id">spc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#MS">MS</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobSemantics.html#glob_step">glob_step</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id"><a href="TSOCompInvs.html#l">l</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">spc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.forward">GMem.forward</a></span> (<span class="id"><a href="GlobDefs.html#gm">gm</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span>) (<span class="id"><a href="GlobDefs.html#gm">gm</a></span> <span class="id">spc</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10214')">Proof.</div>
<div class="proofscript" id="proof10214">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H0</span>; <span class="tactic">try</span> <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="GMemory.html#GMem.forward_refl">GMem.forward_refl</a></span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#GE_eq">GE_eq</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#GE_mod_sim_source_lang_wd">GE_mod_sim_source_lang_wd</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#step_forward">step_forward</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="MS_src_tau_star_step_gmem_forward">MS_src_tau_star_step_gmem_forward</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">spc</span> <span class="id">tpc</span> <span class="id">fp</span> <span class="id">spc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#MS">MS</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ETrace.html#tau_star">tau_star</a></span> <span class="id"><a href="GlobSemantics.html#glob_step">glob_step</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">spc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.forward">GMem.forward</a></span> (<span class="id"><a href="GlobDefs.html#gm">gm</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span>) (<span class="id"><a href="GlobDefs.html#gm">gm</a></span> <span class="id">spc</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10215')">Proof.</div>
<div class="proofscript" id="proof10215">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#GE_eq">GE_eq</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">GE_EQ</span>. <span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="TSOCompInvs.html#GE_mod_sim_source_lang_wd">GE_mod_sim_source_lang_wd</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">GE_EQ</span>) <span class="kwd">as</span> <span class="id">WD</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">WD</span> <span class="id">H0</span>. <span class="tactic">clear</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">H0</span>; [<span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="GMemory.html#GMem.forward_refl">GMem.forward_refl</a></span>| <span class="tactic">intros</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="GMemory.html#GMem.forward_trans">GMem.forward_trans</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="GMemory.html#GMem.forward_refl">GMem.forward_refl</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#step_forward">step_forward</a></span>. <span class="tactic">eapply</span> <span class="id">WD</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="MS_client_core_step_client_fp">MS_client_core_step_client_fp</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">spc</span> <span class="id">tpc</span> <span class="id">fp</span> <span class="id">spc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#MS">MS</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#client_core">client_core</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobSemantics.html#glob_step">glob_step</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id"><a href="ETrace.html#tau">ETrace.tau</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">spc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html#client_fp">client_fp</a></span> (<span class="id"><a href="GlobDefs.html#gm">gm</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span>) (<span class="id"><a href="GlobDefs.html#gm">gm</a></span> <span class="id">spc</span>') <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10216')">Proof.</div>
<div class="proofscript" id="proof10216">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span>. <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">Sims</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> (<span class="tactic">apply</span> <span class="id"><a href="RGRels.html#client_emp_fp">client_emp_fp</a></span>; <span class="tactic">auto</span>; <span class="tactic">fail</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_top">ThreadPool.get_top</a></span> <span class="kwd">in</span> <span class="id">H_tp_core</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span> <span class="id">thdp</span> <span class="id">t</span>) <span class="id">eqn</span>:<span class="id">H_cs</span>; [|<span class="id">inv</span> <span class="id">H_tp_core</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">t0</span> <span class="kwd">as</span> [|<span class="id">x</span> <span class="id">cs</span>]; <span class="id">inv</span> <span class="id">H_tp_core</span>. <span class="tactic">clear</span> <span class="id">H_core_upd</span> <span class="id">H_tp_upd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#thread_simulation">thread_simulation</a></span> <span class="kwd">in</span> <span class="id">Sims</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">H_cs</span> <span class="kwd">in</span> <span class="id">Sims</span>. <span class="id">inv</span> <span class="id">Sims</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">H1</span>. <span class="id">inv</span> <span class="id">H5</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#MS_sep_obj_client_blocks">MS_sep_obj_client_blocks</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H</span> <span class="id">H_core_step</span> <span class="id">H_clientlang</span>. <span class="tactic">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="GlobDefs.html#GlobEnv.modules">GlobEnv.modules</a></span> <span class="id">SGE</span> <span class="id">ix</span>). <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id"><a href="GlobDefs.html#FLists.get_fl">FLists.get_fl</a></span> (<span class="id"><a href="GlobDefs.html#GlobEnv.freelists">GlobEnv.freelists</a></span> <span class="id">SGE</span>) <span class="id">flid</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">fl</span> <span class="id">Hsep</span> <span class="id">H_core_step</span> <span class="id">H_clientlang</span>. <span class="tactic">subst</span> <span class="id">lang</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Hsep</span> <span class="id">H_core_step</span>. <span class="tactic">clear</span>. <span class="tactic">intros</span> <span class="id">Hsep</span> <span class="id">Hstep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="SCSemLemmas.html#AsmLang_step_client_fp">AsmLang_step_client_fp</a></span> <span class="kwd">in</span> <span class="id">Hstep</span>; <span class="tactic">auto</span>. <span class="tactic">tauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">H5</span>. <span class="id">inv</span> <span class="id">H0</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOCompInvs.html#tid_eq">tid_eq</a></span> <span class="kwd">in</span> <span class="id">H4</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H4</span>. <span class="tactic">rewrite</span> <span class="id">H4</span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="id">inv</span> <span class="id">H2</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="MS_client_core_step_obj_mem_eq">MS_client_core_step_obj_mem_eq</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">spc</span> <span class="id">tpc</span> <span class="id">fp</span> <span class="id">spc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#MS">MS</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#client_core">client_core</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobSemantics.html#glob_step">glob_step</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id"><a href="ETrace.html#tau">ETrace.tau</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">spc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span>, <span class="id"><a href="RGRels.html#obj_mem">obj_mem</a></span> (<span class="id"><a href="GlobDefs.html#gm">gm</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span>) <span class="id"><a href="TSOCompInvs.html#b">b</a></span> <span class="id"><a href="TSOCompInvs.html#ofs">ofs</a></span> &lt;-&gt; <span class="id"><a href="RGRels.html#obj_mem">obj_mem</a></span> (<span class="id"><a href="GlobDefs.html#gm">gm</a></span> <span class="id">spc</span>') <span class="id"><a href="TSOCompInvs.html#b">b</a></span> <span class="id"><a href="TSOCompInvs.html#ofs">ofs</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10217')">Proof.</div>
<div class="proofscript" id="proof10217">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span>. <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">Sims</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> (<span class="tactic">tauto</span>; <span class="tactic">fail</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_top">ThreadPool.get_top</a></span> <span class="kwd">in</span> <span class="id">H_tp_core</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span> <span class="id">thdp</span> <span class="id">t</span>) <span class="id">eqn</span>:<span class="id">H_cs</span>; [|<span class="id">inv</span> <span class="id">H_tp_core</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">t0</span> <span class="kwd">as</span> [|<span class="id">x</span> <span class="id">cs</span>]; <span class="id">inv</span> <span class="id">H_tp_core</span>. <span class="tactic">clear</span> <span class="id">H_core_upd</span> <span class="id">H_tp_upd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#thread_simulation">thread_simulation</a></span> <span class="kwd">in</span> <span class="id">Sims</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">H_cs</span> <span class="kwd">in</span> <span class="id">Sims</span>. <span class="id">inv</span> <span class="id">Sims</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">H1</span>. <span class="id">inv</span> <span class="id">H5</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#MS_sep_obj_client_blocks">MS_sep_obj_client_blocks</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H</span> <span class="id">H_core_step</span> <span class="id">H_clientlang</span>. <span class="tactic">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="GlobDefs.html#GlobEnv.modules">GlobEnv.modules</a></span> <span class="id">SGE</span> <span class="id">ix</span>). <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id"><a href="GlobDefs.html#FLists.get_fl">FLists.get_fl</a></span> (<span class="id"><a href="GlobDefs.html#GlobEnv.freelists">GlobEnv.freelists</a></span> <span class="id">SGE</span>) <span class="id">flid</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">fl</span> <span class="id">Hsep</span> <span class="id">H_core_step</span> <span class="id">H_clientlang</span>. <span class="tactic">subst</span> <span class="id">lang</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Hsep</span> <span class="id">H_core_step</span>. <span class="tactic">clear</span>. <span class="tactic">intros</span> <span class="id">Hsep</span> <span class="id">Hstep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="SCSemLemmas.html#AsmLang_step_client_fp">AsmLang_step_client_fp</a></span> <span class="kwd">in</span> <span class="id">Hstep</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hstep</span> <span class="kwd">as</span> [<span class="id">_</span> [<span class="id">A</span> <span class="id">_</span>]]. <span class="tactic">rewrite</span> <span class="id">A</span>. <span class="tactic">tauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">H5</span>. <span class="id">inv</span> <span class="id">H0</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOCompInvs.html#tid_eq">tid_eq</a></span> <span class="kwd">in</span> <span class="id">H4</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H4</span>. <span class="tactic">rewrite</span> <span class="id">H4</span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="id">inv</span> <span class="id">H2</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="GE_mod_sim_source_step_sep_obj_clt_preserved">GE_mod_sim_source_step_sep_obj_clt_preserved</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">M</span> <span class="id">i_obj</span> (<span class="id">spc</span>: @<span class="id"><a href="GlobDefs.html#ProgConfig">ProgConfig</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span>) <span class="id">fp</span> <span class="id">spc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#GE_mod_sim">GE_mod_sim</a></span> <span class="id"><a href="TSOCompInvs.html#M">M</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html#sep_obj_client_block">sep_obj_client_block</a></span> (<span class="id"><a href="GlobDefs.html#gm">gm</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobSemantics.html#glob_step">glob_step</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id"><a href="ETrace.html#tau">ETrace.tau</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">spc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html#sep_obj_client_block">sep_obj_client_block</a></span> (<span class="id"><a href="GlobDefs.html#gm">gm</a></span> <span class="id">spc</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10218')">Proof.</div>
<div class="proofscript" id="proof10218">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">M</span> <span class="id">i_obj</span> <span class="id">spc</span> <span class="id">fp</span> <span class="id">spc</span>' <span class="id">H</span> <span class="id">H0</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>; (<span class="tactic">try</span> <span class="tactic">simpl</span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="TSOCompInvs.html#GE_mod_sim_source_lang_asm_or_spec">GE_mod_sim_source_lang_asm_or_spec</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span>) <span class="kwd">as</span> <span class="id">H</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H</span>' <span class="id">H0</span> <span class="id">H_core_step</span>; <span class="tactic">clear</span>. <span class="tactic">destruct</span> <span class="id">c</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">H</span>' <span class="id">H</span>. <span class="id">specialize</span> (<span class="id">H</span>' <span class="id">i</span>). <span class="id">revert</span> <span class="id">H</span> <span class="id">H</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> (<span class="id"><a href="GlobDefs.html#GlobEnv.modules">GlobEnv.modules</a></span> <span class="id">SGE</span> <span class="id">i</span>). <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">t</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">destruct</span> <span class="id">H</span>' <span class="kwd">as</span> [<span class="id">Hasm</span>|<span class="id">Hspec</span>]; <span class="tactic">subst</span> <span class="id">lang</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="SCSemLemmas.html#AsmLang_step_client_fp">AsmLang_step_client_fp</a></span> <span class="kwd">in</span> <span class="id">H_core_step</span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="SCSemLemmas.html#SpecLang_step_sep">SpecLang_step_sep</a></span> <span class="kwd">in</span> <span class="id">H_core_step</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="MS_source_step_sep_obj_clt_preserved">MS_source_step_sep_obj_clt_preserved</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">spc</span> <span class="id">tpc</span> <span class="id">fp</span> <span class="id">spc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#MS">MS</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobSemantics.html#glob_step">glob_step</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id"><a href="ETrace.html#tau">ETrace.tau</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">spc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html#sep_obj_client_block">sep_obj_client_block</a></span> (<span class="id"><a href="GlobDefs.html#gm">gm</a></span> <span class="id">spc</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10219')">Proof.</div>
<div class="proofscript" id="proof10219">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">spc</span> <span class="id">tpc</span> <span class="id">fp</span> <span class="id">spc</span>' <span class="id">H</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#GE_mod_sim_source_step_sep_obj_clt_preserved">GE_mod_sim_source_step_sep_obj_clt_preserved</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="MS_source_tau_star_step_sep_obj_clt_preserved">MS_source_tau_star_step_sep_obj_clt_preserved</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">spc</span> <span class="id">tpc</span> <span class="id">fp</span> <span class="id">spc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#MS">MS</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ETrace.html#tau_star">tau_star</a></span> <span class="id"><a href="GlobSemantics.html#glob_step">glob_step</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">spc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html#sep_obj_client_block">sep_obj_client_block</a></span> (<span class="id"><a href="GlobDefs.html#gm">gm</a></span> <span class="id">spc</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10220')">Proof.</div>
<div class="proofscript" id="proof10220">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">spc</span> <span class="id">tpc</span> <span class="id">fp</span> <span class="id">spc</span>' <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#GE_eq">GE_eq</a></span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span> <span class="id">HGE</span> <span class="id">Hstar</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#MS_sep_obj_client_blocks">MS_sep_obj_client_blocks</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">revert</span> <span class="id">HGE</span> <span class="id">Hstar</span> <span class="id">H</span>. <span class="tactic">clear</span>. <span class="tactic">intros</span> <span class="id">until</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hstar</span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="TSOCompInvs.html#GE_mod_sim_source_step_sep_obj_clt_preserved">GE_mod_sim_source_step_sep_obj_clt_preserved</a></span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="MS_preserved_after_unbuffer">MS_preserved_after_unbuffer</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">spc</span> <span class="id">tpc</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#MS">MS</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> (<span class="id"><a href="TSOGlobSem.html#ub">ub</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#MS">MS</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id">tpc</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10221')">Proof.</div>
<div class="proofscript" id="proof10221">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">spc</span> <span class="id">tpc</span> <span class="id">Hmatch</span> <span class="id">t</span> <span class="id">tpc</span>' <span class="id">Hunbuffer</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">spc</span>. <span class="id">pose</span> <span class="id">proof</span> <span class="id">Hunbuffer</span> <span class="kwd">as</span> <span class="id">Hunbuffer</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hunbuffer</span>'. <span class="tactic">eapply</span> (<span class="id"><a href="RGRels.html#unbuffer_G_ub">unbuffer_G_ub</a></span> <span class="id">gm</span>) <span class="kwd">in</span> <span class="id">H_unbuf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>; <span class="tactic">try</span> (<span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">auto</span>; <span class="tactic">fail</span>); <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#Invs.H_sta_c_ub">H_sta_c_ub</a></span>; <span class="tactic">eauto</span>. <span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#Invs.H_sta_o_ub">H_sta_o_ub</a></span>; <span class="tactic">eauto</span>. <span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span>. <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">destruct</span> (<span class="id">thread_simulation0</span> <span class="id">t1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>. <span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#ThreadSimClient">ThreadSimClient</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#ThreadClientSim_Sta_UB">ThreadClientSim_Sta_UB</a></span>; <span class="tactic">eauto</span>. <span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">auto</span>. <span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#ThreadSimObject">ThreadSimObject</a></span>. <span class="id">inv</span> <span class="id">H0</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="ObjectSim.html#match_rely">ObjectSim.match_rely</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#Invs.H_rg_ub_o">H_rg_ub_o</a></span>; <span class="tactic">eauto</span>. <span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#ThreadClientSim_Sta_UB">ThreadClientSim_Sta_UB</a></span>; <span class="tactic">eauto</span>. <span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">auto</span>. <span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#FLs_embed_preserved">FLs_embed_preserved</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hmatch</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">GE_eq0</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H3</span>. <span class="id">inv</span> <span class="id">GE_wd0</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hmatch</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id"><a href="TSOCompInvs.html#thread_buffered_alloc_local">thread_buffered_alloc_local</a></span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hunbuffer</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unbuffer">unbuffer</a></span> <span class="kwd">in</span> <span class="id">H_unbuf0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#buffered_alloc_local">buffered_alloc_local</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>. <span class="tactic">eapply</span> <span class="id">Hmatch</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t1</span>). <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span> <span class="id">t1</span>); <span class="id">inv</span> <span class="id">H_unbuf0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span>; <span class="id">inv</span> <span class="id">H1</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>; [|<span class="id">contradiction</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span> <span class="id">t</span>); <span class="id">inv</span> <span class="id">H_unbuf0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span>; <span class="id">inv</span> <span class="id">H1</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>; [<span class="tactic">congruence</span>|<span class="tactic">auto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;fl_valid_eq&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#buffered_alloc_local_fl_valid_match_preserve_by_unbuffer">buffered_alloc_local_fl_valid_match_preserve_by_unbuffer</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOCompInvs.html#match_fls_eq">match_fls_eq</a></span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id"><a href="GlobDefs.html#GlobEnv.wd_fl">GlobEnv.wd_fl</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#GE_wd">GE_wd</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="ClientSim.html#Ic_unbuffer_safe">Ic_unbuffer_safe</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#mem_inv_client">mem_inv_client</a></span>. <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#buffered_alloc_local">buffered_alloc_local</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#fl_valid_match">fl_valid_match</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>.  <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hunbuffer</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="fl_valid_eq_rel_tm_gm_vb">fl_valid_eq_rel_tm_gm_vb</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">fl</span> <span class="id">sm</span> <span class="id">tm</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#fl_valid_eq">fl_valid_eq</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#fl">fl</a></span> <span class="id"><a href="TSOCompInvs.html#sm">sm</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html#rel_tm_gm_vb">rel_tm_gm_vb</a></span> <span class="id"><a href="TSOCompInvs.html#sm">sm</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#fl">fl</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10222')">Proof.</div>
<div class="proofscript" id="proof10222">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOCompInvs.html#fl_valid_eq">fl_valid_eq</a></span>, <span class="id"><a href="RGRels.html#rel_tm_gm_vb">rel_tm_gm_vb</a></span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H</span> <span class="id">_</span> <span class="id">H1</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H0</span>). <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Local</span> <span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">fl_valid_eq_rel_tm_gm_vb</span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="apply_buffer_app_split">apply_buffer_app_split</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">buf1</span> <span class="id">buf2</span> <span class="id">tm</span> <span class="id">tm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> (<span class="id"><a href="TSOCompInvs.html#buf1">buf1</a></span> ++ <span class="id"><a href="TSOCompInvs.html#buf2">buf2</a></span>) <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">tm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">tm1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOCompInvs.html#buf1">buf1</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOCompInvs.html#tm1">tm1</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="TSOCompInvs.html#buf2">buf2</a></span> <span class="id"><a href="TSOCompInvs.html#tm1">tm1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">tm</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10223')">Proof.</div>
<div class="proofscript" id="proof10223">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">induction</span> <span class="id">buf1</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">tm</span>); <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">rewrite</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHbuf1</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="fl_valid_eq_stable">fl_valid_eq_stable</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fls</span> <span class="id">t0</span> <span class="id">fn0</span> <span class="id">sm</span> <span class="id">tm</span> <span class="id">sm</span>' <span class="id">bis</span> <span class="id">tgm</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">HUBS</span>: <span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">HWD</span>: <span class="id"><a href="GlobDefs.html#FLists.wd">FLists.wd</a></span> <span class="id"><a href="TSOCompInvs.html#fls">fls</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">H_fl_valid_eq</span>: <span class="kwd">forall</span> <span class="id">t</span> <span class="id">fn</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">fl</span> := <span class="id"><a href="GlobDefs.html#FLists.get_tfl">FLists.get_tfl</a></span> <span class="id"><a href="TSOCompInvs.html#fls">fls</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#fn">fn</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#fl_valid_eq">fl_valid_eq</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#fl">fl</a></span> <span class="id"><a href="TSOCompInvs.html#sm">sm</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">H_forward</span>: <span class="id"><a href="GMemory.html#GMem.forward">GMem.forward</a></span> <span class="id"><a href="TSOCompInvs.html#sm">sm</a></span> <span class="id">sm</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">H_src_new_block_in_fl</span>: <span class="kwd">forall</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span> <span class="id">sm</span>' <span class="id"><a href="TSOCompInvs.html#b">b</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span> <span class="id"><a href="TSOCompInvs.html#sm">sm</a></span> <span class="id"><a href="TSOCompInvs.html#b">b</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#FLists.bbelongstof">FLists.bbelongstof</a></span> <span class="id"><a href="TSOCompInvs.html#fls">fls</a></span> (<span class="id"><a href="GlobDefs.html#FLists.get_tfid">FLists.get_tfid</a></span> <span class="id"><a href="TSOCompInvs.html#fls">fls</a></span> <span class="id"><a href="TSOCompInvs.html#t0">t0</a></span> <span class="id"><a href="TSOCompInvs.html#fn0">fn0</a></span>) <span class="id"><a href="TSOCompInvs.html#b">b</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">H_tgt_new_block_in_fl</span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id"><a href="TSOCompInvs.html#b">b</a></span> <span class="id"><a href="TSOCompInvs.html#lo">lo</a></span> <span class="id"><a href="TSOCompInvs.html#hi">hi</a></span>) <span class="id"><a href="TSOCompInvs.html#bis">bis</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#FLists.bbelongstof">FLists.bbelongstof</a></span> <span class="id"><a href="TSOCompInvs.html#fls">fls</a></span> (<span class="id"><a href="GlobDefs.html#FLists.get_tfid">FLists.get_tfid</a></span> <span class="id"><a href="TSOCompInvs.html#fls">fls</a></span> <span class="id"><a href="TSOCompInvs.html#t0">t0</a></span> <span class="id"><a href="TSOCompInvs.html#fn0">fn0</a></span>) <span class="id"><a href="TSOCompInvs.html#b">b</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">H_eq_local</span>: <span class="id"><a href="RGRels.html#rel_tm_gm_vb">rel_tm_gm_vb</a></span> <span class="id">sm</span>' (<span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#t0">t0</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#t0">t0</a></span> ++ <span class="id"><a href="TSOCompInvs.html#bis">bis</a></span>) <span class="id">tgm</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GlobDefs.html#FLists.get_tfl">FLists.get_tfl</a></span> <span class="id"><a href="TSOCompInvs.html#fls">fls</a></span> <span class="id"><a href="TSOCompInvs.html#t0">t0</a></span> <span class="id"><a href="TSOCompInvs.html#fn0">fn0</a></span>) <span class="id"><a href="TSOCompInvs.html#t0">t0</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">H_eq_validity</span>: <span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">tgm</span>' = <span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">t</span> <span class="id">fn</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">fl</span> := <span class="id"><a href="GlobDefs.html#FLists.get_tfl">FLists.get_tfl</a></span> <span class="id"><a href="TSOCompInvs.html#fls">fls</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#fn">fn</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#fl_valid_eq">fl_valid_eq</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#fl">fl</a></span> <span class="id">sm</span>' (<span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#t0">t0</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#t0">t0</a></span> ++ <span class="id"><a href="TSOCompInvs.html#bis">bis</a></span>) <span class="id">tgm</span>')).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10224')">Proof.</div>
<div class="proofscript" id="proof10224">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t0</span> <span class="id">t</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;t0&nbsp;=&nbsp;t&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOCompInvs.html#fl_valid_eq">fl_valid_eq</a></span>. <span class="tactic">intros</span> <span class="id">tgm</span>'' <span class="id">Happly</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">t0</span>. <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eq_dec">Nat.eq_dec</a></span> <span class="id">fn0</span> <span class="id">fn</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;fn0&nbsp;=&nbsp;fn&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">fn0</span>. <span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id">H_eq_local</span>. <span class="tactic">subst</span> <span class="id">fl</span>. <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>. <span class="tactic">tauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;fn0&nbsp;&lt;&gt;&nbsp;fn&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">b0</span> <span class="id">n0</span> <span class="id">Hb0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="kwd">forall</span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id"><a href="TSOCompInvs.html#b">b</a></span> <span class="id"><a href="TSOCompInvs.html#lo">lo</a></span> <span class="id"><a href="TSOCompInvs.html#hi">hi</a></span>) <span class="id">bis</span> -&gt; <span class="id"><a href="TSOCompInvs.html#b">b</a></span> &lt;&gt; <span class="id">b0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">H_tgt_new_block_in_fl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">n</span>' <span class="id">Hb</span>]. <span class="tactic">subst</span> <span class="id">b0</span> <span class="id">b</span> <span class="id">fl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#FLists.flist_disj">FLists.flist_disj</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#FLists.thread_fl_norep">FLists.thread_fl_norep</a></span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H_tgt_new_block_in_fl</span>; <span class="tactic">rename</span> <span class="id">H</span> <span class="id">into</span> <span class="id">H_tgt_new_block_in_fl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="kwd">forall</span> <span class="id">b</span>, <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span> <span class="id">sm</span>' <span class="id"><a href="TSOCompInvs.html#b">b</a></span> -&gt; ~ <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span> <span class="id">sm</span> <span class="id"><a href="TSOCompInvs.html#b">b</a></span> -&gt; <span class="id"><a href="TSOCompInvs.html#b">b</a></span> &lt;&gt; <span class="id">b0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id">H_src_new_block_in_fl</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">n</span>' <span class="id">Hb</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">b</span> <span class="id">b0</span>. <span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#FLists.flist_disj">FLists.flist_disj</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#FLists.thread_fl_norep">FLists.thread_fl_norep</a></span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H_src_new_block_in_fl</span>; <span class="tactic">rename</span> <span class="id">H</span> <span class="id">into</span> <span class="id">H_src_new_block_in_fl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span> <span class="id">sm</span>' <span class="id">b0</span> &lt;-&gt; <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span> <span class="id">sm</span> <span class="id">b0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">split</span>. <span class="tactic">intro</span>. <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_dec">in_dec</a></span> <span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">b0</span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">sm</span>)); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">H_src_new_block_in_fl</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">auto</span>. <span class="id">contradiction</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="GMemory.html#GMem.dom_forward">GMem.dom_forward</a></span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H_src_new_block_in_fl</span>. <span class="tactic">rewrite</span> <span class="id">H</span>. <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H_fl_valid_eq</span> <span class="id">t</span> <span class="id">fn</span>). <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H_fl_valid_eq</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOCompInvs.html#fl_valid_eq">fl_valid_eq</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="kwd">in</span> *. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> *. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>;[|<span class="id">contradiction</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">exists</span> <span class="id">tgm1</span>', <span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span> <span class="id">t</span>) (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">tm</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">tgm1</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">tm</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#unbuffer_safe_apply_buffer">TSOMemLemmas.unbuffer_safe_apply_buffer</a></span>. <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">tgm1</span>' <span class="id">Happly1</span>'].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#apply_buffer_app_split">apply_buffer_app_split</a></span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">tgm1</span> [<span class="id">Happly1</span> <span class="id">Happly2</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span> <span class="id">tgm</span>'' <span class="id">b0</span> &lt;-&gt; <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span> <span class="id">tgm1</span> <span class="id">b0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">revert</span> <span class="id">Happly2</span> <span class="id">H_tgt_new_block_in_fl</span>. <span class="tactic">clear</span>. <span class="id">revert</span> <span class="id">tgm1</span> <span class="id">tgm</span>''.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bis</span>. <span class="tactic">simpl</span>. <span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">Happly2</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">intros</span>. <span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">tgm1</span>) <span class="id">eqn</span>:<span class="id">A</span>; [<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Happly2</span>|<span class="id">inv</span> <span class="id">Happly2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id">IHbis</span>; <span class="tactic">eauto</span>. <span class="id">revert</span> <span class="id">A</span> <span class="id">H_tgt_new_block_in_fl</span>. <span class="tactic">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span>. <span class="tactic">inversion</span> 1; <span class="tactic">subst</span>. <span class="tactic">clear</span> <span class="id">A</span>. <span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>. <span class="tactic">simpl</span>. <span class="tactic">intros</span> <span class="id">B</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">auto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">B</span>; <span class="tactic">eauto</span>. <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#free">free</a></span>, <span class="id"><a href="TSOMem.html#unchecked_free">unchecked_free</a></span>, <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>. <span class="tactic">destruct</span> <span class="id"><a href="TSOMem.html#range_perm_dec">range_perm_dec</a></span>; <span class="tactic">inversion</span> 1; <span class="tactic">simpl</span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#store">store</a></span>, <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>. <span class="tactic">destruct</span> <span class="id"><a href="TSOMem.html#valid_access_dec">valid_access_dec</a></span>; <span class="tactic">inversion</span> 1; <span class="tactic">simpl</span>; <span class="tactic">tauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>. <span class="tactic">clear</span> <span class="id">H</span> <span class="id">Happly2</span> <span class="id">H_tgt_new_block_in_fl</span> <span class="id">Happly</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_fl_valid_eq</span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">Happly1</span>'; <span class="tactic">eauto</span>. <span class="tactic">clear</span> <span class="id">H_fl_valid_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#apply_buffer_validity_eq_stable">apply_buffer_validity_eq_stable</a></span>; <span class="tactic">eauto</span>. <span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>. <span class="tactic">rewrite</span> <span class="id">H_eq_validity</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;t0&nbsp;&lt;&gt;&nbsp;t&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H_tgt_new_block_in_fl</span> <span class="id">H_eq_local</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOCompInvs.html#fl_valid_eq">fl_valid_eq</a></span> <span class="kwd">in</span> *. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span>, <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>. <span class="tactic">simpl</span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>; [<span class="tactic">congruence</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">tgm</span>'' <span class="id">Happly</span>' <span class="id">b</span> <span class="id">n</span>' <span class="id">Hb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">exists</span> <span class="id">tgm1</span>', <span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span> <span class="id">t</span>) (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">tm</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">tgm1</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">tm</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">eapply</span> <span class="id"><a href="TSOMemLemmas.html#unbuffer_safe_apply_buffer">TSOMemLemmas.unbuffer_safe_apply_buffer</a></span>. <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">tgm1</span>' <span class="id">Happly</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H_fl_valid_eq</span> <span class="id">t</span> <span class="id">fn</span> <span class="id">tgm1</span>' <span class="id">Happly</span> <span class="id">b</span> <span class="id">n</span>' <span class="id">Hb</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="kwd">forall</span> <span class="id">b0</span>, <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span> <span class="id">sm</span>' <span class="id"><a href="TSOCompInvs.html#b0">b0</a></span> -&gt; ~ <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span> <span class="id">sm</span> <span class="id"><a href="TSOCompInvs.html#b0">b0</a></span> -&gt; <span class="id">b</span> &lt;&gt; <span class="id"><a href="TSOCompInvs.html#b0">b0</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id">H_src_new_block_in_fl</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">n0</span>' <span class="id">Hb0</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">b</span> <span class="id">b0</span>. <span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#FLists.flist_disj">FLists.flist_disj</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#FLists.thread_fl_disj">FLists.thread_fl_disj</a></span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H_src_new_block_in_fl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span> <span class="id">sm</span>' <span class="id">b</span> &lt;-&gt; <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span> <span class="id">sm</span> <span class="id">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">split</span>. <span class="tactic">intro</span>. <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_dec">in_dec</a></span> <span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">b</span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">sm</span>)); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">H</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">auto</span>. <span class="id">contradiction</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="GMemory.html#GMem.dom_forward">GMem.dom_forward</a></span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H</span>. <span class="tactic">rewrite</span> <span class="id">H0</span>. <span class="tactic">rewrite</span> <span class="id">H_fl_valid_eq</span>. <span class="tactic">clear</span> <span class="id">H0</span> <span class="id">H_fl_valid_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#apply_buffer_validity_eq_stable">apply_buffer_validity_eq_stable</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>. <span class="tactic">rewrite</span> <span class="id">H_eq_validity</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">fl_valid_eq_stable</span>':<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fls</span> <span class="id">t0</span> <span class="id">fn0</span> <span class="id">sm</span> <span class="id">tm</span> <span class="id">sm</span>' <span class="id">buf0</span>' <span class="id">tgm</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">HUBS</span>: <span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">HWD</span>: <span class="id"><a href="GlobDefs.html#FLists.wd">FLists.wd</a></span> <span class="id"><a href="TSOCompInvs.html#fls">fls</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">H_fl_valid_eq</span>: <span class="kwd">forall</span> <span class="id">t</span> <span class="id">fn</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">fl</span> := <span class="id"><a href="GlobDefs.html#FLists.get_tfl">FLists.get_tfl</a></span> <span class="id"><a href="TSOCompInvs.html#fls">fls</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#fn">fn</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#fl_valid_eq">fl_valid_eq</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#fl">fl</a></span> <span class="id"><a href="TSOCompInvs.html#sm">sm</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">H_forward</span>: <span class="id"><a href="GMemory.html#GMem.forward">GMem.forward</a></span> <span class="id"><a href="TSOCompInvs.html#sm">sm</a></span> <span class="id">sm</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">H_src_new_block_in_fl</span>: <span class="kwd">forall</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span> <span class="id">sm</span>' <span class="id"><a href="TSOCompInvs.html#b">b</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span> <span class="id"><a href="TSOCompInvs.html#sm">sm</a></span> <span class="id"><a href="TSOCompInvs.html#b">b</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#FLists.bbelongstof">FLists.bbelongstof</a></span> <span class="id"><a href="TSOCompInvs.html#fls">fls</a></span> (<span class="id"><a href="GlobDefs.html#FLists.get_tfid">FLists.get_tfid</a></span> <span class="id"><a href="TSOCompInvs.html#fls">fls</a></span> <span class="id"><a href="TSOCompInvs.html#t0">t0</a></span> <span class="id"><a href="TSOCompInvs.html#fn0">fn0</a></span>) <span class="id"><a href="TSOCompInvs.html#b">b</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">H_step</span>: <span class="id">exists</span> <span class="id">ge</span> <span class="id">c</span> <span class="id">c</span>' <span class="id">fp</span>, <span class="id"><a href="AsmTSO.html#tsostep">tsostep</a></span> <span class="id"><a href="TSOCompInvs.html#ge">ge</a></span> (<span class="id"><a href="GlobDefs.html#FLists.get_tfl">FLists.get_tfl</a></span> <span class="id"><a href="TSOCompInvs.html#fls">fls</a></span> <span class="id"><a href="TSOCompInvs.html#t0">t0</a></span> <span class="id"><a href="TSOCompInvs.html#fn0">fn0</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#c">c</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#t0">t0</a></span>, <span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span>) <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">c</span>' (<span class="id">buf0</span>', <span class="id">tgm</span>'))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">H_eq_local</span>: <span class="id"><a href="RGRels.html#rel_tm_gm_vb">rel_tm_gm_vb</a></span> <span class="id">sm</span>' (<span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#t0">t0</a></span> <span class="id">buf0</span>' <span class="id">tgm</span>') (<span class="id"><a href="GlobDefs.html#FLists.get_tfl">FLists.get_tfl</a></span> <span class="id"><a href="TSOCompInvs.html#fls">fls</a></span> <span class="id"><a href="TSOCompInvs.html#t0">t0</a></span> <span class="id"><a href="TSOCompInvs.html#fn0">fn0</a></span>) <span class="id"><a href="TSOCompInvs.html#t0">t0</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">t</span> <span class="id">fn</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">fl</span> := <span class="id"><a href="GlobDefs.html#FLists.get_tfl">FLists.get_tfl</a></span> <span class="id"><a href="TSOCompInvs.html#fls">fls</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#fn">fn</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#fl_valid_eq">fl_valid_eq</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#fl">fl</a></span> <span class="id">sm</span>' (<span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#t0">t0</a></span> <span class="id">buf0</span>' <span class="id">tgm</span>')).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10225')">Proof.</div>
<div class="proofscript" id="proof10225">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H_step</span> <span class="kwd">as</span> (<span class="id">ge</span> &amp; <span class="id">c</span> &amp; <span class="id">c</span>' &amp; <span class="id">fp</span> &amp; <span class="id">H_step</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOAuxDefs.html#TSO_step_access_validity_preserve">TSOAuxDefs.TSO_step_access_validity_preserve</a></span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">_</span> <span class="id">H_eq_validity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#tsostep_buffered_alloc_in_fl">tsostep_buffered_alloc_in_fl</a></span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">bis</span> [<span class="id">Hbuffer</span>' <span class="id">H_tgt_new_block_in_fl</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">buf0</span>'. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#fl_valid_eq_stable">fl_valid_eq_stable</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="MS_preserved_after_ub_star">MS_preserved_after_ub_star</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">spc</span> <span class="id">tpc</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#MS">MS</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#ub_star">ub_star</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#MS">MS</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id">tpc</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10226')">Proof.</div>
<div class="proofscript" id="proof10226">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">revert</span> <span class="id">spc</span> <span class="id">H</span>. <span class="tactic">induction</span> <span class="id">H0</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_preserved_after_unbuffer">MS_preserved_after_unbuffer</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="MS_preserved_after_sw">MS_preserved_after_sw</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">spc</span> <span class="id">tpc</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#MS">MS</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">spc</span>', <span class="id"><a href="GlobSemantics.html#glob_step">glob_step</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id"><a href="ETrace.html#sw">ETrace.sw</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">spc</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#MS">MS</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id">spc</span>' <span class="id">tpc</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10227')">Proof.</div>
<div class="proofscript" id="proof10227">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">spc</span> <span class="id">tpc</span> <span class="id">Hmatch</span> <span class="id">tpc</span>' <span class="id">Hswstep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">spc</span>. <span class="id">pose</span> <span class="id">proof</span> <span class="id">Hswstep</span> <span class="kwd">as</span> <span class="id">Hswstep</span>'. <span class="id">inv</span> <span class="id">Hswstep</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hmatch</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#helper1">helper1</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>. <span class="tactic">split</span>. <span class="id">econstructor</span>. <span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#valid_tid_eq">valid_tid_eq</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">A</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.valid_tid">ThreadPool.valid_tid</a></span>. <span class="tactic">rewrite</span> <span class="id">A</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id">H_not_halted</span>. <span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thread_simulation">thread_simulation</a></span>; <span class="tactic">eauto</span>. <span class="id">instantiate</span> (1:= <span class="id">t</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">A</span>. <span class="id">inv</span> <span class="id">A</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> &lt;- <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="id">inv</span> <span class="id">H3</span>. <span class="id">inv</span> <span class="id">H4</span>. <span class="id">inv</span> <span class="id">H2</span>. <span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hsswstep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;safe&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">ls</span> <span class="id">fp</span> <span class="id">s</span>' <span class="id">Hstar</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#source_safe">source_safe</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="SCSemLemmas.html#etrace_star_star">etrace_star_star</a></span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="ETrace.html#star_step">ETrace.star_step</a></span>. <span class="tactic">eauto</span>. <span class="id">econstructor</span>.<br/>
&nbsp;drf&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#source_drf">source_drf</a></span>; <span class="tactic">eauto</span>. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">ls</span> &amp; <span class="id">fp</span> &amp; <span class="id">s</span>' &amp; <span class="id">Hstar</span>' &amp; <span class="id">RACE</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="id">eexists</span> <span class="id">_</span>, <span class="id">s</span>'. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="SCSemLemmas.html#etrace_star_star">etrace_star_star</a></span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="ETrace.html#star_step">ETrace.star_step</a></span>. <span class="tactic">eauto</span>. <span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="MS_tm_alloc_not_fl">MS_tm_alloc_not_fl</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">spc</span> <span class="id">tpc</span> <span class="id">t</span> <span class="id">fn</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#MS">MS</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html#tm_alloc_not_fl">tm_alloc_not_fl</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="GlobDefs.html#FLists.get_tfl">FLists.get_tfl</a></span> (<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.freelists">TSOGlobEnv.freelists</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span>) <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#fn">fn</a></span>) <span class="id"><a href="TSOCompInvs.html#t">t</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10228')">Proof.</div>
<div class="proofscript" id="proof10228">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">spc</span> <span class="id">tpc</span> <span class="id">t</span> <span class="id">fn</span> <span class="id">MATCH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="RGRels.html#tm_alloc_not_fl">tm_alloc_not_fl</a></span>. <span class="tactic">intros</span> <span class="id">t</span>' <span class="id">blk</span> <span class="id">n</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">Hteq</span> <span class="id">Hbi</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#buffered_alloc_local">buffered_alloc_local</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">fn</span>' &amp; <span class="id">n</span>' &amp; <span class="id">Hblk</span>). <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hblk</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hblk</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#FLists.get_tfl">FLists.get_tfl</a></span>, <span class="id"><a href="GlobDefs.html#FLists.get_tfid">FLists.get_tfid</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="MemAux.html#get_block">MemAux.get_block</a></span>, <span class="id"><a href="GlobDefs.html#FLists.get_block">FLists.get_block</a></span>. <span class="tactic">clear</span> <span class="id">Hblk</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOCompInvs.html#match_fls_eq">match_fls_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#GE_wd">GE_wd</a></span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span> <span class="id">WD</span>. <span class="tactic">apply</span> <span class="id"><a href="GlobDefs.html#GlobEnv.wd_fl">GlobEnv.wd_fl</a></span> <span class="kwd">in</span> <span class="id">WD</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#FLists.thread_fl_disj">FLists.thread_fl_disj</a></span> <span class="kwd">in</span> <span class="id">Hteq</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">C</span>. <span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#FLists.flist_disj">FLists.flist_disj</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="MS_preserved_after_tau_non_conflicting_client_step">MS_preserved_after_tau_non_conflicting_client_step</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">spc</span> <span class="id">tpc</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#MS">MS</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tpc</span>' <span class="id">fp</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOGlobSem.html#tau">tau</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#client_core">client_core</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="ClientSim.html#conflictc">conflictc</a></span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">FP</span> <span class="id">spc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobSemantics.html#glob_step">glob_step</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id"><a href="ETrace.html#tau">ETrace.tau</a></span> <span class="id"><a href="TSOCompInvs.html#FP">FP</a></span> <span class="id">spc</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#fpmatchc">fpmatchc</a></span> <span class="id"><a href="TSOCompInvs.html#FP">FP</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#MS">MS</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id">spc</span>' <span class="id">tpc</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10229')">Proof.</div>
<div class="proofscript" id="proof10229">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">spc</span> <span class="id">tpc</span> <span class="id">Hmatch</span> <span class="id">tpc</span>' <span class="id">fpT</span>' <span class="id">Htsostep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#match_fls_eq">match_fls_eq</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">Hflseq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id">Htsostep</span> <span class="kwd">as</span> <span class="id">Htsostep</span>'. <span class="id">inv</span> <span class="id">Htsostep</span>'. <br/>
&nbsp;module&nbsp;tau&nbsp;step&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">spc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#tid_eq">tid_eq</a></span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">intro</span>; <span class="tactic">subst</span> <span class="id">cur_tid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#atom_bit_0">atom_bit_0</a></span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">intro</span>; <span class="tactic">subst</span> <span class="id">atom_bit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">Htsim</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#thread_simulation">thread_simulation</a></span> <span class="kwd">in</span> <span class="id">Htsim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1:= <span class="id">t</span>) <span class="kwd">in</span> <span class="id">Htsim</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">Htsim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Htsim</span>. <span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;client&nbsp;step&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intros</span> <span class="id">_</span>. <span class="id">inv</span> <span class="id">H0</span>. <span class="id">inv</span> <span class="id">H4</span>. <span class="id">pose</span> <span class="id">proof</span> <span class="id">H2</span> <span class="kwd">as</span> <span class="id">Hcmatch</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="ClientSim.html#match_tau">ClientSim.match_tau</a></span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> [<span class="id">STEP</span>|<span class="id">ABORT</span>].<br/>
&nbsp;sc&nbsp;step&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">STEP</span> <span class="kwd">as</span> (<span class="id">tfp</span> &amp; <span class="id">sc</span>' &amp; <span class="id">sm</span>' &amp; <span class="id">Hstep</span> &amp; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[(<span class="id">Hnonconflict</span> &amp; <span class="id">Hfp</span> &amp; <span class="id">HGc</span> &amp; <span class="id">Hmatch</span>' &amp; <span class="id">Halloc</span> &amp; <span class="id">Hvalideq</span>)|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hconflict</span> &amp; <span class="id">Hfp</span>)]);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">intros</span> <span class="id">_</span> | <span class="id">contradiction</span>].<br/>
&nbsp;non-conflicting&nbsp;footprint&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eexists</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> &lt;- <span class="id">Hflseq</span> <span class="kwd">in</span> <span class="id">Hstep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="SCSemLemmas.html#core_step_globstep">core_step_globstep</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">thread_pool</span>' &amp; <span class="id">Hgstep</span> &amp; <span class="id">Hthdpupd</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> {|<span class="id"><a href="GlobDefs.html#Build_ProgConfig">thread_pool</a></span> := <span class="id">thread_pool</span>';<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cur_tid</span> := <span class="id">t</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">gm</span> := <span class="id">sm</span>';<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">atom_bit</span> := <span class="id"><a href="GlobDefs.html#O">O</a></span> |}.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;match&nbsp;after&nbsp;step&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">auto</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> (<span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">eauto</span>; <span class="tactic">fail</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#Invs.H_sta_cc">H_sta_cc</a></span>; <span class="tactic">eauto</span>. <span class="tactic">destruct</span> <span class="id">Hmatch</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#Invs.H_sta_oc">H_sta_oc</a></span>; <span class="tactic">eauto</span>. <span class="tactic">destruct</span> <span class="id">Hmatch</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">ls</span> <span class="id">fp</span> <span class="id">s</span>' <span class="id">Hstar</span>'. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#source_safe">source_safe</a></span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="ETrace.html#star_step">ETrace.star_step</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#source_drf">source_drf</a></span>; <span class="tactic">eauto</span>. <span class="tactic">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> (<span class="id">ls</span> &amp; <span class="id">fp</span> &amp; <span class="id">s</span>' &amp; <span class="id">Hstar</span>' &amp; <span class="id">RACE</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 <span class="id">eexists</span>. <span class="tactic">split</span>;[<span class="tactic">eapply</span> <span class="id"><a href="ETrace.html#star_step">ETrace.star_step</a></span>; <span class="tactic">eauto</span>|<span class="tactic">auto</span>].<br/>
&nbsp;thread&nbsp;sims...&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">Hthdpupd</span>. <span class="id">inv</span> <span class="id">H3</span>. <span class="id">inv</span> <span class="id">H4</span>. <span class="id">inv</span> <span class="id">H3</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Eqdep_dec.html#inj_pair2_eq_dec">Eqdep_dec.inj_pair2_eq_dec</a></span> <span class="kwd">in</span> <span class="id">H7</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intro</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_upd</span>. <span class="id">inv</span> <span class="id">H_core_upd</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t0</span>).<br/>
&nbsp;case:&nbsp;t&nbsp;=&nbsp;t0&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">subst</span> <span class="id">t0</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#ThreadSimClient">ThreadSimClient</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#ThreadClientSim_Sta_Gc">ThreadClientSim_Sta_Gc</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#GE_mod_sim_source_step_sep_obj_clt_preserved">GE_mod_sim_source_step_sep_obj_clt_preserved</a></span> <span class="kwd">in</span> <span class="id">Hgstep</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#GE_eq">GE_eq</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_sep_obj_client_blocks">MS_sep_obj_client_blocks</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;case:&nbsp;t&nbsp;&lt;&gt;&nbsp;t0&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">do</span> 2 (<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">Htpsim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thread_simulation">thread_simulation</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">Htsim</span>. <span class="id">instantiate</span> (1:= <span class="id">t0</span>) <span class="kwd">in</span> <span class="id">Htsim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">Htsim</span>; <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span>, <span class="id"><a href="GlobDefs.html#CallStack.t">CallStack.t</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H6</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H3</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H7</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#ThreadSimClient">ThreadSimClient</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#ThreadClientSim_Sta_Gc">ThreadClientSim_Sta_Gc</a></span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#GE_mod_sim_source_step_sep_obj_clt_preserved">GE_mod_sim_source_step_sep_obj_clt_preserved</a></span> <span class="kwd">in</span> <span class="id">Hgstep</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#GE_eq">GE_eq</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_sep_obj_client_blocks">MS_sep_obj_client_blocks</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#ThreadSimObject">ThreadSimObject</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H8</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="ObjectSim.html#match_rely">ObjectSim.match_rely</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#Invs.H_rg_co">H_rg_co</a></span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#mem_inv_object">mem_inv_object</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#ThreadClientSim_Sta_Gc">ThreadClientSim_Sta_Gc</a></span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#GE_mod_sim_source_step_sep_obj_clt_preserved">GE_mod_sim_source_step_sep_obj_clt_preserved</a></span> <span class="kwd">in</span> <span class="id">Hgstep</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#GE_eq">GE_eq</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_sep_obj_client_blocks">MS_sep_obj_client_blocks</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#ThreadPool.upd_top_inv">ThreadPool.upd_top_inv</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hmatch</span>. <span class="tactic">destruct</span> <span class="id">thdp_sims0</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_top">ThreadPool.get_top</a></span>. <span class="tactic">rewrite</span> <span class="id">H2</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">H_tp_upd</span>. <span class="tactic">simpl</span>. <span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span>; <span class="tactic">eauto</span>. <span class="tactic">destruct</span> 1. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">H_tp_upd</span>. <span class="tactic">simpl</span>. <span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span>; <span class="tactic">eauto</span>. <span class="tactic">destruct</span> 1. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#ordinal_eq_dec">ordinal_eq_dec</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;fl&nbsp;embed...&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#FLs_embed_preserved">FLs_embed_preserved</a></span>; <span class="tactic">try</span> (<span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">eauto</span>; <span class="tactic">fail</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOCompInvs.html#match_fls_eq">match_fls_eq</a></span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id"><a href="GlobDefs.html#GlobEnv.wd_fl">GlobEnv.wd_fl</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#GE_wd">GE_wd</a></span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;inv&nbsp;thdp&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#glob_step_inv_preserve">glob_step_inv_preserve</a></span> <span class="kwd">in</span> <span class="id">Htsostep</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_tge_flwd">MS_tge_flwd</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#inv_thdp">inv_thdp</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;buffered&nbsp;alloc&nbsp;local&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#tsostep_buffered_alloc_in_fl">tsostep_buffered_alloc_in_fl</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#ThreadPool.cs_inv">ThreadPool.cs_inv</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#ThreadPool.fid_belongsto">ThreadPool.fid_belongsto</a></span> <span class="kwd">in</span> <span class="id">H</span>; [|<span class="tactic">simpl</span>; <span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H</span> <span class="id">Hmatch</span>. <span class="tactic">clear</span>. <span class="tactic">simpl</span>; <span class="tactic">intros</span> <span class="id">H</span> <span class="id">Hmatch</span> (<span class="id">tail</span> &amp; <span class="id">Hbuffer</span> &amp; <span class="id">Hbufalloc</span>) <span class="id">t0</span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">buf</span>'. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t0</span> <span class="id">t</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">eapply</span> <span class="id"><a href="Coqlib.html#in_app">in_app</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#buffered_alloc_local">buffered_alloc_local</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">fn</span> <span class="id">H</span>]. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hbufalloc</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">n</span> <span class="id">H0</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">fn</span>, <span class="id">n</span>. <span class="tactic">subst</span> <span class="id">flid</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#FLists.get_tfl">FLists.get_tfl</a></span>. <span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOCompInvs.html#match_fls_eq">match_fls_eq</a></span> <span class="kwd">in</span> *; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#buffered_alloc_local">buffered_alloc_local</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#tp_inv_src">tp_inv_src</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;fl_valid_eq&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exploit</span> (@<span class="id"><a href="GlobDefs.html#ThreadPool.fid_belongsto">ThreadPool.fid_belongsto</a></span> <span class="id">SGE</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#ThreadPool.cs_inv">ThreadPool.cs_inv</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#tp_inv_src">tp_inv_src</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span>. <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>. <span class="tactic">simpl</span>; <span class="id">left</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">fn</span> <span class="id">Hflid</span>]. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hflid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">fl_valid_eq_stable</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="ClientSim.html#Ic_unbuffer_safe">Ic_unbuffer_safe</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#mem_inv_client">mem_inv_client</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOCompInvs.html#match_fls_eq">match_fls_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="GlobDefs.html#GlobEnv.wd_fl">GlobEnv.wd_fl</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#GE_wd">GE_wd</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#fl_valid_match">fl_valid_match</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hmatch</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#MS_src_step_gmem_forward">MS_src_step_gmem_forward</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="InteractionSemantics.html#step_local_eff">step_local_eff</a></span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#GE_mod_sim_source_lang_wd">GE_mod_sim_source_lang_wd</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#GE_eq">GE_eq</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">_</span> <span class="id">Hnewblock</span>]. <span class="tactic">intros</span>. <span class="tactic">subst</span> <span class="id">flid</span>. <span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOCompInvs.html#match_fls_eq">match_fls_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hnewblock</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">flid</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#match_fls_eq">match_fls_eq</a></span> <span class="kwd">in</span> <span class="id">H_core_step</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span>. <span class="tactic">subst</span> <span class="id">flid</span>. <span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#match_fls_eq">match_fls_eq</a></span> <span class="kwd">in</span> <span class="id">Hvalideq</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;sep&nbsp;obj&nbsp;client&nbsp;block&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_source_step_sep_obj_clt_preserved">MS_source_step_sep_obj_clt_preserved</a></span> <span class="kwd">in</span> <span class="id">Hgstep</span>; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;sc&nbsp;abort&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intros</span> <span class="id">_</span>. <span class="id">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#source_safe">source_safe</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="ETrace.html#star_refl">ETrace.star_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <br/>
&nbsp;thread&nbsp;not&nbsp;halted&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H</span>; <span class="tactic">clear</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">intro</span>. <span class="id">inv</span> <span class="id">H0</span>. <span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">H2</span>.<br/>
&nbsp;no&nbsp;glob&nbsp;step&nbsp;except&nbsp;for&nbsp;sw&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOCompInvs.html#match_fls_eq">match_fls_eq</a></span> <span class="kwd">in</span> <span class="id">ABORT</span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hnatext</span>: <span class="id"><a href="InteractionSemantics.html#at_external">at_external</a></span> (<span class="id"><a href="InteractionSemantics.html#ModSem.lang">ModSem.lang</a></span> (<span class="id"><a href="GlobDefs.html#GlobEnv.modules">GlobEnv.modules</a></span> <span class="id">SGE</span> <span class="id">ix</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="InteractionSemantics.html#ModSem.Ge">ModSem.Ge</a></span> (<span class="id"><a href="GlobDefs.html#GlobEnv.modules">GlobEnv.modules</a></span> <span class="id">SGE</span> <span class="id">ix</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sc</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#thread_simulation">thread_simulation</a></span> <span class="kwd">with</span> (<span class="id">t0</span> := <span class="id">t</span>) <span class="kwd">in</span> <span class="id">Hmatch</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hmatch</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H</span>, <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">Hmatch</span>. <span class="id">inv</span> <span class="id">Hmatch</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id"><a href="ClientSim.html#match_at_external">ClientSim.match_at_external</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="AsmTSO.html#tsostep_not_atext">tsostep_not_atext</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hnhalt</span>: <span class="id"><a href="InteractionSemantics.html#halt">halt</a></span> (<span class="id"><a href="InteractionSemantics.html#ModSem.lang">ModSem.lang</a></span> (<span class="id"><a href="GlobDefs.html#GlobEnv.modules">GlobEnv.modules</a></span> <span class="id">SGE</span> <span class="id">ix</span>)) <span class="id">sc</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#thread_simulation">thread_simulation</a></span> <span class="kwd">with</span> (<span class="id">t0</span> := <span class="id">t</span>) <span class="kwd">in</span> <span class="id">Hmatch</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hmatch</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H</span>, <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">Hmatch</span>. <span class="id">inv</span> <span class="id">Hmatch</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id"><a href="ClientSim.html#match_halted">ClientSim.match_halted</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="AsmTSO.html#tsostep_not_halted">tsostep_not_halted</a></span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">H2</span>; <span class="tactic">auto</span>; <span class="id">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;tau&nbsp;step&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">GDefLemmas.solv_thread</span>. <span class="tactic">eapply</span> <span class="id">ABORT</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="id">GDefLemmas.solv_thread</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H</span> <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">GDefLemmas.solv_thread</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;tm_alloc_not_fl&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> (@<span class="id"><a href="GlobDefs.html#ThreadPool.fid_belongsto">ThreadPool.fid_belongsto</a></span> <span class="id">SGE</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#ThreadPool.cs_inv">ThreadPool.cs_inv</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#tp_inv_src">tp_inv_src</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span>. <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>. <span class="tactic">simpl</span>; <span class="id">left</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">fn</span> <span class="id">Hflid</span>]. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hflid</span>. <span class="tactic">subst</span> <span class="id">flid</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">t</span>' <span class="id">blk</span> <span class="id">n</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">Hneq</span> <span class="id">Hinbuffer</span> <span class="id">C</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#MS_tm_alloc_not_fl">MS_tm_alloc_not_fl</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#match_fls_eq">match_fls_eq</a></span> <span class="kwd">in</span> <span class="id">C</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;rel_tm_gm_vb&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> (@<span class="id"><a href="GlobDefs.html#ThreadPool.fid_belongsto">ThreadPool.fid_belongsto</a></span> <span class="id">SGE</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#ThreadPool.cs_inv">ThreadPool.cs_inv</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#tp_inv_src">tp_inv_src</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span>. <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>. <span class="tactic">simpl</span>; <span class="id">left</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">fn</span> <span class="id">Hflid</span>]. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hflid</span>. <span class="tactic">subst</span> <span class="id">flid</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#fl_valid_eq_rel_tm_gm_vb">fl_valid_eq_rel_tm_gm_vb</a></span>. <span class="tactic">simpl</span>. <span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#match_fls_eq">match_fls_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;object&nbsp;step&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">revert</span> <span class="id">H4</span> <span class="id">H_tp_core</span>. <span class="tactic">clear</span>. <span class="tactic">intros</span> <span class="id">Hsimobj</span> ? <span class="id">Hclient</span>. <span class="id">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hclient</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hsimobj</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;call&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">spc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#tid_eq">tid_eq</a></span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">intro</span>; <span class="tactic">subst</span> <span class="id">cur_tid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#atom_bit_0">atom_bit_0</a></span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">intro</span>; <span class="tactic">subst</span> <span class="id">atom_bit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">Htsim</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#thread_simulation">thread_simulation</a></span> <span class="kwd">in</span> <span class="id">Htsim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1:=<span class="id">t</span>) <span class="kwd">in</span> <span class="id">Htsim</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">Htsim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Htsim</span>. <span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;client&nbsp;call&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>. <span class="id">inv</span> <span class="id">H4</span>. <span class="id">pose</span> <span class="id">proof</span> <span class="id">H2</span> <span class="kwd">as</span> <span class="id">Hcmatch</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="ClientSim.html#match_at_external">ClientSim.match_at_external</a></span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#GE_eq">GE_eq</a></span>. <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">A</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">SGE</span>, <span class="id">TGE</span>. <span class="id">inv</span> <span class="id">A</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> <span class="id">_</span> ?<span class="id">x</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> <span class="id">_</span> ?<span class="id">y</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Eqdep.html#EqdepTheory.inj_pair2">Eqdep.EqdepTheory.inj_pair2</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">exists</span> <span class="id">ms_new</span> <span class="id">sc_new</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span>: <span class="id">G_new</span> := <span class="id"><a href="InteractionSemantics.html#ModSem.Ge">ModSem.Ge</a></span> (<span class="id">modules</span> <span class="id">new_ix</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span>: <span class="id">ge_new</span> := <span class="id"><a href="InteractionSemantics.html#ModSem.ge">ModSem.ge</a></span> (<span class="id">modules</span> <span class="id">new_ix</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id"><a href="ClientSim.html#clientsim_properties">clientsim_properties</a></span> <span class="id"><a href="ClientSim.html#Rc">Rc</a></span> <span class="id"><a href="ClientSim.html#Gc">Gc</a></span> <span class="id"><a href="ClientSim.html#Ic">Ic</a></span> <span class="id">G_new</span> <span class="id">ge_new</span> (<span class="id">modules0</span> <span class="id">new_ix</span>) <span class="id"><a href="TSOCompInvs.html#ms_new">ms_new</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id">nat_of_ord</span> <span class="id">new_ix</span> &lt;&gt; <span class="id">i_obj</span> /\ <span class="id"><a href="InteractionSemantics.html#ModSem.lang">ModSem.lang</a></span> (<span class="id">modules</span> <span class="id">new_ix</span>) = <span class="id"><a href="AsmLang.html#AsmLang">AsmLang</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="ObjectSim.html#objectsim_properties">objectsim_properties</a></span> <span class="id"><a href="TSOCompInvs.html#Invs.Ro">Ro</a></span> <span class="id"><a href="TSOCompInvs.html#Invs.Go">Go</a></span> <span class="id"><a href="TSOCompInvs.html#Invs.Io">Io</a></span> <span class="id">ge_new</span> <span class="id">G_new</span> (<span class="id">modules0</span> <span class="id">new_ix</span>) <span class="id"><a href="TSOCompInvs.html#ms_new">ms_new</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id">new_ix</span> = <span class="id">i_obj</span> /\ <span class="id"><a href="InteractionSemantics.html#ModSem.lang">ModSem.lang</a></span> (<span class="id">modules</span> <span class="id">new_ix</span>) = <span class="id"><a href="SpecLang.html#speclang">SpecLang.speclang</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="InteractionSemantics.html#init_core">init_core</a></span> (<span class="id"><a href="InteractionSemantics.html#ModSem.lang">ModSem.lang</a></span> (<span class="id">modules</span> <span class="id">new_ix</span>)) <span class="id">G_new</span> <span class="id">funid</span> <span class="id">args</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOCompInvs.html#sc_new">sc_new</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="TSOCompInvs.html#ms_new">ms_new</a></span> <span class="id">t</span> (<span class="id"><a href="TSOCompInvs.html#sc_new">sc_new</a></span>, <span class="id">gm</span>) (<span class="id">cc</span>', <span class="id">tm</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> (<span class="id">ms_new</span> &amp; <span class="id">sc_new</span> &amp; <span class="id">Hnewcore_sim</span> &amp; <span class="id">Hinit_new</span> &amp; <span class="id">Hms_new</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> (<span class="id">H15</span> <span class="id">new_ix</span>) <span class="kwd">as</span> [[<span class="id">Hcsim</span> <span class="id">Hmodid</span>]|[<span class="id">Hosim</span> <span class="id">Hmodid</span>]].<br/>
&nbsp;client&nbsp;module&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hcsim</span>. <span class="id">exploit</span> <span class="id"><a href="ClientSim.html#match_init">ClientSim.match_init</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">sc_new</span> &amp; <span class="id">Hinit_new</span> &amp; <span class="id">Hms_new</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">Hms_new</span> <span class="id">t</span> <span class="id">gm</span> <span class="id">tm</span>). <span class="id">inv</span> <span class="id">Hmatch</span>. <span class="tactic">auto</span>. <span class="id">inv</span> <span class="id">Hmatch</span>. <span class="tactic">auto</span>. <span class="tactic">clear</span> <span class="id">Hms_new</span>; <span class="tactic">intro</span> <span class="id">Hms_new</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">exists</span> <span class="id">ms0</span>, <span class="id">sc_new</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;object&nbsp;module&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hosim</span>. <span class="id">exploit</span> <span class="id"><a href="ObjectSim.html#match_init">ObjectSim.match_init</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">sc_new</span> &amp; <span class="id">Hinit_new</span> &amp; <span class="id">Hms_new</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">Hms_new</span> <span class="id">t</span> <span class="id">gm</span> <span class="id">tm</span>). <span class="id">inv</span> <span class="id">Hmatch</span>. <span class="tactic">auto</span>. <span class="tactic">clear</span> <span class="id">Hms_new</span>; <span class="tactic">intro</span> <span class="id">Hms_new</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">exists</span> <span class="id">ms0</span>, <span class="id">sc_new</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">_</span> <span class="id">_</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="id">eexists</span>. <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span> |- ?<span class="id">A</span> /\ ?<span class="id">B</span> =&gt; <span class="tactic">assert</span> <span class="id">A</span> <span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="GlobSemantics.html#Call">Call</a></span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_top">ThreadPool.get_top</a></span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H2</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H_mod_id</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.push">ThreadPool.push</a></span>, <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> &lt;- <span class="id">H</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">apply</span> <span class="id"><a href="Footprint.html#FP.subset_refl">FP.subset_refl</a></span>.<br/>
&nbsp;match&nbsp;after&nbsp;call&nbsp;step&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">simpl</span>. <span class="id">constructor</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> (<span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">auto</span>; <span class="tactic">fail</span>).<br/>
&nbsp;safe&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">ls</span> <span class="id">fp</span> <span class="id">s</span>' <span class="id">Hstar</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#source_safe">source_safe</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="ETrace.html#star_step">ETrace.star_step</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;drf&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#source_drf">source_drf</a></span>; <span class="tactic">eauto</span>. <span class="tactic">destruct</span> <span class="id">H4</span> <span class="kwd">as</span> (<span class="id">ls</span> &amp; <span class="id">fp</span> &amp; <span class="id">s</span>' &amp; <span class="id">Hstar</span>' &amp; <span class="id">RACE</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="id">eexists</span> <span class="id">_</span>, <span class="id">s</span>'. <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">eapply</span> <span class="id"><a href="ETrace.html#star_step">ETrace.star_step</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;thread&nbsp;sims...&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intro</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.push">TSOThrdPool.push</a></span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">H_tp_push</span>. <span class="id">inv</span> <span class="id">H_tp_push</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t0</span>).<br/>
&nbsp;case:&nbsp;t&nbsp;=&nbsp;t0&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">subst</span> <span class="id">t0</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#CallStack.push">CallStack.push</a></span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>. <span class="tactic">destruct</span> <span class="id">Hnewcore_sim</span> <span class="kwd">as</span> [[<span class="id">Hnewcore_csim</span> [<span class="id">Hix_new</span> <span class="id">Hlang</span>]]|[<span class="id">Hnewcore_osim</span> [<span class="id">Hix_new</span> <span class="id">Hlang</span>]]].<br/>
&nbsp;case:&nbsp;client&nbsp;module&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#ThreadSimClient">ThreadSimClient</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#next_fmap_eq">next_fmap_eq</a></span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.  <span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;case:&nbsp;object&nbsp;module&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#ThreadSimObject">ThreadSimObject</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#next_fmap_eq">next_fmap_eq</a></span>. <span class="tactic">subst</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;case:&nbsp;t&nbsp;&lt;&gt;&nbsp;t0&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">do</span> 2 (<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">Htpsim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thread_simulation">thread_simulation</a></span>; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#ThreadPool.push_inv">ThreadPool.push_inv</a></span>;(<span class="tactic">try</span> (<span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">eauto</span>; <span class="tactic">fail</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#tp_inv_src">tp_inv_src</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.push">ThreadPool.push</a></span>, <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> &lt;- <span class="id">H</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.push">TSOThrdPool.push</a></span> <span class="kwd">in</span> <span class="id">H_tp_push</span>. <span class="id">GDefLemmas.solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#valid_tid_eq">valid_tid_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.push">TSOThrdPool.push</a></span> <span class="kwd">in</span> <span class="id">H_tp_push</span>. <span class="id">GDefLemmas.solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#next_fmap_eq">next_fmap_eq</a></span>; <span class="tactic">eauto</span>). <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#next_fmap_eq">next_fmap_eq</a></span>; <span class="tactic">eauto</span>). <span class="tactic">simpl</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.add_1_r">Nat.add_1_r</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;inv&nbsp;thdp&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#glob_step_inv_preserve">glob_step_inv_preserve</a></span> <span class="kwd">in</span> <span class="id">Htsostep</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_tge_flwd">MS_tge_flwd</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#inv_thdp">inv_thdp</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;object&nbsp;call&nbsp;-&nbsp;impossible&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="id">exfalso</span>. <span class="id">inv</span> <span class="id">H0</span>. <span class="id">inv</span> <span class="id">H4</span>. <span class="tactic">apply</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="id">inv</span> <span class="id">H1</span>. <span class="tactic">simpl</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;return&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">spc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#tid_eq">tid_eq</a></span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">intro</span>; <span class="tactic">subst</span> <span class="id">cur_tid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#atom_bit_0">atom_bit_0</a></span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">intro</span>; <span class="tactic">subst</span> <span class="id">atom_bit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">Htsim</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#thread_simulation">thread_simulation</a></span> <span class="kwd">in</span> <span class="id">Htsim</span>; <span class="id">instantiate</span> (1:=<span class="id">t</span>) <span class="kwd">in</span> <span class="id">Htsim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">Htsim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Htsim</span>. <span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;client&nbsp;return&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;callee&nbsp;return&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>. <span class="id">inv</span> <span class="id">H4</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="ClientSim.html#match_halted">ClientSim.match_halted</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">Hhalt</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">H_core_halt</span> <span class="kwd">in</span> <span class="id">Hhalt</span>.<br/>
&nbsp;caller&nbsp;after&nbsp;external&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H5</span>. <span class="id">inv</span> <span class="id">H7</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="ClientSim.html#match_after_external">ClientSim.match_after_external</a></span>. <span class="tactic">exact</span> <span class="id">H4</span>. <span class="tactic">exact</span> <span class="id">H5</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">sc0</span>' &amp; <span class="id">Haftext</span> &amp; <span class="id">Hcmatch_caller</span>'). <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H2</span>.<br/>
&nbsp;cosntruct&nbsp;glob&nbsp;step&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">_</span> <span class="id">_</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#helper2">helper2</a></span>. <span class="tactic">do</span> 2 <span class="id">eexists</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="GlobSemantics.html#Return">Return</a></span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_top">ThreadPool.get_top</a></span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.pop">ThreadPool.pop</a></span>, <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> &lt;- <span class="id">H</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_top">ThreadPool.get_top</a></span>, <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_top">ThreadPool.get_top</a></span>, <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="id">econstructor</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hglobtaustep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">apply</span> <span class="id"><a href="Footprint.html#FP.subset_refl">FP.subset_refl</a></span>.<br/>
&nbsp;match&nbsp;after&nbsp;tau&nbsp;step&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>; <span class="tactic">try</span> (<span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">eauto</span>; <span class="tactic">fail</span>).<br/>
&nbsp;safe&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">ls</span> <span class="id">fp</span> <span class="id">s</span>' <span class="id">Hstar</span>'. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#source_safe">source_safe</a></span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="ETrace.html#star_step">ETrace.star_step</a></span>; <span class="tactic">eauto</span>. <br/>
&nbsp;drf&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#source_drf">source_drf</a></span>; <span class="tactic">eauto</span>. <span class="tactic">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> (<span class="id">ls</span> &amp; <span class="id">fp</span> &amp; <span class="id">s</span>' &amp; <span class="id">Hstar</span>' &amp; <span class="id">RACE</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="id">eexists</span> <span class="id">_</span>, <span class="id">s</span>'. <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">eapply</span> <span class="id"><a href="ETrace.html#star_step">ETrace.star_step</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;thread&nbsp;sims...&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intro</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">H_tp_pop</span>. <span class="id">inv</span> <span class="id">H_tp_pop</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_upd</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t0</span>).<br/>
&nbsp;case:&nbsp;t&nbsp;=&nbsp;t0&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">subst</span> <span class="id">t0</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#ThreadSimClient">ThreadSimClient</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>. <span class="id">inv</span> <span class="id">H_core_upd</span>. <span class="tactic">simpl</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H4</span>. <span class="tactic">auto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;case:&nbsp;t&nbsp;&lt;&gt;&nbsp;t0&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">do</span> 4 (<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">Htpsim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thread_simulation">thread_simulation</a></span>; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;tp&nbsp;inv&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> (@<span class="id"><a href="GlobDefs.html#ThreadPool.pop_inv">ThreadPool.pop_inv</a></span> <span class="id">SGE</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#tp_inv_src">tp_inv_src</a></span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.pop">ThreadPool.pop</a></span>, <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> &lt;- <span class="id">H</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">intro</span>. <span class="tactic">eapply</span> <span class="id"><a href="SCSemLemmas.html#thdp_inv_upd">thdp_inv_upd</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span>; <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="id">econstructor</span>. <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;tp&nbsp;next&nbsp;tid&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">inv</span> <span class="id">H_tp_upd</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">H_tp_pop</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_pop</span>. <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>; <span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">auto</span>.<br/>
&nbsp;next&nbsp;fmap&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_upd</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">H_tp_pop</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_pop</span>. <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>; <span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;inv&nbsp;thdp&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#glob_step_inv_preserve">glob_step_inv_preserve</a></span> <span class="kwd">in</span> <span class="id">Htsostep</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_tge_flwd">MS_tge_flwd</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#inv_thdp">inv_thdp</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;object&nbsp;return&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intro</span> <span class="id">Hclient</span>. <span class="id">exfalso</span>. <span class="id">inv</span> <span class="id">Hclient</span>; <span class="id">inv</span> <span class="id">H4</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H_tp_core</span>. <span class="id">inv</span> <span class="id">H_tp_core</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;thread&nbsp;halt&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">spc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#tid_eq">tid_eq</a></span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">intro</span>; <span class="tactic">subst</span> <span class="id">cur_tid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#atom_bit_0">atom_bit_0</a></span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">intro</span>; <span class="tactic">subst</span> <span class="id">atom_bit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">Htsim</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#thread_simulation">thread_simulation</a></span> <span class="kwd">in</span> <span class="id">Htsim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1:=<span class="id">t</span>) <span class="kwd">in</span> <span class="id">Htsim</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">Htsim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Htsim</span>. <span class="tactic">intros</span> <span class="id">Hclient</span> <span class="id">_</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#helper2">helper2</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;client&nbsp;halt&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">H0</span>. <span class="id">inv</span> <span class="id">H4</span>. <span class="id">inv</span> <span class="id">H5</span>. <span class="id">eexists</span> <span class="id">_</span>, <span class="id">_</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="GlobSemantics.html#Halt">Halt</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_top">ThreadPool.get_top</a></span>, <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> &lt;- <span class="id">H</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id"><a href="ClientSim.html#match_halted">ClientSim.match_halted</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.pop">ThreadPool.pop</a></span>, <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> &lt;- <span class="id">H</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>. <span class="tactic">eauto</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Hglobtaustep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">apply</span> <span class="id"><a href="Footprint.html#FP.subset_refl">FP.subset_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>; <span class="tactic">try</span> (<span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">eauto</span>; <span class="tactic">fail</span>).<br/>
&nbsp;safe&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">ls</span> <span class="id">fp</span> <span class="id">s</span>' <span class="id">Hstar</span>'. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#source_safe">source_safe</a></span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="ETrace.html#star_step">ETrace.star_step</a></span>; <span class="tactic">eauto</span>. <br/>
&nbsp;drf&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#source_drf">source_drf</a></span>; <span class="tactic">eauto</span>. <span class="tactic">destruct</span> <span class="id">H3</span> <span class="kwd">as</span> (<span class="id">ls</span> &amp; <span class="id">fp</span> &amp; <span class="id">s</span>' &amp; <span class="id">Hstar</span>' &amp; <span class="id">RACE</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="id">eexists</span> <span class="id">_</span>, <span class="id">s</span>'. <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">eapply</span> <span class="id"><a href="ETrace.html#star_step">ETrace.star_step</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;thread&nbsp;sims...&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intro</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">H_tp_pop</span>. <span class="id">inv</span> <span class="id">H_tp_pop</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t0</span>).<br/>
&nbsp;case:&nbsp;t&nbsp;=&nbsp;t0&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">subst</span> <span class="id">t0</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>. <span class="id">constructor</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;case:&nbsp;t&nbsp;&lt;&gt;&nbsp;t0&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">do</span> 2 (<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">Htpsim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thread_simulation">thread_simulation</a></span>; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;tp&nbsp;inv&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> (@<span class="id"><a href="GlobDefs.html#ThreadPool.pop_inv">ThreadPool.pop_inv</a></span> <span class="id">SGE</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#tp_inv_src">tp_inv_src</a></span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.pop">ThreadPool.pop</a></span>, <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> &lt;- <span class="id">H</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">auto</span>.<br/>
&nbsp;tp&nbsp;next&nbsp;tid&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">H_tp_pop</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_pop</span>. <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>; <span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">auto</span>.<br/>
&nbsp;next&nbsp;fmap&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">H_tp_pop</span>. <span class="id">inv</span> <span class="id">H_tp_pop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>; <span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;inv&nbsp;thdp&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#glob_step_inv_preserve">glob_step_inv_preserve</a></span> <span class="kwd">in</span> <span class="id">Htsostep</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_tge_flwd">MS_tge_flwd</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#inv_thdp">inv_thdp</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;object&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hclient</span>. <span class="id">inv</span> <span class="id">H4</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">inv</span> <span class="id">H0</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="MS_tau_step_fp_cases">MS_tau_step_fp_cases</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">spc</span> <span class="id">tpc</span> <span class="id">fp</span> <span class="id">tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#MS">MS</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOGlobSem.html#tau">tau</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOCompInvs.html#client_core">client_core</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="ClientSim.html#conflictc">conflictc</a></span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>))) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOCompInvs.html#client_core">client_core</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">fpS</span> <span class="id">spc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobSemantics.html#glob_step">glob_step</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id"><a href="ETrace.html#tau">ETrace.tau</a></span> <span class="id"><a href="TSOCompInvs.html#fpS">fpS</a></span> <span class="id">spc</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#fpmatchc">fpmatchc</a></span> <span class="id"><a href="TSOCompInvs.html#fpS">fpS</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#MS">MS</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id">spc</span>' <span class="id">tpc</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(~ <span class="id"><a href="TSOCompInvs.html#client_core">client_core</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">fpS</span> <span class="id">spc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ETrace.html#tau_star">tau_star</a></span> <span class="id"><a href="GlobSemantics.html#glob_step">glob_step</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id"><a href="TSOCompInvs.html#fpS">fpS</a></span> <span class="id">spc</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#MS">MS</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id">spc</span>' <span class="id">tpc</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html#obj_fp">obj_fp</a></span> (<span class="id"><a href="GlobDefs.html#gm">gm</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span>) (<span class="id"><a href="GlobDefs.html#gm">gm</a></span> <span class="id">spc</span>') <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10230')">Proof.</div>
<div class="proofscript" id="proof10230">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">spc</span> <span class="id">tpc</span> <span class="id">fp</span> <span class="id">tpc</span>' <span class="id">Hmatch</span> <span class="id">Htsostep</span> <span class="id">Hconflict</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOCompInvs.html#client_core_dec">client_core_dec</a></span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">tpc</span>) <span class="kwd">as</span> [<span class="id">HC</span>|<span class="id">HO</span>]; [<span class="id">left</span>|<span class="id">right</span>]; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">specialize</span> (<span class="id">Hconflict</span> <span class="id">HC</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#MS_preserved_after_tau_non_conflicting_client_step">MS_preserved_after_tau_non_conflicting_client_step</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">clear</span> <span class="id">Hconflict</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#match_fls_eq">match_fls_eq</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">Hflseq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id">Htsostep</span> <span class="kwd">as</span> <span class="id">Htsostep</span>'. <span class="id">inv</span> <span class="id">Htsostep</span>'. <br/>
&nbsp;module&nbsp;tau&nbsp;step&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">spc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#tid_eq">tid_eq</a></span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">intro</span>; <span class="tactic">subst</span> <span class="id">cur_tid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#atom_bit_0">atom_bit_0</a></span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">intro</span>; <span class="tactic">subst</span> <span class="id">atom_bit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">Htsim</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#thread_simulation">thread_simulation</a></span> <span class="kwd">in</span> <span class="id">Htsim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1:=<span class="id">t</span>) <span class="kwd">in</span> <span class="id">Htsim</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">Htsim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Htsim</span>. <span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;client&nbsp;step&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exfalso</span>. <span class="tactic">apply</span> <span class="id">HO</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="id">inv</span> <span class="id">H0</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">H4</span>. <span class="tactic">eauto</span>. }<br/>
&nbsp;object&nbsp;step&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">H4</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">pose</span> <span class="id">proof</span> <span class="id">H1</span> <span class="kwd">as</span> <span class="id">Homatch</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="ObjectSim.html#match_tau">ObjectSim.match_tau</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">Htaustar</span>|<span class="id">Hatomblock</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;sc&nbsp;star&nbsp;step&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htaustar</span> <span class="kwd">as</span> (<span class="id">sfp</span> &amp; <span class="id">sc</span>' &amp; <span class="id">sm</span>' &amp; <span class="id">Htaustar</span> &amp; <span class="id">HMatchOrAbort</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hflseq</span> <span class="kwd">in</span> <span class="id">Htaustar</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="SCSemLemmas.html#core_star_globstep_star">core_star_globstep_star</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">thread_pool</span>' &amp; <span class="id">Hglobtaustar</span> &amp; [<span class="id">Hmult</span> | <span class="id">Hzero</span>]).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;multiple&nbsp;step&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="id">eexists</span>; <span class="tactic">split</span>; [<span class="tactic">eauto</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">HMatchOrAbort</span> <span class="kwd">as</span> [(<span class="id">HGo</span> &amp; <span class="id">Hcmatch</span>' &amp; <span class="id">Halloc</span> &amp; <span class="id">Hvalideq</span> &amp; <span class="id">Hobjfp</span>) |<span class="id">Habort</span>]; [|<span class="id">exfalso</span>].<br/>
&nbsp;matched&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">try</span> (<span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">eauto</span>; <span class="tactic">fail</span>); <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#Invs.H_sta_co">H_sta_co</a></span>; <span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#Invs.H_sta_oo">H_sta_oo</a></span>; <span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;safe&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">ls</span> <span class="id">fp</span>' <span class="id">s</span>' <span class="id">Hstar</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="SCSemLemmas.html#taustar_etrace_star">taustar_etrace_star</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">ls</span>' <span class="id">Hstar</span>''].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#source_safe">source_safe</a></span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="SCSemLemmas.html#etrace_star_star">etrace_star_star</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;drf&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#source_drf">source_drf</a></span>; <span class="tactic">eauto</span>. <span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> (<span class="id">ls</span> &amp; <span class="id">fp</span>' &amp; <span class="id">s</span>' &amp; <span class="id">Hstar</span>' &amp; <span class="id">RACE</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="SCSemLemmas.html#taustar_etrace_star">taustar_etrace_star</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">ls</span>' <span class="id">Hstar</span>''].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 <span class="id">eexists</span>. <span class="tactic">split</span>;[<span class="tactic">eapply</span> <span class="id"><a href="SCSemLemmas.html#etrace_star_star">etrace_star_star</a></span>; <span class="tactic">eauto</span>|<span class="tactic">auto</span>].<br/>
&nbsp;thread&nbsp;sims...&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">Hmult</span>. <span class="id">inv</span> <span class="id">H2</span>. <span class="id">inv</span> <span class="id">H3</span>. <span class="id">inv</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Eqdep_dec.html#inj_pair2_eq_dec">Eqdep_dec.inj_pair2_eq_dec</a></span> <span class="kwd">in</span> <span class="id">H6</span>;[|<span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#ordinal_eq_dec">ordinal_eq_dec</a></span>]. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intro</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_upd</span>. <span class="id">inv</span> <span class="id">H_core_upd</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t0</span>).<br/>
&nbsp;case:&nbsp;t&nbsp;=&nbsp;t0&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">subst</span> <span class="id">t0</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#ThreadSimObject">ThreadSimObject</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#ThreadClientSim_Sta_Go">ThreadClientSim_Sta_Go</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_source_tau_star_step_sep_obj_clt_preserved">MS_source_tau_star_step_sep_obj_clt_preserved</a></span> <span class="kwd">in</span> <span class="id">Hglobtaustar</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#mem_inv_client">mem_inv_client</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;case:&nbsp;t&nbsp;&lt;&gt;&nbsp;t0&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">do</span> 2 (<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">Htpsim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thread_simulation">thread_simulation</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">Htsim</span>. <span class="id">instantiate</span> (1:= <span class="id">t0</span>) <span class="kwd">in</span> <span class="id">Htsim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">Htsim</span>; <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span>, <span class="id"><a href="GlobDefs.html#CallStack.t">CallStack.t</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H4</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H2</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#ThreadSimClient">ThreadSimClient</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#ThreadClientSim_Sta_Go">ThreadClientSim_Sta_Go</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_source_tau_star_step_sep_obj_clt_preserved">MS_source_tau_star_step_sep_obj_clt_preserved</a></span> <span class="kwd">in</span> <span class="id">Hglobtaustar</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#mem_inv_client">mem_inv_client</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#ThreadSimObject">ThreadSimObject</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H7</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="ObjectSim.html#match_rely">ObjectSim.match_rely</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#Invs.H_rg_oo">H_rg_oo</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#ThreadClientSim_Sta_Go">ThreadClientSim_Sta_Go</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_source_tau_star_step_sep_obj_clt_preserved">MS_source_tau_star_step_sep_obj_clt_preserved</a></span> <span class="kwd">in</span> <span class="id">Hglobtaustar</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#mem_inv_client">mem_inv_client</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#ThreadPool.upd_top_inv">ThreadPool.upd_top_inv</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>. <span class="tactic">destruct</span> <span class="id">Hmatch</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_top">ThreadPool.get_top</a></span>. <span class="tactic">rewrite</span> <span class="id">H1</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">H_tp_upd</span>. <span class="tactic">simpl</span>. <span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span>; <span class="tactic">eauto</span>. <span class="tactic">destruct</span> 1. <span class="tactic">auto</span>. } <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">H_tp_upd</span>. <span class="tactic">simpl</span>. <span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span>; <span class="tactic">eauto</span>. <span class="tactic">destruct</span> 1. <span class="tactic">auto</span>. } <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;fl&nbsp;embed&nbsp;...&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#FLs_embed_preserved">FLs_embed_preserved</a></span>. <span class="tactic">rewrite</span> &lt;- <span class="id">Hflseq</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="GlobDefs.html#GlobEnv.wd_fl">GlobEnv.wd_fl</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#GE_wd">GE_wd</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">auto</span>.<br/>
&nbsp;inv&nbsp;thdp&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#glob_step_inv_preserve">glob_step_inv_preserve</a></span> <span class="kwd">in</span> <span class="id">Htsostep</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_tge_flwd">MS_tge_flwd</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#inv_thdp">inv_thdp</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;alloc&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#tsostep_buffered_alloc_in_fl">tsostep_buffered_alloc_in_fl</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#ThreadPool.cs_inv">ThreadPool.cs_inv</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#ThreadPool.fid_belongsto">ThreadPool.fid_belongsto</a></span> <span class="kwd">in</span> <span class="id">H</span>; [|<span class="tactic">simpl</span>; <span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H</span> <span class="id">Hmatch</span>. <span class="tactic">clear</span>. <span class="tactic">simpl</span>; <span class="tactic">intros</span> <span class="id">H</span> <span class="id">Hmatch</span> (<span class="id">tail</span> &amp; <span class="id">Hbuffer</span> &amp; <span class="id">Hbufalloc</span>) <span class="id">t0</span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">buf</span>'. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t0</span> <span class="id">t</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">eapply</span> <span class="id"><a href="Coqlib.html#in_app">in_app</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#buffered_alloc_local">buffered_alloc_local</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">fn</span> <span class="id">H</span>]. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hbufalloc</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">n</span> <span class="id">H0</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">fn</span>, <span class="id">n</span>. <span class="tactic">subst</span> <span class="id">flid</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#FLists.get_tfl">FLists.get_tfl</a></span>. <span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOCompInvs.html#match_fls_eq">match_fls_eq</a></span> <span class="kwd">in</span> *; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#buffered_alloc_local">buffered_alloc_local</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#tp_inv_src">tp_inv_src</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;fl_valid_eq&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exploit</span> (@<span class="id"><a href="GlobDefs.html#ThreadPool.fid_belongsto">ThreadPool.fid_belongsto</a></span> <span class="id">SGE</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#ThreadPool.cs_inv">ThreadPool.cs_inv</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#tp_inv_src">tp_inv_src</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span>. <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>. <span class="tactic">simpl</span>; <span class="id">left</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">fn</span> <span class="id">Hflid</span>]. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hflid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">fl_valid_eq_stable</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="ClientSim.html#Ic_unbuffer_safe">Ic_unbuffer_safe</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#mem_inv_client">mem_inv_client</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOCompInvs.html#match_fls_eq">match_fls_eq</a></span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#GlobEnv.wd_fl">GlobEnv.wd_fl</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#GE_wd">GE_wd</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#fl_valid_match">fl_valid_match</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hmatch</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#MS_src_tau_star_step_gmem_forward">MS_src_tau_star_step_gmem_forward</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#star_corestep_LocalAlloc">star_corestep_LocalAlloc</a></span> <span class="kwd">in</span> <span class="id">Htaustar</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">flid</span>. <span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOCompInvs.html#match_fls_eq">match_fls_eq</a></span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">Htaustar</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#GE_mod_sim_source_lang_wd">GE_mod_sim_source_lang_wd</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#GE_eq">GE_eq</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">flid</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#match_fls_eq">match_fls_eq</a></span> <span class="kwd">in</span> <span class="id">H_core_step</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span>. <span class="tactic">subst</span> <span class="id">flid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#match_fls_eq">match_fls_eq</a></span> <span class="kwd">in</span> <span class="id">Hvalideq</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;sep&nbsp;obj&nbsp;client&nbsp;block&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_source_tau_star_step_sep_obj_clt_preserved">MS_source_tau_star_step_sep_obj_clt_preserved</a></span> <span class="kwd">in</span> <span class="id">Hglobtaustar</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;obj_fp&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;abort&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="SCSemLemmas.html#taustar_etrace_star">taustar_etrace_star</a></span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">ls</span> <span class="id">ETraceStar</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#source_safe">source_safe</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;thread&nbsp;not&nbsp;halted&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H</span> <span class="id">Hmult</span>; <span class="tactic">clear</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">intro</span>. <span class="id">inv</span> <span class="id">H0</span>. <span class="id">inv</span> <span class="id">Hmult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H3</span>. <span class="id">inv</span> <span class="id">H2</span>.<br/>
&nbsp;no&nbsp;glob&nbsp;step&nbsp;except&nbsp;for&nbsp;sw&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hflseq</span> <span class="kwd">in</span> <span class="id">Habort</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Habort</span> <span class="kwd">as</span> (<span class="id">Habort</span> &amp; <span class="id">Hnatext</span> &amp; <span class="id">Hnaftext</span> &amp; <span class="id">Hnhalt</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">H1</span>; <span class="tactic">auto</span>; <span class="id">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">GDefLemmas.solv_thread</span>. <span class="tactic">eapply</span> <span class="id">Habort</span>. <span class="tactic">eauto</span>.                  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">revert</span> <span class="id">H_core_atext</span>. <span class="id">GDefLemmas.solv_thread</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>; <span class="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">revert</span> <span class="id">H_core_halt</span>. <span class="id">GDefLemmas.solv_thread</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">congruence</span>. } <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">revert</span> <span class="id">H_core_halt</span>. <span class="id">GDefLemmas.solv_thread</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">revert</span> <span class="id">H_core_atext</span>. <span class="id">GDefLemmas.solv_thread</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>; <span class="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">revert</span> <span class="id">H_core_atext</span>. <span class="id">GDefLemmas.solv_thread</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>; <span class="tactic">congruence</span>. }                  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;zero&nbsp;step&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hzero</span> <span class="kwd">as</span> (<span class="id">A</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span> &amp; <span class="id">D</span>). <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="id">eexists</span>. <span class="tactic">split</span>. <span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">HMatchOrAbort</span> <span class="kwd">as</span> [<span class="id">Hmatch</span>' | <span class="id">Habort</span>].<br/>
&nbsp;match&nbsp;after&nbsp;star&nbsp;step&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">Hmatch</span>' <span class="kwd">as</span> [<span class="id">HGo</span> [<span class="id">Homatch</span>' (<span class="id">Halloc</span> &amp; <span class="id">Hvalideq</span> &amp; <span class="id">Hobjfp</span>)]]. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">try</span> (<span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">eauto</span>; <span class="tactic">fail</span>); <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#Invs.H_sta_co">H_sta_co</a></span>; <span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#Invs.H_sta_oo">H_sta_oo</a></span>; <span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intro</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_upd</span>. <span class="id">inv</span> <span class="id">H_core_upd</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t0</span>).<br/>
&nbsp;case:&nbsp;t&nbsp;=&nbsp;t0&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">subst</span> <span class="id">t0</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> &lt;- <span class="id">H</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#ThreadSimObject">ThreadSimObject</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#ThreadClientSim_Sta_Go">ThreadClientSim_Sta_Go</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_source_tau_star_step_sep_obj_clt_preserved">MS_source_tau_star_step_sep_obj_clt_preserved</a></span> <span class="kwd">in</span> <span class="id">Hglobtaustar</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#mem_inv_client">mem_inv_client</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="id">inv</span> <span class="id">H1</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;case:&nbsp;t&nbsp;&lt;&gt;&nbsp;t0&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">Htpsim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thread_simulation">thread_simulation</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">Htsim</span>. <span class="id">instantiate</span> (1:= <span class="id">t0</span>) <span class="kwd">in</span> <span class="id">Htsim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">Htsim</span>; <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span>, <span class="id"><a href="GlobDefs.html#CallStack.t">CallStack.t</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H3</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H2</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#ThreadSimClient">ThreadSimClient</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#ThreadClientSim_Sta_Go">ThreadClientSim_Sta_Go</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_source_tau_star_step_sep_obj_clt_preserved">MS_source_tau_star_step_sep_obj_clt_preserved</a></span> <span class="kwd">in</span> <span class="id">Hglobtaustar</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#mem_inv_client">mem_inv_client</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#ThreadSimObject">ThreadSimObject</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H6</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="ObjectSim.html#match_rely">ObjectSim.match_rely</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#Invs.H_rg_oo">H_rg_oo</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#ThreadClientSim_Sta_Go">ThreadClientSim_Sta_Go</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_source_tau_star_step_sep_obj_clt_preserved">MS_source_tau_star_step_sep_obj_clt_preserved</a></span> <span class="kwd">in</span> <span class="id">Hglobtaustar</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#mem_inv_client">mem_inv_client</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>; <span class="tactic">eauto</span>.                    <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span>; <span class="tactic">eauto</span>. <span class="tactic">destruct</span> 1. <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">H_tp_upd</span>. <span class="tactic">simpl</span>. <span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span>; <span class="tactic">eauto</span>. <span class="tactic">destruct</span> 1. <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">H_tp_upd</span>. <span class="tactic">simpl</span>. <span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span>; <span class="tactic">eauto</span>. <span class="tactic">destruct</span> 1. <span class="tactic">eauto</span>. }<br/>
&nbsp;Fls&nbsp;embed&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#FLs_embed_preserved">FLs_embed_preserved</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hflseq</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#GE_wd">GE_wd</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#fls_embed">fls_embed</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">auto</span>.<br/>
&nbsp;inv&nbsp;thdp&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#glob_step_inv_preserve">glob_step_inv_preserve</a></span> <span class="kwd">in</span> <span class="id">Htsostep</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_tge_flwd">MS_tge_flwd</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#inv_thdp">inv_thdp</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;buffered&nbsp;alloc&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#tsostep_buffered_alloc_in_fl">tsostep_buffered_alloc_in_fl</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#ThreadPool.cs_inv">ThreadPool.cs_inv</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#ThreadPool.fid_belongsto">ThreadPool.fid_belongsto</a></span> <span class="kwd">in</span> <span class="id">H</span>; [|<span class="tactic">simpl</span>; <span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H</span> <span class="id">Hmatch</span>. <span class="tactic">clear</span>. <span class="tactic">simpl</span>; <span class="tactic">intros</span> <span class="id">H</span> <span class="id">Hmatch</span> (<span class="id">tail</span> &amp; <span class="id">Hbuffer</span> &amp; <span class="id">Hbufalloc</span>) <span class="id">t0</span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">buf</span>'. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t0</span> <span class="id">t</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id"><a href="Coqlib.html#in_app">in_app</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#buffered_alloc_local">buffered_alloc_local</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">fn</span> <span class="id">H</span>]. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hbufalloc</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">n</span> <span class="id">H0</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">fn</span>, <span class="id">n</span>. <span class="tactic">subst</span> <span class="id">flid</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#FLists.get_tfl">FLists.get_tfl</a></span>. <span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOCompInvs.html#match_fls_eq">match_fls_eq</a></span> <span class="kwd">in</span> *; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#buffered_alloc_local">buffered_alloc_local</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#tp_inv_src">tp_inv_src</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;fl_valid_eq&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exploit</span> (@<span class="id"><a href="GlobDefs.html#ThreadPool.fid_belongsto">ThreadPool.fid_belongsto</a></span> <span class="id">SGE</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#ThreadPool.cs_inv">ThreadPool.cs_inv</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#tp_inv_src">tp_inv_src</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span>. <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>. <span class="tactic">simpl</span>; <span class="id">left</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">fn</span> <span class="id">Hflid</span>]. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hflid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">fl_valid_eq_stable</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="ClientSim.html#Ic_unbuffer_safe">Ic_unbuffer_safe</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#mem_inv_client">mem_inv_client</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOCompInvs.html#match_fls_eq">match_fls_eq</a></span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#GlobEnv.wd_fl">GlobEnv.wd_fl</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#GE_wd">GE_wd</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#fl_valid_match">fl_valid_match</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hmatch</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#MS_src_tau_star_step_gmem_forward">MS_src_tau_star_step_gmem_forward</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#star_corestep_LocalAlloc">star_corestep_LocalAlloc</a></span> <span class="kwd">in</span> <span class="id">Htaustar</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">flid</span>. <span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOCompInvs.html#match_fls_eq">match_fls_eq</a></span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">Htaustar</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#GE_mod_sim_source_lang_wd">GE_mod_sim_source_lang_wd</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#GE_eq">GE_eq</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">flid</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#match_fls_eq">match_fls_eq</a></span> <span class="kwd">in</span> <span class="id">H_core_step</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span>. <span class="tactic">subst</span> <span class="id">flid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#match_fls_eq">match_fls_eq</a></span> <span class="kwd">in</span> <span class="id">Hvalideq</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;obj_fp&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;abort&nbsp;after&nbsp;zero&nbsp;step...&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="SCSemLemmas.html#taustar_etrace_star">taustar_etrace_star</a></span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">ls</span> <span class="id">Htaustar</span>'].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#source_safe">source_safe</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;thread&nbsp;not&nbsp;halted&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H</span>; <span class="tactic">clear</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">intro</span>. <span class="id">inv</span> <span class="id">H0</span>. <span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">H2</span>.<br/>
&nbsp;no&nbsp;glob&nbsp;step&nbsp;except&nbsp;for&nbsp;sw&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hflseq</span> <span class="kwd">in</span> <span class="id">Habort</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Habort</span> <span class="kwd">as</span> (<span class="id">Habort</span> &amp; <span class="id">Hnatext</span> &amp; <span class="id">Hnaftext</span> &amp; <span class="id">Hnhalt</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">H1</span>; <span class="tactic">auto</span>; <span class="id">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">GDefLemmas.solv_thread</span>. <span class="tactic">eapply</span> <span class="id">Habort</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">revert</span> <span class="id">H_core_atext</span>. <span class="id">GDefLemmas.solv_thread</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H</span> <span class="kwd">in</span> <span class="id">H_tp_core0</span>. <span class="id">GDefLemmas.solv_thread</span>. <span class="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">revert</span> <span class="id">H_core_halt</span>. <span class="id">GDefLemmas.solv_thread</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H</span> <span class="kwd">in</span> <span class="id">H_tp_core0</span>. <span class="id">GDefLemmas.solv_thread</span>. <span class="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">revert</span> <span class="id">H_core_halt</span>. <span class="id">GDefLemmas.solv_thread</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H</span> <span class="kwd">in</span> <span class="id">H_tp_core0</span>. <span class="id">GDefLemmas.solv_thread</span>. <span class="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">revert</span> <span class="id">H_core_atext</span>. <span class="id">GDefLemmas.solv_thread</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">revert</span> <span class="id">H_core_atext</span>. <span class="id">GDefLemmas.solv_thread</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;sc&nbsp;atomic&nbsp;block&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hatomblock</span> <span class="kwd">as</span> (<span class="id">sfp_star</span> &amp; <span class="id">sc_ent</span> &amp; <span class="id">sm_ent</span> &amp; <span class="id">sc_ent</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp; <span class="id">sfp_star</span>' &amp; <span class="id">sc_ext</span> &amp; <span class="id">sm_ext</span> &amp; <span class="id">sc_ext</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp; <span class="id">Hstar</span> &amp; <span class="id">Hent</span> &amp; <span class="id">Hent</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp; <span class="id">Hatomstar</span> &amp; <span class="id">HExtOrAbort</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hflseq</span> <span class="kwd">in</span> *.<br/>
&nbsp;glob&nbsp;tau&nbsp;star&nbsp;step&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="SCSemLemmas.html#core_star_globstep_star">core_star_globstep_star</a></span>. <span class="tactic">exact</span> <span class="id">Hstar</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H</span>.  <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">tp</span>' &amp; <span class="id">Hglobstar</span> &amp; <span class="id">Htp</span>').<br/>
&nbsp;glob&nbsp;ent&nbsp;atom&nbsp;step&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hglobent</span>: <span class="id">exists</span> <span class="id">tp</span>'', <span class="id"><a href="GlobSemantics.html#glob_step">glob_step</a></span> {| <span class="id"><a href="GlobDefs.html#Build_ProgConfig">thread_pool</a></span> := <span class="id">tp</span>'; <span class="id">cur_tid</span> := <span class="id">t</span>; <span class="id">gm</span> := <span class="id">sm_ent</span>; <span class="id">atom_bit</span> := <span class="id"><a href="GlobDefs.html#O">O</a></span> |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ETrace.html#tau">ETrace.tau</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{| <span class="id"><a href="GlobDefs.html#Build_ProgConfig">thread_pool</a></span> := <span class="id">tp</span>''; <span class="id">cur_tid</span> := <span class="id">t</span>; <span class="id">gm</span> := <span class="id">sm_ent</span>; <span class="id">atom_bit</span> := <span class="id"><a href="GlobDefs.html#I">I</a></span> |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#ThreadPool.update">ThreadPool.update</a></span> <span class="id">tp</span>' <span class="id">t</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{| <span class="id"><a href="GlobDefs.html#Core.Build_t">Core.i</a></span> := <span class="id">ix</span>; <span class="id">Core.c</span> := <span class="id">sc_ent</span>'; <span class="id">Core.sg</span> := <span class="id">sg</span>; <span class="id">Core.F</span> := <span class="id">flid</span> |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tp</span>'').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">Htp</span>' <span class="kwd">as</span> [<span class="id">Htp</span>'|<span class="id">Htp</span>'].<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>. <span class="tactic">split</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">GDefLemmas.solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="id">GDefLemmas.solv_thread</span>. <span class="id">econstructor</span>. <span class="id">econstructor</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="id">GDefLemmas.solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="id">econstructor</span>. <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htp</span>' <span class="kwd">as</span> (<span class="id">A</span>&amp;<span class="id">B</span>&amp;<span class="id">C</span>&amp;<span class="id">D</span>). <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>. <span class="tactic">split</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">GDefLemmas.solv_thread</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="id">GDefLemmas.solv_thread</span>. <span class="id">econstructor</span>. <span class="id">econstructor</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="id">GDefLemmas.solv_thread</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="id">econstructor</span>. <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hglobent</span> <span class="kwd">as</span> [<span class="id">tp</span>'' [<span class="id">Hglobent</span> <span class="id">Htp</span>'']].<br/>
&nbsp;glob&nbsp;atom&nbsp;star&nbsp;step&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="SCSemLemmas.html#core_star_globstep_star">core_star_globstep_star</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">Hatomstar</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">instantiate</span> (4:= <span class="id">tp</span>'').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (3:= <span class="id">t</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (2:= <span class="id">sg</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1:= <span class="id">scs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htp</span>' <span class="kwd">as</span> [<span class="id">Htp</span>'|(<span class="id">A</span>&amp;<span class="id">B</span>&amp;<span class="id">C</span>&amp;<span class="id">D</span>)]; <span class="id">GDefLemmas.solv_thread</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">tp</span>''' &amp; <span class="id">Hglobatomstar</span> &amp; <span class="id">Htp</span>''').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1:= <span class="id"><a href="GlobDefs.html#O">O</a></span>) <span class="kwd">in</span> <span class="id">Hglobstar</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1:= <span class="id"><a href="GlobDefs.html#I">I</a></span>) <span class="kwd">in</span> <span class="id">Hglobatomstar</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">HExtOrAbort</span> <span class="kwd">as</span> [ (<span class="id">Hext</span> &amp; <span class="id">Hext</span>' &amp; <span class="id">HGo</span> &amp; <span class="id">Homatch</span>' &amp; <span class="id">Halloc</span> &amp; <span class="id">Hvalideq</span> &amp; <span class="id">Hobjfp</span>) | <span class="id">Habort</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;ext&nbsp;atom&nbsp;and&nbsp;match&nbsp;*)</span><br/>
&nbsp;glob&nbsp;ext&nbsp;atom&nbsp;step&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hglobext</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">tp</span>'''', <span class="id"><a href="GlobSemantics.html#glob_step">glob_step</a></span> {| <span class="id"><a href="GlobDefs.html#Build_ProgConfig">thread_pool</a></span> := <span class="id">tp</span>'''; <span class="id">cur_tid</span> := <span class="id">t</span>; <span class="id">gm</span> := <span class="id">sm_ext</span>; <span class="id">atom_bit</span> := <span class="id"><a href="GlobDefs.html#I">I</a></span> |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ETrace.html#tau">ETrace.tau</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{| <span class="id"><a href="GlobDefs.html#Build_ProgConfig">thread_pool</a></span> := <span class="id">tp</span>''''; <span class="id">cur_tid</span> := <span class="id">t</span>; <span class="id">gm</span> := <span class="id">sm_ext</span>; <span class="id">atom_bit</span> := <span class="id"><a href="GlobDefs.html#O">O</a></span> |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobDefs.html#ThreadPool.update">ThreadPool.update</a></span> <span class="id">tp</span>''' <span class="id">t</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{| <span class="id"><a href="GlobDefs.html#Core.Build_t">Core.i</a></span> := <span class="id">ix</span>; <span class="id">Core.c</span> := <span class="id">sc_ext</span>'; <span class="id">Core.sg</span> := <span class="id">sg</span>; <span class="id">Core.F</span> := <span class="id">flid</span> |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tp</span>'''').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">Htp</span>''' <span class="kwd">as</span> [<span class="id">Htp</span>'''|(<span class="id">A</span>'&amp;<span class="id">B</span>'&amp;<span class="id">C</span>'&amp;<span class="id">D</span>')]; <span class="tactic">subst</span>; <span class="id">GDefLemmas.solv_thread</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>. <span class="tactic">split</span>. <span class="id">econstructor</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_top">ThreadPool.get_top</a></span>, <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span>. <span class="tactic">simpl</span>. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="id">econstructor</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span>. <span class="tactic">simpl</span>. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span>. <span class="tactic">simpl</span>. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="id">econstructor</span>. <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>. <span class="tactic">split</span>. <span class="id">econstructor</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_top">ThreadPool.get_top</a></span>, <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span>. <span class="tactic">simpl</span>. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="id">econstructor</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span>. <span class="tactic">simpl</span>. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span>. <span class="tactic">simpl</span>. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="id">econstructor</span>. <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hglobext</span> <span class="kwd">as</span> [<span class="id">tp</span>'''' [<span class="id">Hglobext</span> <span class="id">Htp</span>'''']].<br/>
<br/>
&nbsp;sc&nbsp;atomic&nbsp;block&nbsp;and&nbsp;match&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="Footprint.html#FP.union">FP.union</a></span> <span class="id">sfp_star</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Footprint.html#FP.union">FP.union</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Footprint.html#FP.union">FP.union</a></span> <span class="id">sfp_star</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Footprint.html#FP.union">FP.union</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span>)))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> {| <span class="id"><a href="GlobDefs.html#Build_ProgConfig">thread_pool</a></span> := <span class="id">tp</span>''''; <span class="id">cur_tid</span> := <span class="id">t</span>; <span class="id">gm</span> := <span class="id">sm_ext</span>; <span class="id">atom_bit</span> := <span class="id"><a href="GlobDefs.html#O">O</a></span> |}.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="ETrace.html#tau_star">tau_star</a></span> <span class="id"><a href="GlobSemantics.html#glob_step">glob_step</a></span> {| <span class="id"><a href="GlobDefs.html#Build_ProgConfig">thread_pool</a></span> := <span class="id">thread_pool</span>; <span class="id">cur_tid</span> := <span class="id">t</span>; <span class="id">gm</span> := <span class="id">gm</span>; <span class="id">atom_bit</span> := <span class="id"><a href="GlobDefs.html#O">O</a></span> |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Footprint.html#FP.union">FP.union</a></span> <span class="id">sfp_star</span> (<span class="id"><a href="Footprint.html#FP.union">FP.union</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> (<span class="id"><a href="Footprint.html#FP.union">FP.union</a></span> <span class="id">sfp_star</span>' (<span class="id"><a href="Footprint.html#FP.union">FP.union</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span>))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{| <span class="id"><a href="GlobDefs.html#Build_ProgConfig">thread_pool</a></span> := <span class="id">tp</span>''''; <span class="id">cur_tid</span> := <span class="id">t</span>; <span class="id">gm</span> := <span class="id">sm_ext</span>; <span class="id">atom_bit</span> := <span class="id"><a href="GlobDefs.html#O">O</a></span> |}) <span class="kwd">as</span> <span class="id">Htaustar</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="ETrace.html#tau_star_star">tau_star_star</a></span>. <span class="tactic">exact</span> <span class="id">Hglobstar</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="ETrace.html#tau_star_cons">tau_star_cons</a></span>. <span class="tactic">exact</span> <span class="id">Hglobent</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="ETrace.html#tau_star_star">tau_star_star</a></span>. <span class="tactic">exact</span> <span class="id">Hglobatomstar</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="ETrace.html#tau_star_cons">tau_star_cons</a></span>. <span class="tactic">exact</span> <span class="id">Hglobext</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="ETrace.html#tau_star_0">tau_star_0</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">auto</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">try</span> (<span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">eauto</span>; <span class="tactic">fail</span>); <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#Invs.H_sta_co">H_sta_co</a></span>; <span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#Invs.H_sta_oo">H_sta_oo</a></span>; <span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;safe&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">ls</span> <span class="id">fp</span>' <span class="id">s</span>' <span class="id">Hstar</span>'. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="SCSemLemmas.html#taustar_etrace_star">taustar_etrace_star</a></span>. <span class="tactic">exact</span> <span class="id">Htaustar</span>. <span class="tactic">intros</span> [<span class="id">ls</span>' <span class="id">Hstar</span>'0].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#source_safe">source_safe</a></span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="SCSemLemmas.html#etrace_star_star">etrace_star_star</a></span>; <span class="tactic">eauto</span>. <br/>
&nbsp;drf&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="SCSemLemmas.html#taustar_etrace_star">taustar_etrace_star</a></span>. <span class="tactic">exact</span> <span class="id">Htaustar</span>. <span class="tactic">intros</span> [<span class="id">ls</span>' <span class="id">Hstar</span>'0].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#source_drf">source_drf</a></span>; <span class="tactic">eauto</span>. <span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> (<span class="id">ls</span> &amp; <span class="id">fp</span>' &amp; <span class="id">s</span>' &amp; <span class="id">Hstar</span>' &amp; <span class="id">RACE</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="id">eexists</span> <span class="id">_</span>, <span class="id">s</span>'. <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">eapply</span> <span class="id"><a href="SCSemLemmas.html#etrace_star_star">etrace_star_star</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;thread&nbsp;sims...&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intro</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_upd</span>. <span class="id">inv</span> <span class="id">H_core_upd</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="id">inv</span> <span class="id">H1</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t0</span>).<br/>
&nbsp;case:&nbsp;t&nbsp;=&nbsp;t0&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">subst</span> <span class="id">t0</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htp</span>''' <span class="kwd">as</span> [<span class="id">Htp</span>'''|(<span class="id">A</span>'&amp;<span class="id">B</span>'&amp;<span class="id">C</span>'&amp;<span class="id">D</span>')]; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htp</span>' <span class="kwd">as</span> [<span class="id">Htp</span>'|(<span class="id">A</span>&amp;<span class="id">B</span>&amp;<span class="id">C</span>&amp;<span class="id">D</span>)]; <span class="tactic">subst</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">GDefLemmas.solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#ThreadSimObject">ThreadSimObject</a></span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#ThreadClientSim_Sta_Go">ThreadClientSim_Sta_Go</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_source_tau_star_step_sep_obj_clt_preserved">MS_source_tau_star_step_sep_obj_clt_preserved</a></span> <span class="kwd">in</span> <span class="id">Htaustar</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#mem_inv_client">mem_inv_client</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">GDefLemmas.solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#ThreadSimObject">ThreadSimObject</a></span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#ThreadClientSim_Sta_Go">ThreadClientSim_Sta_Go</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_source_tau_star_step_sep_obj_clt_preserved">MS_source_tau_star_step_sep_obj_clt_preserved</a></span> <span class="kwd">in</span> <span class="id">Htaustar</span>; <span class="tactic">eauto</span>.                    <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#mem_inv_client">mem_inv_client</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">GDefLemmas.solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#ThreadSimObject">ThreadSimObject</a></span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#ThreadClientSim_Sta_Go">ThreadClientSim_Sta_Go</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_source_tau_star_step_sep_obj_clt_preserved">MS_source_tau_star_step_sep_obj_clt_preserved</a></span> <span class="kwd">in</span> <span class="id">Htaustar</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#mem_inv_client">mem_inv_client</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">GDefLemmas.solv_thread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#ThreadSimObject">ThreadSimObject</a></span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#ThreadClientSim_Sta_Go">ThreadClientSim_Sta_Go</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_source_tau_star_step_sep_obj_clt_preserved">MS_source_tau_star_step_sep_obj_clt_preserved</a></span> <span class="kwd">in</span> <span class="id">Htaustar</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#mem_inv_client">mem_inv_client</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;case:&nbsp;t&nbsp;&lt;&gt;&nbsp;t0&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">Htpsim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thread_simulation">thread_simulation</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">Htsim</span>. <span class="id">instantiate</span> (1:= <span class="id">t0</span>) <span class="kwd">in</span> <span class="id">Htsim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> ((<span class="id"><a href="GlobDefs.html#ThreadPool.content">ThreadPool.content</a></span> <span class="id">tp</span>'''') !! <span class="id">t0</span> = (<span class="id"><a href="GlobDefs.html#ThreadPool.content">ThreadPool.content</a></span> <span class="id">thread_pool</span>) !! <span class="id">t0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">revert</span> <span class="id">Htp</span>' <span class="id">Htp</span>'' <span class="id">Htp</span>''' <span class="id">Htp</span>'''' <span class="id">n</span>. <span class="tactic">clear</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htp</span>''' <span class="kwd">as</span> [<span class="id">Htp</span>'''|(<span class="id">A</span>'&amp;<span class="id">B</span>'&amp;<span class="id">C</span>'&amp;<span class="id">D</span>')]; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htp</span>' <span class="kwd">as</span> [<span class="id">Htp</span>'|(<span class="id">A</span>&amp;<span class="id">B</span>&amp;<span class="id">C</span>&amp;<span class="id">D</span>)]; <span class="tactic">subst</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">GDefLemmas.solv_thread</span>; <span class="tactic">repeat</span> <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>; <span class="tactic">try</span> <span class="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span>. <span class="tactic">clear</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Htsim</span>; <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span>, <span class="id"><a href="GlobDefs.html#CallStack.t">CallStack.t</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H2</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H1</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#ThreadSimClient">ThreadSimClient</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#ThreadClientSim_Sta_Go">ThreadClientSim_Sta_Go</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_source_tau_star_step_sep_obj_clt_preserved">MS_source_tau_star_step_sep_obj_clt_preserved</a></span> <span class="kwd">in</span> <span class="id">Htaustar</span>; <span class="tactic">eauto</span>.                  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#mem_inv_client">mem_inv_client</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#ThreadSimObject">ThreadSimObject</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H4</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="ObjectSim.html#match_rely">ObjectSim.match_rely</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#Invs.H_rg_oo">H_rg_oo</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#ThreadClientSim_Sta_Go">ThreadClientSim_Sta_Go</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_source_tau_star_step_sep_obj_clt_preserved">MS_source_tau_star_step_sep_obj_clt_preserved</a></span> <span class="kwd">in</span> <span class="id">Htaustar</span>; <span class="tactic">eauto</span>.                  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#mem_inv_client">mem_inv_client</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">revert</span> <span class="id">Hmatch</span> <span class="id">Htp</span>' <span class="id">Htp</span>'' <span class="id">Htp</span>''' <span class="id">Htp</span>''''. <span class="tactic">clear</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htp</span>''' <span class="kwd">as</span> [<span class="id">Htp</span>'''|(<span class="id">A</span>'&amp;<span class="id">B</span>'&amp;<span class="id">C</span>'&amp;<span class="id">D</span>')]; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htp</span>' <span class="kwd">as</span> [<span class="id">Htp</span>'|(<span class="id">A</span>&amp;<span class="id">B</span>&amp;<span class="id">C</span>&amp;<span class="id">D</span>)]; <span class="tactic">subst</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 4 (<span class="tactic">eapply</span> <span class="id"><a href="SCSemLemmas.html#thdp_inv_upd">thdp_inv_upd</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#tp_inv_src">tp_inv_src</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 (<span class="tactic">eapply</span> <span class="id"><a href="SCSemLemmas.html#thdp_inv_upd">thdp_inv_upd</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#tp_inv_src">tp_inv_src</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 (<span class="tactic">eapply</span> <span class="id"><a href="SCSemLemmas.html#thdp_inv_upd">thdp_inv_upd</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#tp_inv_src">tp_inv_src</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 (<span class="tactic">eapply</span> <span class="id"><a href="SCSemLemmas.html#thdp_inv_upd">thdp_inv_upd</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#tp_inv_src">tp_inv_src</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">H_tp_upd</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Hmatch</span> <span class="id">Htp</span>' <span class="id">Htp</span>'' <span class="id">Htp</span>''' <span class="id">Htp</span>''''. <span class="tactic">clear</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htp</span>''' <span class="kwd">as</span> [<span class="id">Htp</span>'''|(<span class="id">A</span>'&amp;<span class="id">B</span>'&amp;<span class="id">C</span>'&amp;<span class="id">D</span>')]; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htp</span>' <span class="kwd">as</span> [<span class="id">Htp</span>'|(<span class="id">A</span>&amp;<span class="id">B</span>&amp;<span class="id">C</span>&amp;<span class="id">D</span>)]; <span class="tactic">subst</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 4 (<span class="id">erewrite</span> <span class="id"><a href="SCSemLemmas.html#thdp_upd_next_tid">thdp_upd_next_tid</a></span>; <span class="tactic">eauto</span>). <span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 (<span class="id">erewrite</span> <span class="id"><a href="SCSemLemmas.html#thdp_upd_next_tid">thdp_upd_next_tid</a></span>; <span class="tactic">eauto</span>). <span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 (<span class="id">erewrite</span> <span class="id"><a href="SCSemLemmas.html#thdp_upd_next_tid">thdp_upd_next_tid</a></span>; <span class="tactic">eauto</span>). <span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 (<span class="id">erewrite</span> <span class="id"><a href="SCSemLemmas.html#thdp_upd_next_tid">thdp_upd_next_tid</a></span>; <span class="tactic">eauto</span>). <span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">H_tp_upd</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Hmatch</span> <span class="id">Htp</span>' <span class="id">Htp</span>'' <span class="id">Htp</span>''' <span class="id">Htp</span>''''. <span class="tactic">clear</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htp</span>''' <span class="kwd">as</span> [<span class="id">Htp</span>'''|(<span class="id">A</span>'&amp;<span class="id">B</span>'&amp;<span class="id">C</span>'&amp;<span class="id">D</span>')]; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htp</span>' <span class="kwd">as</span> [<span class="id">Htp</span>'|(<span class="id">A</span>&amp;<span class="id">B</span>&amp;<span class="id">C</span>&amp;<span class="id">D</span>)]; <span class="tactic">subst</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 4 (<span class="id">erewrite</span> <span class="id"><a href="SCSemLemmas.html#thdp_upd_next_fmap">thdp_upd_next_fmap</a></span>; <span class="tactic">eauto</span>). <span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 (<span class="id">erewrite</span> <span class="id"><a href="SCSemLemmas.html#thdp_upd_next_fmap">thdp_upd_next_fmap</a></span>; <span class="tactic">eauto</span>). <span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 (<span class="id">erewrite</span> <span class="id"><a href="SCSemLemmas.html#thdp_upd_next_fmap">thdp_upd_next_fmap</a></span>; <span class="tactic">eauto</span>). <span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 (<span class="id">erewrite</span> <span class="id"><a href="SCSemLemmas.html#thdp_upd_next_fmap">thdp_upd_next_fmap</a></span>; <span class="tactic">eauto</span>). <span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;tso&nbsp;tau&nbsp;step&nbsp;fm&nbsp;exists..&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#FLs_embed_preserved">FLs_embed_preserved</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hflseq</span>. <span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#GlobEnv.wd_fl">GlobEnv.wd_fl</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#GE_wd">GE_wd</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#fls_embed">fls_embed</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">auto</span>.<br/>
&nbsp;inv&nbsp;thdp&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#glob_step_inv_preserve">glob_step_inv_preserve</a></span> <span class="kwd">in</span> <span class="id">Htsostep</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_tge_flwd">MS_tge_flwd</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#inv_thdp">inv_thdp</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;buffered&nbsp;alloc&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#tsostep_buffered_alloc_in_fl">tsostep_buffered_alloc_in_fl</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#ThreadPool.cs_inv">ThreadPool.cs_inv</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#ThreadPool.fid_belongsto">ThreadPool.fid_belongsto</a></span> <span class="kwd">in</span> <span class="id">H</span>; [|<span class="tactic">simpl</span>; <span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H</span> <span class="id">Hmatch</span>. <span class="tactic">clear</span>. <span class="tactic">simpl</span>; <span class="tactic">intros</span> <span class="id">H</span> <span class="id">Hmatch</span> (<span class="id">tail</span> &amp; <span class="id">Hbuffer</span> &amp; <span class="id">Hbufalloc</span>) <span class="id">t0</span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">buf</span>'. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t0</span> <span class="id">t</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id"><a href="Coqlib.html#in_app">in_app</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#buffered_alloc_local">buffered_alloc_local</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">fn</span> <span class="id">H</span>]. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hbufalloc</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">n</span> <span class="id">H0</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">fn</span>, <span class="id">n</span>. <span class="tactic">subst</span> <span class="id">flid</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#FLists.get_tfl">FLists.get_tfl</a></span>. <span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOCompInvs.html#match_fls_eq">match_fls_eq</a></span> <span class="kwd">in</span> *; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#buffered_alloc_local">buffered_alloc_local</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#tp_inv_src">tp_inv_src</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;fl_valid_eq&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exploit</span> (@<span class="id"><a href="GlobDefs.html#ThreadPool.fid_belongsto">ThreadPool.fid_belongsto</a></span> <span class="id">SGE</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#ThreadPool.cs_inv">ThreadPool.cs_inv</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#tp_inv_src">tp_inv_src</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span>. <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>. <span class="tactic">simpl</span>; <span class="id">left</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">fn</span> <span class="id">Hflid</span>]. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hflid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">fl_valid_eq_stable</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="ClientSim.html#Ic_unbuffer_safe">Ic_unbuffer_safe</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#mem_inv_client">mem_inv_client</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOCompInvs.html#match_fls_eq">match_fls_eq</a></span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#GlobEnv.wd_fl">GlobEnv.wd_fl</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#GE_wd">GE_wd</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#fl_valid_match">fl_valid_match</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hmatch</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#MS_src_tau_star_step_gmem_forward">MS_src_tau_star_step_gmem_forward</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#star_corestep_LocalAlloc">star_corestep_LocalAlloc</a></span> <span class="kwd">in</span> <span class="id">Hstar</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#star_corestep_LocalAlloc">star_corestep_LocalAlloc</a></span> <span class="kwd">in</span> <span class="id">Hatomstar</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">flid</span>. <span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOCompInvs.html#match_fls_eq">match_fls_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id"><a href="InteractionSemantics.html#LocalAlloc_trans">LocalAlloc_trans</a></span>. <span class="tactic">eapply</span> <span class="id">Hstar</span>. <span class="tactic">eapply</span> <span class="id">Hatomstar</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#GE_mod_sim_source_lang_wd">GE_mod_sim_source_lang_wd</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#GE_eq">GE_eq</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#GE_mod_sim_source_lang_wd">GE_mod_sim_source_lang_wd</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#GE_eq">GE_eq</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">flid</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#match_fls_eq">match_fls_eq</a></span> <span class="kwd">in</span> <span class="id">H_core_step</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span>. <span class="tactic">subst</span> <span class="id">flid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#match_fls_eq">match_fls_eq</a></span> <span class="kwd">in</span> <span class="id">Hvalideq</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;sep&nbsp;obj&nbsp;client&nbsp;block&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_source_tau_star_step_sep_obj_clt_preserved">MS_source_tau_star_step_sep_obj_clt_preserved</a></span> <span class="kwd">in</span> <span class="id">Htaustar</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;obj_fp&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;sc&nbsp;abort&nbsp;in&nbsp;atom&nbsp;block&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="Footprint.html#FP.union">FP.union</a></span> <span class="id">sfp_star</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Footprint.html#FP.union">FP.union</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Footprint.html#FP.union">FP.union</a></span> <span class="id">sfp_star</span>' <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> {| <span class="id"><a href="GlobDefs.html#Build_ProgConfig">thread_pool</a></span> := <span class="id">tp</span>'''; <span class="id">cur_tid</span> := <span class="id">t</span>; <span class="id">gm</span> := <span class="id">sm_ext</span>; <span class="id">atom_bit</span> := <span class="id"><a href="GlobDefs.html#I">I</a></span> |}.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="ETrace.html#tau_star">tau_star</a></span> <span class="id"><a href="GlobSemantics.html#glob_step">glob_step</a></span> {| <span class="id"><a href="GlobDefs.html#Build_ProgConfig">thread_pool</a></span> := <span class="id">thread_pool</span>; <span class="id">cur_tid</span> := <span class="id">t</span>; <span class="id">gm</span> := <span class="id">gm</span>; <span class="id">atom_bit</span> := <span class="id"><a href="GlobDefs.html#O">O</a></span> |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Footprint.html#FP.union">FP.union</a></span> <span class="id">sfp_star</span> (<span class="id"><a href="Footprint.html#FP.union">FP.union</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> (<span class="id"><a href="Footprint.html#FP.union">FP.union</a></span> <span class="id">sfp_star</span>' <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{| <span class="id"><a href="GlobDefs.html#Build_ProgConfig">thread_pool</a></span> := <span class="id">tp</span>'''; <span class="id">cur_tid</span> := <span class="id">t</span>; <span class="id">gm</span> := <span class="id">sm_ext</span>; <span class="id">atom_bit</span> := <span class="id"><a href="GlobDefs.html#I">I</a></span> |}) <span class="kwd">as</span> <span class="id">Htaustar</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="ETrace.html#tau_star_star">tau_star_star</a></span>. <span class="tactic">exact</span> <span class="id">Hglobstar</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="ETrace.html#tau_star_cons">tau_star_cons</a></span>. <span class="tactic">exact</span> <span class="id">Hglobent</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="ETrace.html#tau_star_star">tau_star_star</a></span>. <span class="tactic">exact</span> <span class="id">Hglobatomstar</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="ETrace.html#tau_star_0">tau_star_0</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="SCSemLemmas.html#taustar_etrace_star">taustar_etrace_star</a></span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">ls</span> <span class="id">Htaustar</span>'].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#source_safe">source_safe</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;thread&nbsp;not&nbsp;halted&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">revert</span> <span class="id">Htp</span>''' <span class="id">Htp</span>''. <span class="tactic">clear</span>. <span class="tactic">intros</span>. <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Htp</span>'''. <span class="id">inv</span> <span class="id">H0</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="id">GDefLemmas.solv_thread</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> (? &amp; ? &amp; ? &amp; ?); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Htp</span>''. <span class="id">inv</span> <span class="id">H</span>. <span class="id">GDefLemmas.solv_thread</span>. <span class="tactic">congruence</span>. }<br/>
&nbsp;abort&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">Habort</span> <span class="kwd">as</span> (<span class="id">Habort</span> &amp; <span class="id">Hnatext</span> &amp; <span class="id">Hnaftext</span> &amp; <span class="id">Hnhalt</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Habort</span> <span class="id">Hnatext</span> <span class="id">Hnaftext</span> <span class="id">Hnhalt</span> <span class="id">Htp</span>''' <span class="id">Htp</span>''. <span class="tactic">clear</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htp</span>''' <span class="kwd">as</span> [<span class="id">Htp</span>''' | (?&amp;?&amp;?&amp;?)]; <span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span>; <span class="id">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">GDefLemmas.solv_thread</span>. <span class="tactic">eapply</span> <span class="id">Habort</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">GDefLemmas.solv_thread</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">GDefLemmas.solv_thread</span>. <span class="tactic">eapply</span> <span class="id">Habort</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">GDefLemmas.solv_thread</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;tm_alloc_not_fl&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span>. <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">intro</span> <span class="id">Hcsinv</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#tp_inv_src">tp_inv_src</a></span> <span class="kwd">in</span> <span class="id">Hcsinv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> (@<span class="id"><a href="GlobDefs.html#ThreadPool.cs_inv">ThreadPool.cs_inv</a></span> <span class="id">SGE</span>). <span class="tactic">eauto</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">C</span>. <span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#ThreadPool.fid_belongsto">ThreadPool.fid_belongsto</a></span> <span class="kwd">in</span> <span class="id">C</span>; [|<span class="tactic">simpl</span>; <span class="id">left</span>; <span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">C</span> <span class="kwd">as</span> [<span class="id">fn</span> <span class="id">C</span>]. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">C</span>. <span class="tactic">subst</span> <span class="id">flid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#match_fls_eq">match_fls_eq</a></span>; [|<span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_tm_alloc_not_fl">MS_tm_alloc_not_fl</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>. <span class="tactic">eauto</span>. }<br/>
&nbsp;rel_tm_gm_vb&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">exists</span> <span class="id">fn</span>, <span class="id"><a href="GlobDefs.html#FLists.get_tfid">FLists.get_tfid</a></span> (<span class="id"><a href="GlobDefs.html#GlobEnv.freelists">GlobEnv.freelists</a></span> <span class="id">SGE</span>) <span class="id">t</span> <span class="id"><a href="TSOCompInvs.html#fn">fn</a></span> = <span class="id">flid</span>) <span class="kwd">as</span> [<span class="id">fn</span> <span class="id">Hflid</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#tp_inv_src">tp_inv_src</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> (@<span class="id"><a href="GlobDefs.html#ThreadPool.cs_inv">ThreadPool.cs_inv</a></span> <span class="id">SGE</span>). <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">intro</span> <span class="id">A</span>. <span class="id">exploit</span> (@<span class="id"><a href="GlobDefs.html#ThreadPool.fid_belongsto">ThreadPool.fid_belongsto</a></span> <span class="id">SGE</span>). <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="id">left</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> 1. <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#fl_valid_match">fl_valid_match</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hmatch</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="RGRels.html#rel_tm_gm_vb">rel_tm_gm_vb</a></span>. <span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOCompInvs.html#fl_valid_eq">fl_valid_eq</a></span>, <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hmatch</span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="tactic">destruct</span> <span class="id">H3</span>; <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#FLists.get_tfl">FLists.get_tfl</a></span>. <span class="tactic">rewrite</span> &lt;-<span class="id">Hflseq</span>. <span class="tactic">rewrite</span> <span class="id">Hflid</span>. <span class="tactic">rewrite</span> <span class="id">Hflseq</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;call&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">spc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#tid_eq">tid_eq</a></span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">intro</span>; <span class="tactic">subst</span> <span class="id">cur_tid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#atom_bit_0">atom_bit_0</a></span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">intro</span>; <span class="tactic">subst</span> <span class="id">atom_bit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">Htsim</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#thread_simulation">thread_simulation</a></span> <span class="kwd">in</span> <span class="id">Htsim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1:=<span class="id">t</span>) <span class="kwd">in</span> <span class="id">Htsim</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">Htsim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Htsim</span>. <span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;client&nbsp;call&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradict</span> <span class="id">HO</span>. <span class="id">inv</span> <span class="id">H0</span>. <span class="id">inv</span> <span class="id">H4</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;object&nbsp;call&nbsp;-&nbsp;impossible&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H4</span>. <span class="tactic">eapply</span> <span class="id"><a href="ObjectSim.html#match_no_extcall">ObjectSim.match_no_extcall</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br/>
&nbsp;return&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">spc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#tid_eq">tid_eq</a></span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">intro</span>; <span class="tactic">subst</span> <span class="id">cur_tid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#atom_bit_0">atom_bit_0</a></span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">intro</span>; <span class="tactic">subst</span> <span class="id">atom_bit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">Htsim</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#thread_simulation">thread_simulation</a></span> <span class="kwd">in</span> <span class="id">Htsim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1:=<span class="id">t</span>) <span class="kwd">in</span> <span class="id">Htsim</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">Htsim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Htsim</span>. <span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;client&nbsp;return&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">contradict</span> <span class="id">HO</span>. <span class="id">inv</span> <span class="id">H0</span>. <span class="id">inv</span> <span class="id">H4</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;object&nbsp;return&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;callee&nbsp;return&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H4</span>. <span class="id">inv</span> <span class="id">H5</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="ObjectSim.html#match_halt">ObjectSim.match_halt</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">Hhalt</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <br/>
&nbsp;caller&nbsp;after&nbsp;external&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H6</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="ClientSim.html#match_after_external">ClientSim.match_after_external</a></span>. <span class="tactic">exact</span> <span class="id">H3</span>. <span class="tactic">exact</span> <span class="id">H4</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">sc0</span>' &amp; <span class="id">Haftext</span> &amp; <span class="id">Hcmatch_caller</span>'). <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H0</span> <span class="id">H1</span>.<br/>
&nbsp;cosntruct&nbsp;glob&nbsp;step&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#helper2">helper2</a></span>. <span class="tactic">do</span> 2 <span class="id">eexists</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="ETrace.html#tau_star_cons">tau_star_cons</a></span>;[|<span class="tactic">eapply</span> <span class="id"><a href="ETrace.html#tau_star_0">tau_star_0</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="GlobSemantics.html#Return">Return</a></span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_top">ThreadPool.get_top</a></span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.pop">ThreadPool.pop</a></span>, <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> &lt;- <span class="id">H</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_top">ThreadPool.get_top</a></span>, <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_top">ThreadPool.get_top</a></span>, <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="id">econstructor</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hglobtaustep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;match&nbsp;after&nbsp;tau&nbsp;step&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>; <span class="tactic">try</span> (<span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">eauto</span>; <span class="tactic">fail</span>).<br/>
&nbsp;safe&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">ls</span> <span class="id">fp</span> <span class="id">s</span>' <span class="id">Hstar</span>'. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="SCSemLemmas.html#taustar_etrace_star">taustar_etrace_star</a></span>. <span class="tactic">exact</span> <span class="id">Hglobtaustep</span>. <span class="tactic">intros</span> [<span class="id">ls</span>' <span class="id">Hstar</span>'0].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#source_safe">source_safe</a></span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="SCSemLemmas.html#etrace_star_star">etrace_star_star</a></span>; <span class="tactic">eauto</span>. <br/>
&nbsp;drf&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="SCSemLemmas.html#taustar_etrace_star">taustar_etrace_star</a></span>. <span class="tactic">exact</span> <span class="id">Hglobtaustep</span>. <span class="tactic">intros</span> [<span class="id">ls</span>' <span class="id">Hstar</span>'0].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#source_drf">source_drf</a></span>; <span class="tactic">eauto</span>. <span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> (<span class="id">ls</span> &amp; <span class="id">fp</span> &amp; <span class="id">s</span>' &amp; <span class="id">Hstar</span>' &amp; <span class="id">RACE</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="id">eexists</span> <span class="id">_</span>, <span class="id">s</span>'. <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">eapply</span> <span class="id"><a href="SCSemLemmas.html#etrace_star_star">etrace_star_star</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;thread&nbsp;sims...&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intro</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">H_tp_pop</span>. <span class="id">inv</span> <span class="id">H_tp_pop</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_upd</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t0</span>).<br/>
&nbsp;case:&nbsp;t&nbsp;=&nbsp;t0&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">subst</span> <span class="id">t0</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#ThreadSimClient">ThreadSimClient</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>. <span class="id">inv</span> <span class="id">H_core_upd</span>. <span class="tactic">simpl</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;case:&nbsp;t&nbsp;&lt;&gt;&nbsp;t0&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">do</span> 4 (<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">Htpsim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thread_simulation">thread_simulation</a></span>; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;tp&nbsp;inv&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> (@<span class="id"><a href="GlobDefs.html#ThreadPool.pop_inv">ThreadPool.pop_inv</a></span> <span class="id">SGE</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#tp_inv_src">tp_inv_src</a></span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.pop">ThreadPool.pop</a></span>, <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> &lt;- <span class="id">H</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">intro</span>. <span class="tactic">eapply</span> <span class="id"><a href="SCSemLemmas.html#thdp_inv_upd">thdp_inv_upd</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span>; <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="id">econstructor</span>. <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;tp&nbsp;next&nbsp;tid&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">inv</span> <span class="id">H_tp_upd</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">H_tp_pop</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_pop</span>. <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>; <span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">auto</span>.<br/>
&nbsp;next&nbsp;fmap&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_upd</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">H_tp_pop</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_pop</span>. <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>; <span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;inv&nbsp;thdp&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#glob_step_inv_preserve">glob_step_inv_preserve</a></span> <span class="kwd">in</span> <span class="id">Htsostep</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_tge_flwd">MS_tge_flwd</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#inv_thdp">inv_thdp</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;obj_fp&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;thread&nbsp;halt&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">spc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#tid_eq">tid_eq</a></span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">intro</span>; <span class="tactic">subst</span> <span class="id">cur_tid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#atom_bit_0">atom_bit_0</a></span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">intro</span>; <span class="tactic">subst</span> <span class="id">atom_bit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">Htsim</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#thread_simulation">thread_simulation</a></span> <span class="kwd">in</span> <span class="id">Htsim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1:=<span class="id">t</span>) <span class="kwd">in</span> <span class="id">Htsim</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">Htsim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Htsim</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#helper2">helper2</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;client&nbsp;halt&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">contradict</span> <span class="id">HO</span>. <span class="id">inv</span> <span class="id">H0</span>. <span class="id">inv</span> <span class="id">H4</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;object&nbsp;halt&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">H4</span>. <span class="id">inv</span> <span class="id">H5</span>. <span class="tactic">do</span> 2 <span class="id">eexists</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="ETrace.html#tau_star_cons">tau_star_cons</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="GlobSemantics.html#Halt">Halt</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_top">ThreadPool.get_top</a></span>, <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> &lt;- <span class="id">H</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id"><a href="ObjectSim.html#match_halt">ObjectSim.match_halt</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.pop">ThreadPool.pop</a></span>, <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> &lt;- <span class="id">H</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>. <span class="tactic">eauto</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="ETrace.html#tau_star_0">tau_star_0</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Hglobtaustep</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>; <span class="tactic">try</span> (<span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">eauto</span>; <span class="tactic">fail</span>).<br/>
&nbsp;safe&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">ls</span> <span class="id">fp</span> <span class="id">s</span>' <span class="id">Hstar</span>'. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="SCSemLemmas.html#taustar_etrace_star">taustar_etrace_star</a></span>. <span class="tactic">exact</span> <span class="id">Hglobtaustep</span>. <span class="tactic">intros</span> [<span class="id">ls</span>' <span class="id">Hstar</span>'0].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#source_safe">source_safe</a></span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="SCSemLemmas.html#etrace_star_star">etrace_star_star</a></span>; <span class="tactic">eauto</span>. <br/>
&nbsp;drf&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="SCSemLemmas.html#taustar_etrace_star">taustar_etrace_star</a></span>. <span class="tactic">exact</span> <span class="id">Hglobtaustep</span>. <span class="tactic">intros</span> [<span class="id">ls</span>' <span class="id">Hstar</span>'0].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#source_drf">source_drf</a></span>; <span class="tactic">eauto</span>. <span class="tactic">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> (<span class="id">ls</span> &amp; <span class="id">fp</span> &amp; <span class="id">s</span>' &amp; <span class="id">Hstar</span>' &amp; <span class="id">RACE</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="id">eexists</span> <span class="id">_</span>, <span class="id">s</span>'. <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">eapply</span> <span class="id"><a href="SCSemLemmas.html#etrace_star_star">etrace_star_star</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;thread&nbsp;sims...&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intro</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">H_tp_pop</span>. <span class="id">inv</span> <span class="id">H_tp_pop</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t0</span>).<br/>
&nbsp;case:&nbsp;t&nbsp;=&nbsp;t0&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">subst</span> <span class="id">t0</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>. <span class="id">constructor</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;case:&nbsp;t&nbsp;&lt;&gt;&nbsp;t0&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">do</span> 2 (<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">Htpsim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thread_simulation">thread_simulation</a></span>; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;tp&nbsp;inv&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> (@<span class="id"><a href="GlobDefs.html#ThreadPool.pop_inv">ThreadPool.pop_inv</a></span> <span class="id">SGE</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#tp_inv_src">tp_inv_src</a></span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.pop">ThreadPool.pop</a></span>, <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> &lt;- <span class="id">H</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">auto</span>.<br/>
&nbsp;tp&nbsp;next&nbsp;tid&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">H_tp_pop</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_pop</span>. <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>; <span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">auto</span>.<br/>
&nbsp;next&nbsp;fmap&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">H_tp_pop</span>. <span class="id">inv</span> <span class="id">H_tp_pop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>; <span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;inv&nbsp;thdp&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#glob_step_inv_preserve">glob_step_inv_preserve</a></span> <span class="kwd">in</span> <span class="id">Htsostep</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_tge_flwd">MS_tge_flwd</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#inv_thdp">inv_thdp</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="MS_preserved_after_tau_step_if_not_conflicting_client_fp">MS_preserved_after_tau_step_if_not_conflicting_client_fp</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">spc</span> <span class="id">tpc</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#MS">MS</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tpc</span>' <span class="id">fpT</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOGlobSem.html#tau">tau</a></span> <span class="id">fpT</span>' <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOCompInvs.html#client_core">client_core</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="ClientSim.html#conflictc">conflictc</a></span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) <span class="id">fpT</span>' (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>))) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">spc</span>' <span class="id">fpS</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ETrace.html#tau_star">tau_star</a></span> <span class="id"><a href="GlobSemantics.html#glob_step">glob_step</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id">fpS</span>' <span class="id">spc</span>' /\ <span class="id"><a href="TSOCompInvs.html#MS">MS</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id">spc</span>' <span class="id">tpc</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10231')">Proof.</div>
<div class="proofscript" id="proof10231">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#MS_tau_step_fp_cases">MS_tau_step_fp_cases</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [ (<span class="id">_</span> &amp; <span class="id">fpS</span> &amp; <span class="id">spc</span>' &amp; <span class="id">Hsstep</span> &amp; <span class="id">Hfp</span> &amp; <span class="id">MATCH</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id">_</span> &amp; <span class="id">fpS</span> &amp; <span class="id">spc</span>' &amp; <span class="id">Hsstep</span> &amp; <span class="id">MATCH</span>' &amp; <span class="id">Hfp</span>) ]; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">spc</span>', <span class="id">fpS</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id"><a href="Footprint.html#FP.fp_union_emp">FP.fp_union_emp</a></span> <span class="id">fpS</span>). <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="fpmatchc_refl">fpmatchc_refl</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fp</span>, <span class="id"><a href="ClientSim.html#fpmatchc">fpmatchc</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10232')">Proof.</div>
<div class="proofscript" id="proof10232">
 <span class="tactic">clear</span>. <span class="tactic">apply</span> <span class="id"><a href="Footprint.html#FP.subset_refl">FP.subset_refl</a></span>. Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="MS_preserved_after_evt_step">MS_preserved_after_evt_step</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">spc</span> <span class="id">tpc</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#MS">MS</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tpc</span>' <span class="id">v</span> <span class="id">fp</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> (<span class="id"><a href="TSOGlobSem.html#evt">evt</a></span> <span class="id"><a href="TSOCompInvs.html#v">v</a></span>) <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">spc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobSemantics.html#glob_step">glob_step</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> (<span class="id"><a href="ETrace.html#evt">ETrace.evt</a></span> <span class="id"><a href="TSOCompInvs.html#v">v</a></span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">spc</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#MS">MS</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id">spc</span>' <span class="id">tpc</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10233')">Proof.</div>
<div class="proofscript" id="proof10233">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">spc</span> <span class="id">tpc</span> <span class="id">Hmatch</span> <span class="id">tpc</span>' <span class="id">v</span> <span class="id">fp</span> <span class="id">Hevtstep</span>. <span class="id">pose</span> <span class="id">proof</span> <span class="id">Hevtstep</span> <span class="kwd">as</span> <span class="id">Hevtstep</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hevtstep</span>. <span class="tactic">destruct</span> <span class="id">spc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#tid_eq">tid_eq</a></span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">intro</span>; <span class="tactic">subst</span> <span class="id">cur_tid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#atom_bit_0">atom_bit_0</a></span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">intro</span>; <span class="tactic">subst</span> <span class="id">atom_bit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">Htsim</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#thread_simulation">thread_simulation</a></span> <span class="kwd">in</span> <span class="id">Htsim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1:=<span class="id">t</span>) <span class="kwd">in</span> <span class="id">Htsim</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">Htsim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Htsim</span>. <span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;client&nbsp;print&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>. <span class="id">inv</span> <span class="id">H4</span>. <span class="id">pose</span> <span class="id">proof</span> <span class="id">H2</span> <span class="kwd">as</span> <span class="id">Hcmatch</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="ClientSim.html#match_at_external">ClientSim.match_at_external</a></span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id">Hcmatch</span> <span class="kwd">as</span> <span class="id">Hcmatch</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="ClientSim.html#match_after_external">ClientSim.match_after_external</a></span> <span class="kwd">in</span> <span class="id">Hcmatch</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hcmatch</span>' <span class="kwd">as</span> (<span class="id">sc</span>' &amp; <span class="id">Haftext</span> &amp; <span class="id">Hcmatch</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#helper1">helper1</a></span>. <span class="id">eexists</span> <span class="id">_</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="GlobSemantics.html#EF_Print">EF_Print</a></span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_top">ThreadPool.get_top</a></span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H2</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">eauto</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hglobstep</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.push">ThreadPool.push</a></span>, <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;match&nbsp;after&nbsp;call&nbsp;step&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> (<span class="id">inv</span> <span class="id">Hmatch</span>; <span class="tactic">auto</span>; <span class="tactic">fail</span>).<br/>
&nbsp;safe&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">ls</span> <span class="id">fp</span> <span class="id">s</span>' <span class="id">Hstar</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#source_safe">source_safe</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="SCSemLemmas.html#etrace_star_star">etrace_star_star</a></span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="ETrace.html#star_step">ETrace.star_step</a></span>. <span class="tactic">eauto</span>. <span class="id">econstructor</span>.<br/>
&nbsp;drf&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#source_drf">source_drf</a></span>; <span class="tactic">eauto</span>. <span class="tactic">destruct</span> <span class="id">H3</span> <span class="kwd">as</span> (<span class="id">ls</span> &amp; <span class="id">fp</span> &amp; <span class="id">s</span>' &amp; <span class="id">Hstar</span>' &amp; <span class="id">RACE</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="id">eexists</span> <span class="id">_</span>, <span class="id">s</span>'. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="SCSemLemmas.html#etrace_star_star">etrace_star_star</a></span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="ETrace.html#star_step">ETrace.star_step</a></span>. <span class="tactic">eauto</span>. <span class="id">econstructor</span>.<br/>
&nbsp;thread&nbsp;sims...&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intro</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_upd</span>. <span class="id">inv</span> <span class="id">H_core_update</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t0</span>).<br/>
&nbsp;case:&nbsp;t&nbsp;=&nbsp;t0&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">subst</span> <span class="id">t0</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#ThreadSimClient">ThreadSimClient</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="id">inv</span> <span class="id">H3</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;case:&nbsp;t&nbsp;&lt;&gt;&nbsp;t0&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">do</span> 2 (<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">Htpsim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thread_simulation">thread_simulation</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="SCSemLemmas.html#thdp_inv_upd">thdp_inv_upd</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#tp_inv_src">tp_inv_src</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">H_tp_upd</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#valid_tid_eq">valid_tid_eq</a></span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span> <span class="kwd">in</span> <span class="id">Hmatch</span>. <span class="id">inv</span> <span class="id">H_tp_upd</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#next_fmap_eq">next_fmap_eq</a></span>; <span class="tactic">eauto</span>). <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;inv&nbsp;thdp&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#glob_step_inv_preserve">glob_step_inv_preserve</a></span> <span class="kwd">in</span> <span class="id">Hevtstep</span>' ;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_tge_flwd">MS_tge_flwd</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#inv_thdp">inv_thdp</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;object&nbsp;print,&nbsp;impossible&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H4</span>. <span class="tactic">eapply</span> <span class="id"><a href="ObjectSim.html#match_no_extcall">match_no_extcall</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="MS_tso_client_step_fp_match">MS_tso_client_step_fp_match</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">spc</span> <span class="id">tpc</span> <span class="id">fp</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#MS">MS</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#tso_client_step_fp">tso_client_step_fp</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">spc</span>' <span class="id">fpS</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobSemantics.html#glob_step">glob_step</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id"><a href="ETrace.html#tau">ETrace.tau</a></span> <span class="id"><a href="TSOCompInvs.html#fpS">fpS</a></span> <span class="id">spc</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#fpmatchc">fpmatchc</a></span> <span class="id"><a href="TSOCompInvs.html#fpS">fpS</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10234')">Proof.</div>
<div class="proofscript" id="proof10234">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">spc</span> <span class="id">tpc</span> <span class="id">fp</span> <span class="id">MATCH</span> <span class="id">Hstep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span>. <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thread_simulation">thread_simulation</a></span>. <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">Hsim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hstep</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">Hsim</span>. <span class="id">inv</span> <span class="id">Hsim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">H4</span>. <span class="id">inv</span> <span class="id">H8</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">pose</span> <span class="id">proof</span> <span class="id">H2</span> <span class="kwd">as</span> <span class="id">Hstep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="ClientSim.html#match_tau">ClientSim.match_tau</a></span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> (<span class="id">fpS</span> &amp; <span class="id">sc</span>' &amp; <span class="id">sm</span>' &amp; <span class="id">Hsstep</span> &amp; [(<span class="id">_</span> &amp; <span class="id">Hfp</span> &amp; <span class="id">_</span> &amp; <span class="id">_</span> ) | (<span class="id">_</span> &amp; <span class="id">Hmatch</span>)]).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">spc</span>. <span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOCompInvs.html#tid_eq">tid_eq</a></span> <span class="kwd">in</span> <span class="id">H3</span>; [|<span class="tactic">eauto</span>]. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="id">eexists</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="GlobSemantics.html#Corestep">GlobSemantics.Corestep</a></span>; <span class="tactic">eauto</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_top">ThreadPool.get_top</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H3</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#match_fls_eq">match_fls_eq</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="id">econstructor</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="id">econstructor</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">spc</span>. <span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOCompInvs.html#tid_eq">tid_eq</a></span> <span class="kwd">in</span> <span class="id">H3</span>; [|<span class="tactic">eauto</span>]. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="id">eexists</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="GlobSemantics.html#Corestep">GlobSemantics.Corestep</a></span>; <span class="tactic">eauto</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_top">ThreadPool.get_top</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H3</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#match_fls_eq">match_fls_eq</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="id">econstructor</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="id">econstructor</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exfalso</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#source_safe">source_safe</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="ETrace.html#star_refl">ETrace.star_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <br/>
&nbsp;thread&nbsp;not&nbsp;halted&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOCompInvs.html#tid_eq">tid_eq</a></span> <span class="kwd">in</span> <span class="id">H3</span>; [|<span class="tactic">eauto</span>]. <span class="id">revert</span> <span class="id">H3</span>; <span class="tactic">clear</span>. <span class="tactic">intros</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">intro</span>. <span class="id">inv</span> <span class="id">H0</span>. <span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">H2</span>.<br/>
&nbsp;no&nbsp;glob&nbsp;step&nbsp;except&nbsp;for&nbsp;sw&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOCompInvs.html#match_fls_eq">match_fls_eq</a></span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hnatext</span>: <span class="id"><a href="InteractionSemantics.html#at_external">at_external</a></span> (<span class="id"><a href="InteractionSemantics.html#ModSem.lang">ModSem.lang</a></span> (<span class="id"><a href="GlobDefs.html#GlobEnv.modules">GlobEnv.modules</a></span> <span class="id">SGE</span> <span class="id">ix</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="InteractionSemantics.html#ModSem.Ge">ModSem.Ge</a></span> (<span class="id"><a href="GlobDefs.html#GlobEnv.modules">GlobEnv.modules</a></span> <span class="id">SGE</span> <span class="id">ix</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sc</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span> <span class="kwd">in</span> <span class="id">MATCH</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#thread_simulation">thread_simulation</a></span> <span class="kwd">with</span> (<span class="id">t0</span> := <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc</span>) <span class="kwd">in</span> <span class="id">MATCH</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">MATCH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H3</span>, <span class="id">H0</span> <span class="kwd">in</span> <span class="id">MATCH</span>. <span class="id">inv</span> <span class="id">MATCH</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id"><a href="ClientSim.html#match_at_external">ClientSim.match_at_external</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="AsmTSO.html#tsostep_not_atext">tsostep_not_atext</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hnhalt</span>: <span class="id"><a href="InteractionSemantics.html#halt">halt</a></span> (<span class="id"><a href="InteractionSemantics.html#ModSem.lang">ModSem.lang</a></span> (<span class="id"><a href="GlobDefs.html#GlobEnv.modules">GlobEnv.modules</a></span> <span class="id">SGE</span> <span class="id">ix</span>)) <span class="id">sc</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span> <span class="kwd">in</span> <span class="id">MATCH</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#thread_simulation">thread_simulation</a></span> <span class="kwd">with</span> (<span class="id">t0</span> := <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc</span>) <span class="kwd">in</span> <span class="id">MATCH</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">MATCH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H3</span>, <span class="id">H0</span> <span class="kwd">in</span> <span class="id">MATCH</span>. <span class="id">inv</span> <span class="id">MATCH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id"><a href="ClientSim.html#match_halted">ClientSim.match_halted</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="AsmTSO.html#tsostep_not_halted">tsostep_not_halted</a></span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOCompInvs.html#tid_eq">tid_eq</a></span> <span class="kwd">in</span> <span class="id">H3</span>; <span class="tactic">eauto</span>. <span class="id">inv</span> <span class="id">H7</span>; <span class="tactic">auto</span>; <span class="id">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;tau&nbsp;step&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">GDefLemmas.solv_thread</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">eapply</span> <span class="id">H2</span>. <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="id">GDefLemmas.solv_thread</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H3</span> <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">GDefLemmas.solv_thread</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;tm_alloc_not_fl&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> (@<span class="id"><a href="GlobDefs.html#ThreadPool.fid_belongsto">ThreadPool.fid_belongsto</a></span> <span class="id">SGE</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#ThreadPool.cs_inv">ThreadPool.cs_inv</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#tp_inv_src">tp_inv_src</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="id">left</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#match_fls_eq">match_fls_eq</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">fn</span> <span class="id">Hflid</span>]. <span class="tactic">subst</span> <span class="id">flid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_tm_alloc_not_fl">MS_tm_alloc_not_fl</a></span> <span class="kwd">in</span> <span class="id">MATCH</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;rel_tm_gm_vb&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#fl_valid_eq_rel_tm_gm_vb">fl_valid_eq_rel_tm_gm_vb</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> (@<span class="id"><a href="GlobDefs.html#ThreadPool.fid_belongsto">ThreadPool.fid_belongsto</a></span> <span class="id">SGE</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#ThreadPool.cs_inv">ThreadPool.cs_inv</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#tp_inv_src">tp_inv_src</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="id">left</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#match_fls_eq">match_fls_eq</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">fn</span> <span class="id">Hflid</span>]. <span class="tactic">subst</span> <span class="id">flid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#fl_valid_match">fl_valid_match</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>. <span class="id">inv</span> <span class="id">H8</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
<h3> </h3>
<div class="doc">Additional invariants for proving no conflicting client footprint     </div>
<h3> </h3>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="buffer_forward">buffer_forward</a></span> (<span class="id">bi</span>: <span class="id"><a href="TSOMem.html#buffer_item">buffer_item</a></span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#buffer">buffer</a></span> -&gt; <span class="id"><a href="TSOMem.html#buffer">buffer</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#buffer">buffer</a></span> -&gt; <span class="id"><a href="TSOMem.html#buffer">buffer</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="buf_forward_refl">buf_forward_refl</a></span>: <span class="kwd">forall</span> <span class="id">head</span> <span class="id">tail</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#buffer_forward">buffer_forward</a></span> <span class="id">bi</span> <span class="id"><a href="TSOCompInvs.html#head">head</a></span> <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> <span class="id"><a href="TSOCompInvs.html#head">head</a></span> <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a name="buf_forward_enq">buf_forward_enq</a></span>: <span class="kwd">forall</span> <span class="id">head</span> <span class="id">tail</span> <span class="id">new_bis</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#buffer_forward">buffer_forward</a></span> <span class="id">bi</span> <span class="id"><a href="TSOCompInvs.html#head">head</a></span> <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> <span class="id"><a href="TSOCompInvs.html#head">head</a></span> (<span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> ++ <span class="id"><a href="TSOCompInvs.html#new_bis">new_bis</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="buf_forward_deq">buf_forward_deq</a></span>: <span class="kwd">forall</span> <span class="id">bi_head</span> <span class="id">head</span> <span class="id">tail</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#buffer_forward">buffer_forward</a></span> <span class="id">bi</span> (<span class="id"><a href="TSOCompInvs.html#bi_head">bi_head</a></span> :: <span class="id"><a href="TSOCompInvs.html#head">head</a></span>) <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> <span class="id"><a href="TSOCompInvs.html#head">head</a></span> <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span>.<br/>
<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="PrevInsertedInv">PrevInsertedInv</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SGE</span>: <span class="id"><a href="GlobDefs.html#GlobEnv.t">GlobEnv.t</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">TGE</span>: <span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.t">TSOGlobEnv.t</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i_obj</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">spc</span>: <span class="id"><a href="GlobDefs.html#ProgConfig">ProgConfig</a></span>) (<span class="id">tpc</span>: <span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span>): <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#MS">MS</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="TSOCompInvs.html#no_conflicting_client_fp">no_conflicting_client_fp</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="bi_not_unbuffered">bi_not_unbuffered</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">TGE</span>: <span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.t">TSOGlobEnv.t</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i_obj</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">t</span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">bi</span>: <span class="id"><a href="TSOMem.html#buffer_item">buffer_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="TSOMem.html#buffer">buffer</a></span> -&gt; <span class="id"><a href="TSOMem.html#buffer">buffer</a></span> -&gt; <span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#buffer">buffer</a></span> -&gt; <span class="id"><a href="TSOMem.html#buffer">buffer</a></span> -&gt; <span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id"><a name="bi_nub_refl">bi_nub_refl</a></span>: <span class="kwd">forall</span> <span class="id">thdp</span> <span class="id">cid</span> <span class="id">tm</span> <span class="id">head</span> <span class="id">tail</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">tpc</span> := <span class="id"><a href="TSOGlobSem.html#Build_TSOProgConfig">Build_TSOProgConfig</a></span> <span class="id">TGE</span> <span class="id"><a href="TSOCompInvs.html#thdp">thdp</a></span> <span class="id"><a href="TSOCompInvs.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span> <span class="id">t</span> = <span class="id"><a href="TSOCompInvs.html#head">head</a></span> ++ <span class="id">bi</span> :: <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#bi_not_unbuffered">bi_not_unbuffered</a></span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">t</span> <span class="id">bi</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#head">head</a></span> <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#head">head</a></span> <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id"><a name="bi_nub_step">bi_nub_step</a></span>:  <span class="kwd">forall</span> <span class="id">tpc</span> <span class="id">head</span> <span class="id">tail</span> <span class="id">l</span> <span class="id">fp</span> <span class="id">tpc</span>' <span class="id">head</span>' <span class="id">tail</span>' <span class="id">tpc</span>'' <span class="id">head</span>'' <span class="id">tail</span>'',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOCompInvs.html#l">l</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) <span class="id">t</span> = <span class="id"><a href="TSOCompInvs.html#head">head</a></span> ++ <span class="id">bi</span> :: <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">tpc</span>') <span class="id">t</span> = <span class="id">head</span>' ++ <span class="id">bi</span> :: <span class="id">tail</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#buffer_forward">buffer_forward</a></span> <span class="id">bi</span> <span class="id"><a href="TSOCompInvs.html#head">head</a></span> <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> <span class="id">head</span>' <span class="id">tail</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOCompInvs.html#client_core">client_core</a></span> <span class="id">TGE</span> <span class="id">i_obj</span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="ClientSim.html#conflictc">conflictc</a></span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>))) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#bi_not_unbuffered">bi_not_unbuffered</a></span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">t</span> <span class="id">bi</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">head</span>' <span class="id">tail</span>' <span class="id">tpc</span>' <span class="id">head</span>'' <span class="id">tail</span>'' <span class="id">tpc</span>'' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#bi_not_unbuffered">bi_not_unbuffered</a></span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">t</span> <span class="id">bi</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#head">head</a></span> <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id">head</span>'' <span class="id">tail</span>'' <span class="id">tpc</span>''.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="PreviouslyInserted">PreviouslyInserted</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">TGE</span>: <span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.t">TSOGlobEnv.t</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">i_obj</span>: '<span class="id">I_</span>(<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.M">TSOGlobEnv.M</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">t</span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">bi</span>: <span class="id"><a href="TSOMem.html#buffer_item">buffer_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tpc0</span>: @<span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="TSOMem.html#buffer">buffer</a></span> -&gt; <span class="id"><a href="TSOMem.html#buffer">buffer</a></span> -&gt; @<span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> <span class="id">TGE</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="PrevInserted">PrevInserted</a></span>: <span class="kwd">forall</span> <span class="id">head</span> <span class="id">head</span>' <span class="id">tail</span>' <span class="id">tau</span> <span class="id">fp</span> <span class="id">tpc1</span> <span class="id">headn</span> <span class="id">tailn</span> <span class="id">tpcn</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">tpc0</span>) <span class="id">t</span> = <span class="id"><a href="TSOCompInvs.html#head">head</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id">tpc0</span> <span class="id"><a href="TSOCompInvs.html#tau">tau</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id"><a href="TSOCompInvs.html#tpc1">tpc1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOCompInvs.html#client_core">client_core</a></span> <span class="id">TGE</span> <span class="id">i_obj</span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc0</span>) <span class="id">tpc0</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="ClientSim.html#conflictc">conflictc</a></span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc0</span>) <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">tpc0</span>))) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc1">tpc1</a></span>) <span class="id">t</span> = <span class="id"><a href="TSOCompInvs.html#head">head</a></span> ++ <span class="id">head</span>' ++ <span class="id">bi</span> :: <span class="id">tail</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#bi_not_unbuffered">bi_not_unbuffered</a></span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">t</span> <span class="id">bi</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOCompInvs.html#head">head</a></span> ++ <span class="id">head</span>') <span class="id">tail</span>' <span class="id"><a href="TSOCompInvs.html#tpc1">tpc1</a></span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#headn">headn</a></span> <span class="id"><a href="TSOCompInvs.html#tailn">tailn</a></span> <span class="id"><a href="TSOCompInvs.html#tpcn">tpcn</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#PreviouslyInserted">PreviouslyInserted</a></span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">t</span> <span class="id">bi</span> <span class="id">tpc0</span> <span class="id"><a href="TSOCompInvs.html#headn">headn</a></span> <span class="id"><a href="TSOCompInvs.html#tailn">tailn</a></span> <span class="id"><a href="TSOCompInvs.html#tpcn">tpcn</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Record</span> <span class="id"><a name="BufWD">BufWD</a></span> (<span class="id">SGE</span>: <span class="id"><a href="GlobDefs.html#GlobEnv.t">GlobEnv.t</a></span>) (<span class="id">TGE</span>: <span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.t">TSOGlobEnv.t</a></span>) <span class="id">i_obj</span> (<span class="id">tpc</span>: <span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span>): <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="prev_inserted">prev_inserted</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">bi</span> <span class="id">head</span> <span class="id">tail</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) <span class="id"><a href="TSOCompInvs.html#t">t</a></span>) = <span class="id"><a href="TSOCompInvs.html#head">head</a></span> ++ <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span> :: <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">spc0</span> <span class="id">tpc0</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#MS">MS</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#spc0">spc0</a></span> <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#PreviouslyInserted">PreviouslyInserted</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span> <span class="id"><a href="TSOCompInvs.html#head">head</a></span> <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="buf_emp_BufWD">buf_emp_BufWD</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">tpc</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">t</span>, <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) <span class="id"><a href="TSOCompInvs.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#BufWD">BufWD</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10235')">Proof.</div>
<div class="proofscript" id="proof10235">
 <span class="tactic">clear</span> . <span class="tactic">intros</span>. <span class="id">constructor</span>. <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> <span class="id">head</span>; <span class="id">inv</span> <span class="id">H0</span>. Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id">bi_not_unbuffered</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">TGE</span>: <span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.t">TSOGlobEnv.t</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i_obj</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">t</span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">bi</span>: <span class="id"><a href="TSOMem.html#buffer_item">buffer_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="TSOMem.html#buffer">buffer</a></span> -&gt; <span class="id"><a href="TSOMem.html#buffer">buffer</a></span> -&gt; @<span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> <span class="id">TGE</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#buffer">buffer</a></span> -&gt; <span class="id"><a href="TSOMem.html#buffer">buffer</a></span> -&gt; @<span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> <span class="id">TGE</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id">bi_nub_refl</span>': <span class="kwd">forall</span> <span class="id">thdp</span> <span class="id">cid</span> <span class="id">tm</span> <span class="id">head</span> <span class="id">tail</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">tpc</span> := <span class="id"><a href="TSOGlobSem.html#Build_TSOProgConfig">Build_TSOProgConfig</a></span> <span class="id">TGE</span> <span class="id"><a href="TSOCompInvs.html#thdp">thdp</a></span> <span class="id"><a href="TSOCompInvs.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="TSOCompInvs.html#tm">tm</a></span> <span class="id">t</span> = <span class="id"><a href="TSOCompInvs.html#head">head</a></span> ++ <span class="id">bi</span> :: <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bi_not_unbuffered</span>' <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">t</span> <span class="id">bi</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#head">head</a></span> <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#head">head</a></span> <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id">bi_nub_step</span>':  <span class="kwd">forall</span> <span class="id">tpc</span> <span class="id">head</span> <span class="id">tail</span> <span class="id">l</span> <span class="id">fp</span> <span class="id">tpc</span>' <span class="id">head</span>' <span class="id">tail</span>' <span class="id">tpc</span>'' <span class="id">head</span>'' <span class="id">tail</span>'',<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> &lt;&gt; <span class="id">t</span> /\ (<span class="id"><a href="TSOCompInvs.html#l">l</a></span> = <span class="id"><a href="TSOGlobSem.html#tau">tau</a></span> \/ <span class="id">exists</span> <span class="id">v</span>, <span class="id"><a href="TSOCompInvs.html#l">l</a></span> = <span class="id"><a href="TSOGlobSem.html#evt">evt</a></span> <span class="id"><a href="TSOCompInvs.html#v">v</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\/ <span class="id"><a href="TSOCompInvs.html#l">l</a></span> = <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> \/ <span class="id">exists</span> <span class="id">t</span>', <span class="id"><a href="TSOCompInvs.html#l">l</a></span> = <span class="id"><a href="TSOGlobSem.html#ub">ub</a></span> <span class="id">t</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOCompInvs.html#l">l</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) <span class="id">t</span> = <span class="id"><a href="TSOCompInvs.html#head">head</a></span> ++ <span class="id">bi</span> :: <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">tpc</span>') <span class="id">t</span> = <span class="id">head</span>' ++ <span class="id">bi</span> :: <span class="id">tail</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#buffer_forward">buffer_forward</a></span> <span class="id">bi</span> <span class="id"><a href="TSOCompInvs.html#head">head</a></span> <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> <span class="id">head</span>' <span class="id">tail</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOCompInvs.html#client_core">client_core</a></span> <span class="id">TGE</span> <span class="id">i_obj</span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="ClientSim.html#conflictc">conflictc</a></span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>))) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bi_not_unbuffered</span>' <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">t</span> <span class="id">bi</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">head</span>' <span class="id">tail</span>' <span class="id">tpc</span>' <span class="id">head</span>'' <span class="id">tail</span>'' <span class="id">tpc</span>'' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bi_not_unbuffered</span>' <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">t</span> <span class="id">bi</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#head">head</a></span> <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id">head</span>'' <span class="id">tail</span>'' <span class="id">tpc</span>''.<br/>
<br/>
&nbsp;&nbsp;<br/>
<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="glob_step_valid">glob_step_valid</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc</span> <span class="id">l</span> <span class="id">fp</span> <span class="id">tpc</span>' <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOCompInvs.html#l">l</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#thrd_valid">thrd_valid</a></span> <span class="id">tpc</span>' <span class="id"><a href="TSOCompInvs.html#t">t</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#thrd_valid">thrd_valid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10236')">Proof.</div>
<div class="proofscript" id="proof10236">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#thrd_valid">thrd_valid</a></span>, <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.valid_tid">TSOThrdPool.valid_tid</a></span>. <span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_upd</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.push">TSOThrdPool.push</a></span> <span class="kwd">in</span> <span class="id">H_tp_push</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> ((<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>) !! <span class="id">t0</span>); <span class="id">inv</span> <span class="id">H_tp_push</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="kwd">in</span> <span class="id">H_tp_pop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> ((<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>) !! <span class="id">t0</span>); <span class="id">inv</span> <span class="id">H_tp_pop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>; <span class="id">inv</span> <span class="id">H1</span>. <span class="id">inv</span> <span class="id">H_tp_upd</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="kwd">in</span> <span class="id">H_tp_pop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> ((<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>) !! <span class="id">t0</span>); <span class="id">inv</span> <span class="id">H_tp_pop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>; <span class="id">inv</span> <span class="id">H1</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_upd</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="glob_step_halted">glob_step_halted</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc</span> <span class="id">l</span> <span class="id">fp</span> <span class="id">tpc</span>' <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOCompInvs.html#l">l</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#thrd_not_halted">thrd_not_halted</a></span> <span class="id">tpc</span>' <span class="id"><a href="TSOCompInvs.html#t">t</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#thrd_not_halted">thrd_not_halted</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10237')">Proof.</div>
<div class="proofscript" id="proof10237">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#thrd_not_halted">thrd_not_halted</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">TGE</span> <span class="id">tpc</span> <span class="id">l</span> <span class="id">fp</span> <span class="id">tpc</span>' <span class="id">t</span> <span class="id">Hstep</span> <span class="id">A</span> <span class="id">C</span>; <span class="tactic">apply</span> <span class="id">A</span>; <span class="tactic">clear</span> <span class="id">A</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">C</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hstep</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> (<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t0</span>); [<span class="tactic">subst</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">congruence</span>|<span class="tactic">simpl</span> <span class="kwd">in</span> *]);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> (<span class="id">constructor</span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_upd</span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.push">TSOThrdPool.push</a></span> <span class="kwd">in</span> <span class="id">H_tp_push</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> ((<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>) !! <span class="id">t0</span>); <span class="id">inv</span> <span class="id">H_tp_push</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="kwd">in</span> <span class="id">H_tp_pop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> ((<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>) !! <span class="id">t0</span>); <span class="id">inv</span> <span class="id">H_tp_pop</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>; <span class="id">inv</span> <span class="id">H1</span>. <span class="id">inv</span> <span class="id">H_tp_upd</span>; <span class="tactic">simpl</span>. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="kwd">in</span> <span class="id">H_tp_pop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> ((<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>) !! <span class="id">t0</span>); <span class="id">inv</span> <span class="id">H_tp_pop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>; <span class="id">inv</span> <span class="id">H1</span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_upd</span>; <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">glob_step_valid</span>':<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc</span> <span class="id">l</span> <span class="id">fp</span> <span class="id">tpc</span>' <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOCompInvs.html#l">l</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#thrd_valid">thrd_valid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#thrd_valid">thrd_valid</a></span> <span class="id">tpc</span>' <span class="id"><a href="TSOCompInvs.html#t">t</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10238')">Proof.</div>
<div class="proofscript" id="proof10238">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#thrd_valid">thrd_valid</a></span>, <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.valid_tid">TSOThrdPool.valid_tid</a></span>. <span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_upd</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.push">TSOThrdPool.push</a></span> <span class="kwd">in</span> <span class="id">H_tp_push</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> ((<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>) !! <span class="id">t0</span>); <span class="id">inv</span> <span class="id">H_tp_push</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="kwd">in</span> <span class="id">H_tp_pop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> ((<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>) !! <span class="id">t0</span>); <span class="id">inv</span> <span class="id">H_tp_pop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>; <span class="id">inv</span> <span class="id">H1</span>. <span class="id">inv</span> <span class="id">H_tp_upd</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="kwd">in</span> <span class="id">H_tp_pop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> ((<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>) !! <span class="id">t0</span>); <span class="id">inv</span> <span class="id">H_tp_pop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>; <span class="id">inv</span> <span class="id">H1</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_upd</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">glob_step_halted</span>':<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc</span> <span class="id">l</span> <span class="id">fp</span> <span class="id">tpc</span>' <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOCompInvs.html#l">l</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> &lt;&gt; <span class="id"><a href="TSOCompInvs.html#t">t</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#thrd_not_halted">thrd_not_halted</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#thrd_not_halted">thrd_not_halted</a></span> <span class="id">tpc</span>' <span class="id"><a href="TSOCompInvs.html#t">t</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10239')">Proof.</div>
<div class="proofscript" id="proof10239">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#thrd_not_halted">thrd_not_halted</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">TGE</span> <span class="id">tpc</span> <span class="id">l</span> <span class="id">fp</span> <span class="id">tpc</span>' <span class="id">t</span> <span class="id">Hstep</span> <span class="id">Hcid</span> <span class="id">A</span> <span class="id">C</span>; <span class="tactic">apply</span> <span class="id">A</span>; <span class="tactic">clear</span> <span class="id">A</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">C</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hstep</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> (<span class="id">constructor</span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_upd</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.push">TSOThrdPool.push</a></span> <span class="kwd">in</span> <span class="id">H_tp_push</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> ((<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>) !! <span class="id">t0</span>); <span class="id">inv</span> <span class="id">H_tp_push</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="kwd">in</span> <span class="id">H_tp_pop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> ((<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>) !! <span class="id">t0</span>); <span class="id">inv</span> <span class="id">H_tp_pop</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>; <span class="id">inv</span> <span class="id">H1</span>. <span class="id">inv</span> <span class="id">H_tp_upd</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="kwd">in</span> <span class="id">H_tp_pop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> ((<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>) !! <span class="id">t0</span>); <span class="id">inv</span> <span class="id">H_tp_pop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>; <span class="id">inv</span> <span class="id">H1</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_upd</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bi_not_unbuffered_bi_not_unbuffered</span>':<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">t0</span> <span class="id">bi</span> <span class="id">head0</span> <span class="id">tail0</span> <span class="id">tpc0</span> <span class="id">head</span> <span class="id">tail</span> <span class="id">tpc</span> <span class="id">_tail0</span> <span class="id">_tail0</span>' <span class="id">_tpc0</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#bi_not_unbuffered">bi_not_unbuffered</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#t0">t0</a></span> <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#head0">head0</a></span> <span class="id"><a href="TSOCompInvs.html#tail0">tail0</a></span> <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span> <span class="id"><a href="TSOCompInvs.html#head">head</a></span> <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#_tpc0">_tpc0</a></span>) <span class="id"><a href="TSOCompInvs.html#t0">t0</a></span> = <span class="id"><a href="TSOCompInvs.html#head0">head0</a></span> ++ <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span> :: <span class="id"><a href="TSOCompInvs.html#_tail0">_tail0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#tail0">tail0</a></span> = <span class="id"><a href="TSOCompInvs.html#_tail0">_tail0</a></span> ++ <span class="id">_tail0</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">t</span>, <span class="id"><a href="TSOCompInvs.html#t0">t0</a></span> &lt;&gt; <span class="id"><a href="TSOCompInvs.html#t">t</a></span> -&gt; <span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm">eq_thrdp_tm</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span> <span class="id"><a href="TSOCompInvs.html#_tpc0">_tpc0</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOSemLemmas.html#thrd_valid">thrd_valid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span> <span class="id"><a href="TSOCompInvs.html#t0">t0</a></span> -&gt; <span class="id"><a href="TSOSemLemmas.html#thrd_valid">thrd_valid</a></span> <span class="id"><a href="TSOCompInvs.html#_tpc0">_tpc0</a></span> <span class="id"><a href="TSOCompInvs.html#t0">t0</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOSemLemmas.html#thrd_not_halted">thrd_not_halted</a></span> <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span> <span class="id"><a href="TSOCompInvs.html#t0">t0</a></span> -&gt; <span class="id"><a href="TSOSemLemmas.html#thrd_not_halted">thrd_not_halted</a></span> <span class="id"><a href="TSOCompInvs.html#_tpc0">_tpc0</a></span> <span class="id"><a href="TSOCompInvs.html#t0">t0</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span> = <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#_tpc0">_tpc0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">_tail</span> <span class="id">_tpc</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bi_not_unbuffered</span>' <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#t0">t0</a></span> <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#head0">head0</a></span> <span class="id"><a href="TSOCompInvs.html#_tail0">_tail0</a></span> <span class="id"><a href="TSOCompInvs.html#_tpc0">_tpc0</a></span> <span class="id"><a href="TSOCompInvs.html#head">head</a></span> <span class="id"><a href="TSOCompInvs.html#_tail">_tail</a></span> <span class="id"><a href="TSOCompInvs.html#_tpc">_tpc</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">t</span>, <span class="id"><a href="TSOCompInvs.html#t0">t0</a></span> &lt;&gt; <span class="id"><a href="TSOCompInvs.html#t">t</a></span> -&gt; <span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm">eq_thrdp_tm</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOCompInvs.html#_tpc">_tpc</a></span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#_tpc">_tpc</a></span> = <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10240')">Proof.</div>
<div class="proofscript" id="proof10240">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">t0</span> <span class="id">bi</span> <span class="id">head0</span> <span class="id">tail0</span> <span class="id">tpc0</span> <span class="id">head</span> <span class="id">tail</span> <span class="id">tpc</span> <span class="id">_tail0</span> <span class="id">_tail0</span>' <span class="id">_tpc0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">_tpc0</span> <span class="id">_tail0</span> <span class="id">_tail0</span>'. <span class="tactic">induction</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">_tpc0</span> <span class="id">_tail0</span> <span class="id">_tail0</span>' <span class="id">Hbuffer</span> <span class="id">Htail</span> <span class="id">EQ</span> <span class="id">VALID</span> <span class="id">HALTED</span> <span class="id">EQcid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">_tail0</span>, <span class="id">_tpc0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; [|<span class="tactic">auto</span>]. <span class="tactic">destruct</span> <span class="id">_tpc0</span>. <span class="tactic">eapply</span> <span class="id">bi_nub_refl</span>'. <span class="tactic">auto</span>. <br/>
&nbsp;inductive&nbsp;case&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">_tpc0</span> <span class="id">_tail0</span> <span class="id">_tail0</span>' <span class="id">Hbuffer</span> <span class="id">Htail</span> <span class="id">EQ</span> <span class="id">VALID</span> <span class="id">HALTED</span> <span class="id">EQcid</span>.<br/>
&nbsp;case&nbsp;study&nbsp;on&nbsp;tso_globstep&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>.<br/>
&nbsp;tau&nbsp;step&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="tau_step_buffer_append">tau_step_buffer_append</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc</span> <span class="id">fp</span> <span class="id">tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOGlobSem.html#tau">tau</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span>, <span class="id">exists</span> <span class="id">tail</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">tpc</span>') <span class="id"><a href="TSOCompInvs.html#t">t</a></span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) <span class="id"><a href="TSOCompInvs.html#t">t</a></span> ++ <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10241')">Proof.</div>
<div class="proofscript" id="proof10241">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> (<span class="id">exists</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>; <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>; <span class="tactic">auto</span>; <span class="tactic">fail</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">subst</span>. <span class="id">inv</span> <span class="id">H_core_step</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H7</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="kwd">Lemma</span> <span class="id"><a name="exec_instr_TSO_buffer_append">exec_instr_TSO_buffer_append</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ge</span> <span class="id">f</span> <span class="id">i</span> <span class="id">rs</span> <span class="id">bfm</span> <span class="id">rs</span>' <span class="id">bfm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#exec_instr_TSO">exec_instr_TSO</a></span> <span class="id"><a href="TSOCompInvs.html#ge">ge</a></span> <span class="id"><a href="TSOCompInvs.html#f">f</a></span> <span class="id"><a href="TSOCompInvs.html#i">i</a></span> <span class="id"><a href="TSOCompInvs.html#rs">rs</a></span> <span class="id"><a href="TSOCompInvs.html#bfm">bfm</a></span> = <span class="kwd">Next</span> <span class="id">rs</span>' <span class="id">bfm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">tail</span>, <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">bfm</span>' = <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOCompInvs.html#bfm">bfm</a></span> ++ <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10242')">Proof.</div>
<div class="proofscript" id="proof10242">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">ge</span> <span class="id">f</span> <span class="id">i</span> <span class="id">rs</span> <span class="id">bfm</span> <span class="id">rs</span>' <span class="id">bfm</span>' <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="exec_load_TSO_mem_unchg">exec_load_TSO_mem_unchg</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ge</span> <span class="id">chunk</span> <span class="id">bfm</span> <span class="id">a</span> <span class="id">rs</span> <span class="id">r</span> <span class="id">rs</span>' <span class="id">bfm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#exec_load_TSO">exec_load_TSO</a></span> <span class="id"><a href="TSOCompInvs.html#ge">ge</a></span> <span class="id"><a href="TSOCompInvs.html#chunk">chunk</a></span> <span class="id"><a href="TSOCompInvs.html#bfm">bfm</a></span> <span class="id"><a href="TSOCompInvs.html#a">a</a></span> <span class="id"><a href="TSOCompInvs.html#rs">rs</a></span> <span class="id"><a href="TSOCompInvs.html#r">r</a></span> = <span class="kwd">Next</span> <span class="id">rs</span>' <span class="id">bfm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bfm</span>' = <span class="id"><a href="TSOCompInvs.html#bfm">bfm</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10243')">Proof.</div>
<div class="proofscript" id="proof10243">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#exec_load_TSO">exec_load_TSO</a></span>. <span class="tactic">intros</span> <span class="id">ge</span> <span class="id">chunk</span> <span class="id">bfm</span> <span class="id">a</span> <span class="id">rs</span> <span class="id">r</span> <span class="id">rs</span>' <span class="id">bfm</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#tsoloadv">tsoloadv</a></span> <span class="id">chunk</span> <span class="id">bfm</span> <span class="id">_</span>); <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="exec_store_TSO_buffer_append">exec_store_TSO_buffer_append</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ge</span> <span class="id">chunk</span> <span class="id">bfm</span> <span class="id">a</span> <span class="id">rs</span> <span class="id">r</span> <span class="id">lr</span> <span class="id">rs</span>' <span class="id">bfm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#exec_store_TSO">exec_store_TSO</a></span> <span class="id"><a href="TSOCompInvs.html#ge">ge</a></span> <span class="id"><a href="TSOCompInvs.html#chunk">chunk</a></span> <span class="id"><a href="TSOCompInvs.html#bfm">bfm</a></span> <span class="id"><a href="TSOCompInvs.html#a">a</a></span> <span class="id"><a href="TSOCompInvs.html#rs">rs</a></span> <span class="id"><a href="TSOCompInvs.html#r">r</a></span> <span class="id"><a href="TSOCompInvs.html#lr">lr</a></span> = <span class="kwd">Next</span> <span class="id">rs</span>' <span class="id">bfm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">tail</span>, <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">bfm</span>' = <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOCompInvs.html#bfm">bfm</a></span> ++ <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10244')">Proof.</div>
<div class="proofscript" id="proof10244">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#exec_store_TSO">exec_store_TSO</a></span>. <span class="tactic">intros</span> <span class="id">ge</span> <span class="id">chunk</span> <span class="id">bfm</span> <span class="id">a</span> <span class="id">rs</span> <span class="id">r</span> <span class="id">lr</span> <span class="id">rs</span>' <span class="id">bfm</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsostorev">tsostorev</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsostore">tsostore</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="ASM_local.html#eval_addrmode">eval_addrmode</a></span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">i</span>; <span class="id">inv</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#tso_goto_label">tso_goto_label</a></span> <span class="kwd">in</span> *; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>: <span class="kwd">match</span> ?<span class="id">x</span> <span class="kwd">with</span> <span class="id">_</span> =&gt; <span class="id">_</span> <span class="kwd">end</span> = <span class="kwd">Next</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>: <span class="kwd">Next</span> <span class="id">_</span> <span class="id">_</span> = <span class="kwd">Next</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id">exists</span> <span class="id">_</span>, ?<span class="id">x</span> = ?<span class="id">x</span> ++ <span class="id">_</span> =&gt; <span class="id">exists</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>; <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>; <span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>: <span class="id"><a href="AsmTSO.html#exec_load_TSO">exec_load_TSO</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> = <span class="kwd">Next</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#exec_load_TSO_mem_unchg">exec_load_TSO_mem_unchg</a></span> <span class="kwd">in</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>; <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>; <span class="tactic">congruence</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>: <span class="id"><a href="AsmTSO.html#exec_store_TSO">exec_store_TSO</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> = <span class="kwd">Next</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#exec_store_TSO_buffer_append">exec_store_TSO_buffer_append</a></span>; <span class="tactic">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#exec_instr_TSO_buffer_append">exec_instr_TSO_buffer_append</a></span> <span class="kwd">in</span> <span class="id">H5</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">H3</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsostore">tsostore</a></span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">H6</span>; <span class="id">inv</span> <span class="id">H8</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>. <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exists</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exists</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exists</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>. <span class="tactic">auto</span>. }        <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">H1</span>. <span class="id">revert</span> <span class="id">H3</span>. <span class="tactic">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span> <span class="id">t0</span>) (<span class="id"><a href="FMemory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id">fm</span>'). <span class="tactic">clear</span>. <span class="tactic">intros</span> <span class="id">buf</span> <span class="id">b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- <span class="id">context</span>[<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> ?<span class="id">x</span> ?<span class="id">y</span> ?<span class="id">z</span>] =&gt; <span class="tactic">generalize</span> (<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span>); <span class="tactic">intro</span> <span class="id">bi</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#store_args_fmem">store_args_fmem</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> 0.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="TSOMem.html#buffer_insert">buffer_insert</a></span> {| <span class="id"><a href="TSOMem.html#mktsofmem">tbuffer</a></span> := <span class="id">buf</span>; <span class="id">fmemory</span> := <span class="id">fm</span> |} <span class="id">bi</span>) <span class="kwd">as</span> <span class="id">bfm0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#buffer_insert">buffer_insert</a></span> <span class="kwd">in</span> *. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">exists</span> <span class="id">tail</span>, <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">tsofm</span>' = <span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id">bfm0</span> ++ <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">clear</span> <span class="id">Heqbfm0</span>. <span class="id">revert</span> <span class="id">bfm0</span> <span class="id">tys</span> <span class="id">z</span> <span class="id">H3</span>. <span class="tactic">clear</span>. <span class="tactic">induction</span> <span class="id">args</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="tactic">destruct</span> <span class="id">tys</span>; <span class="id">inv</span> <span class="id">H3</span>. <span class="id">exists</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tys</span>; <span class="id">inv</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">t</span>; <span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id">IHargs</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span>. <span class="tactic">rewrite</span> <span class="id">H</span>. <span class="tactic">simpl</span>. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span>. <span class="tactic">rewrite</span> <span class="id">H</span>. <span class="tactic">simpl</span>. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">IHargs</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">destruct</span> <span class="id">H0</span>; <span class="tactic">rewrite</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">repeat</span> <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span>. <span class="tactic">rewrite</span> <span class="id">H</span>. <span class="tactic">simpl</span>. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span>. <span class="tactic">rewrite</span> <span class="id">H</span>. <span class="tactic">simpl</span>. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span>. <span class="tactic">rewrite</span> <span class="id">H</span>. <span class="tactic">simpl</span>. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">tail</span>' <span class="id">Htail</span>'].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Htail</span>'. <span class="tactic">subst</span> <span class="id">bfm0</span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="tau_step_buffer_forward_head_tail">tau_step_buffer_forward_head_tail</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> (<span class="id">tpc</span>: @<span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span>) <span class="id">fp</span> <span class="id">tpc</span>' <span class="id">t0</span> <span class="id">bi</span> <span class="id">head</span> <span class="id">tail</span> <span class="id">head</span>' <span class="id">tail</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOGlobSem.html#tau">tau</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) <span class="id"><a href="TSOCompInvs.html#t0">t0</a></span> = <span class="id"><a href="TSOCompInvs.html#head">head</a></span> ++ <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span> :: <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">tpc</span>') <span class="id"><a href="TSOCompInvs.html#t0">t0</a></span> = <span class="id">head</span>' ++ <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span> :: <span class="id">tail</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#buffer_forward">buffer_forward</a></span> <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span> <span class="id"><a href="TSOCompInvs.html#head">head</a></span> <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> <span class="id">head</span>' <span class="id">tail</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">head</span>' = <span class="id"><a href="TSOCompInvs.html#head">head</a></span> /\ <span class="id">exists</span> <span class="id">tail</span>'', <span class="id">tail</span>' = <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> ++ <span class="id">tail</span>''.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10245')">Proof.</div>
<div class="proofscript" id="proof10245">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#tau_step_buffer_append">tau_step_buffer_append</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">tail</span>'' <span class="id">Hbuffer</span>'].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hbuffer</span>' <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span>. <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="id">exists</span> <span class="id">tail</span>''. <span class="tactic">f_equal</span>. <span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_inv_head">app_inv_head</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_comm_cons">app_comm_cons</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>. <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_comm_cons">app_comm_cons</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H1</span>. <span class="tactic">generalize</span> (<span class="id">head</span> ++ <span class="id">bi</span> :: <span class="id">tail</span>) <span class="id">tail</span>''. <span class="tactic">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> ((<span class="id">bi_head</span> :: <span class="id">l</span>) ++ <span class="id">tail</span>'') = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">l</span>) <span class="tactic">by</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_length">app_length</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#tau_step_buffer_forward_head_tail">tau_step_buffer_forward_head_tail</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">A</span> [<span class="id">_tail0</span>'' <span class="id">B</span>]]; <span class="tactic">subst</span> <span class="id">head</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t0</span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHbi_not_unbuffered</span> <span class="id">_tpc0</span> <span class="id">_tail0</span> (<span class="id">_tail0</span>' ++ <span class="id">_tail0</span>'')).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbi_not_unbuffered</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">tail</span>' <span class="id">tail</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="tau_step_eq_thrdp_tm">tau_step_eq_thrdp_tm</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc</span> <span class="id">fp</span> <span class="id">tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) &lt;&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOGlobSem.html#tau">tau</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">t</span>, <span class="id"><a href="TSOCompInvs.html#t">t</a></span> &lt;&gt; <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt; <span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm">eq_thrdp_tm</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id">tpc</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10246')">Proof.</div>
<div class="proofscript" id="proof10246">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>; <span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm">eq_thrdp_tm</a></span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">H_tp_upd</span>; <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>; <span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="tsostep_buff_non_empty_mem_unchg">tsostep_buff_non_empty_mem_unchg</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ge</span> <span class="id">fl</span> <span class="id">c</span> <span class="id">buf</span> <span class="id">gm</span> <span class="id">fp</span> <span class="id">c</span>' <span class="id">buf</span>' <span class="id">gm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#tsostep">tsostep</a></span> <span class="id"><a href="TSOCompInvs.html#ge">ge</a></span> <span class="id"><a href="TSOCompInvs.html#fl">fl</a></span> <span class="id"><a href="TSOCompInvs.html#c">c</a></span> (<span class="id"><a href="TSOCompInvs.html#buf">buf</a></span>, <span class="id"><a href="TSOCompInvs.html#gm">gm</a></span>) <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">c</span>' (<span class="id">buf</span>', <span class="id">gm</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#buf">buf</a></span> &lt;&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">gm</span>' = <span class="id"><a href="TSOCompInvs.html#gm">gm</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10247')">Proof.</div>
<div class="proofscript" id="proof10247">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">H9</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="tactic">try</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>: <span class="id"><a href="FMemory.html#embed">embed</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>  |- <span class="id">_</span> =&gt; <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="exec_instr_TSO_buff_non_empty_mem_unchg">exec_instr_TSO_buff_non_empty_mem_unchg</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ge</span> <span class="id">f</span> <span class="id">i</span> <span class="id">rs</span> <span class="id">bfm</span> <span class="id">rs</span>' <span class="id">bfm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#exec_instr_TSO">exec_instr_TSO</a></span> <span class="id"><a href="TSOCompInvs.html#ge">ge</a></span> <span class="id"><a href="TSOCompInvs.html#f">f</a></span> <span class="id"><a href="TSOCompInvs.html#i">i</a></span> <span class="id"><a href="TSOCompInvs.html#rs">rs</a></span> <span class="id"><a href="TSOCompInvs.html#bfm">bfm</a></span> = <span class="kwd">Next</span> <span class="id">rs</span>' <span class="id">bfm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tbuffer">tbuffer</a></span> <span class="id"><a href="TSOCompInvs.html#bfm">bfm</a></span> &lt;&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id">bfm</span>' = <span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id"><a href="TSOCompInvs.html#bfm">bfm</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10248')">Proof.</div>
<div class="proofscript" id="proof10248">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="exec_store_TSO_mem_unchg">exec_store_TSO_mem_unchg</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ge</span> <span class="id">chunk</span> <span class="id">bfm</span> <span class="id">a</span> <span class="id">rs</span> <span class="id">r</span> <span class="id">lr</span> <span class="id">rs</span>' <span class="id">bfm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#exec_store_TSO">exec_store_TSO</a></span> <span class="id"><a href="TSOCompInvs.html#ge">ge</a></span> <span class="id"><a href="TSOCompInvs.html#chunk">chunk</a></span> <span class="id"><a href="TSOCompInvs.html#bfm">bfm</a></span> <span class="id"><a href="TSOCompInvs.html#a">a</a></span> <span class="id"><a href="TSOCompInvs.html#rs">rs</a></span> <span class="id"><a href="TSOCompInvs.html#r">r</a></span> <span class="id"><a href="TSOCompInvs.html#lr">lr</a></span> = <span class="kwd">Next</span> <span class="id">rs</span>' <span class="id">bfm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id">bfm</span>' = <span class="id"><a href="TSOMem.html#fmemory">fmemory</a></span> <span class="id"><a href="TSOCompInvs.html#bfm">bfm</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10249')">Proof.</div>
<div class="proofscript" id="proof10249">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#exec_store_TSO">exec_store_TSO</a></span>, <span class="id"><a href="TSOMem.html#tsostorev">tsostorev</a></span>, <span class="id"><a href="TSOMem.html#tsostore">tsostore</a></span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="ASM_local.html#eval_addrmode">eval_addrmode</a></span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="tactic">simpl</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">i</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#tso_goto_label">tso_goto_label</a></span> <span class="kwd">in</span> *; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| |- ?<span class="id">x</span> = ?<span class="id">x</span> =&gt; <span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>: <span class="id"><a href="AsmTSO.html#Stuck">Stuck</a></span> = <span class="kwd">Next</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="tactic">discriminate</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>: <span class="kwd">match</span> ?<span class="id">x</span> <span class="kwd">with</span> <span class="id">_</span> =&gt; <span class="id">_</span> <span class="kwd">end</span> = <span class="kwd">Next</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>: <span class="kwd">Next</span> <span class="id">_</span> <span class="id">_</span> = <span class="kwd">Next</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id">exists</span> <span class="id">_</span>, ?<span class="id">x</span> = ?<span class="id">x</span> ++ <span class="id">_</span> =&gt; <span class="id">exists</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>; <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>; <span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>: <span class="id"><a href="AsmTSO.html#exec_load_TSO">exec_load_TSO</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> = <span class="kwd">Next</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#exec_load_TSO_mem_unchg">exec_load_TSO_mem_unchg</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="tactic">congruence</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>: <span class="id"><a href="AsmTSO.html#exec_store_TSO">exec_store_TSO</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> = <span class="kwd">Next</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#exec_store_TSO_mem_unchg">exec_store_TSO_mem_unchg</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="tactic">congruence</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">auto</span>; <span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#exec_instr_TSO_buff_non_empty_mem_unchg">exec_instr_TSO_buff_non_empty_mem_unchg</a></span> <span class="kwd">in</span> <span class="id">H4</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">H4</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">H3</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsostore">tsostore</a></span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">H5</span>; <span class="id">inv</span> <span class="id">H7</span>. <span class="tactic">simpl</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">revert</span> <span class="id">H3</span>. <span class="id">inv</span> <span class="id">H1</span>. <span class="tactic">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id">context</span>[<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> ?<span class="id">a</span> ?<span class="id">b</span> ?<span class="id">c</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id">a</span> <span class="id">b</span> <span class="id">c</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#store_args_fmem">store_args_fmem</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id">context</span>[<span class="id"><a href="AsmTSO.html#store_args_rec_fmem">store_args_rec_fmem</a></span> <span class="id">_</span> ?<span class="id">a</span> ?<span class="id">b</span> ?<span class="id">c</span> ?<span class="id">d</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="id">a</span> <span class="id">b</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>. <span class="tactic">clear</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#buffer_insert">buffer_insert</a></span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">b</span>. <span class="tactic">generalize</span> (<span class="id">buf</span> ++ <span class="id">b</span> :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>). <span class="tactic">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">z</span> <span class="id">tys</span> <span class="id">fm</span>. <span class="tactic">induction</span> <span class="id">args</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tys</span>; <span class="id">inv</span> <span class="id">H3</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tys</span>; <span class="id">inv</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">t</span>; <span class="tactic">unfold</span> <span class="id"><a href="AsmTSO.html#store_stack_fmem">store_stack_fmem</a></span>, <span class="id"><a href="TSOMem.html#tsostorev">tsostorev</a></span>, <span class="id"><a href="TSOMem.html#tsostore">tsostore</a></span>, <span class="id"><a href="TSOMem.html#buffer_insert">buffer_insert</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Values.html#Val.offset_ptr">Val.offset_ptr</a></span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Values.html#Val.offset_ptr">Val.offset_ptr</a></span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Values.html#Val.offset_ptr">Val.offset_ptr</a></span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Values.html#Val.offset_ptr">Val.offset_ptr</a></span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Values.html#Val.offset_ptr">Val.offset_ptr</a></span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Values.html#Val.offset_ptr">Val.offset_ptr</a></span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Values.html#Val.offset_ptr">Val.offset_ptr</a></span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#tsostep_buff_non_empty_mem_unchg">tsostep_buff_non_empty_mem_unchg</a></span> <span class="kwd">in</span> <span class="id">H_core_step</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.push">TSOThrdPool.push</a></span> <span class="kwd">in</span> <span class="id">H_tp_push</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> ((<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>) !! <span class="id">t0</span>); <span class="id">inv</span> <span class="id">H_tp_push</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="kwd">in</span> <span class="id">H_tp_pop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> ((<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>) !! <span class="id">t0</span>); <span class="id">inv</span> <span class="id">H_tp_pop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>; <span class="id">inv</span> <span class="id">H2</span>. <span class="id">inv</span> <span class="id">H_tp_upd</span>; <span class="tactic">simpl</span>. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="kwd">in</span> <span class="id">H_tp_pop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> ((<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>) !! <span class="id">t0</span>); <span class="id">inv</span> <span class="id">H_tp_pop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>; <span class="id">inv</span> <span class="id">H2</span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">specialize</span> (<span class="id">EQ</span> <span class="id">_</span> <span class="id">H5</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm_trans">eq_thrdp_tm_trans</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm_sym">eq_thrdp_tm_sym</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#tau_step_eq_thrdp_tm">tau_step_eq_thrdp_tm</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">subst</span> <span class="id">t0</span>. <span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H6</span>. <span class="tactic">destruct</span> <span class="id">head</span>; <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id">VALID</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#glob_step_valid">glob_step_valid</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id">HALTED</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#glob_step_halted">glob_step_halted</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="tau_step_cid_eq">tau_step_cid_eq</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc</span> <span class="id">fp</span> <span class="id">tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOGlobSem.html#tau">tau</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc</span>' = <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10250')">Proof.</div>
<div class="proofscript" id="proof10250">
 <span class="tactic">clear</span>. <span class="tactic">inversion</span> 1; <span class="tactic">auto</span>. Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#tau_step_cid_eq">tau_step_cid_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm_tau_step_sim">eq_thrdp_tm_tau_step_sim</a></span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span>' <span class="id">t0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">rewrite</span> <span class="id">Hbuffer</span>. <span class="tactic">rewrite</span> <span class="id">H0</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_comm_cons">app_comm_cons</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">EQ</span>. <span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id">n0</span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">_</span> &amp; <span class="id">_</span> &amp; <span class="id">_</span> &amp; <span class="id">_</span> &amp; <span class="id">Hbuffers</span>). <span class="tactic">rewrite</span> <span class="id">Hbuffers</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">EQ</span>; <span class="tactic">auto</span>. <span class="tactic">intros</span> (<span class="id">_tpc1</span> &amp; <span class="id">Hstep</span>' &amp; <span class="id">EQ</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="less_buffer_item_not_conflict_preserve">less_buffer_item_not_conflict_preserve</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">fp</span> <span class="id">buffers</span> <span class="id">buffers</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">t</span>' <span class="id">bi</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span> (<span class="id">buffers</span>' <span class="id">t</span>') -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span> (<span class="id"><a href="TSOCompInvs.html#buffers">buffers</a></span> <span class="id">t</span>')) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="ClientSim.html#conflictc">conflictc</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id"><a href="TSOCompInvs.html#buffers">buffers</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="ClientSim.html#conflictc">conflictc</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">buffers</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10251')">Proof.</div>
<div class="proofscript" id="proof10251">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span> <span class="id">t</span> <span class="id">fp</span> <span class="id">buffers</span> <span class="id">buffers</span>' <span class="id">H</span> <span class="id">A</span> <span class="id">C</span>; <span class="tactic">apply</span> <span class="id">A</span>; <span class="tactic">clear</span> <span class="id">A</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">C</span>. <span class="tactic">apply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="tau_step_buffer_eq">tau_step_buffer_eq</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc0</span> <span class="id">fp</span> <span class="id">tpc1</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span> <span class="id"><a href="TSOGlobSem.html#tau">tau</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id"><a href="TSOCompInvs.html#tpc1">tpc1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span> &lt;&gt; <span class="id"><a href="TSOCompInvs.html#t">t</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc1">tpc1</a></span>) <span class="id"><a href="TSOCompInvs.html#t">t</a></span> = <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span>) <span class="id"><a href="TSOCompInvs.html#t">t</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10252')">Proof.</div>
<div class="proofscript" id="proof10252">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">inversion</span> 1; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tsoupd">tsoupd</a></span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#tau_step_buffer_eq">tau_step_buffer_eq</a></span>. <span class="tactic">exact</span> <span class="id">Hstep</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id">n</span>. <span class="tactic">rewrite</span> <span class="id">EQcid</span>, <span class="id">H5</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hbuffer</span>'. <span class="tactic">rewrite</span> <span class="id">Hbuffer</span> <span class="kwd">in</span> <span class="id">Hbuffer</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">tail</span>' = <span class="id">tail</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#tau_step_buffer_eq">tau_step_buffer_eq</a></span>. <span class="tactic">exact</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id">n</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span>, <span class="id">H1</span>. <span class="tactic">clear</span>. <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">head</span>; <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">tail</span>'. <span class="tactic">rewrite</span> <span class="id">Htail</span> <span class="kwd">in</span> <span class="id">H5</span> <span class="tactic">at</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">IHbi_not_unbuffered</span> <span class="id">_tpc1</span> <span class="id">_tail0</span> <span class="id">_tail0</span>' <span class="id">Hbuffer</span>' <span class="id">H5</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">EQ</span>'. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intro</span>. <span class="tactic">eapply</span> <span class="id">glob_step_valid</span>'; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">VALID</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#glob_step_valid">glob_step_valid</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intro</span>. <span class="tactic">eapply</span> <span class="id">glob_step_halted</span>'; <span class="tactic">eauto</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">HALTED</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#glob_step_halted">glob_step_halted</a></span>; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#tau_step_cid_eq">tau_step_cid_eq</a></span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H</span>. <span class="tactic">rewrite</span> <span class="id">EQcid</span>. <span class="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#tau_step_cid_eq">tau_step_cid_eq</a></span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">Hstep</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">_tail</span> &amp; <span class="id">_tpc</span> &amp; <span class="id">Hnub</span>' &amp; <span class="id">EQ</span>'').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">_tail</span>, <span class="id">_tpc</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">bi_nub_step</span>'; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">Hstep</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>. <span class="tactic">split</span>;[|<span class="tactic">auto</span>]. <span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id">n</span>. <span class="tactic">rewrite</span> <span class="id">EQcid</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#buf_forward_refl">buf_forward_refl</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hclient</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#less_buffer_item_not_conflict_preserve">less_buffer_item_not_conflict_preserve</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">instantiate</span> (1:= <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">tpc</span>)). <span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t0</span> <span class="id">t</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">t</span>'. <span class="tactic">rewrite</span> <span class="id">Hbuffer</span> <span class="kwd">in</span> <span class="id">H6</span>. <span class="tactic">rewrite</span> <span class="id">H0</span>. <span class="tactic">subst</span> <span class="id">tail</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_comm_cons">app_comm_cons</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>. <span class="tactic">apply</span> <span class="id"><a href="Coqlib.html#in_app">in_app</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">EQ</span> <span class="kwd">in</span> <span class="id">n0</span>. <span class="tactic">destruct</span> <span class="id">n0</span> <span class="kwd">as</span> [<span class="id">_</span> [<span class="id">_</span> [<span class="id">_</span> [<span class="id">_</span> <span class="id">E</span>]]]]. <span class="tactic">rewrite</span> <span class="id">E</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">EQcid</span>. <span class="tactic">apply</span> <span class="id">H3</span>. <span class="tactic">rewrite</span> <span class="id">EQcid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="eq_thrdp_tm_eq_client_core">eq_thrdp_tm_eq_client_core</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">t</span> <span class="id">tpc</span> <span class="id">_tpc</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm">eq_thrdp_tm</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOCompInvs.html#_tpc">_tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#client_core">client_core</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#client_core">client_core</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#_tpc">_tpc</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10253')">Proof.</div>
<div class="proofscript" id="proof10253">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">t</span> <span class="id">tpc</span> <span class="id">_tpc</span> <span class="id">H</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>; <span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">destruct</span> <span class="id">H</span>. <span class="tactic">intuition</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H3</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#eq_thrdp_tm_eq_client_core">eq_thrdp_tm_eq_client_core</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm_sym">eq_thrdp_tm_sym</a></span>, <span class="id">EQ</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;} <br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm_sw_step_sim">eq_thrdp_tm_sw_step_sim</a></span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">t</span> [<span class="id">A</span> <span class="id">B</span>]. <span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t0</span> <span class="id">t</span>). <span class="tactic">subst</span> <span class="id">t</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; [<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm_valid">eq_thrdp_tm_valid</a></span>| <span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm_halted">eq_thrdp_tm_halted</a></span>]; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">EQ</span>; <span class="tactic">auto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">_tpc1</span> &amp; <span class="id">EQcid</span>' &amp; <span class="id">Hstep</span>' &amp; <span class="id">EQ</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="sw_step_buffer_forward_head_tail">sw_step_buffer_forward_head_tail</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> (<span class="id">tpc</span>: @<span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span>) <span class="id">fp</span> <span class="id">tpc</span>' <span class="id">t0</span> <span class="id">bi</span> <span class="id">head</span> <span class="id">tail</span> <span class="id">head</span>' <span class="id">tail</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) <span class="id"><a href="TSOCompInvs.html#t0">t0</a></span> = <span class="id"><a href="TSOCompInvs.html#head">head</a></span> ++ <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span> :: <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">tpc</span>') <span class="id"><a href="TSOCompInvs.html#t0">t0</a></span> = <span class="id">head</span>' ++ <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span> :: <span class="id">tail</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#buffer_forward">buffer_forward</a></span> <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span> <span class="id"><a href="TSOCompInvs.html#head">head</a></span> <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> <span class="id">head</span>' <span class="id">tail</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">head</span>' = <span class="id"><a href="TSOCompInvs.html#head">head</a></span> /\ <span class="id">tail</span>' = <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10254')">Proof.</div>
<div class="proofscript" id="proof10254">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">inversion</span> 1. <span class="tactic">subst</span>. <span class="tactic">simpl</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_inv_head">app_inv_head</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">inversion</span> <span class="id">H1</span>. <span class="tactic">rewrite</span> <span class="id">H3</span> <span class="tactic">at</span> 2. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_inv_tail">app_inv_tail</a></span>. <span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="sw_step_buffer_eq">sw_step_buffer_eq</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc</span> <span class="id">fp</span> <span class="id">tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">tpc</span>') = <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10255')">Proof.</div>
<div class="proofscript" id="proof10255">
 <span class="tactic">clear</span>. <span class="tactic">inversion</span> 1. <span class="tactic">auto</span>. Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#sw_step_buffer_forward_head_tail">sw_step_buffer_forward_head_tail</a></span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span>; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">H1</span>; <span class="tactic">eauto</span>. <span class="tactic">auto</span>. <span class="tactic">intros</span> [<span class="id">A</span> <span class="id">B</span>]; <span class="tactic">subst</span> <span class="id">head</span>' <span class="id">tail</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">IHbi_not_unbuffered</span> <span class="id">_tpc1</span> <span class="id">_tail0</span> <span class="id">_tail0</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#sw_step_buffer_eq">sw_step_buffer_eq</a></span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">Hstep</span>'; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">EQ</span>'. <span class="tactic">apply</span> <span class="id">EQ</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="sw_step_thdp_eq">sw_step_thdp_eq</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc</span> <span class="id">fp</span> <span class="id">tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id">tpc</span>' = <span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10256')">Proof.</div>
<div class="proofscript" id="proof10256">
 <span class="tactic">clear</span>. <span class="tactic">inversion</span> 1. <span class="tactic">auto</span>. Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#thrd_valid">thrd_valid</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#sw_step_thdp_eq">sw_step_thdp_eq</a></span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">A</span>. <span class="tactic">apply</span> <span class="id">VALID</span> <span class="kwd">in</span> <span class="id">A</span>. <span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#sw_step_thdp_eq">sw_step_thdp_eq</a></span>. <span class="tactic">exact</span> <span class="id">A</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#thrd_not_halted">thrd_not_halted</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#sw_step_thdp_eq">sw_step_thdp_eq</a></span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">A</span>. <span class="tactic">apply</span> <span class="id">HALTED</span> <span class="kwd">in</span> <span class="id">A</span>. <span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#sw_step_thdp_eq">sw_step_thdp_eq</a></span>. <span class="tactic">exact</span> <span class="id">A</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">_tail</span> &amp; <span class="id">_tpc</span> &amp; <span class="id">Hbnu</span>' &amp; <span class="id">EQ</span>'').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">_tail</span>, <span class="id">_tpc</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">bi_nub_step</span>'. <span class="id">right</span>. <span class="id">left</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#sw_step_buffer_eq">sw_step_buffer_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#buf_forward_refl">buf_forward_refl</a></span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="emp_fp_not_conflictc">emp_fp_not_conflictc</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">B</span>, ~ <span class="id"><a href="ClientSim.html#conflictc">conflictc</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id"><a href="TSOCompInvs.html#B">B</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10257')">Proof.</div>
<div class="proofscript" id="proof10257">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span> <span class="id">t</span> <span class="id">B</span> <span class="id">C</span>. <span class="id">inv</span> <span class="id">C</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#Locs.locs_intersect_emp">Locs.locs_intersect_emp</a></span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#Locs.locs_intersect_emp_sym">Locs.locs_intersect_emp_sym</a></span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#Locs.locs_union_emp">Locs.locs_union_emp</a></span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Footprint.html#Locs.emp_union_locs">Locs.emp_union_locs</a></span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="Footprint.html#Locs.locs_emp">Locs.locs_emp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="sw_step_emp_fp">sw_step_emp_fp</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc</span> <span class="id">fp</span> <span class="id">tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> = <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10258')">Proof.</div>
<div class="proofscript" id="proof10258">
 <span class="tactic">clear</span>. <span class="tactic">inversion</span> 1; <span class="tactic">auto</span>. Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#sw_step_emp_fp">sw_step_emp_fp</a></span> <span class="kwd">in</span> <span class="id">Hstep</span>'. <span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#emp_fp_not_conflictc">emp_fp_not_conflictc</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="ub_step_emp_fp">ub_step_emp_fp</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc</span> <span class="id">fp</span> <span class="id">tpc</span>' <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> (<span class="id"><a href="TSOGlobSem.html#ub">ub</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span>) <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> = <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10259')">Proof.</div>
<div class="proofscript" id="proof10259">
 <span class="tactic">clear</span>. <span class="tactic">inversion</span> 1; <span class="tactic">auto</span>. Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#ub_step_emp_fp">ub_step_emp_fp</a></span>. <span class="tactic">exact</span> <span class="id">H</span>. <span class="tactic">intro</span> <span class="id">FP</span>. <span class="tactic">subst</span> <span class="id">fp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="ub_step_buffer_forward_head_tail">ub_step_buffer_forward_head_tail</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> (<span class="id">tpc</span>: @<span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span>) <span class="id">fp</span> <span class="id">tpc</span>' <span class="id">t0</span> <span class="id">bi</span> <span class="id">head</span> <span class="id">tail</span> <span class="id">head</span>' <span class="id">tail</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> (<span class="id"><a href="TSOGlobSem.html#ub">ub</a></span> <span class="id"><a href="TSOCompInvs.html#t0">t0</a></span>) <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) <span class="id"><a href="TSOCompInvs.html#t0">t0</a></span> = <span class="id"><a href="TSOCompInvs.html#head">head</a></span> ++ <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span> :: <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">tpc</span>') <span class="id"><a href="TSOCompInvs.html#t0">t0</a></span> = <span class="id">head</span>' ++ <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span> :: <span class="id">tail</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#buffer_forward">buffer_forward</a></span> <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span> <span class="id"><a href="TSOCompInvs.html#head">head</a></span> <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> <span class="id">head</span>' <span class="id">tail</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tail</span>' = <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> /\ <span class="id">exists</span> <span class="id">bi</span>', <span class="id"><a href="TSOCompInvs.html#head">head</a></span> = <span class="id">bi</span>' :: <span class="id">head</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10260')">Proof.</div>
<div class="proofscript" id="proof10260">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>; (<span class="tactic">eauto</span>; <span class="id">exfalso</span>; <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unbuffer">unbuffer</a></span> <span class="kwd">in</span> <span class="id">H_unbuf</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span> <span class="id">t0</span>); <span class="id">inv</span> <span class="id">H_unbuf</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span>; <span class="id">inv</span> <span class="id">H2</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H1</span>. <span class="tactic">clear</span>. <span class="tactic">induction</span> <span class="id">b0</span>; <span class="tactic">inversion</span> 1; <span class="tactic">subst</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_comm_cons">app_comm_cons</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H1</span>. <span class="tactic">clear</span>. <span class="tactic">induction</span> <span class="id">b0</span>; <span class="tactic">inversion</span> 1; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t0</span> <span class="id">t</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#ub_step_buffer_forward_head_tail">ub_step_buffer_forward_head_tail</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">A</span> [<span class="id">bi</span>' <span class="id">B</span>]]. <span class="tactic">subst</span> <span class="id">tail</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#less_buffer_item_not_unbuffered_ub_sim">less_buffer_item_not_unbuffered_ub_sim</a></span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="exists_noneq_tid">exists_noneq_tid</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span>, <span class="id">exists</span> <span class="id">t</span>', <span class="id"><a href="TSOCompInvs.html#t">t</a></span> &lt;&gt; <span class="id">t</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10261')">Proof.</div>
<div class="proofscript" id="proof10261">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">t</span>~0)%<span class="id">positive</span>. <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">t</span>~1)%<span class="id">positive</span>. <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (1~0)%<span class="id">positive</span>. <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="TSOCompInvs.html#exists_noneq_tid">exists_noneq_tid</a></span> <span class="id">t0</span>) <span class="kwd">as</span> <span class="id">Ht</span>. <span class="tactic">destruct</span> <span class="id">Ht</span> <span class="kwd">as</span> [<span class="id">t</span>' <span class="id">Ht</span>]. <span class="tactic">apply</span> <span class="id">EQ</span> <span class="kwd">in</span> <span class="id">Ht</span>. <span class="tactic">destruct</span> <span class="id">Ht</span> <span class="kwd">as</span> (<span class="id">_</span>&amp;<span class="id">_</span>&amp;<span class="id">_</span>&amp;<span class="id">C</span>&amp;<span class="id">_</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">_tpc1</span> &amp; <span class="id">Hstep</span>' &amp; <span class="id">Hbuffer</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">IHbi_not_unbuffered</span> <span class="id">_tpc1</span> <span class="id">_tail0</span> <span class="id">_tail0</span>' <span class="id">Hbuffer</span>' <span class="id">Htail</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="ub_step_eq_thrdp_tm_preserved">ub_step_eq_thrdp_tm_preserved</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">t</span> <span class="id">tpc</span> <span class="id">_tpc</span> <span class="id">head</span> <span class="id">bi</span> <span class="id">tail</span> <span class="id">_tail</span> <span class="id">tpc</span>' <span class="id">_tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) <span class="id"><a href="TSOCompInvs.html#t">t</a></span> = <span class="id"><a href="TSOCompInvs.html#head">head</a></span> ++ <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span> :: <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#_tpc">_tpc</a></span>) <span class="id"><a href="TSOCompInvs.html#t">t</a></span> = <span class="id"><a href="TSOCompInvs.html#head">head</a></span> ++ <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span> :: <span class="id"><a href="TSOCompInvs.html#_tail">_tail</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> (<span class="id"><a href="TSOGlobSem.html#ub">ub</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#_tpc">_tpc</a></span> (<span class="id"><a href="TSOGlobSem.html#ub">ub</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">_tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">t</span>', <span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm">eq_thrdp_tm</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id">t</span>' <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOCompInvs.html#_tpc">_tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm">eq_thrdp_tm</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id">t</span>' <span class="id">tpc</span>' <span class="id">_tpc</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10262')">Proof.</div>
<div class="proofscript" id="proof10262">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>; <span class="id">inv</span> <span class="id">H2</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm">eq_thrdp_tm</a></span> <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">exists</span> <span class="id">bi</span>' <span class="id">tail</span>' <span class="id">_tail</span>', <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span> <span class="id">t</span> = <span class="id">bi</span>' :: <span class="id">tail</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm0</span> <span class="id">t</span> = <span class="id">bi</span>' :: <span class="id">_tail</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">H</span>, <span class="id">H0</span>. <span class="tactic">clear</span>. <span class="tactic">destruct</span> <span class="id">head</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">bi</span> <span class="id">head</span> <span class="id">tail</span> <span class="id">_tail</span> <span class="id">H</span> <span class="id">H0</span>. <span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> (<span class="id">bi</span> &amp; <span class="id">tail</span> &amp; <span class="id">_tail</span> &amp; <span class="id">H</span> &amp; <span class="id">H0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H3</span> <span class="kwd">as</span> [<span class="id">A</span> [<span class="id">B</span> [<span class="id">C</span> [<span class="id">D</span> <span class="id">E</span>]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 (<span class="tactic">split</span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unbuffer">unbuffer</a></span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H_unbuf</span>. <span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H_unbuf0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">eqn</span>:<span class="id">F</span>; <span class="id">inv</span> <span class="id">H_unbuf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">bi</span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">tm0</span>)) <span class="id">eqn</span>:<span class="id">G</span>; <span class="id">inv</span> <span class="id">H_unbuf0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">split</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="ub_step_thrdp_eq">ub_step_thrdp_eq</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc</span> <span class="id">t</span> <span class="id">tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> (<span class="id"><a href="TSOGlobSem.html#ub">ub</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id">tpc</span>' = <span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10263')">Proof.</div>
<div class="proofscript" id="proof10263">
 <span class="tactic">clear</span>. <span class="tactic">inversion</span> 1; <span class="tactic">auto</span>. Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="ub_step_cid_eq">ub_step_cid_eq</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc</span> <span class="id">t</span> <span class="id">tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> (<span class="id"><a href="TSOGlobSem.html#ub">ub</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc</span>' = <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10264')">Proof.</div>
<div class="proofscript" id="proof10264">
 <span class="tactic">clear</span>. <span class="tactic">inversion</span> 1; <span class="tactic">auto</span>. Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#ub_step_eq_thrdp_tm_preserved">ub_step_eq_thrdp_tm_preserved</a></span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">EQ</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">eapply</span> <span class="id">glob_step_valid</span>'; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">VALID</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#glob_step_valid">glob_step_valid</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#thrd_not_halted">thrd_not_halted</a></span>. <span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#ub_step_thrdp_eq">ub_step_thrdp_eq</a></span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">Hstep</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">HALTED</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#glob_step_halted">glob_step_halted</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#ub_step_cid_eq">ub_step_cid_eq</a></span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H</span>. <span class="tactic">symmetry</span>. <span class="tactic">rewrite</span> <span class="id">EQcid</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#ub_step_cid_eq">ub_step_cid_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">_tail</span> &amp; <span class="id">_tpc</span> &amp; <span class="id">Hbnub</span>' &amp; <span class="id">EQ</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">_tail</span>, <span class="id">_tpc</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">bi_nub_step</span>'; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">Hstep</span>'. <span class="id">right</span>. <span class="id">right</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>. <span class="tactic">eauto</span>. <span class="tactic">subst</span> <span class="id">head</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#buf_forward_deq">buf_forward_deq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#emp_fp_not_conflictc">emp_fp_not_conflictc</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm_ub_step_sim">eq_thrdp_tm_ub_step_sim</a></span>. <span class="tactic">exact</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id">EQ</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">_tpc1</span> &amp; <span class="id">Hstep</span>' &amp; <span class="id">EQ</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="buffer_forward_split_eq">buffer_forward_split_eq</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">head</span> <span class="id">tail</span> <span class="id">head</span>' <span class="id">tail</span>' <span class="id">bi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#buffer_forward">buffer_forward</a></span> <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span> <span class="id"><a href="TSOCompInvs.html#head">head</a></span> <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> <span class="id">head</span>' <span class="id">tail</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#head">head</a></span> ++ <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span> :: <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> = <span class="id">head</span>' ++ <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span> :: <span class="id">tail</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">head</span>' = <span class="id"><a href="TSOCompInvs.html#head">head</a></span> /\ <span class="id">tail</span>' = <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10265')">Proof.</div>
<div class="proofscript" id="proof10265">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span> <span class="id">head</span> <span class="id">tail</span> <span class="id">head</span>' <span class="id">tail</span>' <span class="id">bi</span> <span class="id">H</span> <span class="id">H</span>'. <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">head</span>'; <span class="id">inv</span> <span class="id">H</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span> <span class="id">tail</span>) <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_l">app_nil_l</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_inv_head">app_inv_head</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">subst</span>. <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHhead</span>' <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_inv_tail">app_inv_tail</a></span> <span class="kwd">in</span> <span class="id">H</span>'. <span class="tactic">rewrite</span> &lt;- <span class="id">H</span>' <span class="tactic">at</span> 1. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#ub_step_buffer_eq">ub_step_buffer_eq</a></span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H</span>. <span class="tactic">exact</span> <span class="id">n</span>. <span class="tactic">intro</span> <span class="id">A</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#buffer_forward_split_eq">buffer_forward_split_eq</a></span>. <span class="tactic">exact</span> <span class="id">H2</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H0</span>, &lt;- <span class="id">H1</span>, <span class="id">A</span>.  <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">B</span> <span class="id">C</span>]. <span class="tactic">subst</span> <span class="id">head</span>' <span class="id">tail</span>'. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">IHbi_not_unbuffered</span> <span class="id">_tpc1</span> <span class="id">_tail0</span> <span class="id">_tail0</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOSemLemmas.html#ub_step_buffer_eq">ub_step_buffer_eq</a></span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">Hstep</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>. <span class="tactic">exact</span> <span class="id">n</span>. <span class="tactic">auto</span>. <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">EQ</span>'. <span class="tactic">apply</span> <span class="id">EQ</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">eapply</span> <span class="id">glob_step_valid</span>'; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">VALID</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#glob_step_valid">glob_step_valid</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#thrd_not_halted">thrd_not_halted</a></span>. <span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#ub_step_thrdp_eq">ub_step_thrdp_eq</a></span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">Hstep</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">HALTED</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#glob_step_halted">glob_step_halted</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#ub_step_cid_eq">ub_step_cid_eq</a></span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H</span>. <span class="tactic">symmetry</span>. <span class="tactic">rewrite</span> <span class="id">EQcid</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#ub_step_cid_eq">ub_step_cid_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">_tail</span> &amp; <span class="id">_tpc</span> &amp; <span class="id">Hbnub</span>' &amp; <span class="id">EQ</span>'').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">_tail</span>, <span class="id">_tpc</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">bi_nub_step</span>'; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">Hstep</span>'. <span class="id">right</span>. <span class="id">right</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>. <span class="id">erewrite</span> <span class="id"><a href="TSOSemLemmas.html#ub_step_buffer_eq">ub_step_buffer_eq</a></span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">Hstep</span>'. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#emp_fp_not_conflictc">emp_fp_not_conflictc</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="print_step_emp_fp">print_step_emp_fp</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc</span> <span class="id">v</span> <span class="id">fp</span> <span class="id">tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> (<span class="id"><a href="TSOGlobSem.html#evt">evt</a></span> <span class="id"><a href="TSOCompInvs.html#v">v</a></span>) <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> = <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10266')">Proof.</div>
<div class="proofscript" id="proof10266">
 <span class="tactic">clear</span>. <span class="tactic">inversion</span> 1; <span class="tactic">auto</span>. Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#print_step_emp_fp">print_step_emp_fp</a></span>. <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H</span>. <span class="tactic">intro</span>; <span class="tactic">subst</span> <span class="id">fp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="print_step_mem_eq">print_step_mem_eq</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc</span> <span class="id">v</span> <span class="id">tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> (<span class="id"><a href="TSOGlobSem.html#evt">evt</a></span> <span class="id"><a href="TSOCompInvs.html#v">v</a></span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) = (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">tpc</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10267')">Proof.</div>
<div class="proofscript" id="proof10267">
 <span class="tactic">clear</span>. <span class="tactic">inversion</span> 1; <span class="tactic">auto</span>. Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#buffer_forward_split_eq">buffer_forward_split_eq</a></span>. <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> &lt;-<span class="id">H0</span>, &lt;-<span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#print_step_mem_eq">print_step_mem_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">A</span> <span class="id">B</span>]; <span class="tactic">subst</span> <span class="id">head</span>' <span class="id">tail</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t0</span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHbi_not_unbuffered</span> <span class="id">_tpc0</span> <span class="id">_tail0</span> <span class="id">_tail0</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHbi_not_unbuffered</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="print_step_eq_thrdp_tm">print_step_eq_thrdp_tm</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc</span> <span class="id">v</span> <span class="id">tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> (<span class="id"><a href="TSOGlobSem.html#evt">evt</a></span> <span class="id"><a href="TSOCompInvs.html#v">v</a></span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">t</span>, <span class="id"><a href="TSOCompInvs.html#t">t</a></span> &lt;&gt; <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt; <span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm">eq_thrdp_tm</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id">tpc</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10268')">Proof.</div>
<div class="proofscript" id="proof10268">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span> <span class="id">TGE</span> <span class="id">tpc</span> <span class="id">v</span> <span class="id">tpc</span>' <span class="id">H</span> <span class="id">t</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm">eq_thrdp_tm</a></span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_upd</span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm_trans">eq_thrdp_tm_trans</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm_sym">eq_thrdp_tm_sym</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#print_step_eq_thrdp_tm">print_step_eq_thrdp_tm</a></span>; <span class="tactic">eauto</span>. <span class="tactic">congruence</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id">VALID</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#glob_step_valid">glob_step_valid</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id">HALTED</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#glob_step_halted">glob_step_halted</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="print_step_cid_eq">print_step_cid_eq</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc</span> <span class="id">v</span> <span class="id">tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> (<span class="id"><a href="TSOGlobSem.html#evt">evt</a></span> <span class="id"><a href="TSOCompInvs.html#v">v</a></span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc</span>' = <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10269')">Proof.</div>
<div class="proofscript" id="proof10269">
 <span class="tactic">clear</span>. <span class="tactic">inversion</span> 1; <span class="tactic">auto</span>. Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#print_step_cid_eq">print_step_cid_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm_print_step_sim">eq_thrdp_tm_print_step_sim</a></span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">EQ</span>; <span class="tactic">auto</span>. <span class="tactic">intros</span> (<span class="id">_tpc1</span> &amp; <span class="id">Hstep</span>' &amp; <span class="id">EQ</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">IHbi_not_unbuffered</span> <span class="id">_tpc1</span> <span class="id">_tail0</span> <span class="id">_tail0</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hbuffer</span>. <span class="tactic">symmetry</span>; <span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#print_step_mem_eq">print_step_mem_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">EQ</span>'. <span class="tactic">apply</span> <span class="id">EQ</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">eapply</span> <span class="id">glob_step_valid</span>'; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">VALID</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#glob_step_valid">glob_step_valid</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">eapply</span> <span class="id">glob_step_halted</span>'; <span class="tactic">eauto</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">HALTED</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#glob_step_halted">glob_step_halted</a></span>; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#print_step_cid_eq">print_step_cid_eq</a></span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H</span>. <span class="tactic">rewrite</span> <span class="id">EQcid</span>. <span class="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#print_step_cid_eq">print_step_cid_eq</a></span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">Hstep</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">_tail</span> &amp; <span class="id">_tpc</span> &amp; <span class="id">Hnub</span>' &amp; <span class="id">EQ</span>'').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">_tail</span>, <span class="id">_tpc</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">bi_nub_step</span>'; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">Hstep</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>. <span class="tactic">split</span>;[|<span class="tactic">eauto</span>]. <span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id">n</span>. <span class="tactic">rewrite</span> <span class="id">EQcid</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOCompInvs.html#print_step_mem_eq">print_step_mem_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#buf_forward_refl">buf_forward_refl</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#emp_fp_not_conflictc">emp_fp_not_conflictc</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id">PreviouslyInserted</span>' <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">TGE</span>: <span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.t">TSOGlobEnv.t</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">i_obj</span>: '<span class="id">I_</span>(<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.M">TSOGlobEnv.M</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">t</span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">bi</span>: <span class="id"><a href="TSOMem.html#buffer_item">buffer_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tpc0</span>: @<span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="TSOMem.html#buffer">buffer</a></span> -&gt; <span class="id"><a href="TSOMem.html#buffer">buffer</a></span> -&gt; @<span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> <span class="id">TGE</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id">PrevInserted</span>': <span class="kwd">forall</span> <span class="id">head</span> <span class="id">head</span>' <span class="id">tail</span>' <span class="id">l</span> <span class="id">fp</span> <span class="id">tpc1</span> <span class="id">headn</span> <span class="id">tailn</span> <span class="id">tpcn</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">tpc0</span>) <span class="id">t</span> = <span class="id"><a href="TSOCompInvs.html#head">head</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id">tpc0</span> <span class="id"><a href="TSOCompInvs.html#l">l</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id"><a href="TSOCompInvs.html#tpc1">tpc1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc1">tpc1</a></span>) <span class="id">t</span> = <span class="id"><a href="TSOCompInvs.html#head">head</a></span> ++ <span class="id">head</span>' ++ <span class="id">bi</span> :: <span class="id">tail</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOCompInvs.html#client_core">client_core</a></span> <span class="id">TGE</span> <span class="id">i_obj</span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc0</span>) <span class="id">tpc0</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="ClientSim.html#conflictc">conflictc</a></span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc0</span>) <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">tpc0</span>))) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bi_not_unbuffered</span>' <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">t</span> <span class="id">bi</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOCompInvs.html#head">head</a></span> ++ <span class="id">head</span>') <span class="id">tail</span>' <span class="id"><a href="TSOCompInvs.html#tpc1">tpc1</a></span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#headn">headn</a></span> <span class="id"><a href="TSOCompInvs.html#tailn">tailn</a></span> <span class="id"><a href="TSOCompInvs.html#tpcn">tpcn</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">PreviouslyInserted</span>' <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">t</span> <span class="id">bi</span> <span class="id">tpc0</span> <span class="id"><a href="TSOCompInvs.html#headn">headn</a></span> <span class="id"><a href="TSOCompInvs.html#tailn">tailn</a></span> <span class="id"><a href="TSOCompInvs.html#tpcn">tpcn</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="eq_thrdp_tm_eq_tso_client_step_fp">eq_thrdp_tm_eq_tso_client_step_fp</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">tpc</span> <span class="id">tpc</span>' <span class="id">fp</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> = <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> (<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>)) !! (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> (<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id">tpc</span>')) !! (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#memory">memory</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) = <span class="id"><a href="TSOMem.html#memory">memory</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">tpc</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) = <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">tpc</span>') (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#tso_client_step_fp">tso_client_step_fp</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#tso_client_step_fp">tso_client_step_fp</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id">tpc</span>' <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10270')">Proof.</div>
<div class="proofscript" id="proof10270">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H3</span>. <span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tpc</span>, <span class="id">tpc</span>'. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>, <span class="id">tm0</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H6</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">PreviouslyInserted_PreviouslyInserted</span>':<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">t0</span> <span class="id">bi</span> <span class="id">tpc0</span> <span class="id">head</span> <span class="id">tail</span> <span class="id">tpc</span> <span class="id">fp</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#t0">t0</a></span> &lt;&gt; <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#PreviouslyInserted">PreviouslyInserted</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#t0">t0</a></span> <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span> <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span> <span class="id"><a href="TSOCompInvs.html#head">head</a></span> <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#tso_client_step_fp">tso_client_step_fp</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">_head</span> <span class="id">_tail</span> <span class="id">_tpc</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">PreviouslyInserted</span>' <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#t0">t0</a></span> <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span> <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span>  <span class="id"><a href="TSOCompInvs.html#_head">_head</a></span> <span class="id"><a href="TSOCompInvs.html#_tail">_tail</a></span> <span class="id"><a href="TSOCompInvs.html#_tpc">_tpc</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#_tpc">_tpc</a></span> = <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#tso_client_step_fp">tso_client_step_fp</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#_tpc">_tpc</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10271')">Proof.</div>
<div class="proofscript" id="proof10271">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">t0</span> <span class="id">bi</span> <span class="id">tpc0</span> <span class="id">head</span> <span class="id">tail</span> <span class="id">tpc</span> <span class="id">fp</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Htid0</span> <span class="id">HPrevInserted</span> <span class="id">Hclientfp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">HPrevInserted</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">bi_not_unbuffered_bi_not_unbuffered</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H3</span>. <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_thrdp_tm_refl">eq_thrdp_tm_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">_tail</span> &amp; <span class="id">_tpc</span> &amp; <span class="id">Hbnub</span> &amp; <span class="id">EQ</span> &amp; <span class="id">EQcid</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">headn</span>, <span class="id">_tail</span>, <span class="id">_tpc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">auto</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">EQ</span> <span class="kwd">in</span> <span class="id">Htid0</span>. <span class="tactic">destruct</span> <span class="id">Htid0</span> <span class="kwd">as</span> [<span class="id">A</span> [<span class="id">B</span> [<span class="id">C</span> [<span class="id">D</span> <span class="id">E</span>]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#eq_thrdp_tm_eq_tso_client_step_fp">eq_thrdp_tm_eq_tso_client_step_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">symmetry</span>. <span class="tactic">exact</span> <span class="id">EQcid</span>. <span class="tactic">congruence</span>. <span class="tactic">auto</span>. <span class="tactic">congruence</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="non_conflicting_steps">non_conflicting_steps</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">TGE</span>: <span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.t">TSOGlobEnv.t</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">i_obj</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">t</span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: @<span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> <span class="id">TGE</span> -&gt; @<span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> <span class="id">TGE</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id"><a name="ncss_refl">ncss_refl</a></span>: <span class="kwd">forall</span> <span class="id">tpc</span>, <span class="id"><a href="TSOCompInvs.html#non_conflicting_steps">non_conflicting_steps</a></span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">t</span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a name="ncss_step">ncss_step</a></span>: <span class="kwd">forall</span> <span class="id">tpc</span> <span class="id">l</span> <span class="id">fp</span> <span class="id">tpc</span>' <span class="id">tpc</span>'', <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> &lt;&gt; <span class="id">t</span> /\ (<span class="id"><a href="TSOCompInvs.html#l">l</a></span> = <span class="id"><a href="TSOGlobSem.html#tau">tau</a></span> \/ <span class="id">exists</span> <span class="id">v</span>, <span class="id"><a href="TSOCompInvs.html#l">l</a></span> = <span class="id"><a href="TSOGlobSem.html#evt">evt</a></span> <span class="id"><a href="TSOCompInvs.html#v">v</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\/ <span class="id"><a href="TSOCompInvs.html#l">l</a></span> = <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> \/ <span class="id">exists</span> <span class="id">t</span>', <span class="id"><a href="TSOCompInvs.html#l">l</a></span> = <span class="id"><a href="TSOGlobSem.html#ub">ub</a></span> <span class="id">t</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOCompInvs.html#l">l</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOCompInvs.html#client_core">client_core</a></span> <span class="id">TGE</span> <span class="id">i_obj</span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="ClientSim.html#conflictc">conflictc</a></span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>))) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#non_conflicting_steps">non_conflicting_steps</a></span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">t</span> <span class="id">tpc</span>' <span class="id">tpc</span>'' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#non_conflicting_steps">non_conflicting_steps</a></span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">t</span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id">tpc</span>''.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bi_not_unbuffered</span>'<span class="id">_non_conflicting_steps</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">t</span> <span class="id">bi</span> <span class="id">head0</span> <span class="id">tail0</span> <span class="id">tpc0</span> <span class="id">headn</span> <span class="id">tailn</span> <span class="id">tpcn</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bi_not_unbuffered</span>' <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span> <span class="id"><a href="TSOCompInvs.html#head0">head0</a></span> <span class="id"><a href="TSOCompInvs.html#tail0">tail0</a></span> <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span> <span class="id"><a href="TSOCompInvs.html#headn">headn</a></span> <span class="id"><a href="TSOCompInvs.html#tailn">tailn</a></span> <span class="id"><a href="TSOCompInvs.html#tpcn">tpcn</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#non_conflicting_steps">non_conflicting_steps</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span> <span class="id"><a href="TSOCompInvs.html#tpcn">tpcn</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10272')">Proof.</div>
<div class="proofscript" id="proof10272">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">induction</span> <span class="id">H</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="app_tail_eq_nil">app_tail_eq_nil</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span> (<span class="id">l</span> <span class="id">tail</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="TSOCompInvs.html#A">A</a></span>), <span class="id"><a href="TSOCompInvs.html#l">l</a></span> = <span class="id"><a href="TSOCompInvs.html#l">l</a></span> ++ <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> -&gt; <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10273')">Proof.</div>
<div class="proofscript" id="proof10273">
 <span class="tactic">clear</span>. <span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">intros</span>; <span class="tactic">auto</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span>. Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="more_buffer_item_tau_step">more_buffer_item_tau_step</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc</span> <span class="id">l</span> <span class="id">fp</span> <span class="id">tpc</span>' <span class="id">tail</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOCompInvs.html#l">l</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">tpc</span>') <span class="id"><a href="TSOCompInvs.html#t">t</a></span> = <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) <span class="id"><a href="TSOCompInvs.html#t">t</a></span> ++ <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> &lt;&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#l">l</a></span> = <span class="id"><a href="TSOGlobSem.html#tau">tau</a></span> /\ <span class="id"><a href="TSOCompInvs.html#t">t</a></span> = <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10274')">Proof.</div>
<div class="proofscript" id="proof10274">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc</span>)); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#tau_step_buffer_eq">tau_step_buffer_eq</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>. <span class="tactic">apply</span> <span class="id">H1</span>. <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="TSOCompInvs.html#app_tail_eq_nil">app_tail_eq_nil</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exfalso</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="TSOCompInvs.html#app_tail_eq_nil">app_tail_eq_nil</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exfalso</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unbuffer">unbuffer</a></span> <span class="kwd">in</span> *. <span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t0</span>). <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span> <span class="id">t0</span>). <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span>; <span class="id">inv</span> <span class="id">H_unbuf</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> *. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>; [|<span class="id">contradiction</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H0</span>. <span class="tactic">clear</span>. <span class="id">revert</span> <span class="id">b</span> <span class="id">tail</span>. <span class="tactic">induction</span> <span class="id">b0</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H0</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span> <span class="id">t0</span>). <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span>; <span class="id">inv</span> <span class="id">H_unbuf</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> *. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>; [<span class="id">contradiction</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="TSOCompInvs.html#app_tail_eq_nil">app_tail_eq_nil</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exfalso</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="TSOCompInvs.html#app_tail_eq_nil">app_tail_eq_nil</a></span>. }<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">MS_client_core_client_fp</span>':<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">spc</span> <span class="id">tpc</span> <span class="id">fp</span> <span class="id">spc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#MS">MS</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#client_core">client_core</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobSemantics.html#glob_step">glob_step</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id"><a href="ETrace.html#tau">ETrace.tau</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">spc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">client_fp</span>' (<span class="id"><a href="GlobDefs.html#gm">gm</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span>) <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10275')">Proof.</div>
<div class="proofscript" id="proof10275">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">client_fp_client_fp</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_client_core_step_client_fp">MS_client_core_step_client_fp</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="buffer_append_conflict_bi_fp_conflict">buffer_append_conflict_bi_fp_conflict</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc</span> <span class="id">fp0</span> <span class="id">tpc</span>' <span class="id">head</span> <span class="id">tail</span> <span class="id">bi</span> <span class="id">fp</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOGlobSem.html#tau">tau</a></span> <span class="id"><a href="TSOCompInvs.html#fp0">fp0</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) = <span class="id"><a href="TSOCompInvs.html#head">head</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">tpc</span>') (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) = <span class="id"><a href="TSOCompInvs.html#head">head</a></span> ++ <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span> <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#conflict_bi">conflict_bi</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Footprint.html#FP.conflict">FP.conflict</a></span> <span class="id"><a href="TSOCompInvs.html#fp0">fp0</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10276')">Proof.</div>
<div class="proofscript" id="proof10276">
 <span class="tactic">clear</span>. <span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#conflict_bi_conflict_fp">conflict_bi_conflict_fp</a></span>; <span class="tactic">eauto</span>. <span class="tactic">congruence</span>. Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">PreviouslyInserted</span>'<span class="id">_conflict_client_core</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">t0</span> <span class="id">bi</span> <span class="id">tpc0</span> <span class="id">spc0</span> <span class="id">head</span> <span class="id">tail</span> <span class="id">tpc</span> <span class="id">fp</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#MS">MS</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#spc0">spc0</a></span> <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">PreviouslyInserted</span>' <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#t0">t0</a></span> <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span> <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span> <span class="id"><a href="TSOCompInvs.html#head">head</a></span> <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#t0">t0</a></span> &lt;&gt; <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#tso_client_step_fp">tso_client_step_fp</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#conflict_bi">conflict_bi</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#client_core">client_core</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span>) <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10277')">Proof.</div>
<div class="proofscript" id="proof10277">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">t0</span> <span class="id">bi</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">tpc0</span> <span class="id">spc0</span> <span class="id">head</span> <span class="id">tail</span> <span class="id">tpc</span> <span class="id">fp</span> <span class="id">MATCH0</span> <span class="id">PI0</span> <span class="id">Hcid</span> <span class="id">Hclientfp</span> <span class="id">Hconflict</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">PI0</span>. <span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#more_buffer_item_tau_step">more_buffer_item_tau_step</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">clear</span>. <span class="tactic">destruct</span> <span class="id">head</span>'; <span class="tactic">intro</span> <span class="id">C</span>; <span class="id">inv</span> <span class="id">C</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">Hl</span> <span class="id">Ht0</span>]; <span class="tactic">subst</span> <span class="id">l</span> <span class="id">t0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#MS_tau_step_fp_cases">MS_tau_step_fp_cases</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [(<span class="id">Result</span> &amp; <span class="id">_</span>) | (<span class="id">Hobject_core</span> &amp; <span class="id">fpS0</span> &amp; <span class="id">spc1</span> &amp; <span class="id">Hsstep0</span> &amp; <span class="id">MATCH1</span> &amp; <span class="id">Hobjfp</span>)]. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>. <span class="tactic">clear</span> <span class="id">Hobject_core</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">exists</span> <span class="id">spcn</span>, <span class="id"><a href="TSOCompInvs.html#MS">MS</a></span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id"><a href="TSOCompInvs.html#spcn">spcn</a></span> <span class="id">tpc</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.forward">GMem.forward</a></span> (<span class="id"><a href="GlobDefs.html#gm">gm</a></span> <span class="id">spc1</span>) (<span class="id"><a href="GlobDefs.html#gm">gm</a></span> <span class="id"><a href="TSOCompInvs.html#spcn">spcn</a></span>)) <span class="kwd">as</span> (<span class="id">spcn</span> &amp; <span class="id">MATCHn</span> &amp; <span class="id">Hforward</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">bi_not_unbuffered</span>'<span class="id">_non_conflicting_steps</span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Hsstep0</span> <span class="id">Hobjfp</span> <span class="id">bi</span> <span class="id">spc0</span> <span class="id">head</span> <span class="id">tail</span> <span class="id">MATCH0</span> <span class="id">Hcid</span> <span class="id">Hclientfp</span> <span class="id">Hconflict</span> <span class="id">head</span>' <span class="id">tail</span>' <span class="id">H0</span> <span class="id">H1</span> <span class="id">H2</span> <span class="id">fp0</span> <span class="id">fpS0</span> <span class="id">fp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H3</span> <span class="id">spc1</span> <span class="id">MATCH1</span>. <span class="tactic">induction</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>. <span class="tactic">split</span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="GMemory.html#GMem.forward_refl">GMem.forward_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [(<span class="id">Hcid</span> &amp; [<span class="id">Hl</span>| [<span class="id">v</span> <span class="id">Hl</span>]]) | [<span class="id">Hl</span> | [<span class="id">t</span>' <span class="id">Hl</span>]]]; <span class="tactic">subst</span> <span class="id">l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#MS_preserved_after_tau_step_if_not_conflicting_client_fp">MS_preserved_after_tau_step_if_not_conflicting_client_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">MATCH1</span>. <span class="tactic">exact</span> <span class="id">H0</span>. <span class="tactic">auto</span>. <span class="tactic">intros</span> (<span class="id">spc2</span> &amp; <span class="id">fpS1</span> &amp; <span class="id">Hsstep1</span> &amp; <span class="id">MATCH2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">IHnon_conflicting_steps</span>. <span class="tactic">exact</span> <span class="id">MATCH2</span>. <span class="tactic">intros</span> (<span class="id">spcn</span> &amp; <span class="id">MATCHn</span> &amp; <span class="id">Hforward</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#MS_src_tau_star_step_gmem_forward">MS_src_tau_star_step_gmem_forward</a></span>. <span class="tactic">exact</span> <span class="id">MATCH1</span>. <span class="tactic">eauto</span>. <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">spcn</span>. <span class="tactic">split</span>. <span class="tactic">auto</span>. <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="GMemory.html#GMem.forward_trans">GMem.forward_trans</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#MS_preserved_after_evt_step">MS_preserved_after_evt_step</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">spc2</span> &amp; <span class="id">Hsstep1</span> &amp; <span class="id">MATCH2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">IHnon_conflicting_steps</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">spcn</span> &amp; <span class="id">MATCHn</span> &amp; <span class="id">Hfoward</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">spcn</span>. <span class="tactic">split</span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="GMemory.html#GMem.forward_trans">GMem.forward_trans</a></span>, <span class="id"><a href="TSOCompInvs.html#MS_src_step_gmem_forward">MS_src_step_gmem_forward</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#sw_step_emp_fp">sw_step_emp_fp</a></span>. <span class="tactic">eauto</span>. <span class="tactic">intro</span>; <span class="tactic">subst</span> <span class="id">fp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#MS_preserved_after_sw">MS_preserved_after_sw</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">spc2</span> &amp; <span class="id">Hsstep1</span> &amp; <span class="id">MATCH2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">IHnon_conflicting_steps</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">spcn</span> &amp; <span class="id">MATCHn</span> &amp; <span class="id">Hfoward</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">spcn</span>. <span class="tactic">split</span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="GMemory.html#GMem.forward_trans">GMem.forward_trans</a></span>, <span class="id"><a href="TSOCompInvs.html#MS_src_step_gmem_forward">MS_src_step_gmem_forward</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#ub_step_emp_fp">ub_step_emp_fp</a></span>. <span class="tactic">eauto</span>. <span class="tactic">intro</span>; <span class="tactic">subst</span> <span class="id">fp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#MS_preserved_after_unbuffer">MS_preserved_after_unbuffer</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#MS_tso_client_step_fp_match">MS_tso_client_step_fp_match</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">MATCHn</span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">spc</span>' &amp; <span class="id">fpS</span> &amp; <span class="id">Hsstepn</span> &amp; <span class="id">Hfpmatchc</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#buffer_append_conflict_bi_fp_conflict">buffer_append_conflict_bi_fp_conflict</a></span>. <span class="tactic">exact</span> <span class="id">H0</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Coqlib.html#in_app">in_app</a></span>. <span class="id">right</span>. <span class="tactic">simpl</span>. <span class="id">left</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#fp_subset_conflict_full_conflict">fp_subset_conflict_full_conflict</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Footprint.html#FP.smile_conflict_compat">FP.smile_conflict_compat</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">obj_fp_forward_client_fp</span>'<span class="id">_smile</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_sep_obj_client_blocks">MS_sep_obj_client_blocks</a></span>. <span class="tactic">exact</span> <span class="id">MATCH0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_src_tau_star_step_gmem_forward">MS_src_tau_star_step_gmem_forward</a></span>. <span class="tactic">exact</span> <span class="id">MATCH0</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">MS_client_core_client_fp</span>'; <span class="tactic">eauto</span>. <span class="id">inv</span> <span class="id">Hclientfp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="tau_step_followed_by_unbuffer">tau_step_followed_by_unbuffer</a></span> {<span class="id">TGE</span>: <span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.t">TSOGlobEnv.t</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> -&gt; <span class="id"><a href="Footprint.html#FP.t">FP.t</a></span> -&gt; <span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="tau_step_with_nonempty_buffer">tau_step_with_nonempty_buffer</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tpc</span> <span class="id">fp</span> <span class="id">tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id">TGE</span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOGlobSem.html#tau">tau</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#tau_step_followed_by_unbuffer">tau_step_followed_by_unbuffer</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">tpc</span>'<br/>
&nbsp;&nbsp;| <span class="id"><a name="tau_step_followed_by_unbuffers">tau_step_followed_by_unbuffers</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tpc</span> <span class="id">fp</span> <span class="id">tpc</span>' <span class="id">tpc</span>'',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id">TGE</span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOGlobSem.html#tau">tau</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#ub_star">ub_star</a></span> <span class="id">TGE</span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) <span class="id">tpc</span>' <span class="id">tpc</span>'' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#tau_step_followed_by_unbuffer">tau_step_followed_by_unbuffer</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">tpc</span>''.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="MS_preserved_after_tau_ub_non_conflicting_client_step">MS_preserved_after_tau_ub_non_conflicting_client_step</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">spc</span> <span class="id">tpc</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#MS">MS</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tpc</span>' <span class="id">fp</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#tau_step_followed_by_unbuffer">tau_step_followed_by_unbuffer</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#client_core">client_core</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="ClientSim.html#conflictc">conflictc</a></span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">fpS</span> <span class="id">spc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GlobSemantics.html#glob_step">glob_step</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id"><a href="ETrace.html#tau">ETrace.tau</a></span> <span class="id"><a href="TSOCompInvs.html#fpS">fpS</a></span> <span class="id">spc</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#fpmatchc">fpmatchc</a></span> <span class="id"><a href="TSOCompInvs.html#fpS">fpS</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#MS">MS</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id">spc</span>' <span class="id">tpc</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10278')">Proof.</div>
<div class="proofscript" id="proof10278">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">spc</span> <span class="id">tpc</span> <span class="id">MATCH</span> <span class="id">tpc</span>' <span class="id">fp</span> <span class="id">H</span> <span class="id">Hclient</span> <span class="id">Hconflict</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#MS_preserved_after_tau_non_conflicting_client_step">MS_preserved_after_tau_non_conflicting_client_step</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#MS_preserved_after_tau_non_conflicting_client_step">MS_preserved_after_tau_non_conflicting_client_step</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">fpS</span> [<span class="id">spc</span>' [<span class="id">Hstep</span> [<span class="id">Hfp</span> <span class="id">MATCH</span>']]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span> <span class="id">_</span>, <span class="id">spc</span>'; <span class="tactic">split</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H1</span> <span class="id">MATCH</span>'. <span class="tactic">clear</span> <span class="id">H</span> <span class="id">H0</span> <span class="id">Hclient</span> <span class="id">Hconflict</span> <span class="id">Hstep</span> <span class="id">MATCH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> 1. <span class="tactic">auto</span>. <span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id">IHub_star</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_preserved_after_unbuffer">MS_preserved_after_unbuffer</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">eq_config_not_unbuffered</span>':<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">t0</span> <span class="id">tpc0</span> <span class="id">tpc0</span>' <span class="id">bi0</span> <span class="id">head0</span> <span class="id">tail0</span> <span class="id">tpcn</span> <span class="id">headn</span> <span class="id">tailn</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bi_not_unbuffered</span>' <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#t0">t0</a></span> <span class="id"><a href="TSOCompInvs.html#bi0">bi0</a></span> <span class="id"><a href="TSOCompInvs.html#head0">head0</a></span> <span class="id"><a href="TSOCompInvs.html#tail0">tail0</a></span> <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span> <span class="id"><a href="TSOCompInvs.html#headn">headn</a></span> <span class="id"><a href="TSOCompInvs.html#tailn">tailn</a></span> <span class="id"><a href="TSOCompInvs.html#tpcn">tpcn</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_config">eq_config</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span> <span class="id">tpc0</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">tpcn</span>', <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bi_not_unbuffered</span>' <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#t0">t0</a></span> <span class="id"><a href="TSOCompInvs.html#bi0">bi0</a></span> <span class="id"><a href="TSOCompInvs.html#head0">head0</a></span> <span class="id"><a href="TSOCompInvs.html#tail0">tail0</a></span> <span class="id">tpc0</span>' <span class="id"><a href="TSOCompInvs.html#headn">headn</a></span> <span class="id"><a href="TSOCompInvs.html#tailn">tailn</a></span> <span class="id">tpcn</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_config">eq_config</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#tpcn">tpcn</a></span> <span class="id">tpcn</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10279')">Proof.</div>
<div class="proofscript" id="proof10279">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">t0</span> <span class="id">tpc0</span> <span class="id">tpc0</span>' <span class="id">bi0</span> <span class="id">head0</span> <span class="id">tail0</span> <span class="id">tpcn</span> <span class="id">headn</span> <span class="id">tailn</span> <span class="id">Hbnu</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">tpc0</span>'. <span class="tactic">induction</span> <span class="id">Hbnu</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">tpc0</span>'. <span class="tactic">subst</span> <span class="id">tpc</span>. <span class="id">inv</span> <span class="id">H0</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>. <span class="tactic">split</span>. <span class="tactic">eapply</span> <span class="id">bi_nub_refl</span>'. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> ? <span class="id">Heq0</span>. <span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_eq_step">eq_config_eq_step</a></span>. <span class="tactic">exact</span> <span class="id">Heq0</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">tpc1</span>' [<span class="id">Hstep</span>' <span class="id">Heq1</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHHbnu</span> <span class="id">_</span> <span class="id">Heq1</span>). <span class="tactic">destruct</span> <span class="id">IHHbnu</span> <span class="kwd">as</span> [<span class="id">tpcn</span>' [<span class="id">Hbnu</span>' <span class="id">Heqn</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">tpcn</span>'. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="id">instantiate</span> (1:= <span class="id">l</span>). <span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOSemLemmas.html#eq_cid">eq_cid</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="id">inv</span> <span class="id">Heq0</span>; <span class="tactic">congruence</span>. <span class="id">inv</span> <span class="id">Heq1</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">eq_buffer</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>. <span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOSemLemmas.html#eq_cid">eq_cid</a></span>; <span class="tactic">eauto</span>. <span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOSemLemmas.html#eq_buffer">eq_buffer</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H4</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#eq_config_eq_client_core">eq_config_eq_client_core</a></span>; <span class="tactic">eauto</span>. <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_sym">eq_config_sym</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="eq_config_client_step_fp">eq_config_client_step_fp</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">tpc</span> <span class="id">tpc</span>' <span class="id">fp</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_config">eq_config</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#tso_client_step_fp">tso_client_step_fp</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#tso_client_step_fp">tso_client_step_fp</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id">tpc</span>' <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10280')">Proof.</div>
<div class="proofscript" id="proof10280">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">tpc</span> <span class="id">tpc</span>' <span class="id">fp</span> <span class="id">EQ</span> <span class="id">CLIENTFP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">CLIENTFP</span>. <span class="id">inv</span> <span class="id">EQ</span>. <span class="tactic">destruct</span> <span class="id">tpc</span>, <span class="id">tpc</span>'; <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOStepAuxLemmas.html#gmem_buffer_eq_corestep_eq">gmem_buffer_eq_corestep_eq</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">gm</span>' &amp; <span class="id">Hstep</span> &amp; <span class="id">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">eq_buffer</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="tau_ub_evt_reorder">tau_ub_evt_reorder</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> (<span class="id">tpc0</span> <span class="id">tpc1</span> <span class="id">tpc2</span> <span class="id">tpc3</span>: @<span class="id"><a href="TSOGlobSem.html#TSOProgConfig">TSOProgConfig</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FLWD</span>: <span class="id"><a href="GlobDefs.html#FLists.wd">FLists.wd</a></span> (<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.freelists">TSOGlobEnv.freelists</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INVTHDP1</span>: <span class="id"><a href="TSOSemLemmas.html#inv">inv</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span>.(<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fp0</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#tau_step_followed_by_unbuffer">tau_step_followed_by_unbuffer</a></span> <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span> <span class="id"><a href="TSOCompInvs.html#fp0">fp0</a></span> <span class="id"><a href="TSOCompInvs.html#tpc1">tpc1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#tpc1">tpc1</a></span> <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id"><a href="TSOCompInvs.html#tpc2">tpc2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#tpc2">tpc2</a></span> (<span class="id"><a href="TSOGlobSem.html#evt">evt</a></span> <span class="id"><a href="TSOCompInvs.html#v">v</a></span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id"><a href="TSOCompInvs.html#tpc3">tpc3</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span> &lt;&gt; <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc2">tpc2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">_tpc2</span> <span class="id">_tpc2</span>' <span class="id">_tpc0</span> <span class="id">_tpc0</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span> <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id"><a href="TSOCompInvs.html#_tpc2">_tpc2</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#_tpc2">_tpc2</a></span> = <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc2">tpc2</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#_tpc2">_tpc2</a></span> (<span class="id"><a href="TSOGlobSem.html#evt">evt</a></span> <span class="id"><a href="TSOCompInvs.html#v">v</a></span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">_tpc2</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id">_tpc2</span>' <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id"><a href="TSOCompInvs.html#_tpc0">_tpc0</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#_tpc0">_tpc0</a></span> = <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#tau_step_followed_by_unbuffer">tau_step_followed_by_unbuffer</a></span> <span class="id"><a href="TSOCompInvs.html#_tpc0">_tpc0</a></span> <span class="id"><a href="TSOCompInvs.html#fp0">fp0</a></span> <span class="id">_tpc0</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid">eq_config_but_cid</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#tpc3">tpc3</a></span> <span class="id">_tpc0</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10281')">Proof.</div>
<div class="proofscript" id="proof10281">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span> <span class="id">TGE</span> <span class="id">tpc0</span> <span class="id">tpc1</span> <span class="id">tpc2</span> <span class="id">tpc3</span> <span class="id">FLWD</span> <span class="id">INVTHDP1</span> <span class="id">fp0</span> <span class="id">v</span> <span class="id">Htau_ub</span> <span class="id">Hsw</span> <span class="id">Hevt</span> <span class="id">Hcid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htau_ub</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exploit</span> <span class="id">diff_thrd_normal_step_reorder</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1:= <span class="id"><a href="TSOGlobSem.html#tau">tau</a></span>). <span class="tactic">simpl</span>. <span class="tactic">auto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#tau_step_cid_eq">tau_step_cid_eq</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1:= <span class="id"><a href="TSOGlobSem.html#evt">evt</a></span> <span class="id">v</span>). <span class="tactic">simpl</span>. <span class="tactic">auto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="RGRels.html#smile_emp_fp">smile_emp_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">_tpc2</span> &amp; <span class="id">_tpc2</span>' &amp; <span class="id">_tpc1</span> &amp; <span class="id">_tpc1</span>' &amp; <span class="id">Hswto2</span> &amp; <span class="id">Hcid2</span> &amp; <span class="id">Hevt2</span> &amp; <span class="id">Hswto1</span> &amp; <span class="id">Hcid1</span> &amp; <span class="id">Htau1</span> &amp; <span class="id">Heq</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">_tpc2</span>, <span class="id">_tpc2</span>', <span class="id">_tpc1</span>, <span class="id">_tpc1</span>'. <span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">auto</span>). <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#tau_step_with_nonempty_buffer">tau_step_with_nonempty_buffer</a></span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#ub_star_evt_reorder">ub_star_evt_reorder</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">_tpc2</span> &amp; <span class="id">tpc2</span>' &amp; <span class="id">_tpcub</span> &amp; <span class="id">Hsw</span>' &amp; <span class="id">Hcid2</span> &amp; <span class="id">Hevt</span>' &amp; <span class="id">Hubstar</span>' &amp; <span class="id">Heq</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">diff_thrd_normal_step_reorder</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1:= <span class="id"><a href="TSOGlobSem.html#tau">tau</a></span>). <span class="tactic">simpl</span>. <span class="tactic">auto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hcid2</span> <span class="kwd">in</span> <span class="id">Hcid</span>. <span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#tau_step_cid_eq">tau_step_cid_eq</a></span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">Hcid</span>. <span class="tactic">eauto</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1:= <span class="id"><a href="TSOGlobSem.html#evt">evt</a></span> <span class="id">v</span>). <span class="tactic">simpl</span>. <span class="tactic">auto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="RGRels.html#smile_emp_fp">smile_emp_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (? &amp; ? &amp; ? &amp; ? &amp; <span class="id">Hsw</span>'' &amp; <span class="id">Hcid</span>'' &amp; <span class="id">Hevt</span>'' &amp; <span class="id">Hsw</span>''' &amp; <span class="id">Hcid</span>''' &amp; <span class="id">Htau1</span>'' &amp; <span class="id">Heq</span>'').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">x</span>, <span class="id">x0</span>, <span class="id">x1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_ub_star">eq_config_but_cid_ub_star</a></span>. <span class="tactic">exact</span> <span class="id">Heq</span>''. <span class="tactic">eauto</span>. <span class="tactic">intros</span> (? &amp; <span class="id">Hubstar</span>'' &amp; <span class="id">Heq</span>''').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>. <span class="tactic">do</span> 2 (<span class="tactic">split</span>; <span class="tactic">auto</span>). <span class="tactic">congruence</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#tau_step_followed_by_unbuffers">tau_step_followed_by_unbuffers</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hcid</span>'''. <span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#sw_step_buffer_eq">sw_step_buffer_eq</a></span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">Hsw</span>'''.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hevt</span>''. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">subst</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#sw_step_buffer_eq">sw_step_buffer_eq</a></span> <span class="kwd">in</span> <span class="id">Hsw</span>''. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">Hsw</span>''. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">Hcid</span>'''. <span class="tactic">eauto</span>. <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_trans">eq_config_but_cid_trans</a></span>. }<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="tau_ub_step_non_emp_fp_sw">tau_ub_step_non_emp_fp_sw</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc</span> <span class="id">fp</span> <span class="id">tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> &lt;&gt; <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.valid_tid">TSOThrdPool.valid_tid</a></span> (<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id">tpc</span>') (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOCompInvs.html#tau_step_followed_by_unbuffer">tau_step_followed_by_unbuffer</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id">tpc</span>' <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">tpc</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10282')">Proof.</div>
<div class="proofscript" id="proof10282">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="id">inv</span> <span class="id">H1</span>. <span class="id">inv</span> <span class="id">H_tp_upd</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="id">inv</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tpc</span>'. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#ub_star_thdp_cid_unchg">ub_star_thdp_cid_unchg</a></span> <span class="kwd">in</span> <span class="id">H4</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H3</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">auto</span>. <span class="tactic">destruct</span> <span class="id">H4</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="id">inv</span> <span class="id">H1</span>. <span class="id">inv</span> <span class="id">H_tp_upd</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="id">inv</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="tau_ub_unbuffer_reorder">tau_ub_unbuffer_reorder</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc0</span> <span class="id">fp0</span> <span class="id">tpc1</span> <span class="id">t</span> <span class="id">tpc2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FLISTWD</span>:   <span class="id"><a href="GlobDefs.html#FLists.wd">FLists.wd</a></span> (<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.freelists">TSOGlobEnv.freelists</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INVTHDP1</span>: <span class="id"><a href="TSOSemLemmas.html#inv">inv</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span>.(<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">LALLOC</span>:<span class="id"><a href="TSOCompInvs.html#thread_buffered_alloc_local">thread_buffered_alloc_local</a></span> (<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.freelists">TSOGlobEnv.freelists</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span>)(<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOStepAuxLemmas.html#FLs_embed">FLs_embed</a></span> (<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.freelists">TSOGlobEnv.freelists</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span>) (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#tau_step_followed_by_unbuffer">tau_step_followed_by_unbuffer</a></span> <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span> <span class="id"><a href="TSOCompInvs.html#fp0">fp0</a></span> <span class="id"><a href="TSOCompInvs.html#tpc1">tpc1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#tpc1">tpc1</a></span> (<span class="id"><a href="TSOGlobSem.html#ub">ub</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id"><a href="TSOCompInvs.html#tpc2">tpc2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="ClientSim.html#conflictc">conflictc</a></span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span>) <span class="id"><a href="TSOCompInvs.html#fp0">fp0</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">_tpc0</span> <span class="id">_tpc1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#ub_star">ub_star</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span> <span class="id"><a href="TSOCompInvs.html#_tpc0">_tpc0</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#tau_step_followed_by_unbuffer">tau_step_followed_by_unbuffer</a></span> <span class="id"><a href="TSOCompInvs.html#_tpc0">_tpc0</a></span> <span class="id"><a href="TSOCompInvs.html#fp0">fp0</a></span> <span class="id"><a href="TSOCompInvs.html#_tpc1">_tpc1</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid">eq_config_but_cid</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#_tpc1">_tpc1</a></span> <span class="id"><a href="TSOCompInvs.html#tpc2">tpc2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10283')">Proof.</div>
<div class="proofscript" id="proof10283">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span> <span class="id">TGE</span> <span class="id">tpc0</span> <span class="id">fp0</span> <span class="id">tpc1</span> <span class="id">t</span> <span class="id">tpc2</span> <span class="id">FLISTWD</span> <span class="id">INVTHDP1</span> <span class="id">LALLOC</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hfls</span> <span class="id">Htau_ub</span> <span class="id">Hub</span> <span class="id">Hconflict0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc0</span>)).<br/>
&nbsp;ub&nbsp;same&nbsp;thread&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">subst</span> <span class="id">t</span>. <span class="tactic">destruct</span> <span class="id">Htau_ub</span>.<br/>
&nbsp;tau&nbsp;case&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">tpc</span>) (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc</span>)) <span class="id">eqn</span>:<span class="id">Hbuffer0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exists</span> <span class="id">tpc</span>, <span class="id">tpc2</span>. <span class="tactic">split</span>. <span class="id">constructor</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#tau_step_followed_by_unbuffers">tau_step_followed_by_unbuffers</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#ub_star_cons">ub_star_cons</a></span>. <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#ub_star_refl">ub_star_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_refl">eq_config_but_cid_refl</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#same_thrd_normal_unbuffer_step_reorder">same_thrd_normal_unbuffer_step_reorder</a></span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>. <span class="tactic">rewrite</span> <span class="id">Hbuffer0</span>. <span class="tactic">discriminate</span>. <span class="tactic">simpl</span>. <span class="tactic">auto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">_tpc0</span> &amp; <span class="id">Hub</span>' &amp; <span class="id">Htau</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">_tpc0</span>, <span class="id">tpc2</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#ub_star_cons">ub_star_cons</a></span>. <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#ub_star_refl">ub_star_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#tau_step_with_nonempty_buffer">tau_step_with_nonempty_buffer</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_refl">eq_config_but_cid_refl</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;tau&nbsp;with&nbsp;ub&nbsp;case&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exists</span> <span class="id">tpc</span>, <span class="id">tpc2</span>. <span class="tactic">split</span>. <span class="id">constructor</span>. <span class="tactic">split</span>; [|<span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_refl">eq_config_but_cid_refl</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#tau_step_followed_by_unbuffers">tau_step_followed_by_unbuffers</a></span>. <span class="tactic">auto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H1</span> <span class="id">Hub</span>. <span class="tactic">clear</span>. <span class="tactic">induction</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#ub_star_cons">ub_star_cons</a></span>. <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#ub_star_refl">ub_star_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#ub_star_cons">ub_star_cons</a></span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;ub&nbsp;different&nbsp;thread&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">Htau_ub</span>.<br/>
&nbsp;tau&nbsp;case&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exploit</span> <span class="id">diff_thrd_normal_unbuffer_step_reorder</span>'; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>. <span class="tactic">auto</span>.  <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span>(1:=<span class="id">t</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#thread_buffered_alloc_local_buffer_local_alloc">thread_buffered_alloc_local_buffer_local_alloc</a></span> <span class="kwd">with</span>(<span class="id">t</span>:=<span class="id">t</span>) <span class="kwd">in</span> <span class="id">LALLOC</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#buffer_local_alloc_preserve">buffer_local_alloc_preserve</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">auto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">_tpc0</span> &amp; <span class="id">_tpc2</span> &amp; <span class="id">Hub</span>' &amp; <span class="id">Hstep</span>' &amp; <span class="id">Heq2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">_tpc0</span>, <span class="id">_tpc2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#tau_step_with_nonempty_buffer">tau_step_with_nonempty_buffer</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_eq_config_but_cid">eq_config_eq_config_but_cid</a></span>; <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_sym">eq_config_sym</a></span>. }<br/>
&nbsp;tau&nbsp;and&nbsp;ub&nbsp;case&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#ub_star_ub_step_reorder">ub_star_ub_step_reorder</a></span>. <span class="tactic">exact</span> <span class="id">H1</span>. <span class="tactic">exact</span> <span class="id">Hub</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#non_conflicting_tau_step_buffer_fp_smile">non_conflicting_tau_step_buffer_fp_smile</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">_tpc2</span> &amp; <span class="id">_tpc3</span> &amp; <span class="id">Hub</span>' &amp; <span class="id">Hubstar</span>' &amp; <span class="id">Heq</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">diff_thrd_normal_unbuffer_step_reorder</span>'; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#thread_buffered_alloc_local_buffer_local_alloc">thread_buffered_alloc_local_buffer_local_alloc</a></span> <span class="kwd">with</span>(<span class="id">t</span>:=<span class="id">t</span>) <span class="kwd">in</span> <span class="id">LALLOC</span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#buffer_local_alloc_preserve">buffer_local_alloc_preserve</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">_tpc0</span> &amp; <span class="id">_tpc1</span> &amp; <span class="id">Hub</span>'' &amp; <span class="id">Htau</span>' &amp; <span class="id">Heq</span>'').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_eq_ub_star">eq_config_eq_ub_star</a></span>. <span class="tactic">exact</span> <span class="id">Heq</span>''. <span class="tactic">exact</span> <span class="id">Hubstar</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">_tpc2</span>' &amp; <span class="id">Hubstar</span>'' &amp; <span class="id">Heq</span>''').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">_tpc0</span>, <span class="id">_tpc2</span>'. <span class="tactic">split</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#tau_step_followed_by_unbuffers">tau_step_followed_by_unbuffers</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOSemLemmas.html#ub_step_buffer_eq">ub_step_buffer_eq</a></span>. <span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#ub_step_cid_eq">ub_step_cid_eq</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#ub_step_cid_eq">ub_step_cid_eq</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#ub_step_cid_eq">ub_step_cid_eq</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_eq_config_but_cid">eq_config_eq_config_but_cid</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_trans">eq_config_trans</a></span>. <span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_sym">eq_config_sym</a></span>. <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_sym">eq_config_sym</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">PreviouslyInserted</span>'<span class="id">_adjacent_conflicting_step</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">t0</span> <span class="id">bi</span> <span class="id">tpc0</span> <span class="id">spc0</span> <span class="id">head</span> <span class="id">tail</span> <span class="id">tpc</span> <span class="id">fp</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#MS">MS</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#spc0">spc0</a></span> <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">PreviouslyInserted</span>' <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#t0">t0</a></span> <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span> <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span> <span class="id"><a href="TSOCompInvs.html#head">head</a></span> <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#t0">t0</a></span> &lt;&gt; <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#tso_client_step_fp">tso_client_step_fp</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#conflict_bi">conflict_bi</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">spc0</span>' <span class="id">tpc0</span>' <span class="id">fp0</span> <span class="id">tpc0</span>'' <span class="id">tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#MS">MS</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id">spc0</span>' <span class="id">tpc0</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#t0">t0</a></span> = <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc0</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#client_core">client_core</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc0</span>') <span class="id">tpc0</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="ClientSim.html#conflictc">conflictc</a></span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc0</span>') <span class="id"><a href="TSOCompInvs.html#fp0">fp0</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">tpc0</span>')) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#tau_step_followed_by_unbuffer">tau_step_followed_by_unbuffer</a></span> <span class="id">tpc0</span>' <span class="id"><a href="TSOCompInvs.html#fp0">fp0</a></span> <span class="id">tpc0</span>'' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id">tpc0</span>'' <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">tpc</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc</span>' = <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#tso_client_step_fp">tso_client_step_fp</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id">tpc</span>' <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Footprint.html#FP.conflict">FP.conflict</a></span> <span class="id"><a href="TSOCompInvs.html#fp0">fp0</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10284')">Proof.</div>
<div class="proofscript" id="proof10284">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">t0</span> <span class="id">bi</span> <span class="id">tpc0</span> <span class="id">spc0</span> <span class="id">head</span> <span class="id">tail</span> <span class="id">tpc</span> <span class="id">fp</span> <span class="id">MATCH0</span> <span class="id">PI0</span> <span class="id">Hcidn</span> <span class="id">Hfp</span> <span class="id">Hconflict</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">PreviouslyInserted</span>'<span class="id">_conflict_client_core</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">PI0</span> <span class="kwd">as</span> [? ? ? ? ? ? ? ? ? <span class="id">Hbuffer0</span> <span class="id">Hstep0</span> <span class="id">Hbuffer1</span> <span class="id">Hconflict0</span> <span class="id">H</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#buffer_insert_cid_label">buffer_insert_cid_label</a></span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">Hstep0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hbuffer0</span>. <span class="tactic">eauto</span>. <span class="tactic">destruct</span> <span class="id">head</span>'; <span class="tactic">intro</span> <span class="id">C</span>; <span class="id">inv</span> <span class="id">C</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">Ht0</span> <span class="id">Hl</span>]; <span class="tactic">subst</span> <span class="id">l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;exploit&nbsp;buffer_append_insert_buffer_fp.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;exact&nbsp;Hstep0.&nbsp;rewrite&nbsp;&lt;-&nbsp;Ht0.&nbsp;exact&nbsp;Hbuffer0.&nbsp;rewrite&nbsp;&lt;-&nbsp;Ht0.&nbsp;eauto.&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;head';&nbsp;simpl;&nbsp;intro&nbsp;C;&nbsp;inv&nbsp;C.&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#conflict_bi_conflict_fp">conflict_bi_conflict_fp</a></span>; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">t0</span>. <span class="tactic">rewrite</span> <span class="id">Hbuffer0</span>. <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span>. <span class="id">right</span>. <span class="tactic">simpl</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Hconflict</span>. <span class="tactic">intros</span> <span class="id">Hconflict</span> <span class="id">Hclient0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hconflict0</span> <span class="id">Hclient0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> (@<span class="id"><a href="TSOCompInvs.html#tau_step_with_nonempty_buffer">tau_step_with_nonempty_buffer</a></span> <span class="id">TGE</span>). <span class="tactic">exact</span> <span class="id">Hstep0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Hstep0</span>. <span class="tactic">clear</span> <span class="id">Hbuffer0</span> <span class="id">Hbuffer1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">bi_not_unbuffered</span>'<span class="id">_non_conflicting_steps</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">bi</span> <span class="id">head</span> <span class="id">head</span>' <span class="id">tail</span>' <span class="id">headn</span> <span class="id">tailn</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">H</span> <span class="id">Htau_ub</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#tau_ub_step_non_emp_fp_sw">tau_ub_step_non_emp_fp_sw</a></span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">Htau_ub</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="Footprint.html#FP.emp_never_conflict">FP.emp_never_conflict</a></span>. <span class="tactic">eauto</span>. <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">revert</span> <span class="id">MATCH0</span> <span class="id">Htau_ub</span>. <span class="tactic">clear</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#tid_eq">tid_eq</a></span>. <span class="tactic">eauto</span>. <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span> <span class="kwd">in</span> <span class="id">MATCH0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.valid_tid">TSOThrdPool.valid_tid</a></span> (<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id">tpc0</span>) (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.valid_tid">TSOThrdPool.valid_tid</a></span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOCompInvs.html#valid_tid_eq">valid_tid_eq</a></span>; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">exists</span> <span class="id">tpc</span>', <span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id">tpc0</span> <span class="id"><a href="TSOGlobSem.html#tau">tau</a></span> <span class="id">fp0</span> <span class="id">tpc</span>') <span class="tactic">by</span> (<span class="id">inv</span> <span class="id">Htau_ub</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">tpc1</span> <span class="id">Htau_ub</span>. <span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">tpc1</span> <span class="id">Htau</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">exists</span> <span class="id">tcs</span>, (<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> (<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id">tpc0</span>)) !! (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc0</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="TSOCompInvs.html#tcs">tcs</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> [<span class="id">tcs</span> <span class="id">Htp</span>] <span class="tactic">by</span> (<span class="id">inv</span> <span class="id">Htau</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Htau</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H</span> <span class="kwd">in</span> <span class="id">Htp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thread_simulation">thread_simulation</a></span>. <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">Htp</span>. <span class="tactic">intro</span> <span class="id">A</span>; <span class="id">inv</span> <span class="id">A</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#tp_inv_src">tp_inv_src</a></span> <span class="kwd">in</span> <span class="id">MATCH0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#plt">plt</a></span> (<span class="id"><a href="GlobDefs.html#cur_tid">cur_tid</a></span> <span class="id">spc0</span>) (<span class="id"><a href="GlobDefs.html#ThreadPool.next_tid">ThreadPool.next_tid</a></span> (<span class="id"><a href="GlobDefs.html#thread_pool">thread_pool</a></span> <span class="id">spc0</span>))); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="GlobDefs.html#ThreadPool.tp_finite">ThreadPool.tp_finite</a></span> <span class="kwd">in</span> <span class="id">n</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="tso_globstep_valid_tid">tso_globstep_valid_tid</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc</span> <span class="id">l</span> <span class="id">fp</span> <span class="id">tpc</span>' <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOCompInvs.html#l">l</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.valid_tid">TSOThrdPool.valid_tid</a></span> (<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) <span class="id"><a href="TSOCompInvs.html#t">t</a></span> &lt;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.valid_tid">TSOThrdPool.valid_tid</a></span> (<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id">tpc</span>') <span class="id"><a href="TSOCompInvs.html#t">t</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10285')">Proof.</div>
<div class="proofscript" id="proof10285">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">inversion</span> 1; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">subst</span>; <span class="tactic">try</span> <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_upd</span>; <span class="tactic">simpl</span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.push">TSOThrdPool.push</a></span> <span class="kwd">in</span> <span class="id">H_tp_push</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> ((<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>) !! <span class="id">t0</span>); <span class="id">inv</span> <span class="id">H_tp_push</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_upd</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="kwd">in</span> <span class="id">H_tp_pop</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> ((<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>) !! <span class="id">t0</span>); <span class="id">inv</span> <span class="id">H_tp_pop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>; <span class="id">inv</span> <span class="id">H2</span>. <span class="tactic">simpl</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="kwd">in</span> <span class="id">H_tp_pop</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> ((<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> <span class="id">thdp</span>) !! <span class="id">t0</span>); <span class="id">inv</span> <span class="id">H_tp_pop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>; <span class="id">inv</span> <span class="id">H1</span>. <span class="tactic">simpl</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_upd</span>; <span class="tactic">simpl</span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Htau_ub</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="TSOCompInvs.html#tso_globstep_valid_tid">tso_globstep_valid_tid</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#tau_step_cid_eq">tau_step_cid_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#ub_star_thdp_cid_unchg">ub_star_thdp_cid_unchg</a></span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="tactic">destruct</span> <span class="id">H3</span>. <span class="tactic">rewrite</span> <span class="id">H3</span>, <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="TSOCompInvs.html#tso_globstep_valid_tid">tso_globstep_valid_tid</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#tau_step_cid_eq">tau_step_cid_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hsw</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">exists</span> <span class="id">tpc00</span>, <span class="id"><a href="TSOCompInvs.html#tau_step_followed_by_unbuffer">tau_step_followed_by_unbuffer</a></span> <span class="id">tpc0</span> <span class="id">fp0</span> <span class="id"><a href="TSOCompInvs.html#tpc00">tpc00</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid">eq_config_but_cid</a></span> <span class="id">TGE</span> <span class="id">tpc1</span> <span class="id"><a href="TSOCompInvs.html#tpc00">tpc00</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> (<span class="id">tpc00</span> &amp; <span class="id">Htau_ub</span>' &amp; <span class="id">Heq2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eexists</span>. <span class="tactic">split</span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_refl">eq_config_but_cid_refl</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Htau_ub</span> <span class="id">Hsw</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">Htau_ub</span>' <span class="id">into</span> <span class="id">Htau_ub</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">tpc1</span> <span class="id">into</span> <span class="id">tpc2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">tpc00</span> <span class="id">into</span> <span class="id">tpc1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">exists</span> <span class="id">spc0</span>' <span class="id">tpc0</span>' <span class="id">tpc0</span>'' <span class="id">tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#MS">MS</a></span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">spc0</span>' <span class="id">tpc0</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">t0</span> = <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc0</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#client_core">client_core</a></span> <span class="id">TGE</span> <span class="id">i_obj</span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc0</span>') <span class="id">tpc0</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="ClientSim.html#conflictc">conflictc</a></span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc0</span>') <span class="id">fp0</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">tpc0</span>')) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#tau_step_followed_by_unbuffer">tau_step_followed_by_unbuffer</a></span> <span class="id">tpc0</span>' <span class="id">fp0</span> <span class="id">tpc0</span>'' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id">tpc0</span>'' <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">tpc</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_config">eq_config</a></span> <span class="id">TGE</span> <span class="id">tpcn</span> <span class="id">tpc</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> (<span class="id">spc0</span>' &amp; <span class="id">tpc0</span>' &amp; <span class="id">tpc0</span>'' &amp; <span class="id">tpc</span>' &amp; <span class="id">MATCH0</span>' &amp; <span class="id">Ht0</span>' &amp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hclient0</span>' &amp; <span class="id">Hconflict0</span>' &amp; <span class="id">Hstep0</span>' &amp; <span class="id">Hsw</span>' &amp; <span class="id">Heq</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="TSOSemLemmas.html#switchable">switchable</a></span> <span class="id">tpcn</span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpcn</span>)) <span class="kwd">as</span> <span class="id">Hswable</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">revert</span> <span class="id">MATCH0</span> <span class="id">H</span> <span class="id">Htau_ub</span> <span class="id">Heq2</span> <span class="id">Hfp</span>. <span class="tactic">clear</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#switchable">switchable</a></span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> ((<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> (<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id">tpcn</span>)) !! (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpcn</span>) &lt;&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">Hfp</span>. <span class="tactic">rewrite</span> <span class="id">H0</span>. <span class="tactic">discriminate</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Hfp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> ((<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> (<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id">tpc2</span>)) !! (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpcn</span>) &lt;&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ (<span class="id"><a href="TSOSemLemmas.html#thrd_valid">thrd_valid</a></span> <span class="id">tpc2</span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpcn</span>) -&gt; <span class="id"><a href="TSOSemLemmas.html#thrd_valid">thrd_valid</a></span> <span class="id">tpcn</span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpcn</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">revert</span> <span class="id">H</span> <span class="id">H0</span>. <span class="tactic">clear</span>. <span class="tactic">generalize</span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpcn</span>). <span class="tactic">induction</span> 1; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHnon_conflicting_steps</span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="tactic">clear</span> <span class="id">IHnon_conflicting_steps</span> <span class="id">H2</span> <span class="id">H1</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H3</span> <span class="kwd">as</span> [<span class="id">H3</span> <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">glob_step_cs_not_none</span>':<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc</span> <span class="id">l</span> <span class="id">fp</span> <span class="id">tpc</span>' <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOCompInvs.html#l">l</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> (<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id">tpc</span>')) !! <span class="id"><a href="TSOCompInvs.html#t">t</a></span> &lt;&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> (<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>)) !! <span class="id"><a href="TSOCompInvs.html#t">t</a></span> &lt;&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10286')">Proof.</div>
<div class="proofscript" id="proof10286">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_upd</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t0</span>). <span class="tactic">subst</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.push">TSOThrdPool.push</a></span> <span class="kwd">in</span> <span class="id">H_tp_push</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t0</span>). <span class="tactic">subst</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">H_tp_push</span>. <span class="id">inv</span> <span class="id">H_tp_push</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="kwd">in</span> <span class="id">H_tp_pop</span>. <span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">H_tp_pop</span>. <span class="id">inv</span> <span class="id">H_tp_pop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t0</span>). <span class="tactic">subst</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_upd</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.pop">TSOThrdPool.pop</a></span> <span class="kwd">in</span> <span class="id">H_tp_pop</span>. <span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">H_tp_pop</span>. <span class="id">inv</span> <span class="id">H_tp_pop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t0</span>). <span class="tactic">subst</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H_tp_upd</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t0</span>). <span class="tactic">subst</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">glob_step_cs_not_none</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">eapply</span> <span class="id">glob_step_valid</span>' <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">eauto</span>. <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H0</span>. <span class="tactic">destruct</span> <span class="id">H1</span>. <span class="tactic">apply</span> <span class="id">H1</span>. <span class="tactic">clear</span> <span class="id">H1</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">cut</span> (<span class="id"><a href="TSOSemLemmas.html#thrd_valid">thrd_valid</a></span> <span class="id">tpc1</span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpcn</span>)). <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Heq2</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#thrd_valid">thrd_valid</a></span> <span class="kwd">in</span> *. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id">eq_thrdpool</span>' <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">eauto</span>. <span class="tactic">clear</span> <span class="id">Heq2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htau_ub</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="MS_tp_not_none_valid">MS_tp_not_none_valid</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">spc</span> <span class="id">tpc</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#MS">MS</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> (<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>)) !! <span class="id"><a href="TSOCompInvs.html#t">t</a></span> &lt;&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#thrd_valid">thrd_valid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10287')">Proof.</div>
<div class="proofscript" id="proof10287">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#valid_tid_eq">valid_tid_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thread_simulation">thread_simulation</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1:= <span class="id">t</span>). <span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H1</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H5</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#thrd_valid">thrd_valid</a></span>, <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.valid_tid">TSOThrdPool.valid_tid</a></span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#plt">plt</a></span> <span class="id">t</span> (<span class="id"><a href="GlobDefs.html#ThreadPool.next_tid">ThreadPool.next_tid</a></span> (<span class="id"><a href="GlobDefs.html#thread_pool">thread_pool</a></span> <span class="id">spc</span>))); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#ThreadPool.tp_finite">ThreadPool.tp_finite</a></span> <span class="kwd">in</span> <span class="id">n</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span> <span class="kwd">in</span> *. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">glob_step_valid</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_tp_not_none_valid">MS_tp_not_none_valid</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">glob_step_cs_not_none</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#ub_star_thdp_cid_unchg">ub_star_thdp_cid_unchg</a></span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="tactic">destruct</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#thrd_valid">thrd_valid</a></span>. <span class="tactic">rewrite</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">glob_step_valid</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_tp_not_none_valid">MS_tp_not_none_valid</a></span>. <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">glob_step_cs_not_none</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#thrd_not_halted">thrd_not_halted</a></span>. <span class="tactic">intro</span>. <span class="id">inv</span> <span class="id">H0</span>. <span class="id">inv</span> <span class="id">Hfp</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">fp</span> <span class="id">Hfp</span> <span class="id">Hconflict</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">tpc0</span> <span class="id">spc0</span> <span class="id">fp0</span> <span class="id">tpc1</span> <span class="id">MATCH0</span> <span class="id">Htau_ub</span> <span class="id">Heq2</span> <span class="id">Ht0</span> <span class="id">Hclient0</span> <span class="id">Hconflict0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="switchable_sw_step">switchable_sw_step</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#switchable">switchable</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">tpc</span>', @<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">tpc</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid">eq_config_but_cid</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id">tpc</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc</span>' = <span class="id"><a href="TSOCompInvs.html#t">t</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10288')">Proof.</div>
<div class="proofscript" id="proof10288">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">tpc</span>. <span class="id">eexists</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="id">constructor</span>; <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="GMemory.html#GMem.eq_refl">GMem.eq_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="switchable_eq_config_but_cid_switchable">switchable_eq_config_but_cid_switchable</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc</span> <span class="id">t</span> <span class="id">tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#switchable">switchable</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid">eq_config_but_cid</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#switchable">switchable</a></span> <span class="id">tpc</span>' <span class="id"><a href="TSOCompInvs.html#t">t</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10289')">Proof.</div>
<div class="proofscript" id="proof10289">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#switchable">switchable</a></span>. <span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H0</span>. <span class="tactic">destruct</span> <span class="id">H</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#thrd_valid">thrd_valid</a></span> <span class="kwd">in</span> *. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#thrd_not_halted">thrd_not_halted</a></span> <span class="kwd">in</span> *. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#switchable_eq_config_but_cid_switchable">switchable_eq_config_but_cid_switchable</a></span> <span class="kwd">in</span> <span class="id">Hswable</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#switchable_sw_step">switchable_sw_step</a></span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">_tpc</span>' &amp; <span class="id">Hsw</span> &amp; <span class="id">Heq2</span>' &amp; <span class="id">Hcid</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">spc0</span>, <span class="id">tpc0</span>, <span class="id">tpc1</span>, <span class="id">_tpc</span>'. <span class="tactic">do</span> 4 (<span class="tactic">split</span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">auto</span>. <span class="tactic">split</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="eq_config_but_cid_eq_cid_eq_config">eq_config_but_cid_eq_cid_eq_config</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc</span> <span class="id">tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid">eq_config_but_cid</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> = <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_config">eq_config</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id">tpc</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10290')">Proof.</div>
<div class="proofscript" id="proof10290">
 <span class="tactic">clear</span>. <span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="id">constructor</span>; <span class="tactic">auto</span>. Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#eq_config_but_cid_eq_cid_eq_config">eq_config_but_cid_eq_cid_eq_config</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_trans">eq_config_but_cid_trans</a></span>; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">specialize</span> (<span class="id">IHnon_conflicting_steps</span> <span class="id">Hcidn</span> <span class="id">Hswable</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">tpc0</span> <span class="id">spc0</span> <span class="id">fp0</span> <span class="id">tpc1</span> <span class="id">MATCH0</span> <span class="id">Htau_ub</span> <span class="id">Heq2</span> <span class="id">Ht0</span> <span class="id">Hclient0</span> <span class="id">Hconflict0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">tpc</span> <span class="id">into</span> <span class="id">tpc2</span>. <span class="tactic">rename</span> <span class="id">l</span> <span class="id">into</span> <span class="id">l2</span>. <span class="tactic">rename</span> <span class="id">fp</span> <span class="id">into</span> <span class="id">fp2</span>. <span class="tactic">rename</span> <span class="id">tpc</span>' <span class="id">into</span> <span class="id">tpc3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">H</span> <span class="id">into</span> <span class="id">Hlabel</span>. <span class="tactic">rename</span> <span class="id">H0</span> <span class="id">into</span> <span class="id">Hstep</span>'. <span class="tactic">rename</span> <span class="id">H1</span> <span class="id">into</span> <span class="id">Hconflict</span>'. <span class="tactic">clear</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#MS_preserved_after_tau_ub_non_conflicting_client_step">MS_preserved_after_tau_ub_non_conflicting_client_step</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">fpS1</span> &amp; <span class="id">spc1</span> &amp; <span class="id">Hsstep0</span> &amp; <span class="id">Hmatchfp1</span> &amp; <span class="id">MATCH1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hlabel</span> <span class="kwd">as</span> [[<span class="id">Hcid2</span> [<span class="id">Htau</span> | [<span class="id">v</span> <span class="id">Hevt</span>]]] | [<span class="id">Hsw</span> | <span class="id">Hub</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">subst</span> <span class="id">l2</span>. <span class="tactic">clear</span> <span class="id">Hswable</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hswable2</span>: <span class="id"><a href="TSOSemLemmas.html#switchable">switchable</a></span> <span class="id">tpc1</span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc2</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">revert</span> <span class="id">Hstep</span>' <span class="id">Heq2</span> <span class="id">MATCH1</span>. <span class="tactic">clear</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">exists</span> <span class="id">c</span> <span class="id">cs</span>, (<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> (<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id">tpc2</span>)) !! (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc2</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOCompInvs.html#c">c</a></span> :: <span class="id"><a href="TSOCompInvs.html#cs">cs</a></span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">Hstep</span>'; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">eauto</span>. } <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Hstep</span>'. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">c</span> [<span class="id">cs</span> <span class="id">Hthdp</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id">eq_thrdpool</span>' <span class="kwd">in</span> <span class="id">Hthdp</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span>. <span class="tactic">eauto</span>. <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#valid_tid_eq">valid_tid_eq</a></span>. <span class="tactic">eauto</span>. <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thread_simulation">thread_simulation</a></span>. <span class="tactic">eauto</span>. <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>. <span class="id">exfalso</span>. <span class="tactic">rewrite</span> <span class="id">Hthdp</span> <span class="kwd">in</span> <span class="id">H4</span>. <span class="tactic">discriminate</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#thrd_valid">thrd_valid</a></span>, <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.valid_tid">TSOThrdPool.valid_tid</a></span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#plt">plt</a></span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc2</span>) (<span class="id"><a href="GlobDefs.html#ThreadPool.next_tid">ThreadPool.next_tid</a></span> (<span class="id"><a href="GlobDefs.html#thread_pool">thread_pool</a></span> <span class="id">spc1</span>))); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#ThreadPool.tp_finite">ThreadPool.tp_finite</a></span> <span class="kwd">in</span> <span class="id">n</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#tp_inv_src">tp_inv_src</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#thrd_not_halted">thrd_not_halted</a></span>. <span class="tactic">intro</span>. <span class="id">inv</span> <span class="id">H1</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">exists</span> <span class="id">_tpc2</span>, <span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id">tpc1</span> <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id"><a href="TSOCompInvs.html#_tpc2">_tpc2</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_config">eq_config</a></span> <span class="id">TGE</span> <span class="id">tpc2</span> <span class="id"><a href="TSOCompInvs.html#_tpc2">_tpc2</a></span>) <span class="kwd">as</span> [<span class="id">_tpc2</span> [<span class="id">Hsw1</span> <span class="id">Heq2</span>']].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="kwd">Lemma</span> <span class="id"><a name="eq_config_but_cid_switchable_sw_eq_config">eq_config_but_cid_switchable_sw_eq_config</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">tpc</span> <span class="id">tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid">eq_config_but_cid</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#switchable">switchable</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">tpc</span>'', <span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id">tpc</span>'' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_config">eq_config</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id">tpc</span>' <span class="id">tpc</span>''.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10291')">Proof.</div>
<div class="proofscript" id="proof10291">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">tpc</span>, <span class="id">tpc</span>'. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#switchable_sw_step">switchable_sw_step</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> (<span class="id">tpc</span>'' &amp; <span class="id">Hsw</span> &amp; <span class="id">Heq</span> &amp; <span class="id">Hcid</span>). <span class="id">exists</span> <span class="id">tpc</span>''. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hsw</span>; <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="GMemory.html#GMem.eq_sym">GMem.eq_sym</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#eq_config_but_cid_switchable_sw_eq_config">eq_config_but_cid_switchable_sw_eq_config</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_sym">eq_config_but_cid_sym</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#MS_preserved_after_sw">MS_preserved_after_sw</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">spc2</span> &amp; <span class="id">Hssw</span> &amp; <span class="id">MATCH2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hsmile</span>: <span class="id"><a href="Footprint.html#FP.smile">FP.smile</a></span> <span class="id">fp0</span> <span class="id">fp2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">clear</span> <span class="id">IHnon_conflicting_steps</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_eq_step">eq_config_eq_step</a></span>. <span class="tactic">exact</span> <span class="id">Heq2</span>'. <span class="tactic">exact</span> <span class="id">Hstep</span>'. <span class="tactic">intros</span> (<span class="id">_tpc3</span> &amp; <span class="id">Hstep2</span>' &amp; <span class="id">Heq</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="TSOCompInvs.html#client_core">client_core</a></span> <span class="id">TGE</span> <span class="id">i_obj</span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">_tpc2</span>) <span class="id">_tpc2</span> -&gt; ~ <span class="id"><a href="ClientSim.html#conflictc">conflictc</a></span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">_tpc2</span>) <span class="id">fp2</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">_tpc2</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOSemLemmas.html#eq_cid">eq_cid</a></span>; <span class="tactic">eauto</span>. <span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOSemLemmas.html#eq_buffer">eq_buffer</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id">Hconflict</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="id">erewrite</span> <span class="id"><a href="TSOSemLemmas.html#eq_thrdpool">eq_thrdpool</a></span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">MATCH0</span> <span class="id">Hsstep0</span> <span class="id">Htau_ub</span> <span class="id">Hclient0</span> <span class="id">MATCH1</span> <span class="id">Hssw</span> <span class="id">Hsw1</span> <span class="id">MATCH2</span> <span class="id">Hstep2</span>' <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc0</span> &lt;&gt; <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">_tpc2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">subst</span> <span class="id">t0</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_cid">eq_cid</a></span> <span class="kwd">in</span> <span class="id">Heq2</span>'. <span class="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H</span>. <span class="tactic">clear</span> <span class="id">t0</span> <span class="id">tpc</span>'' <span class="id">Hcidn</span> <span class="id">tpc2</span> <span class="id">tpc3</span> <span class="id">Hcid2</span> <span class="id">Hconflict</span>' <span class="id">Hstep</span>' <span class="id">Heq2</span> <span class="id">Ht0</span> <span class="id">Hswable2</span> <span class="id">Heq2</span>' <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rename</span> <span class="id">_tpc2</span> <span class="id">into</span> <span class="id">tpc2</span>. <span class="tactic">rename</span> <span class="id">_tpc3</span> <span class="id">into</span> <span class="id">tpc3</span>. <span class="tactic">rename</span> <span class="id">H0</span> <span class="id">into</span> <span class="id">Hconflict2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#MS_tau_step_fp_cases">MS_tau_step_fp_cases</a></span>. <span class="tactic">exact</span> <span class="id">MATCH2</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [ (<span class="id">_</span> &amp; <span class="id">fpS2</span> &amp; <span class="id">spc3</span> &amp; <span class="id">Hsstep2</span> &amp; <span class="id">HFP2</span> &amp; <span class="id">MATCH3</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id">_</span> &amp; <span class="id">fpS2</span> &amp; <span class="id">spc3</span> &amp; <span class="id">Hsstep2</span> &amp; <span class="id">MATCH3</span> &amp; <span class="id">HFP2</span> )].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="Footprint.html#FP.smile_conflict_compat">FP.smile_conflict_compat</a></span>. <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#adjacent_sc_conflicting_step_race">adjacent_sc_conflicting_step_race</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#GE_mod_sim_source_lang_wd">GE_mod_sim_source_lang_wd</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#GE_eq">GE_eq</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#GE_wd">GE_wd</a></span>. <span class="tactic">exact</span> <span class="id">MATCH0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#tp_inv_src">tp_inv_src</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span>. <span class="tactic">exact</span> <span class="id">MATCH0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#source_safe">source_safe</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#tid_eq">tid_eq</a></span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">MATCH0</span>. <span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#tid_eq">tid_eq</a></span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">MATCH2</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#fp_subset_conflict_full_conflict">fp_subset_conflict_full_conflict</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Footprint.html#FP.conflict_sym">FP.conflict_sym</a></span>, <span class="id"><a href="TSOSemLemmas.html#fp_subset_conflict_full_conflict">fp_subset_conflict_full_conflict</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Footprint.html#FP.conflict_sym">FP.conflict_sym</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#source_drf">source_drf</a></span>. <span class="tactic">exact</span> <span class="id">MATCH0</span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="RGRels.html#adjacent_client_fp_obj_fp_smile">adjacent_client_fp_obj_fp_smile</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_sep_obj_client_blocks">MS_sep_obj_client_blocks</a></span>. <span class="tactic">exact</span> <span class="id">MATCH0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_client_core_step_client_fp">MS_client_core_step_client_fp</a></span> <span class="kwd">in</span> <span class="id">Hsstep0</span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">MATCH0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="fpmatchc_client_fp_preserve">fpmatchc_client_fp_preserve</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fpS</span> <span class="id">fpT</span> <span class="id">gm1</span> <span class="id">gm2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#fpmatchc">fpmatchc</a></span> <span class="id"><a href="TSOCompInvs.html#fpS">fpS</a></span> <span class="id"><a href="TSOCompInvs.html#fpT">fpT</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html#client_fp">client_fp</a></span> <span class="id"><a href="TSOCompInvs.html#gm1">gm1</a></span> <span class="id"><a href="TSOCompInvs.html#gm2">gm2</a></span> <span class="id"><a href="TSOCompInvs.html#fpS">fpS</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html#client_fp">client_fp</a></span> <span class="id"><a href="TSOCompInvs.html#gm1">gm1</a></span> <span class="id"><a href="TSOCompInvs.html#gm2">gm2</a></span> <span class="id"><a href="TSOCompInvs.html#fpT">fpT</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10292')">Proof.</div>
<div class="proofscript" id="proof10292">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="RGRels.html#client_emp_fp">client_emp_fp</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="Footprint.html#FP.fp_eq">FP.fp_eq</a></span>, <span class="id"><a href="Footprint.html#FP.subset_eq">FP.subset_eq</a></span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Footprint.html#FP.subset_emp">FP.subset_emp</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="RGRels.html#client_valid_block_fp">client_valid_block_fp</a></span>. <span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id">H_client_valid_block_fp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Footprint.html#FP.locs">FP.locs</a></span> <span class="kwd">in</span> *. <span class="tactic">eapply</span> <span class="id"><a href="Footprint.html#FP.subset_ge_cmps_subset">FP.subset_ge_cmps_subset</a></span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="RGRels.html#client_alloc_fp">client_alloc_fp</a></span>. <span class="tactic">intros</span>; <span class="tactic">eapply</span> <span class="id">H_client_alloc_fp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Footprint.html#FP.locs">FP.locs</a></span> <span class="kwd">in</span> *. <span class="tactic">eapply</span> <span class="id"><a href="Footprint.html#FP.subset_ge_cmps_subset">FP.subset_ge_cmps_subset</a></span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#fpmatchc_client_fp_preserve">fpmatchc_client_fp_preserve</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_src_step_gmem_forward">MS_src_step_gmem_forward</a></span>. <span class="tactic">exact</span> <span class="id">MATCH0</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_client_core_step_obj_mem_eq">MS_client_core_step_obj_mem_eq</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hssw</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_eq_step">eq_config_eq_step</a></span>. <span class="tactic">exact</span> <span class="id">Heq2</span>'. <span class="tactic">exact</span> <span class="id">Hstep</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">_tpc3</span> &amp; <span class="id">Hstep</span>'' &amp; <span class="id">Heq3</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">MATCH1</span> <span class="id">Hsstep0</span> <span class="id">spc1</span> <span class="id">Hssw</span> <span class="id">MATCH2</span> <span class="id">spc2</span> <span class="id">Heq2</span> <span class="id">Hstep</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htau_ub</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">diff_thrd_normal_step_reorder</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_tge_flwd">MS_tge_flwd</a></span>;<span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#inv_thdp">inv_thdp</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1:= <span class="id"><a href="TSOGlobSem.html#tau">tau</a></span>). <span class="tactic">simpl</span>. <span class="tactic">auto</span>. <span class="tactic">exact</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1:= <span class="id">_tpc2</span>). <span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#tau_step_cid_eq">tau_step_cid_eq</a></span>; [|<span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Ht0</span>. <span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id">Hcid2</span>. <span class="tactic">rewrite</span> <span class="id">H0</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_cid">eq_cid</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1:= <span class="id"><a href="TSOGlobSem.html#tau">tau</a></span>). <span class="tactic">simpl</span>. <span class="tactic">auto</span>. <span class="tactic">exact</span> <span class="id">Hstep</span>''.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">_tpc2</span>' &amp; <span class="id">_tpc3</span>' &amp; <span class="id">_tpc0</span>' &amp; <span class="id">_tpc1</span>' &amp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hswto2</span> &amp; <span class="id">Hcid2</span>' &amp; <span class="id">Htau2</span>' &amp; <span class="id">Hswto1</span> &amp; <span class="id">Hcid1</span>' &amp; <span class="id">Htau1</span>' &amp; <span class="id">Heq3</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#MS_preserved_after_sw">MS_preserved_after_sw</a></span>. <span class="tactic">exact</span> <span class="id">MATCH0</span>. <span class="tactic">exact</span> <span class="id">Hswto2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">_spc2</span>' &amp; <span class="id">_</span> &amp; <span class="id">MATCH2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#MS_preserved_after_tau_step_if_not_conflicting_client_fp">MS_preserved_after_tau_step_if_not_conflicting_client_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">MATCH2</span>. <span class="tactic">exact</span> <span class="id">Htau2</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">Hcid2</span>'. <span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOSemLemmas.html#eq_cid">eq_cid</a></span>; [| <span class="tactic">exact</span> <span class="id">Heq2</span>']. <span class="tactic">intro</span> <span class="id">Hclient2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#less_buffer_item_not_conflict_preserve">less_buffer_item_not_conflict_preserve</a></span>; <span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id">Hconflict</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#tau_step_buffer_append">tau_step_buffer_append</a></span>. <span class="tactic">exact</span> <span class="id">H</span>. <span class="tactic">intros</span> [<span class="id">tail</span> <span class="id">Hbuffer2</span>'].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#sw_step_buffer_eq">sw_step_buffer_eq</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">Hswto2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOSemLemmas.html#eq_buffer">eq_buffer</a></span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">Heq2</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#sw_step_buffer_eq">sw_step_buffer_eq</a></span>. <span class="tactic">rewrite</span> <span class="id">Hbuffer2</span>'. <span class="tactic">apply</span> <span class="id"><a href="Coqlib.html#in_app">in_app</a></span>. <span class="tactic">auto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#eq_config_eq_client_core">eq_config_eq_client_core</a></span>. <span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_sym">eq_config_sym</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Hcid2</span> <span class="id">Hswto2</span> <span class="id">H</span> <span class="id">Ht0</span> <span class="id">Hsw1</span> <span class="id">Hclient2</span>. <span class="tactic">clear</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#step_diff_tid_thrdp_eq">step_diff_tid_thrdp_eq</a></span>. <span class="tactic">rewrite</span> &lt;- <span class="id">Ht0</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOCompInvs.html#sw_step_thdp_eq">sw_step_thdp_eq</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hclient2</span>. <span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#sw_step_thdp_eq">sw_step_thdp_eq</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">H0</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">_spc3</span>' &amp; <span class="id">_</span> &amp; <span class="id">_</span> &amp; <span class="id">MATCH3</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">MATCH2</span> <span class="id">_spc2</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#MS_preserved_after_sw">MS_preserved_after_sw</a></span>. <span class="tactic">exact</span> <span class="id">MATCH3</span>. <span class="tactic">exact</span> <span class="id">Hswto1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">_spc0</span>' &amp; <span class="id">_</span> &amp; <span class="id">MATCH0</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">MATCH3</span> <span class="id">_spc3</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> (@<span class="id"><a href="TSOCompInvs.html#tau_step_with_nonempty_buffer">tau_step_with_nonempty_buffer</a></span> <span class="id">TGE</span>). <span class="tactic">exact</span> <span class="id">Htau1</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Htau_ub</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHnon_conflicting_steps</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">MATCH0</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">Htau_ub</span>'. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_trans">eq_config_but_cid_trans</a></span>. <span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_eq_config_but_cid">eq_config_eq_config_but_cid</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">Heq3</span>. <span class="tactic">exact</span> <span class="id">Heq3</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">Hcid1</span>'. <span class="tactic">subst</span> <span class="id">t0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Hclient0</span> <span class="id">Hswto1</span> <span class="id">Htau2</span>' <span class="id">Hswto2</span> <span class="id">Heq2</span>' <span class="id">Hcid2</span> <span class="id">Hcid2</span>'. <span class="tactic">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">Hclient0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOCompInvs.html#sw_step_thdp_eq">sw_step_thdp_eq</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOSemLemmas.html#step_diff_tid_thrdp_eq">step_diff_tid_thrdp_eq</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">Htau2</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOCompInvs.html#sw_step_thdp_eq">sw_step_thdp_eq</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id">Hcid2</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H1</span>, <span class="id">Hcid2</span>'. <span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_cid">eq_cid</a></span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">Hcid1</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#sw_step_buffer_eq">sw_step_buffer_eq</a></span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">Hswto1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOCompInvs.html#sw_step_buffer_eq">sw_step_buffer_eq</a></span> <span class="kwd">in</span> <span class="id">Hconflict0</span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">Hswto2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Hsmile</span> <span class="id">Htau2</span>' <span class="id">Hconflict0</span>. <span class="tactic">clear</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#glob_step_fp_smile_conflictc_preserve">glob_step_fp_smile_conflictc_preserve</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="TSOSemLemmas.html#smile_sym">smile_sym</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">diff_thrd_normal_step_unbuffer_normal_step_reorder</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_tge_flwd">MS_tge_flwd</a></span>;<span class="tactic">eauto</span>. <span class="tactic">eapply</span>  <span class="id"><a href="TSOCompInvs.html#fls_embed">fls_embed</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#inv_thdp">inv_thdp</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1:= <span class="id"><a href="TSOGlobSem.html#tau">tau</a></span>). <span class="tactic">simpl</span>. <span class="tactic">auto</span>. <span class="tactic">exact</span> <span class="id">H0</span>. <span class="tactic">exact</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1:= <span class="id">_tpc2</span>). <span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_cid">eq_cid</a></span> <span class="kwd">in</span> <span class="id">Heq2</span>'. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1:= <span class="id"><a href="TSOGlobSem.html#tau">tau</a></span>). <span class="tactic">simpl</span>. <span class="tactic">auto</span>. <span class="tactic">exact</span> <span class="id">Hstep</span>''. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">_tpc2</span>' &amp; <span class="id">_tpc3</span>' &amp; <span class="id">_tpc0</span>' &amp; <span class="id">_tpc1</span>' &amp; <span class="id">_tpc1</span>'' &amp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hswto2</span> &amp; <span class="id">Hcid2</span>' &amp; <span class="id">Htau2</span>' &amp; <span class="id">Hswto1</span> &amp; <span class="id">Hcid1</span>' &amp; <span class="id">Htau1</span>' &amp; <span class="id">Hub1</span>' &amp; <span class="id">Heq3</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#MS_preserved_after_sw">MS_preserved_after_sw</a></span>. <span class="tactic">exact</span> <span class="id">MATCH0</span>. <span class="tactic">exact</span> <span class="id">Hswto2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">_spc2</span>' &amp; <span class="id">_</span> &amp; <span class="id">MATCH2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#MS_preserved_after_tau_step_if_not_conflicting_client_fp">MS_preserved_after_tau_step_if_not_conflicting_client_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">MATCH2</span>. <span class="tactic">exact</span> <span class="id">Htau2</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">Hcid2</span>'. <span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOSemLemmas.html#eq_cid">eq_cid</a></span>; [| <span class="tactic">exact</span> <span class="id">Heq2</span>']. <span class="tactic">intro</span> <span class="id">Hclient2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#less_buffer_item_not_conflict_preserve">less_buffer_item_not_conflict_preserve</a></span>; <span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id">Hconflict</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#tau_step_buffer_append">tau_step_buffer_append</a></span>. <span class="tactic">exact</span> <span class="id">H0</span>. <span class="tactic">intros</span> [<span class="id">tail</span> <span class="id">Hbuffer2</span>'].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#sw_step_buffer_eq">sw_step_buffer_eq</a></span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">Hswto2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOSemLemmas.html#eq_buffer">eq_buffer</a></span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">Heq2</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#sw_step_buffer_eq">sw_step_buffer_eq</a></span>; [|<span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span>' <span class="id">t0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="id">inv</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="ub_star_buffer_eq">ub_star_buffer_eq</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">t</span> <span class="id">tpc</span> <span class="id">tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#ub_star">ub_star</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span>', <span class="id">t</span>' &lt;&gt; <span class="id"><a href="TSOCompInvs.html#t">t</a></span> -&gt; <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">tpc</span>') <span class="id">t</span>' = <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) <span class="id">t</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10293')">Proof.</div>
<div class="proofscript" id="proof10293">
 <span class="tactic">clear</span>. <span class="tactic">induction</span> 1. <span class="tactic">eauto</span>. <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">IHub_star</span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="TSOSemLemmas.html#ub_step_buffer_eq">ub_step_buffer_eq</a></span>. Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="ub_star_thdp_eq">ub_star_thdp_eq</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">t</span> <span class="id">tpc</span> <span class="id">tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#ub_star">ub_star</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> = <span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id">tpc</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10294')">Proof.</div>
<div class="proofscript" id="proof10294">
 <span class="tactic">clear</span>. <span class="tactic">induction</span> 1. <span class="tactic">eauto</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">congruence</span>. Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#ub_star_buffer_eq">ub_star_buffer_eq</a></span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hbuffer2</span>'. <span class="tactic">apply</span> <span class="id"><a href="Coqlib.html#in_app">in_app</a></span>. <span class="tactic">auto</span>. <span class="tactic">subst</span> <span class="id">t0</span>. <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#eq_config_eq_client_core">eq_config_eq_client_core</a></span>. <span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_sym">eq_config_sym</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Hcid2</span> <span class="id">Hswto2</span> <span class="id">H0</span> <span class="id">H1</span> <span class="id">Ht0</span> <span class="id">Hsw1</span> <span class="id">Hclient2</span>. <span class="tactic">clear</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#step_diff_tid_thrdp_eq">step_diff_tid_thrdp_eq</a></span>. <span class="tactic">rewrite</span> &lt;- <span class="id">Ht0</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#ub_star_thdp_eq">ub_star_thdp_eq</a></span>; [| <span class="tactic">exact</span> <span class="id">H1</span>]. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOCompInvs.html#sw_step_thdp_eq">sw_step_thdp_eq</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hclient2</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">H</span>. <span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOCompInvs.html#sw_step_thdp_eq">sw_step_thdp_eq</a></span>; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">_spc3</span>' &amp; <span class="id">_</span> &amp; <span class="id">_</span> &amp; <span class="id">MATCH3</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#MS_preserved_after_sw">MS_preserved_after_sw</a></span>. <span class="tactic">exact</span> <span class="id">MATCH3</span>. <span class="tactic">exact</span> <span class="id">Hswto1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">_spc0</span>' &amp; <span class="id">_</span> &amp; <span class="id">MATCH0</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">MATCH3</span> <span class="id">_spc3</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> (@<span class="id"><a href="TSOCompInvs.html#tau_step_followed_by_unbuffers">tau_step_followed_by_unbuffers</a></span> <span class="id">TGE</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">instantiate</span> (1:= <span class="id">_tpc0</span>'). <span class="tactic">rewrite</span> &lt;- <span class="id">H</span>. <span class="tactic">rewrite</span> <span class="id">Hcid1</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#sw_step_buffer_eq">sw_step_buffer_eq</a></span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">Hswto1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#tau_step_buffer_eq">tau_step_buffer_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#sw_step_buffer_eq">sw_step_buffer_eq</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_cid">eq_cid</a></span> <span class="kwd">in</span> <span class="id">Heq2</span>'. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">Htau1</span>'. <span class="tactic">rewrite</span> <span class="id">Hcid1</span>'. <span class="tactic">exact</span> <span class="id">Hub1</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Htau_ub</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHnon_conflicting_steps</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">MATCH0</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">Htau_ub</span>'. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_trans">eq_config_but_cid_trans</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_eq_config_but_cid">eq_config_eq_config_but_cid</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">Heq3</span>. <span class="tactic">assumption</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">Hcid1</span>'. <span class="tactic">subst</span> <span class="id">t0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Hclient0</span> <span class="id">Hswto1</span> <span class="id">Htau2</span>' <span class="id">Hswto2</span> <span class="id">Heq2</span>' <span class="id">Hcid2</span> <span class="id">Hcid2</span>'. <span class="tactic">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">Hclient0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOCompInvs.html#sw_step_thdp_eq">sw_step_thdp_eq</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOSemLemmas.html#step_diff_tid_thrdp_eq">step_diff_tid_thrdp_eq</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">Htau2</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOCompInvs.html#sw_step_thdp_eq">sw_step_thdp_eq</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id">Hcid2</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H1</span>, <span class="id">Hcid2</span>'. <span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_cid">eq_cid</a></span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">Hcid1</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#sw_step_buffer_eq">sw_step_buffer_eq</a></span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">Hswto1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOCompInvs.html#sw_step_buffer_eq">sw_step_buffer_eq</a></span> <span class="kwd">in</span> <span class="id">Hconflict0</span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">Hswto2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Hsmile</span> <span class="id">Htau2</span>' <span class="id">Hconflict0</span>. <span class="tactic">clear</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#glob_step_fp_smile_conflictc_preserve">glob_step_fp_smile_conflictc_preserve</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="TSOSemLemmas.html#smile_sym">smile_sym</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">subst</span> <span class="id">l2</span>. <span class="tactic">clear</span> <span class="id">Hswable</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hswable2</span>: <span class="id"><a href="TSOSemLemmas.html#switchable">switchable</a></span> <span class="id">tpc1</span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc2</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">revert</span> <span class="id">Hstep</span>' <span class="id">Heq2</span> <span class="id">MATCH1</span>. <span class="tactic">clear</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">exists</span> <span class="id">c</span> <span class="id">cs</span>, (<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> (<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id">tpc2</span>)) !! (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc2</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOCompInvs.html#c">c</a></span> :: <span class="id"><a href="TSOCompInvs.html#cs">cs</a></span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">Hstep</span>'; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">eauto</span>. } <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Hstep</span>'. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">c</span> [<span class="id">cs</span> <span class="id">Hthdp</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id">eq_thrdpool</span>' <span class="kwd">in</span> <span class="id">Hthdp</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span>. <span class="tactic">eauto</span>. <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#valid_tid_eq">valid_tid_eq</a></span>. <span class="tactic">eauto</span>. <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#thread_simulation">thread_simulation</a></span>. <span class="tactic">eauto</span>. <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>. <span class="id">exfalso</span>. <span class="tactic">rewrite</span> <span class="id">Hthdp</span> <span class="kwd">in</span> <span class="id">H4</span>. <span class="tactic">discriminate</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#thrd_valid">thrd_valid</a></span>, <span class="id"><a href="TSOGlobSem.html#TSOThrdPool.valid_tid">TSOThrdPool.valid_tid</a></span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#plt">plt</a></span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">tpc2</span>) (<span class="id"><a href="GlobDefs.html#ThreadPool.next_tid">ThreadPool.next_tid</a></span> (<span class="id"><a href="GlobDefs.html#thread_pool">thread_pool</a></span> <span class="id">spc1</span>))); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="GlobDefs.html#ThreadPool.tp_finite">ThreadPool.tp_finite</a></span> <span class="kwd">in</span> <span class="id">n</span>. <span class="tactic">unfold</span> <span class="id"><a href="GlobDefs.html#ThreadPool.get_cs">ThreadPool.get_cs</a></span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#tp_inv_src">tp_inv_src</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOSemLemmas.html#thrd_not_halted">thrd_not_halted</a></span>. <span class="tactic">intro</span>. <span class="id">inv</span> <span class="id">H1</span>. <span class="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">exists</span> <span class="id">_tpc2</span>, <span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id">tpc1</span> <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id"><a href="TSOCompInvs.html#_tpc2">_tpc2</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_config">eq_config</a></span> <span class="id">TGE</span> <span class="id">tpc2</span> <span class="id"><a href="TSOCompInvs.html#_tpc2">_tpc2</a></span>) <span class="kwd">as</span> [<span class="id">_tpc2</span> [<span class="id">Hsw1</span> <span class="id">Heq2</span>']].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#eq_config_but_cid_switchable_sw_eq_config">eq_config_but_cid_switchable_sw_eq_config</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_sym">eq_config_but_cid_sym</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#MS_preserved_after_sw">MS_preserved_after_sw</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">spc2</span> &amp; <span class="id">Hssw</span> &amp; <span class="id">MATCH2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#evt_step_emp_fp">evt_step_emp_fp</a></span>. <span class="tactic">exact</span> <span class="id">Hstep</span>'. <span class="tactic">intro</span>. <span class="tactic">subst</span> <span class="id">fp2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_eq_step">eq_config_eq_step</a></span>. <span class="tactic">exact</span> <span class="id">Heq2</span>'. <span class="tactic">exact</span> <span class="id">Hstep</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">_tpc3</span> &amp; <span class="id">Hstep</span>'' &amp; <span class="id">Heq3</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">MATCH1</span> <span class="id">Hsstep0</span> <span class="id">spc1</span> <span class="id">Hssw</span> <span class="id">MATCH2</span> <span class="id">spc2</span> <span class="id">Heq2</span> <span class="id">Hstep</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#tau_ub_evt_reorder">tau_ub_evt_reorder</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_tge_flwd">MS_tge_flwd</a></span>;<span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#inv_thdp">inv_thdp</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">Htau_ub</span>. <span class="tactic">exact</span> <span class="id">Hsw1</span>. <span class="tactic">exact</span> <span class="id">Hstep</span>''.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_cid">eq_cid</a></span> <span class="kwd">in</span> <span class="id">Heq2</span>'. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">_tpc2</span>' &amp; <span class="id">_tpc3</span>' &amp; <span class="id">_tpc0</span>' &amp; <span class="id">_tpc1</span>' &amp; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hswto2</span> &amp; <span class="id">Hcid2</span>' &amp; <span class="id">Hevt2</span>' &amp; <span class="id">Hswto1</span> &amp; <span class="id">Hcid1</span>' &amp; <span class="id">Htau_ub1</span>' &amp; <span class="id">Heq3</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#MS_preserved_after_sw">MS_preserved_after_sw</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">MATCH0</span>. <span class="tactic">exact</span> <span class="id">Hswto2</span>. <span class="tactic">intros</span> (<span class="id">_spc2</span>' &amp; <span class="id">_</span> &amp; <span class="id">MATCH2</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#MS_preserved_after_evt_step">MS_preserved_after_evt_step</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">MATCH2</span>'. <span class="tactic">exact</span> <span class="id">Hevt2</span>'. <span class="tactic">intros</span> (<span class="id">_spc2</span>'' &amp; <span class="id">_</span> &amp; <span class="id">MATCH2</span>'').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">_spc2</span>' <span class="id">MATCH2</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#MS_preserved_after_sw">MS_preserved_after_sw</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">MATCH2</span>''. <span class="tactic">exact</span> <span class="id">Hswto1</span>. <span class="tactic">intros</span> (<span class="id">_spc0</span>' &amp; <span class="id">_</span> &amp; <span class="id">MATCH0</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">_spc2</span>'' <span class="id">MATCH2</span>''.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHnon_conflicting_steps</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">MATCH0</span>'. <span class="tactic">exact</span> <span class="id">Htau_ub1</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_trans">eq_config_but_cid_trans</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_eq_config_but_cid">eq_config_eq_config_but_cid</a></span>; <span class="tactic">eauto</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">Hcid1</span>'. <span class="tactic">subst</span> <span class="id">t0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Hclient0</span> <span class="id">Hswto1</span> <span class="id">Hevt2</span>' <span class="id">Hswto2</span> <span class="id">Heq2</span>' <span class="id">Hcid2</span> <span class="id">Hcid2</span>'. <span class="tactic">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">Hclient0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOCompInvs.html#sw_step_thdp_eq">sw_step_thdp_eq</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOSemLemmas.html#step_diff_tid_thrdp_eq">step_diff_tid_thrdp_eq</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">Hevt2</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOCompInvs.html#sw_step_thdp_eq">sw_step_thdp_eq</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id">Hcid2</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H1</span>, <span class="id">Hcid2</span>'. <span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_cid">eq_cid</a></span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">Hcid1</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#sw_step_buffer_eq">sw_step_buffer_eq</a></span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">Hswto1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id"><a href="TSOCompInvs.html#sw_step_buffer_eq">sw_step_buffer_eq</a></span> <span class="kwd">in</span> <span class="id">Hconflict0</span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">Hswto2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Hconflict0</span> <span class="id">Hevt2</span>'. <span class="tactic">clear</span>. <span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">Hevt2</span>'. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">subst</span> <span class="id">l2</span>. <span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#sw_step_emp_fp">sw_step_emp_fp</a></span>. <span class="tactic">eauto</span>. <span class="tactic">intro</span>; <span class="tactic">subst</span> <span class="id">fp2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHnon_conflicting_steps</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">MATCH0</span>. <span class="tactic">exact</span> <span class="id">Htau_ub</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_trans">eq_config_but_cid_trans</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_sym">eq_config_but_cid_sym</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#sw_step_eq_config_but_cid">sw_step_eq_config_but_cid</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">Heq2</span>. <span class="tactic">exact</span> <span class="id">Ht0</span>. <span class="tactic">exact</span> <span class="id">Hclient0</span>. <span class="tactic">exact</span> <span class="id">Hconflict0</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">Hub</span> <span class="kwd">as</span> [<span class="id">t</span>' <span class="id">Hlabel</span>]; <span class="tactic">subst</span> <span class="id">l2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">spc1</span> <span class="id">MATCH1</span> <span class="id">Hsstep0</span> <span class="id">Hswable</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">exists</span> <span class="id">_tpc3</span>, <span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id">tpc1</span> (<span class="id"><a href="TSOGlobSem.html#ub">ub</a></span> <span class="id">t</span>') <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id"><a href="TSOCompInvs.html#_tpc3">_tpc3</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid">eq_config_but_cid</a></span> <span class="id">TGE</span> <span class="id">tpc3</span> <span class="id"><a href="TSOCompInvs.html#_tpc3">_tpc3</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> [<span class="id">_tpc3</span> [<span class="id">Hstep</span>'' <span class="id">Heq3</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">revert</span> <span class="id">Heq2</span> <span class="id">Hstep</span>'. <span class="tactic">clear</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tpc1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Heq2</span>. <span class="id">inv</span> <span class="id">Hstep</span>'. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">subst</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tm</span>, <span class="id">tm0</span>, <span class="id">tm</span>'. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOStepAuxLemmas.html#gmem_eq_ub_gmem_eq">gmem_eq_ub_gmem_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">gm2</span>' &amp; <span class="id">Hunbuffer</span> &amp; <span class="id">Heqm</span>'). <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>. <span class="tactic">split</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">subst</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Hstep</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">exists</span> <span class="id">_tpc0</span> <span class="id">_tpc1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#ub_star">ub_star</a></span> <span class="id">TGE</span> <span class="id">t</span>' <span class="id">tpc0</span> <span class="id"><a href="TSOCompInvs.html#_tpc0">_tpc0</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#tau_step_followed_by_unbuffer">tau_step_followed_by_unbuffer</a></span> <span class="id"><a href="TSOCompInvs.html#_tpc0">_tpc0</a></span> <span class="id">fp0</span> <span class="id"><a href="TSOCompInvs.html#_tpc1">_tpc1</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid">eq_config_but_cid</a></span> <span class="id">TGE</span> <span class="id"><a href="TSOCompInvs.html#_tpc1">_tpc1</a></span> <span class="id">_tpc3</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> (<span class="id">_tpc0</span> &amp; <span class="id">_tpc1</span> &amp; <span class="id">Hubstar</span> &amp; <span class="id">Htau_ub</span>' &amp; <span class="id">Heq3</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">IHnon_conflicting_steps</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Hconflict</span>'. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#tau_ub_unbuffer_reorder">tau_ub_unbuffer_reorder</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#MS_tge_flwd">MS_tge_flwd</a></span>;<span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#inv_thdp">inv_thdp</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#buffered_alloc_local">buffered_alloc_local</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#fls_embed">fls_embed</a></span>. <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">auto</span>.           <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#MS_preserved_after_ub_star">MS_preserved_after_ub_star</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">MATCH0</span>. <span class="tactic">exact</span> <span class="id">Hubstar</span>. <span class="tactic">intros</span> <span class="id">MATCH0</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHnon_conflicting_steps</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">MATCH0</span>'. <span class="tactic">exact</span> <span class="id">Htau_ub</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_trans">eq_config_but_cid_trans</a></span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_but_cid_sym">eq_config_but_cid_sym</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">t0</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#ub_star_thdp_cid_unchg">ub_star_thdp_cid_unchg</a></span> <span class="kwd">in</span> <span class="id">Hubstar</span>. <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#ub_star_thdp_cid_unchg">ub_star_thdp_cid_unchg</a></span> <span class="kwd">in</span> <span class="id">Hubstar</span>. <span class="tactic">destruct</span> <span class="id">Hubstar</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hclient0</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">H</span>, <span class="id">H0</span>. <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#ub_star_thdp_cid_unchg">ub_star_thdp_cid_unchg</a></span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">Hubstar</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">_</span> <span class="id">Hcid0</span>']. <span class="tactic">rewrite</span> <span class="id">Hcid0</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#less_buffer_item_not_conflict_preserve">less_buffer_item_not_conflict_preserve</a></span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">Hconflict0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="id">Hubstar</span>. <span class="tactic">clear</span>. <span class="tactic">induction</span> 1; <span class="tactic">intros</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHHubstar</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span>' <span class="id">t</span>'0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#ub_step_buffer_pop">ub_step_buffer_pop</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span>. <span class="tactic">rewrite</span> <span class="id">H</span>. <span class="tactic">simpl</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOSemLemmas.html#ub_step_buffer_eq">ub_step_buffer_eq</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">spc0</span>', <span class="id">tpc0</span>', <span class="id">fp0</span>, <span class="id">tpc0</span>'', <span class="id">tpc</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOSemLemmas.html#eq_cid">eq_cid</a></span>. <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="TSOSemLemmas.html#eq_config_sym">eq_config_sym</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#eq_config_client_step_fp">eq_config_client_step_fp</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="conflicting_adjacent_steps_race">conflicting_adjacent_steps_race</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">t0</span> <span class="id">spc0</span> <span class="id">tpc0</span> <span class="id">fp0</span> <span class="id">tpc0</span>' <span class="id">tpc</span> <span class="id">fp</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#MS">MS</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#spc0">spc0</a></span> <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#t0">t0</a></span> = <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#client_core">client_core</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span>) <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="ClientSim.html#conflictc">conflictc</a></span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span>) <span class="id"><a href="TSOCompInvs.html#fp0">fp0</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#tau_step_followed_by_unbuffer">tau_step_followed_by_unbuffer</a></span> <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span> <span class="id"><a href="TSOCompInvs.html#fp0">fp0</a></span> <span class="id">tpc0</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id">tpc0</span>' <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#t0">t0</a></span> &lt;&gt; <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#tso_client_step_fp">tso_client_step_fp</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Footprint.html#FP.conflict">FP.conflict</a></span> <span class="id"><a href="TSOCompInvs.html#fp0">fp0</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10295')">Proof.</div>
<div class="proofscript" id="proof10295">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">t0</span> <span class="id">spc0</span> <span class="id">tpc0</span> <span class="id">fp0</span> <span class="id">tpc0</span>' <span class="id">tpc</span> <span class="id">fp</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">MATCH0</span> <span class="id">Hcid0</span> <span class="id">Hclient0</span> <span class="id">Hconflict0</span> <span class="id">Htau_ub</span> <span class="id">Hsw</span> <span class="id">Hcid</span> <span class="id">Hclientfp</span> <span class="id">Hconflict</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#MS_preserved_after_tau_ub_non_conflicting_client_step">MS_preserved_after_tau_ub_non_conflicting_client_step</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">MATCH0</span>. <span class="tactic">exact</span> <span class="id">Htau_ub</span>. <span class="tactic">exact</span> <span class="id">Hclient0</span>. <span class="tactic">exact</span> <span class="id">Hconflict0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">fpS1</span> &amp; <span class="id">spc1</span> &amp; <span class="id">Hsstep0</span> &amp; <span class="id">Hfp</span> &amp; <span class="id">MATCH1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#MS_preserved_after_sw">MS_preserved_after_sw</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">MATCH1</span>. <span class="tactic">exact</span> <span class="id">Hsw</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">spc2</span> &amp; <span class="id">Hssw</span> &amp; <span class="id">MATCH2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#MS_tso_client_step_fp_match">MS_tso_client_step_fp_match</a></span>. <span class="tactic">exact</span> <span class="id">MATCH2</span>. <span class="tactic">exact</span> <span class="id">Hclientfp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">spc3</span> &amp; <span class="id">fpS2</span> &amp; <span class="id">Hsstep2</span> &amp; <span class="id">FPMATCH</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#fp_subset_conflict_full_conflict">fp_subset_conflict_full_conflict</a></span>; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hsconflict</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#adjacent_sc_conflicting_step_race">adjacent_sc_conflicting_step_race</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#GE_mod_sim_source_lang_wd">GE_mod_sim_source_lang_wd</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#GE_eq">GE_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#GE_wd">GE_wd</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#tp_inv_src">tp_inv_src</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#thdp_sims">thdp_sims</a></span>. <span class="tactic">exact</span> <span class="id">MATCH0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#source_safe">source_safe</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#tid_eq">tid_eq</a></span>;[|<span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#tid_eq">tid_eq</a></span>;[|<span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Footprint.html#FP.conflict_sym">FP.conflict_sym</a></span>, <span class="id"><a href="TSOSemLemmas.html#fp_subset_conflict_full_conflict">fp_subset_conflict_full_conflict</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Footprint.html#FP.conflict_sym">FP.conflict_sym</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">C</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#source_drf">source_drf</a></span>. <span class="tactic">exact</span> <span class="id">MATCH0</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Theorem</span> <span class="id"><a name="PreviouslyInserted_no_conflicting_client_fp">PreviouslyInserted_no_conflicting_client_fp</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">t</span>' <span class="id">bi</span> <span class="id">spc0</span> <span class="id">tpc0</span> <span class="id">head</span> <span class="id">tail</span> <span class="id">tpc</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#MS">MS</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#spc0">spc0</a></span> <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#PreviouslyInserted">PreviouslyInserted</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id">t</span>' <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span> <span class="id"><a href="TSOCompInvs.html#tpc0">tpc0</a></span> <span class="id"><a href="TSOCompInvs.html#head">head</a></span> <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">t</span>' &lt;&gt; <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tC</span> <span class="id">tcs</span> <span class="id">fp</span> <span class="id">tc</span>' <span class="id">b</span>' <span class="id">tm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">nat_of_ord</span> (<span class="id"><a href="TSOGlobSem.html#TSOCore.i">TSOCore.i</a></span> <span class="id"><a href="TSOCompInvs.html#tC">tC</a></span>) &lt;&gt; <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOThrdPool.content">TSOThrdPool.content</a></span> (<span class="id"><a href="TSOGlobSem.html#thrdpool">thrdpool</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>)) !! (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOCompInvs.html#tC">tC</a></span> :: <span class="id"><a href="TSOCompInvs.html#tcs">tcs</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#tsostep">tsostep</a></span> (<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.modules">TSOGlobEnv.modules</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> (<span class="id"><a href="TSOGlobSem.html#TSOCore.i">TSOCore.i</a></span> <span class="id"><a href="TSOCompInvs.html#tC">tC</a></span>)) (<span class="id"><a href="GlobDefs.html#FLists.get_fl">FLists.get_fl</a></span> (<span class="id"><a href="TSOGlobSem.html#TSOGlobEnv.freelists">TSOGlobEnv.freelists</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span>) (<span class="id"><a href="TSOGlobSem.html#TSOCore.F">TSOCore.F</a></span> <span class="id"><a href="TSOCompInvs.html#tC">tC</a></span>)) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOGlobSem.html#TSOCore.c">TSOCore.c</a></span> <span class="id"><a href="TSOCompInvs.html#tC">tC</a></span>) (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>), <span class="id"><a href="TSOMem.html#memory">memory</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>)) <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">tc</span>' (<span class="id">b</span>', <span class="id">tm</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="ClientSim.html#conflict_bi">conflict_bi</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10296')">Proof.</div>
<div class="proofscript" id="proof10296">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">t</span>' <span class="id">bi</span> <span class="id">spc0</span> <span class="id">tpc0</span> <span class="id">head</span> <span class="id">tail</span> <span class="id">tpc</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">MATCH0</span> <span class="id">PrevInserted</span> <span class="id">Htid</span> <span class="id">tC</span> <span class="id">tcs</span> <span class="id">fp</span> <span class="id">tc</span>' <span class="id">b</span>' <span class="id">tm</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hmid</span> <span class="id">Htcore</span> <span class="id">Hstep</span> <span class="id">Hconflict</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">PreviouslyInserted_PreviouslyInserted</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">_head</span> &amp; <span class="id">_tail</span> &amp; <span class="id">_tpc</span> &amp; <span class="id">HPrevInserted</span>' &amp; <span class="id">Htid</span>' &amp; <span class="id">Hclientfp</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">PrevInserted</span> <span class="id">Htcore</span> <span class="id">Hstep</span> <span class="id">tC</span> <span class="id">tcs</span> <span class="id">tc</span>' <span class="id">b</span>' <span class="id">tm</span>' <span class="id">Hmid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">t</span>' &lt;&gt; <span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id">_tpc</span>) <span class="kwd">as</span> <span class="id">Htid</span>''.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intro</span>. <span class="tactic">subst</span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Htid</span> <span class="id">Htid</span>' <span class="id">head</span> <span class="id">tail</span> <span class="id">tpc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">PreviouslyInserted</span>'<span class="id">_adjacent_conflicting_step</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">spc0</span> <span class="id">tpc0</span> <span class="id">bi</span> <span class="id">Hconflict</span> <span class="id">HPrevInserted</span>' <span class="id">_head</span> <span class="id">_tail</span> <span class="id">MATCH0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">t</span>' <span class="id">into</span> <span class="id">t0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">spc0</span> &amp; <span class="id">tpc0</span> &amp; <span class="id">fp0</span> &amp; <span class="id">tpc0</span>' &amp; <span class="id">tpc0</span>'' &amp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hinv</span> &amp; <span class="id">Htid0</span> &amp; <span class="id">Hclient0</span> &amp; <span class="id">Hconflict0</span> &amp; <span class="id">Hstep0</span> &amp; <span class="id">Hswstep</span> &amp; <span class="id">Hcid</span>'' &amp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hfp</span> &amp; <span class="id">Hconflict</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#conflicting_adjacent_steps_race">conflicting_adjacent_steps_race</a></span>; <span class="tactic">eauto</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc">Lemma 15 in draft ... </div>
&nbsp;&nbsp;<span class="kwd">Theorem</span> <span class="id"><a name="MS_BufWD_no_conflicting_client_fp">MS_BufWD_no_conflicting_client_fp</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">tpc</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#BufWD">BufWD</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#no_conflicting_client_fp">no_conflicting_client_fp</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10297')">Proof.</div>
<div class="proofscript" id="proof10297">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">tpc</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOCompInvs.html#no_conflicting_client_fp">no_conflicting_client_fp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">fp</span> <span class="id">Hclientfp</span> <span class="id">C</span>. <span class="tactic">destruct</span> <span class="id">C</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_split">in_split</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">head</span> [<span class="id">tail</span> <span class="id">Hbi</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#prev_inserted">prev_inserted</a></span> <span class="kwd">in</span> <span class="id">Hbi</span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hbi</span> <span class="kwd">as</span> [<span class="id">spc0</span> [<span class="id">tpc0</span> [<span class="id">MATCH0</span> <span class="id">Hbi</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hclientfp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#PreviouslyInserted_no_conflicting_client_fp">PreviouslyInserted_no_conflicting_client_fp</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="BufWD_client_core_not_conflictc">BufWD_client_core_not_conflictc</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">tpc</span> <span class="id">fp</span> <span class="id">tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#BufWD">BufWD</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#client_core">client_core</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOGlobSem.html#tau">tau</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="ClientSim.html#conflictc">conflictc</a></span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10298')">Proof.</div>
<div class="proofscript" id="proof10298">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#MS_BufWD_no_conflicting_client_fp">MS_BufWD_no_conflicting_client_fp</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>; <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="TSOCompInvs.html#emp_fp_not_conflictc">emp_fp_not_conflictc</a></span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">H_tp_core</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="id">inv</span> <span class="id">H1</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
<div class="doc">BufWD is actually an invariant </div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="BufWD_preserved_if_post_states_MS">BufWD_preserved_if_post_states_MS</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">spc</span> <span class="id">tpc</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#MS">MS</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#BufWD">BufWD</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l</span> <span class="id">fp</span> <span class="id">tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOCompInvs.html#l">l</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#BufWD">BufWD</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id">tpc</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10299')">Proof.</div>
<div class="proofscript" id="proof10299">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">spc</span> <span class="id">tpc</span> <span class="id">MATCH</span> <span class="id">H</span> <span class="id">l</span> <span class="id">fp</span> <span class="id">tpc</span>' <span class="id">Hstep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>. <span class="tactic">intros</span> <span class="id">t</span> <span class="id">bi</span> <span class="id">head</span> <span class="id">tail</span> <span class="id">Hbuffer</span>.<br/>
&nbsp;case&nbsp;study&nbsp;on&nbsp;Htstep...&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>.<br/>
&nbsp;tau&nbsp;step&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#tau_step_buffer_append">tau_step_buffer_append</a></span>. <span class="tactic">exact</span> <span class="id">Hstep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hbuffer</span>. <span class="tactic">intros</span> [<span class="id">tail</span>' <span class="id">Hbuffer</span>'].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> ((<span class="id">exists</span> <span class="id">head</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">head</span> = <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">tpc</span>) <span class="id">t</span> ++ <span class="id">head</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tail</span>' = <span class="id">head</span>' ++ <span class="id">bi</span> :: <span class="id">tail</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> <span class="id">tail0</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">tpc</span>) <span class="id">t</span> = <span class="id">head</span> ++ <span class="id">bi</span> :: <span class="id"><a href="TSOCompInvs.html#tail0">tail0</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#tail0">tail0</a></span> ++ <span class="id">tail</span>' = <span class="id">tail</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">revert</span> <span class="id">Hbuffer</span>'. <span class="tactic">generalize</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">tpc</span>) <span class="id">t</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intro</span> <span class="id">head</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="list_head_tail_split_cases">list_head_tail_split_cases</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span> <span class="id">bi</span> (<span class="id">head</span> <span class="id">tail</span> <span class="id">head</span>' <span class="id">tail</span>': <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="TSOCompInvs.html#A">A</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#head">head</a></span> ++ <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span> :: <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> = <span class="id">head</span>' ++ <span class="id">tail</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> <span class="id">head</span>'0, <span class="id"><a href="TSOCompInvs.html#head">head</a></span> = <span class="id">head</span>' ++ <span class="id">head</span>'0 /\ <span class="id">tail</span>' = <span class="id">head</span>'0 ++ <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span> :: <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span>) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> <span class="id">tail0</span>, <span class="id">head</span>' = <span class="id"><a href="TSOCompInvs.html#head">head</a></span> ++ <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span> :: <span class="id"><a href="TSOCompInvs.html#tail0">tail0</a></span> /\ <span class="id"><a href="TSOCompInvs.html#tail0">tail0</a></span> ++ <span class="id">tail</span>' = <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10300')">Proof.</div>
<div class="proofscript" id="proof10300">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span> <span class="id">A</span> <span class="id">bi</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">head</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">head</span>'; <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>. <span class="tactic">subst</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">head</span>'; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tail</span>'; <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHhead</span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="tactic">clear</span> <span class="id">IHhead</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> [(<span class="id">head0</span>' &amp; <span class="id">Hhead</span> &amp; <span class="id">Htail</span>) | (<span class="id">tail0</span> &amp; <span class="id">Hhead</span> &amp; <span class="id">Htail</span>)].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">eauto</span>. <span class="tactic">subst</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#list_head_tail_split_cases">list_head_tail_split_cases</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">Hnew</span> | <span class="id">Hold</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hnew</span> <span class="kwd">as</span> [<span class="id">head</span>' [<span class="id">Hhead</span> <span class="id">Htail</span>]]. <span class="tactic">subst</span> <span class="id">head</span> <span class="id">tail</span>'. <span class="tactic">clear</span> <span class="id">Hbuffer</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">spc</span>, <span class="id">tpc</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#BufWD_client_core_not_conflictc">BufWD_client_core_not_conflictc</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tpc</span>'. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#bi_nub_refl">bi_nub_refl</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hold</span> <span class="kwd">as</span> [<span class="id">tail0</span> [<span class="id">Hbuffer0</span> <span class="id">Htail</span>]]. <span class="tactic">subst</span> <span class="id">tail</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id">H</span> <span class="kwd">as</span> <span class="id">BUFWD</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#prev_inserted">prev_inserted</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">spc0</span> &amp; <span class="id">tpc0</span> &amp; <span class="id">MATCH0</span> &amp; <span class="id">PI0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">spc0</span>, <span class="id">tpc0</span>. <span class="tactic">split</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">PI0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="bi_nub_insert_buffer_bi_nub">bi_nub_insert_buffer_bi_nub</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">t</span> <span class="id">bi</span> <span class="id">head1</span> <span class="id">tail1</span> <span class="id">tpc1</span> <span class="id">headn</span> <span class="id">tailn</span> <span class="id">tpcn</span> <span class="id">l</span> <span class="id">fp</span> <span class="id">tpc</span> <span class="id">tail</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#bi_not_unbuffered">bi_not_unbuffered</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span> <span class="id"><a href="TSOCompInvs.html#head1">head1</a></span> <span class="id"><a href="TSOCompInvs.html#tail1">tail1</a></span> <span class="id"><a href="TSOCompInvs.html#tpc1">tpc1</a></span> <span class="id"><a href="TSOCompInvs.html#headn">headn</a></span> <span class="id"><a href="TSOCompInvs.html#tailn">tailn</a></span> <span class="id"><a href="TSOCompInvs.html#tpcn">tpcn</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#tpcn">tpcn</a></span> <span class="id"><a href="TSOCompInvs.html#l">l</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>) <span class="id"><a href="TSOCompInvs.html#t">t</a></span> = <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpcn">tpcn</a></span>) <span class="id"><a href="TSOCompInvs.html#t">t</a></span> ++ <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="TSOCompInvs.html#client_core">client_core</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpcn">tpcn</a></span>) <span class="id"><a href="TSOCompInvs.html#tpcn">tpcn</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="ClientSim.html#conflictc">conflictc</a></span> (<span class="id"><a href="TSOGlobSem.html#cid">cid</a></span> <span class="id"><a href="TSOCompInvs.html#tpcn">tpcn</a></span>) <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id"><a href="TSOCompInvs.html#tpcn">tpcn</a></span>))) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#bi_not_unbuffered">bi_not_unbuffered</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span> <span class="id"><a href="TSOCompInvs.html#head1">head1</a></span> <span class="id"><a href="TSOCompInvs.html#tail1">tail1</a></span> <span class="id"><a href="TSOCompInvs.html#tpc1">tpc1</a></span> <span class="id"><a href="TSOCompInvs.html#headn">headn</a></span> (<span class="id"><a href="TSOCompInvs.html#tailn">tailn</a></span> ++ <span class="id"><a href="TSOCompInvs.html#tail">tail</a></span>) <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10301')">Proof.</div>
<div class="proofscript" id="proof10301">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">t</span> <span class="id">bi</span> <span class="id">head1</span> <span class="id">tail1</span> <span class="id">tpc1</span> <span class="id">headn</span> <span class="id">tailn</span> <span class="id">tpcn</span> <span class="id">l</span> <span class="id">fp</span> <span class="id">tpc</span> <span class="id">tail</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">BNU</span> <span class="id">Hstep</span> <span class="id">Hbuffer</span> <span class="id">Hconflict</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">BNU</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">subst</span> <span class="id">tpc0</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">econstructor</span>. <span class="tactic">exact</span> <span class="id">Hstep</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Hbuffer</span>. <span class="tactic">rewrite</span> <span class="id">Hbuffer</span>. <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">f_equal</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_comm_cons">app_comm_cons</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">auto</span>. <span class="tactic">destruct</span> <span class="id">tpc</span>; <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#bi_nub_refl">bi_nub_refl</a></span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Hbuffer</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">Hbuffer</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>. <span class="tactic">f_equal</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">econstructor</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="bi_nub_sw_bi_nub">bi_nub_sw_bi_nub</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">t</span> <span class="id">bi</span> <span class="id">head1</span> <span class="id">tail1</span> <span class="id">tpc1</span> <span class="id">headn</span> <span class="id">tailn</span> <span class="id">tpcn</span> <span class="id">tpc</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#bi_not_unbuffered">bi_not_unbuffered</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span> <span class="id"><a href="TSOCompInvs.html#head1">head1</a></span> <span class="id"><a href="TSOCompInvs.html#tail1">tail1</a></span> <span class="id"><a href="TSOCompInvs.html#tpc1">tpc1</a></span> <span class="id"><a href="TSOCompInvs.html#headn">headn</a></span> <span class="id"><a href="TSOCompInvs.html#tailn">tailn</a></span> <span class="id"><a href="TSOCompInvs.html#tpcn">tpcn</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#tpcn">tpcn</a></span> <span class="id"><a href="TSOGlobSem.html#sw">sw</a></span> <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#bi_not_unbuffered">bi_not_unbuffered</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span> <span class="id"><a href="TSOCompInvs.html#head1">head1</a></span> <span class="id"><a href="TSOCompInvs.html#tail1">tail1</a></span> <span class="id"><a href="TSOCompInvs.html#tpc1">tpc1</a></span> <span class="id"><a href="TSOCompInvs.html#headn">headn</a></span> <span class="id"><a href="TSOCompInvs.html#tailn">tailn</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10302')">Proof.</div>
<div class="proofscript" id="proof10302">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">t</span> <span class="id">bi</span> <span class="id">head1</span> <span class="id">tail1</span> <span class="id">tpc1</span> <span class="id">headn</span> <span class="id">tailn</span> <span class="id">tpcn</span> <span class="id">tpc</span> <span class="id">BNU</span> <span class="id">Hstep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">BNU</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">subst</span> <span class="id">tpc0</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">econstructor</span>. <span class="tactic">exact</span> <span class="id">Hstep</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOCompInvs.html#sw_step_buffer_eq">sw_step_buffer_eq</a></span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#emp_fp_not_conflictc">emp_fp_not_conflictc</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tpc</span>; <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#bi_nub_refl">bi_nub_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#sw_step_buffer_eq">sw_step_buffer_eq</a></span> <span class="kwd">in</span> <span class="id">Hstep</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">econstructor</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="bi_nub_evt_bi_nub">bi_nub_evt_bi_nub</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">t</span> <span class="id">bi</span> <span class="id">head1</span> <span class="id">tail1</span> <span class="id">tpc1</span> <span class="id">headn</span> <span class="id">tailn</span> <span class="id">tpcn</span> <span class="id">v</span> <span class="id">tpc</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#bi_not_unbuffered">bi_not_unbuffered</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span> <span class="id"><a href="TSOCompInvs.html#head1">head1</a></span> <span class="id"><a href="TSOCompInvs.html#tail1">tail1</a></span> <span class="id"><a href="TSOCompInvs.html#tpc1">tpc1</a></span> <span class="id"><a href="TSOCompInvs.html#headn">headn</a></span> <span class="id"><a href="TSOCompInvs.html#tailn">tailn</a></span> <span class="id"><a href="TSOCompInvs.html#tpcn">tpcn</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#tpcn">tpcn</a></span> (<span class="id"><a href="TSOGlobSem.html#evt">evt</a></span> <span class="id"><a href="TSOCompInvs.html#v">v</a></span>) <span class="id"><a href="Footprint.html#FP.emp">FP.emp</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#bi_not_unbuffered">bi_not_unbuffered</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#t">t</a></span> <span class="id"><a href="TSOCompInvs.html#bi">bi</a></span> <span class="id"><a href="TSOCompInvs.html#head1">head1</a></span> <span class="id"><a href="TSOCompInvs.html#tail1">tail1</a></span> <span class="id"><a href="TSOCompInvs.html#tpc1">tpc1</a></span> <span class="id"><a href="TSOCompInvs.html#headn">headn</a></span> <span class="id"><a href="TSOCompInvs.html#tailn">tailn</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10303')">Proof.</div>
<div class="proofscript" id="proof10303">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">t</span> <span class="id">bi</span> <span class="id">head1</span> <span class="id">tail1</span> <span class="id">tpc1</span> <span class="id">headn</span> <span class="id">tailn</span> <span class="id">tpcn</span> <span class="id">v</span> <span class="id">tpc</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">BNU</span> <span class="id">Hstep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">BNU</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">subst</span> <span class="id">tpc0</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">econstructor</span>. <span class="tactic">exact</span> <span class="id">Hstep</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hstep</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#emp_fp_not_conflictc">emp_fp_not_conflictc</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tpc</span>; <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#bi_nub_refl">bi_nub_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hstep</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">econstructor</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#bi_nub_insert_buffer_bi_nub">bi_nub_insert_buffer_bi_nub</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#BufWD_client_core_not_conflictc">BufWD_client_core_not_conflictc</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">inversion</span> <span class="id">Hstep</span>; <span class="tactic">subst</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#prev_inserted">prev_inserted</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">spc0</span> &amp; <span class="id">tpc0</span> &amp; <span class="id">MATCH0</span> &amp; <span class="id">PI0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">spc0</span>, <span class="id">tpc0</span>. <span class="tactic">split</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">PI0</span>. <span class="id">econstructor</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#bi_nub_sw_bi_nub">bi_nub_sw_bi_nub</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span> <span class="id">t0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">subst</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hstep</span>; <span class="tactic">subst</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">exists</span> <span class="id">bi0</span>, <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span> <span class="id">t0</span> = <span class="id"><a href="TSOCompInvs.html#bi0">bi0</a></span> :: (<span class="id">head</span> ++ <span class="id">bi</span> :: <span class="id">tail</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> [<span class="id">bi0</span> <span class="id">Hbuffer0</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unbuffer">unbuffer</a></span> <span class="kwd">in</span> <span class="id">H_unbuf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span> <span class="id">t0</span>) <span class="kwd">as</span> [|<span class="id">bi0</span> <span class="id">tail0</span>]. <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">bi0</span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">tm</span>)); <span class="id">inv</span> <span class="id">H_unbuf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">bi0</span>. <span class="tactic">f_equal</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> <span class="id">Hbuffer</span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>; <span class="tactic">auto</span>. <span class="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#prev_inserted">prev_inserted</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">Hbuffer0</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_comm_cons">app_comm_cons</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">spc0</span> &amp; <span class="id">tpc0</span> &amp; <span class="id">MATCH0</span> &amp; <span class="id">PI0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">PI0</span>. <span class="tactic">subst</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.  <span class="id">exists</span> <span class="id">spc0</span>, <span class="id">tpc0</span>. <span class="tactic">split</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Hstep</span> <span class="id">H4</span>. <span class="tactic">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id">context</span>[<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> ?<span class="id">a</span> <span class="id">_</span> <span class="id">_</span> ?<span class="id">b</span>] =&gt; <span class="tactic">generalize</span> <span class="id">a</span> <span class="id">b</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">TSOGlobSem.tm</a></span> <span class="id">tpc0</span>) <span class="id">t0</span> ++ <span class="id">head</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span> <span class="id">head1</span> <span class="id">tpc</span> <span class="id">tpc</span>' <span class="id">Hstep</span> <span class="id">H</span>. <span class="tactic">rename</span> <span class="id">tail</span>' <span class="id">into</span> <span class="id">tail1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">tpc</span>' <span class="id">Hstep</span>. <span class="id">remember</span> (<span class="id">bi0</span> :: <span class="id">head</span>) <span class="kwd">as</span> <span class="id">head0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">bi0</span> <span class="id">head</span> <span class="id">Heqhead0</span>. <span class="tactic">induction</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">subst</span>. <span class="tactic">subst</span> <span class="id">tpc</span>. <span class="tactic">destruct</span> <span class="id">tpc</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hstep</span>; <span class="tactic">subst</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm0</span> <span class="id">t0</span> = <span class="id">head0</span> ++ <span class="id">bi</span> :: <span class="id">tail</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unbuffer">unbuffer</a></span> <span class="kwd">in</span> <span class="id">H_unbuf</span>. <span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H_unbuf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span>; <span class="id">inv</span> <span class="id">H_unbuf</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>. <span class="tactic">eauto</span>. <span class="id">contradiction</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#bi_nub_step">bi_nub_step</a></span>. <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#buf_forward_deq">buf_forward_deq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#emp_fp_not_conflictc">emp_fp_not_conflictc</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#bi_nub_refl">bi_nub_refl</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id">IHbi_not_unbuffered</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#ub_step_emp_fp">ub_step_emp_fp</a></span>. <span class="tactic">eauto</span>. <span class="tactic">intro</span>; <span class="tactic">subst</span> <span class="id">fp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="TSOSemLemmas.html#ub_step_buffer_eq">ub_step_buffer_eq</a></span> <span class="kwd">in</span> <span class="id">Hbuffer</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="TSOCompInvs.html#prev_inserted">prev_inserted</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">spc0</span> &amp; <span class="id">tpc0</span> &amp; <span class="id">MATCH0</span> &amp; <span class="id">PI0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">PI0</span>; <span class="tactic">subst</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">spc0</span>, <span class="id">tpc0</span>. <span class="tactic">split</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H4</span> <span class="id">n</span> <span class="id">Hstep</span>. <span class="tactic">clear</span>. <span class="tactic">generalize</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> (<span class="id"><a href="TSOGlobSem.html#tm">tm</a></span> <span class="id">tpc0</span>) <span class="id">t</span> ++ <span class="id">head</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">head1</span>. <span class="tactic">rename</span> <span class="id">tail</span>' <span class="id">into</span> <span class="id">tail1</span>. <span class="tactic">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">H</span>. <span class="id">revert</span> <span class="id">t0</span> <span class="id">tpc</span>'. <span class="tactic">induction</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id"><a href="TSOSemLemmas.html#ub_step_buffer_eq">ub_step_buffer_eq</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">Hbuffer</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">econstructor</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">Hbuffer</span>'. <span class="tactic">eauto</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="TSOCompInvs.html#emp_fp_not_conflictc">emp_fp_not_conflictc</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tpc</span>'; <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#bi_nub_refl">bi_nub_refl</a></span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">inversion</span> <span class="id">Hstep</span>; <span class="tactic">subst</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#prev_inserted">prev_inserted</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">spc0</span> &amp; <span class="id">tpc0</span> &amp; <span class="id">MATCH0</span> &amp; <span class="id">PI0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">spc0</span>, <span class="id">tpc0</span>. <span class="tactic">split</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">PI0</span>. <span class="id">econstructor</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#bi_nub_evt_bi_nub">bi_nub_evt_bi_nub</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="step_BufWD_preserved">step_BufWD_preserved</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">SGE</span> <span class="id">TGE</span> <span class="id">i_obj</span> <span class="id">spc</span> <span class="id">ls</span> <span class="id">sfp</span> <span class="id">spc</span>' <span class="id">tpc</span> <span class="id">l</span> <span class="id">fp</span> <span class="id">tpc</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="TSOGlobSem.html#tso_globstep">tso_globstep</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> <span class="id"><a href="TSOCompInvs.html#l">l</a></span> <span class="id"><a href="TSOCompInvs.html#fp">fp</a></span> <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ETrace.html#star">ETrace.star</a></span> <span class="id"><a href="GlobSemantics.html#glob_step">glob_step</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id"><a href="TSOCompInvs.html#ls">ls</a></span> <span class="id"><a href="TSOCompInvs.html#sfp">sfp</a></span> <span class="id">spc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#MS">MS</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#spc">spc</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#BufWD">BufWD</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id"><a href="TSOCompInvs.html#tpc">tpc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#MS">MS</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id">spc</span>' <span class="id">tpc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOCompInvs.html#BufWD">BufWD</a></span> <span class="id"><a href="TSOCompInvs.html#SGE">SGE</a></span> <span class="id"><a href="TSOCompInvs.html#TGE">TGE</a></span> <span class="id"><a href="TSOCompInvs.html#i_obj">i_obj</a></span> <span class="id">tpc</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10304')">Proof.</div>
<div class="proofscript" id="proof10304">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id"><a href="TSOCompInvs.html#BufWD_preserved_if_post_states_MS">BufWD_preserved_if_post_states_MS</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">H1</span>. <span class="tactic">exact</span> <span class="id">H2</span>. <span class="tactic">exact</span> <span class="id">H</span>. <br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="TSOCompInvs.html#Invs">Invs</a></span>.</div>
<div class="footer"><hr/>Generated by coq2html</div>
</body>
</html>
