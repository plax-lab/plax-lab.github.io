<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module ValueDomain</title>
<meta name="description" content="Documentation of Coq module ValueDomain" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module ValueDomain</h1>
<div class="coq">
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Zwf</span> <span class="id">Coqlib</span> <span class="id">Maps</span> <span class="id">Integers</span> <span class="id">Floats</span> <span class="id">Lattice</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Compopts</span> <span class="id">AST</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Values</span> <span class="id">Memory</span> <span class="id">Globalenvs</span> <span class="id">Events</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Registers</span> <span class="id">RTL</span>.<br/>
<br/>
<div class="doc">The abstract domains for value analysis </div>
<br/>
<span class="kwd">Inductive</span> <span class="id">block_class</span> : <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id">BCinvalid</span><br/>
&nbsp;&nbsp;| <span class="id">BCglob</span> (<span class="id">id</span>: <span class="id">ident</span>)<br/>
&nbsp;&nbsp;| <span class="id">BCstack</span><br/>
&nbsp;&nbsp;| <span class="id">BCother</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">block_class_eq</span>: <span class="kwd">forall</span> (<span class="id">x</span> <span class="id">y</span>: <span class="id">block_class</span>), {<span class="id">x</span>=<span class="id">y</span>} + {<span class="id">x</span>&lt;&gt;<span class="id">y</span>}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2758')">Proof.</div>
<div class="proofscript" id="proof2758">
 <span class="id">decide</span> <span class="id">equality</span>. <span class="tactic">apply</span> <span class="id">peq</span>. Defined.</div>
<br/>
<span class="kwd">Record</span> <span class="id">block_classification</span> : <span class="kwd">Type</span> := <span class="id">BC</span> {<br/>
&nbsp;&nbsp;<span class="id">bc_img</span> :&gt; <span class="id">block</span> -&gt; <span class="id">block_class</span>;<br/>
&nbsp;&nbsp;<span class="id">bc_stack</span>: <span class="kwd">forall</span> <span class="id">b1</span> <span class="id">b2</span>, <span class="id">bc_img</span> <span class="id">b1</span> = <span class="id">BCstack</span> -&gt; <span class="id">bc_img</span> <span class="id">b2</span> = <span class="id">BCstack</span> -&gt; <span class="id">b1</span> = <span class="id">b2</span>;<br/>
&nbsp;&nbsp;<span class="id">bc_glob</span>: <span class="kwd">forall</span> <span class="id">b1</span> <span class="id">b2</span> <span class="id">id</span>, <span class="id">bc_img</span> <span class="id">b1</span> = <span class="id">BCglob</span> <span class="id">id</span> -&gt; <span class="id">bc_img</span> <span class="id">b2</span> = <span class="id">BCglob</span> <span class="id">id</span> -&gt; <span class="id">b1</span> = <span class="id">b2</span><br/>
}.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">bc_below</span> (<span class="id">bc</span>: <span class="id">block_classification</span>) (<span class="id">bound</span>: <span class="id">block</span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span>, <span class="id">bc</span> <span class="id">b</span> &lt;&gt; <span class="id">BCinvalid</span> -&gt; <span class="id">Plt</span> <span class="id">b</span> <span class="id">bound</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">bc_below_invalid</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">bc</span> <span class="id">bound</span>, ~<span class="id">Plt</span> <span class="id">b</span> <span class="id">bound</span> -&gt; <span class="id">bc_below</span> <span class="id">bc</span> <span class="id">bound</span> -&gt; <span class="id">bc</span> <span class="id">b</span> = <span class="id">BCinvalid</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2759')">Proof.</div>
<div class="proofscript" id="proof2759">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> (<span class="id">block_class_eq</span> (<span class="id">bc</span> <span class="id">b</span>) <span class="id">BCinvalid</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id">H0</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Extern</span> 2 (<span class="id">_</span> = <span class="id">_</span>) =&gt; <span class="tactic">congruence</span> : <span class="id">va</span>.<br/>
<span class="kwd">Hint</span> <span class="kwd">Extern</span> 2 (<span class="id">_</span> &lt;&gt; <span class="id">_</span>) =&gt; <span class="tactic">congruence</span> : <span class="id">va</span>.<br/>
<span class="kwd">Hint</span> <span class="kwd">Extern</span> 2 (<span class="id">_</span> &lt; <span class="id">_</span>) =&gt; <span class="id">xomega</span> : <span class="id">va</span>.<br/>
<span class="kwd">Hint</span> <span class="kwd">Extern</span> 2 (<span class="id">_</span> &lt;= <span class="id">_</span>) =&gt; <span class="id">xomega</span> : <span class="id">va</span>.<br/>
<span class="kwd">Hint</span> <span class="kwd">Extern</span> 2 (<span class="id">_</span> &gt; <span class="id">_</span>) =&gt; <span class="id">xomega</span> : <span class="id">va</span>.<br/>
<span class="kwd">Hint</span> <span class="kwd">Extern</span> 2 (<span class="id">_</span> &gt;= <span class="id">_</span>) =&gt; <span class="id">xomega</span> : <span class="id">va</span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id">MATCH</span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id">bc</span>: <span class="id">block_classification</span>.<br/>
<br/>
<h1> Abstracting the result of conditions (type <span class="bracket"><span class="id">option</span> <span class="id">bool</span></span>) </h1>
<br/>
<span class="kwd">Inductive</span> <span class="id">abool</span> :=<br/>
&nbsp;&nbsp;| <span class="id">Bnone</span>               <span class="docright">(* always <span class="bracket"><span class="id">None</span></span> (undefined)  *)</span><br/>
&nbsp;&nbsp;| <span class="id">Just</span> (<span class="id">b</span>: <span class="id">bool</span>)      <span class="docright">(* always <span class="bracket"><span class="id">Some</span> <span class="id">b</span></span> (defined and known to be <span class="bracket"><span class="id">b</span></span>)  *)</span><br/>
&nbsp;&nbsp;| <span class="id">Maybe</span> (<span class="id">b</span>: <span class="id">bool</span>)     <span class="docright">(* either <span class="bracket"><span class="id">None</span></span> or <span class="bracket"><span class="id">Some</span> <span class="id">b</span></span> (known to be <span class="bracket"><span class="id">b</span></span> if defined)  *)</span><br/>
&nbsp;&nbsp;| <span class="id">Btop</span>.               <span class="docright">(* unknown, all results are possible  *)</span><br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">cmatch</span>: <span class="id">option</span> <span class="id">bool</span> -&gt; <span class="id">abool</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id">cmatch_none</span>: <span class="id">cmatch</span> <span class="id">None</span> <span class="id">Bnone</span><br/>
&nbsp;&nbsp;| <span class="id">cmatch_just</span>: <span class="kwd">forall</span> <span class="id">b</span>, <span class="id">cmatch</span> (<span class="id">Some</span> <span class="id">b</span>) (<span class="id">Just</span> <span class="id">b</span>)<br/>
&nbsp;&nbsp;| <span class="id">cmatch_maybe_none</span>: <span class="kwd">forall</span> <span class="id">b</span>, <span class="id">cmatch</span> <span class="id">None</span> (<span class="id">Maybe</span> <span class="id">b</span>)<br/>
&nbsp;&nbsp;| <span class="id">cmatch_maybe_some</span>: <span class="kwd">forall</span> <span class="id">b</span>, <span class="id">cmatch</span> (<span class="id">Some</span> <span class="id">b</span>) (<span class="id">Maybe</span> <span class="id">b</span>)<br/>
&nbsp;&nbsp;| <span class="id">cmatch_top</span>: <span class="kwd">forall</span> <span class="id">ob</span>, <span class="id">cmatch</span> <span class="id">ob</span> <span class="id">Btop</span>.<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">cmatch</span> : <span class="id">va</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">club</span> (<span class="id">x</span> <span class="id">y</span>: <span class="id">abool</span>) : <span class="id">abool</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span>, <span class="id">y</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Bnone</span>, <span class="id">Bnone</span> =&gt; <span class="id">Bnone</span><br/>
&nbsp;&nbsp;| <span class="id">Bnone</span>, (<span class="id">Just</span> <span class="id">b</span> | <span class="id">Maybe</span> <span class="id">b</span>) =&gt; <span class="id">Maybe</span> <span class="id">b</span><br/>
&nbsp;&nbsp;| (<span class="id">Just</span> <span class="id">b</span> | <span class="id">Maybe</span> <span class="id">b</span>), <span class="id">Bnone</span> =&gt; <span class="id">Maybe</span> <span class="id">b</span><br/>
&nbsp;&nbsp;| <span class="id">Just</span> <span class="id">b1</span>, <span class="id">Just</span> <span class="id">b2</span> =&gt; <span class="kwd">if</span> <span class="id">eqb</span> <span class="id">b1</span> <span class="id">b2</span> <span class="kwd">then</span> <span class="id">x</span> <span class="kwd">else</span> <span class="id">Btop</span><br/>
&nbsp;&nbsp;| <span class="id">Maybe</span> <span class="id">b1</span>, <span class="id">Maybe</span> <span class="id">b2</span> =&gt; <span class="kwd">if</span> <span class="id">eqb</span> <span class="id">b1</span> <span class="id">b2</span> <span class="kwd">then</span> <span class="id">x</span> <span class="kwd">else</span> <span class="id">Btop</span><br/>
&nbsp;&nbsp;| <span class="id">Maybe</span> <span class="id">b1</span>, <span class="id">Just</span> <span class="id">b2</span> =&gt; <span class="kwd">if</span> <span class="id">eqb</span> <span class="id">b1</span> <span class="id">b2</span> <span class="kwd">then</span> <span class="id">x</span> <span class="kwd">else</span> <span class="id">Btop</span><br/>
&nbsp;&nbsp;| <span class="id">Just</span> <span class="id">b1</span>, <span class="id">Maybe</span> <span class="id">b2</span> =&gt; <span class="kwd">if</span> <span class="id">eqb</span> <span class="id">b1</span> <span class="id">b2</span> <span class="kwd">then</span> <span class="id">y</span> <span class="kwd">else</span> <span class="id">Btop</span><br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">Btop</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">cmatch_lub_l</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ob</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">cmatch</span> <span class="id">ob</span> <span class="id">x</span> -&gt; <span class="id">cmatch</span> <span class="id">ob</span> (<span class="id">club</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2760')">Proof.</div>
<div class="proofscript" id="proof2760">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">club</span>; <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">destruct</span> <span class="id">y</span>; <span class="tactic">try</span> <span class="id">constructor</span>;<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">eqb</span> <span class="id">b</span> <span class="id">b0</span>) <span class="id">eqn</span>:<span class="id">EQ</span>; <span class="tactic">try</span> <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> <span class="id">b0</span> <span class="kwd">with</span> <span class="id">b</span> <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id">eqb_prop</span>; <span class="tactic">auto</span>). <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">cmatch_lub_r</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ob</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">cmatch</span> <span class="id">ob</span> <span class="id">y</span> -&gt; <span class="id">cmatch</span> <span class="id">ob</span> (<span class="id">club</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2761')">Proof.</div>
<div class="proofscript" id="proof2761">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">club</span>; <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">try</span> <span class="id">constructor</span>;<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">eqb</span> <span class="id">b0</span> <span class="id">b</span>) <span class="id">eqn</span>:<span class="id">EQ</span>; <span class="tactic">try</span> <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> <span class="id">b</span> <span class="kwd">with</span> <span class="id">b0</span> <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id">eqb_prop</span>; <span class="tactic">auto</span>). <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> <span class="id">b</span> <span class="kwd">with</span> <span class="id">b0</span> <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id">eqb_prop</span>; <span class="tactic">auto</span>). <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> <span class="id">b</span> <span class="kwd">with</span> <span class="id">b0</span> <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id">eqb_prop</span>; <span class="tactic">auto</span>). <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">cnot</span> (<span class="id">x</span>: <span class="id">abool</span>) : <span class="id">abool</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Just</span> <span class="id">b</span> =&gt; <span class="id">Just</span> (<span class="id">negb</span> <span class="id">b</span>)<br/>
&nbsp;&nbsp;| <span class="id">Maybe</span> <span class="id">b</span> =&gt; <span class="id">Maybe</span> (<span class="id">negb</span> <span class="id">b</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">x</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">cnot_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ob</span> <span class="id">x</span>, <span class="id">cmatch</span> <span class="id">ob</span> <span class="id">x</span> -&gt; <span class="id">cmatch</span> (<span class="id">option_map</span> <span class="id">negb</span> <span class="id">ob</span>) (<span class="id">cnot</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2762')">Proof.</div>
<div class="proofscript" id="proof2762">
&nbsp;&nbsp;<span class="tactic">destruct</span> 1; <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<h1> Abstracting pointers </h1>
<br/>
<span class="kwd">Inductive</span> <span class="id">aptr</span> : <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id">Pbot</span>                         <span class="docright">(* bottom (empty set of pointers)  *)</span><br/>
&nbsp;&nbsp;| <span class="id">Gl</span> (<span class="id">id</span>: <span class="id">ident</span>) (<span class="id">ofs</span>: <span class="id">ptrofs</span>) <span class="docright">(* pointer into the block for global variable <span class="bracket"><span class="id">id</span></span> at offset <span class="bracket"><span class="id">ofs</span></span>  *)</span><br/>
&nbsp;&nbsp;| <span class="id">Glo</span> (<span class="id">id</span>: <span class="id">ident</span>)              <span class="docright">(* pointer anywhere into the block for global <span class="bracket"><span class="id">id</span></span>  *)</span><br/>
&nbsp;&nbsp;| <span class="id">Glob</span>                         <span class="docright">(* pointer into any global variable  *)</span><br/>
&nbsp;&nbsp;| <span class="id">Stk</span> (<span class="id">ofs</span>: <span class="id">ptrofs</span>)            <span class="docright">(* pointer into the current stack frame at offset <span class="bracket"><span class="id">ofs</span></span>  *)</span><br/>
&nbsp;&nbsp;| <span class="id">Stack</span>                        <span class="docright">(* pointer anywhere into the current stack frame  *)</span><br/>
&nbsp;&nbsp;| <span class="id">Nonstack</span>                     <span class="docright">(* pointer anywhere but into the current stack frame  *)</span><br/>
&nbsp;&nbsp;| <span class="id">Ptop</span>.                        <span class="docright">(* any valid pointer  *)</span><br/>
<br/>
<span class="kwd">Definition</span> <span class="id">eq_aptr</span>: <span class="kwd">forall</span> (<span class="id">p1</span> <span class="id">p2</span>: <span class="id">aptr</span>), {<span class="id">p1</span>=<span class="id">p2</span>} + {<span class="id">p1</span>&lt;&gt;<span class="id">p2</span>}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2763')">Proof.</div>
<div class="proofscript" id="proof2763">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">generalize</span> <span class="id">ident_eq</span>, <span class="id">Ptrofs.eq_dec</span>; <span class="tactic">intros</span>. <span class="id">decide</span> <span class="id">equality</span>.<br/>
Defined.</div>
<br/>
<span class="kwd">Inductive</span> <span class="id">pmatch</span> (<span class="id">b</span>: <span class="id">block</span>) (<span class="id">ofs</span>: <span class="id">ptrofs</span>): <span class="id">aptr</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id">pmatch_gl</span>: <span class="kwd">forall</span> <span class="id">id</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bc</span> <span class="id">b</span> = <span class="id">BCglob</span> <span class="id">id</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pmatch</span> <span class="id">b</span> <span class="id">ofs</span> (<span class="id">Gl</span> <span class="id">id</span> <span class="id">ofs</span>)<br/>
&nbsp;&nbsp;| <span class="id">pmatch_glo</span>: <span class="kwd">forall</span> <span class="id">id</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bc</span> <span class="id">b</span> = <span class="id">BCglob</span> <span class="id">id</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pmatch</span> <span class="id">b</span> <span class="id">ofs</span> (<span class="id">Glo</span> <span class="id">id</span>)<br/>
&nbsp;&nbsp;| <span class="id">pmatch_glob</span>: <span class="kwd">forall</span> <span class="id">id</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bc</span> <span class="id">b</span> = <span class="id">BCglob</span> <span class="id">id</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pmatch</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">Glob</span><br/>
&nbsp;&nbsp;| <span class="id">pmatch_stk</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bc</span> <span class="id">b</span> = <span class="id">BCstack</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pmatch</span> <span class="id">b</span> <span class="id">ofs</span> (<span class="id">Stk</span> <span class="id">ofs</span>)<br/>
&nbsp;&nbsp;| <span class="id">pmatch_stack</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bc</span> <span class="id">b</span> = <span class="id">BCstack</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pmatch</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">Stack</span><br/>
&nbsp;&nbsp;| <span class="id">pmatch_nonstack</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bc</span> <span class="id">b</span> &lt;&gt; <span class="id">BCstack</span> -&gt; <span class="id">bc</span> <span class="id">b</span> &lt;&gt; <span class="id">BCinvalid</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pmatch</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">Nonstack</span><br/>
&nbsp;&nbsp;| <span class="id">pmatch_top</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bc</span> <span class="id">b</span> &lt;&gt; <span class="id">BCinvalid</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pmatch</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">Ptop</span>.<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">pmatch</span>: <span class="id">va</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">pge</span>: <span class="id">aptr</span> -&gt; <span class="id">aptr</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id">pge_top</span>: <span class="kwd">forall</span> <span class="id">p</span>, <span class="id">pge</span> <span class="id">Ptop</span> <span class="id">p</span><br/>
&nbsp;&nbsp;| <span class="id">pge_bot</span>: <span class="kwd">forall</span> <span class="id">p</span>, <span class="id">pge</span> <span class="id">p</span> <span class="id">Pbot</span><br/>
&nbsp;&nbsp;| <span class="id">pge_refl</span>: <span class="kwd">forall</span> <span class="id">p</span>, <span class="id">pge</span> <span class="id">p</span> <span class="id">p</span><br/>
&nbsp;&nbsp;| <span class="id">pge_glo_gl</span>: <span class="kwd">forall</span> <span class="id">id</span> <span class="id">ofs</span>, <span class="id">pge</span> (<span class="id">Glo</span> <span class="id">id</span>) (<span class="id">Gl</span> <span class="id">id</span> <span class="id">ofs</span>)<br/>
&nbsp;&nbsp;| <span class="id">pge_glob_gl</span>: <span class="kwd">forall</span> <span class="id">id</span> <span class="id">ofs</span>, <span class="id">pge</span> <span class="id">Glob</span> (<span class="id">Gl</span> <span class="id">id</span> <span class="id">ofs</span>)<br/>
&nbsp;&nbsp;| <span class="id">pge_glob_glo</span>: <span class="kwd">forall</span> <span class="id">id</span>, <span class="id">pge</span> <span class="id">Glob</span> (<span class="id">Glo</span> <span class="id">id</span>)<br/>
&nbsp;&nbsp;| <span class="id">pge_ns_gl</span>: <span class="kwd">forall</span> <span class="id">id</span> <span class="id">ofs</span>, <span class="id">pge</span> <span class="id">Nonstack</span> (<span class="id">Gl</span> <span class="id">id</span> <span class="id">ofs</span>)<br/>
&nbsp;&nbsp;| <span class="id">pge_ns_glo</span>: <span class="kwd">forall</span> <span class="id">id</span>, <span class="id">pge</span> <span class="id">Nonstack</span> (<span class="id">Glo</span> <span class="id">id</span>)<br/>
&nbsp;&nbsp;| <span class="id">pge_ns_glob</span>: <span class="id">pge</span> <span class="id">Nonstack</span> <span class="id">Glob</span><br/>
&nbsp;&nbsp;| <span class="id">pge_stack_stk</span>: <span class="kwd">forall</span> <span class="id">ofs</span>, <span class="id">pge</span> <span class="id">Stack</span> (<span class="id">Stk</span> <span class="id">ofs</span>).<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">pge</span>: <span class="id">va</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">pge_trans</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">p</span> <span class="id">q</span>, <span class="id">pge</span> <span class="id">p</span> <span class="id">q</span> -&gt; <span class="kwd">forall</span> <span class="id">r</span>, <span class="id">pge</span> <span class="id">q</span> <span class="id">r</span> -&gt; <span class="id">pge</span> <span class="id">p</span> <span class="id">r</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2764')">Proof.</div>
<div class="proofscript" id="proof2764">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">intros</span> <span class="id">r</span> <span class="id">PM</span>; <span class="id">inv</span> <span class="id">PM</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">pmatch_ge</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">p</span> <span class="id">q</span>, <span class="id">pge</span> <span class="id">p</span> <span class="id">q</span> -&gt; <span class="id">pmatch</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">q</span> -&gt; <span class="id">pmatch</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">p</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2765')">Proof.</div>
<div class="proofscript" id="proof2765">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">intros</span> <span class="id">PM</span>; <span class="id">inv</span> <span class="id">PM</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">pmatch_top</span>': <span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">p</span>, <span class="id">pmatch</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">p</span> -&gt; <span class="id">pmatch</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">Ptop</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2766')">Proof.</div>
<div class="proofscript" id="proof2766">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">pmatch_ge</span> <span class="kwd">with</span> <span class="id">p</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">plub</span> (<span class="id">p</span> <span class="id">q</span>: <span class="id">aptr</span>) : <span class="id">aptr</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">p</span>, <span class="id">q</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Pbot</span>, <span class="id">_</span> =&gt; <span class="id">q</span><br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">Pbot</span> =&gt; <span class="id">p</span><br/>
&nbsp;&nbsp;| <span class="id">Gl</span> <span class="id">id1</span> <span class="id">ofs1</span>, <span class="id">Gl</span> <span class="id">id2</span> <span class="id">ofs2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">ident_eq</span> <span class="id">id1</span> <span class="id">id2</span> <span class="kwd">then</span> <span class="kwd">if</span> <span class="id">Ptrofs.eq_dec</span> <span class="id">ofs1</span> <span class="id">ofs2</span> <span class="kwd">then</span> <span class="id">p</span> <span class="kwd">else</span> <span class="id">Glo</span> <span class="id">id1</span> <span class="kwd">else</span> <span class="id">Glob</span><br/>
&nbsp;&nbsp;| <span class="id">Gl</span> <span class="id">id1</span> <span class="id">ofs1</span>, <span class="id">Glo</span> <span class="id">id2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">ident_eq</span> <span class="id">id1</span> <span class="id">id2</span> <span class="kwd">then</span> <span class="id">q</span> <span class="kwd">else</span> <span class="id">Glob</span><br/>
&nbsp;&nbsp;| <span class="id">Glo</span> <span class="id">id1</span>, <span class="id">Gl</span> <span class="id">id2</span> <span class="id">ofs2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">ident_eq</span> <span class="id">id1</span> <span class="id">id2</span> <span class="kwd">then</span> <span class="id">p</span> <span class="kwd">else</span> <span class="id">Glob</span><br/>
&nbsp;&nbsp;| <span class="id">Glo</span> <span class="id">id1</span>, <span class="id">Glo</span> <span class="id">id2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">ident_eq</span> <span class="id">id1</span> <span class="id">id2</span> <span class="kwd">then</span> <span class="id">p</span> <span class="kwd">else</span> <span class="id">Glob</span><br/>
&nbsp;&nbsp;| (<span class="id">Gl</span> <span class="id">_</span> <span class="id">_</span> | <span class="id">Glo</span> <span class="id">_</span> | <span class="id">Glob</span>), <span class="id">Glob</span> =&gt; <span class="id">Glob</span><br/>
&nbsp;&nbsp;| <span class="id">Glob</span>, (<span class="id">Gl</span> <span class="id">_</span> <span class="id">_</span> | <span class="id">Glo</span> <span class="id">_</span>) =&gt; <span class="id">Glob</span><br/>
&nbsp;&nbsp;| (<span class="id">Gl</span> <span class="id">_</span> <span class="id">_</span> | <span class="id">Glo</span> <span class="id">_</span> | <span class="id">Glob</span> | <span class="id">Nonstack</span>), <span class="id">Nonstack</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Nonstack</span><br/>
&nbsp;&nbsp;| <span class="id">Nonstack</span>, (<span class="id">Gl</span> <span class="id">_</span> <span class="id">_</span> | <span class="id">Glo</span> <span class="id">_</span> | <span class="id">Glob</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Nonstack</span><br/>
&nbsp;&nbsp;| <span class="id">Stk</span> <span class="id">ofs1</span>, <span class="id">Stk</span> <span class="id">ofs2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">Ptrofs.eq_dec</span> <span class="id">ofs1</span> <span class="id">ofs2</span> <span class="kwd">then</span> <span class="id">p</span> <span class="kwd">else</span> <span class="id">Stack</span><br/>
&nbsp;&nbsp;| (<span class="id">Stk</span> <span class="id">_</span> | <span class="id">Stack</span>), <span class="id">Stack</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Stack</span><br/>
&nbsp;&nbsp;| <span class="id">Stack</span>, <span class="id">Stk</span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Stack</span><br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">Ptop</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">plub_comm</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">p</span> <span class="id">q</span>, <span class="id">plub</span> <span class="id">p</span> <span class="id">q</span> = <span class="id">plub</span> <span class="id">q</span> <span class="id">p</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2767')">Proof.</div>
<div class="proofscript" id="proof2767">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">unfold</span> <span class="id">plub</span>; <span class="tactic">destruct</span> <span class="id">p</span>; <span class="tactic">destruct</span> <span class="id">q</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">ident_eq</span> <span class="id">id</span> <span class="id">id0</span>). <span class="tactic">subst</span> <span class="id">id0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">dec_eq_true</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Ptrofs.eq_dec</span> <span class="id">ofs</span> <span class="id">ofs0</span>). <span class="tactic">subst</span> <span class="id">ofs0</span>. <span class="tactic">rewrite</span> <span class="id">dec_eq_true</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">dec_eq_false</span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">dec_eq_false</span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">ident_eq</span> <span class="id">id</span> <span class="id">id0</span>). <span class="tactic">subst</span> <span class="id">id0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">dec_eq_true</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">dec_eq_false</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">ident_eq</span> <span class="id">id</span> <span class="id">id0</span>). <span class="tactic">subst</span> <span class="id">id0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">dec_eq_true</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">dec_eq_false</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">ident_eq</span> <span class="id">id</span> <span class="id">id0</span>). <span class="tactic">subst</span> <span class="id">id0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">dec_eq_true</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">dec_eq_false</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Ptrofs.eq_dec</span> <span class="id">ofs</span> <span class="id">ofs0</span>). <span class="tactic">subst</span> <span class="id">ofs0</span>. <span class="tactic">rewrite</span> <span class="id">dec_eq_true</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">dec_eq_false</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">pge_lub_l</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">p</span> <span class="id">q</span>, <span class="id">pge</span> (<span class="id">plub</span> <span class="id">p</span> <span class="id">q</span>) <span class="id">p</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2768')">Proof.</div>
<div class="proofscript" id="proof2768">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">plub</span>; <span class="tactic">destruct</span> <span class="id">p</span>, <span class="id">q</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">ident_eq</span> <span class="id">id</span> <span class="id">id0</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Ptrofs.eq_dec</span> <span class="id">ofs</span> <span class="id">ofs0</span>); <span class="tactic">subst</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">ident_eq</span> <span class="id">id</span> <span class="id">id0</span>); <span class="tactic">subst</span>; <span class="id">constructor</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">ident_eq</span> <span class="id">id</span> <span class="id">id0</span>); <span class="tactic">subst</span>; <span class="id">constructor</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">ident_eq</span> <span class="id">id</span> <span class="id">id0</span>); <span class="tactic">subst</span>; <span class="id">constructor</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">Ptrofs.eq_dec</span> <span class="id">ofs</span> <span class="id">ofs0</span>); <span class="tactic">subst</span>; <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">pge_lub_r</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">p</span> <span class="id">q</span>, <span class="id">pge</span> (<span class="id">plub</span> <span class="id">p</span> <span class="id">q</span>) <span class="id">q</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2769')">Proof.</div>
<div class="proofscript" id="proof2769">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">plub_comm</span>. <span class="tactic">apply</span> <span class="id">pge_lub_l</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">pmatch_lub_l</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">p</span> <span class="id">q</span>, <span class="id">pmatch</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">p</span> -&gt; <span class="id">pmatch</span> <span class="id">b</span> <span class="id">ofs</span> (<span class="id">plub</span> <span class="id">p</span> <span class="id">q</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2770')">Proof.</div>
<div class="proofscript" id="proof2770">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id">pmatch_ge</span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">pge_lub_l</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">pmatch_lub_r</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">p</span> <span class="id">q</span>, <span class="id">pmatch</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">q</span> -&gt; <span class="id">pmatch</span> <span class="id">b</span> <span class="id">ofs</span> (<span class="id">plub</span> <span class="id">p</span> <span class="id">q</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2771')">Proof.</div>
<div class="proofscript" id="proof2771">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id">pmatch_ge</span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">pge_lub_r</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">plub_least</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r</span> <span class="id">p</span> <span class="id">q</span>, <span class="id">pge</span> <span class="id">r</span> <span class="id">p</span> -&gt; <span class="id">pge</span> <span class="id">r</span> <span class="id">q</span> -&gt; <span class="id">pge</span> <span class="id">r</span> (<span class="id">plub</span> <span class="id">p</span> <span class="id">q</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2772')">Proof.</div>
<div class="proofscript" id="proof2772">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H0</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="id">constructor</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">p</span>; <span class="id">constructor</span>.<br/>
- <span class="tactic">unfold</span> <span class="id">plub</span>; <span class="tactic">destruct</span> <span class="id">q</span>; <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">dec_eq_true</span>; <span class="id">constructor</span>.<br/>
- <span class="tactic">rewrite</span> <span class="id">dec_eq_true</span>; <span class="id">constructor</span>.<br/>
- <span class="tactic">rewrite</span> <span class="id">dec_eq_true</span>; <span class="id">constructor</span>.<br/>
- <span class="tactic">rewrite</span> <span class="id">dec_eq_true</span>. <span class="tactic">destruct</span> (<span class="id">Ptrofs.eq_dec</span> <span class="id">ofs</span> <span class="id">ofs0</span>); <span class="id">constructor</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">ident_eq</span> <span class="id">id</span> <span class="id">id0</span>). <span class="tactic">destruct</span> (<span class="id">Ptrofs.eq_dec</span> <span class="id">ofs</span> <span class="id">ofs0</span>); <span class="id">constructor</span>. <span class="id">constructor</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">ident_eq</span> <span class="id">id</span> <span class="id">id0</span>); <span class="id">constructor</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">ident_eq</span> <span class="id">id</span> <span class="id">id0</span>); <span class="id">constructor</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">ident_eq</span> <span class="id">id</span> <span class="id">id0</span>); <span class="id">constructor</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">ident_eq</span> <span class="id">id</span> <span class="id">id0</span>). <span class="tactic">destruct</span> (<span class="id">Ptrofs.eq_dec</span> <span class="id">ofs</span> <span class="id">ofs0</span>); <span class="id">constructor</span>. <span class="id">constructor</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">ident_eq</span> <span class="id">id</span> <span class="id">id0</span>); <span class="id">constructor</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">ident_eq</span> <span class="id">id</span> <span class="id">id0</span>); <span class="id">constructor</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">ident_eq</span> <span class="id">id</span> <span class="id">id0</span>); <span class="id">constructor</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">Ptrofs.eq_dec</span> <span class="id">ofs</span> <span class="id">ofs0</span>); <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">pincl</span> (<span class="id">p</span> <span class="id">q</span>: <span class="id">aptr</span>) : <span class="id">bool</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">p</span>, <span class="id">q</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Pbot</span>, <span class="id">_</span> =&gt; <span class="id">true</span><br/>
&nbsp;&nbsp;| <span class="id">Gl</span> <span class="id">id1</span> <span class="id">ofs1</span>, <span class="id">Gl</span> <span class="id">id2</span> <span class="id">ofs2</span> =&gt; <span class="id">peq</span> <span class="id">id1</span> <span class="id">id2</span> &amp;&amp; <span class="id">Ptrofs.eq_dec</span> <span class="id">ofs1</span> <span class="id">ofs2</span><br/>
&nbsp;&nbsp;| <span class="id">Gl</span> <span class="id">id1</span> <span class="id">ofs1</span>, <span class="id">Glo</span> <span class="id">id2</span> =&gt; <span class="id">peq</span> <span class="id">id1</span> <span class="id">id2</span><br/>
&nbsp;&nbsp;| <span class="id">Glo</span> <span class="id">id1</span>, <span class="id">Glo</span> <span class="id">id2</span> =&gt; <span class="id">peq</span> <span class="id">id1</span> <span class="id">id2</span><br/>
&nbsp;&nbsp;| (<span class="id">Gl</span> <span class="id">_</span> <span class="id">_</span> | <span class="id">Glo</span> <span class="id">_</span> | <span class="id">Glob</span>), <span class="id">Glob</span> =&gt; <span class="id">true</span><br/>
&nbsp;&nbsp;| (<span class="id">Gl</span> <span class="id">_</span> <span class="id">_</span> | <span class="id">Glo</span> <span class="id">_</span> | <span class="id">Glob</span> | <span class="id">Nonstack</span>), <span class="id">Nonstack</span> =&gt; <span class="id">true</span><br/>
&nbsp;&nbsp;| <span class="id">Stk</span> <span class="id">ofs1</span>, <span class="id">Stk</span> <span class="id">ofs2</span> =&gt; <span class="id">Ptrofs.eq_dec</span> <span class="id">ofs1</span> <span class="id">ofs2</span><br/>
&nbsp;&nbsp;| <span class="id">Stk</span> <span class="id">ofs1</span>, <span class="id">Stack</span> =&gt; <span class="id">true</span><br/>
&nbsp;&nbsp;| <span class="id">Stack</span>, <span class="id">Stack</span> =&gt; <span class="id">true</span><br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">Ptop</span> =&gt; <span class="id">true</span><br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">false</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">pincl_ge</span>: <span class="kwd">forall</span> <span class="id">p</span> <span class="id">q</span>, <span class="id">pincl</span> <span class="id">p</span> <span class="id">q</span> = <span class="id">true</span> -&gt; <span class="id">pge</span> <span class="id">q</span> <span class="id">p</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2773')">Proof.</div>
<div class="proofscript" id="proof2773">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">pincl</span>; <span class="tactic">destruct</span> <span class="id">p</span>, <span class="id">q</span>; <span class="tactic">intros</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>;<br/>
&nbsp;&nbsp;<span class="id">InvBooleans</span>; <span class="tactic">subst</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">pincl_ge_2</span>: <span class="kwd">forall</span> <span class="id">p</span> <span class="id">q</span>, <span class="id">pge</span> <span class="id">p</span> <span class="id">q</span> -&gt; <span class="id">pincl</span> <span class="id">q</span> <span class="id">p</span> = <span class="id">true</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2774')">Proof.</div>
<div class="proofscript" id="proof2774">
&nbsp;&nbsp;<span class="tactic">destruct</span> 1; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">p</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">p</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>; <span class="tactic">rewrite</span> ! <span class="id">proj_sumbool_is_true</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">rewrite</span> ! <span class="id">proj_sumbool_is_true</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">pincl_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">p</span> <span class="id">q</span>,<br/>
&nbsp;&nbsp;<span class="id">pincl</span> <span class="id">p</span> <span class="id">q</span> = <span class="id">true</span> -&gt; <span class="id">pmatch</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">p</span> -&gt; <span class="id">pmatch</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">q</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2775')">Proof.</div>
<div class="proofscript" id="proof2775">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id">pmatch_ge</span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">pincl_ge</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">padd</span> (<span class="id">p</span>: <span class="id">aptr</span>) (<span class="id">n</span>: <span class="id">ptrofs</span>) : <span class="id">aptr</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">p</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Gl</span> <span class="id">id</span> <span class="id">ofs</span> =&gt; <span class="id">Gl</span> <span class="id">id</span> (<span class="id">Ptrofs.add</span> <span class="id">ofs</span> <span class="id">n</span>)<br/>
&nbsp;&nbsp;| <span class="id">Stk</span> <span class="id">ofs</span> =&gt; <span class="id">Stk</span> (<span class="id">Ptrofs.add</span> <span class="id">ofs</span> <span class="id">n</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">p</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">padd_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">p</span> <span class="id">delta</span>,<br/>
&nbsp;&nbsp;<span class="id">pmatch</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">p</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">pmatch</span> <span class="id">b</span> (<span class="id">Ptrofs.add</span> <span class="id">ofs</span> <span class="id">delta</span>) (<span class="id">padd</span> <span class="id">p</span> <span class="id">delta</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2776')">Proof.</div>
<div class="proofscript" id="proof2776">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span> <span class="id">padd</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">psub</span> (<span class="id">p</span>: <span class="id">aptr</span>) (<span class="id">n</span>: <span class="id">ptrofs</span>) : <span class="id">aptr</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">p</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Gl</span> <span class="id">id</span> <span class="id">ofs</span> =&gt; <span class="id">Gl</span> <span class="id">id</span> (<span class="id">Ptrofs.sub</span> <span class="id">ofs</span> <span class="id">n</span>)<br/>
&nbsp;&nbsp;| <span class="id">Stk</span> <span class="id">ofs</span> =&gt; <span class="id">Stk</span> (<span class="id">Ptrofs.sub</span> <span class="id">ofs</span> <span class="id">n</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">p</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">psub_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">p</span> <span class="id">delta</span>,<br/>
&nbsp;&nbsp;<span class="id">pmatch</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">p</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">pmatch</span> <span class="id">b</span> (<span class="id">Ptrofs.sub</span> <span class="id">ofs</span> <span class="id">delta</span>) (<span class="id">psub</span> <span class="id">p</span> <span class="id">delta</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2777')">Proof.</div>
<div class="proofscript" id="proof2777">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span> <span class="id">psub</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">poffset</span> (<span class="id">p</span>: <span class="id">aptr</span>) : <span class="id">aptr</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">p</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Gl</span> <span class="id">id</span> <span class="id">ofs</span> =&gt; <span class="id">Glo</span> <span class="id">id</span><br/>
&nbsp;&nbsp;| <span class="id">Stk</span> <span class="id">ofs</span> =&gt; <span class="id">Stack</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">p</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">poffset_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs1</span> <span class="id">ofs2</span> <span class="id">p</span>,<br/>
&nbsp;&nbsp;<span class="id">pmatch</span> <span class="id">b</span> <span class="id">ofs1</span> <span class="id">p</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">pmatch</span> <span class="id">b</span> <span class="id">ofs2</span> (<span class="id">poffset</span> <span class="id">p</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2778')">Proof.</div>
<div class="proofscript" id="proof2778">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span> <span class="id">poffset</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">cmp_different_blocks</span> (<span class="id">c</span>: <span class="id">comparison</span>) : <span class="id">abool</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">c</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Ceq</span> =&gt; <span class="id">Maybe</span> <span class="id">false</span><br/>
&nbsp;&nbsp;| <span class="id">Cne</span> =&gt; <span class="id">Maybe</span> <span class="id">true</span><br/>
&nbsp;&nbsp;| <span class="id">_</span>   =&gt; <span class="id">Bnone</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">cmp_different_blocks_none</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span>, <span class="id">cmatch</span> <span class="id">None</span> (<span class="id">cmp_different_blocks</span> <span class="id">c</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2779')">Proof.</div>
<div class="proofscript" id="proof2779">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">destruct</span> <span class="id">c</span>; <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">cmp_different_blocks_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span>, <span class="id">cmatch</span> (<span class="id">Val.cmp_different_blocks</span> <span class="id">c</span>) (<span class="id">cmp_different_blocks</span> <span class="id">c</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2780')">Proof.</div>
<div class="proofscript" id="proof2780">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">destruct</span> <span class="id">c</span>; <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">pcmp</span> (<span class="id">c</span>: <span class="id">comparison</span>) (<span class="id">p1</span> <span class="id">p2</span>: <span class="id">aptr</span>) : <span class="id">abool</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">p1</span>, <span class="id">p2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Pbot</span>, <span class="id">_</span> | <span class="id">_</span>, <span class="id">Pbot</span> =&gt; <span class="id">Bnone</span><br/>
&nbsp;&nbsp;| <span class="id">Gl</span> <span class="id">id1</span> <span class="id">ofs1</span>, <span class="id">Gl</span> <span class="id">id2</span> <span class="id">ofs2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">peq</span> <span class="id">id1</span> <span class="id">id2</span> <span class="kwd">then</span> <span class="id">Maybe</span> (<span class="id">Ptrofs.cmpu</span> <span class="id">c</span> <span class="id">ofs1</span> <span class="id">ofs2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">cmp_different_blocks</span> <span class="id">c</span><br/>
&nbsp;&nbsp;| <span class="id">Gl</span> <span class="id">id1</span> <span class="id">ofs1</span>, <span class="id">Glo</span> <span class="id">id2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">peq</span> <span class="id">id1</span> <span class="id">id2</span> <span class="kwd">then</span> <span class="id">Btop</span> <span class="kwd">else</span> <span class="id">cmp_different_blocks</span> <span class="id">c</span><br/>
&nbsp;&nbsp;| <span class="id">Glo</span> <span class="id">id1</span>, <span class="id">Gl</span> <span class="id">id2</span> <span class="id">ofs2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">peq</span> <span class="id">id1</span> <span class="id">id2</span> <span class="kwd">then</span> <span class="id">Btop</span> <span class="kwd">else</span> <span class="id">cmp_different_blocks</span> <span class="id">c</span><br/>
&nbsp;&nbsp;| <span class="id">Glo</span> <span class="id">id1</span>, <span class="id">Glo</span> <span class="id">id2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">peq</span> <span class="id">id1</span> <span class="id">id2</span> <span class="kwd">then</span> <span class="id">Btop</span> <span class="kwd">else</span> <span class="id">cmp_different_blocks</span> <span class="id">c</span><br/>
&nbsp;&nbsp;| <span class="id">Stk</span> <span class="id">ofs1</span>, <span class="id">Stk</span> <span class="id">ofs2</span> =&gt; <span class="id">Maybe</span> (<span class="id">Ptrofs.cmpu</span> <span class="id">c</span> <span class="id">ofs1</span> <span class="id">ofs2</span>)<br/>
&nbsp;&nbsp;| (<span class="id">Gl</span> <span class="id">_</span> <span class="id">_</span> | <span class="id">Glo</span> <span class="id">_</span> | <span class="id">Glob</span> | <span class="id">Nonstack</span>), (<span class="id">Stk</span> <span class="id">_</span> | <span class="id">Stack</span>) =&gt; <span class="id">cmp_different_blocks</span> <span class="id">c</span><br/>
&nbsp;&nbsp;| (<span class="id">Stk</span> <span class="id">_</span> | <span class="id">Stack</span>), (<span class="id">Gl</span> <span class="id">_</span> <span class="id">_</span> | <span class="id">Glo</span> <span class="id">_</span> | <span class="id">Glob</span> | <span class="id">Nonstack</span>) =&gt; <span class="id">cmp_different_blocks</span> <span class="id">c</span><br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">Btop</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">pcmp_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">valid</span> <span class="id">c</span> <span class="id">b1</span> <span class="id">ofs1</span> <span class="id">p1</span> <span class="id">b2</span> <span class="id">ofs2</span> <span class="id">p2</span>,<br/>
&nbsp;&nbsp;<span class="id">pmatch</span> <span class="id">b1</span> <span class="id">ofs1</span> <span class="id">p1</span> -&gt; <span class="id">pmatch</span> <span class="id">b2</span> <span class="id">ofs2</span> <span class="id">p2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">cmatch</span> (<span class="id">Val.cmpu_bool</span> <span class="id">valid</span> <span class="id">c</span> (<span class="id">Vptr</span> <span class="id">b1</span> <span class="id">ofs1</span>) (<span class="id">Vptr</span> <span class="id">b2</span> <span class="id">ofs2</span>)) (<span class="id">pcmp</span> <span class="id">c</span> <span class="id">p1</span> <span class="id">p2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2781')">Proof.</div>
<div class="proofscript" id="proof2781">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">DIFF</span>: <span class="id">b1</span> &lt;&gt; <span class="id">b2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cmatch</span> (<span class="id">Val.cmpu_bool</span> <span class="id">valid</span> <span class="id">c</span> (<span class="id">Vptr</span> <span class="id">b1</span> <span class="id">ofs1</span>) (<span class="id">Vptr</span> <span class="id">b2</span> <span class="id">ofs2</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">cmp_different_blocks</span> <span class="id">c</span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">dec_eq_false</span> <span class="tactic">by</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Archi.ptr64</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">cmp_different_blocks_none</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">valid</span> <span class="id">b1</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs1</span>) &amp;&amp; <span class="id">valid</span> <span class="id">b2</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs2</span>)); <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">cmp_different_blocks_sound</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">cmp_different_blocks_none</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">SAME</span>: <span class="id">b1</span> = <span class="id">b2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cmatch</span> (<span class="id">Val.cmpu_bool</span> <span class="id">valid</span> <span class="id">c</span> (<span class="id">Vptr</span> <span class="id">b1</span> <span class="id">ofs1</span>) (<span class="id">Vptr</span> <span class="id">b2</span> <span class="id">ofs2</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Maybe</span> (<span class="id">Ptrofs.cmpu</span> <span class="id">c</span> <span class="id">ofs1</span> <span class="id">ofs2</span>))).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">subst</span> <span class="id">b2</span>. <span class="tactic">simpl</span>. <span class="tactic">destruct</span> <span class="id">Archi.ptr64</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">dec_eq_true</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> ((<span class="id">valid</span> <span class="id">b1</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs1</span>) || <span class="id">valid</span> <span class="id">b1</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs1</span> - 1)) &amp;&amp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">valid</span> <span class="id">b1</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs2</span>) || <span class="id">valid</span> <span class="id">b1</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs2</span> - 1))); <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">pcmp</span>; <span class="id">inv</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H0</span>; (<span class="tactic">apply</span> <span class="id">cmatch_top</span> || (<span class="tactic">apply</span> <span class="id">DIFF</span>; <span class="tactic">congruence</span>) || <span class="id">idtac</span>).<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">peq</span> <span class="id">id</span> <span class="id">id0</span>). <span class="tactic">subst</span> <span class="id">id0</span>. <span class="tactic">apply</span> <span class="id">SAME</span>. <span class="tactic">eapply</span> <span class="id">bc_glob</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">peq</span> <span class="id">id</span> <span class="id">id0</span>); <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">peq</span> <span class="id">id</span> <span class="id">id0</span>); <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">peq</span> <span class="id">id</span> <span class="id">id0</span>); <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">SAME</span>. <span class="tactic">eapply</span> <span class="id">bc_stack</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">pcmp_sound_64</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">valid</span> <span class="id">c</span> <span class="id">b1</span> <span class="id">ofs1</span> <span class="id">p1</span> <span class="id">b2</span> <span class="id">ofs2</span> <span class="id">p2</span>,<br/>
&nbsp;&nbsp;<span class="id">pmatch</span> <span class="id">b1</span> <span class="id">ofs1</span> <span class="id">p1</span> -&gt; <span class="id">pmatch</span> <span class="id">b2</span> <span class="id">ofs2</span> <span class="id">p2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">cmatch</span> (<span class="id">Val.cmplu_bool</span> <span class="id">valid</span> <span class="id">c</span> (<span class="id">Vptr</span> <span class="id">b1</span> <span class="id">ofs1</span>) (<span class="id">Vptr</span> <span class="id">b2</span> <span class="id">ofs2</span>)) (<span class="id">pcmp</span> <span class="id">c</span> <span class="id">p1</span> <span class="id">p2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2782')">Proof.</div>
<div class="proofscript" id="proof2782">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">DIFF</span>: <span class="id">b1</span> &lt;&gt; <span class="id">b2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cmatch</span> (<span class="id">Val.cmplu_bool</span> <span class="id">valid</span> <span class="id">c</span> (<span class="id">Vptr</span> <span class="id">b1</span> <span class="id">ofs1</span>) (<span class="id">Vptr</span> <span class="id">b2</span> <span class="id">ofs2</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">cmp_different_blocks</span> <span class="id">c</span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">dec_eq_false</span> <span class="tactic">by</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Archi.ptr64</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">valid</span> <span class="id">b1</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs1</span>) &amp;&amp; <span class="id">valid</span> <span class="id">b2</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs2</span>)); <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">cmp_different_blocks_sound</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">cmp_different_blocks_none</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">cmp_different_blocks_none</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">SAME</span>: <span class="id">b1</span> = <span class="id">b2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cmatch</span> (<span class="id">Val.cmplu_bool</span> <span class="id">valid</span> <span class="id">c</span> (<span class="id">Vptr</span> <span class="id">b1</span> <span class="id">ofs1</span>) (<span class="id">Vptr</span> <span class="id">b2</span> <span class="id">ofs2</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Maybe</span> (<span class="id">Ptrofs.cmpu</span> <span class="id">c</span> <span class="id">ofs1</span> <span class="id">ofs2</span>))).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">subst</span> <span class="id">b2</span>. <span class="tactic">simpl</span>. <span class="tactic">destruct</span> <span class="id">Archi.ptr64</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">dec_eq_true</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> ((<span class="id">valid</span> <span class="id">b1</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs1</span>) || <span class="id">valid</span> <span class="id">b1</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs1</span> - 1)) &amp;&amp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">valid</span> <span class="id">b1</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs2</span>) || <span class="id">valid</span> <span class="id">b1</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs2</span> - 1))); <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">pcmp</span>; <span class="id">inv</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H0</span>; (<span class="tactic">apply</span> <span class="id">cmatch_top</span> || (<span class="tactic">apply</span> <span class="id">DIFF</span>; <span class="tactic">congruence</span>) || <span class="id">idtac</span>).<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">peq</span> <span class="id">id</span> <span class="id">id0</span>). <span class="tactic">subst</span> <span class="id">id0</span>. <span class="tactic">apply</span> <span class="id">SAME</span>. <span class="tactic">eapply</span> <span class="id">bc_glob</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">peq</span> <span class="id">id</span> <span class="id">id0</span>); <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">peq</span> <span class="id">id</span> <span class="id">id0</span>); <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">peq</span> <span class="id">id</span> <span class="id">id0</span>); <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">SAME</span>. <span class="tactic">eapply</span> <span class="id">bc_stack</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">pcmp_none</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">p1</span> <span class="id">p2</span>, <span class="id">cmatch</span> <span class="id">None</span> (<span class="id">pcmp</span> <span class="id">c</span> <span class="id">p1</span> <span class="id">p2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2783')">Proof.</div>
<div class="proofscript" id="proof2783">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">pcmp</span>; <span class="tactic">destruct</span> <span class="id">p1</span>; <span class="tactic">try</span> <span class="id">constructor</span>; <span class="tactic">destruct</span> <span class="id">p2</span>;<br/>
&nbsp;&nbsp;<span class="tactic">try</span> (<span class="tactic">destruct</span> (<span class="id">peq</span> <span class="id">id</span> <span class="id">id0</span>));  <span class="tactic">try</span> <span class="id">constructor</span>; <span class="tactic">try</span> (<span class="tactic">apply</span> <span class="id">cmp_different_blocks_none</span>).<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">pdisjoint</span> (<span class="id">p1</span>: <span class="id">aptr</span>) (<span class="id">sz1</span>: <span class="id">Z</span>) (<span class="id">p2</span>: <span class="id">aptr</span>) (<span class="id">sz2</span>: <span class="id">Z</span>) : <span class="id">bool</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">p1</span>, <span class="id">p2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Pbot</span>, <span class="id">_</span> =&gt; <span class="id">true</span><br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">Pbot</span> =&gt; <span class="id">true</span><br/>
&nbsp;&nbsp;| <span class="id">Gl</span> <span class="id">id1</span> <span class="id">ofs1</span>, <span class="id">Gl</span> <span class="id">id2</span> <span class="id">ofs2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">peq</span> <span class="id">id1</span> <span class="id">id2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id">zle</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs1</span> + <span class="id">sz1</span>) (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|| <span class="id">zle</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs2</span> + <span class="id">sz2</span>) (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">true</span><br/>
&nbsp;&nbsp;| <span class="id">Gl</span> <span class="id">id1</span> <span class="id">ofs1</span>, <span class="id">Glo</span> <span class="id">id2</span> =&gt; <span class="id">negb</span>(<span class="id">peq</span> <span class="id">id1</span> <span class="id">id2</span>)<br/>
&nbsp;&nbsp;| <span class="id">Glo</span> <span class="id">id1</span>, <span class="id">Gl</span> <span class="id">id2</span> <span class="id">ofs2</span> =&gt; <span class="id">negb</span>(<span class="id">peq</span> <span class="id">id1</span> <span class="id">id2</span>)<br/>
&nbsp;&nbsp;| <span class="id">Glo</span> <span class="id">id1</span>, <span class="id">Glo</span> <span class="id">id2</span> =&gt; <span class="id">negb</span>(<span class="id">peq</span> <span class="id">id1</span> <span class="id">id2</span>)<br/>
&nbsp;&nbsp;| <span class="id">Stk</span> <span class="id">ofs1</span>, <span class="id">Stk</span> <span class="id">ofs2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">zle</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs1</span> + <span class="id">sz1</span>) (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|| <span class="id">zle</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs2</span> + <span class="id">sz2</span>) (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs1</span>)<br/>
&nbsp;&nbsp;| (<span class="id">Gl</span> <span class="id">_</span> <span class="id">_</span> | <span class="id">Glo</span> <span class="id">_</span> | <span class="id">Glob</span> | <span class="id">Nonstack</span>), (<span class="id">Stk</span> <span class="id">_</span> | <span class="id">Stack</span>) =&gt; <span class="id">true</span><br/>
&nbsp;&nbsp;| (<span class="id">Stk</span> <span class="id">_</span> | <span class="id">Stack</span>), (<span class="id">Gl</span> <span class="id">_</span> <span class="id">_</span> | <span class="id">Glo</span> <span class="id">_</span> | <span class="id">Glob</span> | <span class="id">Nonstack</span>) =&gt; <span class="id">true</span><br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">false</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">pdisjoint_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sz1</span> <span class="id">b1</span> <span class="id">ofs1</span> <span class="id">p1</span> <span class="id">sz2</span> <span class="id">b2</span> <span class="id">ofs2</span> <span class="id">p2</span>,<br/>
&nbsp;&nbsp;<span class="id">pdisjoint</span> <span class="id">p1</span> <span class="id">sz1</span> <span class="id">p2</span> <span class="id">sz2</span> = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">pmatch</span> <span class="id">b1</span> <span class="id">ofs1</span> <span class="id">p1</span> -&gt; <span class="id">pmatch</span> <span class="id">b2</span> <span class="id">ofs2</span> <span class="id">p2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">b1</span> &lt;&gt; <span class="id">b2</span> \/ <span class="id">Ptrofs.unsigned</span> <span class="id">ofs1</span> + <span class="id">sz1</span> &lt;= <span class="id">Ptrofs.unsigned</span> <span class="id">ofs2</span> \/ <span class="id">Ptrofs.unsigned</span> <span class="id">ofs2</span> + <span class="id">sz2</span> &lt;= <span class="id">Ptrofs.unsigned</span> <span class="id">ofs1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2784')">Proof.</div>
<div class="proofscript" id="proof2784">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H0</span>; <span class="id">inv</span> <span class="id">H1</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>; <span class="tactic">try</span> (<span class="id">left</span>; <span class="tactic">congruence</span>).<br/>
- <span class="tactic">destruct</span> (<span class="id">peq</span> <span class="id">id</span> <span class="id">id0</span>). <span class="tactic">subst</span> <span class="id">id0</span>. <span class="tactic">destruct</span> (<span class="id">orb_true_elim</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span>); <span class="id">InvBooleans</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">left</span>; <span class="tactic">congruence</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">peq</span> <span class="id">id</span> <span class="id">id0</span>); <span class="tactic">try</span> <span class="tactic">discriminate</span>. <span class="id">left</span>; <span class="tactic">congruence</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">peq</span> <span class="id">id</span> <span class="id">id0</span>); <span class="tactic">try</span> <span class="tactic">discriminate</span>. <span class="id">left</span>; <span class="tactic">congruence</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">peq</span> <span class="id">id</span> <span class="id">id0</span>); <span class="tactic">try</span> <span class="tactic">discriminate</span>. <span class="id">left</span>; <span class="tactic">congruence</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">orb_true_elim</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span>); <span class="id">InvBooleans</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<h1> Abstracting values </h1>
<br/>
<span class="kwd">Inductive</span> <span class="id">aval</span> : <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id">Vbot</span>                     <span class="docright">(* bottom (empty set of values)  *)</span><br/>
&nbsp;&nbsp;| <span class="id">I</span> (<span class="id">n</span>: <span class="id">int</span>)               <span class="docright">(* exactly <span class="bracket"><span class="id">Vint</span> <span class="id">n</span></span>  *)</span><br/>
&nbsp;&nbsp;| <span class="id">Uns</span> (<span class="id">p</span>: <span class="id">aptr</span>) (<span class="id">n</span>: <span class="id">Z</span>)     <span class="docright">(* a <span class="bracket"><span class="id">n</span></span>-bit unsigned integer, or <span class="bracket"><span class="id">Vundef</span></span>  *)</span><br/>
&nbsp;&nbsp;| <span class="id">Sgn</span> (<span class="id">p</span>: <span class="id">aptr</span>) (<span class="id">n</span>: <span class="id">Z</span>)     <span class="docright">(* a <span class="bracket"><span class="id">n</span></span>-bit signed integer, or <span class="bracket"><span class="id">Vundef</span></span>  *)</span><br/>
&nbsp;&nbsp;| <span class="id">L</span> (<span class="id">n</span>: <span class="id">int64</span>)             <span class="docright">(* exactly <span class="bracket"><span class="id">Vlong</span> <span class="id">n</span></span>  *)</span><br/>
&nbsp;&nbsp;| <span class="id">F</span> (<span class="id">f</span>: <span class="id">float</span>)             <span class="docright">(* exactly <span class="bracket"><span class="id">Vfloat</span> <span class="id">f</span></span>  *)</span><br/>
&nbsp;&nbsp;| <span class="id">FS</span> (<span class="id">f</span>: <span class="id">float32</span>)          <span class="docright">(* exactly <span class="bracket"><span class="id">Vsingle</span> <span class="id">f</span></span>  *)</span><br/>
&nbsp;&nbsp;| <span class="id">Ptr</span> (<span class="id">p</span>: <span class="id">aptr</span>)            <span class="docright">(* a pointer from the set <span class="bracket"><span class="id">p</span></span>, or <span class="bracket"><span class="id">Vundef</span></span>  *)</span><br/>
&nbsp;&nbsp;| <span class="id">Ifptr</span> (<span class="id">p</span>: <span class="id">aptr</span>).         <span class="docright">(* a pointer from the set <span class="bracket"><span class="id">p</span></span>, or a number, or <span class="bracket"><span class="id">Vundef</span></span>  *)</span><br/>
<br/>
<div class="doc">The "top" of the value domain is defined as any pointer, or any
    number, or <span class="bracket"><span class="id">Vundef</span></span>. </div>
<br/>
<span class="kwd">Definition</span> <span class="id">Vtop</span> := <span class="id">Ifptr</span> <span class="id">Ptop</span>.<br/>
<br/>
<div class="doc">The <span class="bracket"><span class="id">p</span></span> parameter (an abstract pointer) to <span class="bracket"><span class="id">Uns</span></span> and <span class="bracket"><span class="id">Sgn</span></span> helps keeping
  track of pointers that leak through arithmetic operations such as shifts.
  See the section "Tracking leakage of pointers" below.
  In strict analysis mode, <span class="bracket"><span class="id">p</span></span> is always <span class="bracket"><span class="id">Pbot</span></span>. </div>
<br/>
<span class="kwd">Definition</span> <span class="id">eq_aval</span>: <span class="kwd">forall</span> (<span class="id">v1</span> <span class="id">v2</span>: <span class="id">aval</span>), {<span class="id">v1</span>=<span class="id">v2</span>} + {<span class="id">v1</span>&lt;&gt;<span class="id">v2</span>}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2785')">Proof.</div>
<div class="proofscript" id="proof2785">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">generalize</span> <span class="id">zeq</span> <span class="id">Int.eq_dec</span> <span class="id">Int64.eq_dec</span> <span class="id">Float.eq_dec</span> <span class="id">Float32.eq_dec</span> <span class="id">eq_aptr</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">decide</span> <span class="id">equality</span>.<br/>
Defined.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">is_uns</span> (<span class="id">n</span>: <span class="id">Z</span>) (<span class="id">i</span>: <span class="id">int</span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span>, 0 &lt;= <span class="id">m</span> &lt; <span class="id">Int.zwordsize</span> -&gt; <span class="id">m</span> &gt;= <span class="id">n</span> -&gt; <span class="id">Int.testbit</span> <span class="id">i</span> <span class="id">m</span> = <span class="id">false</span>.<br/>
<span class="kwd">Definition</span> <span class="id">is_sgn</span> (<span class="id">n</span>: <span class="id">Z</span>) (<span class="id">i</span>: <span class="id">int</span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span>, 0 &lt;= <span class="id">m</span> &lt; <span class="id">Int.zwordsize</span> -&gt; <span class="id">m</span> &gt;= <span class="id">n</span> - 1 -&gt; <span class="id">Int.testbit</span> <span class="id">i</span> <span class="id">m</span> = <span class="id">Int.testbit</span> <span class="id">i</span> (<span class="id">Int.zwordsize</span> - 1).<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">vmatch</span> : <span class="id">val</span> -&gt; <span class="id">aval</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id">vmatch_i</span>: <span class="kwd">forall</span> <span class="id">i</span>, <span class="id">vmatch</span> (<span class="id">Vint</span> <span class="id">i</span>) (<span class="id">I</span> <span class="id">i</span>)<br/>
&nbsp;&nbsp;| <span class="id">vmatch_Uns</span>: <span class="kwd">forall</span> <span class="id">p</span> <span class="id">i</span> <span class="id">n</span>, 0 &lt;= <span class="id">n</span> -&gt; <span class="id">is_uns</span> <span class="id">n</span> <span class="id">i</span> -&gt; <span class="id">vmatch</span> (<span class="id">Vint</span> <span class="id">i</span>) (<span class="id">Uns</span> <span class="id">p</span> <span class="id">n</span>)<br/>
&nbsp;&nbsp;| <span class="id">vmatch_Uns_undef</span>: <span class="kwd">forall</span> <span class="id">p</span> <span class="id">n</span>, <span class="id">vmatch</span> <span class="id">Vundef</span> (<span class="id">Uns</span> <span class="id">p</span> <span class="id">n</span>)<br/>
&nbsp;&nbsp;| <span class="id">vmatch_Sgn</span>: <span class="kwd">forall</span> <span class="id">p</span> <span class="id">i</span> <span class="id">n</span>, 0 &lt; <span class="id">n</span> -&gt; <span class="id">is_sgn</span> <span class="id">n</span> <span class="id">i</span> -&gt; <span class="id">vmatch</span> (<span class="id">Vint</span> <span class="id">i</span>) (<span class="id">Sgn</span> <span class="id">p</span> <span class="id">n</span>)<br/>
&nbsp;&nbsp;| <span class="id">vmatch_Sgn_undef</span>: <span class="kwd">forall</span> <span class="id">p</span> <span class="id">n</span>, <span class="id">vmatch</span> <span class="id">Vundef</span> (<span class="id">Sgn</span> <span class="id">p</span> <span class="id">n</span>)<br/>
&nbsp;&nbsp;| <span class="id">vmatch_l</span>: <span class="kwd">forall</span> <span class="id">i</span>, <span class="id">vmatch</span> (<span class="id">Vlong</span> <span class="id">i</span>) (<span class="id">L</span> <span class="id">i</span>)<br/>
&nbsp;&nbsp;| <span class="id">vmatch_f</span>: <span class="kwd">forall</span> <span class="id">f</span>, <span class="id">vmatch</span> (<span class="id">Vfloat</span> <span class="id">f</span>) (<span class="id">F</span> <span class="id">f</span>)<br/>
&nbsp;&nbsp;| <span class="id">vmatch_s</span>: <span class="kwd">forall</span> <span class="id">f</span>, <span class="id">vmatch</span> (<span class="id">Vsingle</span> <span class="id">f</span>) (<span class="id">FS</span> <span class="id">f</span>)<br/>
&nbsp;&nbsp;| <span class="id">vmatch_ptr</span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">p</span>, <span class="id">pmatch</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">p</span> -&gt; <span class="id">vmatch</span> (<span class="id">Vptr</span> <span class="id">b</span> <span class="id">ofs</span>) (<span class="id">Ptr</span> <span class="id">p</span>)<br/>
&nbsp;&nbsp;| <span class="id">vmatch_ptr_undef</span>: <span class="kwd">forall</span> <span class="id">p</span>, <span class="id">vmatch</span> <span class="id">Vundef</span> (<span class="id">Ptr</span> <span class="id">p</span>)<br/>
&nbsp;&nbsp;| <span class="id">vmatch_ifptr_undef</span>: <span class="kwd">forall</span> <span class="id">p</span>, <span class="id">vmatch</span> <span class="id">Vundef</span> (<span class="id">Ifptr</span> <span class="id">p</span>)<br/>
&nbsp;&nbsp;| <span class="id">vmatch_ifptr_i</span>: <span class="kwd">forall</span> <span class="id">i</span> <span class="id">p</span>, <span class="id">vmatch</span> (<span class="id">Vint</span> <span class="id">i</span>) (<span class="id">Ifptr</span> <span class="id">p</span>)<br/>
&nbsp;&nbsp;| <span class="id">vmatch_ifptr_l</span>: <span class="kwd">forall</span> <span class="id">i</span> <span class="id">p</span>, <span class="id">vmatch</span> (<span class="id">Vlong</span> <span class="id">i</span>) (<span class="id">Ifptr</span> <span class="id">p</span>)<br/>
&nbsp;&nbsp;| <span class="id">vmatch_ifptr_f</span>: <span class="kwd">forall</span> <span class="id">f</span> <span class="id">p</span>, <span class="id">vmatch</span> (<span class="id">Vfloat</span> <span class="id">f</span>) (<span class="id">Ifptr</span> <span class="id">p</span>)<br/>
&nbsp;&nbsp;| <span class="id">vmatch_ifptr_s</span>: <span class="kwd">forall</span> <span class="id">f</span> <span class="id">p</span>, <span class="id">vmatch</span> (<span class="id">Vsingle</span> <span class="id">f</span>) (<span class="id">Ifptr</span> <span class="id">p</span>)<br/>
&nbsp;&nbsp;| <span class="id">vmatch_ifptr_p</span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">p</span>, <span class="id">pmatch</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">p</span> -&gt; <span class="id">vmatch</span> (<span class="id">Vptr</span> <span class="id">b</span> <span class="id">ofs</span>) (<span class="id">Ifptr</span> <span class="id">p</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">vmatch_ifptr</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">p</span>,<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span>, <span class="id">v</span> = <span class="id">Vptr</span> <span class="id">b</span> <span class="id">ofs</span> -&gt; <span class="id">pmatch</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">p</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> <span class="id">v</span> (<span class="id">Ifptr</span> <span class="id">p</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2786')">Proof.</div>
<div class="proofscript" id="proof2786">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">v</span>; <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">vmatch_top</span>: <span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">v</span> <span class="id">Vtop</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2787')">Proof.</div>
<div class="proofscript" id="proof2787">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">vmatch_ifptr</span>. <span class="tactic">intros</span>. <span class="tactic">subst</span> <span class="id">v</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">eapply</span> <span class="id">pmatch_top</span>'; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Extern</span> 1 (<span class="id">vmatch</span> <span class="id">_</span> <span class="id">_</span>) =&gt; <span class="id">constructor</span> : <span class="id">va</span>.<br/>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">is_uns_mon</span>: <span class="kwd">forall</span> <span class="id">n1</span> <span class="id">n2</span> <span class="id">i</span>, <span class="id">is_uns</span> <span class="id">n1</span> <span class="id">i</span> -&gt; <span class="id">n1</span> &lt;= <span class="id">n2</span> -&gt; <span class="id">is_uns</span> <span class="id">n2</span> <span class="id">i</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2788')">Proof.</div>
<div class="proofscript" id="proof2788">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">H</span>; <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">is_sgn_mon</span>: <span class="kwd">forall</span> <span class="id">n1</span> <span class="id">n2</span> <span class="id">i</span>, <span class="id">is_sgn</span> <span class="id">n1</span> <span class="id">i</span> -&gt; <span class="id">n1</span> &lt;= <span class="id">n2</span> -&gt; <span class="id">is_sgn</span> <span class="id">n2</span> <span class="id">i</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2789')">Proof.</div>
<div class="proofscript" id="proof2789">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">H</span>; <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">is_uns_sgn</span>: <span class="kwd">forall</span> <span class="id">n1</span> <span class="id">n2</span> <span class="id">i</span>, <span class="id">is_uns</span> <span class="id">n1</span> <span class="id">i</span> -&gt; <span class="id">n1</span> &lt; <span class="id">n2</span> -&gt; <span class="id">is_sgn</span> <span class="id">n2</span> <span class="id">i</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2790')">Proof.</div>
<div class="proofscript" id="proof2790">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> ! <span class="id">H</span> <span class="tactic">by</span> <span class="tactic">omega</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">usize</span> := <span class="id">Int.size</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">ssize</span> (<span class="id">i</span>: <span class="id">int</span>) := <span class="id">Int.size</span> (<span class="kwd">if</span> <span class="id">Int.lt</span> <span class="id">i</span> <span class="id">Int.zero</span> <span class="kwd">then</span> <span class="id">Int.not</span> <span class="id">i</span> <span class="kwd">else</span> <span class="id">i</span>) + 1.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">is_uns_usize</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">i</span>, <span class="id">is_uns</span> (<span class="id">usize</span> <span class="id">i</span>) <span class="id">i</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2791')">Proof.</div>
<div class="proofscript" id="proof2791">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">usize</span>; <span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Int.bits_size_2</span>. <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">is_sgn_ssize</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">i</span>, <span class="id">is_sgn</span> (<span class="id">ssize</span> <span class="id">i</span>) <span class="id">i</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2792')">Proof.</div>
<div class="proofscript" id="proof2792">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">ssize</span>; <span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Int.lt</span> <span class="id">i</span> <span class="id">Int.zero</span>) <span class="id">eqn</span>:<span class="id">LT</span>.<br/>
- <span class="tactic">rewrite</span> &lt;- (<span class="id">negb_involutive</span> (<span class="id">Int.testbit</span> <span class="id">i</span> <span class="id">m</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">negb_involutive</span> (<span class="id">Int.testbit</span> <span class="id">i</span> (<span class="id">Int.zwordsize</span> - 1))).<br/>
&nbsp;&nbsp;<span class="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Int.size_range</span> (<span class="id">Int.not</span> <span class="id">i</span>)); <span class="tactic">intros</span> <span class="id">RANGE</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- ! <span class="id">Int.bits_not</span> <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> ! <span class="id">Int.bits_size_2</span> <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
- <span class="tactic">rewrite</span> ! <span class="id">Int.bits_size_2</span> <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">is_uns_zero_ext</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">i</span>, <span class="id">is_uns</span> <span class="id">n</span> <span class="id">i</span> &lt;-&gt; <span class="id">Int.zero_ext</span> <span class="id">n</span> <span class="id">i</span> = <span class="id">i</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2793')">Proof.</div>
<div class="proofscript" id="proof2793">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">Int.bit_solve</span>. <span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">i0</span> <span class="id">n</span>); <span class="tactic">auto</span>. <span class="tactic">symmetry</span>; <span class="tactic">apply</span> <span class="id">H</span>; <span class="tactic">auto</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H</span>. <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">Int.bits_zero_ext</span> <span class="tactic">by</span> <span class="tactic">omega</span>. <span class="tactic">rewrite</span> <span class="id">zlt_false</span> <span class="tactic">by</span> <span class="tactic">omega</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">is_sgn_sign_ext</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">i</span>, 0 &lt; <span class="id">n</span> -&gt; (<span class="id">is_sgn</span> <span class="id">n</span> <span class="id">i</span> &lt;-&gt; <span class="id">Int.sign_ext</span> <span class="id">n</span> <span class="id">i</span> = <span class="id">i</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2794')">Proof.</div>
<div class="proofscript" id="proof2794">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">Int.bit_solve</span>. <span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">i0</span> <span class="id">n</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">transitivity</span> (<span class="id">Int.testbit</span> <span class="id">i</span> (<span class="id">Int.zwordsize</span> - 1)).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H0</span>; <span class="tactic">omega</span>. <span class="tactic">symmetry</span>; <span class="tactic">apply</span> <span class="id">H0</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H0</span>. <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> ! <span class="id">Int.bits_sign_ext</span> <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">f_equal</span>. <span class="tactic">transitivity</span> (<span class="id">n</span>-1). <span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">m</span> <span class="id">n</span>); <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zlt</span> (<span class="id">Int.zwordsize</span> - 1) <span class="id">n</span>); <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">is_zero_ext_uns</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">i</span> <span class="id">n</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;<span class="id">is_uns</span> <span class="id">m</span> <span class="id">i</span> \/ <span class="id">n</span> &lt;= <span class="id">m</span> -&gt; <span class="id">is_uns</span> <span class="id">m</span> (<span class="id">Int.zero_ext</span> <span class="id">n</span> <span class="id">i</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2795')">Proof.</div>
<div class="proofscript" id="proof2795">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">Int.bits_zero_ext</span> <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">m0</span> <span class="id">n</span>); <span class="tactic">auto</span>. <span class="tactic">destruct</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id">H</span>; <span class="tactic">omega</span>. <span class="id">omegaContradiction</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">is_zero_ext_sgn</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">i</span> <span class="id">n</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;<span class="id">n</span> &lt; <span class="id">m</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">is_sgn</span> <span class="id">m</span> (<span class="id">Int.zero_ext</span> <span class="id">n</span> <span class="id">i</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2796')">Proof.</div>
<div class="proofscript" id="proof2796">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> ! <span class="id">Int.bits_zero_ext</span> <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">transitivity</span> <span class="id">false</span>. <span class="tactic">apply</span> <span class="id">zlt_false</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">symmetry</span>; <span class="tactic">apply</span> <span class="id">zlt_false</span>; <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">is_sign_ext_uns</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">i</span> <span class="id">n</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;0 &lt;= <span class="id">m</span> &lt; <span class="id">n</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">is_uns</span> <span class="id">m</span> <span class="id">i</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">is_uns</span> <span class="id">m</span> (<span class="id">Int.sign_ext</span> <span class="id">n</span> <span class="id">i</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2797')">Proof.</div>
<div class="proofscript" id="proof2797">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">Int.bits_sign_ext</span> <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H0</span>. <span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">m0</span> <span class="id">n</span>); <span class="tactic">omega</span>. <span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">m0</span> <span class="id">n</span>); <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">is_sign_ext_sgn</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">i</span> <span class="id">n</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;0 &lt; <span class="id">n</span> -&gt; 0 &lt; <span class="id">m</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">is_sgn</span> <span class="id">m</span> <span class="id">i</span> \/ <span class="id">n</span> &lt;= <span class="id">m</span> -&gt; <span class="id">is_sgn</span> <span class="id">m</span> (<span class="id">Int.sign_ext</span> <span class="id">n</span> <span class="id">i</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2798')">Proof.</div>
<div class="proofscript" id="proof2798">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">is_sgn_sign_ext</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">m</span> <span class="id">n</span>). <span class="tactic">destruct</span> <span class="id">H1</span>. <span class="tactic">apply</span> <span class="id">is_sgn_sign_ext</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H1</span>. <span class="tactic">rewrite</span> (<span class="id">Int.sign_ext_widen</span> <span class="id">i</span>) <span class="tactic">by</span> <span class="tactic">omega</span>. <span class="tactic">apply</span> <span class="id">Int.sign_ext_idem</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">omegaContradiction</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Int.sign_ext_widen</span>; <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">is_uns_mon</span> <span class="id">is_sgn_mon</span> <span class="id">is_uns_sgn</span> <span class="id">is_uns_usize</span> <span class="id">is_sgn_ssize</span> : <span class="id">va</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">is_uns_1</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span>, <span class="id">is_uns</span> 1 <span class="id">n</span> -&gt; <span class="id">n</span> = <span class="id">Int.zero</span> \/ <span class="id">n</span> = <span class="id">Int.one</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2799')">Proof.</div>
<div class="proofscript" id="proof2799">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> (<span class="id">Int.testbit</span> <span class="id">n</span> 0) <span class="id">eqn</span>:<span class="id">B0</span>; [<span class="id">right</span>|<span class="id">left</span>]; <span class="tactic">apply</span> <span class="id">Int.same_bits_eq</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Int.bits_one</span>. <span class="tactic">destruct</span> (<span class="id">zeq</span> <span class="id">i</span> 0). <span class="tactic">subst</span> <span class="id">i</span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">H</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Int.bits_zero</span>. <span class="tactic">destruct</span> (<span class="id">zeq</span> <span class="id">i</span> 0). <span class="tactic">subst</span> <span class="id">i</span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">H</span>; <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Tracking leakage of pointers through arithmetic operations.
In the CompCert semantics, arithmetic operations (e.g. "xor") applied
to pointer values are undefined or produce the <span class="bracket"><span class="id">Vundef</span></span> result.
So, in strict mode, we can abstract the result values of such operations
as <span class="bracket"><span class="id">Ifptr</span> <span class="id">Pbot</span></span>, namely: <span class="bracket"><span class="id">Vundef</span></span>, or any number, but not a pointer.
In real code, such arithmetic over pointers occurs, so we need to be
more prudent.  The policy we take, inspired by that of GCC, is that
"undefined" arithmetic operations involving pointer arguments can
produce a pointer, but not any pointer: rather, a pointer to the same
block, but possibly with a different offset.  Hence, if the operation
has a pointer to abstract region <span class="bracket"><span class="id">p</span></span> as argument, the result value
can be a pointer to abstract region <span class="bracket"><span class="id">poffset</span> <span class="id">p</span></span>.  In other words,
the result value is abstracted as <span class="bracket"><span class="id">Ifptr</span> (<span class="id">poffset</span> <span class="id">p</span>)</span>.
We encapsulate this reasoning in the following <span class="bracket"><span class="id">ntop1</span></span> and <span class="bracket"><span class="id">ntop2</span></span> functions
("numerical top"). </div>
<br/>
<span class="kwd">Definition</span> <span class="id">provenance</span> (<span class="id">x</span>: <span class="id">aval</span>) : <span class="id">aptr</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">va_strict</span> <span class="id">tt</span> <span class="kwd">then</span> <span class="id">Pbot</span> <span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Ptr</span> <span class="id">p</span> | <span class="id">Ifptr</span> <span class="id">p</span> | <span class="id">Uns</span> <span class="id">p</span> <span class="id">_</span> | <span class="id">Sgn</span> <span class="id">p</span> <span class="id">_</span> =&gt; <span class="id">poffset</span> <span class="id">p</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">Pbot</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">ntop</span> : <span class="id">aval</span> := <span class="id">Ifptr</span> <span class="id">Pbot</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">ntop1</span> (<span class="id">x</span>: <span class="id">aval</span>) : <span class="id">aval</span> := <span class="id">Ifptr</span> (<span class="id">provenance</span> <span class="id">x</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">ntop2</span> (<span class="id">x</span> <span class="id">y</span>: <span class="id">aval</span>) : <span class="id">aval</span> := <span class="id">Ifptr</span> (<span class="id">plub</span> (<span class="id">provenance</span> <span class="id">x</span>) (<span class="id">provenance</span> <span class="id">y</span>)).<br/>
<br/>
<div class="doc">Smart constructors for <span class="bracket"><span class="id">Uns</span></span> and <span class="bracket"><span class="id">Sgn</span></span>. </div>
<br/>
<span class="kwd">Definition</span> <span class="id">uns</span> (<span class="id">p</span>: <span class="id">aptr</span>) (<span class="id">n</span>: <span class="id">Z</span>) : <span class="id">aval</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">zle</span> <span class="id">n</span> 1 <span class="kwd">then</span> <span class="id">Uns</span> <span class="id">p</span> 1<br/>
&nbsp;&nbsp;<span class="kwd">else</span> <span class="kwd">if</span> <span class="id">zle</span> <span class="id">n</span> 7 <span class="kwd">then</span> <span class="id">Uns</span> <span class="id">p</span> 7<br/>
&nbsp;&nbsp;<span class="kwd">else</span> <span class="kwd">if</span> <span class="id">zle</span> <span class="id">n</span> 8 <span class="kwd">then</span> <span class="id">Uns</span> <span class="id">p</span> 8<br/>
&nbsp;&nbsp;<span class="kwd">else</span> <span class="kwd">if</span> <span class="id">zle</span> <span class="id">n</span> 15 <span class="kwd">then</span> <span class="id">Uns</span> <span class="id">p</span> 15<br/>
&nbsp;&nbsp;<span class="kwd">else</span> <span class="kwd">if</span> <span class="id">zle</span> <span class="id">n</span> 16 <span class="kwd">then</span> <span class="id">Uns</span> <span class="id">p</span> 16<br/>
&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">Ifptr</span> <span class="id">p</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">sgn</span> (<span class="id">p</span>: <span class="id">aptr</span>) (<span class="id">n</span>: <span class="id">Z</span>) : <span class="id">aval</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">zle</span> <span class="id">n</span> 8 <span class="kwd">then</span> <span class="id">Sgn</span> <span class="id">p</span> 8 <span class="kwd">else</span> <span class="kwd">if</span> <span class="id">zle</span> <span class="id">n</span> 16 <span class="kwd">then</span> <span class="id">Sgn</span> <span class="id">p</span> 16 <span class="kwd">else</span> <span class="id">Ifptr</span> <span class="id">p</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">vmatch_uns</span>':<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">p</span> <span class="id">i</span> <span class="id">n</span>, <span class="id">is_uns</span> (<span class="id">Zmax</span> 0 <span class="id">n</span>) <span class="id">i</span> -&gt; <span class="id">vmatch</span> (<span class="id">Vint</span> <span class="id">i</span>) (<span class="id">uns</span> <span class="id">p</span> <span class="id">n</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2800')">Proof.</div>
<div class="proofscript" id="proof2800">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">A</span>: <span class="kwd">forall</span> <span class="id">n</span>', <span class="id">n</span>' &gt;= 0 -&gt; <span class="id">n</span>' &gt;= <span class="id">n</span> -&gt; <span class="id">is_uns</span> <span class="id">n</span>' <span class="id">i</span>) <span class="tactic">by</span> (<span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">va</span>).<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">uns</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zle</span> <span class="id">n</span> 1). <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zle</span> <span class="id">n</span> 7). <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zle</span> <span class="id">n</span> 8). <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zle</span> <span class="id">n</span> 15). <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zle</span> <span class="id">n</span> 16). <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">vmatch_uns</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">p</span> <span class="id">i</span> <span class="id">n</span>, <span class="id">is_uns</span> <span class="id">n</span> <span class="id">i</span> -&gt; <span class="id">vmatch</span> (<span class="id">Vint</span> <span class="id">i</span>) (<span class="id">uns</span> <span class="id">p</span> <span class="id">n</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2801')">Proof.</div>
<div class="proofscript" id="proof2801">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">vmatch_uns</span>'. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">vmatch_uns_undef</span>: <span class="kwd">forall</span> <span class="id">p</span> <span class="id">n</span>, <span class="id">vmatch</span> <span class="id">Vundef</span> (<span class="id">uns</span> <span class="id">p</span> <span class="id">n</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2802')">Proof.</div>
<div class="proofscript" id="proof2802">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">uns</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zle</span> <span class="id">n</span> 1). <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zle</span> <span class="id">n</span> 7). <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zle</span> <span class="id">n</span> 8). <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zle</span> <span class="id">n</span> 15). <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zle</span> <span class="id">n</span> 16); <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">vmatch_sgn</span>':<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">p</span> <span class="id">i</span> <span class="id">n</span>, <span class="id">is_sgn</span> (<span class="id">Zmax</span> 1 <span class="id">n</span>) <span class="id">i</span> -&gt; <span class="id">vmatch</span> (<span class="id">Vint</span> <span class="id">i</span>) (<span class="id">sgn</span> <span class="id">p</span> <span class="id">n</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2803')">Proof.</div>
<div class="proofscript" id="proof2803">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">A</span>: <span class="kwd">forall</span> <span class="id">n</span>', <span class="id">n</span>' &gt;= 1 -&gt; <span class="id">n</span>' &gt;= <span class="id">n</span> -&gt; <span class="id">is_sgn</span> <span class="id">n</span>' <span class="id">i</span>) <span class="tactic">by</span> (<span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">va</span>).<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">sgn</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zle</span> <span class="id">n</span> 8). <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zle</span> <span class="id">n</span> 16); <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">vmatch_sgn</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">p</span> <span class="id">i</span> <span class="id">n</span>, <span class="id">is_sgn</span> <span class="id">n</span> <span class="id">i</span> -&gt; <span class="id">vmatch</span> (<span class="id">Vint</span> <span class="id">i</span>) (<span class="id">sgn</span> <span class="id">p</span> <span class="id">n</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2804')">Proof.</div>
<div class="proofscript" id="proof2804">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">vmatch_sgn</span>'. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">vmatch_sgn_undef</span>: <span class="kwd">forall</span> <span class="id">p</span> <span class="id">n</span>, <span class="id">vmatch</span> <span class="id">Vundef</span> (<span class="id">sgn</span> <span class="id">p</span> <span class="id">n</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2805')">Proof.</div>
<div class="proofscript" id="proof2805">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">sgn</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zle</span> <span class="id">n</span> 8). <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zle</span> <span class="id">n</span> 16); <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">vmatch_uns</span> <span class="id">vmatch_uns_undef</span> <span class="id">vmatch_sgn</span> <span class="id">vmatch_sgn_undef</span> : <span class="id">va</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">vmatch_Uns_1</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">p</span> <span class="id">v</span>, <span class="id">vmatch</span> <span class="id">v</span> (<span class="id">Uns</span> <span class="id">p</span> 1) -&gt; <span class="id">v</span> = <span class="id">Vundef</span> \/ <span class="id">v</span> = <span class="id">Vint</span> <span class="id">Int.zero</span> \/ <span class="id">v</span> = <span class="id">Vint</span> <span class="id">Int.one</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2806')">Proof.</div>
<div class="proofscript" id="proof2806">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span>. <span class="id">right</span>. <span class="id">exploit</span> <span class="id">is_uns_1</span>; <span class="tactic">eauto</span>. <span class="tactic">intuition</span> <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Ordering </div>
<br/>
<span class="kwd">Inductive</span> <span class="id">vge</span>: <span class="id">aval</span> -&gt; <span class="id">aval</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id">vge_bot</span>: <span class="kwd">forall</span> <span class="id">v</span>, <span class="id">vge</span> <span class="id">v</span> <span class="id">Vbot</span><br/>
&nbsp;&nbsp;| <span class="id">vge_i</span>: <span class="kwd">forall</span> <span class="id">i</span>, <span class="id">vge</span> (<span class="id">I</span> <span class="id">i</span>) (<span class="id">I</span> <span class="id">i</span>)<br/>
&nbsp;&nbsp;| <span class="id">vge_l</span>: <span class="kwd">forall</span> <span class="id">i</span>, <span class="id">vge</span> (<span class="id">L</span> <span class="id">i</span>) (<span class="id">L</span> <span class="id">i</span>)<br/>
&nbsp;&nbsp;| <span class="id">vge_f</span>: <span class="kwd">forall</span> <span class="id">f</span>, <span class="id">vge</span> (<span class="id">F</span> <span class="id">f</span>) (<span class="id">F</span> <span class="id">f</span>)<br/>
&nbsp;&nbsp;| <span class="id">vge_s</span>: <span class="kwd">forall</span> <span class="id">f</span>, <span class="id">vge</span> (<span class="id">FS</span> <span class="id">f</span>) (<span class="id">FS</span> <span class="id">f</span>)<br/>
&nbsp;&nbsp;| <span class="id">vge_uns_i</span>: <span class="kwd">forall</span> <span class="id">p</span> <span class="id">n</span> <span class="id">i</span>, 0 &lt;= <span class="id">n</span> -&gt; <span class="id">is_uns</span> <span class="id">n</span> <span class="id">i</span> -&gt; <span class="id">vge</span> (<span class="id">Uns</span> <span class="id">p</span> <span class="id">n</span>) (<span class="id">I</span> <span class="id">i</span>)<br/>
&nbsp;&nbsp;| <span class="id">vge_uns_uns</span>: <span class="kwd">forall</span> <span class="id">p1</span> <span class="id">n1</span> <span class="id">p2</span> <span class="id">n2</span>, <span class="id">n1</span> &gt;= <span class="id">n2</span> -&gt; <span class="id">pge</span> <span class="id">p1</span> <span class="id">p2</span> -&gt; <span class="id">vge</span> (<span class="id">Uns</span> <span class="id">p1</span> <span class="id">n1</span>) (<span class="id">Uns</span> <span class="id">p2</span> <span class="id">n2</span>)<br/>
&nbsp;&nbsp;| <span class="id">vge_sgn_i</span>: <span class="kwd">forall</span> <span class="id">p</span> <span class="id">n</span> <span class="id">i</span>, 0 &lt; <span class="id">n</span> -&gt; <span class="id">is_sgn</span> <span class="id">n</span> <span class="id">i</span> -&gt; <span class="id">vge</span> (<span class="id">Sgn</span> <span class="id">p</span> <span class="id">n</span>) (<span class="id">I</span> <span class="id">i</span>)<br/>
&nbsp;&nbsp;| <span class="id">vge_sgn_sgn</span>: <span class="kwd">forall</span> <span class="id">p1</span> <span class="id">n1</span> <span class="id">p2</span> <span class="id">n2</span>, <span class="id">n1</span> &gt;= <span class="id">n2</span> -&gt; <span class="id">pge</span> <span class="id">p1</span> <span class="id">p2</span> -&gt; <span class="id">vge</span> (<span class="id">Sgn</span> <span class="id">p1</span> <span class="id">n1</span>) (<span class="id">Sgn</span> <span class="id">p2</span> <span class="id">n2</span>)<br/>
&nbsp;&nbsp;| <span class="id">vge_sgn_uns</span>: <span class="kwd">forall</span> <span class="id">p1</span> <span class="id">n1</span> <span class="id">p2</span> <span class="id">n2</span>, <span class="id">n1</span> &gt; <span class="id">n2</span> -&gt; <span class="id">pge</span> <span class="id">p1</span> <span class="id">p2</span> -&gt; <span class="id">vge</span> (<span class="id">Sgn</span> <span class="id">p1</span> <span class="id">n1</span>) (<span class="id">Uns</span> <span class="id">p2</span> <span class="id">n2</span>)<br/>
&nbsp;&nbsp;| <span class="id">vge_p_p</span>: <span class="kwd">forall</span> <span class="id">p</span> <span class="id">q</span>, <span class="id">pge</span> <span class="id">p</span> <span class="id">q</span> -&gt; <span class="id">vge</span> (<span class="id">Ptr</span> <span class="id">p</span>) (<span class="id">Ptr</span> <span class="id">q</span>)<br/>
&nbsp;&nbsp;| <span class="id">vge_ip_p</span>: <span class="kwd">forall</span> <span class="id">p</span> <span class="id">q</span>, <span class="id">pge</span> <span class="id">p</span> <span class="id">q</span> -&gt; <span class="id">vge</span> (<span class="id">Ifptr</span> <span class="id">p</span>) (<span class="id">Ptr</span> <span class="id">q</span>)<br/>
&nbsp;&nbsp;| <span class="id">vge_ip_ip</span>: <span class="kwd">forall</span> <span class="id">p</span> <span class="id">q</span>, <span class="id">pge</span> <span class="id">p</span> <span class="id">q</span> -&gt; <span class="id">vge</span> (<span class="id">Ifptr</span> <span class="id">p</span>) (<span class="id">Ifptr</span> <span class="id">q</span>)<br/>
&nbsp;&nbsp;| <span class="id">vge_ip_i</span>: <span class="kwd">forall</span> <span class="id">p</span> <span class="id">i</span>, <span class="id">vge</span> (<span class="id">Ifptr</span> <span class="id">p</span>) (<span class="id">I</span> <span class="id">i</span>)<br/>
&nbsp;&nbsp;| <span class="id">vge_ip_l</span>: <span class="kwd">forall</span> <span class="id">p</span> <span class="id">i</span>, <span class="id">vge</span> (<span class="id">Ifptr</span> <span class="id">p</span>) (<span class="id">L</span> <span class="id">i</span>)<br/>
&nbsp;&nbsp;| <span class="id">vge_ip_f</span>: <span class="kwd">forall</span> <span class="id">p</span> <span class="id">f</span>, <span class="id">vge</span> (<span class="id">Ifptr</span> <span class="id">p</span>) (<span class="id">F</span> <span class="id">f</span>)<br/>
&nbsp;&nbsp;| <span class="id">vge_ip_s</span>: <span class="kwd">forall</span> <span class="id">p</span> <span class="id">f</span>, <span class="id">vge</span> (<span class="id">Ifptr</span> <span class="id">p</span>) (<span class="id">FS</span> <span class="id">f</span>)<br/>
&nbsp;&nbsp;| <span class="id">vge_ip_uns</span>: <span class="kwd">forall</span> <span class="id">p</span> <span class="id">q</span> <span class="id">n</span>, <span class="id">pge</span> <span class="id">p</span> <span class="id">q</span> -&gt; <span class="id">vge</span> (<span class="id">Ifptr</span> <span class="id">p</span>) (<span class="id">Uns</span> <span class="id">q</span> <span class="id">n</span>)<br/>
&nbsp;&nbsp;| <span class="id">vge_ip_sgn</span>: <span class="kwd">forall</span> <span class="id">p</span> <span class="id">q</span> <span class="id">n</span>, <span class="id">pge</span> <span class="id">p</span> <span class="id">q</span> -&gt; <span class="id">vge</span> (<span class="id">Ifptr</span> <span class="id">p</span>) (<span class="id">Sgn</span> <span class="id">q</span> <span class="id">n</span>).<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">vge</span> : <span class="id">va</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">vge_top</span>: <span class="kwd">forall</span> <span class="id">v</span>, <span class="id">vge</span> <span class="id">Vtop</span> <span class="id">v</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2807')">Proof.</div>
<div class="proofscript" id="proof2807">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v</span>; <span class="id">constructor</span>; <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">vge_top</span> : <span class="id">va</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">vge_refl</span>: <span class="kwd">forall</span> <span class="id">v</span>, <span class="id">vge</span> <span class="id">v</span> <span class="id">v</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2808')">Proof.</div>
<div class="proofscript" id="proof2808">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">vge_trans</span>: <span class="kwd">forall</span> <span class="id">u</span> <span class="id">v</span>, <span class="id">vge</span> <span class="id">u</span> <span class="id">v</span> -&gt; <span class="kwd">forall</span> <span class="id">w</span>, <span class="id">vge</span> <span class="id">v</span> <span class="id">w</span> -&gt; <span class="id">vge</span> <span class="id">u</span> <span class="id">w</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2809')">Proof.</div>
<div class="proofscript" id="proof2809">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">intros</span> <span class="id">w</span> <span class="id">V</span>; <span class="id">inv</span> <span class="id">V</span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id">pge_trans</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">vmatch_ge</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">vge</span> <span class="id">x</span> <span class="id">y</span> -&gt; <span class="id">vmatch</span> <span class="id">v</span> <span class="id">y</span> -&gt; <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2810')">Proof.</div>
<div class="proofscript" id="proof2810">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">intros</span> <span class="id">V</span>; <span class="id">inv</span> <span class="id">V</span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id">pmatch_ge</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Least upper bound </div>
<br/>
<span class="kwd">Definition</span> <span class="id">vlub</span> (<span class="id">v</span> <span class="id">w</span>: <span class="id">aval</span>) : <span class="id">aval</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">v</span>, <span class="id">w</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Vbot</span>, <span class="id">_</span> =&gt; <span class="id">w</span><br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">Vbot</span> =&gt; <span class="id">v</span><br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">i1</span>, <span class="id">I</span> <span class="id">i2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">Int.eq</span> <span class="id">i1</span> <span class="id">i2</span> <span class="kwd">then</span> <span class="id">v</span> <span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">Int.lt</span> <span class="id">i1</span> <span class="id">Int.zero</span> || <span class="id">Int.lt</span> <span class="id">i2</span> <span class="id">Int.zero</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id">sgn</span> <span class="id">Pbot</span> (<span class="id">Z.max</span> (<span class="id">ssize</span> <span class="id">i1</span>) (<span class="id">ssize</span> <span class="id">i2</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">uns</span> <span class="id">Pbot</span> (<span class="id">Z.max</span> (<span class="id">usize</span> <span class="id">i1</span>) (<span class="id">usize</span> <span class="id">i2</span>))<br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">i</span>, <span class="id">Uns</span> <span class="id">p</span> <span class="id">n</span> | <span class="id">Uns</span> <span class="id">p</span> <span class="id">n</span>, <span class="id">I</span> <span class="id">i</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">Int.lt</span> <span class="id">i</span> <span class="id">Int.zero</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id">sgn</span> <span class="id">p</span> (<span class="id">Z.max</span> (<span class="id">ssize</span> <span class="id">i</span>) (<span class="id">n</span> + 1))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">uns</span> <span class="id">p</span> (<span class="id">Z.max</span> (<span class="id">usize</span> <span class="id">i</span>) <span class="id">n</span>)<br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">i</span>, <span class="id">Sgn</span> <span class="id">p</span> <span class="id">n</span> | <span class="id">Sgn</span> <span class="id">p</span> <span class="id">n</span>, <span class="id">I</span> <span class="id">i</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sgn</span> <span class="id">p</span> (<span class="id">Z.max</span> (<span class="id">ssize</span> <span class="id">i</span>) <span class="id">n</span>)<br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">i</span>, (<span class="id">Ptr</span> <span class="id">p</span> | <span class="id">Ifptr</span> <span class="id">p</span>) | (<span class="id">Ptr</span> <span class="id">p</span> | <span class="id">Ifptr</span> <span class="id">p</span>), <span class="id">I</span> <span class="id">i</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">va_strict</span> <span class="id">tt</span> || <span class="id">Int.eq</span> <span class="id">i</span> <span class="id">Int.zero</span> <span class="kwd">then</span> <span class="id">Ifptr</span> <span class="id">p</span> <span class="kwd">else</span> <span class="id">Vtop</span><br/>
&nbsp;&nbsp;| <span class="id">Uns</span> <span class="id">p1</span> <span class="id">n1</span>, <span class="id">Uns</span> <span class="id">p2</span> <span class="id">n2</span> =&gt; <span class="id">Uns</span> (<span class="id">plub</span> <span class="id">p1</span> <span class="id">p2</span>) (<span class="id">Z.max</span> <span class="id">n1</span> <span class="id">n2</span>)<br/>
&nbsp;&nbsp;| <span class="id">Uns</span> <span class="id">p1</span> <span class="id">n1</span>, <span class="id">Sgn</span> <span class="id">p2</span> <span class="id">n2</span> =&gt; <span class="id">sgn</span> (<span class="id">plub</span> <span class="id">p1</span> <span class="id">p2</span>) (<span class="id">Z.max</span> (<span class="id">n1</span> + 1) <span class="id">n2</span>)<br/>
&nbsp;&nbsp;| <span class="id">Sgn</span> <span class="id">p1</span> <span class="id">n1</span>, <span class="id">Uns</span> <span class="id">p2</span> <span class="id">n2</span> =&gt; <span class="id">sgn</span> (<span class="id">plub</span> <span class="id">p1</span> <span class="id">p2</span>) (<span class="id">Z.max</span> <span class="id">n1</span> (<span class="id">n2</span> + 1))<br/>
&nbsp;&nbsp;| <span class="id">Sgn</span> <span class="id">p1</span> <span class="id">n1</span>, <span class="id">Sgn</span> <span class="id">p2</span> <span class="id">n2</span> =&gt; <span class="id">sgn</span> (<span class="id">plub</span> <span class="id">p1</span> <span class="id">p2</span>) (<span class="id">Z.max</span> <span class="id">n1</span> <span class="id">n2</span>)<br/>
&nbsp;&nbsp;| <span class="id">F</span> <span class="id">f1</span>, <span class="id">F</span> <span class="id">f2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">Float.eq_dec</span> <span class="id">f1</span> <span class="id">f2</span> <span class="kwd">then</span> <span class="id">v</span> <span class="kwd">else</span> <span class="id">ntop</span><br/>
&nbsp;&nbsp;| <span class="id">FS</span> <span class="id">f1</span>, <span class="id">FS</span> <span class="id">f2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">Float32.eq_dec</span> <span class="id">f1</span> <span class="id">f2</span> <span class="kwd">then</span> <span class="id">v</span> <span class="kwd">else</span> <span class="id">ntop</span><br/>
&nbsp;&nbsp;| <span class="id">L</span> <span class="id">i1</span>, <span class="id">L</span> <span class="id">i2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">Int64.eq</span> <span class="id">i1</span> <span class="id">i2</span> <span class="kwd">then</span> <span class="id">v</span> <span class="kwd">else</span> <span class="id">ntop</span><br/>
&nbsp;&nbsp;| <span class="id">Ptr</span> <span class="id">p1</span>, <span class="id">Ptr</span> <span class="id">p2</span> =&gt; <span class="id">Ptr</span>(<span class="id">plub</span> <span class="id">p1</span> <span class="id">p2</span>)<br/>
&nbsp;&nbsp;| <span class="id">Ptr</span> <span class="id">p1</span>, <span class="id">Ifptr</span> <span class="id">p2</span> =&gt; <span class="id">Ifptr</span>(<span class="id">plub</span> <span class="id">p1</span> <span class="id">p2</span>)<br/>
&nbsp;&nbsp;| <span class="id">Ifptr</span> <span class="id">p1</span>, <span class="id">Ptr</span> <span class="id">p2</span> =&gt; <span class="id">Ifptr</span>(<span class="id">plub</span> <span class="id">p1</span> <span class="id">p2</span>)<br/>
&nbsp;&nbsp;| <span class="id">Ifptr</span> <span class="id">p1</span>, <span class="id">Ifptr</span> <span class="id">p2</span> =&gt; <span class="id">Ifptr</span>(<span class="id">plub</span> <span class="id">p1</span> <span class="id">p2</span>)<br/>
&nbsp;&nbsp;| (<span class="id">Ptr</span> <span class="id">p1</span> | <span class="id">Ifptr</span> <span class="id">p1</span>), (<span class="id">Uns</span> <span class="id">p2</span> <span class="id">_</span> | <span class="id">Sgn</span> <span class="id">p2</span> <span class="id">_</span>) =&gt; <span class="id">Ifptr</span>(<span class="id">plub</span> <span class="id">p1</span> <span class="id">p2</span>)<br/>
&nbsp;&nbsp;| (<span class="id">Uns</span> <span class="id">p1</span> <span class="id">_</span> | <span class="id">Sgn</span> <span class="id">p1</span> <span class="id">_</span>), (<span class="id">Ptr</span> <span class="id">p2</span> | <span class="id">Ifptr</span> <span class="id">p2</span>) =&gt; <span class="id">Ifptr</span>(<span class="id">plub</span> <span class="id">p1</span> <span class="id">p2</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span>, (<span class="id">Ptr</span> <span class="id">p</span> | <span class="id">Ifptr</span> <span class="id">p</span>) | (<span class="id">Ptr</span> <span class="id">p</span> | <span class="id">Ifptr</span> <span class="id">p</span>), <span class="id">_</span> =&gt; <span class="kwd">if</span> <span class="id">va_strict</span> <span class="id">tt</span> <span class="kwd">then</span> <span class="id">Ifptr</span> <span class="id">p</span> <span class="kwd">else</span> <span class="id">Vtop</span><br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">Vtop</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">vlub_comm</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">w</span>, <span class="id">vlub</span> <span class="id">v</span> <span class="id">w</span> = <span class="id">vlub</span> <span class="id">w</span> <span class="id">v</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2811')">Proof.</div>
<div class="proofscript" id="proof2811">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">vlub</span>; <span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">destruct</span> <span class="id">w</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">rewrite</span> <span class="id">Int.eq_sym</span>. <span class="id">predSpec</span> <span class="id">Int.eq</span> <span class="id">Int.eq_spec</span> <span class="id">n0</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">orb_comm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Int.lt</span> <span class="id">n0</span> <span class="id">Int.zero</span> || <span class="id">Int.lt</span> <span class="id">n</span> <span class="id">Int.zero</span>); <span class="tactic">f_equal</span>; <span class="tactic">apply</span> <span class="id">Z.max_comm</span>.<br/>
- <span class="tactic">f_equal</span>. <span class="tactic">apply</span> <span class="id">plub_comm</span>. <span class="tactic">apply</span> <span class="id">Z.max_comm</span>.<br/>
- <span class="tactic">f_equal</span>. <span class="tactic">apply</span> <span class="id">plub_comm</span>. <span class="tactic">apply</span> <span class="id">Z.max_comm</span>.<br/>
- <span class="tactic">f_equal</span>; <span class="tactic">apply</span> <span class="id">plub_comm</span>.<br/>
- <span class="tactic">f_equal</span>; <span class="tactic">apply</span> <span class="id">plub_comm</span>.<br/>
- <span class="tactic">f_equal</span>. <span class="tactic">apply</span> <span class="id">plub_comm</span>. <span class="tactic">apply</span> <span class="id">Z.max_comm</span>.<br/>
- <span class="tactic">f_equal</span>. <span class="tactic">apply</span> <span class="id">plub_comm</span>. <span class="tactic">apply</span> <span class="id">Z.max_comm</span>.<br/>
- <span class="tactic">f_equal</span>; <span class="tactic">apply</span> <span class="id">plub_comm</span>.<br/>
- <span class="tactic">f_equal</span>; <span class="tactic">apply</span> <span class="id">plub_comm</span>.<br/>
- <span class="tactic">rewrite</span> <span class="id">Int64.eq_sym</span>. <span class="id">predSpec</span> <span class="id">Int64.eq</span> <span class="id">Int64.eq_spec</span> <span class="id">n0</span> <span class="id">n</span>; <span class="tactic">congruence</span>.<br/>
- <span class="tactic">rewrite</span> <span class="id">dec_eq_sym</span>. <span class="tactic">destruct</span> (<span class="id">Float.eq_dec</span> <span class="id">f0</span> <span class="id">f</span>). <span class="tactic">congruence</span>. <span class="tactic">auto</span>.<br/>
- <span class="tactic">rewrite</span> <span class="id">dec_eq_sym</span>. <span class="tactic">destruct</span> (<span class="id">Float32.eq_dec</span> <span class="id">f0</span> <span class="id">f</span>). <span class="tactic">congruence</span>. <span class="tactic">auto</span>.<br/>
- <span class="tactic">f_equal</span>; <span class="tactic">apply</span> <span class="id">plub_comm</span>.<br/>
- <span class="tactic">f_equal</span>; <span class="tactic">apply</span> <span class="id">plub_comm</span>.<br/>
- <span class="tactic">f_equal</span>; <span class="tactic">apply</span> <span class="id">plub_comm</span>.<br/>
- <span class="tactic">f_equal</span>; <span class="tactic">apply</span> <span class="id">plub_comm</span>.<br/>
- <span class="tactic">f_equal</span>; <span class="tactic">apply</span> <span class="id">plub_comm</span>.<br/>
- <span class="tactic">f_equal</span>; <span class="tactic">apply</span> <span class="id">plub_comm</span>.<br/>
- <span class="tactic">f_equal</span>; <span class="tactic">apply</span> <span class="id">plub_comm</span>.<br/>
- <span class="tactic">f_equal</span>; <span class="tactic">apply</span> <span class="id">plub_comm</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">vge_uns_uns</span>': <span class="kwd">forall</span> <span class="id">p</span> <span class="id">n</span>, <span class="id">vge</span> (<span class="id">uns</span> <span class="id">p</span> <span class="id">n</span>) (<span class="id">Uns</span> <span class="id">p</span> <span class="id">n</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2812')">Proof.</div>
<div class="proofscript" id="proof2812">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">uns</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zle</span> <span class="id">n</span> 1). <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zle</span> <span class="id">n</span> 7). <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zle</span> <span class="id">n</span> 8). <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zle</span> <span class="id">n</span> 15). <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zle</span> <span class="id">n</span> 16); <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">vge_uns_i</span>': <span class="kwd">forall</span> <span class="id">p</span> <span class="id">n</span> <span class="id">i</span>, 0 &lt;= <span class="id">n</span> -&gt; <span class="id">is_uns</span> <span class="id">n</span> <span class="id">i</span> -&gt; <span class="id">vge</span> (<span class="id">uns</span> <span class="id">p</span> <span class="id">n</span>) (<span class="id">I</span> <span class="id">i</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2813')">Proof.</div>
<div class="proofscript" id="proof2813">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">vge_trans</span> <span class="kwd">with</span> (<span class="id">Uns</span> <span class="id">p</span> <span class="id">n</span>). <span class="tactic">apply</span> <span class="id">vge_uns_uns</span>'. <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">vge_sgn_sgn</span>': <span class="kwd">forall</span> <span class="id">p</span> <span class="id">n</span>, <span class="id">vge</span> (<span class="id">sgn</span> <span class="id">p</span> <span class="id">n</span>) (<span class="id">Sgn</span> <span class="id">p</span> <span class="id">n</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2814')">Proof.</div>
<div class="proofscript" id="proof2814">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">sgn</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zle</span> <span class="id">n</span> 8). <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zle</span> <span class="id">n</span> 16); <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">vge_sgn_i</span>': <span class="kwd">forall</span> <span class="id">p</span> <span class="id">n</span> <span class="id">i</span>, 0 &lt; <span class="id">n</span> -&gt; <span class="id">is_sgn</span> <span class="id">n</span> <span class="id">i</span> -&gt; <span class="id">vge</span> (<span class="id">sgn</span> <span class="id">p</span> <span class="id">n</span>) (<span class="id">I</span> <span class="id">i</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2815')">Proof.</div>
<div class="proofscript" id="proof2815">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">vge_trans</span> <span class="kwd">with</span> (<span class="id">Sgn</span> <span class="id">p</span> <span class="id">n</span>). <span class="tactic">apply</span> <span class="id">vge_sgn_sgn</span>'. <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">vge_uns_uns</span>' <span class="id">vge_uns_i</span>' <span class="id">vge_sgn_sgn</span>' <span class="id">vge_sgn_i</span>' : <span class="id">va</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">usize_pos</span>: <span class="kwd">forall</span> <span class="id">n</span>, 0 &lt;= <span class="id">usize</span> <span class="id">n</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2816')">Proof.</div>
<div class="proofscript" id="proof2816">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">usize</span>; <span class="tactic">intros</span>. <span class="tactic">generalize</span> (<span class="id">Int.size_range</span> <span class="id">n</span>); <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">ssize_pos</span>: <span class="kwd">forall</span> <span class="id">n</span>, 0 &lt; <span class="id">ssize</span> <span class="id">n</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2817')">Proof.</div>
<div class="proofscript" id="proof2817">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">ssize</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Int.size_range</span> (<span class="kwd">if</span> <span class="id">Int.lt</span> <span class="id">n</span> <span class="id">Int.zero</span> <span class="kwd">then</span> <span class="id">Int.not</span> <span class="id">n</span> <span class="kwd">else</span> <span class="id">n</span>)); <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">vge_lub_l</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">vge</span> (<span class="id">vlub</span> <span class="id">x</span> <span class="id">y</span>) <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2818')">Proof.</div>
<div class="proofscript" id="proof2818">
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">IFSTRICT</span>: <span class="kwd">forall</span> (<span class="id">cond</span>: <span class="id">bool</span>) <span class="id">x1</span> <span class="id">x2</span> <span class="id">y</span>, <span class="id">vge</span> <span class="id">x1</span> <span class="id">y</span> -&gt; <span class="id">vge</span> <span class="id">x2</span> <span class="id">y</span> -&gt; <span class="id">vge</span> (<span class="kwd">if</span> <span class="id">cond</span> <span class="kwd">then</span> <span class="id">x1</span> <span class="kwd">else</span> <span class="id">x2</span>) <span class="id">y</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">cond</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">vlub</span>; <span class="tactic">destruct</span> <span class="id">x</span>, <span class="id">y</span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id">pge_lub_l</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="id">predSpec</span> <span class="id">Int.eq</span> <span class="id">Int.eq_spec</span> <span class="id">n</span> <span class="id">n0</span>. <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Int.lt</span> <span class="id">n</span> <span class="id">Int.zero</span> || <span class="id">Int.lt</span> <span class="id">n0</span> <span class="id">Int.zero</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">vge_sgn_i</span>'. <span class="tactic">generalize</span> (<span class="id">ssize_pos</span> <span class="id">n</span>); <span class="id">xomega</span>. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">vge_uns_i</span>'. <span class="tactic">generalize</span> (<span class="id">usize_pos</span> <span class="id">n</span>); <span class="id">xomega</span>. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">Int.lt</span> <span class="id">n</span> <span class="id">Int.zero</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">vge_sgn_i</span>'. <span class="tactic">generalize</span> (<span class="id">ssize_pos</span> <span class="id">n</span>); <span class="id">xomega</span>. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">vge_uns_i</span>'. <span class="tactic">generalize</span> (<span class="id">usize_pos</span> <span class="id">n</span>); <span class="id">xomega</span>. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="tactic">apply</span> <span class="id">vge_sgn_i</span>'. <span class="tactic">generalize</span> (<span class="id">ssize_pos</span> <span class="id">n</span>); <span class="id">xomega</span>. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">Int.lt</span> <span class="id">n0</span> <span class="id">Int.zero</span>).<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">vge_trans</span>. <span class="tactic">apply</span> <span class="id">vge_sgn_sgn</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">vge_trans</span> <span class="kwd">with</span> (<span class="id">Sgn</span> <span class="id">p</span> (<span class="id">n</span> + 1)); <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">vge_trans</span>. <span class="tactic">apply</span> <span class="id">vge_uns_uns</span>'. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="tactic">eapply</span> <span class="id">vge_trans</span>. <span class="tactic">apply</span> <span class="id">vge_sgn_sgn</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">vge_trans</span> <span class="kwd">with</span> (<span class="id">Sgn</span> <span class="id">p</span> (<span class="id">n</span> + 1)); <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id">pge_lub_l</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="tactic">eapply</span> <span class="id">vge_trans</span>. <span class="tactic">apply</span> <span class="id">vge_sgn_sgn</span>'. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="tactic">eapply</span> <span class="id">vge_trans</span>. <span class="tactic">apply</span> <span class="id">vge_sgn_sgn</span>'. <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id">pge_lub_l</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="tactic">eapply</span> <span class="id">vge_trans</span>. <span class="tactic">apply</span> <span class="id">vge_sgn_sgn</span>'. <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id">pge_lub_l</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">Int64.eq</span> <span class="id">n</span> <span class="id">n0</span>); <span class="id">constructor</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">Float.eq_dec</span> <span class="id">f</span> <span class="id">f0</span>); <span class="id">constructor</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">Float32.eq_dec</span> <span class="id">f</span> <span class="id">f0</span>); <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">vge_lub_r</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">vge</span> (<span class="id">vlub</span> <span class="id">x</span> <span class="id">y</span>) <span class="id">y</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2819')">Proof.</div>
<div class="proofscript" id="proof2819">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">vlub_comm</span>. <span class="tactic">apply</span> <span class="id">vge_lub_l</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">vmatch_lub_l</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">v</span> (<span class="id">vlub</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2820')">Proof.</div>
<div class="proofscript" id="proof2820">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id">vmatch_ge</span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">vge_lub_l</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">vmatch_lub_r</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">y</span> -&gt; <span class="id">vmatch</span> <span class="id">v</span> (<span class="id">vlub</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2821')">Proof.</div>
<div class="proofscript" id="proof2821">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">vlub_comm</span>. <span class="tactic">apply</span> <span class="id">vmatch_lub_l</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">In the CompCert semantics, a memory load or store succeeds only
  if the address is a pointer value.  Hence, in strict mode,
  <span class="bracket"><span class="id">aptr_of_aval</span> <span class="id">x</span></span> returns <span class="bracket"><span class="id">Pbot</span></span> (no pointer value) if <span class="bracket"><span class="id">x</span></span>
  denotes a number or <span class="bracket"><span class="id">Vundef</span></span>.  However, in real code, memory
  addresses are sometimes synthesized from integers, e.g. an absolute
  address for a hardware device.  It is a reasonable assumption
  that these absolute addresses do not point within the stack block,
  however.  Therefore, in relaxed mode, <span class="bracket"><span class="id">aptr_of_aval</span> <span class="id">x</span></span> returns
  <span class="bracket"><span class="id">Nonstack</span></span> (any pointer outside the stack) when <span class="bracket"><span class="id">x</span></span> denotes a number. </div>
<br/>
<span class="kwd">Definition</span> <span class="id">aptr_of_aval</span> (<span class="id">v</span>: <span class="id">aval</span>) : <span class="id">aptr</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">v</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Ptr</span> <span class="id">p</span> =&gt; <span class="id">p</span><br/>
&nbsp;&nbsp;| <span class="id">Ifptr</span> <span class="id">p</span> =&gt; <span class="id">p</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="kwd">if</span> <span class="id">va_strict</span> <span class="id">tt</span> <span class="kwd">then</span> <span class="id">Pbot</span> <span class="kwd">else</span> <span class="id">Nonstack</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">match_aptr_of_aval</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">av</span>,<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> (<span class="id">Vptr</span> <span class="id">b</span> <span class="id">ofs</span>) <span class="id">av</span> -&gt; <span class="id">pmatch</span> <span class="id">b</span> <span class="id">ofs</span> (<span class="id">aptr_of_aval</span> <span class="id">av</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2822')">Proof.</div>
<div class="proofscript" id="proof2822">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">aptr_of_aval</span>; <span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">vplub</span> (<span class="id">v</span>: <span class="id">aval</span>) (<span class="id">p</span>: <span class="id">aptr</span>) : <span class="id">aptr</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">v</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Ptr</span> <span class="id">q</span> =&gt; <span class="id">plub</span> <span class="id">q</span> <span class="id">p</span><br/>
&nbsp;&nbsp;| <span class="id">Ifptr</span> <span class="id">q</span> =&gt; <span class="id">plub</span> <span class="id">q</span> <span class="id">p</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">p</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">vmatch_vplub_l</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span> <span class="id">p</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">v</span> (<span class="id">Ifptr</span> (<span class="id">vplub</span> <span class="id">x</span> <span class="id">p</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2823')">Proof.</div>
<div class="proofscript" id="proof2823">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">vplub</span>; <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>; <span class="id">constructor</span>; <span class="tactic">eapply</span> <span class="id">pmatch_lub_l</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">pmatch_vplub</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">x</span> <span class="id">p</span>, <span class="id">pmatch</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">p</span> -&gt; <span class="id">pmatch</span> <span class="id">b</span> <span class="id">ofs</span> (<span class="id">vplub</span> <span class="id">x</span> <span class="id">p</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2824')">Proof.</div>
<div class="proofscript" id="proof2824">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">DFL</span>: <span class="id">pmatch</span> <span class="id">b</span> <span class="id">ofs</span> (<span class="kwd">if</span> <span class="id">va_strict</span> <span class="id">tt</span> <span class="kwd">then</span> <span class="id">p</span> <span class="kwd">else</span> <span class="id">Ptop</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">destruct</span> (<span class="id">va_strict</span> <span class="id">tt</span>); <span class="tactic">auto</span>. <span class="tactic">eapply</span> <span class="id">pmatch_top</span>'; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">vplub</span>; <span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">auto</span>; <span class="tactic">apply</span> <span class="id">pmatch_lub_r</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">vmatch_vplub_r</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span> <span class="id">p</span>, <span class="id">vmatch</span> <span class="id">v</span> (<span class="id">Ifptr</span> <span class="id">p</span>) -&gt; <span class="id">vmatch</span> <span class="id">v</span> (<span class="id">Ifptr</span> (<span class="id">vplub</span> <span class="id">x</span> <span class="id">p</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2825')">Proof.</div>
<div class="proofscript" id="proof2825">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">vmatch_ifptr</span>; <span class="tactic">intros</span>; <span class="tactic">subst</span> <span class="id">v</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id">pmatch_vplub</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Inclusion </div>
<br/>
<span class="kwd">Definition</span> <span class="id">vpincl</span> (<span class="id">v</span>: <span class="id">aval</span>) (<span class="id">p</span>: <span class="id">aptr</span>) : <span class="id">bool</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">v</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Ptr</span> <span class="id">q</span> | <span class="id">Ifptr</span> <span class="id">q</span> | <span class="id">Uns</span> <span class="id">q</span> <span class="id">_</span> | <span class="id">Sgn</span> <span class="id">q</span> <span class="id">_</span> =&gt; <span class="id">pincl</span> <span class="id">q</span> <span class="id">p</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">true</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">vpincl_ge</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">p</span>, <span class="id">vpincl</span> <span class="id">x</span> <span class="id">p</span> = <span class="id">true</span> -&gt; <span class="id">vge</span> (<span class="id">Ifptr</span> <span class="id">p</span>) <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2826')">Proof.</div>
<div class="proofscript" id="proof2826">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">vpincl</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">x</span>; <span class="id">constructor</span>; <span class="tactic">apply</span> <span class="id">pincl_ge</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">vpincl_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span> <span class="id">p</span>, <span class="id">vpincl</span> <span class="id">x</span> <span class="id">p</span> = <span class="id">true</span> -&gt; <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">v</span> (<span class="id">Ifptr</span> <span class="id">p</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2827')">Proof.</div>
<div class="proofscript" id="proof2827">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">vmatch_ge</span> <span class="kwd">with</span> <span class="id">x</span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">vpincl_ge</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">vincl</span> (<span class="id">v</span> <span class="id">w</span>: <span class="id">aval</span>) : <span class="id">bool</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">v</span>, <span class="id">w</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Vbot</span>, <span class="id">_</span> =&gt; <span class="id">true</span><br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">i</span>, <span class="id">I</span> <span class="id">j</span> =&gt; <span class="id">Int.eq_dec</span> <span class="id">i</span> <span class="id">j</span><br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">i</span>, <span class="id">Uns</span> <span class="id">p</span> <span class="id">n</span> =&gt; <span class="id">Int.eq_dec</span> (<span class="id">Int.zero_ext</span> <span class="id">n</span> <span class="id">i</span>) <span class="id">i</span> &amp;&amp; <span class="id">zle</span> 0 <span class="id">n</span><br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">i</span>, <span class="id">Sgn</span> <span class="id">p</span> <span class="id">n</span> =&gt; <span class="id">Int.eq_dec</span> (<span class="id">Int.sign_ext</span> <span class="id">n</span> <span class="id">i</span>) <span class="id">i</span> &amp;&amp; <span class="id">zlt</span> 0 <span class="id">n</span><br/>
&nbsp;&nbsp;| <span class="id">Uns</span> <span class="id">p</span> <span class="id">n</span>, <span class="id">Uns</span> <span class="id">q</span> <span class="id">m</span> =&gt; <span class="id">zle</span> <span class="id">n</span> <span class="id">m</span> &amp;&amp; <span class="id">pincl</span> <span class="id">p</span> <span class="id">q</span><br/>
&nbsp;&nbsp;| <span class="id">Uns</span> <span class="id">p</span> <span class="id">n</span>, <span class="id">Sgn</span> <span class="id">q</span> <span class="id">m</span> =&gt; <span class="id">zlt</span> <span class="id">n</span> <span class="id">m</span> &amp;&amp; <span class="id">pincl</span> <span class="id">p</span> <span class="id">q</span><br/>
&nbsp;&nbsp;| <span class="id">Sgn</span> <span class="id">p</span> <span class="id">n</span>, <span class="id">Sgn</span> <span class="id">q</span> <span class="id">m</span> =&gt; <span class="id">zle</span> <span class="id">n</span> <span class="id">m</span> &amp;&amp; <span class="id">pincl</span> <span class="id">p</span> <span class="id">q</span><br/>
&nbsp;&nbsp;| <span class="id">L</span> <span class="id">i</span>, <span class="id">L</span> <span class="id">j</span> =&gt; <span class="id">Int64.eq_dec</span> <span class="id">i</span> <span class="id">j</span><br/>
&nbsp;&nbsp;| <span class="id">F</span> <span class="id">i</span>, <span class="id">F</span> <span class="id">j</span> =&gt; <span class="id">Float.eq_dec</span> <span class="id">i</span> <span class="id">j</span><br/>
&nbsp;&nbsp;| <span class="id">FS</span> <span class="id">i</span>, <span class="id">FS</span> <span class="id">j</span> =&gt; <span class="id">Float32.eq_dec</span> <span class="id">i</span> <span class="id">j</span><br/>
&nbsp;&nbsp;| <span class="id">Ptr</span> <span class="id">p</span>, <span class="id">Ptr</span> <span class="id">q</span> =&gt; <span class="id">pincl</span> <span class="id">p</span> <span class="id">q</span><br/>
&nbsp;&nbsp;| (<span class="id">Ptr</span> <span class="id">p</span> | <span class="id">Ifptr</span> <span class="id">p</span> | <span class="id">Uns</span> <span class="id">p</span> <span class="id">_</span> | <span class="id">Sgn</span> <span class="id">p</span> <span class="id">_</span>), <span class="id">Ifptr</span> <span class="id">q</span> =&gt; <span class="id">pincl</span> <span class="id">p</span> <span class="id">q</span><br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">Ifptr</span> <span class="id">_</span> =&gt; <span class="id">true</span><br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">false</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">vincl_ge</span>: <span class="kwd">forall</span> <span class="id">v</span> <span class="id">w</span>, <span class="id">vincl</span> <span class="id">v</span> <span class="id">w</span> = <span class="id">true</span> -&gt; <span class="id">vge</span> <span class="id">w</span> <span class="id">v</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2828')">Proof.</div>
<div class="proofscript" id="proof2828">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">vincl</span>; <span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">destruct</span> <span class="id">w</span>;<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>; <span class="tactic">try</span> <span class="id">InvBooleans</span>; <span class="tactic">try</span> <span class="tactic">subst</span>; <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id">pincl_ge</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="id">constructor</span>; <span class="tactic">auto</span>. <span class="tactic">rewrite</span> <span class="id">is_uns_zero_ext</span>; <span class="tactic">auto</span>.<br/>
- <span class="id">constructor</span>; <span class="tactic">auto</span>. <span class="tactic">rewrite</span> <span class="id">is_sgn_sign_ext</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Loading constants </div>
<br/>
<span class="kwd">Definition</span> <span class="id">genv_match</span> (<span class="id">ge</span>: <span class="id">genv</span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">id</span> <span class="id">b</span>, <span class="id">Genv.find_symbol</span> <span class="id">ge</span> <span class="id">id</span> = <span class="id">Some</span> <span class="id">b</span> &lt;-&gt; <span class="id">bc</span> <span class="id">b</span> = <span class="id">BCglob</span> <span class="id">id</span>)<br/>
/\(<span class="kwd">forall</span> <span class="id">b</span>, <span class="id">Plt</span> <span class="id">b</span> (<span class="id">Genv.genv_next</span> <span class="id">ge</span>) -&gt; <span class="id">bc</span> <span class="id">b</span> &lt;&gt; <span class="id">BCinvalid</span> /\ <span class="id">bc</span> <span class="id">b</span> &lt;&gt; <span class="id">BCstack</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">symbol_address_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ge</span> <span class="id">id</span> <span class="id">ofs</span>,<br/>
&nbsp;&nbsp;<span class="id">genv_match</span> <span class="id">ge</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> (<span class="id">Genv.symbol_address</span> <span class="id">ge</span> <span class="id">id</span> <span class="id">ofs</span>) (<span class="id">Ptr</span> (<span class="id">Gl</span> <span class="id">id</span> <span class="id">ofs</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2829')">Proof.</div>
<div class="proofscript" id="proof2829">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">Genv.symbol_address</span>. <span class="tactic">destruct</span> (<span class="id">Genv.find_symbol</span> <span class="id">ge</span> <span class="id">id</span>) <span class="kwd">as</span> [<span class="id">b</span>|] <span class="id">eqn</span>:<span class="id">F</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>. <span class="id">constructor</span>. <span class="tactic">apply</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">vmatch_ptr_gl</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ge</span> <span class="id">v</span> <span class="id">id</span> <span class="id">ofs</span>,<br/>
&nbsp;&nbsp;<span class="id">genv_match</span> <span class="id">ge</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> <span class="id">v</span> (<span class="id">Ptr</span> (<span class="id">Gl</span> <span class="id">id</span> <span class="id">ofs</span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="id">Val.lessdef</span> <span class="id">v</span> (<span class="id">Genv.symbol_address</span> <span class="id">ge</span> <span class="id">id</span> <span class="id">ofs</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2830')">Proof.</div>
<div class="proofscript" id="proof2830">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">Genv.symbol_address</span>. <span class="id">inv</span> <span class="id">H0</span>.<br/>
- <span class="id">inv</span> <span class="id">H3</span>. <span class="tactic">replace</span> (<span class="id">Genv.find_symbol</span> <span class="id">ge</span> <span class="id">id</span>) <span class="kwd">with</span> (<span class="id">Some</span> <span class="id">b</span>). <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">symmetry</span>. <span class="tactic">apply</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
- <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">vmatch_ptr_stk</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">ofs</span> <span class="id">sp</span>,<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> <span class="id">v</span> (<span class="id">Ptr</span>(<span class="id">Stk</span> <span class="id">ofs</span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="id">bc</span> <span class="id">sp</span> = <span class="id">BCstack</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">Val.lessdef</span> <span class="id">v</span> (<span class="id">Vptr</span> <span class="id">sp</span> <span class="id">ofs</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2831')">Proof.</div>
<div class="proofscript" id="proof2831">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>.<br/>
- <span class="id">inv</span> <span class="id">H3</span>. <span class="tactic">replace</span> <span class="id">b</span> <span class="kwd">with</span> <span class="id">sp</span> <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id">bc_stack</span>; <span class="tactic">eauto</span>). <span class="id">constructor</span>.<br/>
- <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Generic operations that just do constant propagation. </div>
<br/>
<span class="kwd">Definition</span> <span class="id">unop_int</span> (<span class="id">sem</span>: <span class="id">int</span> -&gt; <span class="id">int</span>) (<span class="id">x</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span> <span class="kwd">with</span> <span class="id">I</span> <span class="id">n</span> =&gt; <span class="id">I</span> (<span class="id">sem</span> <span class="id">n</span>) | <span class="id">_</span> =&gt; <span class="id">ntop1</span> <span class="id">x</span> <span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">unop_int_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sem</span> <span class="id">v</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> (<span class="kwd">match</span> <span class="id">v</span> <span class="kwd">with</span> <span class="id">Vint</span> <span class="id">i</span> =&gt; <span class="id">Vint</span>(<span class="id">sem</span> <span class="id">i</span>) | <span class="id">_</span> =&gt; <span class="id">Vundef</span> <span class="kwd">end</span>) (<span class="id">unop_int</span> <span class="id">sem</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2832')">Proof.</div>
<div class="proofscript" id="proof2832">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">unop_int</span>; <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">binop_int</span> (<span class="id">sem</span>: <span class="id">int</span> -&gt; <span class="id">int</span> -&gt; <span class="id">int</span>) (<span class="id">x</span> <span class="id">y</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span>, <span class="id">y</span> <span class="kwd">with</span> <span class="id">I</span> <span class="id">n</span>, <span class="id">I</span> <span class="id">m</span> =&gt; <span class="id">I</span> (<span class="id">sem</span> <span class="id">n</span> <span class="id">m</span>) | <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">ntop2</span> <span class="id">x</span> <span class="id">y</span> <span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">binop_int_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sem</span> <span class="id">v</span> <span class="id">x</span> <span class="id">w</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> (<span class="kwd">match</span> <span class="id">v</span>, <span class="id">w</span> <span class="kwd">with</span> <span class="id">Vint</span> <span class="id">i</span>, <span class="id">Vint</span> <span class="id">j</span> =&gt; <span class="id">Vint</span>(<span class="id">sem</span> <span class="id">i</span> <span class="id">j</span>) | <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">Vundef</span> <span class="kwd">end</span>) (<span class="id">binop_int</span> <span class="id">sem</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2833')">Proof.</div>
<div class="proofscript" id="proof2833">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">binop_int</span>; <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>; <span class="id">inv</span> <span class="id">H0</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">unop_long</span> (<span class="id">sem</span>: <span class="id">int64</span> -&gt; <span class="id">int64</span>) (<span class="id">x</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span> <span class="kwd">with</span> <span class="id">L</span> <span class="id">n</span> =&gt; <span class="id">L</span> (<span class="id">sem</span> <span class="id">n</span>) | <span class="id">_</span> =&gt; <span class="id">ntop1</span> <span class="id">x</span> <span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">unop_long_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sem</span> <span class="id">v</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> (<span class="kwd">match</span> <span class="id">v</span> <span class="kwd">with</span> <span class="id">Vlong</span> <span class="id">i</span> =&gt; <span class="id">Vlong</span>(<span class="id">sem</span> <span class="id">i</span>) | <span class="id">_</span> =&gt; <span class="id">Vundef</span> <span class="kwd">end</span>) (<span class="id">unop_long</span> <span class="id">sem</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2834')">Proof.</div>
<div class="proofscript" id="proof2834">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">unop_long</span>; <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">binop_long</span> (<span class="id">sem</span>: <span class="id">int64</span> -&gt; <span class="id">int64</span> -&gt; <span class="id">int64</span>) (<span class="id">x</span> <span class="id">y</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span>, <span class="id">y</span> <span class="kwd">with</span> <span class="id">L</span> <span class="id">n</span>, <span class="id">L</span> <span class="id">m</span> =&gt; <span class="id">L</span> (<span class="id">sem</span> <span class="id">n</span> <span class="id">m</span>) | <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">ntop2</span> <span class="id">x</span> <span class="id">y</span> <span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">binop_long_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sem</span> <span class="id">v</span> <span class="id">x</span> <span class="id">w</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> (<span class="kwd">match</span> <span class="id">v</span>, <span class="id">w</span> <span class="kwd">with</span> <span class="id">Vlong</span> <span class="id">i</span>, <span class="id">Vlong</span> <span class="id">j</span> =&gt; <span class="id">Vlong</span>(<span class="id">sem</span> <span class="id">i</span> <span class="id">j</span>) | <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">Vundef</span> <span class="kwd">end</span>) (<span class="id">binop_long</span> <span class="id">sem</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2835')">Proof.</div>
<div class="proofscript" id="proof2835">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">binop_long</span>; <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>; <span class="id">inv</span> <span class="id">H0</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">unop_float</span> (<span class="id">sem</span>: <span class="id">float</span> -&gt; <span class="id">float</span>) (<span class="id">x</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span> <span class="kwd">with</span> <span class="id">F</span> <span class="id">n</span> =&gt; <span class="id">F</span> (<span class="id">sem</span> <span class="id">n</span>) | <span class="id">_</span> =&gt; <span class="id">ntop1</span> <span class="id">x</span> <span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">unop_float_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sem</span> <span class="id">v</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> (<span class="kwd">match</span> <span class="id">v</span> <span class="kwd">with</span> <span class="id">Vfloat</span> <span class="id">i</span> =&gt; <span class="id">Vfloat</span>(<span class="id">sem</span> <span class="id">i</span>) | <span class="id">_</span> =&gt; <span class="id">Vundef</span> <span class="kwd">end</span>) (<span class="id">unop_float</span> <span class="id">sem</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2836')">Proof.</div>
<div class="proofscript" id="proof2836">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">unop_float</span>; <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">binop_float</span> (<span class="id">sem</span>: <span class="id">float</span> -&gt; <span class="id">float</span> -&gt; <span class="id">float</span>) (<span class="id">x</span> <span class="id">y</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span>, <span class="id">y</span> <span class="kwd">with</span> <span class="id">F</span> <span class="id">n</span>, <span class="id">F</span> <span class="id">m</span> =&gt; <span class="id">F</span> (<span class="id">sem</span> <span class="id">n</span> <span class="id">m</span>) | <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">ntop2</span> <span class="id">x</span> <span class="id">y</span> <span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">binop_float_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sem</span> <span class="id">v</span> <span class="id">x</span> <span class="id">w</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> (<span class="kwd">match</span> <span class="id">v</span>, <span class="id">w</span> <span class="kwd">with</span> <span class="id">Vfloat</span> <span class="id">i</span>, <span class="id">Vfloat</span> <span class="id">j</span> =&gt; <span class="id">Vfloat</span>(<span class="id">sem</span> <span class="id">i</span> <span class="id">j</span>) | <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">Vundef</span> <span class="kwd">end</span>) (<span class="id">binop_float</span> <span class="id">sem</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2837')">Proof.</div>
<div class="proofscript" id="proof2837">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">binop_float</span>; <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>; <span class="id">inv</span> <span class="id">H0</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">unop_single</span> (<span class="id">sem</span>: <span class="id">float32</span> -&gt; <span class="id">float32</span>) (<span class="id">x</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span> <span class="kwd">with</span> <span class="id">FS</span> <span class="id">n</span> =&gt; <span class="id">FS</span> (<span class="id">sem</span> <span class="id">n</span>) | <span class="id">_</span> =&gt; <span class="id">ntop1</span> <span class="id">x</span> <span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">unop_single_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sem</span> <span class="id">v</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> (<span class="kwd">match</span> <span class="id">v</span> <span class="kwd">with</span> <span class="id">Vsingle</span> <span class="id">i</span> =&gt; <span class="id">Vsingle</span>(<span class="id">sem</span> <span class="id">i</span>) | <span class="id">_</span> =&gt; <span class="id">Vundef</span> <span class="kwd">end</span>) (<span class="id">unop_single</span> <span class="id">sem</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2838')">Proof.</div>
<div class="proofscript" id="proof2838">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">unop_single</span>; <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">binop_single</span> (<span class="id">sem</span>: <span class="id">float32</span> -&gt; <span class="id">float32</span> -&gt; <span class="id">float32</span>) (<span class="id">x</span> <span class="id">y</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span>, <span class="id">y</span> <span class="kwd">with</span> <span class="id">FS</span> <span class="id">n</span>, <span class="id">FS</span> <span class="id">m</span> =&gt; <span class="id">FS</span> (<span class="id">sem</span> <span class="id">n</span> <span class="id">m</span>) | <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">ntop2</span> <span class="id">x</span> <span class="id">y</span> <span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">binop_single_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sem</span> <span class="id">v</span> <span class="id">x</span> <span class="id">w</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> (<span class="kwd">match</span> <span class="id">v</span>, <span class="id">w</span> <span class="kwd">with</span> <span class="id">Vsingle</span> <span class="id">i</span>, <span class="id">Vsingle</span> <span class="id">j</span> =&gt; <span class="id">Vsingle</span>(<span class="id">sem</span> <span class="id">i</span> <span class="id">j</span>) | <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">Vundef</span> <span class="kwd">end</span>) (<span class="id">binop_single</span> <span class="id">sem</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2839')">Proof.</div>
<div class="proofscript" id="proof2839">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">binop_single</span>; <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>; <span class="id">inv</span> <span class="id">H0</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Logical operations </div>
<br/>
<span class="kwd">Definition</span> <span class="id">shl</span> (<span class="id">v</span> <span class="id">w</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">w</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">amount</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">Int.ltu</span> <span class="id">amount</span> <span class="id">Int.iwordsize</span> <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">v</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">I</span> <span class="id">i</span> =&gt; <span class="id">I</span> (<span class="id">Int.shl</span> <span class="id">i</span> <span class="id">amount</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Uns</span> <span class="id">p</span> <span class="id">n</span> =&gt; <span class="id">uns</span> <span class="id">p</span> (<span class="id">n</span> + <span class="id">Int.unsigned</span> <span class="id">amount</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Sgn</span> <span class="id">p</span> <span class="id">n</span> =&gt; <span class="id">sgn</span> <span class="id">p</span> (<span class="id">n</span> + <span class="id">Int.unsigned</span> <span class="id">amount</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">ntop1</span> <span class="id">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">ntop1</span> <span class="id">v</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">ntop1</span> <span class="id">v</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">shl_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">w</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.shl</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">shl</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2840')">Proof.</div>
<div class="proofscript" id="proof2840">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">DEFAULT</span>: <span class="id">vmatch</span> (<span class="id">Val.shl</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">ntop1</span> <span class="id">x</span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">destruct</span> <span class="id">w</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Int.ltu</span> <span class="id">i0</span> <span class="id">Int.iwordsize</span>); <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">y</span>; <span class="tactic">auto</span>. <span class="tactic">simpl</span>. <span class="id">inv</span> <span class="id">H0</span>. <span class="tactic">unfold</span> <span class="id">Val.shl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Int.ltu</span> <span class="id">n</span> <span class="id">Int.iwordsize</span>) <span class="id">eqn</span>:<span class="id">LTU</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Int.ltu_inv</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> <span class="id">RANGE</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="tactic">apply</span> <span class="id">vmatch_uns</span>'. <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">Int.bits_shl</span> <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">m</span> (<span class="id">Int.unsigned</span> <span class="id">n</span>)). <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">H1</span>; <span class="id">xomega</span>.<br/>
- <span class="tactic">apply</span> <span class="id">vmatch_sgn</span>'. <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="id">zify</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> ! <span class="id">Int.bits_shl</span> <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> ! <span class="id">zlt_false</span> <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="tactic">by</span> <span class="tactic">omega</span>. <span class="tactic">symmetry</span>. <span class="tactic">rewrite</span> <span class="id">H1</span> <span class="tactic">by</span> <span class="tactic">omega</span>. <span class="tactic">auto</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">v</span>; <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">shru</span> (<span class="id">v</span> <span class="id">w</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">w</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">amount</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">Int.ltu</span> <span class="id">amount</span> <span class="id">Int.iwordsize</span> <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">v</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">I</span> <span class="id">i</span> =&gt; <span class="id">I</span> (<span class="id">Int.shru</span> <span class="id">i</span> <span class="id">amount</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Uns</span> <span class="id">p</span> <span class="id">n</span> =&gt; <span class="id">uns</span> <span class="id">p</span> (<span class="id">n</span> - <span class="id">Int.unsigned</span> <span class="id">amount</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">uns</span> (<span class="id">provenance</span> <span class="id">v</span>) (<span class="id">Int.zwordsize</span> - <span class="id">Int.unsigned</span> <span class="id">amount</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">ntop1</span> <span class="id">v</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">ntop1</span> <span class="id">v</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">shru_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">w</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.shru</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">shru</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2841')">Proof.</div>
<div class="proofscript" id="proof2841">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">DEFAULT</span>: <span class="id">vmatch</span> (<span class="id">Val.shru</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">ntop1</span> <span class="id">x</span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">destruct</span> <span class="id">w</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Int.ltu</span> <span class="id">i0</span> <span class="id">Int.iwordsize</span>); <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">y</span>; <span class="tactic">auto</span>. <span class="id">inv</span> <span class="id">H0</span>. <span class="tactic">unfold</span> <span class="id">shru</span>, <span class="id">Val.shru</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Int.ltu</span> <span class="id">n</span> <span class="id">Int.iwordsize</span>) <span class="id">eqn</span>:<span class="id">LTU</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Int.ltu_inv</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> <span class="id">RANGE</span>. <span class="id">change</span> (<span class="id">Int.unsigned</span> <span class="id">Int.iwordsize</span>) <span class="kwd">with</span> <span class="id">Int.zwordsize</span> <span class="kwd">in</span> <span class="id">RANGE</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">DEFAULT2</span>: <span class="kwd">forall</span> <span class="id">i</span>, <span class="id">vmatch</span> (<span class="id">Vint</span> (<span class="id">Int.shru</span> <span class="id">i</span> <span class="id">n</span>)) (<span class="id">uns</span> (<span class="id">provenance</span> <span class="id">x</span>) (<span class="id">Int.zwordsize</span> - <span class="id">Int.unsigned</span> <span class="id">n</span>))).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">vmatch_uns</span>. <span class="tactic">red</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Int.bits_shru</span> <span class="tactic">by</span> <span class="tactic">omega</span>. <span class="tactic">apply</span> <span class="id">zlt_false</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="tactic">apply</span> <span class="id">vmatch_uns</span>'. <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="id">zify</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Int.bits_shru</span> <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zlt</span> (<span class="id">m</span> + <span class="id">Int.unsigned</span> <span class="id">n</span>) <span class="id">Int.zwordsize</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H1</span>; <span class="tactic">omega</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">v</span>; <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">shr</span> (<span class="id">v</span> <span class="id">w</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">w</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">amount</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">Int.ltu</span> <span class="id">amount</span> <span class="id">Int.iwordsize</span> <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">v</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">I</span> <span class="id">i</span> =&gt; <span class="id">I</span> (<span class="id">Int.shr</span> <span class="id">i</span> <span class="id">amount</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Uns</span> <span class="id">p</span> <span class="id">n</span> =&gt; <span class="id">sgn</span> <span class="id">p</span> (<span class="id">n</span> + 1 - <span class="id">Int.unsigned</span> <span class="id">amount</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Sgn</span> <span class="id">p</span> <span class="id">n</span> =&gt; <span class="id">sgn</span> <span class="id">p</span> (<span class="id">n</span> - <span class="id">Int.unsigned</span> <span class="id">amount</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">sgn</span> (<span class="id">provenance</span> <span class="id">v</span>) (<span class="id">Int.zwordsize</span> - <span class="id">Int.unsigned</span> <span class="id">amount</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">ntop1</span> <span class="id">v</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">ntop1</span> <span class="id">v</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">shr_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">w</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.shr</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">shr</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2842')">Proof.</div>
<div class="proofscript" id="proof2842">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">DEFAULT</span>: <span class="id">vmatch</span> (<span class="id">Val.shr</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">ntop1</span> <span class="id">x</span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">destruct</span> <span class="id">w</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Int.ltu</span> <span class="id">i0</span> <span class="id">Int.iwordsize</span>); <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">y</span>; <span class="tactic">auto</span>. <span class="id">inv</span> <span class="id">H0</span>. <span class="tactic">unfold</span> <span class="id">shr</span>, <span class="id">Val.shr</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Int.ltu</span> <span class="id">n</span> <span class="id">Int.iwordsize</span>) <span class="id">eqn</span>:<span class="id">LTU</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Int.ltu_inv</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> <span class="id">RANGE</span>. <span class="id">change</span> (<span class="id">Int.unsigned</span> <span class="id">Int.iwordsize</span>) <span class="kwd">with</span> <span class="id">Int.zwordsize</span> <span class="kwd">in</span> <span class="id">RANGE</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">DEFAULT2</span>: <span class="kwd">forall</span> <span class="id">i</span>, <span class="id">vmatch</span> (<span class="id">Vint</span> (<span class="id">Int.shr</span> <span class="id">i</span> <span class="id">n</span>)) (<span class="id">sgn</span> (<span class="id">provenance</span> <span class="id">x</span>) (<span class="id">Int.zwordsize</span> - <span class="id">Int.unsigned</span> <span class="id">n</span>))).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">vmatch_sgn</span>. <span class="tactic">red</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> ! <span class="id">Int.bits_shr</span> <span class="tactic">by</span> <span class="tactic">omega</span>. <span class="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zlt</span> (<span class="id">m</span> + <span class="id">Int.unsigned</span> <span class="id">n</span>) <span class="id">Int.zwordsize</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zlt</span> (<span class="id">Int.zwordsize</span> - 1 + <span class="id">Int.unsigned</span> <span class="id">n</span>) <span class="id">Int.zwordsize</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">SGN</span>: <span class="kwd">forall</span> <span class="id">q</span> <span class="id">i</span> <span class="id">p</span>, <span class="id">is_sgn</span> <span class="id">p</span> <span class="id">i</span> -&gt; 0 &lt; <span class="id">p</span> -&gt; <span class="id">vmatch</span> (<span class="id">Vint</span> (<span class="id">Int.shr</span> <span class="id">i</span> <span class="id">n</span>)) (<span class="id">sgn</span> <span class="id">q</span> (<span class="id">p</span> - <span class="id">Int.unsigned</span> <span class="id">n</span>))).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">vmatch_sgn</span>'. <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="id">zify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> ! <span class="id">Int.bits_shr</span> <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">transitivity</span> (<span class="id">Int.testbit</span> <span class="id">i</span> (<span class="id">Int.zwordsize</span> - 1)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zlt</span> (<span class="id">m</span> + <span class="id">Int.unsigned</span> <span class="id">n</span>) <span class="id">Int.zwordsize</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H0</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zlt</span> (<span class="id">Int.zwordsize</span> - 1 + <span class="id">Int.unsigned</span> <span class="id">n</span>) <span class="id">Int.zwordsize</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H0</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">v</span>; <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">and</span> (<span class="id">v</span> <span class="id">w</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">v</span>, <span class="id">w</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">i1</span>, <span class="id">I</span> <span class="id">i2</span> =&gt; <span class="id">I</span> (<span class="id">Int.and</span> <span class="id">i1</span> <span class="id">i2</span>)<br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">i</span>, <span class="id">Uns</span> <span class="id">p</span> <span class="id">n</span> | <span class="id">Uns</span> <span class="id">p</span> <span class="id">n</span>, <span class="id">I</span> <span class="id">i</span> =&gt; <span class="id">uns</span> <span class="id">p</span> (<span class="id">Z.min</span> <span class="id">n</span> (<span class="id">usize</span> <span class="id">i</span>))<br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">i</span>, <span class="id">x</span> | <span class="id">x</span>, <span class="id">I</span> <span class="id">i</span> =&gt; <span class="id">uns</span> (<span class="id">provenance</span> <span class="id">x</span>) (<span class="id">usize</span> <span class="id">i</span>)<br/>
&nbsp;&nbsp;| <span class="id">Uns</span> <span class="id">p1</span> <span class="id">n1</span>, <span class="id">Uns</span> <span class="id">p2</span> <span class="id">n2</span> =&gt; <span class="id">uns</span> (<span class="id">plub</span> <span class="id">p1</span> <span class="id">p2</span>) (<span class="id">Z.min</span> <span class="id">n1</span> <span class="id">n2</span>)<br/>
&nbsp;&nbsp;| <span class="id">Uns</span> <span class="id">p</span> <span class="id">n</span>, <span class="id">_</span> =&gt; <span class="id">uns</span> (<span class="id">plub</span> <span class="id">p</span> (<span class="id">provenance</span> <span class="id">w</span>)) <span class="id">n</span><br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">Uns</span> <span class="id">p</span> <span class="id">n</span> =&gt; <span class="id">uns</span> (<span class="id">plub</span> (<span class="id">provenance</span> <span class="id">v</span>) <span class="id">p</span>) <span class="id">n</span><br/>
&nbsp;&nbsp;| <span class="id">Sgn</span> <span class="id">p1</span> <span class="id">n1</span>, <span class="id">Sgn</span> <span class="id">p2</span> <span class="id">n2</span> =&gt; <span class="id">sgn</span> (<span class="id">plub</span> <span class="id">p1</span> <span class="id">p2</span>) (<span class="id">Z.max</span> <span class="id">n1</span> <span class="id">n2</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">ntop2</span> <span class="id">v</span> <span class="id">w</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">and_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">w</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.and</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">and</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2843')">Proof.</div>
<div class="proofscript" id="proof2843">
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">UNS_l</span>: <span class="kwd">forall</span> <span class="id">i</span> <span class="id">j</span> <span class="id">n</span>, <span class="id">is_uns</span> <span class="id">n</span> <span class="id">i</span> -&gt; <span class="id">is_uns</span> <span class="id">n</span> (<span class="id">Int.and</span> <span class="id">i</span> <span class="id">j</span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">Int.bits_and</span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">rewrite</span> (<span class="id">H</span> <span class="id">m</span>) <span class="tactic">by</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">andb_false_l</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">UNS_r</span>: <span class="kwd">forall</span> <span class="id">i</span> <span class="id">j</span> <span class="id">n</span>, <span class="id">is_uns</span> <span class="id">n</span> <span class="id">i</span> -&gt; <span class="id">is_uns</span> <span class="id">n</span> (<span class="id">Int.and</span> <span class="id">j</span> <span class="id">i</span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">Int.and_commut</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">UNS</span>: <span class="kwd">forall</span> <span class="id">i</span> <span class="id">j</span> <span class="id">n</span> <span class="id">m</span>, <span class="id">is_uns</span> <span class="id">n</span> <span class="id">i</span> -&gt; <span class="id">is_uns</span> <span class="id">m</span> <span class="id">j</span> -&gt; <span class="id">is_uns</span> (<span class="id">Z.min</span> <span class="id">n</span> <span class="id">m</span>) (<span class="id">Int.and</span> <span class="id">i</span> <span class="id">j</span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">Z.min_case</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">SGN</span>: <span class="kwd">forall</span> <span class="id">i</span> <span class="id">j</span> <span class="id">n</span> <span class="id">m</span>, <span class="id">is_sgn</span> <span class="id">n</span> <span class="id">i</span> -&gt; <span class="id">is_sgn</span> <span class="id">m</span> <span class="id">j</span> -&gt; <span class="id">is_sgn</span> (<span class="id">Z.max</span> <span class="id">n</span> <span class="id">m</span>) (<span class="id">Int.and</span> <span class="id">i</span> <span class="id">j</span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> ! <span class="id">Int.bits_and</span> <span class="tactic">by</span> <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span> <span class="tactic">by</span> <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>. <span class="tactic">rewrite</span> <span class="id">H0</span> <span class="tactic">by</span> <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">and</span>, <span class="id">Val.and</span>; <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">va</span>; <span class="id">inv</span> <span class="id">H0</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">or</span> (<span class="id">v</span> <span class="id">w</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">v</span>, <span class="id">w</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">i1</span>, <span class="id">I</span> <span class="id">i2</span> =&gt; <span class="id">I</span> (<span class="id">Int.or</span> <span class="id">i1</span> <span class="id">i2</span>)<br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">i</span>, <span class="id">Uns</span> <span class="id">p</span> <span class="id">n</span> | <span class="id">Uns</span> <span class="id">p</span> <span class="id">n</span>, <span class="id">I</span> <span class="id">i</span> =&gt; <span class="id">uns</span> <span class="id">p</span> (<span class="id">Z.max</span> <span class="id">n</span> (<span class="id">usize</span> <span class="id">i</span>))<br/>
&nbsp;&nbsp;| <span class="id">Uns</span> <span class="id">p1</span> <span class="id">n1</span>, <span class="id">Uns</span> <span class="id">p2</span> <span class="id">n2</span> =&gt; <span class="id">uns</span> (<span class="id">plub</span> <span class="id">p1</span> <span class="id">p2</span>) (<span class="id">Z.max</span> <span class="id">n1</span> <span class="id">n2</span>)<br/>
&nbsp;&nbsp;| <span class="id">Sgn</span> <span class="id">p1</span> <span class="id">n1</span>, <span class="id">Sgn</span> <span class="id">p2</span> <span class="id">n2</span> =&gt; <span class="id">sgn</span> (<span class="id">plub</span> <span class="id">p1</span> <span class="id">p2</span>) (<span class="id">Z.max</span> <span class="id">n1</span> <span class="id">n2</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">ntop2</span> <span class="id">v</span> <span class="id">w</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">or_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">w</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.or</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">or</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2844')">Proof.</div>
<div class="proofscript" id="proof2844">
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">UNS</span>: <span class="kwd">forall</span> <span class="id">i</span> <span class="id">j</span> <span class="id">n</span> <span class="id">m</span>, <span class="id">is_uns</span> <span class="id">n</span> <span class="id">i</span> -&gt; <span class="id">is_uns</span> <span class="id">m</span> <span class="id">j</span> -&gt; <span class="id">is_uns</span> (<span class="id">Z.max</span> <span class="id">n</span> <span class="id">m</span>) (<span class="id">Int.or</span> <span class="id">i</span> <span class="id">j</span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">Int.bits_or</span> <span class="tactic">by</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span> <span class="tactic">by</span> <span class="id">xomega</span>. <span class="tactic">rewrite</span> <span class="id">H0</span> <span class="tactic">by</span> <span class="id">xomega</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">SGN</span>: <span class="kwd">forall</span> <span class="id">i</span> <span class="id">j</span> <span class="id">n</span> <span class="id">m</span>, <span class="id">is_sgn</span> <span class="id">n</span> <span class="id">i</span> -&gt; <span class="id">is_sgn</span> <span class="id">m</span> <span class="id">j</span> -&gt; <span class="id">is_sgn</span> (<span class="id">Z.max</span> <span class="id">n</span> <span class="id">m</span>) (<span class="id">Int.or</span> <span class="id">i</span> <span class="id">j</span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> ! <span class="id">Int.bits_or</span> <span class="tactic">by</span> <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span> <span class="tactic">by</span> <span class="id">xomega</span>. <span class="tactic">rewrite</span> <span class="id">H0</span> <span class="tactic">by</span> <span class="id">xomega</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">or</span>, <span class="id">Val.or</span>; <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">va</span>; <span class="id">inv</span> <span class="id">H0</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">xor</span> (<span class="id">v</span> <span class="id">w</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">v</span>, <span class="id">w</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">i1</span>, <span class="id">I</span> <span class="id">i2</span> =&gt; <span class="id">I</span> (<span class="id">Int.xor</span> <span class="id">i1</span> <span class="id">i2</span>)<br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">i</span>, <span class="id">Uns</span> <span class="id">p</span> <span class="id">n</span> | <span class="id">Uns</span> <span class="id">p</span> <span class="id">n</span>, <span class="id">I</span> <span class="id">i</span> =&gt; <span class="id">uns</span> <span class="id">p</span> (<span class="id">Z.max</span> <span class="id">n</span> (<span class="id">usize</span> <span class="id">i</span>))<br/>
&nbsp;&nbsp;| <span class="id">Uns</span> <span class="id">p1</span> <span class="id">n1</span>, <span class="id">Uns</span> <span class="id">p2</span> <span class="id">n2</span> =&gt; <span class="id">uns</span> (<span class="id">plub</span> <span class="id">p1</span> <span class="id">p2</span>) (<span class="id">Z.max</span> <span class="id">n1</span> <span class="id">n2</span>)<br/>
&nbsp;&nbsp;| <span class="id">Sgn</span> <span class="id">p1</span> <span class="id">n1</span>, <span class="id">Sgn</span> <span class="id">p2</span> <span class="id">n2</span> =&gt; <span class="id">sgn</span> (<span class="id">plub</span> <span class="id">p1</span> <span class="id">p2</span>) (<span class="id">Z.max</span> <span class="id">n1</span> <span class="id">n2</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">ntop2</span> <span class="id">v</span> <span class="id">w</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">xor_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">w</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.xor</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">xor</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2845')">Proof.</div>
<div class="proofscript" id="proof2845">
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">UNS</span>: <span class="kwd">forall</span> <span class="id">i</span> <span class="id">j</span> <span class="id">n</span> <span class="id">m</span>, <span class="id">is_uns</span> <span class="id">n</span> <span class="id">i</span> -&gt; <span class="id">is_uns</span> <span class="id">m</span> <span class="id">j</span> -&gt; <span class="id">is_uns</span> (<span class="id">Z.max</span> <span class="id">n</span> <span class="id">m</span>) (<span class="id">Int.xor</span> <span class="id">i</span> <span class="id">j</span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">Int.bits_xor</span> <span class="tactic">by</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span> <span class="tactic">by</span> <span class="id">xomega</span>. <span class="tactic">rewrite</span> <span class="id">H0</span> <span class="tactic">by</span> <span class="id">xomega</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">SGN</span>: <span class="kwd">forall</span> <span class="id">i</span> <span class="id">j</span> <span class="id">n</span> <span class="id">m</span>, <span class="id">is_sgn</span> <span class="id">n</span> <span class="id">i</span> -&gt; <span class="id">is_sgn</span> <span class="id">m</span> <span class="id">j</span> -&gt; <span class="id">is_sgn</span> (<span class="id">Z.max</span> <span class="id">n</span> <span class="id">m</span>) (<span class="id">Int.xor</span> <span class="id">i</span> <span class="id">j</span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> ! <span class="id">Int.bits_xor</span> <span class="tactic">by</span> <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span> <span class="tactic">by</span> <span class="id">xomega</span>. <span class="tactic">rewrite</span> <span class="id">H0</span> <span class="tactic">by</span> <span class="id">xomega</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">xor</span>, <span class="id">Val.xor</span>; <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">va</span>; <span class="id">inv</span> <span class="id">H0</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">notint</span> (<span class="id">v</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">v</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">i</span> =&gt; <span class="id">I</span> (<span class="id">Int.not</span> <span class="id">i</span>)<br/>
&nbsp;&nbsp;| <span class="id">Uns</span> <span class="id">p</span> <span class="id">n</span> =&gt; <span class="id">sgn</span> <span class="id">p</span> (<span class="id">n</span> + 1)<br/>
&nbsp;&nbsp;| <span class="id">Sgn</span> <span class="id">p</span> <span class="id">n</span> =&gt; <span class="id">Sgn</span> <span class="id">p</span> <span class="id">n</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">ntop1</span> <span class="id">v</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">notint_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.notint</span> <span class="id">v</span>) (<span class="id">notint</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2846')">Proof.</div>
<div class="proofscript" id="proof2846">
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">SGN</span>: <span class="kwd">forall</span> <span class="id">n</span> <span class="id">i</span>, <span class="id">is_sgn</span> <span class="id">n</span> <span class="id">i</span> -&gt; <span class="id">is_sgn</span> <span class="id">n</span> (<span class="id">Int.not</span> <span class="id">i</span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> ! <span class="id">Int.bits_not</span> <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">f_equal</span>. <span class="tactic">apply</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">Val.notint</span>, <span class="id">notint</span>; <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">rol</span> (<span class="id">x</span> <span class="id">y</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">y</span>, <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">j</span>, <span class="id">I</span> <span class="id">i</span> =&gt; <span class="id">I</span>(<span class="id">Int.rol</span> <span class="id">i</span> <span class="id">j</span>)<br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">j</span>, <span class="id">Uns</span> <span class="id">p</span> <span class="id">n</span> =&gt; <span class="id">uns</span> <span class="id">p</span> (<span class="id">n</span> + <span class="id">Int.unsigned</span> <span class="id">j</span>)<br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">j</span>, <span class="id">Sgn</span> <span class="id">p</span> <span class="id">n</span> =&gt; <span class="kwd">if</span> <span class="id">zlt</span> <span class="id">n</span> <span class="id">Int.zwordsize</span> <span class="kwd">then</span> <span class="id">sgn</span> <span class="id">p</span> (<span class="id">n</span> + <span class="id">Int.unsigned</span> <span class="id">j</span>) <span class="kwd">else</span> <span class="id">ntop1</span> <span class="id">x</span><br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">ntop1</span> <span class="id">x</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">rol_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">w</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.rol</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">rol</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2847')">Proof.</div>
<div class="proofscript" id="proof2847">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">DEFAULT</span>: <span class="kwd">forall</span> <span class="id">p</span>, <span class="id">vmatch</span> (<span class="id">Val.rol</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">Ifptr</span> <span class="id">p</span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">destruct</span> <span class="id">w</span>; <span class="tactic">simpl</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rol</span>; <span class="tactic">destruct</span> <span class="id">y</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">DEFAULT</span>; <span class="tactic">auto</span>. <span class="id">inv</span> <span class="id">H0</span>. <span class="tactic">unfold</span> <span class="id">Val.rol</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="tactic">apply</span> <span class="id">vmatch_uns</span>. <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">Int.bits_rol</span> <span class="tactic">by</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Int.unsigned_range</span> <span class="id">n</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Zmod_small</span> <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H1</span>. <span class="tactic">omega</span>. <span class="tactic">omega</span>. <br/>
- <span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">n0</span> <span class="id">Int.zwordsize</span>); <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">vmatch_sgn</span>. <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> ! <span class="id">Int.bits_rol</span> <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Int.unsigned_range</span> <span class="id">n</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> ! <span class="id">Zmod_small</span> <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="tactic">by</span> <span class="tactic">omega</span>. <span class="tactic">symmetry</span>. <span class="tactic">rewrite</span> <span class="id">H1</span> <span class="tactic">by</span> <span class="tactic">omega</span>. <span class="tactic">auto</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">n0</span> <span class="id">Int.zwordsize</span>); <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">ror</span> (<span class="id">x</span> <span class="id">y</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">y</span>, <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">j</span>, <span class="id">I</span> <span class="id">i</span> =&gt; <span class="id">I</span>(<span class="id">Int.ror</span> <span class="id">i</span> <span class="id">j</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">ntop1</span> <span class="id">x</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">ror_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">w</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.ror</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">ror</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2848')">Proof.</div>
<div class="proofscript" id="proof2848">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">DEFAULT</span>: <span class="kwd">forall</span> <span class="id">p</span>, <span class="id">vmatch</span> (<span class="id">Val.ror</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">Ifptr</span> <span class="id">p</span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">destruct</span> <span class="id">w</span>; <span class="tactic">simpl</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">ror</span>; <span class="tactic">destruct</span> <span class="id">y</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">DEFAULT</span>; <span class="tactic">auto</span>. <span class="id">inv</span> <span class="id">H0</span>. <span class="tactic">unfold</span> <span class="id">Val.ror</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">rolm</span> (<span class="id">x</span>: <span class="id">aval</span>) (<span class="id">amount</span> <span class="id">mask</span>: <span class="id">int</span>) :=<br/>
&nbsp;&nbsp;<span class="id">and</span> (<span class="id">rol</span> <span class="id">x</span> (<span class="id">I</span> <span class="id">amount</span>)) (<span class="id">I</span> <span class="id">mask</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">rolm_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span> <span class="id">amount</span> <span class="id">mask</span>,<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.rolm</span> <span class="id">v</span> <span class="id">amount</span> <span class="id">mask</span>) (<span class="id">rolm</span> <span class="id">x</span> <span class="id">amount</span> <span class="id">mask</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2849')">Proof.</div>
<div class="proofscript" id="proof2849">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">Val.rolm</span> <span class="id">v</span> <span class="id">amount</span> <span class="id">mask</span>) <span class="kwd">with</span> (<span class="id">Val.and</span> (<span class="id">Val.rol</span> <span class="id">v</span> (<span class="id">Vint</span> <span class="id">amount</span>)) (<span class="id">Vint</span> <span class="id">mask</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">and_sound</span>. <span class="tactic">apply</span> <span class="id">rol_sound</span>. <span class="tactic">auto</span>. <span class="id">constructor</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Integer arithmetic operations </div>
<br/>
<span class="kwd">Definition</span> <span class="id">neg</span> := <span class="id">unop_int</span> <span class="id">Int.neg</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">neg_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.neg</span> <span class="id">v</span>) (<span class="id">neg</span> <span class="id">x</span>).<br/>
<span class="kwd">Proof</span> (<span class="id">unop_int_sound</span> <span class="id">Int.neg</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">add</span> (<span class="id">x</span> <span class="id">y</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span>, <span class="id">y</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">i</span>, <span class="id">I</span> <span class="id">j</span> =&gt; <span class="id">I</span> (<span class="id">Int.add</span> <span class="id">i</span> <span class="id">j</span>)<br/>
&nbsp;&nbsp;| <span class="id">Ptr</span> <span class="id">p</span>, <span class="id">I</span> <span class="id">i</span> | <span class="id">I</span> <span class="id">i</span>, <span class="id">Ptr</span> <span class="id">p</span> =&gt; <span class="id">Ptr</span> (<span class="kwd">if</span> <span class="id">Archi.ptr64</span> <span class="kwd">then</span> <span class="id">poffset</span> <span class="id">p</span> <span class="kwd">else</span> <span class="id">padd</span> <span class="id">p</span> (<span class="id">Ptrofs.of_int</span> <span class="id">i</span>))<br/>
&nbsp;&nbsp;| <span class="id">Ptr</span> <span class="id">p</span>, <span class="id">_</span>   | <span class="id">_</span>, <span class="id">Ptr</span> <span class="id">p</span>   =&gt; <span class="id">Ptr</span> (<span class="id">poffset</span> <span class="id">p</span>)<br/>
&nbsp;&nbsp;| <span class="id">Ifptr</span> <span class="id">p</span>, <span class="id">I</span> <span class="id">i</span> | <span class="id">I</span> <span class="id">i</span>, <span class="id">Ifptr</span> <span class="id">p</span> =&gt; <span class="id">Ifptr</span> (<span class="kwd">if</span> <span class="id">Archi.ptr64</span> <span class="kwd">then</span> <span class="id">poffset</span> <span class="id">p</span> <span class="kwd">else</span> <span class="id">padd</span> <span class="id">p</span> (<span class="id">Ptrofs.of_int</span> <span class="id">i</span>))<br/>
&nbsp;&nbsp;| <span class="id">Ifptr</span> <span class="id">p</span>, <span class="id">Ifptr</span> <span class="id">q</span> =&gt; <span class="id">Ifptr</span> (<span class="id">plub</span> (<span class="id">poffset</span> <span class="id">p</span>) (<span class="id">poffset</span> <span class="id">q</span>))<br/>
&nbsp;&nbsp;| <span class="id">Ifptr</span> <span class="id">p</span>, <span class="id">_</span> | <span class="id">_</span>, <span class="id">Ifptr</span> <span class="id">p</span> =&gt; <span class="id">Ifptr</span> (<span class="id">poffset</span> <span class="id">p</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">ntop2</span> <span class="id">x</span> <span class="id">y</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">add_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">w</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.add</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">add</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2850')">Proof.</div>
<div class="proofscript" id="proof2850">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">Val.add</span>, <span class="id">add</span>. <span class="tactic">destruct</span> <span class="id">Archi.ptr64</span>.<br/>
- <span class="id">inv</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H0</span>; <span class="id">constructor</span>.<br/>
- <span class="id">inv</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H0</span>; <span class="id">constructor</span>;<br/>
&nbsp;&nbsp;((<span class="tactic">apply</span> <span class="id">padd_sound</span>; <span class="tactic">assumption</span>) || (<span class="tactic">eapply</span> <span class="id">poffset_sound</span>; <span class="id">eassumption</span>) || <span class="id">idtac</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">pmatch_lub_r</span>. <span class="tactic">eapply</span> <span class="id">poffset_sound</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">pmatch_lub_l</span>. <span class="tactic">eapply</span> <span class="id">poffset_sound</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">sub</span> (<span class="id">v</span> <span class="id">w</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">v</span>, <span class="id">w</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">i1</span>, <span class="id">I</span> <span class="id">i2</span> =&gt; <span class="id">I</span> (<span class="id">Int.sub</span> <span class="id">i1</span> <span class="id">i2</span>)<br/>
&nbsp;&nbsp;| <span class="id">Ptr</span> <span class="id">p</span>, <span class="id">I</span> <span class="id">i</span> =&gt; <span class="kwd">if</span> <span class="id">Archi.ptr64</span> <span class="kwd">then</span> <span class="id">Ifptr</span> (<span class="id">poffset</span> <span class="id">p</span>) <span class="kwd">else</span> <span class="id">Ptr</span> (<span class="id">psub</span> <span class="id">p</span> (<span class="id">Ptrofs.of_int</span> <span class="id">i</span>))<br/>
&nbsp;&nbsp;| <span class="id">Ptr</span> <span class="id">p</span>, <span class="id">_</span>   =&gt; <span class="id">Ifptr</span> (<span class="id">poffset</span> <span class="id">p</span>)<br/>
&nbsp;&nbsp;| <span class="id">Ifptr</span> <span class="id">p</span>, <span class="id">I</span> <span class="id">i</span> =&gt; <span class="kwd">if</span> <span class="id">Archi.ptr64</span> <span class="kwd">then</span> <span class="id">Ifptr</span> (<span class="id">plub</span> (<span class="id">poffset</span> <span class="id">p</span>) (<span class="id">provenance</span> <span class="id">w</span>)) <span class="kwd">else</span> <span class="id">Ifptr</span> (<span class="id">psub</span> <span class="id">p</span> (<span class="id">Ptrofs.of_int</span> <span class="id">i</span>))<br/>
&nbsp;&nbsp;| <span class="id">Ifptr</span> <span class="id">p</span>, <span class="id">_</span> =&gt; <span class="id">Ifptr</span> (<span class="id">plub</span> (<span class="id">poffset</span> <span class="id">p</span>) (<span class="id">provenance</span> <span class="id">w</span>))<br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">ntop2</span> <span class="id">v</span> <span class="id">w</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">sub_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">w</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.sub</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">sub</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2851')">Proof.</div>
<div class="proofscript" id="proof2851">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">Val.sub</span>, <span class="id">sub</span>. <span class="tactic">destruct</span> <span class="id">Archi.ptr64</span>.<br/>
- <span class="id">inv</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H0</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="id">inv</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H0</span>; <span class="tactic">try</span> (<span class="tactic">destruct</span> (<span class="id">eq_block</span> <span class="id">b</span> <span class="id">b0</span>)); <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id">psub_sound</span>, <span class="id">poffset_sound</span>, <span class="id">pmatch_lub_l</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">mul</span> := <span class="id">binop_int</span> <span class="id">Int.mul</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">mul_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span> <span class="id">w</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.mul</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">mul</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<span class="kwd">Proof</span> (<span class="id">binop_int_sound</span> <span class="id">Int.mul</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">mulhs</span> := <span class="id">binop_int</span> <span class="id">Int.mulhs</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">mulhs_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span> <span class="id">w</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.mulhs</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">mulhs</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<span class="kwd">Proof</span> (<span class="id">binop_int_sound</span> <span class="id">Int.mulhs</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">mulhu</span> := <span class="id">binop_int</span> <span class="id">Int.mulhu</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">mulhu_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span> <span class="id">w</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.mulhu</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">mulhu</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<span class="kwd">Proof</span> (<span class="id">binop_int_sound</span> <span class="id">Int.mulhu</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">divs</span> (<span class="id">v</span> <span class="id">w</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">w</span>, <span class="id">v</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">i2</span>, <span class="id">I</span> <span class="id">i1</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">Int.eq</span> <span class="id">i2</span> <span class="id">Int.zero</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|| <span class="id">Int.eq</span> <span class="id">i1</span> (<span class="id">Int.repr</span> <span class="id">Int.min_signed</span>) &amp;&amp; <span class="id">Int.eq</span> <span class="id">i2</span> <span class="id">Int.mone</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="kwd">if</span> <span class="id">va_strict</span> <span class="id">tt</span> <span class="kwd">then</span> <span class="id">Vbot</span> <span class="kwd">else</span> <span class="id">ntop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">I</span> (<span class="id">Int.divs</span> <span class="id">i1</span> <span class="id">i2</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">ntop2</span> <span class="id">v</span> <span class="id">w</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">divs_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">w</span> <span class="id">u</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">Val.divs</span> <span class="id">v</span> <span class="id">w</span> = <span class="id">Some</span> <span class="id">u</span> -&gt; <span class="id">vmatch</span> <span class="id">u</span> (<span class="id">divs</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2852')">Proof.</div>
<div class="proofscript" id="proof2852">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">destruct</span> <span class="id">w</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Int.eq</span> <span class="id">i0</span> <span class="id">Int.zero</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|| <span class="id">Int.eq</span> <span class="id">i</span> (<span class="id">Int.repr</span> <span class="id">Int.min_signed</span>) &amp;&amp; <span class="id">Int.eq</span> <span class="id">i0</span> <span class="id">Int.mone</span>) <span class="id">eqn</span>:<span class="id">E</span>; <span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H0</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">E</span>. <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">divu</span> (<span class="id">v</span> <span class="id">w</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">w</span>, <span class="id">v</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">i2</span>, <span class="id">I</span> <span class="id">i1</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">Int.eq</span> <span class="id">i2</span> <span class="id">Int.zero</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="kwd">if</span> <span class="id">va_strict</span> <span class="id">tt</span> <span class="kwd">then</span> <span class="id">Vbot</span> <span class="kwd">else</span> <span class="id">ntop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">I</span> (<span class="id">Int.divu</span> <span class="id">i1</span> <span class="id">i2</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">ntop2</span> <span class="id">v</span> <span class="id">w</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">divu_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">w</span> <span class="id">u</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">Val.divu</span> <span class="id">v</span> <span class="id">w</span> = <span class="id">Some</span> <span class="id">u</span> -&gt; <span class="id">vmatch</span> <span class="id">u</span> (<span class="id">divu</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2853')">Proof.</div>
<div class="proofscript" id="proof2853">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">destruct</span> <span class="id">w</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Int.eq</span> <span class="id">i0</span> <span class="id">Int.zero</span>) <span class="id">eqn</span>:<span class="id">E</span>; <span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H0</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">E</span>. <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">mods</span> (<span class="id">v</span> <span class="id">w</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">w</span>, <span class="id">v</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">i2</span>, <span class="id">I</span> <span class="id">i1</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">Int.eq</span> <span class="id">i2</span> <span class="id">Int.zero</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|| <span class="id">Int.eq</span> <span class="id">i1</span> (<span class="id">Int.repr</span> <span class="id">Int.min_signed</span>) &amp;&amp; <span class="id">Int.eq</span> <span class="id">i2</span> <span class="id">Int.mone</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="kwd">if</span> <span class="id">va_strict</span> <span class="id">tt</span> <span class="kwd">then</span> <span class="id">Vbot</span> <span class="kwd">else</span> <span class="id">ntop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">I</span> (<span class="id">Int.mods</span> <span class="id">i1</span> <span class="id">i2</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">ntop2</span> <span class="id">v</span> <span class="id">w</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">mods_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">w</span> <span class="id">u</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">Val.mods</span> <span class="id">v</span> <span class="id">w</span> = <span class="id">Some</span> <span class="id">u</span> -&gt; <span class="id">vmatch</span> <span class="id">u</span> (<span class="id">mods</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2854')">Proof.</div>
<div class="proofscript" id="proof2854">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">destruct</span> <span class="id">w</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Int.eq</span> <span class="id">i0</span> <span class="id">Int.zero</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|| <span class="id">Int.eq</span> <span class="id">i</span> (<span class="id">Int.repr</span> <span class="id">Int.min_signed</span>) &amp;&amp; <span class="id">Int.eq</span> <span class="id">i0</span> <span class="id">Int.mone</span>) <span class="id">eqn</span>:<span class="id">E</span>; <span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H0</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">E</span>. <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">modu</span> (<span class="id">v</span> <span class="id">w</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">w</span>, <span class="id">v</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">i2</span>, <span class="id">I</span> <span class="id">i1</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">Int.eq</span> <span class="id">i2</span> <span class="id">Int.zero</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="kwd">if</span> <span class="id">va_strict</span> <span class="id">tt</span> <span class="kwd">then</span> <span class="id">Vbot</span> <span class="kwd">else</span> <span class="id">ntop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">I</span> (<span class="id">Int.modu</span> <span class="id">i1</span> <span class="id">i2</span>)<br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">i2</span>, <span class="id">_</span> =&gt; <span class="id">uns</span> (<span class="id">provenance</span> <span class="id">v</span>) (<span class="id">usize</span> <span class="id">i2</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">ntop2</span> <span class="id">v</span> <span class="id">w</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">modu_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">w</span> <span class="id">u</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">Val.modu</span> <span class="id">v</span> <span class="id">w</span> = <span class="id">Some</span> <span class="id">u</span> -&gt; <span class="id">vmatch</span> <span class="id">u</span> (<span class="id">modu</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2855')">Proof.</div>
<div class="proofscript" id="proof2855">
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">UNS</span>: <span class="kwd">forall</span> <span class="id">i</span> <span class="id">j</span>, <span class="id">j</span> &lt;&gt; <span class="id">Int.zero</span> -&gt; <span class="id">is_uns</span> (<span class="id">usize</span> <span class="id">j</span>) (<span class="id">Int.modu</span> <span class="id">i</span> <span class="id">j</span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">is_uns_mon</span> <span class="kwd">with</span> (<span class="id">usize</span> (<span class="id">Int.modu</span> <span class="id">i</span> <span class="id">j</span>)); <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">usize</span>, <span class="id">Int.size</span>. <span class="tactic">apply</span> <span class="id">Int.Zsize_monotone</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Int.unsigned_range_2</span> <span class="id">j</span>); <span class="tactic">intros</span> <span class="id">RANGE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Int.unsigned</span> <span class="id">j</span> &lt;&gt; 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">red</span>; <span class="tactic">intros</span>; <span class="tactic">elim</span> <span class="id">H</span>. <span class="tactic">rewrite</span> &lt;- (<span class="id">Int.repr_unsigned</span> <span class="id">j</span>). <span class="tactic">rewrite</span> <span class="id">H0</span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">Z_mod_lt</span> (<span class="id">Int.unsigned</span> <span class="id">i</span>) (<span class="id">Int.unsigned</span> <span class="id">j</span>)). <span class="tactic">omega</span>. <span class="tactic">intros</span> <span class="id">MOD</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Int.modu</span>. <span class="tactic">rewrite</span> <span class="id">Int.unsigned_repr</span>. <span class="tactic">omega</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">destruct</span> <span class="id">w</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Int.eq</span> <span class="id">i0</span> <span class="id">Int.zero</span>) <span class="id">eqn</span>:<span class="id">Z</span>; <span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">i0</span> &lt;&gt; <span class="id">Int.zero</span>) <span class="tactic">by</span> (<span class="tactic">generalize</span> (<span class="id">Int.eq_spec</span> <span class="id">i0</span> <span class="id">Int.zero</span>); <span class="tactic">rewrite</span> <span class="id">Z</span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">modu</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H0</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>. <span class="tactic">rewrite</span> <span class="id">Z</span>. <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">shrx</span> (<span class="id">v</span> <span class="id">w</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">v</span>, <span class="id">w</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">i</span>, <span class="id">I</span> <span class="id">j</span> =&gt; <span class="kwd">if</span> <span class="id">Int.ltu</span> <span class="id">j</span> (<span class="id">Int.repr</span> 31) <span class="kwd">then</span> <span class="id">I</span>(<span class="id">Int.shrx</span> <span class="id">i</span> <span class="id">j</span>) <span class="kwd">else</span> <span class="id">ntop</span><br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">ntop1</span> <span class="id">v</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">shrx_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">w</span> <span class="id">u</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">Val.shrx</span> <span class="id">v</span> <span class="id">w</span> = <span class="id">Some</span> <span class="id">u</span> -&gt; <span class="id">vmatch</span> <span class="id">u</span> (<span class="id">shrx</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2856')">Proof.</div>
<div class="proofscript" id="proof2856">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">destruct</span> <span class="id">w</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Int.ltu</span> <span class="id">i0</span> (<span class="id">Int.repr</span> 31)) <span class="id">eqn</span>:<span class="id">LTU</span>; <span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">shrx</span>; <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>; <span class="id">inv</span> <span class="id">H0</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">LTU</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<div class="doc">64-bit integer operations </div>
<br/>
<span class="kwd">Definition</span> <span class="id">shift_long</span> (<span class="id">sem</span>: <span class="id">int64</span> -&gt; <span class="id">int</span> -&gt; <span class="id">int64</span>) (<span class="id">v</span> <span class="id">w</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">w</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">amount</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">Int.ltu</span> <span class="id">amount</span> <span class="id">Int64.iwordsize</span>' <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">v</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">L</span> <span class="id">i</span> =&gt; <span class="id">L</span> (<span class="id">sem</span> <span class="id">i</span> <span class="id">amount</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">ntop1</span> <span class="id">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">ntop1</span> <span class="id">v</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">ntop1</span> <span class="id">v</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">shift_long_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sem</span> <span class="id">v</span> <span class="id">w</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> (<span class="kwd">match</span> <span class="id">v</span>, <span class="id">w</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Vlong</span> <span class="id">i</span>, <span class="id">Vint</span> <span class="id">j</span> =&gt; <span class="kwd">if</span> <span class="id">Int.ltu</span> <span class="id">j</span> <span class="id">Int64.iwordsize</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id">Vlong</span> (<span class="id">sem</span> <span class="id">i</span> <span class="id">j</span>) <span class="kwd">else</span> <span class="id">Vundef</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">Vundef</span> <span class="kwd">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">shift_long</span> <span class="id">sem</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2857')">Proof.</div>
<div class="proofscript" id="proof2857">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">DEFAULT</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">vmatch</span> (<span class="kwd">match</span> <span class="id">v</span>, <span class="id">w</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Vlong</span> <span class="id">i</span>, <span class="id">Vint</span> <span class="id">j</span> =&gt; <span class="kwd">if</span> <span class="id">Int.ltu</span> <span class="id">j</span> <span class="id">Int64.iwordsize</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id">Vlong</span> (<span class="id">sem</span> <span class="id">i</span> <span class="id">j</span>) <span class="kwd">else</span> <span class="id">Vundef</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">Vundef</span> <span class="kwd">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ntop1</span> <span class="id">x</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">try</span> <span class="id">constructor</span>; <span class="tactic">destruct</span> <span class="id">w</span>; <span class="tactic">try</span> <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Int.ltu</span> <span class="id">i0</span> <span class="id">Int64.iwordsize</span>'); <span class="id">constructor</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">shift_long</span>. <span class="tactic">destruct</span> <span class="id">y</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Int.ltu</span> <span class="id">n</span> <span class="id">Int64.iwordsize</span>') <span class="id">eqn</span>:<span class="id">LT</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">auto</span>. <br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H0</span>. <span class="tactic">rewrite</span> <span class="id">LT</span>. <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">shll</span> := <span class="id">shift_long</span> <span class="id">Int64.shl</span>'.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">shll_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">w</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.shll</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">shll</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<span class="kwd">Proof</span> (<span class="id">shift_long_sound</span> <span class="id">Int64.shl</span>').<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">shrl</span> := <span class="id">shift_long</span> <span class="id">Int64.shr</span>'.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">shrl_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">w</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.shrl</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">shrl</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<span class="kwd">Proof</span> (<span class="id">shift_long_sound</span> <span class="id">Int64.shr</span>').<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">shrlu</span> := <span class="id">shift_long</span> <span class="id">Int64.shru</span>'.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">shrlu_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">w</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.shrlu</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">shrlu</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<span class="kwd">Proof</span> (<span class="id">shift_long_sound</span> <span class="id">Int64.shru</span>').<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">andl</span> := <span class="id">binop_long</span> <span class="id">Int64.and</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">andl_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span> <span class="id">w</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.andl</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">andl</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<span class="kwd">Proof</span> (<span class="id">binop_long_sound</span> <span class="id">Int64.and</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">orl</span> := <span class="id">binop_long</span> <span class="id">Int64.or</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">orl_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span> <span class="id">w</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.orl</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">orl</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<span class="kwd">Proof</span> (<span class="id">binop_long_sound</span> <span class="id">Int64.or</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">xorl</span> := <span class="id">binop_long</span> <span class="id">Int64.xor</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">xorl_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span> <span class="id">w</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.xorl</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">xorl</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<span class="kwd">Proof</span> (<span class="id">binop_long_sound</span> <span class="id">Int64.xor</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">notl</span> := <span class="id">unop_long</span> <span class="id">Int64.not</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">notl_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.notl</span> <span class="id">v</span>) (<span class="id">notl</span> <span class="id">x</span>).<br/>
<span class="kwd">Proof</span> (<span class="id">unop_long_sound</span> <span class="id">Int64.not</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">rotate_long</span> (<span class="id">sem</span>: <span class="id">int64</span> -&gt; <span class="id">int64</span> -&gt; <span class="id">int64</span>) (<span class="id">v</span> <span class="id">w</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">v</span>, <span class="id">w</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">L</span> <span class="id">i</span>, <span class="id">I</span> <span class="id">amount</span> =&gt; <span class="id">L</span> (<span class="id">sem</span> <span class="id">i</span> (<span class="id">Int64.repr</span> (<span class="id">Int.unsigned</span> <span class="id">amount</span>)))<br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">ntop1</span> <span class="id">v</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">rotate_long_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sem</span> <span class="id">v</span> <span class="id">w</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> (<span class="kwd">match</span> <span class="id">v</span>, <span class="id">w</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Vlong</span> <span class="id">i</span>, <span class="id">Vint</span> <span class="id">j</span> =&gt; <span class="id">Vlong</span> (<span class="id">sem</span> <span class="id">i</span> (<span class="id">Int64.repr</span> (<span class="id">Int.unsigned</span> <span class="id">j</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">Vundef</span> <span class="kwd">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">rotate_long</span> <span class="id">sem</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2858')">Proof.</div>
<div class="proofscript" id="proof2858">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">DEFAULT</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">vmatch</span> (<span class="kwd">match</span> <span class="id">v</span>, <span class="id">w</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Vlong</span> <span class="id">i</span>, <span class="id">Vint</span> <span class="id">j</span> =&gt; <span class="id">Vlong</span> (<span class="id">sem</span> <span class="id">i</span> (<span class="id">Int64.repr</span> (<span class="id">Int.unsigned</span> <span class="id">j</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">Vundef</span> <span class="kwd">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ntop1</span> <span class="id">x</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">try</span> <span class="id">constructor</span>. <span class="tactic">destruct</span> <span class="id">w</span>; <span class="id">constructor</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rotate_long</span>. <span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">auto</span>. <span class="tactic">destruct</span> <span class="id">y</span>; <span class="tactic">auto</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H0</span>. <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">roll</span> := <span class="id">rotate_long</span> <span class="id">Int64.rol</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">roll_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">w</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.roll</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">roll</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<span class="kwd">Proof</span> (<span class="id">rotate_long_sound</span> <span class="id">Int64.rol</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">rorl</span> := <span class="id">rotate_long</span> <span class="id">Int64.ror</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">rorl_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">w</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.rorl</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">rorl</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<span class="kwd">Proof</span> (<span class="id">rotate_long_sound</span> <span class="id">Int64.ror</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">negl</span> := <span class="id">unop_long</span> <span class="id">Int64.neg</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">negl_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.negl</span> <span class="id">v</span>) (<span class="id">negl</span> <span class="id">x</span>).<br/>
<span class="kwd">Proof</span> (<span class="id">unop_long_sound</span> <span class="id">Int64.neg</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">addl</span> (<span class="id">x</span> <span class="id">y</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span>, <span class="id">y</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">L</span> <span class="id">i</span>, <span class="id">L</span> <span class="id">j</span> =&gt; <span class="id">L</span> (<span class="id">Int64.add</span> <span class="id">i</span> <span class="id">j</span>)<br/>
&nbsp;&nbsp;| <span class="id">Ptr</span> <span class="id">p</span>, <span class="id">L</span> <span class="id">i</span> | <span class="id">L</span> <span class="id">i</span>, <span class="id">Ptr</span> <span class="id">p</span> =&gt; <span class="id">Ptr</span> (<span class="kwd">if</span> <span class="id">Archi.ptr64</span> <span class="kwd">then</span> <span class="id">padd</span> <span class="id">p</span> (<span class="id">Ptrofs.of_int64</span> <span class="id">i</span>) <span class="kwd">else</span> <span class="id">poffset</span> <span class="id">p</span>)<br/>
&nbsp;&nbsp;| <span class="id">Ptr</span> <span class="id">p</span>, <span class="id">_</span>   | <span class="id">_</span>, <span class="id">Ptr</span> <span class="id">p</span>   =&gt; <span class="id">Ptr</span> (<span class="id">poffset</span> <span class="id">p</span>)<br/>
&nbsp;&nbsp;| <span class="id">Ifptr</span> <span class="id">p</span>, <span class="id">L</span> <span class="id">i</span> | <span class="id">L</span> <span class="id">i</span>, <span class="id">Ifptr</span> <span class="id">p</span> =&gt; <span class="id">Ifptr</span> (<span class="kwd">if</span> <span class="id">Archi.ptr64</span> <span class="kwd">then</span> <span class="id">padd</span> <span class="id">p</span> (<span class="id">Ptrofs.of_int64</span> <span class="id">i</span>) <span class="kwd">else</span> <span class="id">poffset</span> <span class="id">p</span>)<br/>
&nbsp;&nbsp;| <span class="id">Ifptr</span> <span class="id">p</span>, <span class="id">Ifptr</span> <span class="id">q</span> =&gt; <span class="id">Ifptr</span> (<span class="id">plub</span> (<span class="id">poffset</span> <span class="id">p</span>) (<span class="id">poffset</span> <span class="id">q</span>))<br/>
&nbsp;&nbsp;| <span class="id">Ifptr</span> <span class="id">p</span>, <span class="id">_</span> | <span class="id">_</span>, <span class="id">Ifptr</span> <span class="id">p</span> =&gt; <span class="id">Ifptr</span> (<span class="id">poffset</span> <span class="id">p</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">ntop2</span> <span class="id">x</span> <span class="id">y</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">addl_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">w</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.addl</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">addl</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2859')">Proof.</div>
<div class="proofscript" id="proof2859">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">Val.addl</span>, <span class="id">addl</span>. <span class="tactic">destruct</span> <span class="id">Archi.ptr64</span>.<br/>
- <span class="id">inv</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H0</span>; <span class="id">constructor</span>;<br/>
&nbsp;&nbsp;((<span class="tactic">apply</span> <span class="id">padd_sound</span>; <span class="tactic">assumption</span>) || (<span class="tactic">eapply</span> <span class="id">poffset_sound</span>; <span class="id">eassumption</span>) || <span class="id">idtac</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">pmatch_lub_r</span>. <span class="tactic">eapply</span> <span class="id">poffset_sound</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">pmatch_lub_l</span>. <span class="tactic">eapply</span> <span class="id">poffset_sound</span>; <span class="tactic">eauto</span>.<br/>
- <span class="id">inv</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H0</span>; <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">subl</span> (<span class="id">v</span> <span class="id">w</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">v</span>, <span class="id">w</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">L</span> <span class="id">i1</span>, <span class="id">L</span> <span class="id">i2</span> =&gt; <span class="id">L</span> (<span class="id">Int64.sub</span> <span class="id">i1</span> <span class="id">i2</span>)<br/>
&nbsp;&nbsp;| <span class="id">Ptr</span> <span class="id">p</span>, <span class="id">L</span> <span class="id">i</span> =&gt; <span class="kwd">if</span> <span class="id">Archi.ptr64</span> <span class="kwd">then</span> <span class="id">Ptr</span> (<span class="id">psub</span> <span class="id">p</span> (<span class="id">Ptrofs.of_int64</span> <span class="id">i</span>)) <span class="kwd">else</span> <span class="id">Ifptr</span> (<span class="id">poffset</span> <span class="id">p</span>)<br/>
&nbsp;&nbsp;| <span class="id">Ptr</span> <span class="id">p</span>, <span class="id">_</span>   =&gt; <span class="id">Ifptr</span> (<span class="id">poffset</span> <span class="id">p</span>)<br/>
&nbsp;&nbsp;| <span class="id">Ifptr</span> <span class="id">p</span>, <span class="id">L</span> <span class="id">i</span> =&gt; <span class="kwd">if</span> <span class="id">Archi.ptr64</span> <span class="kwd">then</span> <span class="id">Ifptr</span> (<span class="id">psub</span> <span class="id">p</span> (<span class="id">Ptrofs.of_int64</span> <span class="id">i</span>)) <span class="kwd">else</span> <span class="id">Ifptr</span> (<span class="id">plub</span> (<span class="id">poffset</span> <span class="id">p</span>) (<span class="id">provenance</span> <span class="id">w</span>))<br/>
&nbsp;&nbsp;| <span class="id">Ifptr</span> <span class="id">p</span>, <span class="id">_</span> =&gt; <span class="id">Ifptr</span> (<span class="id">plub</span> (<span class="id">poffset</span> <span class="id">p</span>) (<span class="id">provenance</span> <span class="id">w</span>))<br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">ntop2</span> <span class="id">v</span> <span class="id">w</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">subl_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">w</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.subl</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">subl</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2860')">Proof.</div>
<div class="proofscript" id="proof2860">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">Val.subl</span>, <span class="id">subl</span>. <span class="tactic">destruct</span> <span class="id">Archi.ptr64</span>.<br/>
- <span class="id">inv</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H0</span>; <span class="tactic">try</span> (<span class="tactic">destruct</span> (<span class="id">eq_block</span> <span class="id">b</span> <span class="id">b0</span>)); <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id">psub_sound</span>, <span class="id">poffset_sound</span>, <span class="id">pmatch_lub_l</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="id">inv</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H0</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">mull</span> := <span class="id">binop_long</span> <span class="id">Int64.mul</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">mull_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span> <span class="id">w</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.mull</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">mull</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<span class="kwd">Proof</span> (<span class="id">binop_long_sound</span> <span class="id">Int64.mul</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">mullhs</span> := <span class="id">binop_long</span> <span class="id">Int64.mulhs</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">mullhs_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span> <span class="id">w</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.mullhs</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">mullhs</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<span class="kwd">Proof</span> (<span class="id">binop_long_sound</span> <span class="id">Int64.mulhs</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">mullhu</span> := <span class="id">binop_long</span> <span class="id">Int64.mulhu</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">mullhu_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span> <span class="id">w</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.mullhu</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">mullhu</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<span class="kwd">Proof</span> (<span class="id">binop_long_sound</span> <span class="id">Int64.mulhu</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">divls</span> (<span class="id">v</span> <span class="id">w</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">w</span>, <span class="id">v</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">L</span> <span class="id">i2</span>, <span class="id">L</span> <span class="id">i1</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">Int64.eq</span> <span class="id">i2</span> <span class="id">Int64.zero</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|| <span class="id">Int64.eq</span> <span class="id">i1</span> (<span class="id">Int64.repr</span> <span class="id">Int64.min_signed</span>) &amp;&amp; <span class="id">Int64.eq</span> <span class="id">i2</span> <span class="id">Int64.mone</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="kwd">if</span> <span class="id">va_strict</span> <span class="id">tt</span> <span class="kwd">then</span> <span class="id">Vbot</span> <span class="kwd">else</span> <span class="id">ntop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">L</span> (<span class="id">Int64.divs</span> <span class="id">i1</span> <span class="id">i2</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">ntop2</span> <span class="id">v</span> <span class="id">w</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">divls_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">w</span> <span class="id">u</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">Val.divls</span> <span class="id">v</span> <span class="id">w</span> = <span class="id">Some</span> <span class="id">u</span> -&gt; <span class="id">vmatch</span> <span class="id">u</span> (<span class="id">divls</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2861')">Proof.</div>
<div class="proofscript" id="proof2861">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">destruct</span> <span class="id">w</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Int64.eq</span> <span class="id">i0</span> <span class="id">Int64.zero</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|| <span class="id">Int64.eq</span> <span class="id">i</span> (<span class="id">Int64.repr</span> <span class="id">Int64.min_signed</span>) &amp;&amp; <span class="id">Int64.eq</span> <span class="id">i0</span> <span class="id">Int64.mone</span>) <span class="id">eqn</span>:<span class="id">E</span>; <span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H0</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">E</span>. <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">divlu</span> (<span class="id">v</span> <span class="id">w</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">w</span>, <span class="id">v</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">L</span> <span class="id">i2</span>, <span class="id">L</span> <span class="id">i1</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">Int64.eq</span> <span class="id">i2</span> <span class="id">Int64.zero</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="kwd">if</span> <span class="id">va_strict</span> <span class="id">tt</span> <span class="kwd">then</span> <span class="id">Vbot</span> <span class="kwd">else</span> <span class="id">ntop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">L</span> (<span class="id">Int64.divu</span> <span class="id">i1</span> <span class="id">i2</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">ntop2</span> <span class="id">v</span> <span class="id">w</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">divlu_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">w</span> <span class="id">u</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">Val.divlu</span> <span class="id">v</span> <span class="id">w</span> = <span class="id">Some</span> <span class="id">u</span> -&gt; <span class="id">vmatch</span> <span class="id">u</span> (<span class="id">divlu</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2862')">Proof.</div>
<div class="proofscript" id="proof2862">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">destruct</span> <span class="id">w</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Int64.eq</span> <span class="id">i0</span> <span class="id">Int64.zero</span>) <span class="id">eqn</span>:<span class="id">E</span>; <span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H0</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">E</span>. <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">modls</span> (<span class="id">v</span> <span class="id">w</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">w</span>, <span class="id">v</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">L</span> <span class="id">i2</span>, <span class="id">L</span> <span class="id">i1</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">Int64.eq</span> <span class="id">i2</span> <span class="id">Int64.zero</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|| <span class="id">Int64.eq</span> <span class="id">i1</span> (<span class="id">Int64.repr</span> <span class="id">Int64.min_signed</span>) &amp;&amp; <span class="id">Int64.eq</span> <span class="id">i2</span> <span class="id">Int64.mone</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="kwd">if</span> <span class="id">va_strict</span> <span class="id">tt</span> <span class="kwd">then</span> <span class="id">Vbot</span> <span class="kwd">else</span> <span class="id">ntop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">L</span> (<span class="id">Int64.mods</span> <span class="id">i1</span> <span class="id">i2</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">ntop2</span> <span class="id">v</span> <span class="id">w</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">modls_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">w</span> <span class="id">u</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">Val.modls</span> <span class="id">v</span> <span class="id">w</span> = <span class="id">Some</span> <span class="id">u</span> -&gt; <span class="id">vmatch</span> <span class="id">u</span> (<span class="id">modls</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2863')">Proof.</div>
<div class="proofscript" id="proof2863">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">destruct</span> <span class="id">w</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Int64.eq</span> <span class="id">i0</span> <span class="id">Int64.zero</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|| <span class="id">Int64.eq</span> <span class="id">i</span> (<span class="id">Int64.repr</span> <span class="id">Int64.min_signed</span>) &amp;&amp; <span class="id">Int64.eq</span> <span class="id">i0</span> <span class="id">Int64.mone</span>) <span class="id">eqn</span>:<span class="id">E</span>; <span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H0</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">E</span>. <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">modlu</span> (<span class="id">v</span> <span class="id">w</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">w</span>, <span class="id">v</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">L</span> <span class="id">i2</span>, <span class="id">L</span> <span class="id">i1</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">Int64.eq</span> <span class="id">i2</span> <span class="id">Int64.zero</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="kwd">if</span> <span class="id">va_strict</span> <span class="id">tt</span> <span class="kwd">then</span> <span class="id">Vbot</span> <span class="kwd">else</span> <span class="id">ntop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">L</span> (<span class="id">Int64.modu</span> <span class="id">i1</span> <span class="id">i2</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">ntop2</span> <span class="id">v</span> <span class="id">w</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">modlu_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">w</span> <span class="id">u</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">Val.modlu</span> <span class="id">v</span> <span class="id">w</span> = <span class="id">Some</span> <span class="id">u</span> -&gt; <span class="id">vmatch</span> <span class="id">u</span> (<span class="id">modlu</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2864')">Proof.</div>
<div class="proofscript" id="proof2864">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">destruct</span> <span class="id">w</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Int64.eq</span> <span class="id">i0</span> <span class="id">Int64.zero</span>) <span class="id">eqn</span>:<span class="id">E</span>; <span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H0</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">E</span>. <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">shrxl</span> (<span class="id">v</span> <span class="id">w</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">v</span>, <span class="id">w</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">L</span> <span class="id">i</span>, <span class="id">I</span> <span class="id">j</span> =&gt; <span class="kwd">if</span> <span class="id">Int.ltu</span> <span class="id">j</span> (<span class="id">Int.repr</span> 63) <span class="kwd">then</span> <span class="id">L</span>(<span class="id">Int64.shrx</span>' <span class="id">i</span> <span class="id">j</span>) <span class="kwd">else</span> <span class="id">ntop</span><br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">ntop1</span> <span class="id">v</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">shrxl_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">w</span> <span class="id">u</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">Val.shrxl</span> <span class="id">v</span> <span class="id">w</span> = <span class="id">Some</span> <span class="id">u</span> -&gt; <span class="id">vmatch</span> <span class="id">u</span> (<span class="id">shrxl</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2865')">Proof.</div>
<div class="proofscript" id="proof2865">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">destruct</span> <span class="id">w</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Int.ltu</span> <span class="id">i0</span> (<span class="id">Int.repr</span> 63)) <span class="id">eqn</span>:<span class="id">LTU</span>; <span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">shrxl</span>; <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>; <span class="id">inv</span> <span class="id">H0</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">LTU</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Floating-point arithmetic operations </div>
<br/>
<span class="kwd">Definition</span> <span class="id">negf</span> := <span class="id">unop_float</span> <span class="id">Float.neg</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">negf_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.negf</span> <span class="id">v</span>) (<span class="id">negf</span> <span class="id">x</span>).<br/>
<span class="kwd">Proof</span> (<span class="id">unop_float_sound</span> <span class="id">Float.neg</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">absf</span> := <span class="id">unop_float</span> <span class="id">Float.abs</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">absf_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.absf</span> <span class="id">v</span>) (<span class="id">absf</span> <span class="id">x</span>).<br/>
<span class="kwd">Proof</span> (<span class="id">unop_float_sound</span> <span class="id">Float.abs</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">addf</span> := <span class="id">binop_float</span> <span class="id">Float.add</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">addf_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span> <span class="id">w</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.addf</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">addf</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<span class="kwd">Proof</span> (<span class="id">binop_float_sound</span> <span class="id">Float.add</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">subf</span> := <span class="id">binop_float</span> <span class="id">Float.sub</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">subf_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span> <span class="id">w</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.subf</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">subf</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<span class="kwd">Proof</span> (<span class="id">binop_float_sound</span> <span class="id">Float.sub</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">mulf</span> := <span class="id">binop_float</span> <span class="id">Float.mul</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">mulf_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span> <span class="id">w</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.mulf</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">mulf</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<span class="kwd">Proof</span> (<span class="id">binop_float_sound</span> <span class="id">Float.mul</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">divf</span> := <span class="id">binop_float</span> <span class="id">Float.div</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">divf_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span> <span class="id">w</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.divf</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">divf</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<span class="kwd">Proof</span> (<span class="id">binop_float_sound</span> <span class="id">Float.div</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">negfs</span> := <span class="id">unop_single</span> <span class="id">Float32.neg</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">negfs_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.negfs</span> <span class="id">v</span>) (<span class="id">negfs</span> <span class="id">x</span>).<br/>
<span class="kwd">Proof</span> (<span class="id">unop_single_sound</span> <span class="id">Float32.neg</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">absfs</span> := <span class="id">unop_single</span> <span class="id">Float32.abs</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">absfs_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.absfs</span> <span class="id">v</span>) (<span class="id">absfs</span> <span class="id">x</span>).<br/>
<span class="kwd">Proof</span> (<span class="id">unop_single_sound</span> <span class="id">Float32.abs</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">addfs</span> := <span class="id">binop_single</span> <span class="id">Float32.add</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">addfs_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span> <span class="id">w</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.addfs</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">addfs</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<span class="kwd">Proof</span> (<span class="id">binop_single_sound</span> <span class="id">Float32.add</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">subfs</span> := <span class="id">binop_single</span> <span class="id">Float32.sub</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">subfs_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span> <span class="id">w</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.subfs</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">subfs</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<span class="kwd">Proof</span> (<span class="id">binop_single_sound</span> <span class="id">Float32.sub</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">mulfs</span> := <span class="id">binop_single</span> <span class="id">Float32.mul</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">mulfs_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span> <span class="id">w</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.mulfs</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">mulfs</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<span class="kwd">Proof</span> (<span class="id">binop_single_sound</span> <span class="id">Float32.mul</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">divfs</span> := <span class="id">binop_single</span> <span class="id">Float32.div</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">divfs_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span> <span class="id">w</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.divfs</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">divfs</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<span class="kwd">Proof</span> (<span class="id">binop_single_sound</span> <span class="id">Float32.div</span>).<br/>
<br/>
<div class="doc">Conversions </div>
<br/>
<span class="kwd">Definition</span> <span class="id">zero_ext</span> (<span class="id">nbits</span>: <span class="id">Z</span>) (<span class="id">v</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">v</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">i</span> =&gt; <span class="id">I</span> (<span class="id">Int.zero_ext</span> <span class="id">nbits</span> <span class="id">i</span>)<br/>
&nbsp;&nbsp;| <span class="id">Uns</span> <span class="id">p</span> <span class="id">n</span> =&gt; <span class="id">uns</span> <span class="id">p</span> (<span class="id">Z.min</span> <span class="id">n</span> <span class="id">nbits</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">uns</span> (<span class="id">provenance</span> <span class="id">v</span>) <span class="id">nbits</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">zero_ext_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">nbits</span> <span class="id">v</span> <span class="id">x</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.zero_ext</span> <span class="id">nbits</span> <span class="id">v</span>) (<span class="id">zero_ext</span> <span class="id">nbits</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2866')">Proof.</div>
<div class="proofscript" id="proof2866">
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">DFL</span>: <span class="kwd">forall</span> <span class="id">nbits</span> <span class="id">i</span>, <span class="id">is_uns</span> <span class="id">nbits</span> (<span class="id">Int.zero_ext</span> <span class="id">nbits</span> <span class="id">i</span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">Int.bits_zero_ext</span> <span class="tactic">by</span> <span class="tactic">omega</span>. <span class="tactic">apply</span> <span class="id">zlt_false</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>. <span class="tactic">apply</span> <span class="id">vmatch_uns</span>.<br/>
&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="id">zify</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Int.bits_zero_ext</span> <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">m</span> <span class="id">nbits</span>); <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">H1</span>; <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">sign_ext</span> (<span class="id">nbits</span>: <span class="id">Z</span>) (<span class="id">v</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">v</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">i</span> =&gt; <span class="id">I</span> (<span class="id">Int.sign_ext</span> <span class="id">nbits</span> <span class="id">i</span>)<br/>
&nbsp;&nbsp;| <span class="id">Uns</span> <span class="id">p</span> <span class="id">n</span> =&gt; <span class="kwd">if</span> <span class="id">zlt</span> <span class="id">n</span> <span class="id">nbits</span> <span class="kwd">then</span> <span class="id">Uns</span> <span class="id">p</span> <span class="id">n</span> <span class="kwd">else</span> <span class="id">sgn</span> <span class="id">p</span> <span class="id">nbits</span><br/>
&nbsp;&nbsp;| <span class="id">Sgn</span> <span class="id">p</span> <span class="id">n</span> =&gt; <span class="id">sgn</span> <span class="id">p</span> (<span class="id">Z.min</span> <span class="id">n</span> <span class="id">nbits</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">sgn</span> (<span class="id">provenance</span> <span class="id">v</span>) <span class="id">nbits</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">sign_ext_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">nbits</span> <span class="id">v</span> <span class="id">x</span>, 0 &lt; <span class="id">nbits</span> -&gt; <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.sign_ext</span> <span class="id">nbits</span> <span class="id">v</span>) (<span class="id">sign_ext</span> <span class="id">nbits</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2867')">Proof.</div>
<div class="proofscript" id="proof2867">
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">DFL</span>: <span class="kwd">forall</span> <span class="id">p</span> <span class="id">nbits</span> <span class="id">i</span>, 0 &lt; <span class="id">nbits</span> -&gt; <span class="id">vmatch</span> (<span class="id">Vint</span> (<span class="id">Int.sign_ext</span> <span class="id">nbits</span> <span class="id">i</span>)) (<span class="id">sgn</span> <span class="id">p</span> <span class="id">nbits</span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">vmatch_sgn</span>. <span class="tactic">apply</span> <span class="id">is_sign_ext_sgn</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H0</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">n</span> <span class="id">nbits</span>); <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">auto</span>. <span class="tactic">eapply</span> <span class="id">is_sign_ext_uns</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">n</span> <span class="id">nbits</span>); <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="tactic">apply</span> <span class="id">vmatch_sgn</span>. <span class="tactic">apply</span> <span class="id">is_sign_ext_sgn</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Z.min_case</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">longofint</span> (<span class="id">v</span>: <span class="id">aval</span>) := <br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">v</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">i</span> =&gt; <span class="id">L</span> (<span class="id">Int64.repr</span> (<span class="id">Int.signed</span> <span class="id">i</span>))<br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">ntop1</span> <span class="id">v</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">longofint_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.longofint</span> <span class="id">v</span>) (<span class="id">longofint</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2868')">Proof.</div>
<div class="proofscript" id="proof2868">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Val.longofint</span>, <span class="id">longofint</span>; <span class="tactic">intros</span>; <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">longofintu</span> (<span class="id">v</span>: <span class="id">aval</span>) := <br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">v</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">i</span> =&gt; <span class="id">L</span> (<span class="id">Int64.repr</span> (<span class="id">Int.unsigned</span> <span class="id">i</span>))<br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">ntop1</span> <span class="id">v</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">longofintu_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.longofintu</span> <span class="id">v</span>) (<span class="id">longofintu</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2869')">Proof.</div>
<div class="proofscript" id="proof2869">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Val.longofintu</span>, <span class="id">longofintu</span>; <span class="tactic">intros</span>; <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">singleoffloat</span> (<span class="id">v</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">v</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">F</span> <span class="id">f</span> =&gt; <span class="id">FS</span> (<span class="id">Float.to_single</span> <span class="id">f</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span>   =&gt; <span class="id">ntop1</span> <span class="id">v</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">singleoffloat_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.singleoffloat</span> <span class="id">v</span>) (<span class="id">singleoffloat</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2870')">Proof.</div>
<div class="proofscript" id="proof2870">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">DEFAULT</span>: <span class="id">vmatch</span> (<span class="id">Val.singleoffloat</span> <span class="id">v</span>) (<span class="id">ntop1</span> <span class="id">x</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">v</span>; <span class="id">constructor</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">auto</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">floatofsingle</span> (<span class="id">v</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">v</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">FS</span> <span class="id">f</span> =&gt; <span class="id">F</span> (<span class="id">Float.of_single</span> <span class="id">f</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span>   =&gt; <span class="id">ntop1</span> <span class="id">v</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">floatofsingle_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.floatofsingle</span> <span class="id">v</span>) (<span class="id">floatofsingle</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2871')">Proof.</div>
<div class="proofscript" id="proof2871">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">DEFAULT</span>: <span class="id">vmatch</span> (<span class="id">Val.floatofsingle</span> <span class="id">v</span>) (<span class="id">ntop1</span> <span class="id">x</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">v</span>; <span class="id">constructor</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">auto</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">intoffloat</span> (<span class="id">x</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">F</span> <span class="id">f</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">Float.to_int</span> <span class="id">f</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">i</span> =&gt; <span class="id">I</span> <span class="id">i</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="kwd">if</span> <span class="id">va_strict</span> <span class="id">tt</span> <span class="kwd">then</span> <span class="id">Vbot</span> <span class="kwd">else</span> <span class="id">ntop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">ntop1</span> <span class="id">x</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">intoffloat_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span> <span class="id">w</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">Val.intoffloat</span> <span class="id">v</span> = <span class="id">Some</span> <span class="id">w</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> (<span class="id">intoffloat</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2872')">Proof.</div>
<div class="proofscript" id="proof2872">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Val.intoffloat</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Float.to_int</span> <span class="id">f</span>) <span class="kwd">as</span> [<span class="id">i</span>|] <span class="id">eqn</span>:<span class="id">E</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>. <span class="tactic">rewrite</span> <span class="id">E</span>; <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">intuoffloat</span> (<span class="id">x</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">F</span> <span class="id">f</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">Float.to_intu</span> <span class="id">f</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">i</span> =&gt; <span class="id">I</span> <span class="id">i</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="kwd">if</span> <span class="id">va_strict</span> <span class="id">tt</span> <span class="kwd">then</span> <span class="id">Vbot</span> <span class="kwd">else</span> <span class="id">ntop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">ntop1</span> <span class="id">x</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">intuoffloat_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span> <span class="id">w</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">Val.intuoffloat</span> <span class="id">v</span> = <span class="id">Some</span> <span class="id">w</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> (<span class="id">intuoffloat</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2873')">Proof.</div>
<div class="proofscript" id="proof2873">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Val.intuoffloat</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Float.to_intu</span> <span class="id">f</span>) <span class="kwd">as</span> [<span class="id">i</span>|] <span class="id">eqn</span>:<span class="id">E</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>. <span class="tactic">rewrite</span> <span class="id">E</span>; <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">floatofint</span> (<span class="id">x</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">i</span> =&gt; <span class="id">F</span>(<span class="id">Float.of_int</span> <span class="id">i</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span>   =&gt; <span class="id">ntop1</span> <span class="id">x</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">floatofint_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span> <span class="id">w</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">Val.floatofint</span> <span class="id">v</span> = <span class="id">Some</span> <span class="id">w</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> (<span class="id">floatofint</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2874')">Proof.</div>
<div class="proofscript" id="proof2874">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Val.floatofint</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">v</span>; <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">floatofintu</span> (<span class="id">x</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">i</span> =&gt; <span class="id">F</span>(<span class="id">Float.of_intu</span> <span class="id">i</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span>   =&gt; <span class="id">ntop1</span> <span class="id">x</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">floatofintu_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span> <span class="id">w</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">Val.floatofintu</span> <span class="id">v</span> = <span class="id">Some</span> <span class="id">w</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> (<span class="id">floatofintu</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2875')">Proof.</div>
<div class="proofscript" id="proof2875">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Val.floatofintu</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">v</span>; <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">intofsingle</span> (<span class="id">x</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">FS</span> <span class="id">f</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">Float32.to_int</span> <span class="id">f</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">i</span> =&gt; <span class="id">I</span> <span class="id">i</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="kwd">if</span> <span class="id">va_strict</span> <span class="id">tt</span> <span class="kwd">then</span> <span class="id">Vbot</span> <span class="kwd">else</span> <span class="id">ntop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">ntop1</span> <span class="id">x</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">intofsingle_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span> <span class="id">w</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">Val.intofsingle</span> <span class="id">v</span> = <span class="id">Some</span> <span class="id">w</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> (<span class="id">intofsingle</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2876')">Proof.</div>
<div class="proofscript" id="proof2876">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Val.intofsingle</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Float32.to_int</span> <span class="id">f</span>) <span class="kwd">as</span> [<span class="id">i</span>|] <span class="id">eqn</span>:<span class="id">E</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>. <span class="tactic">rewrite</span> <span class="id">E</span>; <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">intuofsingle</span> (<span class="id">x</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">FS</span> <span class="id">f</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">Float32.to_intu</span> <span class="id">f</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">i</span> =&gt; <span class="id">I</span> <span class="id">i</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="kwd">if</span> <span class="id">va_strict</span> <span class="id">tt</span> <span class="kwd">then</span> <span class="id">Vbot</span> <span class="kwd">else</span> <span class="id">ntop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">ntop1</span> <span class="id">x</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">intuofsingle_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span> <span class="id">w</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">Val.intuofsingle</span> <span class="id">v</span> = <span class="id">Some</span> <span class="id">w</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> (<span class="id">intuofsingle</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2877')">Proof.</div>
<div class="proofscript" id="proof2877">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Val.intuofsingle</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Float32.to_intu</span> <span class="id">f</span>) <span class="kwd">as</span> [<span class="id">i</span>|] <span class="id">eqn</span>:<span class="id">E</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>. <span class="tactic">rewrite</span> <span class="id">E</span>; <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">singleofint</span> (<span class="id">x</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">i</span> =&gt; <span class="id">FS</span>(<span class="id">Float32.of_int</span> <span class="id">i</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span>   =&gt; <span class="id">ntop1</span> <span class="id">x</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">singleofint_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span> <span class="id">w</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">Val.singleofint</span> <span class="id">v</span> = <span class="id">Some</span> <span class="id">w</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> (<span class="id">singleofint</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2878')">Proof.</div>
<div class="proofscript" id="proof2878">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Val.singleofint</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">v</span>; <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">singleofintu</span> (<span class="id">x</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">i</span> =&gt; <span class="id">FS</span>(<span class="id">Float32.of_intu</span> <span class="id">i</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span>   =&gt; <span class="id">ntop1</span> <span class="id">x</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">singleofintu_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span> <span class="id">w</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">Val.singleofintu</span> <span class="id">v</span> = <span class="id">Some</span> <span class="id">w</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> (<span class="id">singleofintu</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2879')">Proof.</div>
<div class="proofscript" id="proof2879">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Val.singleofintu</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">v</span>; <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">longoffloat</span> (<span class="id">x</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">F</span> <span class="id">f</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">Float.to_long</span> <span class="id">f</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">i</span> =&gt; <span class="id">L</span> <span class="id">i</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="kwd">if</span> <span class="id">va_strict</span> <span class="id">tt</span> <span class="kwd">then</span> <span class="id">Vbot</span> <span class="kwd">else</span> <span class="id">ntop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">ntop1</span> <span class="id">x</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">longoffloat_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span> <span class="id">w</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">Val.longoffloat</span> <span class="id">v</span> = <span class="id">Some</span> <span class="id">w</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> (<span class="id">longoffloat</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2880')">Proof.</div>
<div class="proofscript" id="proof2880">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Val.longoffloat</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Float.to_long</span> <span class="id">f</span>) <span class="kwd">as</span> [<span class="id">i</span>|] <span class="id">eqn</span>:<span class="id">E</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>. <span class="tactic">rewrite</span> <span class="id">E</span>; <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">longuoffloat</span> (<span class="id">x</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">F</span> <span class="id">f</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">Float.to_longu</span> <span class="id">f</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">i</span> =&gt; <span class="id">L</span> <span class="id">i</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="kwd">if</span> <span class="id">va_strict</span> <span class="id">tt</span> <span class="kwd">then</span> <span class="id">Vbot</span> <span class="kwd">else</span> <span class="id">ntop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">ntop1</span> <span class="id">x</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">longuoffloat_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span> <span class="id">w</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">Val.longuoffloat</span> <span class="id">v</span> = <span class="id">Some</span> <span class="id">w</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> (<span class="id">longuoffloat</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2881')">Proof.</div>
<div class="proofscript" id="proof2881">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Val.longuoffloat</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Float.to_longu</span> <span class="id">f</span>) <span class="kwd">as</span> [<span class="id">i</span>|] <span class="id">eqn</span>:<span class="id">E</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>. <span class="tactic">rewrite</span> <span class="id">E</span>; <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">floatoflong</span> (<span class="id">x</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">L</span> <span class="id">i</span> =&gt; <span class="id">F</span>(<span class="id">Float.of_long</span> <span class="id">i</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span>   =&gt; <span class="id">ntop1</span> <span class="id">x</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">floatoflong_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span> <span class="id">w</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">Val.floatoflong</span> <span class="id">v</span> = <span class="id">Some</span> <span class="id">w</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> (<span class="id">floatoflong</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2882')">Proof.</div>
<div class="proofscript" id="proof2882">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Val.floatoflong</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">v</span>; <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">floatoflongu</span> (<span class="id">x</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">L</span> <span class="id">i</span> =&gt; <span class="id">F</span>(<span class="id">Float.of_longu</span> <span class="id">i</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span>   =&gt; <span class="id">ntop1</span> <span class="id">x</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">floatoflongu_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span> <span class="id">w</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">Val.floatoflongu</span> <span class="id">v</span> = <span class="id">Some</span> <span class="id">w</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> (<span class="id">floatoflongu</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2883')">Proof.</div>
<div class="proofscript" id="proof2883">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Val.floatoflongu</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">v</span>; <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">longofsingle</span> (<span class="id">x</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">FS</span> <span class="id">f</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">Float32.to_long</span> <span class="id">f</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">i</span> =&gt; <span class="id">L</span> <span class="id">i</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="kwd">if</span> <span class="id">va_strict</span> <span class="id">tt</span> <span class="kwd">then</span> <span class="id">Vbot</span> <span class="kwd">else</span> <span class="id">ntop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">ntop1</span> <span class="id">x</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">longofsingle_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span> <span class="id">w</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">Val.longofsingle</span> <span class="id">v</span> = <span class="id">Some</span> <span class="id">w</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> (<span class="id">longofsingle</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2884')">Proof.</div>
<div class="proofscript" id="proof2884">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Val.longofsingle</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Float32.to_long</span> <span class="id">f</span>) <span class="kwd">as</span> [<span class="id">i</span>|] <span class="id">eqn</span>:<span class="id">E</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>. <span class="tactic">rewrite</span> <span class="id">E</span>; <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">longuofsingle</span> (<span class="id">x</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">FS</span> <span class="id">f</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">Float32.to_longu</span> <span class="id">f</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">i</span> =&gt; <span class="id">L</span> <span class="id">i</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="kwd">if</span> <span class="id">va_strict</span> <span class="id">tt</span> <span class="kwd">then</span> <span class="id">Vbot</span> <span class="kwd">else</span> <span class="id">ntop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">ntop1</span> <span class="id">x</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">longuofsingle_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span> <span class="id">w</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">Val.longuofsingle</span> <span class="id">v</span> = <span class="id">Some</span> <span class="id">w</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> (<span class="id">longuofsingle</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2885')">Proof.</div>
<div class="proofscript" id="proof2885">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Val.longuofsingle</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Float32.to_longu</span> <span class="id">f</span>) <span class="kwd">as</span> [<span class="id">i</span>|] <span class="id">eqn</span>:<span class="id">E</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>. <span class="tactic">rewrite</span> <span class="id">E</span>; <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">singleoflong</span> (<span class="id">x</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">L</span> <span class="id">i</span> =&gt; <span class="id">FS</span>(<span class="id">Float32.of_long</span> <span class="id">i</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span>   =&gt; <span class="id">ntop1</span> <span class="id">x</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">singleoflong_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span> <span class="id">w</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">Val.singleoflong</span> <span class="id">v</span> = <span class="id">Some</span> <span class="id">w</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> (<span class="id">singleoflong</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2886')">Proof.</div>
<div class="proofscript" id="proof2886">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Val.singleoflong</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">v</span>; <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">singleoflongu</span> (<span class="id">x</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">L</span> <span class="id">i</span> =&gt; <span class="id">FS</span>(<span class="id">Float32.of_longu</span> <span class="id">i</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span>   =&gt; <span class="id">ntop1</span> <span class="id">x</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">singleoflongu_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span> <span class="id">w</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">Val.singleoflongu</span> <span class="id">v</span> = <span class="id">Some</span> <span class="id">w</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> (<span class="id">singleoflongu</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2887')">Proof.</div>
<div class="proofscript" id="proof2887">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Val.singleoflongu</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">v</span>; <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">floatofwords</span> (<span class="id">x</span> <span class="id">y</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span>, <span class="id">y</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">i</span>, <span class="id">I</span> <span class="id">j</span> =&gt; <span class="id">F</span>(<span class="id">Float.from_words</span> <span class="id">i</span> <span class="id">j</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span>     =&gt; <span class="id">ntop2</span> <span class="id">x</span> <span class="id">y</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">floatofwords_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">w</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.floatofwords</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">floatofwords</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2888')">Proof.</div>
<div class="proofscript" id="proof2888">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">floatofwords</span>; <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>; <span class="id">inv</span> <span class="id">H0</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">longofwords</span> (<span class="id">x</span> <span class="id">y</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">y</span>, <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">j</span>, <span class="id">I</span> <span class="id">i</span> =&gt; <span class="id">L</span>(<span class="id">Int64.ofwords</span> <span class="id">i</span> <span class="id">j</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span>     =&gt; <span class="id">ntop2</span> <span class="id">x</span> <span class="id">y</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">longofwords_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">w</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.longofwords</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">longofwords</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2889')">Proof.</div>
<div class="proofscript" id="proof2889">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">longofwords</span>; <span class="id">inv</span> <span class="id">H0</span>; <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">loword</span> (<span class="id">x</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">L</span> <span class="id">i</span> =&gt; <span class="id">I</span>(<span class="id">Int64.loword</span> <span class="id">i</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span>   =&gt; <span class="id">ntop1</span> <span class="id">x</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">loword_sound</span>: <span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.loword</span> <span class="id">v</span>) (<span class="id">loword</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2890')">Proof.</div>
<div class="proofscript" id="proof2890">
&nbsp;&nbsp;<span class="tactic">destruct</span> 1; <span class="tactic">simpl</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">hiword</span> (<span class="id">x</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">L</span> <span class="id">i</span> =&gt; <span class="id">I</span>(<span class="id">Int64.hiword</span> <span class="id">i</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span>   =&gt; <span class="id">ntop1</span> <span class="id">x</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">hiword_sound</span>: <span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.hiword</span> <span class="id">v</span>) (<span class="id">hiword</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2891')">Proof.</div>
<div class="proofscript" id="proof2891">
&nbsp;&nbsp;<span class="tactic">destruct</span> 1; <span class="tactic">simpl</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Comparisons and variation intervals </div>
<br/>
<span class="kwd">Definition</span> <span class="id">cmp_intv</span> (<span class="id">c</span>: <span class="id">comparison</span>) (<span class="id">i</span>: <span class="id">Z</span> * <span class="id">Z</span>) (<span class="id">n</span>: <span class="id">Z</span>) : <span class="id">abool</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">lo</span>, <span class="id">hi</span>) := <span class="id">i</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">c</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Ceq</span> =&gt; <span class="kwd">if</span> <span class="id">zlt</span> <span class="id">n</span> <span class="id">lo</span> || <span class="id">zlt</span> <span class="id">hi</span> <span class="id">n</span> <span class="kwd">then</span> <span class="id">Maybe</span> <span class="id">false</span> <span class="kwd">else</span> <span class="id">Btop</span><br/>
&nbsp;&nbsp;| <span class="id">Cne</span> =&gt; <span class="id">Btop</span><br/>
&nbsp;&nbsp;| <span class="id">Clt</span> =&gt; <span class="kwd">if</span> <span class="id">zlt</span> <span class="id">hi</span> <span class="id">n</span> <span class="kwd">then</span> <span class="id">Maybe</span> <span class="id">true</span> <span class="kwd">else</span> <span class="kwd">if</span> <span class="id">zle</span> <span class="id">n</span> <span class="id">lo</span> <span class="kwd">then</span> <span class="id">Maybe</span> <span class="id">false</span> <span class="kwd">else</span> <span class="id">Btop</span><br/>
&nbsp;&nbsp;| <span class="id">Cle</span> =&gt; <span class="kwd">if</span> <span class="id">zle</span> <span class="id">hi</span> <span class="id">n</span> <span class="kwd">then</span> <span class="id">Maybe</span> <span class="id">true</span> <span class="kwd">else</span> <span class="kwd">if</span> <span class="id">zlt</span> <span class="id">n</span> <span class="id">lo</span> <span class="kwd">then</span> <span class="id">Maybe</span> <span class="id">false</span> <span class="kwd">else</span> <span class="id">Btop</span><br/>
&nbsp;&nbsp;| <span class="id">Cgt</span> =&gt; <span class="kwd">if</span> <span class="id">zlt</span> <span class="id">n</span> <span class="id">lo</span> <span class="kwd">then</span> <span class="id">Maybe</span> <span class="id">true</span> <span class="kwd">else</span> <span class="kwd">if</span> <span class="id">zle</span> <span class="id">hi</span> <span class="id">n</span> <span class="kwd">then</span> <span class="id">Maybe</span> <span class="id">false</span> <span class="kwd">else</span> <span class="id">Btop</span><br/>
&nbsp;&nbsp;| <span class="id">Cge</span> =&gt; <span class="kwd">if</span> <span class="id">zle</span> <span class="id">n</span> <span class="id">lo</span> <span class="kwd">then</span> <span class="id">Maybe</span> <span class="id">true</span> <span class="kwd">else</span> <span class="kwd">if</span> <span class="id">zlt</span> <span class="id">hi</span> <span class="id">n</span> <span class="kwd">then</span> <span class="id">Maybe</span> <span class="id">false</span> <span class="kwd">else</span> <span class="id">Btop</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">zcmp</span> (<span class="id">c</span>: <span class="id">comparison</span>) (<span class="id">n1</span> <span class="id">n2</span>: <span class="id">Z</span>) : <span class="id">bool</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">c</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Ceq</span> =&gt; <span class="id">zeq</span> <span class="id">n1</span> <span class="id">n2</span><br/>
&nbsp;&nbsp;| <span class="id">Cne</span> =&gt; <span class="id">negb</span> (<span class="id">zeq</span> <span class="id">n1</span> <span class="id">n2</span>)<br/>
&nbsp;&nbsp;| <span class="id">Clt</span> =&gt; <span class="id">zlt</span> <span class="id">n1</span> <span class="id">n2</span><br/>
&nbsp;&nbsp;| <span class="id">Cle</span> =&gt; <span class="id">zle</span> <span class="id">n1</span> <span class="id">n2</span><br/>
&nbsp;&nbsp;| <span class="id">Cgt</span> =&gt; <span class="id">zlt</span> <span class="id">n2</span> <span class="id">n1</span><br/>
&nbsp;&nbsp;| <span class="id">Cge</span> =&gt; <span class="id">zle</span> <span class="id">n2</span> <span class="id">n1</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">zcmp_intv_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">i</span> <span class="id">x</span> <span class="id">n</span>,<br/>
&nbsp;&nbsp;<span class="id">fst</span> <span class="id">i</span> &lt;= <span class="id">x</span> &lt;= <span class="id">snd</span> <span class="id">i</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">cmatch</span> (<span class="id">Some</span> (<span class="id">zcmp</span> <span class="id">c</span> <span class="id">x</span> <span class="id">n</span>)) (<span class="id">cmp_intv</span> <span class="id">c</span> <span class="id">i</span> <span class="id">n</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2892')">Proof.</div>
<div class="proofscript" id="proof2892">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">c</span> [<span class="id">lo</span> <span class="id">hi</span>] <span class="id">x</span> <span class="id">n</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span> <span class="id">R</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">c</span>; <span class="tactic">unfold</span> <span class="id">zcmp</span>, <span class="id">proj_sumbool</span>.<br/>
- <span class="comment">(*&nbsp;eq&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">n</span> <span class="id">lo</span>). <span class="tactic">rewrite</span> <span class="id">zeq_false</span> <span class="tactic">by</span> <span class="tactic">omega</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">hi</span> <span class="id">n</span>). <span class="tactic">rewrite</span> <span class="id">zeq_false</span> <span class="tactic">by</span> <span class="tactic">omega</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
- <span class="comment">(*&nbsp;ne&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
- <span class="comment">(*&nbsp;lt&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">hi</span> <span class="id">n</span>). <span class="tactic">rewrite</span> <span class="id">zlt_true</span> <span class="tactic">by</span> <span class="tactic">omega</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zle</span> <span class="id">n</span> <span class="id">lo</span>). <span class="tactic">rewrite</span> <span class="id">zlt_false</span> <span class="tactic">by</span> <span class="tactic">omega</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
- <span class="comment">(*&nbsp;le&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zle</span> <span class="id">hi</span> <span class="id">n</span>). <span class="tactic">rewrite</span> <span class="id">zle_true</span> <span class="tactic">by</span> <span class="tactic">omega</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">n</span> <span class="id">lo</span>). <span class="tactic">rewrite</span> <span class="id">zle_false</span> <span class="tactic">by</span> <span class="tactic">omega</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
- <span class="comment">(*&nbsp;gt&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">n</span> <span class="id">lo</span>). <span class="tactic">rewrite</span> <span class="id">zlt_true</span> <span class="tactic">by</span> <span class="tactic">omega</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zle</span> <span class="id">hi</span> <span class="id">n</span>). <span class="tactic">rewrite</span> <span class="id">zlt_false</span> <span class="tactic">by</span> <span class="tactic">omega</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
- <span class="comment">(*&nbsp;ge&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zle</span> <span class="id">n</span> <span class="id">lo</span>). <span class="tactic">rewrite</span> <span class="id">zle_true</span> <span class="tactic">by</span> <span class="tactic">omega</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">hi</span> <span class="id">n</span>). <span class="tactic">rewrite</span> <span class="id">zle_false</span> <span class="tactic">by</span> <span class="tactic">omega</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">cmp_intv_None</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">i</span> <span class="id">n</span>, <span class="id">cmatch</span> <span class="id">None</span> (<span class="id">cmp_intv</span> <span class="id">c</span> <span class="id">i</span> <span class="id">n</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2893')">Proof.</div>
<div class="proofscript" id="proof2893">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">cmp_intv</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">i</span> <span class="kwd">as</span> [<span class="id">lo</span> <span class="id">hi</span>].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">c</span>.<br/>
- <span class="comment">(*&nbsp;eq&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">n</span> <span class="id">lo</span>). <span class="id">constructor</span>. <span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">hi</span> <span class="id">n</span>); <span class="id">constructor</span>.<br/>
- <span class="comment">(*&nbsp;ne&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
- <span class="comment">(*&nbsp;lt&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">hi</span> <span class="id">n</span>). <span class="id">constructor</span>. <span class="tactic">destruct</span> (<span class="id">zle</span> <span class="id">n</span> <span class="id">lo</span>); <span class="id">constructor</span>.<br/>
- <span class="comment">(*&nbsp;le&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zle</span> <span class="id">hi</span> <span class="id">n</span>). <span class="id">constructor</span>. <span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">n</span> <span class="id">lo</span>); <span class="id">constructor</span>.<br/>
- <span class="comment">(*&nbsp;gt&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">n</span> <span class="id">lo</span>). <span class="id">constructor</span>. <span class="tactic">destruct</span> (<span class="id">zle</span> <span class="id">hi</span> <span class="id">n</span>); <span class="id">constructor</span>.<br/>
- <span class="comment">(*&nbsp;ge&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zle</span> <span class="id">n</span> <span class="id">lo</span>). <span class="id">constructor</span>. <span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">hi</span> <span class="id">n</span>); <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">uintv</span> (<span class="id">v</span>: <span class="id">aval</span>) : <span class="id">Z</span> * <span class="id">Z</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">v</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">n</span> =&gt; (<span class="id">Int.unsigned</span> <span class="id">n</span>, <span class="id">Int.unsigned</span> <span class="id">n</span>)<br/>
&nbsp;&nbsp;| <span class="id">Uns</span> <span class="id">_</span> <span class="id">n</span> =&gt; <span class="kwd">if</span> <span class="id">zlt</span> <span class="id">n</span> <span class="id">Int.zwordsize</span> <span class="kwd">then</span> (0, <span class="id">two_p</span> <span class="id">n</span> - 1) <span class="kwd">else</span> (0, <span class="id">Int.max_unsigned</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; (0, <span class="id">Int.max_unsigned</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">uintv_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">v</span>, <span class="id">vmatch</span> (<span class="id">Vint</span> <span class="id">n</span>) <span class="id">v</span> -&gt; <span class="id">fst</span> (<span class="id">uintv</span> <span class="id">v</span>) &lt;= <span class="id">Int.unsigned</span> <span class="id">n</span> &lt;= <span class="id">snd</span> (<span class="id">uintv</span> <span class="id">v</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2894')">Proof.</div>
<div class="proofscript" id="proof2894">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> (<span class="tactic">apply</span> <span class="id">Int.unsigned_range_2</span>).<br/>
- <span class="tactic">omega</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">n0</span> <span class="id">Int.zwordsize</span>); <span class="tactic">simpl</span>.<br/>
+ <span class="tactic">rewrite</span> <span class="id">is_uns_zero_ext</span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H2</span>. <span class="tactic">rewrite</span> <span class="id">Int.zero_ext_mod</span> <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">Z_mod_lt</span> (<span class="id">Int.unsigned</span> <span class="id">n</span>) (<span class="id">two_p</span> <span class="id">n0</span>)). <span class="tactic">apply</span> <span class="id">two_p_gt_ZERO</span>; <span class="tactic">auto</span>. <span class="tactic">omega</span>.<br/>
+ <span class="tactic">apply</span> <span class="id">Int.unsigned_range_2</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">cmpu_intv_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">valid</span> <span class="id">c</span> <span class="id">n1</span> <span class="id">v1</span> <span class="id">n2</span>,<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> (<span class="id">Vint</span> <span class="id">n1</span>) <span class="id">v1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">cmatch</span> (<span class="id">Val.cmpu_bool</span> <span class="id">valid</span> <span class="id">c</span> (<span class="id">Vint</span> <span class="id">n1</span>) (<span class="id">Vint</span> <span class="id">n2</span>)) (<span class="id">cmp_intv</span> <span class="id">c</span> (<span class="id">uintv</span> <span class="id">v1</span>) (<span class="id">Int.unsigned</span> <span class="id">n2</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2895')">Proof.</div>
<div class="proofscript" id="proof2895">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">simpl</span>. <span class="tactic">replace</span> (<span class="id">Int.cmpu</span> <span class="id">c</span> <span class="id">n1</span> <span class="id">n2</span>) <span class="kwd">with</span> (<span class="id">zcmp</span> <span class="id">c</span> (<span class="id">Int.unsigned</span> <span class="id">n1</span>) (<span class="id">Int.unsigned</span> <span class="id">n2</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">zcmp_intv_sound</span>; <span class="tactic">apply</span> <span class="id">uintv_sound</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">c</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Int.ltu</span>. <span class="tactic">destruct</span> (<span class="id">zle</span> (<span class="id">Int.unsigned</span> <span class="id">n1</span>) (<span class="id">Int.unsigned</span> <span class="id">n2</span>)); [<span class="tactic">rewrite</span> <span class="id">zlt_false</span>|<span class="tactic">rewrite</span> <span class="id">zlt_true</span>]; <span class="tactic">auto</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Int.ltu</span>. <span class="tactic">destruct</span> (<span class="id">zle</span> (<span class="id">Int.unsigned</span> <span class="id">n2</span>) (<span class="id">Int.unsigned</span> <span class="id">n1</span>)); [<span class="tactic">rewrite</span> <span class="id">zlt_false</span>|<span class="tactic">rewrite</span> <span class="id">zlt_true</span>]; <span class="tactic">auto</span>; <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">cmpu_intv_sound_2</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">valid</span> <span class="id">c</span> <span class="id">n1</span> <span class="id">v1</span> <span class="id">n2</span>,<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> (<span class="id">Vint</span> <span class="id">n1</span>) <span class="id">v1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">cmatch</span> (<span class="id">Val.cmpu_bool</span> <span class="id">valid</span> <span class="id">c</span> (<span class="id">Vint</span> <span class="id">n2</span>) (<span class="id">Vint</span> <span class="id">n1</span>)) (<span class="id">cmp_intv</span> (<span class="id">swap_comparison</span> <span class="id">c</span>) (<span class="id">uintv</span> <span class="id">v1</span>) (<span class="id">Int.unsigned</span> <span class="id">n2</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2896')">Proof.</div>
<div class="proofscript" id="proof2896">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">Val.swap_cmpu_bool</span>. <span class="tactic">apply</span> <span class="id">cmpu_intv_sound</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">sintv</span> (<span class="id">v</span>: <span class="id">aval</span>) : <span class="id">Z</span> * <span class="id">Z</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">v</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">n</span> =&gt; (<span class="id">Int.signed</span> <span class="id">n</span>, <span class="id">Int.signed</span> <span class="id">n</span>)<br/>
&nbsp;&nbsp;| <span class="id">Uns</span> <span class="id">_</span> <span class="id">n</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">zlt</span> <span class="id">n</span> <span class="id">Int.zwordsize</span> <span class="kwd">then</span> (0, <span class="id">two_p</span> <span class="id">n</span> - 1) <span class="kwd">else</span> (<span class="id">Int.min_signed</span>, <span class="id">Int.max_signed</span>)<br/>
&nbsp;&nbsp;| <span class="id">Sgn</span> <span class="id">_</span> <span class="id">n</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">zlt</span> <span class="id">n</span> <span class="id">Int.zwordsize</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> (<span class="kwd">let</span> <span class="id">x</span> := <span class="id">two_p</span> (<span class="id">n</span>-1) <span class="kwd">in</span> (-<span class="id">x</span>, <span class="id">x</span>-1))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> (<span class="id">Int.min_signed</span>, <span class="id">Int.max_signed</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; (<span class="id">Int.min_signed</span>, <span class="id">Int.max_signed</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">sintv_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">v</span>, <span class="id">vmatch</span> (<span class="id">Vint</span> <span class="id">n</span>) <span class="id">v</span> -&gt; <span class="id">fst</span> (<span class="id">sintv</span> <span class="id">v</span>) &lt;= <span class="id">Int.signed</span> <span class="id">n</span> &lt;= <span class="id">snd</span> (<span class="id">sintv</span> <span class="id">v</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2897')">Proof.</div>
<div class="proofscript" id="proof2897">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> (<span class="tactic">apply</span> <span class="id">Int.signed_range</span>).<br/>
- <span class="tactic">omega</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">n0</span> <span class="id">Int.zwordsize</span>); <span class="tactic">simpl</span>.<br/>
+ <span class="tactic">rewrite</span> <span class="id">is_uns_zero_ext</span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Int.unsigned</span> (<span class="id">Int.zero_ext</span> <span class="id">n0</span> <span class="id">n</span>) = <span class="id">Int.unsigned</span> <span class="id">n</span> <span class="id">mod</span> <span class="id">two_p</span> <span class="id">n0</span>) <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id">Int.zero_ext_mod</span>; <span class="tactic">omega</span>).<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">Z_mod_lt</span> (<span class="id">Int.unsigned</span> <span class="id">n</span>) (<span class="id">two_p</span> <span class="id">n0</span>)). <span class="tactic">apply</span> <span class="id">two_p_gt_ZERO</span>; <span class="tactic">auto</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">Int.signed</span> (<span class="id">Int.zero_ext</span> <span class="id">n0</span> <span class="id">n</span>)) <span class="kwd">with</span> (<span class="id">Int.unsigned</span> (<span class="id">Int.zero_ext</span> <span class="id">n0</span> <span class="id">n</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Int.signed</span>. <span class="tactic">rewrite</span> <span class="id">zlt_true</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">two_p</span> <span class="id">n0</span> &lt;= <span class="id">Int.half_modulus</span>).<br/>
&nbsp;&nbsp;{ <span class="id">change</span> <span class="id">Int.half_modulus</span> <span class="kwd">with</span> (<span class="id">two_p</span> (<span class="id">Int.zwordsize</span> - 1)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">two_p_monotone</span>. <span class="tactic">omega</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
+ <span class="tactic">apply</span> <span class="id">Int.signed_range</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">n0</span> (<span class="id">Int.zwordsize</span>)); <span class="tactic">simpl</span>.<br/>
+ <span class="tactic">rewrite</span> <span class="id">is_sgn_sign_ext</span> <span class="kwd">in</span> <span class="id">H2</span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">Int.sign_ext_range</span> <span class="id">n0</span> <span class="id">n</span>). <span class="tactic">omega</span>. <span class="tactic">omega</span>.<br/>
+ <span class="tactic">apply</span> <span class="id">Int.signed_range</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">cmp_intv_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">n1</span> <span class="id">v1</span> <span class="id">n2</span>,<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> (<span class="id">Vint</span> <span class="id">n1</span>) <span class="id">v1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">cmatch</span> (<span class="id">Val.cmp_bool</span> <span class="id">c</span> (<span class="id">Vint</span> <span class="id">n1</span>) (<span class="id">Vint</span> <span class="id">n2</span>)) (<span class="id">cmp_intv</span> <span class="id">c</span> (<span class="id">sintv</span> <span class="id">v1</span>) (<span class="id">Int.signed</span> <span class="id">n2</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2898')">Proof.</div>
<div class="proofscript" id="proof2898">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">simpl</span>. <span class="tactic">replace</span> (<span class="id">Int.cmp</span> <span class="id">c</span> <span class="id">n1</span> <span class="id">n2</span>) <span class="kwd">with</span> (<span class="id">zcmp</span> <span class="id">c</span> (<span class="id">Int.signed</span> <span class="id">n1</span>) (<span class="id">Int.signed</span> <span class="id">n2</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">zcmp_intv_sound</span>; <span class="tactic">apply</span> <span class="id">sintv_sound</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">c</span>; <span class="tactic">simpl</span>; <span class="tactic">rewrite</span> ? <span class="id">Int.eq_signed</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Int.lt</span>. <span class="tactic">destruct</span> (<span class="id">zle</span> (<span class="id">Int.signed</span> <span class="id">n1</span>) (<span class="id">Int.signed</span> <span class="id">n2</span>)); [<span class="tactic">rewrite</span> <span class="id">zlt_false</span>|<span class="tactic">rewrite</span> <span class="id">zlt_true</span>]; <span class="tactic">auto</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Int.lt</span>. <span class="tactic">destruct</span> (<span class="id">zle</span> (<span class="id">Int.signed</span> <span class="id">n2</span>) (<span class="id">Int.signed</span> <span class="id">n1</span>)); [<span class="tactic">rewrite</span> <span class="id">zlt_false</span>|<span class="tactic">rewrite</span> <span class="id">zlt_true</span>]; <span class="tactic">auto</span>; <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">cmp_intv_sound_2</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">n1</span> <span class="id">v1</span> <span class="id">n2</span>,<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> (<span class="id">Vint</span> <span class="id">n1</span>) <span class="id">v1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">cmatch</span> (<span class="id">Val.cmp_bool</span> <span class="id">c</span> (<span class="id">Vint</span> <span class="id">n2</span>) (<span class="id">Vint</span> <span class="id">n1</span>)) (<span class="id">cmp_intv</span> (<span class="id">swap_comparison</span> <span class="id">c</span>) (<span class="id">sintv</span> <span class="id">v1</span>) (<span class="id">Int.signed</span> <span class="id">n2</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2899')">Proof.</div>
<div class="proofscript" id="proof2899">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">Val.swap_cmp_bool</span>. <span class="tactic">apply</span> <span class="id">cmp_intv_sound</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Comparisons </div>
<br/>
<span class="kwd">Definition</span> <span class="id">cmpu_bool</span> (<span class="id">c</span>: <span class="id">comparison</span>) (<span class="id">v</span> <span class="id">w</span>: <span class="id">aval</span>) : <span class="id">abool</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">v</span>, <span class="id">w</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">i1</span>, <span class="id">I</span> <span class="id">i2</span> =&gt; <span class="id">Just</span> (<span class="id">Int.cmpu</span> <span class="id">c</span> <span class="id">i1</span> <span class="id">i2</span>)<br/>
&nbsp;&nbsp;| <span class="id">Ptr</span> <span class="id">_</span>, <span class="id">I</span> <span class="id">_</span> =&gt; <span class="id">cmp_different_blocks</span> <span class="id">c</span><br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">_</span>, <span class="id">Ptr</span> <span class="id">_</span> =&gt; <span class="id">cmp_different_blocks</span> <span class="id">c</span><br/>
&nbsp;&nbsp;| <span class="id">Ptr</span> <span class="id">p1</span>, <span class="id">Ptr</span> <span class="id">p2</span> =&gt; <span class="id">pcmp</span> <span class="id">c</span> <span class="id">p1</span> <span class="id">p2</span><br/>
&nbsp;&nbsp;| <span class="id">Ptr</span> <span class="id">p1</span>, (<span class="id">Ifptr</span> <span class="id">p2</span> | <span class="id">Uns</span> <span class="id">p2</span> <span class="id">_</span> | <span class="id">Sgn</span> <span class="id">p2</span> <span class="id">_</span>) =&gt; <span class="id">club</span> (<span class="id">pcmp</span> <span class="id">c</span> <span class="id">p1</span> <span class="id">p2</span>) (<span class="id">cmp_different_blocks</span> <span class="id">c</span>)<br/>
&nbsp;&nbsp;| (<span class="id">Ifptr</span> <span class="id">p1</span> | <span class="id">Uns</span> <span class="id">p1</span> <span class="id">_</span> | <span class="id">Sgn</span> <span class="id">p1</span> <span class="id">_</span>), <span class="id">Ptr</span> <span class="id">p2</span> =&gt; <span class="id">club</span> (<span class="id">pcmp</span> <span class="id">c</span> <span class="id">p1</span> <span class="id">p2</span>) (<span class="id">cmp_different_blocks</span> <span class="id">c</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">I</span> <span class="id">i</span> =&gt; <span class="id">club</span> (<span class="id">cmp_intv</span> <span class="id">c</span> (<span class="id">uintv</span> <span class="id">v</span>) (<span class="id">Int.unsigned</span> <span class="id">i</span>)) (<span class="id">cmp_different_blocks</span> <span class="id">c</span>)<br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">i</span>, <span class="id">_</span> =&gt; <span class="id">club</span> (<span class="id">cmp_intv</span> (<span class="id">swap_comparison</span> <span class="id">c</span>) (<span class="id">uintv</span> <span class="id">w</span>) (<span class="id">Int.unsigned</span> <span class="id">i</span>)) (<span class="id">cmp_different_blocks</span> <span class="id">c</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">Btop</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">cmpu_bool_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">valid</span> <span class="id">c</span> <span class="id">v</span> <span class="id">w</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">cmatch</span> (<span class="id">Val.cmpu_bool</span> <span class="id">valid</span> <span class="id">c</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">cmpu_bool</span> <span class="id">c</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2900')">Proof.</div>
<div class="proofscript" id="proof2900">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">IP</span>: <span class="kwd">forall</span> <span class="id">i</span> <span class="id">b</span> <span class="id">ofs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cmatch</span> (<span class="id">Val.cmpu_bool</span> <span class="id">valid</span> <span class="id">c</span> (<span class="id">Vint</span> <span class="id">i</span>) (<span class="id">Vptr</span> <span class="id">b</span> <span class="id">ofs</span>)) (<span class="id">cmp_different_blocks</span> <span class="id">c</span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">simpl</span>. <span class="tactic">destruct</span> <span class="id">Archi.ptr64</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">cmp_different_blocks_none</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Int.eq</span> <span class="id">i</span> <span class="id">Int.zero</span> &amp;&amp; (<span class="id">valid</span> <span class="id">b</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span>) || <span class="id">valid</span> <span class="id">b</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span> - 1))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">cmp_different_blocks_sound</span>. <span class="tactic">apply</span> <span class="id">cmp_different_blocks_none</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">PI</span>: <span class="kwd">forall</span> <span class="id">i</span> <span class="id">b</span> <span class="id">ofs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cmatch</span> (<span class="id">Val.cmpu_bool</span> <span class="id">valid</span> <span class="id">c</span> (<span class="id">Vptr</span> <span class="id">b</span> <span class="id">ofs</span>) (<span class="id">Vint</span> <span class="id">i</span>)) (<span class="id">cmp_different_blocks</span> <span class="id">c</span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">simpl</span>. <span class="tactic">destruct</span> <span class="id">Archi.ptr64</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">cmp_different_blocks_none</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Int.eq</span> <span class="id">i</span> <span class="id">Int.zero</span> &amp;&amp; (<span class="id">valid</span> <span class="id">b</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span>) || <span class="id">valid</span> <span class="id">b</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span> - 1))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">cmp_different_blocks_sound</span>. <span class="tactic">apply</span> <span class="id">cmp_different_blocks_none</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">cmpu_bool</span>; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;<span class="tactic">auto</span> <span class="kwd">using</span> <span class="id">cmatch_top</span>, <span class="id">cmp_different_blocks_none</span>, <span class="id">pcmp_none</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cmatch_lub_l</span>, <span class="id">cmatch_lub_r</span>, <span class="id">pcmp_sound</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cmpu_intv_sound</span>, <span class="id">cmpu_intv_sound_2</span>, <span class="id">cmp_intv_None</span>.<br/>
- <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">cmp_bool</span> (<span class="id">c</span>: <span class="id">comparison</span>) (<span class="id">v</span> <span class="id">w</span>: <span class="id">aval</span>) : <span class="id">abool</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">v</span>, <span class="id">w</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">i1</span>, <span class="id">I</span> <span class="id">i2</span> =&gt; <span class="id">Just</span> (<span class="id">Int.cmp</span> <span class="id">c</span> <span class="id">i1</span> <span class="id">i2</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">I</span> <span class="id">i</span> =&gt; <span class="id">cmp_intv</span> <span class="id">c</span> (<span class="id">sintv</span> <span class="id">v</span>) (<span class="id">Int.signed</span> <span class="id">i</span>)<br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">i</span>, <span class="id">_</span> =&gt; <span class="id">cmp_intv</span> (<span class="id">swap_comparison</span> <span class="id">c</span>) (<span class="id">sintv</span> <span class="id">w</span>) (<span class="id">Int.signed</span> <span class="id">i</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">Btop</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">cmp_bool_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">v</span> <span class="id">w</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">cmatch</span> (<span class="id">Val.cmp_bool</span> <span class="id">c</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">cmp_bool</span> <span class="id">c</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2901')">Proof.</div>
<div class="proofscript" id="proof2901">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">cmp_bool</span>; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;<span class="tactic">auto</span> <span class="kwd">using</span> <span class="id">cmatch_top</span>, <span class="id">cmp_intv_sound</span>, <span class="id">cmp_intv_sound_2</span>, <span class="id">cmp_intv_None</span>.<br/>
- <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">cmplu_bool</span> (<span class="id">c</span>: <span class="id">comparison</span>) (<span class="id">v</span> <span class="id">w</span>: <span class="id">aval</span>) : <span class="id">abool</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">v</span>, <span class="id">w</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">L</span> <span class="id">i1</span>, <span class="id">L</span> <span class="id">i2</span> =&gt; <span class="id">Just</span> (<span class="id">Int64.cmpu</span> <span class="id">c</span> <span class="id">i1</span> <span class="id">i2</span>)<br/>
&nbsp;&nbsp;| <span class="id">Ptr</span> <span class="id">_</span>, <span class="id">L</span> <span class="id">_</span> =&gt; <span class="id">cmp_different_blocks</span> <span class="id">c</span><br/>
&nbsp;&nbsp;| <span class="id">L</span> <span class="id">_</span>, <span class="id">Ptr</span> <span class="id">_</span> =&gt; <span class="id">cmp_different_blocks</span> <span class="id">c</span><br/>
&nbsp;&nbsp;| <span class="id">Ptr</span> <span class="id">p1</span>, <span class="id">Ptr</span> <span class="id">p2</span> =&gt; <span class="id">pcmp</span> <span class="id">c</span> <span class="id">p1</span> <span class="id">p2</span><br/>
&nbsp;&nbsp;| <span class="id">Ptr</span> <span class="id">p1</span>, <span class="id">Ifptr</span> <span class="id">p2</span> =&gt; <span class="id">club</span> (<span class="id">pcmp</span> <span class="id">c</span> <span class="id">p1</span> <span class="id">p2</span>) (<span class="id">cmp_different_blocks</span> <span class="id">c</span>)<br/>
&nbsp;&nbsp;| <span class="id">Ifptr</span> <span class="id">p1</span>, <span class="id">Ptr</span> <span class="id">p2</span> =&gt; <span class="id">club</span> (<span class="id">pcmp</span> <span class="id">c</span> <span class="id">p1</span> <span class="id">p2</span>) (<span class="id">cmp_different_blocks</span> <span class="id">c</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">Btop</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">cmplu_bool_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">valid</span> <span class="id">c</span> <span class="id">v</span> <span class="id">w</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">cmatch</span> (<span class="id">Val.cmplu_bool</span> <span class="id">valid</span> <span class="id">c</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">cmplu_bool</span> <span class="id">c</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2902')">Proof.</div>
<div class="proofscript" id="proof2902">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">IP</span>: <span class="kwd">forall</span> <span class="id">i</span> <span class="id">b</span> <span class="id">ofs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cmatch</span> (<span class="id">Val.cmplu_bool</span> <span class="id">valid</span> <span class="id">c</span> (<span class="id">Vlong</span> <span class="id">i</span>) (<span class="id">Vptr</span> <span class="id">b</span> <span class="id">ofs</span>)) (<span class="id">cmp_different_blocks</span> <span class="id">c</span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">simpl</span>. <span class="tactic">destruct</span> <span class="id">Archi.ptr64</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Int64.eq</span> <span class="id">i</span> <span class="id">Int64.zero</span> &amp;&amp; (<span class="id">valid</span> <span class="id">b</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span>) || <span class="id">valid</span> <span class="id">b</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span> - 1))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">cmp_different_blocks_sound</span>. <span class="tactic">apply</span> <span class="id">cmp_different_blocks_none</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">cmp_different_blocks_none</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">PI</span>: <span class="kwd">forall</span> <span class="id">i</span> <span class="id">b</span> <span class="id">ofs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cmatch</span> (<span class="id">Val.cmplu_bool</span> <span class="id">valid</span> <span class="id">c</span> (<span class="id">Vptr</span> <span class="id">b</span> <span class="id">ofs</span>) (<span class="id">Vlong</span> <span class="id">i</span>)) (<span class="id">cmp_different_blocks</span> <span class="id">c</span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">simpl</span>. <span class="tactic">destruct</span> <span class="id">Archi.ptr64</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Int64.eq</span> <span class="id">i</span> <span class="id">Int64.zero</span> &amp;&amp; (<span class="id">valid</span> <span class="id">b</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span>) || <span class="id">valid</span> <span class="id">b</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span> - 1))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">cmp_different_blocks_sound</span>. <span class="tactic">apply</span> <span class="id">cmp_different_blocks_none</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">cmp_different_blocks_none</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">cmplu_bool</span>; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;<span class="tactic">auto</span> <span class="kwd">using</span> <span class="id">cmatch_top</span>, <span class="id">cmp_different_blocks_none</span>, <span class="id">pcmp_none</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cmatch_lub_l</span>, <span class="id">cmatch_lub_r</span>, <span class="id">pcmp_sound_64</span>.<br/>
- <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">cmpl_bool</span> (<span class="id">c</span>: <span class="id">comparison</span>) (<span class="id">v</span> <span class="id">w</span>: <span class="id">aval</span>) : <span class="id">abool</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">v</span>, <span class="id">w</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">L</span> <span class="id">i1</span>, <span class="id">L</span> <span class="id">i2</span> =&gt; <span class="id">Just</span> (<span class="id">Int64.cmp</span> <span class="id">c</span> <span class="id">i1</span> <span class="id">i2</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">Btop</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">cmpl_bool_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">v</span> <span class="id">w</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">cmatch</span> (<span class="id">Val.cmpl_bool</span> <span class="id">c</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">cmpl_bool</span> <span class="id">c</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2903')">Proof.</div>
<div class="proofscript" id="proof2903">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">cmpl_bool</span>; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;<span class="tactic">auto</span> <span class="kwd">using</span> <span class="id">cmatch_top</span>.<br/>
- <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">cmpf_bool</span> (<span class="id">c</span>: <span class="id">comparison</span>) (<span class="id">v</span> <span class="id">w</span>: <span class="id">aval</span>) : <span class="id">abool</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">v</span>, <span class="id">w</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">F</span> <span class="id">f1</span>, <span class="id">F</span> <span class="id">f2</span> =&gt; <span class="id">Just</span> (<span class="id">Float.cmp</span> <span class="id">c</span> <span class="id">f1</span> <span class="id">f2</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">Btop</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">cmpf_bool_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">v</span> <span class="id">w</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">cmatch</span> (<span class="id">Val.cmpf_bool</span> <span class="id">c</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">cmpf_bool</span> <span class="id">c</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2904')">Proof.</div>
<div class="proofscript" id="proof2904">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="id">constructor</span>; <span class="id">inv</span> <span class="id">H0</span>; <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">cmpfs_bool</span> (<span class="id">c</span>: <span class="id">comparison</span>) (<span class="id">v</span> <span class="id">w</span>: <span class="id">aval</span>) : <span class="id">abool</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">v</span>, <span class="id">w</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">FS</span> <span class="id">f1</span>, <span class="id">FS</span> <span class="id">f2</span> =&gt; <span class="id">Just</span> (<span class="id">Float32.cmp</span> <span class="id">c</span> <span class="id">f1</span> <span class="id">f2</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">Btop</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">cmpfs_bool_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">v</span> <span class="id">w</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">w</span> <span class="id">y</span> -&gt; <span class="id">cmatch</span> (<span class="id">Val.cmpfs_bool</span> <span class="id">c</span> <span class="id">v</span> <span class="id">w</span>) (<span class="id">cmpfs_bool</span> <span class="id">c</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2905')">Proof.</div>
<div class="proofscript" id="proof2905">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="id">constructor</span>; <span class="id">inv</span> <span class="id">H0</span>; <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">maskzero</span> (<span class="id">x</span>: <span class="id">aval</span>) (<span class="id">mask</span>: <span class="id">int</span>) : <span class="id">abool</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">I</span> <span class="id">i</span> =&gt; <span class="id">Just</span> (<span class="id">Int.eq</span> (<span class="id">Int.and</span> <span class="id">i</span> <span class="id">mask</span>) <span class="id">Int.zero</span>)<br/>
&nbsp;&nbsp;| <span class="id">Uns</span> <span class="id">p</span> <span class="id">n</span> =&gt; <span class="kwd">if</span> <span class="id">Int.eq</span> (<span class="id">Int.zero_ext</span> <span class="id">n</span> <span class="id">mask</span>) <span class="id">Int.zero</span> <span class="kwd">then</span> <span class="id">Maybe</span> <span class="id">true</span> <span class="kwd">else</span> <span class="id">Btop</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">Btop</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">maskzero_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">mask</span> <span class="id">v</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">cmatch</span> (<span class="id">Val.maskzero_bool</span> <span class="id">v</span> <span class="id">mask</span>) (<span class="id">maskzero</span> <span class="id">x</span> <span class="id">mask</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2906')">Proof.</div>
<div class="proofscript" id="proof2906">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;<span class="id">predSpec</span> <span class="id">Int.eq</span> <span class="id">Int.eq_spec</span> (<span class="id">Int.zero_ext</span> <span class="id">n</span> <span class="id">mask</span>) <span class="id">Int.zero</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">Int.and</span> <span class="id">i</span> <span class="id">mask</span>) <span class="kwd">with</span> <span class="id">Int.zero</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Int.eq_true</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">is_uns_zero_ext</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">rewrite</span> <span class="id">Int.zero_ext_and</span> <span class="kwd">in</span> * <span class="tactic">by</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H1</span>. <span class="tactic">rewrite</span> <span class="id">Int.and_assoc</span>. <span class="tactic">rewrite</span> <span class="id">Int.and_commut</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">rewrite</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Int.and_zero</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Int.eq</span> (<span class="id">Int.zero_ext</span> <span class="id">n</span> <span class="id">mask</span>) <span class="id">Int.zero</span>); <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">of_optbool</span> (<span class="id">ab</span>: <span class="id">abool</span>) : <span class="id">aval</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">ab</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Just</span> <span class="id">b</span> =&gt; <span class="id">I</span> (<span class="kwd">if</span> <span class="id">b</span> <span class="kwd">then</span> <span class="id">Int.one</span> <span class="kwd">else</span> <span class="id">Int.zero</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">Uns</span> <span class="id">Pbot</span> 1<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">of_optbool_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ob</span> <span class="id">ab</span>, <span class="id">cmatch</span> <span class="id">ob</span> <span class="id">ab</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.of_optbool</span> <span class="id">ob</span>) (<span class="id">of_optbool</span> <span class="id">ab</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2907')">Proof.</div>
<div class="proofscript" id="proof2907">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">DEFAULT</span>: <span class="id">vmatch</span> (<span class="id">Val.of_optbool</span> <span class="id">ob</span>) (<span class="id">Uns</span> <span class="id">Pbot</span> 1)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">ob</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">b</span>; <span class="id">constructor</span>; <span class="tactic">try</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> 1 <span class="kwd">with</span> (<span class="id">usize</span> <span class="id">Int.one</span>). <span class="tactic">apply</span> <span class="id">is_uns_usize</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">Int.bits_zero</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span>. <span class="tactic">simpl</span>. <span class="tactic">destruct</span> <span class="id">b</span>; <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">resolve_branch</span> (<span class="id">ab</span>: <span class="id">abool</span>) : <span class="id">option</span> <span class="id">bool</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">ab</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Just</span> <span class="id">b</span> =&gt; <span class="id">Some</span> <span class="id">b</span><br/>
&nbsp;&nbsp;| <span class="id">Maybe</span> <span class="id">b</span> =&gt; <span class="id">Some</span> <span class="id">b</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">resolve_branch_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">ab</span> <span class="id">b</span>',<br/>
&nbsp;&nbsp;<span class="id">cmatch</span> (<span class="id">Some</span> <span class="id">b</span>) <span class="id">ab</span> -&gt; <span class="id">resolve_branch</span> <span class="id">ab</span> = <span class="id">Some</span> <span class="id">b</span>' -&gt; <span class="id">b</span>' = <span class="id">b</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2908')">Proof.</div>
<div class="proofscript" id="proof2908">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Normalization at load time </div>
<br/>
<span class="kwd">Definition</span> <span class="id">vnormalize</span> (<span class="id">chunk</span>: <span class="id">memory_chunk</span>) (<span class="id">v</span>: <span class="id">aval</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">chunk</span>, <span class="id">v</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">Vbot</span> =&gt; <span class="id">Vbot</span><br/>
&nbsp;&nbsp;| <span class="id">Mint8signed</span>, <span class="id">I</span> <span class="id">i</span> =&gt; <span class="id">I</span> (<span class="id">Int.sign_ext</span> 8 <span class="id">i</span>)<br/>
&nbsp;&nbsp;| <span class="id">Mint8signed</span>, <span class="id">Uns</span> <span class="id">p</span> <span class="id">n</span> =&gt; <span class="kwd">if</span> <span class="id">zlt</span> <span class="id">n</span> 8 <span class="kwd">then</span> <span class="id">Uns</span> (<span class="id">provenance</span> <span class="id">v</span>) <span class="id">n</span> <span class="kwd">else</span> <span class="id">Sgn</span> (<span class="id">provenance</span> <span class="id">v</span>) 8<br/>
&nbsp;&nbsp;| <span class="id">Mint8signed</span>, <span class="id">Sgn</span> <span class="id">p</span> <span class="id">n</span> =&gt; <span class="id">Sgn</span> (<span class="id">provenance</span> <span class="id">v</span>) (<span class="id">Z.min</span> <span class="id">n</span> 8)<br/>
&nbsp;&nbsp;| <span class="id">Mint8signed</span>, <span class="id">_</span> =&gt; <span class="id">Sgn</span> (<span class="id">provenance</span> <span class="id">v</span>) 8<br/>
&nbsp;&nbsp;| <span class="id">Mint8unsigned</span>, <span class="id">I</span> <span class="id">i</span> =&gt; <span class="id">I</span> (<span class="id">Int.zero_ext</span> 8 <span class="id">i</span>)<br/>
&nbsp;&nbsp;| <span class="id">Mint8unsigned</span>, <span class="id">Uns</span> <span class="id">p</span> <span class="id">n</span> =&gt; <span class="id">Uns</span> (<span class="id">provenance</span> <span class="id">v</span>) (<span class="id">Z.min</span> <span class="id">n</span> 8)<br/>
&nbsp;&nbsp;| <span class="id">Mint8unsigned</span>, <span class="id">_</span> =&gt; <span class="id">Uns</span> (<span class="id">provenance</span> <span class="id">v</span>) 8<br/>
&nbsp;&nbsp;| <span class="id">Mint16signed</span>, <span class="id">I</span> <span class="id">i</span> =&gt; <span class="id">I</span> (<span class="id">Int.sign_ext</span> 16 <span class="id">i</span>)<br/>
&nbsp;&nbsp;| <span class="id">Mint16signed</span>, <span class="id">Uns</span> <span class="id">p</span> <span class="id">n</span> =&gt; <span class="kwd">if</span> <span class="id">zlt</span> <span class="id">n</span> 16 <span class="kwd">then</span> <span class="id">Uns</span> (<span class="id">provenance</span> <span class="id">v</span>) <span class="id">n</span> <span class="kwd">else</span> <span class="id">Sgn</span> (<span class="id">provenance</span> <span class="id">v</span>) 16<br/>
&nbsp;&nbsp;| <span class="id">Mint16signed</span>, <span class="id">Sgn</span> <span class="id">p</span> <span class="id">n</span> =&gt; <span class="id">Sgn</span> (<span class="id">provenance</span> <span class="id">v</span>) (<span class="id">Z.min</span> <span class="id">n</span> 16)<br/>
&nbsp;&nbsp;| <span class="id">Mint16signed</span>, <span class="id">_</span> =&gt; <span class="id">Sgn</span> (<span class="id">provenance</span> <span class="id">v</span>) 16<br/>
&nbsp;&nbsp;| <span class="id">Mint16unsigned</span>, <span class="id">I</span> <span class="id">i</span> =&gt; <span class="id">I</span> (<span class="id">Int.zero_ext</span> 16 <span class="id">i</span>)<br/>
&nbsp;&nbsp;| <span class="id">Mint16unsigned</span>, <span class="id">Uns</span> <span class="id">p</span> <span class="id">n</span> =&gt; <span class="id">Uns</span> (<span class="id">provenance</span> <span class="id">v</span>) (<span class="id">Z.min</span> <span class="id">n</span> 16)<br/>
&nbsp;&nbsp;| <span class="id">Mint16unsigned</span>, <span class="id">_</span> =&gt; <span class="id">Uns</span> (<span class="id">provenance</span> <span class="id">v</span>) 16<br/>
&nbsp;&nbsp;| <span class="id">Mint32</span>, (<span class="id">I</span> <span class="id">_</span> | <span class="id">Uns</span> <span class="id">_</span> <span class="id">_</span> | <span class="id">Sgn</span> <span class="id">_</span> <span class="id">_</span> | <span class="id">Ifptr</span> <span class="id">_</span>) =&gt; <span class="id">v</span><br/>
&nbsp;&nbsp;| <span class="id">Mint32</span>, <span class="id">Ptr</span> <span class="id">p</span> =&gt; <span class="kwd">if</span> <span class="id">Archi.ptr64</span> <span class="kwd">then</span> <span class="id">Ifptr</span> <span class="id">p</span> <span class="kwd">else</span> <span class="id">v</span><br/>
&nbsp;&nbsp;| <span class="id">Mint64</span>, (<span class="id">L</span> <span class="id">_</span> | <span class="id">Ifptr</span> <span class="id">_</span>) =&gt; <span class="id">v</span><br/>
&nbsp;&nbsp;| <span class="id">Mint64</span>, (<span class="id">Uns</span> <span class="id">p</span> <span class="id">_</span> | <span class="id">Sgn</span> <span class="id">p</span> <span class="id">_</span>) =&gt; <span class="id">Ifptr</span> <span class="id">p</span><br/>
&nbsp;&nbsp;| <span class="id">Mint64</span>, <span class="id">Ptr</span> <span class="id">p</span> =&gt; <span class="kwd">if</span> <span class="id">Archi.ptr64</span> <span class="kwd">then</span> <span class="id">v</span> <span class="kwd">else</span> <span class="id">Ifptr</span> <span class="id">p</span><br/>
&nbsp;&nbsp;| <span class="id">Mfloat32</span>, <span class="id">FS</span> <span class="id">f</span> =&gt; <span class="id">v</span><br/>
&nbsp;&nbsp;| <span class="id">Mfloat64</span>, <span class="id">F</span> <span class="id">f</span> =&gt; <span class="id">v</span><br/>
&nbsp;&nbsp;| <span class="id">Many32</span>, (<span class="id">I</span> <span class="id">_</span> | <span class="id">Uns</span> <span class="id">_</span> <span class="id">_</span> | <span class="id">Sgn</span> <span class="id">_</span> <span class="id">_</span> | <span class="id">FS</span> <span class="id">_</span> | <span class="id">Ifptr</span> <span class="id">_</span>) =&gt; <span class="id">v</span><br/>
&nbsp;&nbsp;| <span class="id">Many32</span>, <span class="id">Ptr</span> <span class="id">p</span> =&gt; <span class="kwd">if</span> <span class="id">Archi.ptr64</span> <span class="kwd">then</span> <span class="id">Ifptr</span> <span class="id">p</span> <span class="kwd">else</span> <span class="id">v</span><br/>
&nbsp;&nbsp;| <span class="id">Many64</span>, <span class="id">_</span> =&gt; <span class="id">v</span><br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">Ifptr</span> (<span class="id">provenance</span> <span class="id">v</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">vnormalize_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">chunk</span> <span class="id">v</span> <span class="id">x</span>, <span class="id">vmatch</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> (<span class="id">Val.load_result</span> <span class="id">chunk</span> <span class="id">v</span>) (<span class="id">vnormalize</span> <span class="id">chunk</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2909')">Proof.</div>
<div class="proofscript" id="proof2909">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Val.load_result</span>, <span class="id">vnormalize</span>; <span class="tactic">generalize</span> <span class="id">Archi.ptr64</span>; <span class="tactic">intros</span> <span class="id">ptr64</span>;<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">destruct</span> <span class="id">chunk</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">n</span> 8); <span class="id">constructor</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">is_sign_ext_uns</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">is_sign_ext_sgn</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="id">constructor</span>. <span class="id">xomega</span>. <span class="tactic">apply</span> <span class="id">is_zero_ext_uns</span>. <span class="tactic">apply</span> <span class="id">Z.min_case</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">n</span> 16); <span class="id">constructor</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">is_sign_ext_uns</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">is_sign_ext_sgn</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="id">constructor</span>. <span class="id">xomega</span>. <span class="tactic">apply</span> <span class="id">is_zero_ext_uns</span>. <span class="tactic">apply</span> <span class="id">Z.min_case</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">n</span> 8); <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">n</span> 16); <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="id">constructor</span>. <span class="id">xomega</span>. <span class="tactic">apply</span> <span class="id">is_sign_ext_sgn</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>. <span class="tactic">apply</span> <span class="id">Z.min_case</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="id">constructor</span>. <span class="tactic">omega</span>. <span class="tactic">apply</span> <span class="id">is_zero_ext_uns</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="id">constructor</span>. <span class="id">xomega</span>. <span class="tactic">apply</span> <span class="id">is_sign_ext_sgn</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>. <span class="tactic">apply</span> <span class="id">Z.min_case</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="id">constructor</span>. <span class="tactic">omega</span>. <span class="tactic">apply</span> <span class="id">is_zero_ext_uns</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">ptr64</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">ptr64</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">ptr64</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">ptr64</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">ptr64</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">ptr64</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="id">constructor</span>. <span class="tactic">omega</span>. <span class="tactic">apply</span> <span class="id">is_sign_ext_sgn</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="id">constructor</span>. <span class="tactic">omega</span>. <span class="tactic">apply</span> <span class="id">is_zero_ext_uns</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="id">constructor</span>. <span class="tactic">omega</span>. <span class="tactic">apply</span> <span class="id">is_sign_ext_sgn</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="id">constructor</span>. <span class="tactic">omega</span>. <span class="tactic">apply</span> <span class="id">is_zero_ext_uns</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">ptr64</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">ptr64</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">ptr64</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">vnormalize_cast</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">chunk</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span> <span class="id">p</span>,<br/>
&nbsp;&nbsp;<span class="id">Mem.load</span> <span class="id">chunk</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> = <span class="id">Some</span> <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> <span class="id">v</span> (<span class="id">Ifptr</span> <span class="id">p</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> <span class="id">v</span> (<span class="id">vnormalize</span> <span class="id">chunk</span> (<span class="id">Ifptr</span> <span class="id">p</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2910')">Proof.</div>
<div class="proofscript" id="proof2910">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id">Mem.load_cast</span>; <span class="tactic">eauto</span>. <span class="id">exploit</span> <span class="id">Mem.load_type</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">chunk</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
- <span class="comment">(*&nbsp;int8signed&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span>. <span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">simpl</span>; <span class="id">constructor</span>. <span class="tactic">omega</span>. <span class="tactic">apply</span> <span class="id">is_sign_ext_sgn</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="comment">(*&nbsp;int8unsigned&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span>. <span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">simpl</span>; <span class="id">constructor</span>. <span class="tactic">omega</span>. <span class="tactic">apply</span> <span class="id">is_zero_ext_uns</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="comment">(*&nbsp;int16signed&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span>. <span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">simpl</span>; <span class="id">constructor</span>. <span class="tactic">omega</span>. <span class="tactic">apply</span> <span class="id">is_sign_ext_sgn</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="comment">(*&nbsp;int16unsigned&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span>. <span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">simpl</span>; <span class="id">constructor</span>. <span class="tactic">omega</span>. <span class="tactic">apply</span> <span class="id">is_zero_ext_uns</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="comment">(*&nbsp;int32&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
- <span class="comment">(*&nbsp;int64&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
- <span class="comment">(*&nbsp;float32&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">try</span> <span class="id">contradiction</span>; <span class="id">constructor</span>.<br/>
- <span class="comment">(*&nbsp;float64&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">try</span> <span class="id">contradiction</span>; <span class="id">constructor</span>.<br/>
- <span class="comment">(*&nbsp;any32&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Archi.ptr64</span>; <span class="tactic">auto</span>.<br/>
- <span class="comment">(*&nbsp;any64&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id">poffset_monotone</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">p</span> <span class="id">q</span>, <span class="id">pge</span> <span class="id">p</span> <span class="id">q</span> -&gt; <span class="id">pge</span> (<span class="id">poffset</span> <span class="id">p</span>) (<span class="id">poffset</span> <span class="id">q</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2911')">Proof.</div>
<div class="proofscript" id="proof2911">
&nbsp;&nbsp;<span class="tactic">destruct</span> 1; <span class="tactic">simpl</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id">provenance_monotone</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">vge</span> <span class="id">x</span> <span class="id">y</span> -&gt; <span class="id">pge</span> (<span class="id">provenance</span> <span class="id">x</span>) (<span class="id">provenance</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2912')">Proof.</div>
<div class="proofscript" id="proof2912">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">provenance</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> (<span class="id">va_strict</span> <span class="id">tt</span>). <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id">poffset_monotone</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">vnormalize_monotone</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">chunk</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;<span class="id">vge</span> <span class="id">x</span> <span class="id">y</span> -&gt; <span class="id">vge</span> (<span class="id">vnormalize</span> <span class="id">chunk</span> <span class="id">x</span>) (<span class="id">vnormalize</span> <span class="id">chunk</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2913')">Proof with</div>
<div class="proofscript" id="proof2913">
 (<span class="tactic">auto</span> <span class="kwd">using</span> <span class="id">provenance_monotone</span> <span class="kwd">with</span> <span class="id">va</span>).<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">chunk</span> <span class="id">x</span> <span class="id">y</span> <span class="id">V</span>; <span class="tactic">unfold</span> <span class="id">vnormalize</span>; <span class="tactic">generalize</span> <span class="id">Archi.ptr64</span>; <span class="tactic">intro</span> <span class="id">ptr64</span>; <span class="tactic">inversion</span> <span class="id">V</span>; <span class="tactic">subst</span>; <span class="tactic">destruct</span> <span class="id">chunk</span> <span class="id">eqn</span>:<span class="id">C</span>; <span class="tactic">simpl</span>...<br/>
- <span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">n</span> 8); <span class="id">constructor</span>...<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">is_sign_ext_uns</span>...<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">is_sign_ext_sgn</span>...<br/>
- <span class="id">constructor</span>... <span class="tactic">apply</span> <span class="id">is_zero_ext_uns</span>... <span class="tactic">apply</span> <span class="id">Z.min_case</span>...<br/>
- <span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">n</span> 16); <span class="id">constructor</span>...<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">is_sign_ext_uns</span>...<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">is_sign_ext_sgn</span>...<br/>
- <span class="id">constructor</span>... <span class="tactic">apply</span> <span class="id">is_zero_ext_uns</span>... <span class="tactic">apply</span> <span class="id">Z.min_case</span>...<br/>
- <span class="tactic">unfold</span> <span class="id">provenance</span>; <span class="tactic">destruct</span> (<span class="id">va_strict</span> <span class="id">tt</span>)...<br/>
- <span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">n1</span> 8). <span class="tactic">rewrite</span> <span class="id">zlt_true</span> <span class="tactic">by</span> <span class="tactic">omega</span>...<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">n2</span> 8)...<br/>
- <span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">n1</span> 16). <span class="tactic">rewrite</span> <span class="id">zlt_true</span> <span class="tactic">by</span> <span class="tactic">omega</span>...<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">n2</span> 16)...<br/>
- <span class="id">constructor</span>... <span class="tactic">apply</span> <span class="id">is_sign_ext_sgn</span>... <span class="tactic">apply</span> <span class="id">Z.min_case</span>...<br/>
- <span class="id">constructor</span>... <span class="tactic">apply</span> <span class="id">is_zero_ext_uns</span>...<br/>
- <span class="id">constructor</span>... <span class="tactic">apply</span> <span class="id">is_sign_ext_sgn</span>... <span class="tactic">apply</span> <span class="id">Z.min_case</span>...<br/>
- <span class="id">constructor</span>... <span class="tactic">apply</span> <span class="id">is_zero_ext_uns</span>...<br/>
- <span class="tactic">unfold</span> <span class="id">provenance</span>; <span class="tactic">destruct</span> (<span class="id">va_strict</span> <span class="id">tt</span>)...<br/>
- <span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">n2</span> 8); <span class="id">constructor</span>...<br/>
- <span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">n2</span> 16); <span class="id">constructor</span>...<br/>
- <span class="tactic">destruct</span> <span class="id">ptr64</span>...<br/>
- <span class="tactic">destruct</span> <span class="id">ptr64</span>...<br/>
- <span class="tactic">destruct</span> <span class="id">ptr64</span>... <br/>
- <span class="tactic">destruct</span> <span class="id">ptr64</span>...<br/>
- <span class="tactic">destruct</span> <span class="id">ptr64</span>...<br/>
- <span class="tactic">destruct</span> <span class="id">ptr64</span>...<br/>
- <span class="id">constructor</span>... <span class="tactic">apply</span> <span class="id">is_sign_ext_sgn</span>...<br/>
- <span class="id">constructor</span>... <span class="tactic">apply</span> <span class="id">is_zero_ext_uns</span>...<br/>
- <span class="id">constructor</span>... <span class="tactic">apply</span> <span class="id">is_sign_ext_sgn</span>...<br/>
- <span class="id">constructor</span>... <span class="tactic">apply</span> <span class="id">is_zero_ext_uns</span>...<br/>
- <span class="tactic">unfold</span> <span class="id">provenance</span>; <span class="tactic">destruct</span> (<span class="id">va_strict</span> <span class="id">tt</span>)...<br/>
- <span class="tactic">unfold</span> <span class="id">provenance</span>; <span class="tactic">destruct</span> (<span class="id">va_strict</span> <span class="id">tt</span>)...<br/>
- <span class="tactic">unfold</span> <span class="id">provenance</span>; <span class="tactic">destruct</span> (<span class="id">va_strict</span> <span class="id">tt</span>)...<br/>
- <span class="tactic">unfold</span> <span class="id">provenance</span>; <span class="tactic">destruct</span> (<span class="id">va_strict</span> <span class="id">tt</span>)...<br/>
- <span class="tactic">unfold</span> <span class="id">provenance</span>; <span class="tactic">destruct</span> (<span class="id">va_strict</span> <span class="id">tt</span>)...<br/>
- <span class="tactic">unfold</span> <span class="id">provenance</span>; <span class="tactic">destruct</span> (<span class="id">va_strict</span> <span class="id">tt</span>)...<br/>
- <span class="tactic">unfold</span> <span class="id">provenance</span>; <span class="tactic">destruct</span> (<span class="id">va_strict</span> <span class="id">tt</span>)...<br/>
- <span class="tactic">unfold</span> <span class="id">provenance</span>; <span class="tactic">destruct</span> (<span class="id">va_strict</span> <span class="id">tt</span>)...<br/>
- <span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">n</span> 8)...<br/>
- <span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">n</span> 16)...<br/>
Qed.</div>
<br/>
<div class="doc">Abstracting memory blocks </div>
<br/>
<span class="kwd">Inductive</span> <span class="id">acontent</span> : <span class="kwd">Type</span> :=<br/>
&nbsp;| <span class="id">ACval</span> (<span class="id">chunk</span>: <span class="id">memory_chunk</span>) (<span class="id">av</span>: <span class="id">aval</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">eq_acontent</span> : <span class="kwd">forall</span> (<span class="id">c1</span> <span class="id">c2</span>: <span class="id">acontent</span>), {<span class="id">c1</span>=<span class="id">c2</span>} + {<span class="id">c1</span>&lt;&gt;<span class="id">c2</span>}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2914')">Proof.</div>
<div class="proofscript" id="proof2914">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">generalize</span> <span class="id">chunk_eq</span> <span class="id">eq_aval</span>. <span class="id">decide</span> <span class="id">equality</span>.<br/>
Defined.</div>
<br/>
<span class="kwd">Record</span> <span class="id">ablock</span> : <span class="kwd">Type</span> := <span class="id">ABlock</span> {<br/>
&nbsp;&nbsp;<span class="id">ab_contents</span>: <span class="id">ZTree.t</span> <span class="id">acontent</span>;<br/>
&nbsp;&nbsp;<span class="id">ab_summary</span>: <span class="id">aptr</span><br/>
}.<br/>
<br/>
<span class="kwd">Local</span> <span class="kwd">Notation</span> "<span class="id">a</span> ## <span class="id">b</span>" := (<span class="id">ZTree.get</span> <span class="id">b</span> <span class="id">a</span>) (<span class="tactic">at</span> <span class="id">level</span> 1).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">ablock_init</span> (<span class="id">p</span>: <span class="id">aptr</span>) : <span class="id">ablock</span> :=<br/>
&nbsp;&nbsp;{| <span class="id">ab_contents</span> := <span class="id">ZTree.empty</span> <span class="id">_</span>; <span class="id">ab_summary</span> := <span class="id">p</span> |}.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">chunk_compat</span> (<span class="id">chunk</span> <span class="id">chunk</span>': <span class="id">memory_chunk</span>) : <span class="id">bool</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">chunk</span>, <span class="id">chunk</span>' <span class="kwd">with</span><br/>
&nbsp;&nbsp;| (<span class="id">Mint8signed</span> | <span class="id">Mint8unsigned</span>), (<span class="id">Mint8signed</span> | <span class="id">Mint8unsigned</span>) =&gt; <span class="id">true</span><br/>
&nbsp;&nbsp;| (<span class="id">Mint16signed</span> | <span class="id">Mint16unsigned</span>), (<span class="id">Mint16signed</span> | <span class="id">Mint16unsigned</span>) =&gt; <span class="id">true</span><br/>
&nbsp;&nbsp;| <span class="id">Mint32</span>, <span class="id">Mint32</span> =&gt; <span class="id">true</span><br/>
&nbsp;&nbsp;| <span class="id">Mfloat32</span>, <span class="id">Mfloat32</span> =&gt; <span class="id">true</span><br/>
&nbsp;&nbsp;| <span class="id">Mint64</span>, <span class="id">Mint64</span> =&gt; <span class="id">true</span><br/>
&nbsp;&nbsp;| <span class="id">Mfloat64</span>, <span class="id">Mfloat64</span> =&gt; <span class="id">true</span><br/>
&nbsp;&nbsp;| <span class="id">Many32</span>, <span class="id">Many32</span> =&gt; <span class="id">true</span><br/>
&nbsp;&nbsp;| <span class="id">Many64</span>, <span class="id">Many64</span> =&gt; <span class="id">true</span><br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">false</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">ablock_load</span> (<span class="id">chunk</span>: <span class="id">memory_chunk</span>) (<span class="id">ab</span>: <span class="id">ablock</span>) (<span class="id">i</span>: <span class="id">Z</span>) : <span class="id">aval</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">ab</span>.(<span class="id">ab_contents</span>)##<span class="id">i</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">vnormalize</span> <span class="id">chunk</span> (<span class="id">Ifptr</span> <span class="id">ab</span>.(<span class="id">ab_summary</span>))<br/>
&nbsp;&nbsp;| <span class="id">Some</span> (<span class="id">ACval</span> <span class="id">chunk</span>' <span class="id">av</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">chunk_compat</span> <span class="id">chunk</span> <span class="id">chunk</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id">vnormalize</span> <span class="id">chunk</span> <span class="id">av</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">vnormalize</span> <span class="id">chunk</span> (<span class="id">Ifptr</span> <span class="id">ab</span>.(<span class="id">ab_summary</span>))<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">ablock_load_anywhere</span> (<span class="id">chunk</span>: <span class="id">memory_chunk</span>) (<span class="id">ab</span>: <span class="id">ablock</span>) : <span class="id">aval</span> :=<br/>
&nbsp;&nbsp;<span class="id">vnormalize</span> <span class="id">chunk</span> (<span class="id">Ifptr</span> <span class="id">ab</span>.(<span class="id">ab_summary</span>)).<br/>
<br/>
<span class="id">Function</span> <span class="id">inval_after</span> (<span class="id">lo</span>: <span class="id">Z</span>) (<span class="id">hi</span>: <span class="id">Z</span>) (<span class="id">c</span>: <span class="id">ZTree.t</span> <span class="id">acontent</span>) { <span class="kwd">wf</span> (<span class="id">Zwf</span> <span class="id">lo</span>) <span class="id">hi</span> } : <span class="id">ZTree.t</span> <span class="id">acontent</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">zle</span> <span class="id">lo</span> <span class="id">hi</span><br/>
&nbsp;&nbsp;<span class="kwd">then</span> <span class="id">inval_after</span> <span class="id">lo</span> (<span class="id">hi</span> - 1) (<span class="id">ZTree.remove</span> <span class="id">hi</span> <span class="id">c</span>)<br/>
&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">c</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2915')">Proof.</div>
<div class="proofscript" id="proof2915">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Zwf_well_founded</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">inval_if</span> (<span class="id">hi</span>: <span class="id">Z</span>) (<span class="id">lo</span>: <span class="id">Z</span>) (<span class="id">c</span>: <span class="id">ZTree.t</span> <span class="id">acontent</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">c</span>##<span class="id">lo</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">c</span><br/>
&nbsp;&nbsp;| <span class="id">Some</span> (<span class="id">ACval</span> <span class="id">chunk</span> <span class="id">av</span>) =&gt; <span class="kwd">if</span> <span class="id">zle</span> (<span class="id">lo</span> + <span class="id">size_chunk</span> <span class="id">chunk</span>) <span class="id">hi</span> <span class="kwd">then</span> <span class="id">c</span> <span class="kwd">else</span> <span class="id">ZTree.remove</span> <span class="id">lo</span> <span class="id">c</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="id">Function</span> <span class="id">inval_before</span> (<span class="id">hi</span>: <span class="id">Z</span>) (<span class="id">lo</span>: <span class="id">Z</span>) (<span class="id">c</span>: <span class="id">ZTree.t</span> <span class="id">acontent</span>) { <span class="kwd">wf</span> (<span class="id">Zwf_up</span> <span class="id">hi</span>) <span class="id">lo</span> } : <span class="id">ZTree.t</span> <span class="id">acontent</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">zlt</span> <span class="id">lo</span> <span class="id">hi</span><br/>
&nbsp;&nbsp;<span class="kwd">then</span> <span class="id">inval_before</span> <span class="id">hi</span> (<span class="id">lo</span> + 1) (<span class="id">inval_if</span> <span class="id">hi</span> <span class="id">lo</span> <span class="id">c</span>)<br/>
&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">c</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2916')">Proof.</div>
<div class="proofscript" id="proof2916">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Zwf_up_well_founded</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">ablock_store</span> (<span class="id">chunk</span>: <span class="id">memory_chunk</span>) (<span class="id">ab</span>: <span class="id">ablock</span>) (<span class="id">i</span>: <span class="id">Z</span>) (<span class="id">av</span>: <span class="id">aval</span>) : <span class="id">ablock</span> :=<br/>
&nbsp;&nbsp;{| <span class="id">ab_contents</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ZTree.set</span> <span class="id">i</span> (<span class="id">ACval</span> <span class="id">chunk</span> <span class="id">av</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">inval_before</span> <span class="id">i</span> (<span class="id">i</span> - 7)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">inval_after</span> (<span class="id">i</span> + 1) (<span class="id">i</span> + <span class="id">size_chunk</span> <span class="id">chunk</span> - 1) <span class="id">ab</span>.(<span class="id">ab_contents</span>)));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ab_summary</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">vplub</span> <span class="id">av</span> <span class="id">ab</span>.(<span class="id">ab_summary</span>) |}.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">ablock_store_anywhere</span> (<span class="id">chunk</span>: <span class="id">memory_chunk</span>) (<span class="id">ab</span>: <span class="id">ablock</span>) (<span class="id">av</span>: <span class="id">aval</span>) : <span class="id">ablock</span> :=<br/>
&nbsp;&nbsp;<span class="id">ablock_init</span> (<span class="id">vplub</span> <span class="id">av</span> <span class="id">ab</span>.(<span class="id">ab_summary</span>)).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">ablock_loadbytes</span> (<span class="id">ab</span>: <span class="id">ablock</span>) : <span class="id">aptr</span> := <span class="id">ab</span>.(<span class="id">ab_summary</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">ablock_storebytes</span> (<span class="id">ab</span>: <span class="id">ablock</span>) (<span class="id">p</span>: <span class="id">aptr</span>) (<span class="id">ofs</span>: <span class="id">Z</span>) (<span class="id">sz</span>: <span class="id">Z</span>) :=<br/>
&nbsp;&nbsp;{| <span class="id">ab_contents</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inval_before</span> <span class="id">ofs</span> (<span class="id">ofs</span> - 7)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">inval_after</span> <span class="id">ofs</span> (<span class="id">ofs</span> + <span class="id">sz</span> - 1) <span class="id">ab</span>.(<span class="id">ab_contents</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ab_summary</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">plub</span> <span class="id">p</span> <span class="id">ab</span>.(<span class="id">ab_summary</span>) |}.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">ablock_storebytes_anywhere</span> (<span class="id">ab</span>: <span class="id">ablock</span>) (<span class="id">p</span>: <span class="id">aptr</span>) :=<br/>
&nbsp;&nbsp;<span class="id">ablock_init</span> (<span class="id">plub</span> <span class="id">p</span> <span class="id">ab</span>.(<span class="id">ab_summary</span>)).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">smatch</span> (<span class="id">m</span>: <span class="id">mem</span>) (<span class="id">b</span>: <span class="id">block</span>) (<span class="id">p</span>: <span class="id">aptr</span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">chunk</span> <span class="id">ofs</span> <span class="id">v</span>, <span class="id">Mem.load</span> <span class="id">chunk</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> = <span class="id">Some</span> <span class="id">v</span> -&gt; <span class="id">vmatch</span> <span class="id">v</span> (<span class="id">Ifptr</span> <span class="id">p</span>))<br/>
/\(<span class="kwd">forall</span> <span class="id">ofs</span> <span class="id">b</span>' <span class="id">ofs</span>' <span class="id">q</span> <span class="id">i</span>, <span class="id">Mem.loadbytes</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> 1 = <span class="id">Some</span> (<span class="id">Fragment</span> (<span class="id">Vptr</span> <span class="id">b</span>' <span class="id">ofs</span>') <span class="id">q</span> <span class="id">i</span> :: <span class="id">nil</span>) -&gt; <span class="id">pmatch</span> <span class="id">b</span>' <span class="id">ofs</span>' <span class="id">p</span>).<br/>
<br/>
<span class="kwd">Remark</span> <span class="id">loadbytes_load_ext</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">m</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">ofs</span> <span class="id">n</span> <span class="id">bytes</span>, <span class="id">Mem.loadbytes</span> <span class="id">m</span>' <span class="id">b</span> <span class="id">ofs</span> <span class="id">n</span> = <span class="id">Some</span> <span class="id">bytes</span> -&gt; <span class="id">n</span> &gt;= 0 -&gt; <span class="id">Mem.loadbytes</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">n</span> = <span class="id">Some</span> <span class="id">bytes</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">chunk</span> <span class="id">ofs</span> <span class="id">v</span>, <span class="id">Mem.load</span> <span class="id">chunk</span> <span class="id">m</span>' <span class="id">b</span> <span class="id">ofs</span> = <span class="id">Some</span> <span class="id">v</span> -&gt; <span class="id">Mem.load</span> <span class="id">chunk</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> = <span class="id">Some</span> <span class="id">v</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2917')">Proof.</div>
<div class="proofscript" id="proof2917">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id">Mem.load_loadbytes</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">bytes</span> [<span class="id">A</span> <span class="id">B</span>]].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Mem.load_valid_access</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">C</span> <span class="id">D</span>].<br/>
&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">v</span>. <span class="tactic">apply</span> <span class="id">Mem.loadbytes_load</span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">H</span>; <span class="tactic">auto</span>. <span class="tactic">generalize</span> (<span class="id">size_chunk_pos</span> <span class="id">chunk</span>); <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">smatch_ext</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">b</span> <span class="id">p</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;<span class="id">smatch</span> <span class="id">m</span> <span class="id">b</span> <span class="id">p</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">ofs</span> <span class="id">n</span> <span class="id">bytes</span>, <span class="id">Mem.loadbytes</span> <span class="id">m</span>' <span class="id">b</span> <span class="id">ofs</span> <span class="id">n</span> = <span class="id">Some</span> <span class="id">bytes</span> -&gt; <span class="id">n</span> &gt;= 0 -&gt; <span class="id">Mem.loadbytes</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">n</span> = <span class="id">Some</span> <span class="id">bytes</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">smatch</span> <span class="id">m</span>' <span class="id">b</span> <span class="id">p</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2918')">Proof.</div>
<div class="proofscript" id="proof2918">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H</span>. <span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">loadbytes_load_ext</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H1</span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">H0</span>; <span class="tactic">eauto</span>. <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">smatch_inv</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">b</span> <span class="id">p</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;<span class="id">smatch</span> <span class="id">m</span> <span class="id">b</span> <span class="id">p</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">ofs</span> <span class="id">n</span>, <span class="id">n</span> &gt;= 0 -&gt; <span class="id">Mem.loadbytes</span> <span class="id">m</span>' <span class="id">b</span> <span class="id">ofs</span> <span class="id">n</span> = <span class="id">Mem.loadbytes</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">n</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">smatch</span> <span class="id">m</span>' <span class="id">b</span> <span class="id">p</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2919')">Proof.</div>
<div class="proofscript" id="proof2919">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id">smatch_ext</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">smatch_ge</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">b</span> <span class="id">p</span> <span class="id">q</span>, <span class="id">smatch</span> <span class="id">m</span> <span class="id">b</span> <span class="id">p</span> -&gt; <span class="id">pge</span> <span class="id">q</span> <span class="id">p</span> -&gt; <span class="id">smatch</span> <span class="id">m</span> <span class="id">b</span> <span class="id">q</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2920')">Proof.</div>
<div class="proofscript" id="proof2920">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">A</span> <span class="id">B</span>]. <span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">vmatch_ge</span> <span class="kwd">with</span> (<span class="id">Ifptr</span> <span class="id">p</span>); <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">pmatch_ge</span> <span class="kwd">with</span> <span class="id">p</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">In_loadbytes</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">b</span> <span class="id">byte</span> <span class="id">n</span> <span class="id">ofs</span> <span class="id">bytes</span>,<br/>
&nbsp;&nbsp;<span class="id">Mem.loadbytes</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">n</span> = <span class="id">Some</span> <span class="id">bytes</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">In</span> <span class="id">byte</span> <span class="id">bytes</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">ofs</span>', <span class="id">ofs</span> &lt;= <span class="id">ofs</span>' &lt; <span class="id">ofs</span> + <span class="id">n</span> /\ <span class="id">Mem.loadbytes</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span>' 1 = <span class="id">Some</span>(<span class="id">byte</span> :: <span class="id">nil</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2921')">Proof.</div>
<div class="proofscript" id="proof2921">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">n</span>. <span class="tactic">pattern</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">well_founded_ind</span> <span class="kwd">with</span> (<span class="id">R</span> := <span class="id">Zwf</span> 0).<br/>
- <span class="tactic">apply</span> <span class="id">Zwf_well_founded</span>.<br/>
- <span class="tactic">intros</span> <span class="id">sz</span> <span class="id">REC</span> <span class="id">ofs</span> <span class="id">bytes</span> <span class="id">LOAD</span> <span class="id">IN</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zle</span> <span class="id">sz</span> 0).<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> (<span class="id">Mem.loadbytes_empty</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">sz</span>) <span class="kwd">in</span> <span class="id">LOAD</span> <span class="tactic">by</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">LOAD</span>. <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;+ <span class="id">exploit</span> (<span class="id">Mem.loadbytes_split</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> 1 (<span class="id">sz</span> - 1) <span class="id">bytes</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (1 + (<span class="id">sz</span> - 1)) <span class="kwd">with</span> <span class="id">sz</span> <span class="tactic">by</span> <span class="tactic">omega</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">bytes1</span> &amp; <span class="id">bytes2</span> &amp; <span class="id">LOAD1</span> &amp; <span class="id">LOAD2</span> &amp; <span class="id">CONCAT</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">bytes</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Mem.loadbytes_length</span>. <span class="id">eexact</span> <span class="id">LOAD1</span>. <span class="id">change</span> (<span class="id">nat_of_Z</span> 1) <span class="kwd">with</span> 1%<span class="id">nat</span>. <span class="tactic">intros</span> <span class="id">LENGTH1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">in_app_iff</span> <span class="kwd">in</span> <span class="id">IN</span>. <span class="tactic">destruct</span> <span class="id">IN</span>.<br/>
&nbsp;&nbsp;* <span class="tactic">destruct</span> <span class="id">bytes1</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>. <span class="tactic">destruct</span> <span class="id">bytes1</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="id">contradiction</span>. <span class="tactic">subst</span> <span class="id">m0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">ofs</span>; <span class="tactic">split</span>. <span class="tactic">omega</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;* <span class="id">exploit</span> (<span class="id">REC</span> (<span class="id">sz</span> - 1)). <span class="tactic">red</span>; <span class="tactic">omega</span>. <span class="id">eexact</span> <span class="id">LOAD2</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">ofs</span>' &amp; <span class="id">A</span> &amp; <span class="id">B</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">ofs</span>'; <span class="tactic">split</span>. <span class="tactic">omega</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">smatch_loadbytes</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">b</span> <span class="id">p</span> <span class="id">b</span>' <span class="id">ofs</span>' <span class="id">q</span> <span class="id">i</span> <span class="id">n</span> <span class="id">ofs</span> <span class="id">bytes</span>,<br/>
&nbsp;&nbsp;<span class="id">Mem.loadbytes</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">n</span> = <span class="id">Some</span> <span class="id">bytes</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">smatch</span> <span class="id">m</span> <span class="id">b</span> <span class="id">p</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">In</span> (<span class="id">Fragment</span> (<span class="id">Vptr</span> <span class="id">b</span>' <span class="id">ofs</span>') <span class="id">q</span> <span class="id">i</span>) <span class="id">bytes</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">pmatch</span> <span class="id">b</span>' <span class="id">ofs</span>' <span class="id">p</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2922')">Proof.</div>
<div class="proofscript" id="proof2922">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id">In_loadbytes</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">ofs1</span> &amp; <span class="id">A</span> &amp; <span class="id">B</span>).<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">loadbytes_provenance</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span>' <span class="id">byte</span> <span class="id">n</span> <span class="id">ofs</span> <span class="id">bytes</span>,<br/>
&nbsp;&nbsp;<span class="id">Mem.loadbytes</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">n</span> = <span class="id">Some</span> <span class="id">bytes</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">Mem.loadbytes</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span>' 1 = <span class="id">Some</span> (<span class="id">byte</span> :: <span class="id">nil</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">ofs</span> &lt;= <span class="id">ofs</span>' &lt; <span class="id">ofs</span> + <span class="id">n</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">In</span> <span class="id">byte</span> <span class="id">bytes</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2923')">Proof.</div>
<div class="proofscript" id="proof2923">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">n</span>. <span class="tactic">pattern</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">well_founded_ind</span> <span class="kwd">with</span> (<span class="id">R</span> := <span class="id">Zwf</span> 0).<br/>
- <span class="tactic">apply</span> <span class="id">Zwf_well_founded</span>.<br/>
- <span class="tactic">intros</span> <span class="id">sz</span> <span class="id">REC</span> <span class="id">ofs</span> <span class="id">bytes</span> <span class="id">LOAD</span> <span class="id">LOAD1</span> <span class="id">IN</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">Mem.loadbytes_split</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> 1 (<span class="id">sz</span> - 1) <span class="id">bytes</span>).<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (1 + (<span class="id">sz</span> - 1)) <span class="kwd">with</span> <span class="id">sz</span> <span class="tactic">by</span> <span class="tactic">omega</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">bytes1</span> &amp; <span class="id">bytes2</span> &amp; <span class="id">LOAD3</span> &amp; <span class="id">LOAD4</span> &amp; <span class="id">CONCAT</span>). <span class="tactic">subst</span> <span class="id">bytes</span>. <span class="tactic">rewrite</span> <span class="id">in_app_iff</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zeq</span> <span class="id">ofs</span> <span class="id">ofs</span>').<br/>
+ <span class="tactic">subst</span> <span class="id">ofs</span>'. <span class="tactic">rewrite</span> <span class="id">LOAD1</span> <span class="kwd">in</span> <span class="id">LOAD3</span>; <span class="id">inv</span> <span class="id">LOAD3</span>. <span class="id">left</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
+ <span class="id">right</span>. <span class="tactic">eapply</span> (<span class="id">REC</span> (<span class="id">sz</span> - 1)). <span class="tactic">red</span>; <span class="tactic">omega</span>. <span class="id">eexact</span> <span class="id">LOAD4</span>. <span class="tactic">auto</span>. <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">storebytes_provenance</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">bytes</span> <span class="id">m</span>' <span class="id">b</span>' <span class="id">ofs</span>' <span class="id">b</span>'' <span class="id">ofs</span>'' <span class="id">q</span> <span class="id">i</span>,<br/>
&nbsp;&nbsp;<span class="id">Mem.storebytes</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">bytes</span> = <span class="id">Some</span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">Mem.loadbytes</span> <span class="id">m</span>' <span class="id">b</span>' <span class="id">ofs</span>' 1 = <span class="id">Some</span> (<span class="id">Fragment</span> (<span class="id">Vptr</span> <span class="id">b</span>'' <span class="id">ofs</span>'') <span class="id">q</span> <span class="id">i</span> :: <span class="id">nil</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">In</span> (<span class="id">Fragment</span> (<span class="id">Vptr</span> <span class="id">b</span>'' <span class="id">ofs</span>'') <span class="id">q</span> <span class="id">i</span>) <span class="id">bytes</span><br/>
&nbsp;&nbsp;\/ <span class="id">Mem.loadbytes</span> <span class="id">m</span> <span class="id">b</span>' <span class="id">ofs</span>' 1 = <span class="id">Some</span> (<span class="id">Fragment</span> (<span class="id">Vptr</span> <span class="id">b</span>'' <span class="id">ofs</span>'') <span class="id">q</span> <span class="id">i</span> :: <span class="id">nil</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2924')">Proof.</div>
<div class="proofscript" id="proof2924">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">EITHER</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">b</span>' &lt;&gt; <span class="id">b</span> \/ <span class="id">ofs</span>' + 1 &lt;= <span class="id">ofs</span> \/ <span class="id">ofs</span> + <span class="id">Z.of_nat</span> (<span class="id">length</span> <span class="id">bytes</span>) &lt;= <span class="id">ofs</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\/ (<span class="id">b</span>' = <span class="id">b</span> /\ <span class="id">ofs</span> &lt;= <span class="id">ofs</span>' &lt; <span class="id">ofs</span> + <span class="id">Z.of_nat</span> (<span class="id">length</span> <span class="id">bytes</span>))).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">eq_block</span> <span class="id">b</span>' <span class="id">b</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zle</span> (<span class="id">ofs</span>' + 1) <span class="id">ofs</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zle</span> (<span class="id">ofs</span> + <span class="id">Z.of_nat</span> (<span class="id">length</span> <span class="id">bytes</span>)) <span class="id">ofs</span>'); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>. <span class="tactic">split</span>. <span class="tactic">auto</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">EITHER</span> <span class="kwd">as</span> [<span class="id">A</span> | (<span class="id">A</span> &amp; <span class="id">B</span>)].<br/>
- <span class="id">right</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H0</span>. <span class="tactic">symmetry</span>. <span class="tactic">eapply</span> <span class="id">Mem.loadbytes_storebytes_other</span>; <span class="tactic">eauto</span>. <span class="tactic">omega</span>.<br/>
- <span class="tactic">subst</span> <span class="id">b</span>'. <span class="id">left</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">loadbytes_provenance</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Mem.loadbytes_storebytes_same</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">store_provenance</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">chunk</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span> <span class="id">m</span>' <span class="id">b</span>' <span class="id">ofs</span>' <span class="id">b</span>'' <span class="id">ofs</span>'' <span class="id">q</span> <span class="id">i</span>,<br/>
&nbsp;&nbsp;<span class="id">Mem.store</span> <span class="id">chunk</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span> = <span class="id">Some</span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">Mem.loadbytes</span> <span class="id">m</span>' <span class="id">b</span>' <span class="id">ofs</span>' 1 = <span class="id">Some</span> (<span class="id">Fragment</span> (<span class="id">Vptr</span> <span class="id">b</span>'' <span class="id">ofs</span>'') <span class="id">q</span> <span class="id">i</span> :: <span class="id">nil</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">v</span> = <span class="id">Vptr</span> <span class="id">b</span>'' <span class="id">ofs</span>'' /\ (<span class="id">chunk</span> = <span class="id">Mint32</span> \/ <span class="id">chunk</span> = <span class="id">Many32</span> \/ <span class="id">chunk</span> = <span class="id">Mint64</span> \/ <span class="id">chunk</span> = <span class="id">Many64</span>)<br/>
&nbsp;&nbsp;\/ <span class="id">Mem.loadbytes</span> <span class="id">m</span> <span class="id">b</span>' <span class="id">ofs</span>' 1 = <span class="id">Some</span> (<span class="id">Fragment</span> (<span class="id">Vptr</span> <span class="id">b</span>'' <span class="id">ofs</span>'') <span class="id">q</span> <span class="id">i</span> :: <span class="id">nil</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2925')">Proof.</div>
<div class="proofscript" id="proof2925">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id">storebytes_provenance</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">Mem.store_storebytes</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">A</span>|<span class="id">A</span>]; <span class="tactic">auto</span>. <span class="id">left</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">encode_val_shape</span> <span class="id">chunk</span> <span class="id">v</span>). <span class="tactic">intros</span> <span class="id">ENC</span>; <span class="id">inv</span> <span class="id">ENC</span>.<br/>
- <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H1</span> <span class="kwd">in</span> <span class="id">A</span>; <span class="tactic">destruct</span> <span class="id">A</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;+ <span class="id">exploit</span> <span class="id">H5</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">j</span> &amp; <span class="id">P</span> &amp; <span class="id">Q</span>); <span class="tactic">congruence</span>.<br/>
- <span class="tactic">rewrite</span> &lt;- <span class="id">H1</span> <span class="kwd">in</span> <span class="id">A</span>; <span class="tactic">destruct</span> <span class="id">A</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;+ <span class="id">exploit</span> <span class="id">H3</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">byte</span> <span class="id">P</span>]; <span class="tactic">congruence</span>.<br/>
- <span class="tactic">rewrite</span> &lt;- <span class="id">H1</span> <span class="kwd">in</span> <span class="id">A</span>; <span class="tactic">destruct</span> <span class="id">A</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;+ <span class="id">exploit</span> <span class="id">H2</span>; <span class="tactic">eauto</span>. <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">smatch_store</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">chunk</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span> <span class="id">m</span>' <span class="id">b</span>' <span class="id">p</span> <span class="id">av</span>,<br/>
&nbsp;&nbsp;<span class="id">Mem.store</span> <span class="id">chunk</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span> = <span class="id">Some</span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">smatch</span> <span class="id">m</span> <span class="id">b</span>' <span class="id">p</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> <span class="id">v</span> <span class="id">av</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">smatch</span> <span class="id">m</span>' <span class="id">b</span>' (<span class="id">vplub</span> <span class="id">av</span> <span class="id">p</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2926')">Proof.</div>
<div class="proofscript" id="proof2926">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">A</span> <span class="id">B</span>]. <span class="tactic">split</span>.<br/>
- <span class="tactic">intros</span> <span class="id">chunk</span>' <span class="id">ofs</span>' <span class="id">v</span>' <span class="id">LOAD</span>. <span class="tactic">destruct</span> <span class="id">v</span>'; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Mem.load_pointer_store</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [(<span class="id">P</span> &amp; <span class="id">Q</span> &amp; <span class="id">R</span> &amp; <span class="id">S</span>) | <span class="id">DISJ</span>].<br/>
+ <span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id">vmatch_vplub_l</span>. <span class="tactic">auto</span>.<br/>
+ <span class="tactic">apply</span> <span class="id">vmatch_vplub_r</span>. <span class="tactic">apply</span> <span class="id">A</span> <span class="kwd">with</span> (<span class="id">chunk</span> := <span class="id">chunk</span>') (<span class="id">ofs</span> := <span class="id">ofs</span>').<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">LOAD</span>. <span class="tactic">symmetry</span>. <span class="tactic">eapply</span> <span class="id">Mem.load_store_other</span>; <span class="tactic">eauto</span>.<br/>
- <span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id">store_provenance</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [[<span class="id">P</span> <span class="id">Q</span>] | <span class="id">P</span>].<br/>
+ <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">V</span>: <span class="id">vmatch</span> (<span class="id">Vptr</span> <span class="id">b</span>'0 <span class="id">ofs</span>') (<span class="id">Ifptr</span> (<span class="id">vplub</span> <span class="id">av</span> <span class="id">p</span>))).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">vmatch_vplub_l</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">V</span>; <span class="tactic">auto</span>.<br/>
+ <span class="tactic">apply</span> <span class="id">pmatch_vplub</span>. <span class="tactic">eapply</span> <span class="id">B</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">smatch_storebytes</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">bytes</span> <span class="id">m</span>' <span class="id">b</span>' <span class="id">p</span> <span class="id">p</span>',<br/>
&nbsp;&nbsp;<span class="id">Mem.storebytes</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">bytes</span> = <span class="id">Some</span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">smatch</span> <span class="id">m</span> <span class="id">b</span>' <span class="id">p</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">b</span>' <span class="id">ofs</span>' <span class="id">q</span> <span class="id">i</span>, <span class="id">In</span> (<span class="id">Fragment</span> (<span class="id">Vptr</span> <span class="id">b</span>' <span class="id">ofs</span>') <span class="id">q</span> <span class="id">i</span>) <span class="id">bytes</span> -&gt; <span class="id">pmatch</span> <span class="id">b</span>' <span class="id">ofs</span>' <span class="id">p</span>') -&gt;<br/>
&nbsp;&nbsp;<span class="id">smatch</span> <span class="id">m</span>' <span class="id">b</span>' (<span class="id">plub</span> <span class="id">p</span>' <span class="id">p</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2927')">Proof.</div>
<div class="proofscript" id="proof2927">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">A</span> <span class="id">B</span>]. <span class="tactic">split</span>.<br/>
- <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">vmatch_ifptr</span>. <span class="tactic">intros</span> <span class="id">bx</span> <span class="id">ofsx</span> <span class="id">EQ</span>; <span class="tactic">subst</span> <span class="id">v</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Mem.load_loadbytes</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">bytes</span>' &amp; <span class="id">P</span> &amp; <span class="id">Q</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bytes</span>' <span class="kwd">as</span> [ | <span class="id">byte1</span>' <span class="id">bytes</span>'].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Mem.loadbytes_length</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">chunk</span>; <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">decode_val_shape</span> <span class="id">chunk</span> <span class="id">byte1</span>' <span class="id">bytes</span>'). <span class="tactic">rewrite</span> &lt;- <span class="id">Q</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">DEC</span>; <span class="id">inv</span> <span class="id">DEC</span>; <span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">v</span> = <span class="id">Vptr</span> <span class="id">bx</span> <span class="id">ofsx</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">H5</span> <span class="kwd">as</span> [<span class="id">E</span>|[<span class="id">E</span>|[<span class="id">E</span>|<span class="id">E</span>]]]; <span class="tactic">rewrite</span> <span class="id">E</span> <span class="kwd">in</span> <span class="id">H4</span>; <span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H4</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">destruct</span> <span class="id">Archi.ptr64</span>; <span class="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">In_loadbytes</span>; <span class="tactic">eauto</span>. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">coqlib</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">ofs</span>' &amp; <span class="id">X</span> &amp; <span class="id">Y</span>). <span class="tactic">subst</span> <span class="id">v</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">storebytes_provenance</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">Z</span> | <span class="id">Z</span>].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">pmatch_lub_l</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">pmatch_lub_r</span>. <span class="tactic">eauto</span>.<br/>
- <span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id">storebytes_provenance</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">Z</span> | <span class="id">Z</span>].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">pmatch_lub_l</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">pmatch_lub_r</span>. <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">bmatch</span> (<span class="id">m</span>: <span class="id">mem</span>) (<span class="id">b</span>: <span class="id">block</span>) (<span class="id">ab</span>: <span class="id">ablock</span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id">smatch</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ab</span>.(<span class="id">ab_summary</span>) /\<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">chunk</span> <span class="id">ofs</span> <span class="id">v</span>, <span class="id">Mem.load</span> <span class="id">chunk</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> = <span class="id">Some</span> <span class="id">v</span> -&gt; <span class="id">vmatch</span> <span class="id">v</span> (<span class="id">ablock_load</span> <span class="id">chunk</span> <span class="id">ab</span> <span class="id">ofs</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">bmatch_ext</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ab</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;<span class="id">bmatch</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ab</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">ofs</span> <span class="id">n</span> <span class="id">bytes</span>, <span class="id">Mem.loadbytes</span> <span class="id">m</span>' <span class="id">b</span> <span class="id">ofs</span> <span class="id">n</span> = <span class="id">Some</span> <span class="id">bytes</span> -&gt; <span class="id">n</span> &gt;= 0 -&gt; <span class="id">Mem.loadbytes</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">n</span> = <span class="id">Some</span> <span class="id">bytes</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">bmatch</span> <span class="id">m</span>' <span class="id">b</span> <span class="id">ab</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2928')">Proof.</div>
<div class="proofscript" id="proof2928">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">A</span> <span class="id">B</span>]. <span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">smatch_ext</span> <span class="kwd">with</span> <span class="id">m</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">B</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">loadbytes_load_ext</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">bmatch_inv</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ab</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;<span class="id">bmatch</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ab</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">ofs</span> <span class="id">n</span>, <span class="id">n</span> &gt;= 0 -&gt; <span class="id">Mem.loadbytes</span> <span class="id">m</span>' <span class="id">b</span> <span class="id">ofs</span> <span class="id">n</span> = <span class="id">Mem.loadbytes</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">n</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">bmatch</span> <span class="id">m</span>' <span class="id">b</span> <span class="id">ab</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2929')">Proof.</div>
<div class="proofscript" id="proof2929">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id">bmatch_ext</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">ablock_load_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">chunk</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span> <span class="id">ab</span>,<br/>
&nbsp;&nbsp;<span class="id">Mem.load</span> <span class="id">chunk</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> = <span class="id">Some</span> <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">bmatch</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ab</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> <span class="id">v</span> (<span class="id">ablock_load</span> <span class="id">chunk</span> <span class="id">ab</span> <span class="id">ofs</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2930')">Proof.</div>
<div class="proofscript" id="proof2930">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H0</span>. <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">ablock_load_anywhere_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">chunk</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span> <span class="id">ab</span>,<br/>
&nbsp;&nbsp;<span class="id">Mem.load</span> <span class="id">chunk</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> = <span class="id">Some</span> <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">bmatch</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ab</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> <span class="id">v</span> (<span class="id">ablock_load_anywhere</span> <span class="id">chunk</span> <span class="id">ab</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2931')">Proof.</div>
<div class="proofscript" id="proof2931">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H0</span>. <span class="tactic">destruct</span> <span class="id">H0</span>. <span class="tactic">unfold</span> <span class="id">ablock_load_anywhere</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">vnormalize_cast</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">ablock_init_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">b</span> <span class="id">p</span>, <span class="id">smatch</span> <span class="id">m</span> <span class="id">b</span> <span class="id">p</span> -&gt; <span class="id">bmatch</span> <span class="id">m</span> <span class="id">b</span> (<span class="id">ablock_init</span> <span class="id">p</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2932')">Proof.</div>
<div class="proofscript" id="proof2932">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">ablock_load</span>, <span class="id">ablock_init</span>; <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">ZTree.gempty</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">vnormalize_cast</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">ablock_store_anywhere_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">chunk</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span> <span class="id">m</span>' <span class="id">b</span>' <span class="id">ab</span> <span class="id">av</span>,<br/>
&nbsp;&nbsp;<span class="id">Mem.store</span> <span class="id">chunk</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span> = <span class="id">Some</span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">bmatch</span> <span class="id">m</span> <span class="id">b</span>' <span class="id">ab</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> <span class="id">v</span> <span class="id">av</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">bmatch</span> <span class="id">m</span>' <span class="id">b</span>' (<span class="id">ablock_store_anywhere</span> <span class="id">chunk</span> <span class="id">ab</span> <span class="id">av</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2933')">Proof.</div>
<div class="proofscript" id="proof2933">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">A</span> <span class="id">B</span>]. <span class="tactic">unfold</span> <span class="id">ablock_store_anywhere</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">ablock_init_sound</span>. <span class="tactic">eapply</span> <span class="id">smatch_store</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id">inval_after_outside</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">i</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">c</span>, <span class="id">i</span> &lt; <span class="id">lo</span> \/ <span class="id">i</span> &gt; <span class="id">hi</span> -&gt; (<span class="id">inval_after</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">c</span>)##<span class="id">i</span> = <span class="id">c</span>##<span class="id">i</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2934')">Proof.</div>
<div class="proofscript" id="proof2934">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">c</span>. <span class="id">functional</span> <span class="tactic">induction</span> (<span class="id">inval_after</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">c</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IHt</span> <span class="tactic">by</span> <span class="tactic">omega</span>. <span class="tactic">apply</span> <span class="id">ZTree.gro</span>. <span class="tactic">unfold</span> <span class="id">ZTree.elt</span>, <span class="id">ZIndexed.t</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id">inval_after_contents</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">chunk</span> <span class="id">av</span> <span class="id">i</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">c</span>,<br/>
&nbsp;&nbsp;(<span class="id">inval_after</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">c</span>)##<span class="id">i</span> = <span class="id">Some</span> (<span class="id">ACval</span> <span class="id">chunk</span> <span class="id">av</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">c</span>##<span class="id">i</span> = <span class="id">Some</span> (<span class="id">ACval</span> <span class="id">chunk</span> <span class="id">av</span>) /\ (<span class="id">i</span> &lt; <span class="id">lo</span> \/ <span class="id">i</span> &gt; <span class="id">hi</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2935')">Proof.</div>
<div class="proofscript" id="proof2935">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">c</span>. <span class="id">functional</span> <span class="tactic">induction</span> (<span class="id">inval_after</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">c</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zeq</span> <span class="id">i</span> <span class="id">hi</span>).<br/>
&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">i</span>. <span class="tactic">rewrite</span> <span class="id">inval_after_outside</span> <span class="kwd">in</span> <span class="id">H</span> <span class="tactic">by</span> <span class="tactic">omega</span>. <span class="tactic">rewrite</span> <span class="id">ZTree.grs</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">IHt</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">A</span> <span class="id">B</span>]. <span class="tactic">rewrite</span> <span class="id">ZTree.gro</span> <span class="kwd">in</span> <span class="id">A</span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">split</span>. <span class="tactic">auto</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">auto</span>. <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id">inval_before_outside</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">i</span> <span class="id">hi</span> <span class="id">lo</span> <span class="id">c</span>, <span class="id">i</span> &lt; <span class="id">lo</span> \/ <span class="id">i</span> &gt;= <span class="id">hi</span> -&gt; (<span class="id">inval_before</span> <span class="id">hi</span> <span class="id">lo</span> <span class="id">c</span>)##<span class="id">i</span> = <span class="id">c</span>##<span class="id">i</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2936')">Proof.</div>
<div class="proofscript" id="proof2936">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">c</span>. <span class="id">functional</span> <span class="tactic">induction</span> (<span class="id">inval_before</span> <span class="id">hi</span> <span class="id">lo</span> <span class="id">c</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IHt</span> <span class="tactic">by</span> <span class="tactic">omega</span>. <span class="tactic">unfold</span> <span class="id">inval_if</span>. <span class="tactic">destruct</span> (<span class="id">c</span>##<span class="id">lo</span>) <span class="kwd">as</span> [[<span class="id">chunk</span> <span class="id">av</span>]|]; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zle</span> (<span class="id">lo</span> + <span class="id">size_chunk</span> <span class="id">chunk</span>) <span class="id">hi</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">ZTree.gro</span>. <span class="tactic">unfold</span> <span class="id">ZTree.elt</span>, <span class="id">ZIndexed.t</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id">inval_before_contents_1</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">i</span> <span class="id">chunk</span> <span class="id">av</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">c</span>,<br/>
&nbsp;&nbsp;<span class="id">lo</span> &lt;= <span class="id">i</span> &lt; <span class="id">hi</span> -&gt; (<span class="id">inval_before</span> <span class="id">hi</span> <span class="id">lo</span> <span class="id">c</span>)##<span class="id">i</span> = <span class="id">Some</span>(<span class="id">ACval</span> <span class="id">chunk</span> <span class="id">av</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">c</span>##<span class="id">i</span> = <span class="id">Some</span>(<span class="id">ACval</span> <span class="id">chunk</span> <span class="id">av</span>) /\ <span class="id">i</span> + <span class="id">size_chunk</span> <span class="id">chunk</span> &lt;= <span class="id">hi</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2937')">Proof.</div>
<div class="proofscript" id="proof2937">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">c</span>. <span class="id">functional</span> <span class="tactic">induction</span> (<span class="id">inval_before</span> <span class="id">hi</span> <span class="id">lo</span> <span class="id">c</span>); <span class="tactic">intros</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">zeq</span> <span class="id">lo</span> <span class="id">i</span>).<br/>
+ <span class="tactic">subst</span> <span class="id">i</span>. <span class="tactic">rewrite</span> <span class="id">inval_before_outside</span> <span class="kwd">in</span> <span class="id">H0</span> <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">inval_if</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> (<span class="id">c</span>##<span class="id">lo</span>) <span class="kwd">as</span> [[<span class="id">chunk0</span> <span class="id">v0</span>]|] <span class="id">eqn</span>:<span class="id">C</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zle</span> (<span class="id">lo</span> + <span class="id">size_chunk</span> <span class="id">chunk0</span>) <span class="id">hi</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">C</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="id">inv</span> <span class="id">H0</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">ZTree.grs</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">congruence</span>.<br/>
+ <span class="id">exploit</span> <span class="id">IHt</span>. <span class="tactic">omega</span>. <span class="tactic">auto</span>. <span class="tactic">intros</span> [<span class="id">A</span> <span class="id">B</span>]; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">inval_if</span> <span class="kwd">in</span> <span class="id">A</span>. <span class="tactic">destruct</span> (<span class="id">c</span>##<span class="id">lo</span>) <span class="kwd">as</span> [[<span class="id">chunk0</span> <span class="id">v0</span>]|] <span class="id">eqn</span>:<span class="id">C</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zle</span> (<span class="id">lo</span> + <span class="id">size_chunk</span> <span class="id">chunk0</span>) <span class="id">hi</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">ZTree.gro</span> <span class="kwd">in</span> <span class="id">A</span>; <span class="tactic">auto</span>.<br/>
- <span class="id">omegaContradiction</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">max_size_chunk</span>: <span class="kwd">forall</span> <span class="id">chunk</span>, <span class="id">size_chunk</span> <span class="id">chunk</span> &lt;= 8.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2938')">Proof.</div>
<div class="proofscript" id="proof2938">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">chunk</span>; <span class="tactic">simpl</span>; <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id">inval_before_contents</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">i</span> <span class="id">c</span> <span class="id">chunk</span>' <span class="id">av</span>' <span class="id">j</span>,<br/>
&nbsp;&nbsp;(<span class="id">inval_before</span> <span class="id">i</span> (<span class="id">i</span> - 7) <span class="id">c</span>)##<span class="id">j</span> = <span class="id">Some</span> (<span class="id">ACval</span> <span class="id">chunk</span>' <span class="id">av</span>') -&gt;<br/>
&nbsp;&nbsp;<span class="id">c</span>##<span class="id">j</span> = <span class="id">Some</span> (<span class="id">ACval</span> <span class="id">chunk</span>' <span class="id">av</span>') /\ (<span class="id">j</span> + <span class="id">size_chunk</span> <span class="id">chunk</span>' &lt;= <span class="id">i</span> \/ <span class="id">i</span> &lt;= <span class="id">j</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2939')">Proof.</div>
<div class="proofscript" id="proof2939">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">j</span> (<span class="id">i</span> - 7)).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">inval_before_outside</span> <span class="kwd">in</span> <span class="id">H</span> <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">auto</span>. <span class="id">left</span>. <span class="tactic">generalize</span> (<span class="id">max_size_chunk</span> <span class="id">chunk</span>'); <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zlt</span> <span class="id">j</span> <span class="id">i</span>).<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">inval_before_contents_1</span>; <span class="tactic">eauto</span>. <span class="tactic">omega</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">inval_before_outside</span> <span class="kwd">in</span> <span class="id">H</span> <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">auto</span>. <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">ablock_store_contents</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">chunk</span> <span class="id">ab</span> <span class="id">i</span> <span class="id">av</span> <span class="id">j</span> <span class="id">chunk</span>' <span class="id">av</span>',<br/>
&nbsp;&nbsp;(<span class="id">ablock_store</span> <span class="id">chunk</span> <span class="id">ab</span> <span class="id">i</span> <span class="id">av</span>).(<span class="id">ab_contents</span>)##<span class="id">j</span> = <span class="id">Some</span>(<span class="id">ACval</span> <span class="id">chunk</span>' <span class="id">av</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">i</span> = <span class="id">j</span> /\ <span class="id">chunk</span>' = <span class="id">chunk</span> /\ <span class="id">av</span>' = <span class="id">av</span>)<br/>
&nbsp;&nbsp;\/ (<span class="id">ab</span>.(<span class="id">ab_contents</span>)##<span class="id">j</span> = <span class="id">Some</span>(<span class="id">ACval</span> <span class="id">chunk</span>' <span class="id">av</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ (<span class="id">j</span> + <span class="id">size_chunk</span> <span class="id">chunk</span>' &lt;= <span class="id">i</span> \/ <span class="id">i</span> + <span class="id">size_chunk</span> <span class="id">chunk</span> &lt;= <span class="id">j</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2940')">Proof.</div>
<div class="proofscript" id="proof2940">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">ablock_store</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zeq</span> <span class="id">i</span> <span class="id">j</span>).<br/>
&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">j</span>. <span class="tactic">rewrite</span> <span class="id">ZTree.gss</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">right</span>. <span class="tactic">rewrite</span> <span class="id">ZTree.gso</span> <span class="kwd">in</span> <span class="id">H</span> <span class="tactic">by</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">inval_before_contents</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">A</span> <span class="id">B</span>].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">inval_after_contents</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">C</span> <span class="id">D</span>].<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">auto</span>. <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">chunk_compat_true</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">c</span>',<br/>
&nbsp;&nbsp;<span class="id">chunk_compat</span> <span class="id">c</span> <span class="id">c</span>' = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">size_chunk</span> <span class="id">c</span> = <span class="id">size_chunk</span> <span class="id">c</span>' /\ <span class="id">align_chunk</span> <span class="id">c</span> &lt;= <span class="id">align_chunk</span> <span class="id">c</span>' /\ <span class="id">type_of_chunk</span> <span class="id">c</span> = <span class="id">type_of_chunk</span> <span class="id">c</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2941')">Proof.</div>
<div class="proofscript" id="proof2941">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">c</span>, <span class="id">c</span>'; <span class="tactic">intros</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">ablock_store_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">chunk</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span> <span class="id">m</span>' <span class="id">ab</span> <span class="id">av</span>,<br/>
&nbsp;&nbsp;<span class="id">Mem.store</span> <span class="id">chunk</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span> = <span class="id">Some</span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">bmatch</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ab</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> <span class="id">v</span> <span class="id">av</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">bmatch</span> <span class="id">m</span>' <span class="id">b</span> (<span class="id">ablock_store</span> <span class="id">chunk</span> <span class="id">ab</span> <span class="id">ofs</span> <span class="id">av</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2942')">Proof.</div>
<div class="proofscript" id="proof2942">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">av</span>; <span class="tactic">intros</span> <span class="id">STORE</span> <span class="id">BIN</span> <span class="id">VIN</span>. <span class="tactic">destruct</span> <span class="id">BIN</span> <span class="kwd">as</span> [<span class="id">BIN1</span> <span class="id">BIN2</span>]. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">smatch_store</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">chunk</span>' <span class="id">ofs</span>' <span class="id">v</span>' <span class="id">LOAD</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">SUMMARY</span>: <span class="id">vmatch</span> <span class="id">v</span>' (<span class="id">vnormalize</span> <span class="id">chunk</span>' (<span class="id">Ifptr</span> (<span class="id">vplub</span> <span class="id">av</span> <span class="id">ab</span>.(<span class="id">ab_summary</span>))))).<br/>
&nbsp;&nbsp;{ <span class="id">exploit</span> <span class="id">smatch_store</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">A</span> <span class="id">B</span>]. <span class="tactic">eapply</span> <span class="id">vnormalize_cast</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">ablock_load</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> ((<span class="id">ab_contents</span> (<span class="id">ablock_store</span> <span class="id">chunk</span> <span class="id">ab</span> <span class="id">ofs</span> <span class="id">av</span>)) ## <span class="id">ofs</span>') <span class="kwd">as</span> [[<span class="id">chunk1</span> <span class="id">av1</span>]|] <span class="id">eqn</span>:<span class="id">C</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">chunk_compat</span> <span class="id">chunk</span>' <span class="id">chunk1</span>) <span class="id">eqn</span>:<span class="id">COMPAT</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">chunk_compat_true</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">U</span> &amp; <span class="id">V</span> &amp; <span class="id">W</span>).<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">ablock_store_contents</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [(<span class="id">P</span> &amp; <span class="id">Q</span> &amp; <span class="id">R</span>) | (<span class="id">P</span> &amp; <span class="id">Q</span>)].<br/>
- <span class="comment">(*&nbsp;same&nbsp;offset&nbsp;and&nbsp;compatible&nbsp;chunks&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">v</span>' = <span class="id">Val.load_result</span> <span class="id">chunk</span>' <span class="id">v</span>).<br/>
&nbsp;&nbsp;{ <span class="id">exploit</span> <span class="id">Mem.load_store_similar_2</span>; <span class="tactic">eauto</span>. <span class="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">v</span>'. <span class="tactic">apply</span> <span class="id">vnormalize_sound</span>; <span class="tactic">auto</span>.<br/>
- <span class="comment">(*&nbsp;disjoint&nbsp;load/store&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Mem.load</span> <span class="id">chunk</span>' <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span>' = <span class="id">Some</span> <span class="id">v</span>').<br/>
&nbsp;&nbsp;{ <span class="tactic">rewrite</span> &lt;- <span class="id">LOAD</span>. <span class="tactic">symmetry</span>. <span class="tactic">eapply</span> <span class="id">Mem.load_store_other</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">U</span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">BIN2</span>; <span class="tactic">eauto</span>. <span class="tactic">unfold</span> <span class="id">ablock_load</span>. <span class="tactic">rewrite</span> <span class="id">P</span>. <span class="tactic">rewrite</span> <span class="id">COMPAT</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">ablock_loadbytes_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ab</span> <span class="id">b</span>' <span class="id">ofs</span>' <span class="id">q</span> <span class="id">i</span> <span class="id">n</span> <span class="id">ofs</span> <span class="id">bytes</span>,<br/>
&nbsp;&nbsp;<span class="id">Mem.loadbytes</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">n</span> = <span class="id">Some</span> <span class="id">bytes</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">bmatch</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ab</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">In</span> (<span class="id">Fragment</span> (<span class="id">Vptr</span> <span class="id">b</span>' <span class="id">ofs</span>') <span class="id">q</span> <span class="id">i</span>) <span class="id">bytes</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">pmatch</span> <span class="id">b</span>' <span class="id">ofs</span>' (<span class="id">ablock_loadbytes</span> <span class="id">ab</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2943')">Proof.</div>
<div class="proofscript" id="proof2943">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H0</span>. <span class="tactic">eapply</span> <span class="id">smatch_loadbytes</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">ablock_storebytes_anywhere_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">bytes</span> <span class="id">p</span> <span class="id">m</span>' <span class="id">b</span>' <span class="id">ab</span>,<br/>
&nbsp;&nbsp;<span class="id">Mem.storebytes</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">bytes</span> = <span class="id">Some</span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">b</span>' <span class="id">ofs</span>' <span class="id">q</span> <span class="id">i</span>, <span class="id">In</span> (<span class="id">Fragment</span> (<span class="id">Vptr</span> <span class="id">b</span>' <span class="id">ofs</span>') <span class="id">q</span> <span class="id">i</span>) <span class="id">bytes</span> -&gt; <span class="id">pmatch</span> <span class="id">b</span>' <span class="id">ofs</span>' <span class="id">p</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">bmatch</span> <span class="id">m</span> <span class="id">b</span>' <span class="id">ab</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">bmatch</span> <span class="id">m</span>' <span class="id">b</span>' (<span class="id">ablock_storebytes_anywhere</span> <span class="id">ab</span> <span class="id">p</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2944')">Proof.</div>
<div class="proofscript" id="proof2944">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">A</span> <span class="id">B</span>]. <span class="tactic">apply</span> <span class="id">ablock_init_sound</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">smatch_storebytes</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">ablock_storebytes_contents</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ab</span> <span class="id">p</span> <span class="id">i</span> <span class="id">sz</span> <span class="id">j</span> <span class="id">chunk</span>' <span class="id">av</span>',<br/>
&nbsp;&nbsp;(<span class="id">ablock_storebytes</span> <span class="id">ab</span> <span class="id">p</span> <span class="id">i</span> <span class="id">sz</span>).(<span class="id">ab_contents</span>)##<span class="id">j</span> = <span class="id">Some</span>(<span class="id">ACval</span> <span class="id">chunk</span>' <span class="id">av</span>') -&gt;<br/>
&nbsp;&nbsp;<span class="id">ab</span>.(<span class="id">ab_contents</span>)##<span class="id">j</span> = <span class="id">Some</span> (<span class="id">ACval</span> <span class="id">chunk</span>' <span class="id">av</span>')<br/>
&nbsp;&nbsp;/\ (<span class="id">j</span> + <span class="id">size_chunk</span> <span class="id">chunk</span>' &lt;= <span class="id">i</span> \/ <span class="id">i</span> + <span class="id">Zmax</span> <span class="id">sz</span> 0 &lt;= <span class="id">j</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2945')">Proof.</div>
<div class="proofscript" id="proof2945">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">ablock_storebytes</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">inval_before_contents</span>; <span class="tactic">eauto</span>. <span class="tactic">clear</span> <span class="id">H</span>. <span class="tactic">intros</span> [<span class="id">A</span> <span class="id">B</span>].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">inval_after_contents</span>; <span class="tactic">eauto</span>. <span class="tactic">clear</span> <span class="id">A</span>. <span class="tactic">intros</span> [<span class="id">C</span> <span class="id">D</span>].<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">auto</span>. <span class="id">xomega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">ablock_storebytes_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">bytes</span> <span class="id">m</span>' <span class="id">p</span> <span class="id">ab</span> <span class="id">sz</span>,<br/>
&nbsp;&nbsp;<span class="id">Mem.storebytes</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">bytes</span> = <span class="id">Some</span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">length</span> <span class="id">bytes</span> = <span class="id">nat_of_Z</span> <span class="id">sz</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">b</span>' <span class="id">ofs</span>' <span class="id">q</span> <span class="id">i</span>, <span class="id">In</span> (<span class="id">Fragment</span> (<span class="id">Vptr</span> <span class="id">b</span>' <span class="id">ofs</span>') <span class="id">q</span> <span class="id">i</span>) <span class="id">bytes</span> -&gt; <span class="id">pmatch</span> <span class="id">b</span>' <span class="id">ofs</span>' <span class="id">p</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">bmatch</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ab</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">bmatch</span> <span class="id">m</span>' <span class="id">b</span> (<span class="id">ablock_storebytes</span> <span class="id">ab</span> <span class="id">p</span> <span class="id">ofs</span> <span class="id">sz</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2946')">Proof.</div>
<div class="proofscript" id="proof2946">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">sz</span>; <span class="tactic">intros</span> <span class="id">STORE</span> <span class="id">LENGTH</span> <span class="id">CONTENTS</span> <span class="id">BM</span>. <span class="tactic">destruct</span> <span class="id">BM</span> <span class="kwd">as</span> [<span class="id">BM1</span> <span class="id">BM2</span>]. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">smatch_storebytes</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">chunk</span>' <span class="id">ofs</span>' <span class="id">v</span>' <span class="id">LOAD</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">SUMMARY</span>: <span class="id">vmatch</span> <span class="id">v</span>' (<span class="id">vnormalize</span> <span class="id">chunk</span>' (<span class="id">Ifptr</span> (<span class="id">plub</span> <span class="id">p</span> <span class="id">ab</span>.(<span class="id">ab_summary</span>))))).<br/>
&nbsp;&nbsp;{ <span class="id">exploit</span> <span class="id">smatch_storebytes</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">A</span> <span class="id">B</span>]. <span class="tactic">eapply</span> <span class="id">vnormalize_cast</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">ablock_load</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">ab_contents</span> (<span class="id">ablock_storebytes</span> <span class="id">ab</span> <span class="id">p</span> <span class="id">ofs</span> <span class="id">sz</span>))##<span class="id">ofs</span>' <span class="kwd">as</span> [[<span class="id">chunk</span> <span class="id">av</span>]|] <span class="id">eqn</span>:<span class="id">C</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">chunk_compat</span> <span class="id">chunk</span>' <span class="id">chunk</span>) <span class="id">eqn</span>:<span class="id">COMPAT</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">chunk_compat_true</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">U</span> &amp; <span class="id">V</span> &amp; <span class="id">W</span>).<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">ablock_storebytes_contents</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">A</span> <span class="id">B</span>].<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Mem.load</span> <span class="id">chunk</span>' <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span>' = <span class="id">Some</span> <span class="id">v</span>').<br/>
&nbsp;&nbsp;{ <span class="tactic">rewrite</span> &lt;- <span class="id">LOAD</span>'; <span class="tactic">symmetry</span>. <span class="tactic">eapply</span> <span class="id">Mem.load_storebytes_other</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">U</span>. <span class="tactic">rewrite</span> <span class="id">LENGTH</span>. <span class="tactic">rewrite</span> <span class="id">nat_of_Z_max</span>. <span class="id">right</span>; <span class="tactic">omega</span>. }<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">BM2</span>; <span class="tactic">eauto</span>. <span class="tactic">unfold</span> <span class="id">ablock_load</span>. <span class="tactic">rewrite</span> <span class="id">A</span>. <span class="tactic">rewrite</span> <span class="id">COMPAT</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Boolean equality </div>
<br/>
<span class="kwd">Definition</span> <span class="id">bbeq</span> (<span class="id">ab1</span> <span class="id">ab2</span>: <span class="id">ablock</span>) : <span class="id">bool</span> :=<br/>
&nbsp;&nbsp;<span class="id">eq_aptr</span> <span class="id">ab1</span>.(<span class="id">ab_summary</span>) <span class="id">ab2</span>.(<span class="id">ab_summary</span>) &amp;&amp;<br/>
&nbsp;&nbsp;<span class="id">ZTree.beq</span> (<span class="kwd">fun</span> <span class="id">c1</span> <span class="id">c2</span> =&gt; <span class="id">proj_sumbool</span> (<span class="id">eq_acontent</span> <span class="id">c1</span> <span class="id">c2</span>)) <span class="id">ab1</span>.(<span class="id">ab_contents</span>) <span class="id">ab2</span>.(<span class="id">ab_contents</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">bbeq_load</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ab1</span> <span class="id">ab2</span>,<br/>
&nbsp;&nbsp;<span class="id">bbeq</span> <span class="id">ab1</span> <span class="id">ab2</span> = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">ab1</span>.(<span class="id">ab_summary</span>) = <span class="id">ab2</span>.(<span class="id">ab_summary</span>)<br/>
&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">chunk</span> <span class="id">i</span>, <span class="id">ablock_load</span> <span class="id">chunk</span> <span class="id">ab1</span> <span class="id">i</span> = <span class="id">ablock_load</span> <span class="id">chunk</span> <span class="id">ab2</span> <span class="id">i</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2947')">Proof.</div>
<div class="proofscript" id="proof2947">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">bbeq</span>; <span class="tactic">intros</span>. <span class="id">InvBooleans</span>. <span class="tactic">split</span>.<br/>
- <span class="tactic">unfold</span> <span class="id">ablock_load_anywhere</span>; <span class="tactic">intros</span>; <span class="tactic">congruence</span>.<br/>
- <span class="tactic">assert</span> (<span class="id">A</span>: <span class="kwd">forall</span> <span class="id">i</span>, <span class="id">ZTree.get</span> <span class="id">i</span> (<span class="id">ab_contents</span> <span class="id">ab1</span>) = <span class="id">ZTree.get</span> <span class="id">i</span> (<span class="id">ab_contents</span> <span class="id">ab2</span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id">ZTree.beq_sound</span>; <span class="tactic">eauto</span>. <span class="id">instantiate</span> (1 := <span class="id">i</span>). <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">ab_contents</span> <span class="id">ab1</span>)##<span class="id">i</span>, (<span class="id">ab_contents</span> <span class="id">ab2</span>)##<span class="id">i</span>; <span class="tactic">intros</span>; <span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">InvBooleans</span>; <span class="tactic">subst</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">ablock_load</span>. <span class="tactic">rewrite</span> <span class="id">A</span>, <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">ab_contents</span> <span class="id">ab2</span>)##<span class="id">i</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">bbeq_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ab1</span> <span class="id">ab2</span>,<br/>
&nbsp;&nbsp;<span class="id">bbeq</span> <span class="id">ab1</span> <span class="id">ab2</span> = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">b</span>, <span class="id">bmatch</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ab1</span> &lt;-&gt; <span class="id">bmatch</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ab2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2948')">Proof.</div>
<div class="proofscript" id="proof2948">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id">bbeq_load</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">A</span> <span class="id">B</span>].<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">bmatch</span>. <span class="tactic">rewrite</span> <span class="id">A</span>. <span class="tactic">intuition</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">B</span>; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">B</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Least upper bound </div>
<br/>
<span class="kwd">Definition</span> <span class="id">combine_acontents</span> (<span class="id">c1</span> <span class="id">c2</span>: <span class="id">option</span> <span class="id">acontent</span>) : <span class="id">option</span> <span class="id">acontent</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">c1</span>, <span class="id">c2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Some</span> (<span class="id">ACval</span> <span class="id">chunk1</span> <span class="id">v1</span>), <span class="id">Some</span> (<span class="id">ACval</span> <span class="id">chunk2</span> <span class="id">v2</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">chunk_eq</span> <span class="id">chunk1</span> <span class="id">chunk2</span> <span class="kwd">then</span> <span class="id">Some</span>(<span class="id">ACval</span> <span class="id">chunk1</span> (<span class="id">vlub</span> <span class="id">v1</span> <span class="id">v2</span>)) <span class="kwd">else</span> <span class="id">None</span><br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">None</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">blub</span> (<span class="id">ab1</span> <span class="id">ab2</span>: <span class="id">ablock</span>) : <span class="id">ablock</span> :=<br/>
&nbsp;&nbsp;{| <span class="id">ab_contents</span> := <span class="id">ZTree.combine</span> <span class="id">combine_acontents</span> <span class="id">ab1</span>.(<span class="id">ab_contents</span>) <span class="id">ab2</span>.(<span class="id">ab_contents</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ab_summary</span> := <span class="id">plub</span> <span class="id">ab1</span>.(<span class="id">ab_summary</span>) <span class="id">ab2</span>.(<span class="id">ab_summary</span>) |}.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">smatch_lub_l</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">b</span> <span class="id">p</span> <span class="id">q</span>, <span class="id">smatch</span> <span class="id">m</span> <span class="id">b</span> <span class="id">p</span> -&gt; <span class="id">smatch</span> <span class="id">m</span> <span class="id">b</span> (<span class="id">plub</span> <span class="id">p</span> <span class="id">q</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2949')">Proof.</div>
<div class="proofscript" id="proof2949">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">A</span> <span class="id">B</span>]. <span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">change</span> (<span class="id">vmatch</span> <span class="id">v</span> (<span class="id">vlub</span> (<span class="id">Ifptr</span> <span class="id">p</span>) (<span class="id">Ifptr</span> <span class="id">q</span>))). <span class="tactic">apply</span> <span class="id">vmatch_lub_l</span>. <span class="tactic">eapply</span> <span class="id">A</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">pmatch_lub_l</span>. <span class="tactic">eapply</span> <span class="id">B</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">smatch_lub_r</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">b</span> <span class="id">p</span> <span class="id">q</span>, <span class="id">smatch</span> <span class="id">m</span> <span class="id">b</span> <span class="id">q</span> -&gt; <span class="id">smatch</span> <span class="id">m</span> <span class="id">b</span> (<span class="id">plub</span> <span class="id">p</span> <span class="id">q</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2950')">Proof.</div>
<div class="proofscript" id="proof2950">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">A</span> <span class="id">B</span>]. <span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">change</span> (<span class="id">vmatch</span> <span class="id">v</span> (<span class="id">vlub</span> (<span class="id">Ifptr</span> <span class="id">p</span>) (<span class="id">Ifptr</span> <span class="id">q</span>))). <span class="tactic">apply</span> <span class="id">vmatch_lub_r</span>. <span class="tactic">eapply</span> <span class="id">A</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">pmatch_lub_r</span>. <span class="tactic">eapply</span> <span class="id">B</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">bmatch_lub_l</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">b</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">bmatch</span> <span class="id">m</span> <span class="id">b</span> <span class="id">x</span> -&gt; <span class="id">bmatch</span> <span class="id">m</span> <span class="id">b</span> (<span class="id">blub</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2951')">Proof.</div>
<div class="proofscript" id="proof2951">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">BM1</span> <span class="id">BM2</span>]. <span class="tactic">split</span>; <span class="tactic">unfold</span> <span class="id">blub</span>; <span class="tactic">simpl</span>.<br/>
- <span class="tactic">apply</span> <span class="id">smatch_lub_l</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">SUMMARY</span>: <span class="id">vmatch</span> <span class="id">v</span> (<span class="id">vnormalize</span> <span class="id">chunk</span> (<span class="id">Ifptr</span> (<span class="id">plub</span> (<span class="id">ab_summary</span> <span class="id">x</span>) (<span class="id">ab_summary</span> <span class="id">y</span>))))<br/>
).<br/>
&nbsp;&nbsp;{ <span class="id">exploit</span> <span class="id">smatch_lub_l</span>; <span class="tactic">eauto</span>. <span class="id">instantiate</span> (1 := <span class="id">ab_summary</span> <span class="id">y</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">SUMM</span> <span class="id">_</span>]. <span class="tactic">eapply</span> <span class="id">vnormalize_cast</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">BM2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">ablock_load</span>; <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">ZTree.gcombine</span> <span class="tactic">by</span> <span class="tactic">auto</span>. <br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">combine_acontents</span>;<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">ab_contents</span> <span class="id">x</span>)##<span class="id">ofs</span> <span class="kwd">as</span> [[<span class="id">chunkx</span> <span class="id">avx</span>]|], (<span class="id">ab_contents</span> <span class="id">y</span>)##<span class="id">ofs</span> <span class="kwd">as</span> [[<span class="id">chunky</span> <span class="id">avy</span>]|]; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">chunk_eq</span> <span class="id">chunkx</span> <span class="id">chunky</span>); <span class="tactic">auto</span>. <span class="tactic">subst</span> <span class="id">chunky</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">chunk_compat</span> <span class="id">chunk</span> <span class="id">chunkx</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id">vmatch_ge</span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">vnormalize_monotone</span>. <span class="tactic">apply</span> <span class="id">vge_lub_l</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">bmatch_lub_r</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">b</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">bmatch</span> <span class="id">m</span> <span class="id">b</span> <span class="id">y</span> -&gt; <span class="id">bmatch</span> <span class="id">m</span> <span class="id">b</span> (<span class="id">blub</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2952')">Proof.</div>
<div class="proofscript" id="proof2952">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">BM1</span> <span class="id">BM2</span>]. <span class="tactic">split</span>; <span class="tactic">unfold</span> <span class="id">blub</span>; <span class="tactic">simpl</span>.<br/>
- <span class="tactic">apply</span> <span class="id">smatch_lub_r</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">SUMMARY</span>: <span class="id">vmatch</span> <span class="id">v</span> (<span class="id">vnormalize</span> <span class="id">chunk</span> (<span class="id">Ifptr</span> (<span class="id">plub</span> (<span class="id">ab_summary</span> <span class="id">x</span>) (<span class="id">ab_summary</span> <span class="id">y</span>))))<br/>
).<br/>
&nbsp;&nbsp;{ <span class="id">exploit</span> <span class="id">smatch_lub_r</span>; <span class="tactic">eauto</span>. <span class="id">instantiate</span> (1 := <span class="id">ab_summary</span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">SUMM</span> <span class="id">_</span>]. <span class="tactic">eapply</span> <span class="id">vnormalize_cast</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">BM2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">ablock_load</span>; <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">ZTree.gcombine</span> <span class="tactic">by</span> <span class="tactic">auto</span>. <br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">combine_acontents</span>;<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">ab_contents</span> <span class="id">x</span>)##<span class="id">ofs</span> <span class="kwd">as</span> [[<span class="id">chunkx</span> <span class="id">avx</span>]|], (<span class="id">ab_contents</span> <span class="id">y</span>)##<span class="id">ofs</span> <span class="kwd">as</span> [[<span class="id">chunky</span> <span class="id">avy</span>]|]; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">chunk_eq</span> <span class="id">chunkx</span> <span class="id">chunky</span>); <span class="tactic">auto</span>. <span class="tactic">subst</span> <span class="id">chunky</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">chunk_compat</span> <span class="id">chunk</span> <span class="id">chunkx</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id">vmatch_ge</span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">vnormalize_monotone</span>. <span class="tactic">apply</span> <span class="id">vge_lub_r</span>.<br/>
Qed.</div>
<br/>
<h1> Abstracting read-only global variables </h1>
<br/>
<span class="kwd">Definition</span> <span class="id">romem</span> := <span class="id">PTree.t</span> <span class="id">ablock</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">romatch</span>  (<span class="id">m</span>: <span class="id">mem</span>) (<span class="id">rm</span>: <span class="id">romem</span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">id</span> <span class="id">ab</span>,<br/>
&nbsp;&nbsp;<span class="id">bc</span> <span class="id">b</span> = <span class="id">BCglob</span> <span class="id">id</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">rm</span>!<span class="id">id</span> = <span class="id">Some</span> <span class="id">ab</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">pge</span> <span class="id">Glob</span> <span class="id">ab</span>.(<span class="id">ab_summary</span>)<br/>
&nbsp;&nbsp;/\ <span class="id">bmatch</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ab</span><br/>
&nbsp;&nbsp;/\ <span class="kwd">forall</span> <span class="id">ofs</span>, ~<span class="id">Mem.perm</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">Max</span> <span class="id">Writable</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">romatch_store</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">chunk</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span> <span class="id">m</span>' <span class="id">rm</span>,<br/>
&nbsp;&nbsp;<span class="id">Mem.store</span> <span class="id">chunk</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span> = <span class="id">Some</span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">romatch</span> <span class="id">m</span> <span class="id">rm</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">romatch</span> <span class="id">m</span>' <span class="id">rm</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2953')">Proof.</div>
<div class="proofscript" id="proof2953">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id">H0</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">A</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span>). <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">split</span>.<br/>
- <span class="id">exploit</span> <span class="id">Mem.store_valid_access_3</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">P</span> <span class="id">_</span>].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bmatch_inv</span> <span class="kwd">with</span> <span class="id">m</span>; <span class="tactic">auto</span>.<br/>
+ <span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id">Mem.loadbytes_store_other</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">left</span>. <span class="tactic">red</span>; <span class="tactic">intros</span>; <span class="tactic">subst</span> <span class="id">b0</span>. <span class="tactic">elim</span> (<span class="id">C</span> <span class="id">ofs</span>). <span class="tactic">apply</span> <span class="id">Mem.perm_cur_max</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">P</span>. <span class="tactic">generalize</span> (<span class="id">size_chunk_pos</span> <span class="id">chunk</span>); <span class="tactic">omega</span>.<br/>
- <span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>; <span class="tactic">elim</span> (<span class="id">C</span> <span class="id">ofs0</span>). <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">mem</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">romatch_storebytes</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">bytes</span> <span class="id">m</span>' <span class="id">rm</span>,<br/>
&nbsp;&nbsp;<span class="id">Mem.storebytes</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">bytes</span> = <span class="id">Some</span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">romatch</span> <span class="id">m</span> <span class="id">rm</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">romatch</span> <span class="id">m</span>' <span class="id">rm</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2954')">Proof.</div>
<div class="proofscript" id="proof2954">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id">H0</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">A</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span>). <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">split</span>.<br/>
- <span class="tactic">apply</span> <span class="id">bmatch_inv</span> <span class="kwd">with</span> <span class="id">m</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id">Mem.loadbytes_storebytes_disjoint</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">eq_block</span> <span class="id">b0</span> <span class="id">b</span>); <span class="tactic">auto</span>. <span class="tactic">subst</span> <span class="id">b0</span>. <span class="id">right</span>; <span class="tactic">red</span>; <span class="tactic">unfold</span> <span class="id">Intv.In</span>; <span class="tactic">simpl</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">C</span> <span class="id">x</span>). <span class="tactic">apply</span> <span class="id">Mem.perm_cur_max</span>. <span class="tactic">eapply</span> <span class="id">Mem.storebytes_range_perm</span>; <span class="tactic">eauto</span>.<br/>
- <span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>; <span class="tactic">elim</span> (<span class="id">C</span> <span class="id">ofs0</span>). <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">mem</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">romatch_ext</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">rm</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;<span class="id">romatch</span> <span class="id">m</span> <span class="id">rm</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">b</span> <span class="id">id</span> <span class="id">ofs</span> <span class="id">n</span> <span class="id">bytes</span>, <span class="id">bc</span> <span class="id">b</span> = <span class="id">BCglob</span> <span class="id">id</span> -&gt; <span class="id">Mem.loadbytes</span> <span class="id">m</span>' <span class="id">b</span> <span class="id">ofs</span> <span class="id">n</span> = <span class="id">Some</span> <span class="id">bytes</span> -&gt; <span class="id">Mem.loadbytes</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">n</span> = <span class="id">Some</span> <span class="id">bytes</span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">b</span> <span class="id">id</span> <span class="id">ofs</span> <span class="id">p</span>, <span class="id">bc</span> <span class="id">b</span> = <span class="id">BCglob</span> <span class="id">id</span> -&gt; <span class="id">Mem.perm</span> <span class="id">m</span>' <span class="id">b</span> <span class="id">ofs</span> <span class="id">Max</span> <span class="id">p</span> -&gt; <span class="id">Mem.perm</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">Max</span> <span class="id">p</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">romatch</span> <span class="id">m</span>' <span class="id">rm</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2955')">Proof.</div>
<div class="proofscript" id="proof2955">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id">H</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">A</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span>).<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">apply</span> <span class="id">bmatch_ext</span> <span class="kwd">with</span> <span class="id">m</span>; <span class="tactic">auto</span>. <span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">elim</span> (<span class="id">C</span> <span class="id">ofs</span>). <span class="tactic">eapply</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">romatch_free</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">m</span>' <span class="id">rm</span>,<br/>
&nbsp;&nbsp;<span class="id">Mem.free</span> <span class="id">m</span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span> = <span class="id">Some</span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">romatch</span> <span class="id">m</span> <span class="id">rm</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">romatch</span> <span class="id">m</span>' <span class="id">rm</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2956')">Proof.</div>
<div class="proofscript" id="proof2956">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">romatch_ext</span> <span class="kwd">with</span> <span class="id">m</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id">Mem.loadbytes_free_2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">mem</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">romatch_alloc</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">m</span>' <span class="id">rm</span>,<br/>
&nbsp;&nbsp;<span class="id">Mem.alloc</span> <span class="id">m</span> <span class="id">lo</span> <span class="id">hi</span> = (<span class="id">m</span>', <span class="id">b</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">bc_below</span> <span class="id">bc</span> (<span class="id">Mem.nextblock</span> <span class="id">m</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">romatch</span> <span class="id">m</span> <span class="id">rm</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">romatch</span> <span class="id">m</span>' <span class="id">rm</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2957')">Proof.</div>
<div class="proofscript" id="proof2957">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">romatch_ext</span> <span class="kwd">with</span> <span class="id">m</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H3</span>; <span class="tactic">symmetry</span>. <span class="tactic">eapply</span> <span class="id">Mem.loadbytes_alloc_unchanged</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H0</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_alloc_4</span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">Mem.valid_not_valid_diff</span> <span class="kwd">with</span> <span class="id">m</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">mem</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H0</span>. <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<h1> Abstracting memory states </h1>
<br/>
<span class="kwd">Record</span> <span class="id">amem</span> : <span class="kwd">Type</span> := <span class="id">AMem</span> {<br/>
&nbsp;&nbsp;<span class="id">am_stack</span>: <span class="id">ablock</span>;<br/>
&nbsp;&nbsp;<span class="id">am_glob</span>: <span class="id">PTree.t</span> <span class="id">ablock</span>;<br/>
&nbsp;&nbsp;<span class="id">am_nonstack</span>: <span class="id">aptr</span>;<br/>
&nbsp;&nbsp;<span class="id">am_top</span>: <span class="id">aptr</span><br/>
}.<br/>
<br/>
<span class="kwd">Record</span> <span class="id">mmatch</span> (<span class="id">m</span>: <span class="id">mem</span>) (<span class="id">am</span>: <span class="id">amem</span>) : <span class="kwd">Prop</span> := <span class="id">mk_mem_match</span> {<br/>
&nbsp;&nbsp;<span class="id">mmatch_stack</span>: <span class="kwd">forall</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bc</span> <span class="id">b</span> = <span class="id">BCstack</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bmatch</span> <span class="id">m</span> <span class="id">b</span> <span class="id">am</span>.(<span class="id">am_stack</span>);<br/>
&nbsp;&nbsp;<span class="id">mmatch_glob</span>: <span class="kwd">forall</span> <span class="id">id</span> <span class="id">ab</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bc</span> <span class="id">b</span> = <span class="id">BCglob</span> <span class="id">id</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">am</span>.(<span class="id">am_glob</span>)!<span class="id">id</span> = <span class="id">Some</span> <span class="id">ab</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bmatch</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ab</span>;<br/>
&nbsp;&nbsp;<span class="id">mmatch_nonstack</span>: <span class="kwd">forall</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bc</span> <span class="id">b</span> &lt;&gt; <span class="id">BCstack</span> -&gt; <span class="id">bc</span> <span class="id">b</span> &lt;&gt; <span class="id">BCinvalid</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">smatch</span> <span class="id">m</span> <span class="id">b</span> <span class="id">am</span>.(<span class="id">am_nonstack</span>);<br/>
&nbsp;&nbsp;<span class="id">mmatch_top</span>: <span class="kwd">forall</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bc</span> <span class="id">b</span> &lt;&gt; <span class="id">BCinvalid</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">smatch</span> <span class="id">m</span> <span class="id">b</span> <span class="id">am</span>.(<span class="id">am_top</span>);<br/>
&nbsp;&nbsp;<span class="id">mmatch_below</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bc_below</span> <span class="id">bc</span> (<span class="id">Mem.nextblock</span> <span class="id">m</span>)<br/>
}.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">minit</span> (<span class="id">p</span>: <span class="id">aptr</span>) :=<br/>
&nbsp;&nbsp;{| <span class="id">am_stack</span> := <span class="id">ablock_init</span> <span class="id">p</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">am_glob</span> := <span class="id">PTree.empty</span> <span class="id">_</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">am_nonstack</span> := <span class="id">p</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">am_top</span> := <span class="id">p</span> |}.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">mbot</span> := <span class="id">minit</span> <span class="id">Pbot</span>.<br/>
<span class="kwd">Definition</span> <span class="id">mtop</span> := <span class="id">minit</span> <span class="id">Ptop</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">load</span> (<span class="id">chunk</span>: <span class="id">memory_chunk</span>) (<span class="id">rm</span>: <span class="id">romem</span>) (<span class="id">m</span>: <span class="id">amem</span>) (<span class="id">p</span>: <span class="id">aptr</span>) : <span class="id">aval</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">p</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Pbot</span> =&gt; <span class="kwd">if</span> <span class="id">va_strict</span> <span class="id">tt</span> <span class="kwd">then</span> <span class="id">Vbot</span> <span class="kwd">else</span> <span class="id">Vtop</span><br/>
&nbsp;&nbsp;| <span class="id">Gl</span> <span class="id">id</span> <span class="id">ofs</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">rm</span>!<span class="id">id</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">ab</span> =&gt; <span class="id">ablock_load</span> <span class="id">chunk</span> <span class="id">ab</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">m</span>.(<span class="id">am_glob</span>)!<span class="id">id</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">ab</span> =&gt; <span class="id">ablock_load</span> <span class="id">chunk</span> <span class="id">ab</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">vnormalize</span> <span class="id">chunk</span> (<span class="id">Ifptr</span> <span class="id">m</span>.(<span class="id">am_nonstack</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;| <span class="id">Glo</span> <span class="id">id</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">rm</span>!<span class="id">id</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">ab</span> =&gt; <span class="id">ablock_load_anywhere</span> <span class="id">chunk</span> <span class="id">ab</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">m</span>.(<span class="id">am_glob</span>)!<span class="id">id</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">ab</span> =&gt; <span class="id">ablock_load_anywhere</span> <span class="id">chunk</span> <span class="id">ab</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">vnormalize</span> <span class="id">chunk</span> (<span class="id">Ifptr</span> <span class="id">m</span>.(<span class="id">am_nonstack</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;| <span class="id">Stk</span> <span class="id">ofs</span> =&gt; <span class="id">ablock_load</span> <span class="id">chunk</span> <span class="id">m</span>.(<span class="id">am_stack</span>) (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span>)<br/>
&nbsp;&nbsp;| <span class="id">Stack</span> =&gt; <span class="id">ablock_load_anywhere</span> <span class="id">chunk</span> <span class="id">m</span>.(<span class="id">am_stack</span>)<br/>
&nbsp;&nbsp;| <span class="id">Glob</span> | <span class="id">Nonstack</span> =&gt; <span class="id">vnormalize</span> <span class="id">chunk</span> (<span class="id">Ifptr</span> <span class="id">m</span>.(<span class="id">am_nonstack</span>))<br/>
&nbsp;&nbsp;| <span class="id">Ptop</span> =&gt; <span class="id">vnormalize</span> <span class="id">chunk</span> (<span class="id">Ifptr</span> <span class="id">m</span>.(<span class="id">am_top</span>))<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">loadv</span> (<span class="id">chunk</span>: <span class="id">memory_chunk</span>) (<span class="id">rm</span>: <span class="id">romem</span>) (<span class="id">m</span>: <span class="id">amem</span>) (<span class="id">addr</span>: <span class="id">aval</span>) : <span class="id">aval</span> :=<br/>
&nbsp;&nbsp;<span class="id">load</span> <span class="id">chunk</span> <span class="id">rm</span> <span class="id">m</span> (<span class="id">aptr_of_aval</span> <span class="id">addr</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">store</span> (<span class="id">chunk</span>: <span class="id">memory_chunk</span>) (<span class="id">m</span>: <span class="id">amem</span>) (<span class="id">p</span>: <span class="id">aptr</span>) (<span class="id">av</span>: <span class="id">aval</span>) : <span class="id">amem</span> :=<br/>
&nbsp;&nbsp;{| <span class="id">am_stack</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">p</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Stk</span> <span class="id">ofs</span>      =&gt; <span class="id">ablock_store</span> <span class="id">chunk</span> <span class="id">m</span>.(<span class="id">am_stack</span>) (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span>) <span class="id">av</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Stack</span> | <span class="id">Ptop</span> =&gt; <span class="id">ablock_store_anywhere</span> <span class="id">chunk</span> <span class="id">m</span>.(<span class="id">am_stack</span>) <span class="id">av</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">m</span>.(<span class="id">am_stack</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">am_glob</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">p</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Gl</span> <span class="id">id</span> <span class="id">ofs</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ab</span> := <span class="kwd">match</span> <span class="id">m</span>.(<span class="id">am_glob</span>)!<span class="id">id</span> <span class="kwd">with</span> <span class="id">Some</span> <span class="id">ab</span> =&gt; <span class="id">ab</span> | <span class="id">None</span> =&gt; <span class="id">ablock_init</span> <span class="id">m</span>.(<span class="id">am_nonstack</span>) <span class="kwd">end</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">PTree.set</span> <span class="id">id</span> (<span class="id">ablock_store</span> <span class="id">chunk</span> <span class="id">ab</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span>) <span class="id">av</span>) <span class="id">m</span>.(<span class="id">am_glob</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Glo</span> <span class="id">id</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ab</span> := <span class="kwd">match</span> <span class="id">m</span>.(<span class="id">am_glob</span>)!<span class="id">id</span> <span class="kwd">with</span> <span class="id">Some</span> <span class="id">ab</span> =&gt; <span class="id">ab</span> | <span class="id">None</span> =&gt; <span class="id">ablock_init</span> <span class="id">m</span>.(<span class="id">am_nonstack</span>) <span class="kwd">end</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">PTree.set</span> <span class="id">id</span> (<span class="id">ablock_store_anywhere</span> <span class="id">chunk</span> <span class="id">ab</span> <span class="id">av</span>) <span class="id">m</span>.(<span class="id">am_glob</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Glob</span> | <span class="id">Nonstack</span> | <span class="id">Ptop</span> =&gt; <span class="id">PTree.empty</span> <span class="id">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">m</span>.(<span class="id">am_glob</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">am_nonstack</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">p</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Gl</span> <span class="id">_</span> <span class="id">_</span> | <span class="id">Glo</span> <span class="id">_</span> | <span class="id">Glob</span> | <span class="id">Nonstack</span> | <span class="id">Ptop</span> =&gt; <span class="id">vplub</span> <span class="id">av</span> <span class="id">m</span>.(<span class="id">am_nonstack</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">m</span>.(<span class="id">am_nonstack</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">am_top</span> := <span class="id">vplub</span> <span class="id">av</span> <span class="id">m</span>.(<span class="id">am_top</span>)<br/>
&nbsp;&nbsp;|}.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">storev</span> (<span class="id">chunk</span>: <span class="id">memory_chunk</span>) (<span class="id">m</span>: <span class="id">amem</span>) (<span class="id">addr</span>: <span class="id">aval</span>) (<span class="id">v</span>: <span class="id">aval</span>): <span class="id">amem</span> :=<br/>
&nbsp;&nbsp;<span class="id">store</span> <span class="id">chunk</span> <span class="id">m</span> (<span class="id">aptr_of_aval</span> <span class="id">addr</span>) <span class="id">v</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">loadbytes</span> (<span class="id">m</span>: <span class="id">amem</span>) (<span class="id">rm</span>: <span class="id">romem</span>) (<span class="id">p</span>: <span class="id">aptr</span>) : <span class="id">aptr</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">p</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Pbot</span> =&gt; <span class="kwd">if</span> <span class="id">va_strict</span> <span class="id">tt</span> <span class="kwd">then</span> <span class="id">Pbot</span> <span class="kwd">else</span> <span class="id">Ptop</span><br/>
&nbsp;&nbsp;| <span class="id">Gl</span> <span class="id">id</span> <span class="id">_</span> | <span class="id">Glo</span> <span class="id">id</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">rm</span>!<span class="id">id</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">ab</span> =&gt; <span class="id">ablock_loadbytes</span> <span class="id">ab</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">m</span>.(<span class="id">am_glob</span>)!<span class="id">id</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">ab</span> =&gt; <span class="id">ablock_loadbytes</span> <span class="id">ab</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">m</span>.(<span class="id">am_nonstack</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;| <span class="id">Stk</span> <span class="id">_</span> | <span class="id">Stack</span> =&gt; <span class="id">ablock_loadbytes</span> <span class="id">m</span>.(<span class="id">am_stack</span>)<br/>
&nbsp;&nbsp;| <span class="id">Glob</span> | <span class="id">Nonstack</span> =&gt; <span class="id">m</span>.(<span class="id">am_nonstack</span>)<br/>
&nbsp;&nbsp;| <span class="id">Ptop</span> =&gt; <span class="id">m</span>.(<span class="id">am_top</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">storebytes</span> (<span class="id">m</span>: <span class="id">amem</span>) (<span class="id">dst</span>: <span class="id">aptr</span>) (<span class="id">sz</span>: <span class="id">Z</span>) (<span class="id">p</span>: <span class="id">aptr</span>) : <span class="id">amem</span> :=<br/>
&nbsp;&nbsp;{| <span class="id">am_stack</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">dst</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Stk</span> <span class="id">ofs</span>      =&gt; <span class="id">ablock_storebytes</span> <span class="id">m</span>.(<span class="id">am_stack</span>) <span class="id">p</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span>) <span class="id">sz</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Stack</span> | <span class="id">Ptop</span> =&gt; <span class="id">ablock_storebytes_anywhere</span> <span class="id">m</span>.(<span class="id">am_stack</span>) <span class="id">p</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">m</span>.(<span class="id">am_stack</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">am_glob</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">dst</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Gl</span> <span class="id">id</span> <span class="id">ofs</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ab</span> := <span class="kwd">match</span> <span class="id">m</span>.(<span class="id">am_glob</span>)!<span class="id">id</span> <span class="kwd">with</span> <span class="id">Some</span> <span class="id">ab</span> =&gt; <span class="id">ab</span> | <span class="id">None</span> =&gt; <span class="id">ablock_init</span> <span class="id">m</span>.(<span class="id">am_nonstack</span>) <span class="kwd">end</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">PTree.set</span> <span class="id">id</span> (<span class="id">ablock_storebytes</span> <span class="id">ab</span> <span class="id">p</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span>) <span class="id">sz</span>) <span class="id">m</span>.(<span class="id">am_glob</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Glo</span> <span class="id">id</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ab</span> := <span class="kwd">match</span> <span class="id">m</span>.(<span class="id">am_glob</span>)!<span class="id">id</span> <span class="kwd">with</span> <span class="id">Some</span> <span class="id">ab</span> =&gt; <span class="id">ab</span> | <span class="id">None</span> =&gt; <span class="id">ablock_init</span> <span class="id">m</span>.(<span class="id">am_nonstack</span>) <span class="kwd">end</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">PTree.set</span> <span class="id">id</span> (<span class="id">ablock_storebytes_anywhere</span> <span class="id">ab</span> <span class="id">p</span>) <span class="id">m</span>.(<span class="id">am_glob</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Glob</span> | <span class="id">Nonstack</span> | <span class="id">Ptop</span> =&gt; <span class="id">PTree.empty</span> <span class="id">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">m</span>.(<span class="id">am_glob</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">am_nonstack</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">dst</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Gl</span> <span class="id">_</span> <span class="id">_</span> | <span class="id">Glo</span> <span class="id">_</span> | <span class="id">Glob</span> | <span class="id">Nonstack</span> | <span class="id">Ptop</span> =&gt; <span class="id">plub</span> <span class="id">p</span> <span class="id">m</span>.(<span class="id">am_nonstack</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">m</span>.(<span class="id">am_nonstack</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">am_top</span> := <span class="id">plub</span> <span class="id">p</span> <span class="id">m</span>.(<span class="id">am_top</span>)<br/>
&nbsp;&nbsp;|}.<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id">load_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">chunk</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span> <span class="id">rm</span> <span class="id">am</span> <span class="id">p</span>,<br/>
&nbsp;&nbsp;<span class="id">Mem.load</span> <span class="id">chunk</span> <span class="id">m</span> <span class="id">b</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span>) = <span class="id">Some</span> <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">romatch</span> <span class="id">m</span> <span class="id">rm</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">mmatch</span> <span class="id">m</span> <span class="id">am</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">pmatch</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">p</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> <span class="id">v</span> (<span class="id">load</span> <span class="id">chunk</span> <span class="id">rm</span> <span class="id">am</span> <span class="id">p</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2958')">Proof.</div>
<div class="proofscript" id="proof2958">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">load</span>. <span class="id">inv</span> <span class="id">H2</span>.<br/>
- <span class="comment">(*&nbsp;Gl&nbsp;id&nbsp;ofs&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">rm</span>!<span class="id">id</span>) <span class="kwd">as</span> [<span class="id">ab</span>|] <span class="id">eqn</span>:<span class="id">RM</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ablock_load_sound</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">am_glob</span> <span class="id">am</span>)!<span class="id">id</span> <span class="kwd">as</span> [<span class="id">ab</span>|] <span class="id">eqn</span>:<span class="id">AM</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ablock_load_sound</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">mmatch_glob</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">vnormalize_cast</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">mmatch_nonstack</span>; <span class="tactic">eauto</span>; <span class="tactic">congruence</span>.<br/>
- <span class="comment">(*&nbsp;Glo&nbsp;id&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">rm</span>!<span class="id">id</span>) <span class="kwd">as</span> [<span class="id">ab</span>|] <span class="id">eqn</span>:<span class="id">RM</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ablock_load_anywhere_sound</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">am_glob</span> <span class="id">am</span>)!<span class="id">id</span> <span class="kwd">as</span> [<span class="id">ab</span>|] <span class="id">eqn</span>:<span class="id">AM</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ablock_load_anywhere_sound</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">mmatch_glob</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">vnormalize_cast</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">mmatch_nonstack</span>; <span class="tactic">eauto</span>; <span class="tactic">congruence</span>.<br/>
- <span class="comment">(*&nbsp;Glob&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">vnormalize_cast</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">mmatch_nonstack</span>; <span class="tactic">eauto</span>. <span class="tactic">congruence</span>. <span class="tactic">congruence</span>.<br/>
- <span class="comment">(*&nbsp;Stk&nbsp;ofs&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ablock_load_sound</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">mmatch_stack</span>; <span class="tactic">eauto</span>.<br/>
- <span class="comment">(*&nbsp;Stack&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ablock_load_anywhere_sound</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">mmatch_stack</span>; <span class="tactic">eauto</span>.<br/>
- <span class="comment">(*&nbsp;Nonstack&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">vnormalize_cast</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">mmatch_nonstack</span>; <span class="tactic">eauto</span>.<br/>
- <span class="comment">(*&nbsp;Top&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">vnormalize_cast</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">mmatch_top</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id">loadv_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">chunk</span> <span class="id">m</span> <span class="id">addr</span> <span class="id">v</span> <span class="id">rm</span> <span class="id">am</span> <span class="id">aaddr</span>,<br/>
&nbsp;&nbsp;<span class="id">Mem.loadv</span> <span class="id">chunk</span> <span class="id">m</span> <span class="id">addr</span> = <span class="id">Some</span> <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">romatch</span> <span class="id">m</span> <span class="id">rm</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">mmatch</span> <span class="id">m</span> <span class="id">am</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> <span class="id">addr</span> <span class="id">aaddr</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> <span class="id">v</span> (<span class="id">loadv</span> <span class="id">chunk</span> <span class="id">rm</span> <span class="id">am</span> <span class="id">aaddr</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2959')">Proof.</div>
<div class="proofscript" id="proof2959">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">addr</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">load_sound</span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">match_aptr_of_aval</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id">store_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">chunk</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">v</span> <span class="id">m</span>' <span class="id">am</span> <span class="id">p</span> <span class="id">av</span>,<br/>
&nbsp;&nbsp;<span class="id">Mem.store</span> <span class="id">chunk</span> <span class="id">m</span> <span class="id">b</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span>) <span class="id">v</span> = <span class="id">Some</span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">mmatch</span> <span class="id">m</span> <span class="id">am</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">pmatch</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">p</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> <span class="id">v</span> <span class="id">av</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">mmatch</span> <span class="id">m</span>' (<span class="id">store</span> <span class="id">chunk</span> <span class="id">am</span> <span class="id">p</span> <span class="id">av</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2960')">Proof.</div>
<div class="proofscript" id="proof2960">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">av</span>; <span class="tactic">intros</span> <span class="id">STORE</span> <span class="id">MM</span> <span class="id">PM</span> <span class="id">VM</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">store</span>; <span class="id">constructor</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
- <span class="comment">(*&nbsp;Stack&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">DFL</span>: <span class="id">bc</span> <span class="id">b</span> &lt;&gt; <span class="id">BCstack</span> -&gt; <span class="id">bmatch</span> <span class="id">m</span>' <span class="id">b0</span> (<span class="id">am_stack</span> <span class="id">am</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">bmatch_inv</span> <span class="kwd">with</span> <span class="id">m</span>. <span class="tactic">eapply</span> <span class="id">mmatch_stack</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id">Mem.loadbytes_store_other</span>; <span class="tactic">eauto</span>. <span class="id">left</span>; <span class="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">PM</span>; <span class="tactic">try</span> (<span class="tactic">apply</span> <span class="id">DFL</span>; <span class="tactic">congruence</span>).<br/>
&nbsp;&nbsp;+ <span class="tactic">assert</span> (<span class="id">b0</span> = <span class="id">b</span>) <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id">bc_stack</span>; <span class="tactic">eauto</span>). <span class="tactic">subst</span> <span class="id">b0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ablock_store_sound</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">mmatch_stack</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">assert</span> (<span class="id">b0</span> = <span class="id">b</span>) <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id">bc_stack</span>; <span class="tactic">eauto</span>). <span class="tactic">subst</span> <span class="id">b0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ablock_store_anywhere_sound</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">mmatch_stack</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">ablock_store_anywhere_sound</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">mmatch_stack</span>; <span class="tactic">eauto</span>.<br/>
<br/>
- <span class="comment">(*&nbsp;Globals&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">b0</span> <span class="id">into</span> <span class="id">b</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">DFL</span>: <span class="id">bc</span> <span class="id">b</span> &lt;&gt; <span class="id">BCglob</span> <span class="id">id</span> -&gt; (<span class="id">am_glob</span> <span class="id">am</span>)!<span class="id">id</span> = <span class="id">Some</span> <span class="id">ab</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bmatch</span> <span class="id">m</span>' <span class="id">b</span>' <span class="id">ab</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">bmatch_inv</span> <span class="kwd">with</span> <span class="id">m</span>. <span class="tactic">eapply</span> <span class="id">mmatch_glob</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id">Mem.loadbytes_store_other</span>; <span class="tactic">eauto</span>. <span class="id">left</span>; <span class="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">PM</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">PTree.gsspec</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> (<span class="id">peq</span> <span class="id">id</span> <span class="id">id0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">id0</span>; <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">b</span>' = <span class="id">b</span>) <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id">bc_glob</span>; <span class="tactic">eauto</span>). <span class="tactic">subst</span> <span class="id">b</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ablock_store_sound</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">am_glob</span> <span class="id">am</span>)!<span class="id">id</span> <span class="kwd">as</span> [<span class="id">ab0</span>|] <span class="id">eqn</span>:<span class="id">GL</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">mmatch_glob</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">ablock_init_sound</span>. <span class="tactic">eapply</span> <span class="id">mmatch_nonstack</span>; <span class="tactic">eauto</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">DFL</span>; <span class="tactic">eauto</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">PTree.gsspec</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> (<span class="id">peq</span> <span class="id">id</span> <span class="id">id0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">id0</span>; <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">b</span>' = <span class="id">b</span>) <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id">bc_glob</span>; <span class="tactic">eauto</span>). <span class="tactic">subst</span> <span class="id">b</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ablock_store_anywhere_sound</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">am_glob</span> <span class="id">am</span>)!<span class="id">id</span> <span class="kwd">as</span> [<span class="id">ab0</span>|] <span class="id">eqn</span>:<span class="id">GL</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">mmatch_glob</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">ablock_init_sound</span>. <span class="tactic">eapply</span> <span class="id">mmatch_nonstack</span>; <span class="tactic">eauto</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">DFL</span>; <span class="tactic">eauto</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">PTree.gempty</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">DFL</span>; <span class="tactic">eauto</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">DFL</span>; <span class="tactic">eauto</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">PTree.gempty</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">PTree.gempty</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">congruence</span>.<br/>
<br/>
- <span class="comment">(*&nbsp;Nonstack&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">DFL</span>: <span class="id">smatch</span> <span class="id">m</span>' <span class="id">b0</span> (<span class="id">vplub</span> <span class="id">av</span> (<span class="id">am_nonstack</span> <span class="id">am</span>))).<br/>
&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">smatch_store</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">mmatch_nonstack</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">STK</span>: <span class="id">bc</span> <span class="id">b</span> = <span class="id">BCstack</span> -&gt; <span class="id">smatch</span> <span class="id">m</span>' <span class="id">b0</span> (<span class="id">am_nonstack</span> <span class="id">am</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">smatch_inv</span> <span class="kwd">with</span> <span class="id">m</span>. <span class="tactic">eapply</span> <span class="id">mmatch_nonstack</span>; <span class="tactic">eauto</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id">Mem.loadbytes_store_other</span>; <span class="tactic">eauto</span>. <span class="id">left</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">PM</span>; (<span class="tactic">apply</span> <span class="id">DFL</span> || <span class="tactic">apply</span> <span class="id">STK</span>; <span class="tactic">congruence</span>).<br/>
<br/>
- <span class="comment">(*&nbsp;Top&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">smatch_store</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">mmatch_top</span>; <span class="tactic">eauto</span>.<br/>
<br/>
- <span class="comment">(*&nbsp;Below&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id">Mem.nextblock_store</span> <span class="tactic">by</span> <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">mmatch_below</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id">storev_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">chunk</span> <span class="id">m</span> <span class="id">addr</span> <span class="id">v</span> <span class="id">m</span>' <span class="id">am</span> <span class="id">aaddr</span> <span class="id">av</span>,<br/>
&nbsp;&nbsp;<span class="id">Mem.storev</span> <span class="id">chunk</span> <span class="id">m</span> <span class="id">addr</span> <span class="id">v</span> = <span class="id">Some</span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">mmatch</span> <span class="id">m</span> <span class="id">am</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> <span class="id">addr</span> <span class="id">aaddr</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">vmatch</span> <span class="id">v</span> <span class="id">av</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">mmatch</span> <span class="id">m</span>' (<span class="id">storev</span> <span class="id">chunk</span> <span class="id">am</span> <span class="id">aaddr</span> <span class="id">av</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2961')">Proof.</div>
<div class="proofscript" id="proof2961">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">addr</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">store_sound</span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">match_aptr_of_aval</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id">loadbytes_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">sz</span> <span class="id">bytes</span> <span class="id">am</span> <span class="id">rm</span> <span class="id">p</span>,<br/>
&nbsp;&nbsp;<span class="id">Mem.loadbytes</span> <span class="id">m</span> <span class="id">b</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span>) <span class="id">sz</span> = <span class="id">Some</span> <span class="id">bytes</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">romatch</span> <span class="id">m</span> <span class="id">rm</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">mmatch</span> <span class="id">m</span> <span class="id">am</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">pmatch</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">p</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span>  <span class="id">b</span>' <span class="id">ofs</span>' <span class="id">q</span> <span class="id">i</span>, <span class="id">In</span> (<span class="id">Fragment</span> (<span class="id">Vptr</span> <span class="id">b</span>' <span class="id">ofs</span>') <span class="id">q</span> <span class="id">i</span>) <span class="id">bytes</span> -&gt; <span class="id">pmatch</span> <span class="id">b</span>' <span class="id">ofs</span>' (<span class="id">loadbytes</span> <span class="id">am</span> <span class="id">rm</span> <span class="id">p</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2962')">Proof.</div>
<div class="proofscript" id="proof2962">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">loadbytes</span>; <span class="id">inv</span> <span class="id">H2</span>.<br/>
- <span class="comment">(*&nbsp;Gl&nbsp;id&nbsp;ofs&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">rm</span>!<span class="id">id</span>) <span class="kwd">as</span> [<span class="id">ab</span>|] <span class="id">eqn</span>:<span class="id">RM</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">H0</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">A</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span>). <span class="tactic">eapply</span> <span class="id">ablock_loadbytes_sound</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">am_glob</span> <span class="id">am</span>)!<span class="id">id</span> <span class="kwd">as</span> [<span class="id">ab</span>|] <span class="id">eqn</span>:<span class="id">GL</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ablock_loadbytes_sound</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">mmatch_glob</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">smatch_loadbytes</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">mmatch_nonstack</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="comment">(*&nbsp;Glo&nbsp;id&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">rm</span>!<span class="id">id</span>) <span class="kwd">as</span> [<span class="id">ab</span>|] <span class="id">eqn</span>:<span class="id">RM</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">H0</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">A</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span>). <span class="tactic">eapply</span> <span class="id">ablock_loadbytes_sound</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">am_glob</span> <span class="id">am</span>)!<span class="id">id</span> <span class="kwd">as</span> [<span class="id">ab</span>|] <span class="id">eqn</span>:<span class="id">GL</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ablock_loadbytes_sound</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">mmatch_glob</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">smatch_loadbytes</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">mmatch_nonstack</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="comment">(*&nbsp;Glob&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">smatch_loadbytes</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">mmatch_nonstack</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="comment">(*&nbsp;Stk&nbsp;ofs&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ablock_loadbytes_sound</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">mmatch_stack</span>; <span class="tactic">eauto</span>.<br/>
- <span class="comment">(*&nbsp;Stack&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ablock_loadbytes_sound</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">mmatch_stack</span>; <span class="tactic">eauto</span>.<br/>
- <span class="comment">(*&nbsp;Nonstack&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">smatch_loadbytes</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">mmatch_nonstack</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="comment">(*&nbsp;Top&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">smatch_loadbytes</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">mmatch_top</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id">storebytes_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">bytes</span> <span class="id">m</span>' <span class="id">am</span> <span class="id">p</span> <span class="id">sz</span> <span class="id">q</span>,<br/>
&nbsp;&nbsp;<span class="id">Mem.storebytes</span> <span class="id">m</span> <span class="id">b</span> (<span class="id">Ptrofs.unsigned</span> <span class="id">ofs</span>) <span class="id">bytes</span> = <span class="id">Some</span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">mmatch</span> <span class="id">m</span> <span class="id">am</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">pmatch</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">p</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">length</span> <span class="id">bytes</span> = <span class="id">nat_of_Z</span> <span class="id">sz</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">b</span>' <span class="id">ofs</span>' <span class="id">qt</span> <span class="id">i</span>, <span class="id">In</span> (<span class="id">Fragment</span> (<span class="id">Vptr</span> <span class="id">b</span>' <span class="id">ofs</span>') <span class="id">qt</span> <span class="id">i</span>) <span class="id">bytes</span> -&gt; <span class="id">pmatch</span> <span class="id">b</span>' <span class="id">ofs</span>' <span class="id">q</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">mmatch</span> <span class="id">m</span>' (<span class="id">storebytes</span> <span class="id">am</span> <span class="id">p</span> <span class="id">sz</span> <span class="id">q</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2963')">Proof.</div>
<div class="proofscript" id="proof2963">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">q</span>; <span class="tactic">intros</span> <span class="id">STORE</span> <span class="id">MM</span> <span class="id">PM</span> <span class="id">LENGTH</span> <span class="id">BYTES</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">storebytes</span>; <span class="id">constructor</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
- <span class="comment">(*&nbsp;Stack&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">DFL</span>: <span class="id">bc</span> <span class="id">b</span> &lt;&gt; <span class="id">BCstack</span> -&gt; <span class="id">bmatch</span> <span class="id">m</span>' <span class="id">b0</span> (<span class="id">am_stack</span> <span class="id">am</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">bmatch_inv</span> <span class="kwd">with</span> <span class="id">m</span>. <span class="tactic">eapply</span> <span class="id">mmatch_stack</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id">Mem.loadbytes_storebytes_other</span>; <span class="tactic">eauto</span>. <span class="id">left</span>; <span class="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">PM</span>; <span class="tactic">try</span> (<span class="tactic">apply</span> <span class="id">DFL</span>; <span class="tactic">congruence</span>).<br/>
&nbsp;&nbsp;+ <span class="tactic">assert</span> (<span class="id">b0</span> = <span class="id">b</span>) <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id">bc_stack</span>; <span class="tactic">eauto</span>). <span class="tactic">subst</span> <span class="id">b0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ablock_storebytes_sound</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">mmatch_stack</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">assert</span> (<span class="id">b0</span> = <span class="id">b</span>) <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id">bc_stack</span>; <span class="tactic">eauto</span>). <span class="tactic">subst</span> <span class="id">b0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ablock_storebytes_anywhere_sound</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">mmatch_stack</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">ablock_storebytes_anywhere_sound</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">mmatch_stack</span>; <span class="tactic">eauto</span>.<br/>
<br/>
- <span class="comment">(*&nbsp;Globals&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">b0</span> <span class="id">into</span> <span class="id">b</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">DFL</span>: <span class="id">bc</span> <span class="id">b</span> &lt;&gt; <span class="id">BCglob</span> <span class="id">id</span> -&gt; (<span class="id">am_glob</span> <span class="id">am</span>)!<span class="id">id</span> = <span class="id">Some</span> <span class="id">ab</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bmatch</span> <span class="id">m</span>' <span class="id">b</span>' <span class="id">ab</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">bmatch_inv</span> <span class="kwd">with</span> <span class="id">m</span>. <span class="tactic">eapply</span> <span class="id">mmatch_glob</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id">Mem.loadbytes_storebytes_other</span>; <span class="tactic">eauto</span>. <span class="id">left</span>; <span class="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">PM</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">PTree.gsspec</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> (<span class="id">peq</span> <span class="id">id</span> <span class="id">id0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">id0</span>; <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">b</span>' = <span class="id">b</span>) <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id">bc_glob</span>; <span class="tactic">eauto</span>). <span class="tactic">subst</span> <span class="id">b</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ablock_storebytes_sound</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">am_glob</span> <span class="id">am</span>)!<span class="id">id</span> <span class="kwd">as</span> [<span class="id">ab0</span>|] <span class="id">eqn</span>:<span class="id">GL</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">mmatch_glob</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">ablock_init_sound</span>. <span class="tactic">eapply</span> <span class="id">mmatch_nonstack</span>; <span class="tactic">eauto</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">DFL</span>; <span class="tactic">eauto</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">PTree.gsspec</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> (<span class="id">peq</span> <span class="id">id</span> <span class="id">id0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">id0</span>; <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">b</span>' = <span class="id">b</span>) <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id">bc_glob</span>; <span class="tactic">eauto</span>). <span class="tactic">subst</span> <span class="id">b</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">ablock_storebytes_anywhere_sound</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">am_glob</span> <span class="id">am</span>)!<span class="id">id</span> <span class="kwd">as</span> [<span class="id">ab0</span>|] <span class="id">eqn</span>:<span class="id">GL</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">mmatch_glob</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">ablock_init_sound</span>. <span class="tactic">eapply</span> <span class="id">mmatch_nonstack</span>; <span class="tactic">eauto</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">DFL</span>; <span class="tactic">eauto</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">PTree.gempty</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">DFL</span>; <span class="tactic">eauto</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">DFL</span>; <span class="tactic">eauto</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">PTree.gempty</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">PTree.gempty</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">congruence</span>.<br/>
<br/>
- <span class="comment">(*&nbsp;Nonstack&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">DFL</span>: <span class="id">smatch</span> <span class="id">m</span>' <span class="id">b0</span> (<span class="id">plub</span> <span class="id">q</span> (<span class="id">am_nonstack</span> <span class="id">am</span>))).<br/>
&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">smatch_storebytes</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">mmatch_nonstack</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">STK</span>: <span class="id">bc</span> <span class="id">b</span> = <span class="id">BCstack</span> -&gt; <span class="id">smatch</span> <span class="id">m</span>' <span class="id">b0</span> (<span class="id">am_nonstack</span> <span class="id">am</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">smatch_inv</span> <span class="kwd">with</span> <span class="id">m</span>. <span class="tactic">eapply</span> <span class="id">mmatch_nonstack</span>; <span class="tactic">eauto</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id">Mem.loadbytes_storebytes_other</span>; <span class="tactic">eauto</span>. <span class="id">left</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">PM</span>; (<span class="tactic">apply</span> <span class="id">DFL</span> || <span class="tactic">apply</span> <span class="id">STK</span>; <span class="tactic">congruence</span>).<br/>
<br/>
- <span class="comment">(*&nbsp;Top&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">smatch_storebytes</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">mmatch_top</span>; <span class="tactic">eauto</span>.<br/>
<br/>
- <span class="comment">(*&nbsp;Below&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id">Mem.nextblock_storebytes</span> <span class="tactic">by</span> <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">mmatch_below</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">mmatch_ext</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">am</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;<span class="id">mmatch</span> <span class="id">m</span> <span class="id">am</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">n</span> <span class="id">bytes</span>, <span class="id">bc</span> <span class="id">b</span> &lt;&gt; <span class="id">BCinvalid</span> -&gt; <span class="id">n</span> &gt;= 0 -&gt; <span class="id">Mem.loadbytes</span> <span class="id">m</span>' <span class="id">b</span> <span class="id">ofs</span> <span class="id">n</span> = <span class="id">Some</span> <span class="id">bytes</span> -&gt; <span class="id">Mem.loadbytes</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">n</span> = <span class="id">Some</span> <span class="id">bytes</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">Ple</span> (<span class="id">Mem.nextblock</span> <span class="id">m</span>) (<span class="id">Mem.nextblock</span> <span class="id">m</span>') -&gt;<br/>
&nbsp;&nbsp;<span class="id">mmatch</span> <span class="id">m</span>' <span class="id">am</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2964')">Proof.</div>
<div class="proofscript" id="proof2964">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="id">constructor</span>; <span class="tactic">intros</span>.<br/>
- <span class="tactic">apply</span> <span class="id">bmatch_ext</span> <span class="kwd">with</span> <span class="id">m</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="tactic">apply</span> <span class="id">bmatch_ext</span> <span class="kwd">with</span> <span class="id">m</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="tactic">apply</span> <span class="id">smatch_ext</span> <span class="kwd">with</span> <span class="id">m</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="tactic">apply</span> <span class="id">smatch_ext</span> <span class="kwd">with</span> <span class="id">m</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
- <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id">mmatch_below0</span>; <span class="tactic">eauto</span>. <span class="id">xomega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">mmatch_free</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">m</span>' <span class="id">am</span>,<br/>
&nbsp;&nbsp;<span class="id">Mem.free</span> <span class="id">m</span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span> = <span class="id">Some</span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">mmatch</span> <span class="id">m</span> <span class="id">am</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">mmatch</span> <span class="id">m</span>' <span class="id">am</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2965')">Proof.</div>
<div class="proofscript" id="proof2965">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">mmatch_ext</span> <span class="kwd">with</span> <span class="id">m</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id">Mem.loadbytes_free_2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id">Mem.nextblock_free</span> <span class="tactic">by</span> <span class="tactic">eauto</span>. <span class="id">xomega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">mmatch_top</span>':<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">am</span>, <span class="id">mmatch</span> <span class="id">m</span> <span class="id">am</span> -&gt; <span class="id">mmatch</span> <span class="id">m</span> <span class="id">mtop</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2966')">Proof.</div>
<div class="proofscript" id="proof2966">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">constructor</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
- <span class="tactic">apply</span> <span class="id">ablock_init_sound</span>. <span class="tactic">apply</span> <span class="id">smatch_ge</span> <span class="kwd">with</span> (<span class="id">ab_summary</span> (<span class="id">am_stack</span> <span class="id">am</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">mmatch_stack</span>; <span class="tactic">eauto</span>. <span class="id">constructor</span>.<br/>
- <span class="tactic">rewrite</span> <span class="id">PTree.gempty</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">discriminate</span>.<br/>
- <span class="tactic">eapply</span> <span class="id">smatch_ge</span>. <span class="tactic">eapply</span> <span class="id">mmatch_nonstack</span>; <span class="tactic">eauto</span>. <span class="id">constructor</span>.<br/>
- <span class="tactic">eapply</span> <span class="id">smatch_ge</span>. <span class="tactic">eapply</span> <span class="id">mmatch_top</span>; <span class="tactic">eauto</span>. <span class="id">constructor</span>.<br/>
- <span class="tactic">eapply</span> <span class="id">mmatch_below</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Boolean equality </div>
<br/>
<span class="kwd">Definition</span> <span class="id">mbeq</span> (<span class="id">m1</span> <span class="id">m2</span>: <span class="id">amem</span>) : <span class="id">bool</span> :=<br/>
&nbsp;&nbsp;<span class="id">eq_aptr</span> <span class="id">m1</span>.(<span class="id">am_top</span>) <span class="id">m2</span>.(<span class="id">am_top</span>)<br/>
&nbsp;&nbsp;&amp;&amp; <span class="id">eq_aptr</span> <span class="id">m1</span>.(<span class="id">am_nonstack</span>) <span class="id">m2</span>.(<span class="id">am_nonstack</span>)<br/>
&nbsp;&nbsp;&amp;&amp; <span class="id">bbeq</span> <span class="id">m1</span>.(<span class="id">am_stack</span>) <span class="id">m2</span>.(<span class="id">am_stack</span>)<br/>
&nbsp;&nbsp;&amp;&amp; <span class="id">PTree.beq</span> <span class="id">bbeq</span> <span class="id">m1</span>.(<span class="id">am_glob</span>) <span class="id">m2</span>.(<span class="id">am_glob</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">mbeq_sound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m1</span> <span class="id">m2</span>, <span class="id">mbeq</span> <span class="id">m1</span> <span class="id">m2</span> = <span class="id">true</span> -&gt; <span class="kwd">forall</span> <span class="id">m</span>, <span class="id">mmatch</span> <span class="id">m</span> <span class="id">m1</span> &lt;-&gt; <span class="id">mmatch</span> <span class="id">m</span> <span class="id">m2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2967')">Proof.</div>
<div class="proofscript" id="proof2967">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">mbeq</span>; <span class="tactic">intros</span>. <span class="id">InvBooleans</span>. <span class="tactic">rewrite</span> <span class="id">PTree.beq_correct</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span> <span class="id">M</span>; <span class="id">inv</span> <span class="id">M</span>; <span class="id">constructor</span>; <span class="tactic">intros</span>.<br/>
- <span class="id">erewrite</span> &lt;- <span class="id">bbeq_sound</span>; <span class="tactic">eauto</span>.<br/>
- <span class="id">specialize</span> (<span class="id">H1</span> <span class="id">id</span>). <span class="tactic">rewrite</span> <span class="id">H4</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">destruct</span> (<span class="id">am_glob</span> <span class="id">m1</span>)!<span class="id">id</span> <span class="id">eqn</span>:<span class="id">G</span>; <span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id">bbeq_sound</span>; <span class="tactic">eauto</span>.<br/>
- <span class="tactic">rewrite</span> &lt;- <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
- <span class="tactic">rewrite</span> &lt;- <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
- <span class="tactic">auto</span>.<br/>
- <span class="id">erewrite</span> <span class="id">bbeq_sound</span>; <span class="tactic">eauto</span>.<br/>
- <span class="id">specialize</span> (<span class="id">H1</span> <span class="id">id</span>). <span class="tactic">rewrite</span> <span class="id">H4</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">destruct</span> (<span class="id">am_glob</span> <span class="id">m2</span>)!<span class="id">id</span> <span class="id">eqn</span>:<span class="id">G</span>; <span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id">bbeq_sound</span>; <span class="tactic">eauto</span>.<br/>
- <span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
- <span class="tactic">rewrite</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
- <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Least upper bound </div>
<br/>
<span class="kwd">Definition</span> <span class="id">combine_ablock</span> (<span class="id">ob1</span> <span class="id">ob2</span>: <span class="id">option</span> <span class="id">ablock</span>) : <span class="id">option</span> <span class="id">ablock</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">ob1</span>, <span class="id">ob2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">b1</span>, <span class="id">Some</span> <span class="id">b2</span> =&gt; <span class="id">Some</span> (<span class="id">blub</span> <span class="id">b1</span> <span class="id">b2</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">mlub</span> (<span class="id">m1</span> <span class="id">m2</span>: <span class="id">amem</span>) : <span class="id">amem</span> :=<br/>
{| <span class="id">am_stack</span> := <span class="id">blub</span> <span class="id">m1</span>.(<span class="id">am_stack</span>) <span class="id">m2</span>.(<span class="id">am_stack</span>);<br/>
&nbsp;&nbsp;&nbsp;<span class="id">am_glob</span>  := <span class="id">PTree.combine</span> <span class="id">combine_ablock</span> <span class="id">m1</span>.(<span class="id">am_glob</span>) <span class="id">m2</span>.(<span class="id">am_glob</span>);<br/>
&nbsp;&nbsp;&nbsp;<span class="id">am_nonstack</span> := <span class="id">plub</span> <span class="id">m1</span>.(<span class="id">am_nonstack</span>) <span class="id">m2</span>.(<span class="id">am_nonstack</span>);<br/>
&nbsp;&nbsp;&nbsp;<span class="id">am_top</span> := <span class="id">plub</span> <span class="id">m1</span>.(<span class="id">am_top</span>) <span class="id">m2</span>.(<span class="id">am_top</span>) |}.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">mmatch_lub_l</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">mmatch</span> <span class="id">m</span> <span class="id">x</span> -&gt; <span class="id">mmatch</span> <span class="id">m</span> (<span class="id">mlub</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2968')">Proof.</div>
<div class="proofscript" id="proof2968">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="id">constructor</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
- <span class="tactic">apply</span> <span class="id">bmatch_lub_l</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">rewrite</span> <span class="id">PTree.gcombine</span> <span class="kwd">in</span> <span class="id">H0</span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">unfold</span> <span class="id">combine_ablock</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">am_glob</span> <span class="id">x</span>)!<span class="id">id</span> <span class="kwd">as</span> [<span class="id">b1</span>|] <span class="id">eqn</span>:<span class="id">G1</span>;<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">am_glob</span> <span class="id">y</span>)!<span class="id">id</span> <span class="kwd">as</span> [<span class="id">b2</span>|] <span class="id">eqn</span>:<span class="id">G2</span>;<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bmatch_lub_l</span>; <span class="tactic">eauto</span>.<br/>
- <span class="tactic">apply</span> <span class="id">smatch_lub_l</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">apply</span> <span class="id">smatch_lub_l</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">mmatch_lub_r</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">mmatch</span> <span class="id">m</span> <span class="id">y</span> -&gt; <span class="id">mmatch</span> <span class="id">m</span> (<span class="id">mlub</span> <span class="id">x</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2969')">Proof.</div>
<div class="proofscript" id="proof2969">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="id">constructor</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
- <span class="tactic">apply</span> <span class="id">bmatch_lub_r</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">rewrite</span> <span class="id">PTree.gcombine</span> <span class="kwd">in</span> <span class="id">H0</span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">unfold</span> <span class="id">combine_ablock</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">am_glob</span> <span class="id">x</span>)!<span class="id">id</span> <span class="kwd">as</span> [<span class="id">b1</span>|] <span class="id">eqn</span>:<span class="id">G1</span>;<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">am_glob</span> <span class="id">y</span>)!<span class="id">id</span> <span class="kwd">as</span> [<span class="id">b2</span>|] <span class="id">eqn</span>:<span class="id">G2</span>;<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bmatch_lub_r</span>; <span class="tactic">eauto</span>.<br/>
- <span class="tactic">apply</span> <span class="id">smatch_lub_r</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">apply</span> <span class="id">smatch_lub_r</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">MATCH</span>.<br/>
<br/>
<h1> Monotonicity properties when the block classification changes. </h1>
<br/>
<span class="kwd">Lemma</span> <span class="id">genv_match_exten</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ge</span> (<span class="id">bc1</span> <span class="id">bc2</span>: <span class="id">block_classification</span>),<br/>
&nbsp;&nbsp;<span class="id">genv_match</span> <span class="id">bc1</span> <span class="id">ge</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">b</span> <span class="id">id</span>, <span class="id">bc1</span> <span class="id">b</span> = <span class="id">BCglob</span> <span class="id">id</span> &lt;-&gt; <span class="id">bc2</span> <span class="id">b</span> = <span class="id">BCglob</span> <span class="id">id</span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">b</span>, <span class="id">bc1</span> <span class="id">b</span> = <span class="id">BCother</span> -&gt; <span class="id">bc2</span> <span class="id">b</span> = <span class="id">BCother</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">genv_match</span> <span class="id">bc2</span> <span class="id">ge</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2970')">Proof.</div>
<div class="proofscript" id="proof2970">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">A</span> <span class="id">B</span>]. <span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
- <span class="tactic">rewrite</span> &lt;- <span class="id">H0</span>. <span class="tactic">eauto</span>.<br/>
- <span class="id">exploit</span> <span class="id">B</span>; <span class="tactic">eauto</span>. <span class="tactic">destruct</span> (<span class="id">bc1</span> <span class="id">b</span>) <span class="id">eqn</span>:<span class="id">BC1</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">intuition</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">BC1</span>. <span class="tactic">intuition</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">intuition</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;+ <span class="id">erewrite</span> <span class="id">H1</span> <span class="tactic">by</span> <span class="tactic">eauto</span>. <span class="tactic">intuition</span> <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">romatch_exten</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">bc1</span> <span class="id">bc2</span>: <span class="id">block_classification</span>) <span class="id">m</span> <span class="id">rm</span>,<br/>
&nbsp;&nbsp;<span class="id">romatch</span> <span class="id">bc1</span> <span class="id">m</span> <span class="id">rm</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">b</span> <span class="id">id</span>, <span class="id">bc2</span> <span class="id">b</span> = <span class="id">BCglob</span> <span class="id">id</span> &lt;-&gt; <span class="id">bc1</span> <span class="id">b</span> = <span class="id">BCglob</span> <span class="id">id</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">romatch</span> <span class="id">bc2</span> <span class="id">m</span> <span class="id">rm</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2971')">Proof.</div>
<div class="proofscript" id="proof2971">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="id">exploit</span> <span class="id">H</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">A</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span>).<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">PM</span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">p</span>, <span class="id">pmatch</span> <span class="id">bc1</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">p</span> -&gt; <span class="id">pmatch</span> <span class="id">bc1</span> <span class="id">b</span> <span class="id">ofs</span> (<span class="id">ab_summary</span> <span class="id">ab</span>) -&gt; <span class="id">pmatch</span> <span class="id">bc2</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">p</span>).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">pmatch</span> <span class="id">bc1</span> <span class="id">b0</span> <span class="id">ofs</span> <span class="id">Glob</span>) <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id">pmatch_ge</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">bc2</span> <span class="id">b0</span> = <span class="id">BCglob</span> <span class="id">id0</span>) <span class="tactic">by</span> (<span class="tactic">rewrite</span> <span class="id">H0</span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H3</span>; <span class="id">econstructor</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">va</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">VM</span>: <span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span>, <span class="id">vmatch</span> <span class="id">bc1</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">bc1</span> <span class="id">v</span> (<span class="id">Ifptr</span> (<span class="id">ab_summary</span> <span class="id">ab</span>)) -&gt; <span class="id">vmatch</span> <span class="id">bc2</span> <span class="id">v</span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H3</span>; <span class="id">constructor</span>; <span class="tactic">auto</span>; <span class="id">inv</span> <span class="id">H4</span>; <span class="tactic">eapply</span> <span class="id">PM</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">B</span> <span class="kwd">as</span> [[<span class="id">B1</span> <span class="id">B2</span>] <span class="id">B3</span>]. <span class="tactic">split</span>. <span class="tactic">split</span>.<br/>
- <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">VM</span>; <span class="tactic">eauto</span>.<br/>
- <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">PM</span>; <span class="tactic">eauto</span>.<br/>
- <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">VM</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">bc_incr</span> (<span class="id">bc1</span> <span class="id">bc2</span>: <span class="id">block_classification</span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span>, <span class="id">bc1</span> <span class="id">b</span> &lt;&gt; <span class="id">BCinvalid</span> -&gt; <span class="id">bc2</span> <span class="id">b</span> = <span class="id">bc1</span> <span class="id">b</span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id">MATCH_INCR</span>.<br/>
<br/>
<span class="kwd">Variables</span> <span class="id">bc1</span> <span class="id">bc2</span>: <span class="id">block_classification</span>.<br/>
<span class="kwd">Hypothesis</span> <span class="id">INCR</span>: <span class="id">bc_incr</span> <span class="id">bc1</span> <span class="id">bc2</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">pmatch_incr</span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">p</span>, <span class="id">pmatch</span> <span class="id">bc1</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">p</span> -&gt; <span class="id">pmatch</span> <span class="id">bc2</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">p</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2972')">Proof.</div>
<div class="proofscript" id="proof2972">
&nbsp;&nbsp;<span class="tactic">induction</span> 1;<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">bc2</span> <span class="id">b</span> = <span class="id">bc1</span> <span class="id">b</span>) <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id">INCR</span>; <span class="tactic">congruence</span>);<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">va</span>. <span class="tactic">rewrite</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">vmatch_incr</span>: <span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span>, <span class="id">vmatch</span> <span class="id">bc1</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">vmatch</span> <span class="id">bc2</span> <span class="id">v</span> <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2973')">Proof.</div>
<div class="proofscript" id="proof2973">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="id">constructor</span>; <span class="tactic">auto</span>; <span class="tactic">apply</span> <span class="id">pmatch_incr</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">smatch_incr</span>: <span class="kwd">forall</span> <span class="id">m</span> <span class="id">b</span> <span class="id">p</span>, <span class="id">smatch</span> <span class="id">bc1</span> <span class="id">m</span> <span class="id">b</span> <span class="id">p</span> -&gt; <span class="id">smatch</span> <span class="id">bc2</span> <span class="id">m</span> <span class="id">b</span> <span class="id">p</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2974')">Proof.</div>
<div class="proofscript" id="proof2974">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">A</span> <span class="id">B</span>]. <span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">vmatch_incr</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">pmatch_incr</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">bmatch_incr</span>: <span class="kwd">forall</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ab</span>, <span class="id">bmatch</span> <span class="id">bc1</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ab</span> -&gt; <span class="id">bmatch</span> <span class="id">bc2</span> <span class="id">m</span> <span class="id">b</span> <span class="id">ab</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2975')">Proof.</div>
<div class="proofscript" id="proof2975">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">B1</span> <span class="id">B2</span>]. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">smatch_incr</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">vmatch_incr</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">MATCH_INCR</span>.<br/>
<br/>
<h1> Matching and memory injections. </h1>
<br/>
<span class="kwd">Definition</span> <span class="id">inj_of_bc</span> (<span class="id">bc</span>: <span class="id">block_classification</span>) : <span class="id">meminj</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">b</span> =&gt; <span class="kwd">match</span> <span class="id">bc</span> <span class="id">b</span> <span class="kwd">with</span> <span class="id">BCinvalid</span> =&gt; <span class="id">None</span> | <span class="id">_</span> =&gt; <span class="id">Some</span>(<span class="id">b</span>, 0) <span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">inj_of_bc_valid</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">bc</span>: <span class="id">block_classification</span>) <span class="id">b</span>, <span class="id">bc</span> <span class="id">b</span> &lt;&gt; <span class="id">BCinvalid</span> -&gt; <span class="id">inj_of_bc</span> <span class="id">bc</span> <span class="id">b</span> = <span class="id">Some</span>(<span class="id">b</span>, 0).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2976')">Proof.</div>
<div class="proofscript" id="proof2976">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">inj_of_bc</span>. <span class="tactic">destruct</span> (<span class="id">bc</span> <span class="id">b</span>); <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">inj_of_bc_inv</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">bc</span>: <span class="id">block_classification</span>) <span class="id">b</span> <span class="id">b</span>' <span class="id">delta</span>,<br/>
&nbsp;&nbsp;<span class="id">inj_of_bc</span> <span class="id">bc</span> <span class="id">b</span> = <span class="id">Some</span>(<span class="id">b</span>', <span class="id">delta</span>) -&gt; <span class="id">bc</span> <span class="id">b</span> &lt;&gt; <span class="id">BCinvalid</span> /\ <span class="id">b</span>' = <span class="id">b</span> /\ <span class="id">delta</span> = 0.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2977')">Proof.</div>
<div class="proofscript" id="proof2977">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">inj_of_bc</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> (<span class="id">bc</span> <span class="id">b</span>); <span class="tactic">intuition</span> <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">pmatch_inj</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bc</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">p</span>, <span class="id">pmatch</span> <span class="id">bc</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">p</span> -&gt; <span class="id">inj_of_bc</span> <span class="id">bc</span> <span class="id">b</span> = <span class="id">Some</span>(<span class="id">b</span>, 0).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2978')">Proof.</div>
<div class="proofscript" id="proof2978">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">inj_of_bc_valid</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">vmatch_inj</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bc</span> <span class="id">v</span> <span class="id">x</span>, <span class="id">vmatch</span> <span class="id">bc</span> <span class="id">v</span> <span class="id">x</span> -&gt; <span class="id">Val.inject</span> (<span class="id">inj_of_bc</span> <span class="id">bc</span>) <span class="id">v</span> <span class="id">v</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2979')">Proof.</div>
<div class="proofscript" id="proof2979">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">pmatch_inj</span>; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">Ptrofs.add_zero</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">pmatch_inj</span>; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">Ptrofs.add_zero</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">vmatch_list_inj</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bc</span> <span class="id">vl</span> <span class="id">xl</span>, <span class="id">list_forall2</span> (<span class="id">vmatch</span> <span class="id">bc</span>) <span class="id">vl</span> <span class="id">xl</span> -&gt; <span class="id">Val.inject_list</span> (<span class="id">inj_of_bc</span> <span class="id">bc</span>) <span class="id">vl</span> <span class="id">vl</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2980')">Proof.</div>
<div class="proofscript" id="proof2980">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="id">constructor</span>. <span class="tactic">eapply</span> <span class="id">vmatch_inj</span>; <span class="tactic">eauto</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">mmatch_inj</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bc</span> <span class="id">m</span> <span class="id">am</span>, <span class="id">mmatch</span> <span class="id">bc</span> <span class="id">m</span> <span class="id">am</span> -&gt; <span class="id">bc_below</span> <span class="id">bc</span> (<span class="id">Mem.nextblock</span> <span class="id">m</span>) -&gt; <span class="id">Mem.inject</span> (<span class="id">inj_of_bc</span> <span class="id">bc</span>) <span class="id">m</span> <span class="id">m</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2981')">Proof.</div>
<div class="proofscript" id="proof2981">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">constructor</span>. <span class="id">constructor</span>.<br/>
- <span class="comment">(*&nbsp;perms&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id">inj_of_bc_inv</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">A</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span>); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Zplus_0_r</span>. <span class="tactic">auto</span>.<br/>
- <span class="comment">(*&nbsp;alignment&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id">inj_of_bc_inv</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">A</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span>); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Zdivide_0</span>.<br/>
- <span class="comment">(*&nbsp;contents&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id">inj_of_bc_inv</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">A</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span>); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Zplus_0_r</span>.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">mv</span> := <span class="id">ZMap.get</span> <span class="id">ofs</span> (<span class="id">PMap.get</span> <span class="id">b1</span> (<span class="id">Mem.mem_contents</span> <span class="id">m</span>))).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Mem.loadbytes</span> <span class="id">m</span> <span class="id">b1</span> <span class="id">ofs</span> 1 = <span class="id">Some</span> (<span class="id">mv</span> :: <span class="id">nil</span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Local</span> <span class="id">Transparent</span> <span class="id">Mem.loadbytes</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Mem.loadbytes</span>. <span class="tactic">rewrite</span> <span class="id">pred_dec_true</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">replace</span> <span class="id">ofs0</span> <span class="kwd">with</span> <span class="id">ofs</span> <span class="tactic">by</span> <span class="tactic">omega</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">mv</span>; <span class="id">econstructor</span>. <span class="tactic">destruct</span> <span class="id">v</span>; <span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">inj_of_bc_valid</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">PM</span>: <span class="id">pmatch</span> <span class="id">bc</span> <span class="id">b</span> <span class="id">i</span> <span class="id">Ptop</span>).<br/>
&nbsp;&nbsp;{ <span class="id">exploit</span> <span class="id">mmatch_top</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">P</span> <span class="id">Q</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">pmatch_top</span>'. <span class="tactic">eapply</span> <span class="id">Q</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">PM</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ptrofs.add_zero</span>; <span class="tactic">auto</span>.<br/>
- <span class="comment">(*&nbsp;free&nbsp;blocks&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">inj_of_bc</span>. <span class="id">erewrite</span> <span class="id">bc_below_invalid</span>; <span class="tactic">eauto</span>.<br/>
- <span class="comment">(*&nbsp;mapped&nbsp;blocks&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id">inj_of_bc_inv</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">A</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span>); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H0</span>; <span class="tactic">auto</span>.<br/>
- <span class="comment">(*&nbsp;overlap&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">inj_of_bc_inv</span>. <span class="id">eexact</span> <span class="id">H2</span>. <span class="tactic">intros</span> (<span class="id">A1</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span>); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">inj_of_bc_inv</span>. <span class="id">eexact</span> <span class="id">H3</span>. <span class="tactic">intros</span> (<span class="id">A2</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span>); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
- <span class="comment">(*&nbsp;overflow&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id">inj_of_bc_inv</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">A</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span>); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Zplus_0_r</span>. <span class="tactic">split</span>. <span class="tactic">omega</span>. <span class="tactic">apply</span> <span class="id">Ptrofs.unsigned_range_2</span>.<br/>
- <span class="comment">(*&nbsp;perm&nbsp;inv&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id">inj_of_bc_inv</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">A</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span>); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Zplus_0_r</span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">inj_of_bc_preserves_globals</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bc</span> <span class="id">ge</span>, <span class="id">genv_match</span> <span class="id">bc</span> <span class="id">ge</span> -&gt; <span class="id">meminj_preserves_globals</span> <span class="id">ge</span> (<span class="id">inj_of_bc</span> <span class="id">bc</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2982')">Proof.</div>
<div class="proofscript" id="proof2982">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">A</span> <span class="id">B</span>].<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">inj_of_bc_valid</span>. <span class="tactic">rewrite</span> <span class="id">A</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">inj_of_bc_valid</span>. <span class="tactic">apply</span> <span class="id">B</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Genv.find_var_info_iff</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">eapply</span> <span class="id">Genv.genv_defs_range</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id">inj_of_bc_inv</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">P</span> &amp; <span class="id">Q</span> &amp; <span class="id">R</span>). <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">pmatch_inj_top</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bc</span> <span class="id">b</span> <span class="id">b</span>' <span class="id">delta</span> <span class="id">ofs</span>, <span class="id">inj_of_bc</span> <span class="id">bc</span> <span class="id">b</span> = <span class="id">Some</span>(<span class="id">b</span>', <span class="id">delta</span>) -&gt; <span class="id">pmatch</span> <span class="id">bc</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">Ptop</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2983')">Proof.</div>
<div class="proofscript" id="proof2983">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id">inj_of_bc_inv</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">A</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span>). <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">vmatch_inj_top</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bc</span> <span class="id">v</span> <span class="id">v</span>', <span class="id">Val.inject</span> (<span class="id">inj_of_bc</span> <span class="id">bc</span>) <span class="id">v</span> <span class="id">v</span>' -&gt; <span class="id">vmatch</span> <span class="id">bc</span> <span class="id">v</span> <span class="id">Vtop</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2984')">Proof.</div>
<div class="proofscript" id="proof2984">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="id">constructor</span>. <span class="tactic">eapply</span> <span class="id">pmatch_inj_top</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">mmatch_inj_top</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bc</span> <span class="id">m</span> <span class="id">m</span>', <span class="id">Mem.inject</span> (<span class="id">inj_of_bc</span> <span class="id">bc</span>) <span class="id">m</span> <span class="id">m</span>' -&gt; <span class="id">mmatch</span> <span class="id">bc</span> <span class="id">m</span> <span class="id">mtop</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2985')">Proof.</div>
<div class="proofscript" id="proof2985">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">SM</span>: <span class="kwd">forall</span> <span class="id">b</span>, <span class="id">bc</span> <span class="id">b</span> &lt;&gt; <span class="id">BCinvalid</span> -&gt; <span class="id">smatch</span> <span class="id">bc</span> <span class="id">m</span> <span class="id">b</span> <span class="id">Ptop</span>).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">exploit</span> <span class="id">Mem.load_inject</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">inj_of_bc_valid</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">v</span>' &amp; <span class="id">A</span> &amp; <span class="id">B</span>). <span class="tactic">eapply</span> <span class="id">vmatch_inj_top</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">exploit</span> <span class="id">Mem.loadbytes_inject</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">inj_of_bc_valid</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">bytes</span>' &amp; <span class="id">A</span> &amp; <span class="id">B</span>). <span class="id">inv</span> <span class="id">B</span>. <span class="id">inv</span> <span class="id">H4</span>. <span class="id">inv</span> <span class="id">H8</span>. <span class="tactic">eapply</span> <span class="id">pmatch_inj_top</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">ablock_init_sound</span>. <span class="tactic">apply</span> <span class="id">SM</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">PTree.gempty</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">SM</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">SM</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id">Mem.valid_block_inject_1</span>. <span class="tactic">eapply</span> <span class="id">inj_of_bc_valid</span>; <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<h1> Abstracting RTL register environments </h1>
<br/>
<span class="kwd">Module</span> <span class="id">AVal</span> &lt;: <span class="id">SEMILATTICE_WITH_TOP</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">t</span> := <span class="id">aval</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">eq</span> (<span class="id">x</span> <span class="id">y</span>: <span class="id">t</span>) := (<span class="id">x</span> = <span class="id">y</span>).<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">eq_refl</span>: <span class="kwd">forall</span> <span class="id">x</span>, <span class="id">eq</span> <span class="id">x</span> <span class="id">x</span> := (@<span class="id">refl_equal</span> <span class="id">t</span>).<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">eq_sym</span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">eq</span> <span class="id">x</span> <span class="id">y</span> -&gt; <span class="id">eq</span> <span class="id">y</span> <span class="id">x</span> := (@<span class="id">sym_equal</span> <span class="id">t</span>).<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">eq_trans</span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span>, <span class="id">eq</span> <span class="id">x</span> <span class="id">y</span> -&gt; <span class="id">eq</span> <span class="id">y</span> <span class="id">z</span> -&gt; <span class="id">eq</span> <span class="id">x</span> <span class="id">z</span> := (@<span class="id">trans_equal</span> <span class="id">t</span>).<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">beq</span> (<span class="id">x</span> <span class="id">y</span>: <span class="id">t</span>) : <span class="id">bool</span> := <span class="id">proj_sumbool</span> (<span class="id">eq_aval</span> <span class="id">x</span> <span class="id">y</span>).<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">beq_correct</span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">beq</span> <span class="id">x</span> <span class="id">y</span> = <span class="id">true</span> -&gt; <span class="id">eq</span> <span class="id">x</span> <span class="id">y</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2986')">Proof.</div>
<div class="proofscript" id="proof2986">
 <span class="tactic">unfold</span> <span class="id">beq</span>; <span class="tactic">intros</span>. <span class="id">InvBooleans</span>. <span class="tactic">auto</span>. Qed.</div>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">ge</span> := <span class="id">vge</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">ge_refl</span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">eq</span> <span class="id">x</span> <span class="id">y</span> -&gt; <span class="id">ge</span> <span class="id">x</span> <span class="id">y</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2987')">Proof.</div>
<div class="proofscript" id="proof2987">
 <span class="tactic">unfold</span> <span class="id">eq</span>, <span class="id">ge</span>; <span class="tactic">intros</span>. <span class="tactic">subst</span> <span class="id">y</span>. <span class="tactic">apply</span> <span class="id">vge_refl</span>. Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">ge_trans</span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span>, <span class="id">ge</span> <span class="id">x</span> <span class="id">y</span> -&gt; <span class="id">ge</span> <span class="id">y</span> <span class="id">z</span> -&gt; <span class="id">ge</span> <span class="id">x</span> <span class="id">z</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2988')">Proof.</div>
<div class="proofscript" id="proof2988">
 <span class="tactic">unfold</span> <span class="id">ge</span>; <span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id">vge_trans</span>; <span class="tactic">eauto</span>. Qed.</div>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">bot</span> : <span class="id">t</span> := <span class="id">Vbot</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">ge_bot</span>: <span class="kwd">forall</span> <span class="id">x</span>, <span class="id">ge</span> <span class="id">x</span> <span class="id">bot</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2989')">Proof.</div>
<div class="proofscript" id="proof2989">
 <span class="tactic">intros</span>. <span class="id">constructor</span>. Qed.</div>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">top</span> : <span class="id">t</span> := <span class="id">Vtop</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">ge_top</span>: <span class="kwd">forall</span> <span class="id">x</span>, <span class="id">ge</span> <span class="id">top</span> <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2990')">Proof.</div>
<div class="proofscript" id="proof2990">
 <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">vge_top</span>. Qed.</div>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">lub</span> := <span class="id">vlub</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">ge_lub_left</span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">ge</span> (<span class="id">lub</span> <span class="id">x</span> <span class="id">y</span>) <span class="id">x</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Proof</span> <span class="id">vge_lub_l</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">ge_lub_right</span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">ge</span> (<span class="id">lub</span> <span class="id">x</span> <span class="id">y</span>) <span class="id">y</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Proof</span> <span class="id">vge_lub_r</span>.<br/>
<span class="kwd">End</span> <span class="id">AVal</span>.<br/>
<br/>
<span class="kwd">Module</span> <span class="id">AE</span> := <span class="id">LPMap</span>(<span class="id">AVal</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">aenv</span> := <span class="id">AE.t</span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id">MATCHENV</span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id">bc</span>: <span class="id">block_classification</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">ematch</span> (<span class="id">e</span>: <span class="id">regset</span>) (<span class="id">ae</span>: <span class="id">aenv</span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r</span>, <span class="id">vmatch</span> <span class="id">bc</span> <span class="id">e</span>#<span class="id">r</span> (<span class="id">AE.get</span> <span class="id">r</span> <span class="id">ae</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">ematch_ge</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">e</span> <span class="id">ae1</span> <span class="id">ae2</span>,<br/>
&nbsp;&nbsp;<span class="id">ematch</span> <span class="id">e</span> <span class="id">ae1</span> -&gt; <span class="id">AE.ge</span> <span class="id">ae2</span> <span class="id">ae1</span> -&gt; <span class="id">ematch</span> <span class="id">e</span> <span class="id">ae2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2991')">Proof.</div>
<div class="proofscript" id="proof2991">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">vmatch_ge</span> <span class="kwd">with</span> (<span class="id">AE.get</span> <span class="id">r</span> <span class="id">ae1</span>); <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">H0</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">ematch_update</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">e</span> <span class="id">ae</span> <span class="id">v</span> <span class="id">av</span> <span class="id">r</span>,<br/>
&nbsp;&nbsp;<span class="id">ematch</span> <span class="id">e</span> <span class="id">ae</span> -&gt; <span class="id">vmatch</span> <span class="id">bc</span> <span class="id">v</span> <span class="id">av</span> -&gt; <span class="id">ematch</span> (<span class="id">e</span>#<span class="id">r</span> &lt;- <span class="id">v</span>) (<span class="id">AE.set</span> <span class="id">r</span> <span class="id">av</span> <span class="id">ae</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2992')">Proof.</div>
<div class="proofscript" id="proof2992">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">AE.gsspec</span>. <span class="tactic">rewrite</span> <span class="id">PMap.gsspec</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">peq</span> <span class="id">r0</span> <span class="id">r</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="id">specialize</span> (<span class="id">H</span> <span class="id">xH</span>). <span class="tactic">subst</span> <span class="id">ae</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">AVal.eq</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">subst</span> <span class="id">av</span>. <span class="id">inv</span> <span class="id">H0</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id">einit_regs</span> (<span class="id">rl</span>: <span class="id">list</span> <span class="id">reg</span>) : <span class="id">aenv</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">rl</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">r1</span> :: <span class="id">rs</span> =&gt; <span class="id">AE.set</span> <span class="id">r1</span> (<span class="id">Ifptr</span> <span class="id">Nonstack</span>) (<span class="id">einit_regs</span> <span class="id">rs</span>)<br/>
&nbsp;&nbsp;| <span class="id">nil</span> =&gt; <span class="id">AE.top</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">ematch_init</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">rl</span> <span class="id">vl</span>,<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">v</span>, <span class="id">In</span> <span class="id">v</span> <span class="id">vl</span> -&gt; <span class="id">vmatch</span> <span class="id">bc</span> <span class="id">v</span> (<span class="id">Ifptr</span> <span class="id">Nonstack</span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="id">ematch</span> (<span class="id">init_regs</span> <span class="id">vl</span> <span class="id">rl</span>) (<span class="id">einit_regs</span> <span class="id">rl</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2993')">Proof.</div>
<div class="proofscript" id="proof2993">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">rl</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
- <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">Regmap.gi</span>. <span class="tactic">simpl</span> <span class="id">AE.get</span>. <span class="tactic">rewrite</span> <span class="id">PTree.gempty</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">vl</span> <span class="kwd">as</span> [ | <span class="id">v1</span> <span class="id">vs</span> ].<br/>
&nbsp;&nbsp;+ <span class="tactic">assert</span> (<span class="id">ematch</span> (<span class="id">init_regs</span> <span class="id">nil</span> <span class="id">rl</span>) (<span class="id">einit_regs</span> <span class="id">rl</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">IHrl</span>. <span class="tactic">simpl</span>; <span class="tactic">tauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">init_regs</span> <span class="id">nil</span> <span class="id">rl</span>) <span class="kwd">with</span> (<span class="id">Regmap.init</span> <span class="id">Vundef</span>) <span class="kwd">in</span> <span class="id">H0</span> <span class="tactic">by</span> (<span class="tactic">destruct</span> <span class="id">rl</span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">AE.gsspec</span>. <span class="tactic">destruct</span> (<span class="id">peq</span> <span class="id">r</span> <span class="id">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Regmap.gi</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">intros</span> <span class="id">EQ</span>; <span class="tactic">rewrite</span> <span class="id">EQ</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">specialize</span> (<span class="id">H0</span> <span class="id">xH</span>). <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">AVal.eq</span>, <span class="id">AVal.bot</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">assert</span> (<span class="id">ematch</span> (<span class="id">init_regs</span> <span class="id">vs</span> <span class="id">rl</span>) (<span class="id">einit_regs</span> <span class="id">rl</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">IHrl</span>. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">coqlib</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">Regmap.gsspec</span>. <span class="tactic">rewrite</span> <span class="id">AE.gsspec</span>. <span class="tactic">destruct</span> (<span class="id">peq</span> <span class="id">r</span> <span class="id">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">coqlib</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">intros</span> <span class="id">EQ</span>; <span class="tactic">rewrite</span> <span class="id">EQ</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">specialize</span> (<span class="id">H0</span> <span class="id">xH</span>). <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">AVal.eq</span>, <span class="id">AVal.bot</span>. <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id">eforget</span> (<span class="id">rl</span>: <span class="id">list</span> <span class="id">reg</span>) (<span class="id">ae</span>: <span class="id">aenv</span>) {<span class="kwd">struct</span> <span class="id">rl</span>} : <span class="id">aenv</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">rl</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">nil</span> =&gt; <span class="id">ae</span><br/>
&nbsp;&nbsp;| <span class="id">r1</span> :: <span class="id">rs</span> =&gt; <span class="id">eforget</span> <span class="id">rs</span> (<span class="id">AE.set</span> <span class="id">r1</span> <span class="id">Vtop</span> <span class="id">ae</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">eforget_ge</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">rl</span> <span class="id">ae</span>, <span class="id">AE.ge</span> (<span class="id">eforget</span> <span class="id">rl</span> <span class="id">ae</span>) <span class="id">ae</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2994')">Proof.</div>
<div class="proofscript" id="proof2994">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">AE.ge</span>; <span class="tactic">intros</span>. <span class="id">revert</span> <span class="id">rl</span> <span class="id">ae</span>; <span class="tactic">induction</span> <span class="id">rl</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">AVal.ge_refl</span>. <span class="tactic">apply</span> <span class="id">AVal.eq_refl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">ae</span>. <span class="tactic">unfold</span> <span class="id">AE.get</span> <span class="tactic">at</span> 2. <span class="tactic">apply</span> <span class="id">AVal.ge_bot</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">AVal.ge_trans</span>. <span class="tactic">apply</span> <span class="id">IHrl</span>. <span class="tactic">rewrite</span> <span class="id">AE.gsspec</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">peq</span> <span class="id">p</span> <span class="id">a</span>). <span class="tactic">apply</span> <span class="id">AVal.ge_top</span>. <span class="tactic">apply</span> <span class="id">AVal.ge_refl</span>. <span class="tactic">apply</span> <span class="id">AVal.eq_refl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">AVal.eq</span>, <span class="id">Vtop</span>, <span class="id">AVal.bot</span>. <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">ematch_forget</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">e</span> <span class="id">rl</span> <span class="id">ae</span>, <span class="id">ematch</span> <span class="id">e</span> <span class="id">ae</span> -&gt; <span class="id">ematch</span> <span class="id">e</span> (<span class="id">eforget</span> <span class="id">rl</span> <span class="id">ae</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2995')">Proof.</div>
<div class="proofscript" id="proof2995">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id">ematch_ge</span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">eforget_ge</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">MATCHENV</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">ematch_incr</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bc</span> <span class="id">bc</span>' <span class="id">e</span> <span class="id">ae</span>, <span class="id">ematch</span> <span class="id">bc</span> <span class="id">e</span> <span class="id">ae</span> -&gt; <span class="id">bc_incr</span> <span class="id">bc</span> <span class="id">bc</span>' -&gt; <span class="id">ematch</span> <span class="id">bc</span>' <span class="id">e</span> <span class="id">ae</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2996')">Proof.</div>
<div class="proofscript" id="proof2996">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">vmatch_incr</span> <span class="kwd">with</span> <span class="id">bc</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<h1> Lattice for dataflow analysis </h1>
<br/>
<span class="kwd">Module</span> <span class="id">VA</span> &lt;: <span class="id">SEMILATTICE</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id">t</span>' := <span class="id">Bot</span> | <span class="id">State</span> (<span class="id">ae</span>: <span class="id">aenv</span>) (<span class="id">am</span>: <span class="id">amem</span>).<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">t</span> := <span class="id">t</span>'.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">eq</span> (<span class="id">x</span> <span class="id">y</span>: <span class="id">t</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span>, <span class="id">y</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Bot</span>, <span class="id">Bot</span> =&gt; <span class="id">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">State</span> <span class="id">ae1</span> <span class="id">am1</span>, <span class="id">State</span> <span class="id">ae2</span> <span class="id">am2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">AE.eq</span> <span class="id">ae1</span> <span class="id">ae2</span> /\ <span class="kwd">forall</span> <span class="id">bc</span> <span class="id">m</span>, <span class="id">mmatch</span> <span class="id">bc</span> <span class="id">m</span> <span class="id">am1</span> &lt;-&gt; <span class="id">mmatch</span> <span class="id">bc</span> <span class="id">m</span> <span class="id">am2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">eq_refl</span>: <span class="kwd">forall</span> <span class="id">x</span>, <span class="id">eq</span> <span class="id">x</span> <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2997')">Proof.</div>
<div class="proofscript" id="proof2997">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">simpl</span>. <span class="tactic">auto</span>. <span class="tactic">split</span>. <span class="tactic">apply</span> <span class="id">AE.eq_refl</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">eq_sym</span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">eq</span> <span class="id">x</span> <span class="id">y</span> -&gt; <span class="id">eq</span> <span class="id">y</span> <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2998')">Proof.</div>
<div class="proofscript" id="proof2998">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>, <span class="id">y</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>. <span class="tactic">intros</span> [<span class="id">A</span> <span class="id">B</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">apply</span> <span class="id">AE.eq_sym</span>; <span class="tactic">auto</span>. <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">B</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">eq_trans</span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span>, <span class="id">eq</span> <span class="id">x</span> <span class="id">y</span> -&gt; <span class="id">eq</span> <span class="id">y</span> <span class="id">z</span> -&gt; <span class="id">eq</span> <span class="id">x</span> <span class="id">z</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2999')">Proof.</div>
<div class="proofscript" id="proof2999">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>, <span class="id">y</span>, <span class="id">z</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">tauto</span>. <span class="tactic">intros</span> [<span class="id">A</span> <span class="id">B</span>] [<span class="id">C</span> <span class="id">D</span>]; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">AE.eq_trans</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">B</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">beq</span> (<span class="id">x</span> <span class="id">y</span>: <span class="id">t</span>) : <span class="id">bool</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span>, <span class="id">y</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Bot</span>, <span class="id">Bot</span> =&gt; <span class="id">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">State</span> <span class="id">ae1</span> <span class="id">am1</span>, <span class="id">State</span> <span class="id">ae2</span> <span class="id">am2</span> =&gt; <span class="id">AE.beq</span> <span class="id">ae1</span> <span class="id">ae2</span> &amp;&amp; <span class="id">mbeq</span> <span class="id">am1</span> <span class="id">am2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">beq_correct</span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">beq</span> <span class="id">x</span> <span class="id">y</span> = <span class="id">true</span> -&gt; <span class="id">eq</span> <span class="id">x</span> <span class="id">y</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3000')">Proof.</div>
<div class="proofscript" id="proof3000">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>, <span class="id">y</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">InvBooleans</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">AE.beq_correct</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">mbeq_sound</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">ge</span> (<span class="id">x</span> <span class="id">y</span>: <span class="id">t</span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span>, <span class="id">y</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">Bot</span> =&gt; <span class="id">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Bot</span>, <span class="id">_</span> =&gt; <span class="id">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">State</span> <span class="id">ae1</span> <span class="id">am1</span>, <span class="id">State</span> <span class="id">ae2</span> <span class="id">am2</span> =&gt; <span class="id">AE.ge</span> <span class="id">ae1</span> <span class="id">ae2</span> /\ <span class="kwd">forall</span> <span class="id">bc</span> <span class="id">m</span>, <span class="id">mmatch</span> <span class="id">bc</span> <span class="id">m</span> <span class="id">am2</span> -&gt; <span class="id">mmatch</span> <span class="id">bc</span> <span class="id">m</span> <span class="id">am1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">ge_refl</span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">eq</span> <span class="id">x</span> <span class="id">y</span> -&gt; <span class="id">ge</span> <span class="id">x</span> <span class="id">y</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3001')">Proof.</div>
<div class="proofscript" id="proof3001">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>, <span class="id">y</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">tauto</span>. <span class="tactic">intros</span> [<span class="id">A</span> <span class="id">B</span>]; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">AE.ge_refl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">B</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">ge_trans</span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span>, <span class="id">ge</span> <span class="id">x</span> <span class="id">y</span> -&gt; <span class="id">ge</span> <span class="id">y</span> <span class="id">z</span> -&gt; <span class="id">ge</span> <span class="id">x</span> <span class="id">z</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3002')">Proof.</div>
<div class="proofscript" id="proof3002">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>, <span class="id">y</span>, <span class="id">z</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">tauto</span>. <span class="tactic">intros</span> [<span class="id">A</span> <span class="id">B</span>] [<span class="id">C</span> <span class="id">D</span>]; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">AE.ge_trans</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">bot</span> : <span class="id">t</span> := <span class="id">Bot</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">ge_bot</span>: <span class="kwd">forall</span> <span class="id">x</span>, <span class="id">ge</span> <span class="id">x</span> <span class="id">bot</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3003')">Proof.</div>
<div class="proofscript" id="proof3003">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">lub</span> (<span class="id">x</span> <span class="id">y</span>: <span class="id">t</span>) : <span class="id">t</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span>, <span class="id">y</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Bot</span>, <span class="id">_</span> =&gt; <span class="id">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">Bot</span> =&gt; <span class="id">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">State</span> <span class="id">ae1</span> <span class="id">am1</span>, <span class="id">State</span> <span class="id">ae2</span> <span class="id">am2</span> =&gt; <span class="id">State</span> (<span class="id">AE.lub</span> <span class="id">ae1</span> <span class="id">ae2</span>) (<span class="id">mlub</span> <span class="id">am1</span> <span class="id">am2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">ge_lub_left</span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">ge</span> (<span class="id">lub</span> <span class="id">x</span> <span class="id">y</span>) <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3004')">Proof.</div>
<div class="proofscript" id="proof3004">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>, <span class="id">y</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">ge_refl</span>; <span class="tactic">apply</span> <span class="id">eq_refl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">ge_refl</span>; <span class="tactic">apply</span> <span class="id">eq_refl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">split</span>. <span class="tactic">apply</span> <span class="id">AE.ge_lub_left</span>. <span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id">mmatch_lub_l</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">ge_lub_right</span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">ge</span> (<span class="id">lub</span> <span class="id">x</span> <span class="id">y</span>) <span class="id">y</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3005')">Proof.</div>
<div class="proofscript" id="proof3005">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>, <span class="id">y</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">ge_refl</span>; <span class="tactic">apply</span> <span class="id">eq_refl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">ge_refl</span>; <span class="tactic">apply</span> <span class="id">eq_refl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">split</span>. <span class="tactic">apply</span> <span class="id">AE.ge_lub_right</span>. <span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id">mmatch_lub_r</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">VA</span>.<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">cmatch</span> : <span class="id">va</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">pmatch</span>: <span class="id">va</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">vmatch</span>: <span class="id">va</span>.<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">cnot_sound</span> <span class="id">symbol_address_sound</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">shl_sound</span> <span class="id">shru_sound</span> <span class="id">shr_sound</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">and_sound</span> <span class="id">or_sound</span> <span class="id">xor_sound</span> <span class="id">notint_sound</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ror_sound</span> <span class="id">rolm_sound</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">neg_sound</span> <span class="id">add_sound</span> <span class="id">sub_sound</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mul_sound</span> <span class="id">mulhs_sound</span> <span class="id">mulhu_sound</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">divs_sound</span> <span class="id">divu_sound</span> <span class="id">mods_sound</span> <span class="id">modu_sound</span> <span class="id">shrx_sound</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">shll_sound</span> <span class="id">shrl_sound</span> <span class="id">shrlu_sound</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andl_sound</span> <span class="id">orl_sound</span> <span class="id">xorl_sound</span> <span class="id">notl_sound</span> <span class="id">roll_sound</span> <span class="id">rorl_sound</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">negl_sound</span> <span class="id">addl_sound</span> <span class="id">subl_sound</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mull_sound</span> <span class="id">mullhs_sound</span> <span class="id">mullhu_sound</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">divls_sound</span> <span class="id">divlu_sound</span> <span class="id">modls_sound</span> <span class="id">modlu_sound</span> <span class="id">shrxl_sound</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">negf_sound</span> <span class="id">absf_sound</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">addf_sound</span> <span class="id">subf_sound</span> <span class="id">mulf_sound</span> <span class="id">divf_sound</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">negfs_sound</span> <span class="id">absfs_sound</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">addfs_sound</span> <span class="id">subfs_sound</span> <span class="id">mulfs_sound</span> <span class="id">divfs_sound</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">zero_ext_sound</span> <span class="id">sign_ext_sound</span> <span class="id">longofint_sound</span> <span class="id">longofintu_sound</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">singleoffloat_sound</span> <span class="id">floatofsingle_sound</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intoffloat_sound</span> <span class="id">intuoffloat_sound</span> <span class="id">floatofint_sound</span> <span class="id">floatofintu_sound</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intofsingle_sound</span> <span class="id">intuofsingle_sound</span> <span class="id">singleofint_sound</span> <span class="id">singleofintu_sound</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">longoffloat_sound</span> <span class="id">longuoffloat_sound</span> <span class="id">floatoflong_sound</span> <span class="id">floatoflongu_sound</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">longofsingle_sound</span> <span class="id">longuofsingle_sound</span> <span class="id">singleoflong_sound</span> <span class="id">singleoflongu_sound</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">longofwords_sound</span> <span class="id">loword_sound</span> <span class="id">hiword_sound</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cmpu_bool_sound</span> <span class="id">cmp_bool_sound</span> <span class="id">cmplu_bool_sound</span> <span class="id">cmpl_bool_sound</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cmpf_bool_sound</span> <span class="id">cmpfs_bool_sound</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">maskzero_sound</span> : <span class="id">va</span>.<br/>
</div>
<div class="footer"><hr/>Generated by coq2html</div>
</body>
</html>
