<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module ClientSim</title>
<meta name="description" content="Documentation of Coq module ClientSim" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module ClientSim</h1>
<div class="coq">
<div class="doc">This file gives the definition of client module simulation, 
which is relation between low-level x86tso program calling object implementation, 
and high-level x86SC program calling object specification (Corresponding to the 
<span class="bracket"><span class="id">Definiton</span> 33</span> in submission #115 supplemental text)
 </div>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Coqlib.html">Coqlib</a></span> <span class="id"><a href="Maps.html">Maps</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="AST.html">AST</a></span> <span class="id"><a href="Integers.html">Integers</a></span> <span class="id"><a href="Floats.html">Floats</a></span> <span class="id"><a href="Values.html">Values</a></span> <span class="id"><a href="Events.html">Events</a></span> <span class="id"><a href="Globalenvs.html">Globalenvs</a></span> <span class="id"><a href="Smallstep.html">Smallstep</a></span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="CUAST.html">CUAST</a></span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Footprint.html">Footprint</a></span> <span class="id"><a href="GMemory.html">GMemory</a></span> <span class="id"><a href="TSOMem.html">TSOMem</a></span> <span class="id"><a href="FMemOpFP.html">FMemOpFP</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="GlobDefs.html">GlobDefs</a></span> <span class="id"><a href="GAST.html">GAST</a></span> <span class="id"><a href="ETrace.html">ETrace</a></span> <span class="id"><a href="LDSimDefs.html">LDSimDefs</a></span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="ASM_local.html">ASM_local</a></span> <span class="id"><a href="AsmLang.html">AsmLang</a></span> <span class="id"><a href="AsmTSO.html">AsmTSO</a></span> <span class="id"><a href="TSOGlobSem.html">TSOGlobSem</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="InteractionSemantics.html">InteractionSemantics</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Export</span> <span class="id"><a href="RGRels.html">RGRels</a></span>.<br/>
<br/>
<span class="kwd">Local</span> <span class="kwd">Notation</span> <span class="id"><a name="footprint">footprint</a></span> := <span class="id"><a href="Footprint.html#FP.t">FP.t</a></span>.<br/>
<br/>
<div class="doc">Client footprint conflict with buffer of other threads </div>
<div class="doc">TODO: move to ? </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="conflict_bi">conflict_bi</a></span> (<span class="id">fp</span>: <span class="id"><a href="ClientSim.html#footprint">footprint</a></span>) (<span class="id">bi</span>: <span class="id"><a href="TSOMem.html#buffer_item">buffer_item</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="Footprint.html#FP.conflict">FP.conflict</a></span> <span class="id"><a href="ClientSim.html#fp">fp</a></span> (<span class="id"><a href="TSOMem.html#bi_footprint">bi_footprint</a></span> <span class="id"><a href="ClientSim.html#bi">bi</a></span>).<br/>
<br/>
<div class="doc">Corresponding to the definition of <span class="bracket"><span class="id">conflict_c</span></span> in Figure 20 in submission #115
supplemental text </div>
<span class="kwd">Inductive</span> <span class="id"><a name="conflictc">conflictc</a></span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">t</span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span>) (<span class="id">fp</span>: <span class="id"><a href="ClientSim.html#footprint">footprint</a></span>) (<span class="id">B</span>: <span class="id"><a href="TSOMem.html#buffers">buffers</a></span>): <span class="kwd">Prop</span> :=<br/>
| <span class="id"><a name="Conflictc">Conflictc</a></span>: <span class="kwd">forall</span> <span class="id">bi</span> <span class="id">t</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">t</span>' &lt;&gt; <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="ClientSim.html#bi">bi</a></span> (<span class="id">B</span> <span class="id">t</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#conflict_bi">conflict_bi</a></span> <span class="id">fp</span> <span class="id"><a href="ClientSim.html#bi">bi</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#conflictc">conflictc</a></span> <span class="id">t</span> <span class="id">fp</span> <span class="id">B</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
<div class="doc">relation between client src/tgt footprints, for reordering </div>
<span class="kwd">Definition</span> <span class="id"><a name="fpmatchc">fpmatchc</a></span> (<span class="id">sfp</span> <span class="id">tfp</span>: <span class="id"><a href="ClientSim.html#footprint">footprint</a></span>): <span class="kwd">Prop</span> := <span class="id"><a href="Footprint.html#FP.subset">FP.subset</a></span> <span class="id"><a href="ClientSim.html#tfp">tfp</a></span> <span class="id"><a href="ClientSim.html#sfp">sfp</a></span>.<br/>
<br/>
<h1> Client module simulation </h1>
<span class="kwd">Section</span> <span class="id"><a name="ClientSim">ClientSim</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Variable</span> <span class="id"><a name="ClientSim.Rc">Rc</a></span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span> -&gt; <span class="id"><a href="RGRels.html#stRel">stRel</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Variable</span> <span class="id"><a name="ClientSim.Gc">Gc</a></span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span> -&gt; <span class="id"><a href="RGRels.html#stRel">stRel</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Variable</span> <span class="id"><a name="ClientSim.Ic">Ic</a></span>: <span class="id"><a href="RGRels.html#stInv">stInv</a></span>.<br/>
<br/>
<div class="doc">List the properties of client simulation </div>
&nbsp;&nbsp;<span class="kwd">Record</span> <span class="id"><a name="clientsim_properties">clientsim_properties</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">sl</span>: <span class="id"><a href="InteractionSemantics.html#Language">Language</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">sG</span>: <span class="id"><a href="InteractionSemantics.html#G">G</a></span> <span class="id"><a href="ClientSim.html#sl">sl</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">sge</span>: <span class="id"><a href="Globalenvs.html#Genv.t">Genv.t</a></span> (<span class="id"><a href="InteractionSemantics.html#F">F</a></span> <span class="id"><a href="ClientSim.html#sl">sl</a></span>) (<span class="id"><a href="InteractionSemantics.html#V">V</a></span> <span class="id"><a href="ClientSim.html#sl">sl</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tge</span>: <span class="id"><a href="ASM_local.html#genv">genv</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">match_state</span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span> -&gt; (<span class="id"><a href="InteractionSemantics.html#core">core</a></span> <span class="id"><a href="ClientSim.html#sl">sl</a></span> * <span class="id"><a href="GMemory.html#gmem">gmem</a></span>) -&gt; (<span class="id"><a href="AsmTSO.html#core">AsmTSO.core</a></span> * <span class="id"><a href="TSOMem.html#tsomem">tsomem</a></span>) -&gt; <span class="kwd">Prop</span>): <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="match_init">match_init</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">id</span> <span class="id">args</span> <span class="id">tc</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#init_core">AsmTSO.init_core</a></span> <span class="id"><a href="ClientSim.html#tge">tge</a></span> <span class="id"><a href="ClientSim.html#id">id</a></span> <span class="id"><a href="ClientSim.html#args">args</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="ClientSim.html#tc">tc</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">sc</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#init_core">init_core</a></span> <span class="id"><a href="ClientSim.html#sl">sl</a></span> <span class="id"><a href="ClientSim.html#sG">sG</a></span> <span class="id"><a href="ClientSim.html#id">id</a></span> <span class="id"><a href="ClientSim.html#args">args</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="ClientSim.html#sc">sc</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">t</span> <span class="id">sm</span> <span class="id">tm</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#ClientSim.Ic">Ic</a></span> <span class="id"><a href="ClientSim.html#sm">sm</a></span> <span class="id"><a href="ClientSim.html#tm">tm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html#sep_obj_client_block">sep_obj_client_block</a></span> <span class="id"><a href="ClientSim.html#sm">sm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#match_state">match_state</a></span> <span class="id"><a href="ClientSim.html#t">t</a></span> (<span class="id"><a href="ClientSim.html#sc">sc</a></span>, <span class="id"><a href="ClientSim.html#sm">sm</a></span>) (<span class="id"><a href="ClientSim.html#tc">tc</a></span>, <span class="id"><a href="ClientSim.html#tm">tm</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="match_init_none">match_init_none</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">id</span> <span class="id">args</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#init_core">AsmTSO.init_core</a></span> <span class="id"><a href="ClientSim.html#tge">tge</a></span> <span class="id"><a href="ClientSim.html#id">id</a></span> <span class="id"><a href="ClientSim.html#args">args</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#init_core">init_core</a></span> <span class="id"><a href="ClientSim.html#sl">sl</a></span> <span class="id"><a href="ClientSim.html#sG">sG</a></span> <span class="id"><a href="ClientSim.html#id">id</a></span> <span class="id"><a href="ClientSim.html#args">args</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="match_tau">match_tau</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">sc</span> <span class="id">sm</span> <span class="id">tc</span> <span class="id">tm</span> <span class="id">fl</span> <span class="id">b</span> <span class="id">m</span> <span class="id">tfp</span> <span class="id">tc</span>' <span class="id">b</span>' <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#match_state">match_state</a></span> <span class="id"><a href="ClientSim.html#t">t</a></span> (<span class="id"><a href="ClientSim.html#sc">sc</a></span>, <span class="id"><a href="ClientSim.html#sm">sm</a></span>) (<span class="id"><a href="ClientSim.html#tc">tc</a></span>, <span class="id"><a href="ClientSim.html#tm">tm</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="ClientSim.html#tm">tm</a></span> <span class="id"><a href="ClientSim.html#t">t</a></span> = <span class="id"><a href="ClientSim.html#b">b</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="ClientSim.html#tm">tm</a></span> = <span class="id"><a href="ClientSim.html#m">m</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html#tm_alloc_not_fl">tm_alloc_not_fl</a></span> <span class="id"><a href="ClientSim.html#tm">tm</a></span> <span class="id"><a href="ClientSim.html#fl">fl</a></span> <span class="id"><a href="ClientSim.html#t">t</a></span> -&gt; <span class="id"><a href="RGRels.html#rel_tm_gm_vb">rel_tm_gm_vb</a></span> <span class="id"><a href="ClientSim.html#sm">sm</a></span> <span class="id"><a href="ClientSim.html#tm">tm</a></span> <span class="id"><a href="ClientSim.html#fl">fl</a></span> <span class="id"><a href="ClientSim.html#t">t</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#tsostep">tsostep</a></span> <span class="id"><a href="ClientSim.html#tge">tge</a></span> <span class="id"><a href="ClientSim.html#fl">fl</a></span> <span class="id"><a href="ClientSim.html#tc">tc</a></span> (<span class="id"><a href="ClientSim.html#b">b</a></span>, <span class="id"><a href="ClientSim.html#m">m</a></span>) <span class="id"><a href="ClientSim.html#tfp">tfp</a></span> <span class="id">tc</span>' (<span class="id">b</span>', <span class="id">m</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">tm</span>' := (<span class="id"><a href="TSOMem.html#mktsomem">mktsomem</a></span> (<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="ClientSim.html#t">t</a></span> <span class="id">b</span>' (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="ClientSim.html#tm">tm</a></span>)) <span class="id">m</span>') <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> <span class="id">sfp</span> <span class="id">sc</span>' <span class="id">sm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#step">step</a></span> <span class="id"><a href="ClientSim.html#sl">sl</a></span> <span class="id"><a href="ClientSim.html#sG">sG</a></span> <span class="id"><a href="ClientSim.html#fl">fl</a></span> <span class="id"><a href="ClientSim.html#sc">sc</a></span> <span class="id"><a href="ClientSim.html#sm">sm</a></span> <span class="id"><a href="ClientSim.html#sfp">sfp</a></span> <span class="id">sc</span>' <span class="id">sm</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(~ <span class="id"><a href="ClientSim.html#conflictc">conflictc</a></span> <span class="id"><a href="ClientSim.html#t">t</a></span> <span class="id"><a href="ClientSim.html#tfp">tfp</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="ClientSim.html#tm">tm</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="ClientSim.html#fpmatchc">fpmatchc</a></span> <span class="id"><a href="ClientSim.html#sfp">sfp</a></span> <span class="id"><a href="ClientSim.html#tfp">tfp</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="ClientSim.html#ClientSim.Gc">Gc</a></span> <span class="id"><a href="ClientSim.html#t">t</a></span> <span class="id"><a href="ClientSim.html#sm">sm</a></span> <span class="id"><a href="ClientSim.html#tm">tm</a></span> <span class="id">sm</span>' <span class="id">tm</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="ClientSim.html#match_state">match_state</a></span> <span class="id"><a href="ClientSim.html#t">t</a></span> (<span class="id">sc</span>', <span class="id">sm</span>') (<span class="id">tc</span>', <span class="id">tm</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="RGRels.html#tm_alloc_not_fl">tm_alloc_not_fl</a></span> <span class="id">tm</span>' <span class="id"><a href="ClientSim.html#fl">fl</a></span> <span class="id"><a href="ClientSim.html#t">t</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="RGRels.html#rel_tm_gm_vb">rel_tm_gm_vb</a></span> <span class="id">sm</span>' <span class="id">tm</span>' <span class="id"><a href="ClientSim.html#fl">fl</a></span> <span class="id"><a href="ClientSim.html#t">t</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="ClientSim.html#conflictc">conflictc</a></span> <span class="id"><a href="ClientSim.html#t">t</a></span> <span class="id"><a href="ClientSim.html#tfp">tfp</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="ClientSim.html#tm">tm</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="ClientSim.html#fpmatchc">fpmatchc</a></span> <span class="id"><a href="ClientSim.html#sfp">sfp</a></span> <span class="id"><a href="ClientSim.html#tfp">tfp</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">FP</span> <span class="id">sc</span>'' <span class="id">sm</span>'', ~ <span class="id"><a href="InteractionSemantics.html#step">step</a></span> <span class="id"><a href="ClientSim.html#sl">sl</a></span> <span class="id"><a href="ClientSim.html#sG">sG</a></span> <span class="id"><a href="ClientSim.html#fl">fl</a></span> <span class="id"><a href="ClientSim.html#sc">sc</a></span> <span class="id"><a href="ClientSim.html#sm">sm</a></span> <span class="id"><a href="ClientSim.html#FP">FP</a></span> <span class="id">sc</span>'' <span class="id">sm</span>'')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="match_at_external">match_at_external</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">sc</span> <span class="id">sm</span> <span class="id">tc</span> <span class="id">tm</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#match_state">match_state</a></span> <span class="id"><a href="ClientSim.html#t">t</a></span> (<span class="id"><a href="ClientSim.html#sc">sc</a></span>, <span class="id"><a href="ClientSim.html#sm">sm</a></span>) (<span class="id"><a href="ClientSim.html#tc">tc</a></span>, <span class="id"><a href="ClientSim.html#tm">tm</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#at_external">AsmTSO.at_external</a></span> <span class="id"><a href="ClientSim.html#tge">tge</a></span> <span class="id"><a href="ClientSim.html#tc">tc</a></span> = <span class="id"><a href="InteractionSemantics.html#at_external">at_external</a></span> <span class="id"><a href="ClientSim.html#sl">sl</a></span> <span class="id"><a href="ClientSim.html#sG">sG</a></span> <span class="id"><a href="ClientSim.html#sc">sc</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="match_after_external">match_after_external</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">sc</span> <span class="id">sm</span> <span class="id">tc</span> <span class="id">tm</span> <span class="id">ores</span> <span class="id">tc</span>', <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#match_state">match_state</a></span> <span class="id"><a href="ClientSim.html#t">t</a></span> (<span class="id"><a href="ClientSim.html#sc">sc</a></span>, <span class="id"><a href="ClientSim.html#sm">sm</a></span>) (<span class="id"><a href="ClientSim.html#tc">tc</a></span>, <span class="id"><a href="ClientSim.html#tm">tm</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#after_external">AsmTSO.after_external</a></span> <span class="id"><a href="ClientSim.html#tc">tc</a></span> <span class="id"><a href="ClientSim.html#ores">ores</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">tc</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">sc</span>', <span class="id"><a href="InteractionSemantics.html#after_external">after_external</a></span> <span class="id"><a href="ClientSim.html#sl">sl</a></span> <span class="id"><a href="ClientSim.html#sc">sc</a></span> <span class="id"><a href="ClientSim.html#ores">ores</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">sc</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="ClientSim.html#match_state">match_state</a></span> <span class="id"><a href="ClientSim.html#t">t</a></span> (<span class="id">sc</span>', <span class="id"><a href="ClientSim.html#sm">sm</a></span>) (<span class="id">tc</span>', <span class="id"><a href="ClientSim.html#tm">tm</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="match_after_external_none">match_after_external_none</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">sc</span> <span class="id">sm</span> <span class="id">tc</span> <span class="id">tm</span> <span class="id">ores</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#match_state">match_state</a></span> <span class="id"><a href="ClientSim.html#t">t</a></span> (<span class="id"><a href="ClientSim.html#sc">sc</a></span>, <span class="id"><a href="ClientSim.html#sm">sm</a></span>) (<span class="id"><a href="ClientSim.html#tc">tc</a></span>, <span class="id"><a href="ClientSim.html#tm">tm</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#after_external">AsmTSO.after_external</a></span> <span class="id"><a href="ClientSim.html#tc">tc</a></span> <span class="id"><a href="ClientSim.html#ores">ores</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#after_external">after_external</a></span> <span class="id"><a href="ClientSim.html#sl">sl</a></span> <span class="id"><a href="ClientSim.html#sc">sc</a></span> <span class="id"><a href="ClientSim.html#ores">ores</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="match_halted">match_halted</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">sc</span> <span class="id">sm</span> <span class="id">tc</span> <span class="id">tm</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#match_state">match_state</a></span> <span class="id"><a href="ClientSim.html#t">t</a></span> (<span class="id"><a href="ClientSim.html#sc">sc</a></span>, <span class="id"><a href="ClientSim.html#sm">sm</a></span>) (<span class="id"><a href="ClientSim.html#tc">tc</a></span>, <span class="id"><a href="ClientSim.html#tm">tm</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#halt">AsmTSO.halt</a></span> <span class="id"><a href="ClientSim.html#tc">tc</a></span> = <span class="id"><a href="InteractionSemantics.html#halt">halt</a></span> <span class="id"><a href="ClientSim.html#sl">sl</a></span> <span class="id"><a href="ClientSim.html#sc">sc</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="match_abort">match_abort</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">sc</span> <span class="id">sm</span> <span class="id">tc</span> <span class="id">tm</span> <span class="id">fl</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#match_state">match_state</a></span> <span class="id"><a href="ClientSim.html#t">t</a></span> (<span class="id"><a href="ClientSim.html#sc">sc</a></span>, <span class="id"><a href="ClientSim.html#sm">sm</a></span>) (<span class="id"><a href="ClientSim.html#tc">tc</a></span>, <span class="id"><a href="ClientSim.html#tm">tm</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html#tm_alloc_not_fl">tm_alloc_not_fl</a></span> <span class="id"><a href="ClientSim.html#tm">tm</a></span> <span class="id"><a href="ClientSim.html#fl">fl</a></span> <span class="id"><a href="ClientSim.html#t">t</a></span> -&gt; <span class="id"><a href="RGRels.html#rel_tm_gm_vb">rel_tm_gm_vb</a></span> <span class="id"><a href="ClientSim.html#sm">sm</a></span> <span class="id"><a href="ClientSim.html#tm">tm</a></span> <span class="id"><a href="ClientSim.html#fl">fl</a></span> <span class="id"><a href="ClientSim.html#t">t</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">t</span>', <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="ClientSim.html#tm">tm</a></span> <span class="id">t</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="ClientSim.html#tm">tm</a></span> = <span class="id"><a href="ClientSim.html#m">m</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">fp</span> <span class="id">tc</span>' <span class="id">b</span>' <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ (<span class="id"><a href="AsmTSO.html#tsostep">tsostep</a></span> <span class="id"><a href="ClientSim.html#tge">tge</a></span> <span class="id"><a href="ClientSim.html#fl">fl</a></span> <span class="id"><a href="ClientSim.html#tc">tc</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>, <span class="id"><a href="ClientSim.html#m">m</a></span>) <span class="id"><a href="ClientSim.html#fp">fp</a></span> <span class="id">tc</span>' (<span class="id">b</span>', <span class="id">m</span>') /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m</span>'', <span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id">b</span>' <span class="id">m</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'')) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">FP</span> <span class="id">sc</span>' <span class="id">sm</span>', ~ <span class="id"><a href="InteractionSemantics.html#step">step</a></span> <span class="id"><a href="ClientSim.html#sl">sl</a></span> <span class="id"><a href="ClientSim.html#sG">sG</a></span> <span class="id"><a href="ClientSim.html#fl">fl</a></span> <span class="id"><a href="ClientSim.html#sc">sc</a></span> <span class="id"><a href="ClientSim.html#sm">sm</a></span> <span class="id"><a href="ClientSim.html#FP">FP</a></span> <span class="id">sc</span>' <span class="id">sm</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\/ (<span class="kwd">forall</span> <span class="id">fm</span>, ~ <span class="id"><a href="FMemory.html#embed">FMemory.embed</a></span> <span class="id"><a href="ClientSim.html#m">m</a></span> <span class="id"><a href="ClientSim.html#fl">fl</a></span> <span class="id"><a href="ClientSim.html#fm">fm</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="match_abort_after_external">match_abort_after_external</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">sc</span> <span class="id">sm</span> <span class="id">tc</span> <span class="id">tm</span> <span class="id">ores</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#match_state">match_state</a></span> <span class="id"><a href="ClientSim.html#t">t</a></span> (<span class="id"><a href="ClientSim.html#sc">sc</a></span>, <span class="id"><a href="ClientSim.html#sm">sm</a></span>) (<span class="id"><a href="ClientSim.html#tc">tc</a></span>, <span class="id"><a href="ClientSim.html#tm">tm</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#after_external">AsmTSO.after_external</a></span> <span class="id"><a href="ClientSim.html#tc">tc</a></span> <span class="id"><a href="ClientSim.html#ores">ores</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#after_external">after_external</a></span> <span class="id"><a href="ClientSim.html#sl">sl</a></span> <span class="id"><a href="ClientSim.html#sc">sc</a></span> <span class="id"><a href="ClientSim.html#ores">ores</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="match_rely">match_rely</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">sc</span> <span class="id">sm</span> <span class="id">tc</span> <span class="id">tm</span> <span class="id">sm</span>' <span class="id">tm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#match_state">match_state</a></span> <span class="id"><a href="ClientSim.html#t">t</a></span> (<span class="id"><a href="ClientSim.html#sc">sc</a></span>, <span class="id"><a href="ClientSim.html#sm">sm</a></span>) (<span class="id"><a href="ClientSim.html#tc">tc</a></span>, <span class="id"><a href="ClientSim.html#tm">tm</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#ClientSim.Rc">Rc</a></span> <span class="id"><a href="ClientSim.html#t">t</a></span> <span class="id"><a href="ClientSim.html#sm">sm</a></span> <span class="id"><a href="ClientSim.html#tm">tm</a></span> <span class="id">sm</span>' <span class="id">tm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html#sep_obj_client_block">sep_obj_client_block</a></span> <span class="id">sm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#match_state">match_state</a></span> <span class="id"><a href="ClientSim.html#t">t</a></span> (<span class="id"><a href="ClientSim.html#sc">sc</a></span>, <span class="id">sm</span>') (<span class="id"><a href="ClientSim.html#tc">tc</a></span>, <span class="id">tm</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="match_no_entatom">match_no_entatom</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">sc</span> <span class="id">sm</span> <span class="id">tc</span> <span class="id">tm</span> <span class="id">fnid</span> <span class="id">sg</span> <span class="id">args</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#match_state">match_state</a></span> <span class="id"><a href="ClientSim.html#t">t</a></span> (<span class="id"><a href="ClientSim.html#sc">sc</a></span>, <span class="id"><a href="ClientSim.html#sm">sm</a></span>) (<span class="id"><a href="ClientSim.html#tc">tc</a></span>, <span class="id"><a href="ClientSim.html#tm">tm</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#at_external">at_external</a></span> <span class="id"><a href="ClientSim.html#sl">sl</a></span> <span class="id"><a href="ClientSim.html#sG">sG</a></span> <span class="id"><a href="ClientSim.html#sc">sc</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="ClientSim.html#fnid">fnid</a></span>, <span class="id"><a href="ClientSim.html#sg">sg</a></span>, <span class="id"><a href="ClientSim.html#args">args</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#fnid">fnid</a></span> &lt;&gt; <span class="id"><a href="GAST.html#ent_atom">ent_atom</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="ClientSim.html#fnid">fnid</a></span> &lt;&gt; <span class="id"><a href="GAST.html#ext_atom">ext_atom</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
&nbsp;&nbsp;<br/>
<span class="kwd">End</span> <span class="id"><a href="ClientSim.html#ClientSim">ClientSim</a></span>.<br/>
<br/>
<div class="doc">Client module simulation (corresponding to the <span class="bracket"><span class="id">Defintion</span> 33</span> in 
submission #115 supplemental text)  </div>
<span class="kwd">Definition</span> <span class="id"><a name="clientsim">clientsim</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Rc</span> <span class="id">Gc</span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span> -&gt; <span class="id"><a href="RGRels.html#stRel">stRel</a></span>) (<span class="id">Ic</span>: <span class="id"><a href="RGRels.html#stInv">stInv</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">sl</span>: <span class="id"><a href="InteractionSemantics.html#Language">Language</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">scu</span>: <span class="id"><a href="InteractionSemantics.html#comp_unit">comp_unit</a></span> <span class="id"><a href="ClientSim.html#sl">sl</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tcu</span>: <span class="id"><a href="AsmTSO.html#comp_unit">AsmTSO.comp_unit</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sge</span> <span class="id">sG</span> <span class="id">tge</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="InteractionSemantics.html#init_genv">init_genv</a></span> <span class="id"><a href="ClientSim.html#sl">sl</a></span> <span class="id"><a href="ClientSim.html#scu">scu</a></span> <span class="id"><a href="ClientSim.html#sge">sge</a></span> <span class="id"><a href="ClientSim.html#sG">sG</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="AsmTSO.html#init_genv">AsmTSO.init_genv</a></span> <span class="id"><a href="ClientSim.html#tcu">tcu</a></span> <span class="id"><a href="ClientSim.html#tge">tge</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOGlobSem.html#genv_match">genv_match</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id"><a href="ClientSim.html#sge">sge</a></span> <span class="id"><a href="ClientSim.html#tge">tge</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">match_state</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#clientsim_properties">clientsim_properties</a></span> <span class="id"><a href="ClientSim.html#Rc">Rc</a></span> <span class="id"><a href="ClientSim.html#Gc">Gc</a></span> <span class="id"><a href="ClientSim.html#Ic">Ic</a></span> <span class="id"><a href="ClientSim.html#sG">sG</a></span> <span class="id"><a href="ClientSim.html#sge">sge</a></span> <span class="id"><a href="ClientSim.html#tge">tge</a></span> <span class="id"><a href="ClientSim.html#match_state">match_state</a></span>.<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<h1> R/G/I for client modules </h1>
<div class="doc">TODO: move to GMemory.v </div>
<span class="kwd">Lemma</span> <span class="id"><a name="unchanged_on_sym">unchanged_on_sym</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">P</span> <span class="id">gm</span> <span class="id">gm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.unchanged_on">GMem.unchanged_on</a></span> <span class="id"><a href="ClientSim.html#P">P</a></span> <span class="id"><a href="ClientSim.html#gm">gm</a></span> <span class="id">gm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GMemory.html#GMem.unchanged_on">GMem.unchanged_on</a></span> <span class="id"><a href="ClientSim.html#P">P</a></span> <span class="id">gm</span>' <span class="id"><a href="ClientSim.html#gm">gm</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9441')">Proof.</div>
<div class="proofscript" id="proof9441">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">firstorder</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#iff_sym">iff_sym</a></span>. <span class="tactic">apply</span> <span class="id">unchanged_on_perm</span>; <span class="tactic">auto</span>. <span class="tactic">eapply</span> <span class="id">unchanged_on_validity</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">symmetry</span>. <span class="tactic">apply</span> <span class="id">unchanged_on_contents</span>. <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">unchanged_on_perm</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">unchanged_on_validity</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>. <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_dec">in_dec</a></span> <span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">b</span> (<span class="id"><a href="GMemory.html#GMem.validblocks">GMem.validblocks</a></span> <span class="id">gm</span>')); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="GMemory.html#GMem.invalid_noaccess">GMem.invalid_noaccess</a></span> <span class="kwd">in</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.perm">GMem.perm</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">rewrite</span> <span class="id">n</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">inversion</span> <span class="id">H0</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Client invariant <span class="bracket"><span class="id">Ic</span></span> </div>
<span class="kwd">Definition</span> <span class="id"><a name="buf_alloc_invalid">buf_alloc_invalid</a></span> (<span class="id">tm</span>: <span class="id"><a href="TSOMem.html#tsomem">tsomem</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id"><a href="ClientSim.html#b">b</a></span> <span class="id"><a href="ClientSim.html#lo">lo</a></span> <span class="id"><a href="ClientSim.html#hi">hi</a></span>) (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="ClientSim.html#tm">tm</a></span> <span class="id"><a href="ClientSim.html#t">t</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="ClientSim.html#tm">tm</a></span>) <span class="id"><a href="ClientSim.html#b">b</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="buf_alloc_norep">buf_alloc_norep</a></span> (<span class="id">tm</span>: <span class="id"><a href="TSOMem.html#tsomem">tsomem</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">t</span>' <span class="id">i</span> <span class="id">j</span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span> <span class="id">lo</span>' <span class="id">hi</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">List.nth_error</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="ClientSim.html#tm">tm</a></span> <span class="id"><a href="ClientSim.html#t">t</a></span>) <span class="id"><a href="ClientSim.html#i">i</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id"><a href="ClientSim.html#b">b</a></span> <span class="id"><a href="ClientSim.html#lo">lo</a></span> <span class="id"><a href="ClientSim.html#hi">hi</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">List.nth_error</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="ClientSim.html#tm">tm</a></span> <span class="id">t</span>') <span class="id"><a href="ClientSim.html#j">j</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id"><a href="ClientSim.html#b">b</a></span> <span class="id">lo</span>' <span class="id">hi</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#t">t</a></span> = <span class="id">t</span>' /\ <span class="id"><a href="ClientSim.html#i">i</a></span> = <span class="id"><a href="ClientSim.html#j">j</a></span>.<br/>
<br/>
<span class="kwd">Record</span> <span class="id"><a name="Ic">Ic</a></span> (<span class="id">sm</span>: <span class="id"><a href="GMemory.html#gmem">gmem</a></span>) (<span class="id">tm</span>: <span class="id"><a href="TSOMem.html#tsomem">tsomem</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="Ic_ub_safe">Ic_ub_safe</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> <span class="id"><a href="ClientSim.html#tm">tm</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="Ic_no_conflict_bi">Ic_no_conflict_bi</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">t1</span> <span class="id">t2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#t1">t1</a></span> &lt;&gt; <span class="id"><a href="ClientSim.html#t2">t2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="RGRels.html#obj_mem">obj_mem</a></span> <span class="id"><a href="ClientSim.html#sm">sm</a></span> <span class="id"><a href="ClientSim.html#b">b</a></span> <span class="id"><a href="ClientSim.html#ofs">ofs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#in_buffer">in_buffer</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="ClientSim.html#tm">tm</a></span> <span class="id"><a href="ClientSim.html#t1">t1</a></span>) <span class="id"><a href="ClientSim.html#b">b</a></span> <span class="id"><a href="ClientSim.html#ofs">ofs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#in_buffer">in_buffer</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="ClientSim.html#tm">tm</a></span> <span class="id"><a href="ClientSim.html#t2">t2</a></span>) <span class="id"><a href="ClientSim.html#b">b</a></span> <span class="id"><a href="ClientSim.html#ofs">ofs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="Ic_mem_eq">Ic_mem_eq</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">tgm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="ClientSim.html#tm">tm</a></span> <span class="id"><a href="ClientSim.html#t">t</a></span>) (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="ClientSim.html#tm">tm</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">tgm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="RGRels.html#obj_mem">obj_mem</a></span> <span class="id"><a href="ClientSim.html#sm">sm</a></span> <span class="id"><a href="ClientSim.html#b">b</a></span> <span class="id"><a href="ClientSim.html#ofs">ofs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">t</span>', <span class="id">t</span>' &lt;&gt; <span class="id"><a href="ClientSim.html#t">t</a></span> -&gt; ~ <span class="id"><a href="TSOMem.html#in_buffer">in_buffer</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="ClientSim.html#tm">tm</a></span> <span class="id">t</span>') <span class="id"><a href="ClientSim.html#b">b</a></span> <span class="id"><a href="ClientSim.html#ofs">ofs</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html#eq_on_loc">eq_on_loc</a></span> <span class="id"><a href="ClientSim.html#b">b</a></span> <span class="id"><a href="ClientSim.html#ofs">ofs</a></span> <span class="id"><a href="ClientSim.html#sm">sm</a></span> <span class="id">tgm</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="Ic_buf_alloc_invalid">Ic_buf_alloc_invalid</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#buf_alloc_invalid">buf_alloc_invalid</a></span> <span class="id"><a href="ClientSim.html#tm">tm</a></span>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="Ic_buf_alloc_norep">Ic_buf_alloc_norep</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#buf_alloc_norep">buf_alloc_norep</a></span> <span class="id"><a href="ClientSim.html#tm">tm</a></span>;<br/>
&nbsp;&nbsp;}.<br/>
<br/>
<div class="doc">Client rely <span class="bracket"><span class="id">Rc</span></span> </div>
<span class="kwd">Definition</span> <span class="id"><a name="Rc">Rc</a></span> (<span class="id">t</span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span>) (<span class="id">sm</span>: <span class="id"><a href="GMemory.html#gmem">gmem</a></span>) (<span class="id">tm</span>: <span class="id"><a href="TSOMem.html#tsomem">tsomem</a></span>) (<span class="id">sm</span>': <span class="id"><a href="GMemory.html#gmem">gmem</a></span>) (<span class="id">tm</span>': <span class="id"><a href="TSOMem.html#tsomem">tsomem</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#Ic">Ic</a></span> <span class="id"><a href="ClientSim.html#sm">sm</a></span> <span class="id"><a href="ClientSim.html#tm">tm</a></span> /\ <span class="id"><a href="ClientSim.html#Ic">Ic</a></span> <span class="id">sm</span>' <span class="id">tm</span>'.<br/>
<br/>
<div class="doc">Client guarantee <span class="bracket"><span class="id">Gc</span></span> </div>
<span class="kwd">Definition</span> <span class="id"><a name="Gc">Gc</a></span> (<span class="id">t</span>: <span class="id"><a href="GlobDefs.html#tid">tid</a></span>) (<span class="id">sm</span>: <span class="id"><a href="GMemory.html#gmem">gmem</a></span>) (<span class="id">tm</span>: <span class="id"><a href="TSOMem.html#tsomem">tsomem</a></span>) (<span class="id">sm</span>': <span class="id"><a href="GMemory.html#gmem">gmem</a></span>) (<span class="id">tm</span>': <span class="id"><a href="TSOMem.html#tsomem">tsomem</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#Ic">Ic</a></span> <span class="id"><a href="ClientSim.html#sm">sm</a></span> <span class="id"><a href="ClientSim.html#tm">tm</a></span> /\ <span class="id"><a href="ClientSim.html#Ic">Ic</a></span> <span class="id">sm</span>' <span class="id">tm</span>'<br/>
&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span>, <span class="id"><a href="RGRels.html#obj_mem">obj_mem</a></span> <span class="id"><a href="ClientSim.html#sm">sm</a></span> <span class="id"><a href="ClientSim.html#b">b</a></span> <span class="id"><a href="ClientSim.html#ofs">ofs</a></span> &lt;-&gt; <span class="id"><a href="RGRels.html#obj_mem">obj_mem</a></span> <span class="id">sm</span>' <span class="id"><a href="ClientSim.html#b">b</a></span> <span class="id"><a href="ClientSim.html#ofs">ofs</a></span>)<br/>
&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span>, <span class="id"><a href="RGRels.html#obj_mem">obj_mem</a></span> <span class="id"><a href="ClientSim.html#sm">sm</a></span> <span class="id"><a href="ClientSim.html#b">b</a></span> <span class="id"><a href="ClientSim.html#ofs">ofs</a></span> -&gt; <span class="id"><a href="RGRels.html#eq_on_loc">eq_on_loc</a></span> <span class="id"><a href="ClientSim.html#b">b</a></span> <span class="id"><a href="ClientSim.html#ofs">ofs</a></span> <span class="id"><a href="ClientSim.html#sm">sm</a></span> <span class="id">sm</span>')<br/>
&nbsp;&nbsp;/\ <span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id"><a href="ClientSim.html#tm">tm</a></span> = <span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">tm</span>'<br/>
&nbsp;&nbsp;/\ (<span class="id">exists</span> <span class="id">bis</span>, <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span>' = <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="ClientSim.html#t">t</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="ClientSim.html#tm">tm</a></span> <span class="id"><a href="ClientSim.html#t">t</a></span> ++ <span class="id"><a href="ClientSim.html#bis">bis</a></span>) (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id"><a href="ClientSim.html#tm">tm</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span>, <span class="id"><a href="TSOMem.html#in_buffer">in_buffer</a></span> <span class="id"><a href="ClientSim.html#bis">bis</a></span> <span class="id"><a href="ClientSim.html#b">b</a></span> <span class="id"><a href="ClientSim.html#ofs">ofs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(~ <span class="id"><a href="RGRels.html#obj_mem">obj_mem</a></span> <span class="id"><a href="ClientSim.html#sm">sm</a></span> <span class="id"><a href="ClientSim.html#b">b</a></span> <span class="id"><a href="ClientSim.html#ofs">ofs</a></span> )))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="GMemory.html#GMem.forward">GMem.forward</a></span> <span class="id"><a href="ClientSim.html#sm">sm</a></span> <span class="id">sm</span>'.<br/>
<br/>
<div class="doc">Client invariant <span class="bracket"><span class="id">Ic</span></span> implies <span class="bracket"><span class="id">unbuffer_safe</span></span> </div>
<span class="kwd">Lemma</span> <span class="id"><a name="Ic_unbuffer_safe">Ic_unbuffer_safe</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sm</span> <span class="id">tm</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#Ic">Ic</a></span> <span class="id"><a href="ClientSim.html#sm">sm</a></span> <span class="id"><a href="ClientSim.html#tm">tm</a></span> -&gt; <span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> <span class="id"><a href="ClientSim.html#tm">tm</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9442')">Proof.</div>
<div class="proofscript" id="proof9442">
 <span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span>. Qed.</div>
<br/>
<div class="doc"><span class="bracket"><span class="id">Ic</span></span> is stable under step <span class="bracket"><span class="id">Gc</span></span> </div>
<span class="kwd">Lemma</span> <span class="id"><a name="Ic_sta">Ic_sta</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> : <span class="id"><a href="GlobDefs.html#tid">tid</a></span>, <span class="id"><a href="RGRels.html#Sta">Sta</a></span> <span class="id"><a href="ClientSim.html#Ic">Ic</a></span> (<span class="id"><a href="ClientSim.html#Gc">Gc</a></span> <span class="id"><a href="ClientSim.html#t">t</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9443')">Proof.</div>
<div class="proofscript" id="proof9443">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="RGRels.html#Sta">Sta</a></span>. <span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="ClientSim.html#Gc">Gc</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">tauto</span>.<br/>
Qed.</div>
<br/>
<div class="doc"><span class="bracket"><span class="id">Gc</span></span> ==&gt; <span class="bracket"><span class="id">Rc</span></span> </div>
<span class="kwd">Lemma</span> <span class="id"><a name="Gc_implies_Rc">Gc_implies_Rc</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">t</span>' : <span class="id"><a href="GlobDefs.html#tid">tid</a></span>, <span class="id"><a href="RGRels.html#Implies">Implies</a></span> (<span class="id"><a href="ClientSim.html#Gc">Gc</a></span> <span class="id"><a href="ClientSim.html#t">t</a></span>) (<span class="id"><a href="ClientSim.html#Rc">Rc</a></span> <span class="id">t</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9444')">Proof.</div>
<div class="proofscript" id="proof9444">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="RGRels.html#Implies">Implies</a></span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="ClientSim.html#Gc">Gc</a></span>, <span class="id"><a href="ClientSim.html#Rc">Rc</a></span> <span class="kwd">in</span> *. <span class="tactic">tauto</span>.<br/>
Qed.</div>
<br/>
<div class="doc"><span class="bracket"><span class="id">Ic</span></span> is stable under unbuffer step </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="unbuffer_safe_apply_buffer">unbuffer_safe_apply_buffer</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bfs</span> <span class="id">t</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer_safe">unbuffer_safe</a></span> {| <span class="id"><a href="TSOMem.html#mktsomem">tso_buffers</a></span> := <span class="id"><a href="ClientSim.html#bfs">bfs</a></span>; <span class="id">memory</span> := <span class="id"><a href="ClientSim.html#m">m</a></span> |} -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m</span>', <span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> (<span class="id"><a href="ClientSim.html#bfs">bfs</a></span> <span class="id"><a href="ClientSim.html#t">t</a></span>) <span class="id"><a href="ClientSim.html#m">m</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9445')">Proof.</div>
<div class="proofscript" id="proof9445">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">bfs</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">bfs</span> <span class="id">t</span>) <span class="kwd">as</span> <span class="id">bf</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">bfs</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">bf</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;{ <span class="tactic">simpl</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;{ <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">ABIS</span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">m</span>' <span class="id">Happly_buffer_item</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Happly_buffer_item</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> (<span class="id">IHbf</span> <span class="id">t</span> (<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id">t</span> <span class="id">bf</span> <span class="id">bfs</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>; <span class="tactic">auto</span>; <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">UNBS</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="eq_on_loc_trans">eq_on_loc_trans</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">m3</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html#eq_on_loc">eq_on_loc</a></span> <span class="id"><a href="ClientSim.html#b">b</a></span> <span class="id"><a href="ClientSim.html#ofs">ofs</a></span> <span class="id"><a href="ClientSim.html#m1">m1</a></span> <span class="id"><a href="ClientSim.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html#eq_on_loc">eq_on_loc</a></span> <span class="id"><a href="ClientSim.html#b">b</a></span> <span class="id"><a href="ClientSim.html#ofs">ofs</a></span> <span class="id"><a href="ClientSim.html#m2">m2</a></span> <span class="id"><a href="ClientSim.html#m3">m3</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html#eq_on_loc">eq_on_loc</a></span> <span class="id"><a href="ClientSim.html#b">b</a></span> <span class="id"><a href="ClientSim.html#ofs">ofs</a></span> <span class="id"><a href="ClientSim.html#m1">m1</a></span> <span class="id"><a href="ClientSim.html#m3">m3</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9446')">Proof.</div>
<div class="proofscript" id="proof9446">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H0</span>; <span class="id">constructor</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eq_loc_validity</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">rewrite</span> <span class="id">eq_loc_perm</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="eq_on_loc_sym">eq_on_loc_sym</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">m1</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html#eq_on_loc">eq_on_loc</a></span> <span class="id"><a href="ClientSim.html#b">b</a></span> <span class="id"><a href="ClientSim.html#ofs">ofs</a></span> <span class="id"><a href="ClientSim.html#m1">m1</a></span> <span class="id"><a href="ClientSim.html#m2">m2</a></span> -&gt; <span class="id"><a href="RGRels.html#eq_on_loc">eq_on_loc</a></span> <span class="id"><a href="ClientSim.html#b">b</a></span> <span class="id"><a href="ClientSim.html#ofs">ofs</a></span> <span class="id"><a href="ClientSim.html#m2">m2</a></span> <span class="id"><a href="ClientSim.html#m1">m1</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9447')">Proof.</div>
<div class="proofscript" id="proof9447">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="id">constructor</span>; <span class="tactic">auto</span>. <span class="tactic">tauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="app_eq_length_eq_inj">app_eq_length_eq_inj</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span> (<span class="id">l1</span> <span class="id">l2</span> <span class="id">l1</span>' <span class="id">l2</span>': <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="ClientSim.html#A">A</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="ClientSim.html#l1">l1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">l1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#l1">l1</a></span> ++ <span class="id"><a href="ClientSim.html#l2">l2</a></span> = <span class="id">l1</span>' ++ <span class="id">l2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#l2">l2</a></span> = <span class="id">l2</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9448')">Proof.</div>
<div class="proofscript" id="proof9448">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l1</span>.<br/>
&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">l1</span>'; <span class="tactic">simpl</span>. <span class="tactic">auto</span>. <span class="tactic">discriminate</span>. }<br/>
&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">l1</span>'; <span class="tactic">simpl</span>. <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">H0</span>. <span class="tactic">eapply</span> <span class="id">IHl1</span>. <span class="tactic">eauto</span>. <span class="tactic">auto</span>. }<br/>
Qed.</div>
&nbsp;&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_buffer_item_eq_on_loc_preserve">apply_buffer_item_eq_on_loc_preserve</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span> <span class="id">gm1</span> <span class="id">gm2</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">gm1</span>' <span class="id">gm2</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html#eq_on_loc">eq_on_loc</a></span> <span class="id"><a href="ClientSim.html#b">b</a></span> <span class="id"><a href="ClientSim.html#ofs">ofs</a></span> <span class="id"><a href="ClientSim.html#gm1">gm1</a></span> <span class="id"><a href="ClientSim.html#gm2">gm2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="ClientSim.html#bi">bi</a></span> <span class="id"><a href="ClientSim.html#gm1">gm1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">gm1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="ClientSim.html#bi">bi</a></span> <span class="id"><a href="ClientSim.html#gm2">gm2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">gm2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html#eq_on_loc">eq_on_loc</a></span> <span class="id"><a href="ClientSim.html#b">b</a></span> <span class="id"><a href="ClientSim.html#ofs">ofs</a></span> <span class="id">gm1</span>' <span class="id">gm2</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9449')">Proof.</div>
<div class="proofscript" id="proof9449">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">bi</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="id">inv</span> <span class="id">H0</span>; <span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;{ <span class="comment">(*&nbsp;alloc&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Values.html#eq_block">eq_block</a></span> <span class="id">b0</span> <span class="id">b</span>); [<span class="tactic">subst</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>; <span class="tactic">simpl</span>; <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>; <span class="tactic">try</span> <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>. <span class="tactic">simpl</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">tauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>; <span class="tactic">simpl</span>; <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>. <span class="tactic">simpl</span>. <span class="tactic">tauto</span>. }<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{ <span class="comment">(*&nbsp;free&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#free">free</a></span>, <span class="id"><a href="TSOMem.html#unchecked_free">unchecked_free</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="TSOMem.html#range_perm_dec">range_perm_dec</a></span>; <span class="id">inv</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="TSOMem.html#range_perm_dec">range_perm_dec</a></span>; <span class="id">inv</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Values.html#eq_block">eq_block</a></span> <span class="id">b</span> <span class="id">b0</span>); [<span class="tactic">subst</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>; <span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>; <span class="tactic">simpl</span>; <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>; <span class="tactic">simpl</span>; <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">rewrite</span> <span class="id">eq_loc_perm</span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>; <span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>; <span class="tactic">simpl</span>; <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">simpl</span>; <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="tactic">tauto</span>. }<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{ <span class="comment">(*&nbsp;store&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="TSOMem.html#valid_access_dec">valid_access_dec</a></span>; <span class="id">inv</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="TSOMem.html#valid_access_dec">valid_access_dec</a></span>; <span class="id">inv</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Values.html#eq_block">eq_block</a></span> <span class="id">b</span> <span class="id">b0</span>); [<span class="tactic">subst</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>; <span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>; <span class="tactic">simpl</span>; <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>; <span class="tactic">simpl</span>; <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">Classical_Prop.classic</a></span> (<span class="id">z</span> &lt;= <span class="id">ofs</span> &lt; <span class="id">z</span> + <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.of_nat">Z.of_nat</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Memdata.html#encode_val">Memdata.encode_val</a></span> <span class="id">m</span> <span class="id">v</span>)))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">enough</span> (<span class="id"><a href="FMemory.html#Mem.getN">FMemory.Mem.getN</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Memdata.html#encode_val">Memdata.encode_val</a></span> <span class="id">m</span> <span class="id">v</span>)) <span class="id">z</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="FMemory.html#Mem.setN">FMemory.Mem.setN</a></span>  (<span class="id"><a href="Memdata.html#encode_val">Memdata.encode_val</a></span> <span class="id">m</span> <span class="id">v</span>) <span class="id">z</span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id">gm1</span>) !! <span class="id">b0</span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="FMemory.html#Mem.getN">FMemory.Mem.getN</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Memdata.html#encode_val">Memdata.encode_val</a></span> <span class="id">m</span> <span class="id">v</span>)) <span class="id">z</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="FMemory.html#Mem.setN">FMemory.Mem.setN</a></span>  (<span class="id"><a href="Memdata.html#encode_val">Memdata.encode_val</a></span> <span class="id">m</span> <span class="id">v</span>) <span class="id">z</span> (<span class="id"><a href="GMemory.html#GMem.mem_contents">GMem.mem_contents</a></span> <span class="id">gm2</span>) !! <span class="id">b0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">revert</span> <span class="id">H</span> <span class="id">H0</span>. <span class="tactic">clear</span>. <span class="tactic">generalize</span> (<span class="id"><a href="Memdata.html#encode_val">Memdata.encode_val</a></span> <span class="id">m</span> <span class="id">v</span>). <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">exists</span> <span class="id">n</span>, <span class="id">ofs</span> = <span class="id">z</span> + (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.of_nat">Z.of_nat</a></span> <span class="id"><a href="ClientSim.html#n">n</a></span>) /\ (<span class="id"><a href="ClientSim.html#n">n</a></span> &lt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">l</span>)%<span class="id">nat</span>) <span class="kwd">as</span> [<span class="id">n</span> [<span class="id">Hofs</span> <span class="id">Hn</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.to_nat">Z.to_nat</a></span> (<span class="id">ofs</span> - <span class="id">z</span>)). <span class="tactic">split</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Znat.html#Z2Nat.id">Z2Nat.id</a></span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Znat.html#Nat2Z.inj_lt">Nat2Z.inj_lt</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Znat.html#Z2Nat.id">Z2Nat.id</a></span>; <span class="tactic">omega</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">ofs</span>. <span class="tactic">destruct</span> <span class="id">H</span>. <span class="tactic">clear</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">exists</span> <span class="id">n</span>', <span class="id">n</span> + <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">l</span>)%<span class="id">nat</span> <span class="kwd">as</span> [<span class="id">n</span>' <span class="id">Hlength</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">l</span> - <span class="id">n</span> - 1)%<span class="id">nat</span>. <span class="tactic">omega</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hlength</span> <span class="kwd">in</span> *. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="FMemory.html#Mem.getN_concat">FMemory.Mem.getN_concat</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="ClientSim.html#app_eq_length_eq_inj">app_eq_length_eq_inj</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">inv</span> <span class="id">H0</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id"><a href="FMemory.html#Mem.getN_length">FMemory.Mem.getN_length</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="FMemory.html#Mem.getN_setN_same">FMemory.Mem.getN_setN_same</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="FMemory.html#Mem.setN_outside">FMemory.Mem.setN_outside</a></span>; <span class="tactic">auto</span>; <span class="tactic">omega</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>; <span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>; <span class="tactic">simpl</span>; <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>; <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="tactic">tauto</span>. }<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
&nbsp;&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_buffer_eq_on_loc_preserve">apply_buffer_eq_on_loc_preserve</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">buf</span> <span class="id">gm1</span> <span class="id">gm2</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">gm1</span>' <span class="id">gm2</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html#eq_on_loc">eq_on_loc</a></span> <span class="id"><a href="ClientSim.html#b">b</a></span> <span class="id"><a href="ClientSim.html#ofs">ofs</a></span> <span class="id"><a href="ClientSim.html#gm1">gm1</a></span> <span class="id"><a href="ClientSim.html#gm2">gm2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="ClientSim.html#buf">buf</a></span> <span class="id"><a href="ClientSim.html#gm1">gm1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">gm1</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="ClientSim.html#buf">buf</a></span> <span class="id"><a href="ClientSim.html#gm2">gm2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">gm2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html#eq_on_loc">eq_on_loc</a></span> <span class="id"><a href="ClientSim.html#b">b</a></span> <span class="id"><a href="ClientSim.html#ofs">ofs</a></span> <span class="id">gm1</span>' <span class="id">gm2</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9450')">Proof.</div>
<div class="proofscript" id="proof9450">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">buf</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="id">inv</span> <span class="id">H0</span>; <span class="id">inv</span> <span class="id">H1</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">gm1</span>) <span class="id">eqn</span>:?<span class="id">H</span>; <span class="id">inv</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">a</span> <span class="id">gm2</span>) <span class="id">eqn</span>:?<span class="id">H</span>; <span class="id">inv</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="ClientSim.html#apply_buffer_item_eq_on_loc_preserve">apply_buffer_item_eq_on_loc_preserve</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_buffer_item_eq_on_loc_other">apply_buffer_item_eq_on_loc_other</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span> <span class="id">gm</span> <span class="id">gm</span>' <span class="id">b</span> <span class="id">ofs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id"><a href="ClientSim.html#bi">bi</a></span> <span class="id"><a href="ClientSim.html#gm">gm</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">gm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="TSOMem.html#in_buffer_item">in_buffer_item</a></span> <span class="id"><a href="ClientSim.html#bi">bi</a></span> <span class="id"><a href="ClientSim.html#b">b</a></span> <span class="id"><a href="ClientSim.html#ofs">ofs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html#eq_on_loc">eq_on_loc</a></span> <span class="id"><a href="ClientSim.html#b">b</a></span> <span class="id"><a href="ClientSim.html#ofs">ofs</a></span> <span class="id"><a href="ClientSim.html#gm">gm</a></span> <span class="id">gm</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9451')">Proof.</div>
<div class="proofscript" id="proof9451">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">bi</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;{ <span class="comment">(*&nbsp;alloc&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Values.html#eq_block">eq_block</a></span> <span class="id">b0</span> <span class="id">b</span>). <span class="id">exfalso</span>. <span class="tactic">apply</span> <span class="id">H0</span>. <span class="tactic">subst</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>. <span class="tactic">simpl</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">intros</span> [<span class="id">C</span>|<span class="id">H</span>]; <span class="tactic">auto</span>; <span class="id">contradiction</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{ <span class="comment">(*&nbsp;free&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#free">free</a></span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="tactic">destruct</span> <span class="id"><a href="TSOMem.html#range_perm_dec">range_perm_dec</a></span>; <span class="id">inv</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unchecked_free">unchecked_free</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Values.html#eq_block">eq_block</a></span> <span class="id">b0</span> <span class="id">b</span>). <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">Classical_Prop.classic</a></span> (<span class="id">z</span> &lt;= <span class="id">ofs</span> &lt; <span class="id">z0</span>)). <span class="id">exfalso</span>. <span class="tactic">apply</span> <span class="id">H0</span>. <span class="id">constructor</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>. <span class="tactic">split</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#zle">zle</a></span>, <span class="id"><a href="Coqlib.html#zlt">zlt</a></span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>. <span class="tactic">omega</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>. <span class="tactic">simpl</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{ <span class="comment">(*&nbsp;store&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="tactic">destruct</span> <span class="id"><a href="TSOMem.html#valid_access_dec">valid_access_dec</a></span>; <span class="id">inv</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Values.html#eq_block">eq_block</a></span> <span class="id">b0</span> <span class="id">b</span>). <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">Classical_Prop.classic</a></span> (<span class="id">z</span> &lt;= <span class="id">ofs</span> &lt; <span class="id">z</span> + <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.of_nat">Z.of_nat</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Memdata.html#encode_val">Memdata.encode_val</a></span> <span class="id">m</span> <span class="id">v</span>)))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>. <span class="tactic">eapply</span> <span class="id">H0</span>. <span class="id">constructor</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Memdata.html#size_chunk_conv">Memdata.size_chunk_conv</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Memdata.html#encode_val">Memdata.encode_val</a></span> <span class="id">m</span> <span class="id">v</span>) = <span class="id"><a href="Memdata.html#size_chunk_nat">Memdata.size_chunk_nat</a></span> <span class="id">m</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">clear</span>. <span class="tactic">destruct</span> <span class="id">m</span>; <span class="tactic">simpl</span>; <span class="tactic">unfold</span> <span class="id"><a href="Memdata.html#encode_val">Memdata.encode_val</a></span>, <span class="id"><a href="Memdata.html#size_chunk_nat">Memdata.size_chunk_nat</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id"><a href="Coqlib.html#length_list_repeat">length_list_repeat</a></span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>. <span class="tactic">split</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gss">PMap.gss</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="FMemory.html#Mem.setN_outside">FMemory.Mem.setN_outside</a></span>. <span class="tactic">auto</span>. <span class="tactic">omega</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span>. <span class="tactic">split</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PMap.gso">PMap.gso</a></span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="apply_buffer_eq_on_loc_other">apply_buffer_eq_on_loc_other</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">buf</span> <span class="id">gm</span> <span class="id">gm</span>' <span class="id">b</span> <span class="id">ofs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id"><a href="ClientSim.html#buf">buf</a></span> <span class="id"><a href="ClientSim.html#gm">gm</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">gm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="TSOMem.html#in_buffer">in_buffer</a></span> <span class="id"><a href="ClientSim.html#buf">buf</a></span> <span class="id"><a href="ClientSim.html#b">b</a></span> <span class="id"><a href="ClientSim.html#ofs">ofs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="RGRels.html#eq_on_loc">eq_on_loc</a></span> <span class="id"><a href="ClientSim.html#b">b</a></span> <span class="id"><a href="ClientSim.html#ofs">ofs</a></span> <span class="id"><a href="ClientSim.html#gm">gm</a></span> <span class="id">gm</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9452')">Proof.</div>
<div class="proofscript" id="proof9452">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">buf</span>. <span class="tactic">intros</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">H</span>. <span class="id">constructor</span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">eqn</span>:?<span class="id">H</span>; <span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="ClientSim.html#apply_buffer_item_eq_on_loc_other">apply_buffer_item_eq_on_loc_other</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="ClientSim.html#eq_on_loc_trans">eq_on_loc_trans</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">IHbuf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">C</span>. <span class="id">inv</span> <span class="id">C</span>. <span class="tactic">apply</span> <span class="id">H0</span>. <span class="id">econstructor</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">C</span>. <span class="tactic">apply</span> <span class="id">H0</span>. <span class="id">econstructor</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Ic_buf_alloc_invalid_norep_stable">Ic_buf_alloc_invalid_norep_stable</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tm</span> <span class="id">t</span> <span class="id">tm</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#buf_alloc_invalid">buf_alloc_invalid</a></span> <span class="id"><a href="ClientSim.html#tm">tm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#buf_alloc_norep">buf_alloc_norep</a></span> <span class="id"><a href="ClientSim.html#tm">tm</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="TSOMem.html#unbuffer">unbuffer</a></span> <span class="id"><a href="ClientSim.html#tm">tm</a></span> <span class="id"><a href="ClientSim.html#t">t</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">tm</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#buf_alloc_invalid">buf_alloc_invalid</a></span> <span class="id">tm</span>' /\ <span class="id"><a href="ClientSim.html#buf_alloc_norep">buf_alloc_norep</a></span> <span class="id">tm</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9453')">Proof.</div>
<div class="proofscript" id="proof9453">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">tm</span> <span class="id">t</span> <span class="id">tm</span>' <span class="id">Ic_buf_alloc_invalid</span> <span class="id">Ic_buf_alloc_norep</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unbuffer">unbuffer</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">eqn</span>:<span class="id">A</span>. <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">eqn</span>:<span class="id">B</span>; <span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="ClientSim.html#buf_alloc_invalid">buf_alloc_invalid</a></span>, <span class="id"><a href="ClientSim.html#buf_alloc_norep">buf_alloc_norep</a></span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">b</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>, <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span> <span class="kwd">in</span> *. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">subst</span>. <span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In_nth_error">In_nth_error</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">N</span> &amp; <span class="id">Hbi</span>). <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="kwd">in</span> <span class="id">B</span>. <span class="id">inv</span> <span class="id">B</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="id">exploit</span> (<span class="id">Ic_buf_alloc_norep</span> <span class="id">t</span> <span class="id">t</span> 0%<span class="id">nat</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">N</span>)); <span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">A</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>. <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">Ic_buf_alloc_invalid</span>); <span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">A</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="id">right</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error_In">nth_error_In</a></span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="kwd">in</span> <span class="id">B</span>. <span class="id">inv</span> <span class="id">B</span>. <span class="tactic">simpl</span>. <span class="tactic">intro</span>. <span class="tactic">destruct</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In_nth_error">In_nth_error</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">N</span> &amp; <span class="id">Hbi</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">subst</span>. <span class="id">exploit</span> (<span class="id">Ic_buf_alloc_norep</span> <span class="id">t</span> <span class="id">t0</span> 0%<span class="id">nat</span> <span class="id">N</span>); <span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">A</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>; <span class="tactic">intuition</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">Ic_buf_alloc_invalid</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#free">free</a></span> <span class="kwd">in</span> <span class="id">B</span>. <span class="tactic">destruct</span> <span class="id"><a href="TSOMem.html#range_perm_dec">range_perm_dec</a></span>; <span class="id">inv</span> <span class="id">B</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Ic_buf_alloc_invalid</span>. <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">A</span>. <span class="id">right</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Ic_buf_alloc_invalid</span>. <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="kwd">in</span> <span class="id">B</span>. <span class="tactic">destruct</span> <span class="id"><a href="TSOMem.html#valid_access_dec">valid_access_dec</a></span>; <span class="id">inv</span> <span class="id">B</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Ic_buf_alloc_invalid</span>. <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">A</span>. <span class="id">right</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Ic_buf_alloc_invalid</span>. <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;} <br/>
&nbsp;&nbsp;{ <span class="tactic">simpl</span>. <span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">auto</span>. <span class="id">exploit</span> (<span class="id">Ic_buf_alloc_norep</span> <span class="id">t</span> <span class="id">t</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">i</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">j</span>)); <span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">A</span>; <span class="tactic">eauto</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>. <span class="tactic">apply</span> <span class="id">n</span>. <span class="id">exploit</span> (<span class="id">Ic_buf_alloc_norep</span> <span class="id">t</span> <span class="id">t</span>' (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">i</span>) <span class="id">j</span>); <span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">A</span>; <span class="tactic">eauto</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>. <span class="tactic">apply</span> <span class="id">n</span>. <span class="id">exploit</span> (<span class="id">Ic_buf_alloc_norep</span> <span class="id">t0</span> <span class="id">t</span> <span class="id">i</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">j</span>)); <span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">A</span>; <span class="tactic">eauto</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Ic_buf_alloc_norep</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="UBSta_Ic">UBSta_Ic</a></span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="RGRels.html#UBSta">UBSta</a></span> <span class="id"><a href="ClientSim.html#Ic">Ic</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9454')">Proof.</div>
<div class="proofscript" id="proof9454">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="RGRels.html#UBSta">UBSta</a></span>. <span class="tactic">intros</span> <span class="id">gm</span> <span class="id">tm</span> <span class="id">gm</span>' <span class="id">tm</span>' <span class="id">HIc</span> [<span class="id">A</span> [<span class="id">t</span> <span class="id">Hunbuf</span>]]. <span class="tactic">subst</span> <span class="id">gm</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#unbuffer">unbuffer</a></span> <span class="kwd">in</span> <span class="id">Hunbuf</span>. <span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span> <span class="id">t</span>) <span class="id">eqn</span>:<span class="id">A</span>; <span class="id">inv</span> <span class="id">Hunbuf</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="TSOMem.html#apply_buffer_item">apply_buffer_item</a></span> <span class="id">b</span> (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">tm</span>)) <span class="id">eqn</span>:<span class="id">B</span>; <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">g</span> <span class="id">into</span> <span class="id">tgm</span>'.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="ClientSim.html#Ic_ub_safe">Ic_ub_safe</a></span> <span class="kwd">in</span> <span class="id">HIc</span>. <span class="id">inv</span> <span class="id">HIc</span>. <span class="tactic">eapply</span> <span class="id">UNBS</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;{ <span class="tactic">simpl</span>. <span class="tactic">intros</span> <span class="id">b1</span> <span class="id">ofs</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">Ht</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id"><a href="ClientSim.html#Ic_no_conflict_bi">Ic_no_conflict_bi</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">A</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>. <span class="id">econstructor</span>. <span class="tactic">simpl</span>. <span class="id">right</span>. <span class="tactic">eauto</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id"><a href="ClientSim.html#Ic_no_conflict_bi">Ic_no_conflict_bi</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">A</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>. <span class="id">econstructor</span>. <span class="tactic">simpl</span>. <span class="id">right</span>. <span class="tactic">eauto</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="ClientSim.html#Ic_no_conflict_bi">Ic_no_conflict_bi</a></span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;{ <span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> *. <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;t&nbsp;=&nbsp;t0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">eapply</span> <span class="id"><a href="ClientSim.html#Ic_mem_eq">Ic_mem_eq</a></span>. <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">A</span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">B</span>. <span class="tactic">simpl</span>. <span class="tactic">auto</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">specialize</span> (<span class="id">H1</span> <span class="id">t</span>' <span class="id">H2</span>). <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;t&nbsp;&lt;&gt;&nbsp;t0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">t</span> <span class="id">into</span> <span class="id">t_unbuffer</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="kwd">forall</span> <span class="id">b</span>' <span class="id">ofs</span>', ~ <span class="id"><a href="TSOMem.html#in_buffer_item">in_buffer_item</a></span> <span class="id">b</span> <span class="id">b</span>' <span class="id">ofs</span>' -&gt; <span class="id"><a href="RGRels.html#eq_on_loc">eq_on_loc</a></span> <span class="id">b</span>' <span class="id">ofs</span>' (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">tm</span>) <span class="id">tgm</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id"><a href="ClientSim.html#apply_buffer_item_eq_on_loc_other">apply_buffer_item_eq_on_loc_other</a></span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">Classical_Prop.classic</a></span> (<span class="kwd">forall</span> <span class="id">t</span>', <span class="id">t</span>' &lt;&gt; <span class="id">t0</span> -&gt; ~ <span class="id"><a href="TSOMem.html#in_buffer">in_buffer</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span> <span class="id">t</span>') <span class="id">b1</span> <span class="id">ofs</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;not&nbsp;in&nbsp;buffer_item&nbsp;b&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (~ <span class="id"><a href="TSOMem.html#in_buffer_item">in_buffer_item</a></span> <span class="id">b</span> <span class="id">b1</span> <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intro</span> <span class="id">C</span>. <span class="tactic">eapply</span> <span class="id">H2</span>. <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">A</span>. <span class="id">econstructor</span>. <span class="id">left</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">exists</span> <span class="id">tgm0</span>, <span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span> <span class="id">t0</span>) (<span class="id"><a href="TSOMem.html#memory">memory</a></span> <span class="id">tm</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="ClientSim.html#tgm0">tgm0</a></span>) <span class="kwd">as</span> [<span class="id">tgm0</span> <span class="id">Happly0</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="ClientSim.html#unbuffer_safe_apply_buffer">unbuffer_safe_apply_buffer</a></span>. <span class="tactic">destruct</span> <span class="id">tm</span>. <span class="id">inv</span> <span class="id">HIc</span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H4</span>. <span class="tactic">eapply</span> <span class="id"><a href="ClientSim.html#Ic_mem_eq">Ic_mem_eq</a></span> <span class="kwd">in</span> <span class="id">HIc</span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">Happly0</span>; <span class="tactic">eauto</span>. <span class="tactic">clear</span> <span class="id">H</span>. <span class="tactic">clear</span> <span class="id">B</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="ClientSim.html#apply_buffer_eq_on_loc_preserve">apply_buffer_eq_on_loc_preserve</a></span>. <span class="tactic">exact</span> <span class="id">H4</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">clear</span> <span class="id">H4</span>. <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="ClientSim.html#eq_on_loc_trans">eq_on_loc_trans</a></span>; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;in&nbsp;buffer_item&nbsp;b&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="TSOMem.html#in_buffer_item">in_buffer_item</a></span> <span class="id">b</span> <span class="id">b1</span> <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Pred_Type.html#not_all_ex_not">Classical_Pred_Type.not_all_ex_not</a></span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="tactic">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> [<span class="id">t</span>'' <span class="id">H2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#imply_to_and">Classical_Prop.imply_to_and</a></span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="tactic">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> [<span class="id">Ht</span>'' <span class="id">H2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#imply_to_and">Classical_Prop.imply_to_and</a></span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="tactic">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> [<span class="id">H2</span> <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">t</span>'' <span class="id">t_unbuffer</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">t</span>''. <span class="tactic">rewrite</span> <span class="id">A</span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="id">inv</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H4</span>; <span class="tactic">subst</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>. <span class="tactic">eapply</span> <span class="id">H1</span>. <span class="tactic">eauto</span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>; <span class="tactic">try</span> <span class="id">contradiction</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>. <span class="tactic">eapply</span> <span class="id">H1</span>. <span class="tactic">exact</span> <span class="id">Ht</span>''. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>. <span class="id">contradiction</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="kwd">forall</span> <span class="id">t</span>', <span class="id">t</span>' &lt;&gt; <span class="id">t_unbuffer</span> -&gt; ~ <span class="id"><a href="TSOMem.html#in_buffer">in_buffer</a></span> (<span class="id"><a href="TSOMem.html#tso_buffers">tso_buffers</a></span> <span class="id">tm</span> <span class="id">t</span>') <span class="id">b1</span> <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="tactic">intro</span> <span class="id">C</span>. <span class="id">inv</span> <span class="id">C</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="ClientSim.html#Ic_no_conflict_bi">Ic_no_conflict_bi</a></span> <span class="kwd">in</span> <span class="id">HIc</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">A</span>. <span class="id">econstructor</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">exists</span> <span class="id">tgm_unbuffer</span>, <span class="id"><a href="TSOMem.html#apply_buffer">apply_buffer</a></span> <span class="id">b0</span> <span class="id">tgm</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="ClientSim.html#tgm_unbuffer">tgm_unbuffer</a></span>) <span class="kwd">as</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">tgm_unbuffer</span> <span class="id">Happly_unbuffer</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="ClientSim.html#Ic_unbuffer_safe">Ic_unbuffer_safe</a></span> <span class="kwd">in</span> <span class="id">HIc</span>. <span class="tactic">destruct</span> <span class="id">tm</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="ClientSim.html#unbuffer_safe_apply_buffer">unbuffer_safe_apply_buffer</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">tgm_unbuffer</span> <span class="id">Happly</span>]. <span class="tactic">rewrite</span> <span class="id">A</span> <span class="kwd">in</span> <span class="id">Happly</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Happly</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">B</span> <span class="kwd">in</span> <span class="id">Happly</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Happly</span>. <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="RGRels.html#eq_on_loc">eq_on_loc</a></span> <span class="id">b1</span> <span class="id">ofs</span> <span class="id">tgm</span>' <span class="id">tgm_unbuffer</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="ClientSim.html#apply_buffer_eq_on_loc_other">apply_buffer_eq_on_loc_other</a></span>. <span class="tactic">eauto</span>. <span class="tactic">intro</span>. <span class="tactic">eapply</span> <span class="id">H1</span>. <span class="tactic">eauto</span>. <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>; <span class="tactic">auto</span>; <span class="id">contradiction</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="RGRels.html#eq_on_loc">eq_on_loc</a></span> <span class="id">b1</span> <span class="id">ofs</span> <span class="id">tgm</span>'0 <span class="id">tgm</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="ClientSim.html#eq_on_loc_sym">eq_on_loc_sym</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="ClientSim.html#apply_buffer_eq_on_loc_other">apply_buffer_eq_on_loc_other</a></span>. <span class="tactic">eauto</span>. <span class="tactic">intro</span> <span class="id">C</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="ClientSim.html#Ic_no_conflict_bi">Ic_no_conflict_bi</a></span> <span class="kwd">in</span> <span class="id">HIc</span>; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">A</span>. <span class="id">econstructor</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="RGRels.html#eq_on_loc">eq_on_loc</a></span> <span class="id">b1</span> <span class="id">ofs</span> <span class="id">gm</span> <span class="id">tgm_unbuffer</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="ClientSim.html#Ic_mem_eq">Ic_mem_eq</a></span>; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">A</span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">B</span>. <span class="tactic">simpl</span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="ClientSim.html#eq_on_loc_trans">eq_on_loc_trans</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="ClientSim.html#eq_on_loc_sym">eq_on_loc_sym</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="ClientSim.html#eq_on_loc_trans">eq_on_loc_trans</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id"><a href="ClientSim.html#buf_alloc_invalid">buf_alloc_invalid</a></span>. <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">b</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>, <span class="id"><a href="GMemory.html#GMem.valid_block">GMem.valid_block</a></span> <span class="kwd">in</span> *. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">subst</span>. <span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In_nth_error">In_nth_error</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">N</span> &amp; <span class="id">Hbi</span>). <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="kwd">in</span> <span class="id">B</span>. <span class="id">inv</span> <span class="id">B</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="id">exploit</span> (<span class="id"><a href="ClientSim.html#Ic_buf_alloc_norep">Ic_buf_alloc_norep</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">HIc</span> <span class="id">t</span> <span class="id">t</span> 0%<span class="id">nat</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">N</span>)); <span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">A</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>. <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id"><a href="ClientSim.html#Ic_buf_alloc_invalid">Ic_buf_alloc_invalid</a></span>); <span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">A</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="id">right</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error_In">nth_error_In</a></span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#alloc">alloc</a></span> <span class="kwd">in</span> <span class="id">B</span>. <span class="id">inv</span> <span class="id">B</span>. <span class="tactic">simpl</span>. <span class="tactic">intro</span>. <span class="tactic">destruct</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In_nth_error">In_nth_error</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">N</span> &amp; <span class="id">Hbi</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">subst</span>. <span class="id">exploit</span> (<span class="id"><a href="ClientSim.html#Ic_buf_alloc_norep">Ic_buf_alloc_norep</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">HIc</span> <span class="id">t</span> <span class="id">t0</span> 0%<span class="id">nat</span> <span class="id">N</span>); <span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">A</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>; <span class="tactic">intuition</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="ClientSim.html#Ic_buf_alloc_invalid">Ic_buf_alloc_invalid</a></span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#free">free</a></span> <span class="kwd">in</span> <span class="id">B</span>. <span class="tactic">destruct</span> <span class="id"><a href="TSOMem.html#range_perm_dec">range_perm_dec</a></span>; <span class="id">inv</span> <span class="id">B</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="ClientSim.html#Ic_buf_alloc_invalid">Ic_buf_alloc_invalid</a></span>. <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">A</span>. <span class="id">right</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="ClientSim.html#Ic_buf_alloc_invalid">Ic_buf_alloc_invalid</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#store">store</a></span> <span class="kwd">in</span> <span class="id">B</span>. <span class="tactic">destruct</span> <span class="id"><a href="TSOMem.html#valid_access_dec">valid_access_dec</a></span>; <span class="id">inv</span> <span class="id">B</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="ClientSim.html#Ic_buf_alloc_invalid">Ic_buf_alloc_invalid</a></span>. <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">A</span>. <span class="id">right</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="ClientSim.html#Ic_buf_alloc_invalid">Ic_buf_alloc_invalid</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;} <br/>
&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id"><a href="ClientSim.html#buf_alloc_norep">buf_alloc_norep</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">auto</span>. <span class="id">exploit</span> (<span class="id"><a href="ClientSim.html#Ic_buf_alloc_norep">Ic_buf_alloc_norep</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">HIc</span> <span class="id">t</span> <span class="id">t</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">i</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">j</span>)); <span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">A</span>; <span class="tactic">eauto</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>. <span class="tactic">apply</span> <span class="id">n</span>. <span class="id">exploit</span> (<span class="id"><a href="ClientSim.html#Ic_buf_alloc_norep">Ic_buf_alloc_norep</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">HIc</span> <span class="id">t</span> <span class="id">t</span>' (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">i</span>) <span class="id">j</span>); <span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">A</span>; <span class="tactic">eauto</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>. <span class="tactic">apply</span> <span class="id">n</span>. <span class="id">exploit</span> (<span class="id"><a href="ClientSim.html#Ic_buf_alloc_norep">Ic_buf_alloc_norep</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">HIc</span> <span class="id">t0</span> <span class="id">t</span> <span class="id">i</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">j</span>)); <span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">A</span>; <span class="tactic">eauto</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="ClientSim.html#Ic_buf_alloc_norep">Ic_buf_alloc_norep</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="UBImplies_Rc">UBImplies_Rc</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> : <span class="id"><a href="GlobDefs.html#tid">tid</a></span>, <span class="id"><a href="RGRels.html#UBImplies">UBImplies</a></span> <span class="id"><a href="ClientSim.html#Ic">Ic</a></span> (<span class="id"><a href="ClientSim.html#Rc">Rc</a></span> <span class="id"><a href="ClientSim.html#t">t</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9455')">Proof.</div>
<div class="proofscript" id="proof9455">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="RGRels.html#UBImplies">UBImplies</a></span>. <span class="tactic">intros</span> <span class="id">t</span> <span class="id">gm</span> <span class="id">tm</span> <span class="id">gm</span>' <span class="id">tm</span>' <span class="id">HIc</span> <span class="id">HUB</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="ClientSim.html#UBSta_Ic">UBSta_Ic</a></span>; <span class="tactic">eauto</span>. <span class="tactic">destruct</span> <span class="id">HUB</span>. <span class="tactic">subst</span>. <span class="tactic">unfold</span> <span class="id"><a href="ClientSim.html#Rc">Rc</a></span>. <span class="tactic">tauto</span>.<br/>
Qed.</div>
<br/>
<br/>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">nth_error_split</span>':<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span> (<span class="id">l</span> <span class="id">ls</span>:<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="ClientSim.html#A">A</a></span>) <span class="id">i</span> <span class="id">a</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id"><a href="ClientSim.html#l">l</a></span>++<span class="id"><a href="ClientSim.html#ls">ls</a></span>) <span class="id"><a href="ClientSim.html#i">i</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="ClientSim.html#a">a</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id"><a href="ClientSim.html#l">l</a></span> <span class="id"><a href="ClientSim.html#i">i</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="ClientSim.html#a">a</a></span> \/ ( <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id"><a href="ClientSim.html#ls">ls</a></span> (<span class="id"><a href="ClientSim.html#i">i</a></span>-(<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="ClientSim.html#l">l</a></span>)) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="ClientSim.html#a">a</a></span> /\ (<span class="id"><a href="ClientSim.html#i">i</a></span> &gt;= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="ClientSim.html#l">l</a></span>)%<span class="id">nat</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9456')">Proof.</div>
<div class="proofscript" id="proof9456">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>;<span class="tactic">simpl</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">right</span>;<span class="tactic">eauto</span>. <span class="tactic">assert</span>((<span class="id">i</span>-0)%<span class="id">nat</span>=<span class="id">i</span>). <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">i</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">left</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">eapply</span> <span class="id">IHl</span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> [|[]].<br/>
&nbsp;&nbsp;<span class="id">left</span>;<span class="tactic">eauto</span>. <span class="id">right</span>;<span class="tactic">split</span>;<span class="tactic">auto</span>. <span class="tactic">omega</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="nth_error_nil">nth_error_nil</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span> <span class="id">i</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id"><a href="ClientSim.html#A">A</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> <span class="id"><a href="ClientSim.html#i">i</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9457')">Proof.</div>
<div class="proofscript" id="proof9457">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">i</span>;<span class="tactic">auto</span>.<br/>
Qed.</div>
<span class="kwd">Lemma</span> <span class="id"><a name="nth_error_cons_nil">nth_error_cons_nil</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span> (<span class="id">bi</span> <span class="id">bi</span>':<span class="id"><a href="ClientSim.html#A">A</a></span>) <span class="id">i</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id"><a href="ClientSim.html#bi">bi</a></span>::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id"><a href="ClientSim.html#i">i</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">bi</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#i">i</a></span> = 0%<span class="id">nat</span> /\ <span class="id"><a href="ClientSim.html#bi">bi</a></span> = <span class="id">bi</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9458')">Proof.</div>
<div class="proofscript" id="proof9458">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">i</span>;<span class="id">inv</span> <span class="id">H</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="ClientSim.html#nth_error_nil">nth_error_nil</a></span> <span class="id">A</span> <span class="id">i</span>. <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Local</span> <span class="kwd">Ltac</span> <span class="id">Hsimpl</span>:=<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H1</span>:?<span class="id">a</span>,<span class="id">H2</span>:?<span class="id">a</span>-&gt;?<span class="id">b</span>|-<span class="id">_</span>=&gt;<span class="id">specialize</span> (<span class="id">H2</span> <span class="id">H1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>:<span class="id">_</span>/\<span class="id">_</span>|-<span class="id">_</span>=&gt; <span class="tactic">destruct</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>:<span class="id">exists</span> <span class="id">_</span>,<span class="id">_</span>|-<span class="id">_</span>=&gt;<span class="tactic">destruct</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<span class="kwd">Local</span> <span class="kwd">Ltac</span> <span class="id">Esimpl</span>:=<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>:<span class="id">_</span>|-<span class="id">_</span>/\<span class="id">_</span>=&gt;<span class="tactic">split</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>:<span class="id">_</span>|-<span class="id">exists</span> <span class="id">_</span>,<span class="id">_</span>=&gt;<span class="id">eexists</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<span class="kwd">Local</span> <span class="kwd">Ltac</span> <span class="id">ex_match</span>:=<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>: <span class="kwd">match</span> ?<span class="id">x</span> <span class="kwd">with</span> <span class="id">_</span> =&gt; <span class="id">_</span> <span class="kwd">end</span> = <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="tactic">destruct</span> <span class="id">x</span> <span class="id">eqn</span>:?<span class="id">Hx</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
<span class="kwd">Local</span> <span class="kwd">Ltac</span> <span class="id">ex_match2</span>:=<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>: <span class="id">context</span>[<span class="kwd">match</span> ?<span class="id">x</span> <span class="kwd">with</span> <span class="id">_</span> =&gt; <span class="id">_</span> <span class="kwd">end</span>]  |- <span class="id">_</span> =&gt; <span class="tactic">destruct</span> <span class="id">x</span> <span class="id">eqn</span>:?<span class="id">Hx</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>: <span class="id">_</span> |- <span class="id">context</span>[<span class="kwd">match</span> ?<span class="id">x</span> <span class="kwd">with</span> <span class="id">_</span> =&gt; <span class="id">_</span> <span class="kwd">end</span> ] =&gt; <span class="tactic">destruct</span> <span class="id">x</span> <span class="id">eqn</span>:?<span class="id">Hx</span>;<span class="tactic">try</span> <span class="tactic">discriminate</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<span class="tactic">try</span> <span class="tactic">congruence</span>;<span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
<span class="kwd">Local</span> <span class="kwd">Ltac</span> <span class="id">ex_match3</span>:=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H</span>: ?<span class="id">x</span> = ?<span class="id">y</span> |- <span class="id">context</span> [?<span class="id">x</span>] =&gt; <span class="tactic">rewrite</span> <span class="id">H</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">solve_nth_error</span>:=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">H</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (?<span class="id">x</span>::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) ?<span class="id">y</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> ?<span class="id">z</span> |- <span class="id">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;=&gt; <span class="tactic">eapply</span> <span class="id"><a href="ClientSim.html#nth_error_cons_nil">nth_error_cons_nil</a></span> <span class="kwd">in</span> <span class="id">H</span>;<span class="id">Hsimpl</span>;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id">x</span> = <span class="id">z</span> |- <span class="id">_</span> =&gt; <span class="id">inv</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;| <span class="id">H</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (?<span class="id">l</span>++?<span class="id">ls</span>) ?<span class="id">i</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> ?<span class="id">a</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">nth_error_split</span>' <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> [|[]]<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<span class="kwd">Ltac</span> <span class="id">esolve_nth_error</span>:=<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">solve_nth_error</span>;<span class="tactic">subst</span>;<span class="tactic">eauto</span>.<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="alloc_norep_preserve">alloc_norep_preserve</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bufs</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#buf_alloc_norep">buf_alloc_norep</a></span> (<span class="id"><a href="TSOMem.html#mktsomem">mktsomem</a></span> <span class="id"><a href="ClientSim.html#bufs">bufs</a></span> <span class="id"><a href="ClientSim.html#m">m</a></span>)-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="ClientSim.html#bi">bi</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id">b0</span> <span class="id">lo0</span> <span class="id">hi0</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">b</span> <span class="id">lo</span> <span class="id">hi</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id"><a href="ClientSim.html#b">b</a></span> <span class="id"><a href="ClientSim.html#lo">lo</a></span> <span class="id"><a href="ClientSim.html#hi">hi</a></span>)(<span class="id"><a href="ClientSim.html#bufs">bufs</a></span> <span class="id"><a href="ClientSim.html#t">t</a></span>) -&gt; <span class="id"><a href="ClientSim.html#b">b</a></span> &lt;&gt; <span class="id">b0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="ClientSim.html#buf_alloc_norep">buf_alloc_norep</a></span> (<span class="id"><a href="TSOMem.html#mktsomem">mktsomem</a></span> (<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span> <span class="id"><a href="ClientSim.html#t">t</a></span> (<span class="id"><a href="ClientSim.html#bufs">bufs</a></span> <span class="id"><a href="ClientSim.html#t">t</a></span> ++ (<span class="id"><a href="ClientSim.html#bi">bi</a></span>::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)) <span class="id"><a href="ClientSim.html#bufs">bufs</a></span>) <span class="id">m</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9459')">Proof.</div>
<div class="proofscript" id="proof9459">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bi</span>;<span class="tactic">unfold</span> <span class="id"><a href="ClientSim.html#buf_alloc_norep">buf_alloc_norep</a></span>,<span class="id"><a href="TSOMem.html#tupdate">tupdate</a></span>;<span class="tactic">simpl</span>;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">R</span>:<span class="kwd">forall</span> (<span class="id">t</span> : <span class="id"><a href="GlobDefs.html#tid">tid</a></span>) (<span class="id">b0</span> : <span class="id"><a href="Values.html#block">block</a></span>) (<span class="id">lo</span> <span class="id">hi</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) <span class="id">i</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id">bufs</span> <span class="id"><a href="ClientSim.html#t">t</a></span>) <span class="id"><a href="ClientSim.html#i">i</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="TSOMem.html#BufferedAlloc">BufferedAlloc</a></span> <span class="id"><a href="ClientSim.html#b0">b0</a></span> <span class="id"><a href="ClientSim.html#lo">lo</a></span> <span class="id"><a href="ClientSim.html#hi">hi</a></span>) -&gt; <span class="id"><a href="ClientSim.html#b0">b0</a></span> &lt;&gt; <span class="id">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id">H0</span>;<span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error_In">nth_error_In</a></span>;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H0</span>;<span class="tactic">rename</span> <span class="id">R</span> <span class="id">into</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_match2</span>;<span class="tactic">subst</span>;<span class="tactic">eauto</span>;<span class="id">esolve_nth_error</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H2</span>;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">auto</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H1</span>;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H2</span>;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="id">esolve_nth_error</span>.<br/>
&nbsp;&nbsp;<span class="id">ex_match2</span>; <span class="id">esolve_nth_error</span>.<br/>
Qed.</div>
</div>
<div class="footer"><hr/>Generated by coq2html</div>
</body>
</html>
