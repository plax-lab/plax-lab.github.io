<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module Fappli_double_round</title>
<meta name="description" content="Documentation of Coq module Fappli_double_round" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module Fappli_double_round</h1>
<div class="coq">
<h1> Conditions for innocuous double rounding. </h1>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Fcore_Raux</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Fcore_defs</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Fcore_generic_fmt</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Fcalc_ops</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Fcore_ulp</span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Psatz</span>.<br/>
<br/>
<span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">R_scope</span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id">Double_round</span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id">beta</span> : <span class="id">radix</span>.<br/>
<span class="kwd">Notation</span> <span class="id">bpow</span> <span class="id">e</span> := (<span class="id">bpow</span> <span class="id">beta</span> <span class="id">e</span>).<br/>
<span class="kwd">Notation</span> <span class="id">ln_beta</span> <span class="id">x</span> := (<span class="id">ln_beta</span> <span class="id">beta</span> <span class="id">x</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">double_round_eq</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">x</span> :=<br/>
&nbsp;&nbsp;<span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> (<span class="id">Znearest</span> <span class="id">choice1</span>) (<span class="id">round</span> <span class="id">beta</span> <span class="id">fexp2</span> (<span class="id">Znearest</span> <span class="id">choice2</span>) <span class="id">x</span>)<br/>
&nbsp;&nbsp;= <span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> (<span class="id">Znearest</span> <span class="id">choice1</span>) <span class="id">x</span>.<br/>
<br/>
<div class="doc">A little tactic to simplify terms of the form <span class="bracket"><span class="id">bpow</span> <span class="id">a</span> * <span class="id">bpow</span> <span class="id">b</span></span>. </div>
<span class="kwd">Ltac</span> <span class="id">bpow_simplify</span> :=<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id">context</span> [(<span class="id">Fcore_Raux.bpow</span> <span class="id">_</span> <span class="id">_</span> * <span class="id">Fcore_Raux.bpow</span> <span class="id">_</span> <span class="id">_</span>)] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">bpow_plus</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id">context</span> [(?<span class="id">X1</span> * <span class="id">Fcore_Raux.bpow</span> <span class="id">_</span> <span class="id">_</span> * <span class="id">Fcore_Raux.bpow</span> <span class="id">_</span> <span class="id">_</span>)] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Rmult_assoc</span> <span class="id">X1</span>); <span class="tactic">rewrite</span> &lt;- <span class="id">bpow_plus</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id">context</span> [(?<span class="id">X1</span> * (?<span class="id">X2</span> * <span class="id">Fcore_Raux.bpow</span> <span class="id">_</span> <span class="id">_</span>) * <span class="id">Fcore_Raux.bpow</span> <span class="id">_</span> <span class="id">_</span>)] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rmult_assoc</span> <span class="id">X1</span> <span class="id">X2</span>); <span class="tactic">rewrite</span> (<span class="id">Rmult_assoc</span> (<span class="id">X1</span> * <span class="id">X2</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">bpow_plus</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id">context</span> [(<span class="id">Fcore_Raux.bpow</span> <span class="id">_</span> ?<span class="id">X</span>)] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">progress</span> <span class="id">ring_simplify</span> <span class="id">X</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;<span class="id">change</span> (<span class="id">Fcore_Raux.bpow</span> <span class="id">_</span> 0) <span class="kwd">with</span> 1;<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id">context</span> [(<span class="id">_</span> * 1)] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_1_r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">midp</span> (<span class="id">fexp</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>) (<span class="id">x</span> : <span class="id">R</span>) :=<br/>
&nbsp;&nbsp;<span class="id">round</span> <span class="id">beta</span> <span class="id">fexp</span> <span class="id">Zfloor</span> <span class="id">x</span> + / 2 * <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp</span> <span class="id">x</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">midp</span>' (<span class="id">fexp</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>) (<span class="id">x</span> : <span class="id">R</span>) :=<br/>
&nbsp;&nbsp;<span class="id">round</span> <span class="id">beta</span> <span class="id">fexp</span> <span class="id">Zceil</span> <span class="id">x</span> - / 2 * <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp</span> <span class="id">x</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_lt_mid_further_place</span>' :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>),<br/>
&nbsp;&nbsp;<span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt; <span class="id">Valid_exp</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">choice1</span> <span class="id">choice2</span> : <span class="id">Z</span> -&gt; <span class="id">bool</span>),<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;0 &lt; <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">fexp2</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - 1)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">x</span> &lt; <span class="id">bpow</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - / 2 * <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp2</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">x</span> &lt; <span class="id">midp</span> <span class="id">fexp1</span> <span class="id">x</span> - / 2 * <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp2</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5428')">Proof.</div>
<div class="proofscript" id="proof5428">
<span class="tactic">intros</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Vfexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">x</span> <span class="id">Px</span> <span class="id">Hf2f1</span> <span class="id">Hx1</span>.<br/>
<span class="tactic">unfold</span> <span class="id">double_round_eq</span>.<br/>
<span class="tactic">set</span> (<span class="id">x</span>' := <span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zfloor</span> <span class="id">x</span>).<br/>
<span class="tactic">intro</span> <span class="id">Hx2</span>'.<br/>
<span class="tactic">assert</span> (<span class="id">Hx2</span> : <span class="id">x</span> - <span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zfloor</span> <span class="id">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt; / 2 * (<span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> - <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp2</span> <span class="id">x</span>)).<br/>
{ <span class="id">now</span> <span class="tactic">apply</span> (<span class="id">Rplus_lt_reg_r</span> (<span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zfloor</span> <span class="id">x</span>)); <span class="id">ring_simplify</span>. }<br/>
<span class="tactic">set</span> (<span class="id">x</span>'' := <span class="id">round</span> <span class="id">beta</span> <span class="id">fexp2</span> (<span class="id">Znearest</span> <span class="id">choice2</span>) <span class="id">x</span>).<br/>
<span class="tactic">assert</span> (<span class="id">Hr1</span> : <span class="id">Rabs</span> (<span class="id">x</span>'' - <span class="id">x</span>) &lt;= / 2 * <span class="id">bpow</span> (<span class="id">fexp2</span> (<span class="id">ln_beta</span> <span class="id">x</span>))).<br/>
<span class="tactic">apply</span> <span class="id">Rle_trans</span> <span class="kwd">with</span> (/ 2 * <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp2</span> <span class="id">x</span>).<br/>
<span class="id">now</span> <span class="tactic">unfold</span> <span class="id">x</span>''; <span class="tactic">apply</span> <span class="id">error_le_half_ulp</span>...<br/>
<span class="tactic">rewrite</span> <span class="id">ulp_neq_0</span>;[<span class="id">now</span> <span class="id">right</span>|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>].<br/>
<span class="tactic">assert</span> (<span class="id">Pxx</span>' : 0 &lt;= <span class="id">x</span> - <span class="id">x</span>').<br/>
{ <span class="tactic">apply</span> <span class="id">Rle_0_minus</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">round_DN_pt</span>.<br/>
&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">Vfexp1</span>. }<br/>
<span class="tactic">rewrite</span> 2!<span class="id">ulp_neq_0</span> <span class="kwd">in</span> <span class="id">Hx2</span>; <span class="tactic">try</span> (<span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>; <span class="tactic">assumption</span>).<br/>
<span class="tactic">assert</span> (<span class="id">Hr2</span> : <span class="id">Rabs</span> (<span class="id">x</span>'' - <span class="id">x</span>') &lt; / 2 * <span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))).<br/>
{ <span class="tactic">replace</span> (<span class="id">x</span>'' - <span class="id">x</span>') <span class="kwd">with</span> (<span class="id">x</span>'' - <span class="id">x</span> + (<span class="id">x</span> - <span class="id">x</span>')) <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rle_lt_trans</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">Rabs_triang</span> <span class="id">_</span> <span class="id">_</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (/ 2 * <span class="id">_</span>) <span class="kwd">with</span> (/ 2 * <span class="id">bpow</span> (<span class="id">fexp2</span> (<span class="id">ln_beta</span> <span class="id">x</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ (/ 2 * (<span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">bpow</span> (<span class="id">fexp2</span> (<span class="id">ln_beta</span> <span class="id">x</span>))))) <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rplus_le_lt_compat</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">exact</span> <span class="id">Hr1</span>.<br/>
&nbsp;&nbsp;- <span class="id">now</span> <span class="tactic">rewrite</span> <span class="id">Rabs_right</span>; [|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rle_ge</span>]; <span class="tactic">apply</span> <span class="id">Hx2</span>. }<br/>
<span class="tactic">destruct</span> (<span class="id">Req_dec</span> <span class="id">x</span>'' 0) <span class="kwd">as</span> [<span class="id">Zx</span>''|<span class="id">Nzx</span>''].<br/>
- <span class="comment">(*&nbsp;x''&nbsp;=&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Zx</span>'' <span class="kwd">in</span> <span class="id">Hr1</span> |- *.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">round_0</span>; [|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">valid_rnd_N</span>].<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">round</span>, <span class="id">F2R</span>, <span class="id">scaled_mantissa</span>, <span class="id">canonic_exp</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Znearest_imp</span> <span class="id">_</span> <span class="id">_</span> 0); [<span class="id">now</span> <span class="tactic">simpl</span>; <span class="tactic">rewrite</span> <span class="id">Rmult_0_l</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_r</span> (<span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>)))); [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rabs_right</span> (<span class="id">bpow</span> (<span class="id">fexp1</span> <span class="id">_</span>))) <span class="tactic">at</span> 1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rle_ge</span>; <span class="tactic">apply</span> <span class="id">bpow_ge_0</span>].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Rabs_mult</span>; <span class="tactic">rewrite</span> <span class="id">Rmult_minus_distr_r</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_0_l</span>.<br/>
&nbsp;&nbsp;<span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rabs_minus_sym</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rle_lt_trans</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hr1</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rmult_lt_compat_l</span>; [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bpow_lt</span>.<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
- <span class="comment">(*&nbsp;x''&nbsp;&lt;&gt;&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Lx</span>'' : <span class="id">ln_beta</span> <span class="id">x</span>'' = <span class="id">ln_beta</span> <span class="id">x</span> :&gt; <span class="id">Z</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">Zle_antisym</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">ln_beta_le_bpow</span>; [<span class="tactic">exact</span> <span class="id">Nzx</span>''|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> <span class="id">x</span>'' <span class="kwd">with</span> (<span class="id">x</span>'' - <span class="id">x</span> + <span class="id">x</span>) <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rle_lt_trans</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">Rabs_triang</span> <span class="id">_</span> <span class="id">_</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">bpow</span> <span class="id">_</span>) <span class="kwd">with</span> (/ 2 * <span class="id">bpow</span> (<span class="id">fexp2</span> (<span class="id">ln_beta</span> <span class="id">x</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ (<span class="id">bpow</span> (<span class="id">ln_beta</span> <span class="id">x</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- / 2 * <span class="id">bpow</span> (<span class="id">fexp2</span> (<span class="id">ln_beta</span> <span class="id">x</span>)))) <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rplus_le_lt_compat</span>; [<span class="tactic">exact</span> <span class="id">Hr1</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">ulp_neq_0</span> <span class="kwd">in</span> <span class="id">Hx1</span>;[<span class="id">idtac</span>| <span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">rewrite</span> <span class="id">Rabs_right</span>; [|<span class="tactic">apply</span> <span class="id">Rle_ge</span>; <span class="tactic">apply</span> <span class="id">Rlt_le</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">x</span>'' <span class="kwd">in</span> <span class="id">Nzx</span>'' |- *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_round_ge</span>; [|<span class="tactic">apply</span> <span class="id">valid_rnd_N</span>|]. }<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">round</span>, <span class="id">F2R</span>, <span class="id">scaled_mantissa</span>, <span class="id">canonic_exp</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Lx</span>''.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Znearest_imp</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">Zfloor</span> (<span class="id">scaled_mantissa</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span>))).<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> (<span class="id">Znearest_imp</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">Zfloor</span> (<span class="id">scaled_mantissa</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span>)));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">reflexivity</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_r</span> (<span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>)))); [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rabs_right</span> (<span class="id">bpow</span> (<span class="id">fexp1</span> <span class="id">_</span>))) <span class="tactic">at</span> 1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rle_ge</span>; <span class="tactic">apply</span> <span class="id">bpow_ge_0</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Rabs_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_minus_distr_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fold</span> <span class="id">x</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rabs_right</span>; [|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rle_ge</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rlt_le_trans</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hx2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rmult_le_compat_l</span>; [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">bpow_ge_0</span> <span class="id">beta</span> (<span class="id">fexp2</span> (<span class="id">ln_beta</span> <span class="id">x</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">ulp</span>, <span class="id">canonic_exp</span>; <span class="id">lra</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_r</span> (<span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>)))); [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rabs_right</span> (<span class="id">bpow</span> (<span class="id">fexp1</span> <span class="id">_</span>))) <span class="tactic">at</span> 1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rle_ge</span>; <span class="tactic">apply</span> <span class="id">bpow_ge_0</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Rabs_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_minus_distr_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fold</span> <span class="id">x</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">bpow_simplify</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_lt_mid_further_place</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>),<br/>
&nbsp;&nbsp;<span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt; <span class="id">Valid_exp</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">choice1</span> <span class="id">choice2</span> : <span class="id">Z</span> -&gt; <span class="id">bool</span>),<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;0 &lt; <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">fexp2</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - 1)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt;= <span class="id">ln_beta</span> <span class="id">x</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">x</span> &lt; <span class="id">midp</span> <span class="id">fexp1</span> <span class="id">x</span> - / 2 * <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp2</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5429')">Proof.</div>
<div class="proofscript" id="proof5429">
<span class="tactic">intros</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Vfexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">x</span> <span class="id">Px</span> <span class="id">Hf2f1</span> <span class="id">Hf1</span>.<br/>
<span class="tactic">intro</span> <span class="id">Hx2</span>'.<br/>
<span class="tactic">assert</span> (<span class="id">Hx2</span> : <span class="id">x</span> - <span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zfloor</span> <span class="id">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt; / 2 * (<span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> - <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp2</span> <span class="id">x</span>)).<br/>
{ <span class="id">now</span> <span class="tactic">apply</span> (<span class="id">Rplus_lt_reg_r</span> (<span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zfloor</span> <span class="id">x</span>)); <span class="id">ring_simplify</span>. }<br/>
<span class="id">revert</span> <span class="id">Hx2</span>.<br/>
<span class="tactic">unfold</span> <span class="id">double_round_eq</span>.<br/>
<span class="tactic">set</span> (<span class="id">x</span>' := <span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zfloor</span> <span class="id">x</span>).<br/>
<span class="tactic">intro</span> <span class="id">Hx2</span>.<br/>
<span class="tactic">assert</span> (<span class="id">Pxx</span>' : 0 &lt;= <span class="id">x</span> - <span class="id">x</span>').<br/>
{ <span class="tactic">apply</span> <span class="id">Rle_0_minus</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">round_DN_pt</span>.<br/>
&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">Vfexp1</span>. }<br/>
<span class="tactic">assert</span> (<span class="id">x</span> &lt; <span class="id">bpow</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - / 2 * <span class="id">bpow</span> (<span class="id">fexp2</span> (<span class="id">ln_beta</span> <span class="id">x</span>)));<br/>
&nbsp;&nbsp;[|<span class="tactic">apply</span> <span class="id">double_round_lt_mid_further_place</span>'; <span class="tactic">try</span> <span class="tactic">assumption</span>]...<br/>
2: <span class="tactic">rewrite</span> <span class="id">ulp_neq_0</span>;[<span class="tactic">assumption</span>|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>].<br/>
<span class="tactic">destruct</span> (<span class="id">Req_dec</span> <span class="id">x</span>' 0) <span class="kwd">as</span> [<span class="id">Zx</span>'|<span class="id">Nzx</span>'].<br/>
- <span class="comment">(*&nbsp;x'&nbsp;=&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Zx</span>' <span class="kwd">in</span> <span class="id">Hx2</span>; <span class="tactic">rewrite</span> <span class="id">Rminus_0_r</span> <span class="kwd">in</span> <span class="id">Hx2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rlt_le_trans</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hx2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_minus_distr_l</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> 2!<span class="id">ulp_neq_0</span>;[<span class="id">idtac</span>|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rplus_le_compat_r</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_le_reg_r</span> (<span class="id">bpow</span> (- <span class="id">ln_beta</span> <span class="id">x</span>))); [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">ulp</span>, <span class="id">canonic_exp</span>; <span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rinv_r</span> 2) <span class="tactic">at</span> 3; [|<span class="id">lra</span>].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_comm</span>; <span class="tactic">apply</span> <span class="id">Rmult_le_compat_r</span>; [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rle_trans</span> <span class="kwd">with</span> 1; [|<span class="id">lra</span>].<br/>
&nbsp;&nbsp;<span class="id">change</span> 1 <span class="kwd">with</span> (<span class="id">bpow</span> 0); <span class="tactic">apply</span> <span class="id">bpow_le</span>.<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
- <span class="comment">(*&nbsp;x'&nbsp;&lt;&gt;&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Px</span>' : 0 &lt; <span class="id">x</span>').<br/>
&nbsp;&nbsp;{ <span class="tactic">assert</span> (0 &lt;= <span class="id">x</span>'); [|<span class="id">lra</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">x</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_le_reg_r</span> (<span class="id">bpow</span> (- <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_0_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">round</span>, <span class="id">F2R</span>, <span class="id">canonic_exp</span>; <span class="tactic">simpl</span>; <span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> 0 <span class="kwd">with</span> (<span class="id">Z2R</span> 0); <span class="tactic">apply</span> <span class="id">Z2R_le</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Zfloor_lub</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rabs_right</span> <span class="id">x</span>); [|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rle_ge</span>; <span class="tactic">apply</span> <span class="id">Rlt_le</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">scaled_mantissa_abs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rabs_pos</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hx</span>' : <span class="id">x</span>' &lt;= <span class="id">bpow</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> (<span class="id">Rplus_le_reg_r</span> (<span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span>)); <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">ulp_DN</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">change</span> (<span class="id">round</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>) <span class="kwd">with</span> <span class="id">x</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">id_p_ulp_le_bpow</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">exact</span> <span class="id">Px</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">change</span> <span class="id">x</span>' <span class="kwd">with</span> (<span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zfloor</span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_round</span>; [|<span class="tactic">apply</span> <span class="id">valid_rnd_DN</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">Rle_lt_trans</span> <span class="kwd">with</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">now</span> <span class="tactic">apply</span> <span class="id">round_DN_pt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> &lt;- (<span class="id">Rabs_right</span> <span class="id">x</span>) <span class="tactic">at</span> 1; [|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rle_ge</span>; <span class="tactic">apply</span> <span class="id">Rlt_le</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bpow_ln_beta_gt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">exact</span> <span class="id">Vfexp1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">exact</span> <span class="id">Px</span>'. }<br/>
&nbsp;&nbsp;<span class="id">fold</span> (<span class="id">canonic_exp</span> <span class="id">beta</span> <span class="id">fexp2</span> <span class="id">x</span>); <span class="id">fold</span> (<span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp2</span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (/ 2 * <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> &lt;= <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rmult_1_l</span> (<span class="id">ulp</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>)) <span class="tactic">at</span> 2.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rmult_le_compat_r</span>; [|<span class="id">lra</span>].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">ulp_ge_0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> 2!<span class="id">ulp_neq_0</span> <span class="kwd">in</span> <span class="id">Hx2</span>;[|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">ulp_neq_0</span> <span class="kwd">in</span> <span class="id">Hx</span>';[|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">ulp_neq_0</span> <span class="kwd">in</span> <span class="id">H</span>;[|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>].<br/>
&nbsp;&nbsp;<span class="id">lra</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_lt_mid_same_place</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>),<br/>
&nbsp;&nbsp;<span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">choice1</span> <span class="id">choice2</span> : <span class="id">Z</span> -&gt; <span class="id">bool</span>),<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;0 &lt; <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">fexp2</span> (<span class="id">ln_beta</span> <span class="id">x</span>) = <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">x</span> &lt; <span class="id">midp</span> <span class="id">fexp1</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5430')">Proof.</div>
<div class="proofscript" id="proof5430">
<span class="tactic">intros</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">x</span> <span class="id">Px</span> <span class="id">Hf2f1</span>.<br/>
<span class="tactic">intro</span> <span class="id">Hx</span>'.<br/>
<span class="tactic">assert</span> (<span class="id">Hx</span> : <span class="id">x</span> - <span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zfloor</span> <span class="id">x</span> &lt; / 2 * <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span>).<br/>
{ <span class="id">now</span> <span class="tactic">apply</span> (<span class="id">Rplus_lt_reg_r</span> (<span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zfloor</span> <span class="id">x</span>)); <span class="id">ring_simplify</span>. }<br/>
<span class="id">revert</span> <span class="id">Hx</span>.<br/>
<span class="tactic">unfold</span> <span class="id">double_round_eq</span>.<br/>
<span class="tactic">set</span> (<span class="id">x</span>' := <span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zfloor</span> <span class="id">x</span>).<br/>
<span class="tactic">intro</span> <span class="id">Hx</span>.<br/>
<span class="tactic">assert</span> (<span class="id">Pxx</span>' : 0 &lt;= <span class="id">x</span> - <span class="id">x</span>').<br/>
{ <span class="tactic">apply</span> <span class="id">Rle_0_minus</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">round_DN_pt</span>.<br/>
&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">Vfexp1</span>. }<br/>
<span class="tactic">assert</span> (<span class="id">H</span> : <span class="id">Rabs</span> (<span class="id">x</span> * <span class="id">bpow</span> (- <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>)) -<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Z2R</span> (<span class="id">Zfloor</span> (<span class="id">x</span> * <span class="id">bpow</span> (- <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))))) &lt; / 2).<br/>
{ <span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_r</span> (<span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>)))); [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">scaled_mantissa</span>, <span class="id">canonic_exp</span> <span class="kwd">in</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rabs_right</span> (<span class="id">bpow</span> (<span class="id">fexp1</span> <span class="id">_</span>))) <span class="tactic">at</span> 1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rle_ge</span>; <span class="tactic">apply</span> <span class="id">bpow_ge_0</span>].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Rabs_mult</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_minus_distr_r</span>.<br/>
&nbsp;&nbsp;<span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rabs_lt</span>.<br/>
&nbsp;&nbsp;<span class="id">change</span> (<span class="id">Z2R</span> <span class="id">_</span> * <span class="id">_</span>) <span class="kwd">with</span> <span class="id">x</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">Rlt_le_trans</span> <span class="kwd">with</span> 0; [|<span class="tactic">exact</span> <span class="id">Pxx</span>'].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Ropp_0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Ropp_lt_contravar</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rmult_0_r</span> (/ 2)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rmult_lt_compat_l</span>; [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bpow_gt_0</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">ulp_neq_0</span> <span class="kwd">in</span> <span class="id">Hx</span>;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>; <span class="tactic">assumption</span>. }<br/>
<span class="tactic">unfold</span> <span class="id">round</span> <span class="tactic">at</span> 2.<br/>
<span class="tactic">unfold</span> <span class="id">F2R</span>, <span class="id">scaled_mantissa</span>, <span class="id">canonic_exp</span>; <span class="tactic">simpl</span>.<br/>
<span class="tactic">rewrite</span> <span class="id">Hf2f1</span>.<br/>
<span class="tactic">rewrite</span> (<span class="id">Znearest_imp</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">Zfloor</span> (<span class="id">scaled_mantissa</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span>))).<br/>
- <span class="tactic">rewrite</span> <span class="id">round_generic</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">unfold</span> <span class="id">round</span>, <span class="id">F2R</span>, <span class="id">scaled_mantissa</span>, <span class="id">canonic_exp</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">rewrite</span> (<span class="id">Znearest_imp</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">Zfloor</span> (<span class="id">x</span> * <span class="id">bpow</span> (- <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))))).<br/>
&nbsp;&nbsp;+ <span class="id">now</span> <span class="tactic">apply</span> <span class="id">valid_rnd_N</span>.<br/>
&nbsp;&nbsp;+ <span class="id">fold</span> (<span class="id">canonic_exp</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id">Z2R</span> <span class="id">_</span> * <span class="id">bpow</span> <span class="id">_</span>) <span class="kwd">with</span> (<span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zfloor</span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">generic_format_round</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">Vfexp1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">valid_rnd_DN</span>.<br/>
- <span class="id">now</span> <span class="tactic">unfold</span> <span class="id">scaled_mantissa</span>, <span class="id">canonic_exp</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_lt_mid</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>),<br/>
&nbsp;&nbsp;<span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt; <span class="id">Valid_exp</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">choice1</span> <span class="id">choice2</span> : <span class="id">Z</span> -&gt; <span class="id">bool</span>),<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;0 &lt; <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">fexp2</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt;= <span class="id">ln_beta</span> <span class="id">x</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">x</span> &lt; <span class="id">midp</span> <span class="id">fexp1</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;((<span class="id">fexp2</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - 1)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id">x</span> &lt; <span class="id">midp</span> <span class="id">fexp1</span> <span class="id">x</span> - / 2 * <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp2</span> <span class="id">x</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5431')">Proof.</div>
<div class="proofscript" id="proof5431">
<span class="tactic">intros</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Vfexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">x</span> <span class="id">Px</span> <span class="id">Hf2f1</span> <span class="id">Hf1</span> <span class="id">Hx</span> <span class="id">Hx</span>'.<br/>
<span class="tactic">destruct</span> (<span class="id">Zle_or_lt</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>)) (<span class="id">fexp2</span> (<span class="id">ln_beta</span> <span class="id">x</span>))) <span class="kwd">as</span> [<span class="id">Hf2</span>'|<span class="id">Hf2</span>'].<br/>
- <span class="comment">(*&nbsp;fexp1&nbsp;(ln_beta&nbsp;x)&nbsp;&lt;=&nbsp;fexp2&nbsp;(ln_beta&nbsp;x)&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hf2</span>'' : (<span class="id">fexp2</span> (<span class="id">ln_beta</span> <span class="id">x</span>) = <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) :&gt; <span class="id">Z</span>)%<span class="id">Z</span>); [<span class="tactic">omega</span>|].<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">double_round_lt_mid_same_place</span>.<br/>
- <span class="comment">(*&nbsp;fexp2&nbsp;(ln_beta&nbsp;x)&nbsp;&lt;&nbsp;fexp1&nbsp;(ln_beta&nbsp;x)&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hf2</span>'' : (<span class="id">fexp2</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - 1)%<span class="id">Z</span>); [<span class="tactic">omega</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Hx</span>' <span class="id">Hf2</span>''); <span class="tactic">intro</span> <span class="id">Hx</span>''.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">double_round_lt_mid_further_place</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_gt_mid_further_place</span>' :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>),<br/>
&nbsp;&nbsp;<span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt; <span class="id">Valid_exp</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">choice1</span> <span class="id">choice2</span> : <span class="id">Z</span> -&gt; <span class="id">bool</span>),<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;0 &lt; <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">fexp2</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - 1)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">round</span> <span class="id">beta</span> <span class="id">fexp2</span> (<span class="id">Znearest</span> <span class="id">choice2</span>) <span class="id">x</span> &lt; <span class="id">bpow</span> (<span class="id">ln_beta</span> <span class="id">x</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">midp</span>' <span class="id">fexp1</span> <span class="id">x</span> + / 2 * <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp2</span> <span class="id">x</span> &lt; <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5432')">Proof.</div>
<div class="proofscript" id="proof5432">
<span class="tactic">intros</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Vfexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">x</span> <span class="id">Px</span> <span class="id">Hf2f1</span>.<br/>
<span class="tactic">intros</span> <span class="id">Hx1</span> <span class="id">Hx2</span>'.<br/>
<span class="tactic">assert</span> (<span class="id">Hx2</span> : <span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zceil</span> <span class="id">x</span> - <span class="id">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt; / 2 * (<span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> - <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp2</span> <span class="id">x</span>)).<br/>
{ <span class="tactic">apply</span> (<span class="id">Rplus_lt_reg_r</span> (- / 2 * <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> + <span class="id">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ / 2 * <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp2</span> <span class="id">x</span>)); <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">unfold</span> <span class="id">midp</span>' <span class="kwd">in</span> <span class="id">Hx2</span>'. }<br/>
<span class="id">revert</span> <span class="id">Hx1</span> <span class="id">Hx2</span>.<br/>
<span class="tactic">unfold</span> <span class="id">double_round_eq</span>.<br/>
<span class="tactic">set</span> (<span class="id">x</span>' := <span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zceil</span> <span class="id">x</span>).<br/>
<span class="tactic">set</span> (<span class="id">x</span>'' := <span class="id">round</span> <span class="id">beta</span> <span class="id">fexp2</span> (<span class="id">Znearest</span> <span class="id">choice2</span>) <span class="id">x</span>).<br/>
<span class="tactic">intros</span> <span class="id">Hx1</span> <span class="id">Hx2</span>.<br/>
<span class="tactic">assert</span> (<span class="id">Hr1</span> : <span class="id">Rabs</span> (<span class="id">x</span>'' - <span class="id">x</span>) &lt;= / 2 * <span class="id">bpow</span> (<span class="id">fexp2</span> (<span class="id">ln_beta</span> <span class="id">x</span>))).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rle_trans</span> <span class="kwd">with</span> (/2* <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp2</span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">unfold</span> <span class="id">x</span>''; <span class="tactic">apply</span> <span class="id">error_le_half_ulp</span>...<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">ulp_neq_0</span>;[<span class="id">now</span> <span class="id">right</span>|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>].<br/>
<span class="tactic">assert</span> (<span class="id">Px</span>'<span class="id">x</span> : 0 &lt;= <span class="id">x</span>' - <span class="id">x</span>).<br/>
{ <span class="tactic">apply</span> <span class="id">Rle_0_minus</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">round_UP_pt</span>.<br/>
&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">Vfexp1</span>. }<br/>
<span class="tactic">assert</span> (<span class="id">Hr2</span> : <span class="id">Rabs</span> (<span class="id">x</span>'' - <span class="id">x</span>') &lt; / 2 * <span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))).<br/>
{ <span class="tactic">replace</span> (<span class="id">x</span>'' - <span class="id">x</span>') <span class="kwd">with</span> (<span class="id">x</span>'' - <span class="id">x</span> + (<span class="id">x</span> - <span class="id">x</span>')) <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rle_lt_trans</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">Rabs_triang</span> <span class="id">_</span> <span class="id">_</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (/ 2 * <span class="id">_</span>) <span class="kwd">with</span> (/ 2 * <span class="id">bpow</span> (<span class="id">fexp2</span> (<span class="id">ln_beta</span> <span class="id">x</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ (/ 2 * (<span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">bpow</span> (<span class="id">fexp2</span> (<span class="id">ln_beta</span> <span class="id">x</span>))))) <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rplus_le_lt_compat</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">exact</span> <span class="id">Hr1</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">Rabs_minus_sym</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> 2!<span class="id">ulp_neq_0</span> <span class="kwd">in</span> <span class="id">Hx2</span>; <span class="tactic">try</span> (<span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">rewrite</span> <span class="id">Rabs_right</span>; [|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rle_ge</span>]; <span class="tactic">apply</span> <span class="id">Hx2</span>. }<br/>
<span class="tactic">destruct</span> (<span class="id">Req_dec</span> <span class="id">x</span>'' 0) <span class="kwd">as</span> [<span class="id">Zx</span>''|<span class="id">Nzx</span>''].<br/>
- <span class="comment">(*&nbsp;x''&nbsp;=&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Zx</span>'' <span class="kwd">in</span> <span class="id">Hr1</span> |- *.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">round_0</span>; [|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">valid_rnd_N</span>].<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">round</span>, <span class="id">F2R</span>, <span class="id">scaled_mantissa</span>, <span class="id">canonic_exp</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Znearest_imp</span> <span class="id">_</span> <span class="id">_</span> 0); [<span class="id">now</span> <span class="tactic">simpl</span>; <span class="tactic">rewrite</span> <span class="id">Rmult_0_l</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_r</span> (<span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>)))); [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rabs_right</span> (<span class="id">bpow</span> (<span class="id">fexp1</span> <span class="id">_</span>))) <span class="tactic">at</span> 1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rle_ge</span>; <span class="tactic">apply</span> <span class="id">bpow_ge_0</span>].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Rabs_mult</span>; <span class="tactic">rewrite</span> <span class="id">Rmult_minus_distr_r</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_0_l</span>.<br/>
&nbsp;&nbsp;<span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rabs_minus_sym</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rle_lt_trans</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hr1</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rmult_lt_compat_l</span>; [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bpow_lt</span>.<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
- <span class="comment">(*&nbsp;x''&nbsp;&lt;&gt;&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Lx</span>'' : <span class="id">ln_beta</span> <span class="id">x</span>'' = <span class="id">ln_beta</span> <span class="id">x</span> :&gt; <span class="id">Z</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">Zle_antisym</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">ln_beta_le_bpow</span>; [<span class="tactic">exact</span> <span class="id">Nzx</span>''|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rabs_right</span>; [<span class="tactic">exact</span> <span class="id">Hx1</span>|<span class="tactic">apply</span> <span class="id">Rle_ge</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">round_ge_generic</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">exact</span> <span class="id">Vfexp2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">now</span> <span class="tactic">apply</span> <span class="id">valid_rnd_N</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">generic_format_0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rlt_le</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">x</span>'' <span class="kwd">in</span> <span class="id">Nzx</span>'' |- *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_round_ge</span>; [|<span class="tactic">apply</span> <span class="id">valid_rnd_N</span>|]. }<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">round</span>, <span class="id">F2R</span>, <span class="id">scaled_mantissa</span>, <span class="id">canonic_exp</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Lx</span>''.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Znearest_imp</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">Zceil</span> (<span class="id">scaled_mantissa</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span>))).<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> (<span class="id">Znearest_imp</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">Zceil</span> (<span class="id">scaled_mantissa</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span>)));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">reflexivity</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_r</span> (<span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>)))); [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rabs_right</span> (<span class="id">bpow</span> (<span class="id">fexp1</span> <span class="id">_</span>))) <span class="tactic">at</span> 1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rle_ge</span>; <span class="tactic">apply</span> <span class="id">bpow_ge_0</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Rabs_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_minus_distr_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fold</span> <span class="id">x</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rabs_minus_sym</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rabs_right</span>; [|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rle_ge</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rlt_le_trans</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hx2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rmult_le_compat_l</span>; [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">bpow_ge_0</span> <span class="id">beta</span> (<span class="id">fexp2</span> (<span class="id">ln_beta</span> <span class="id">x</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> 2!<span class="id">ulp_neq_0</span>; <span class="tactic">try</span> (<span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">canonic_exp</span>; <span class="id">lra</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_r</span> (<span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>)))); [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rabs_right</span> (<span class="id">bpow</span> (<span class="id">fexp1</span> <span class="id">_</span>))) <span class="tactic">at</span> 1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rle_ge</span>; <span class="tactic">apply</span> <span class="id">bpow_ge_0</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Rabs_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_minus_distr_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fold</span> <span class="id">x</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">bpow_simplify</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_gt_mid_further_place</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>),<br/>
&nbsp;&nbsp;<span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt; <span class="id">Valid_exp</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">choice1</span> <span class="id">choice2</span> : <span class="id">Z</span> -&gt; <span class="id">bool</span>),<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;0 &lt; <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">fexp2</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - 1)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt;= <span class="id">ln_beta</span> <span class="id">x</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">midp</span>' <span class="id">fexp1</span> <span class="id">x</span> + / 2 * <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp2</span> <span class="id">x</span> &lt; <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5433')">Proof.</div>
<div class="proofscript" id="proof5433">
<span class="tactic">intros</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Vfexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">x</span> <span class="id">Px</span> <span class="id">Hf2f1</span> <span class="id">Hf1</span> <span class="id">Hx2</span>'.<br/>
<span class="tactic">assert</span> (<span class="id">Hx2</span> : <span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zceil</span> <span class="id">x</span> - <span class="id">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt; / 2 * (<span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> - <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp2</span> <span class="id">x</span>)).<br/>
{ <span class="tactic">apply</span> (<span class="id">Rplus_lt_reg_r</span> (- / 2 * <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> + <span class="id">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ / 2 * <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp2</span> <span class="id">x</span>)); <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">unfold</span> <span class="id">midp</span>' <span class="kwd">in</span> <span class="id">Hx2</span>'. }<br/>
<span class="id">revert</span> <span class="id">Hx2</span>.<br/>
<span class="tactic">unfold</span> <span class="id">double_round_eq</span>.<br/>
<span class="tactic">set</span> (<span class="id">x</span>' := <span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zfloor</span> <span class="id">x</span>).<br/>
<span class="tactic">intro</span> <span class="id">Hx2</span>.<br/>
<span class="tactic">set</span> (<span class="id">x</span>'' := <span class="id">round</span> <span class="id">beta</span> <span class="id">fexp2</span> (<span class="id">Znearest</span> <span class="id">choice2</span>) <span class="id">x</span>).<br/>
<span class="tactic">destruct</span> (<span class="id">Rlt_or_le</span> <span class="id">x</span>'' (<span class="id">bpow</span> (<span class="id">ln_beta</span> <span class="id">x</span>))) <span class="kwd">as</span> [<span class="id">Hx</span>''|<span class="id">Hx</span>''];<br/>
&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">double_round_gt_mid_further_place</span>'|].<br/>
&nbsp;bpow&nbsp;(ln_beta&nbsp;x)&nbsp;&lt;=&nbsp;x''&nbsp;*)</span><span class="tactic">assert</span> (<span class="id">Hx</span>''<span class="id">pow</span> : <span class="id">x</span>'' = <span class="id">bpow</span> (<span class="id">ln_beta</span> <span class="id">x</span>)).<br/>
{ <span class="tactic">assert</span> (<span class="id">H</span>'<span class="id">x</span>'' : <span class="id">x</span>'' &lt; <span class="id">bpow</span> (<span class="id">ln_beta</span> <span class="id">x</span>) + / 2 * <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp2</span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">Rle_lt_trans</span> <span class="kwd">with</span> (<span class="id">x</span> + / 2 * <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp2</span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id">Rplus_le_reg_r</span> (- <span class="id">x</span>)); <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rabs_le_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">error_le_half_ulp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">Vfexp2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">Rplus_lt_compat_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Rabs_right</span> <span class="tactic">at</span> 1; [|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rle_ge</span>; <span class="tactic">apply</span> <span class="id">Rlt_le</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bpow_ln_beta_gt</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rle_antisym</span>; [|<span class="tactic">exact</span> <span class="id">Hx</span>''].<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">x</span>'', <span class="id">round</span>, <span class="id">F2R</span>, <span class="id">scaled_mantissa</span>, <span class="id">canonic_exp</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_le_reg_r</span> (<span class="id">bpow</span> (- <span class="id">fexp2</span> (<span class="id">ln_beta</span> <span class="id">x</span>)))); [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;<span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Z2R_Zpower</span> <span class="id">_</span> (<span class="id">_</span> - <span class="id">_</span>)); [|<span class="tactic">omega</span>].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Z2R_le</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Zlt_succ_le</span>; <span class="tactic">unfold</span> <span class="id">Z.succ</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">lt_Z2R</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Z2R_plus</span>; <span class="tactic">rewrite</span> <span class="id">Z2R_Zpower</span>; [|<span class="tactic">omega</span>].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_r</span> (<span class="id">bpow</span> (<span class="id">fexp2</span> (<span class="id">ln_beta</span> <span class="id">x</span>)))); [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_plus_distr_r</span>; <span class="tactic">rewrite</span> <span class="id">Rmult_1_l</span>.<br/>
&nbsp;&nbsp;<span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rlt_le_trans</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span>'<span class="id">x</span>'').<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rplus_le_compat_l</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rmult_1_l</span> (<span class="id">Fcore_Raux.bpow</span> <span class="id">_</span> <span class="id">_</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">ulp_neq_0</span>;[<span class="id">idtac</span>|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rmult_le_compat_r</span>; [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_ge_0</span>|].<br/>
&nbsp;&nbsp;<span class="id">lra</span>. }<br/>
<span class="tactic">assert</span> (<span class="id">Hr</span> : <span class="id">Rabs</span> (<span class="id">x</span> - <span class="id">x</span>'') &lt; / 2 * <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span>).<br/>
{ <span class="tactic">apply</span> <span class="id">Rle_lt_trans</span> <span class="kwd">with</span> (/ 2 * <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp2</span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">Rabs_minus_sym</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">error_le_half_ulp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">Vfexp2</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">Rmult_lt_compat_l</span>; [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> 2!<span class="id">ulp_neq_0</span>; <span class="tactic">try</span> <span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">canonic_exp</span>; <span class="tactic">apply</span> <span class="id">bpow_lt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>. }<br/>
<span class="tactic">unfold</span> <span class="id">round</span>, <span class="id">F2R</span>, <span class="id">scaled_mantissa</span>, <span class="id">canonic_exp</span>; <span class="tactic">simpl</span>.<br/>
<span class="tactic">assert</span> (<span class="id">Hf</span> : (0 &lt;= <span class="id">ln_beta</span> <span class="id">x</span> - <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>''))%<span class="id">Z</span>).<br/>
{ <span class="tactic">rewrite</span> <span class="id">Hx</span>''<span class="id">pow</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">ln_beta_bpow</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span> + 1) &lt;= <span class="id">ln_beta</span> <span class="id">x</span>)%<span class="id">Z</span>; [|<span class="tactic">omega</span>].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Zle_or_lt</span> (<span class="id">ln_beta</span> <span class="id">x</span>) (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))) <span class="kwd">as</span> [<span class="id">Hle</span>|<span class="id">Hlt</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Vfexp1</span>].<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H</span> : (<span class="id">ln_beta</span> <span class="id">x</span> = <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) :&gt; <span class="id">Z</span>)%<span class="id">Z</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Zle_antisym</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Vfexp1</span>. }<br/>
<span class="tactic">rewrite</span> (<span class="id">Znearest_imp</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">beta</span> ^ (<span class="id">ln_beta</span> <span class="id">x</span> - <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>'')))%<span class="id">Z</span>).<br/>
- <span class="tactic">rewrite</span> (<span class="id">Znearest_imp</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">beta</span> ^ (<span class="id">ln_beta</span> <span class="id">x</span> - <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>)))%<span class="id">Z</span>).<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">Z2R_Zpower</span>; [|<span class="tactic">exact</span> <span class="id">Hf</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Z2R_Zpower</span>; [|<span class="tactic">omega</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">Z2R_Zpower</span>; [|<span class="tactic">omega</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_r</span> (<span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>)))); [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rabs_right</span> (<span class="id">bpow</span> (<span class="id">fexp1</span> <span class="id">_</span>))) <span class="tactic">at</span> 1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rle_ge</span>; <span class="tactic">apply</span> <span class="id">bpow_ge_0</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Rabs_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_minus_distr_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">ulp_neq_0</span> <span class="kwd">in</span> <span class="id">Hr</span>;[<span class="id">idtac</span>|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hx</span>''<span class="id">pow</span>; <span class="tactic">exact</span> <span class="id">Hr</span>.<br/>
- <span class="tactic">rewrite</span> <span class="id">Z2R_Zpower</span>; [|<span class="tactic">exact</span> <span class="id">Hf</span>].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_r</span> (<span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>'')))); [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rabs_right</span> (<span class="id">bpow</span> (<span class="id">fexp1</span> <span class="id">_</span>))) <span class="tactic">at</span> 1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rle_ge</span>; <span class="tactic">apply</span> <span class="id">bpow_ge_0</span>].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Rabs_mult</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_minus_distr_r</span>.<br/>
&nbsp;&nbsp;<span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rminus_diag_eq</span>; [|<span class="tactic">exact</span> <span class="id">Hx</span>''<span class="id">pow</span>].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rabs_R0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rmult_0_r</span> (/ 2)).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rmult_lt_compat_l</span>; [<span class="id">lra</span>|<span class="tactic">apply</span> <span class="id">bpow_gt_0</span>].<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_gt_mid_same_place</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>),<br/>
&nbsp;&nbsp;<span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">choice1</span> <span class="id">choice2</span> : <span class="id">Z</span> -&gt; <span class="id">bool</span>),<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;0 &lt; <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">fexp2</span> (<span class="id">ln_beta</span> <span class="id">x</span>) = <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">midp</span>' <span class="id">fexp1</span> <span class="id">x</span> &lt; <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5434')">Proof.</div>
<div class="proofscript" id="proof5434">
<span class="tactic">intros</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">x</span> <span class="id">Px</span> <span class="id">Hf2f1</span> <span class="id">Hx</span>'.<br/>
<span class="tactic">assert</span> (<span class="id">Hx</span> : <span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zceil</span> <span class="id">x</span> - <span class="id">x</span> &lt; / 2 * <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span>).<br/>
{ <span class="tactic">apply</span> (<span class="id">Rplus_lt_reg_r</span> (- / 2 * <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> + <span class="id">x</span>)); <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">unfold</span> <span class="id">midp</span>' <span class="kwd">in</span> <span class="id">Hx</span>'. }<br/>
<span class="tactic">assert</span> (<span class="id">H</span> : <span class="id">Rabs</span> (<span class="id">Z2R</span> (<span class="id">Zceil</span> (<span class="id">x</span> * <span class="id">bpow</span> (- <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">x</span> * <span class="id">bpow</span> (- <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))) &lt; / 2).<br/>
{ <span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_r</span> (<span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>)))); [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">scaled_mantissa</span>, <span class="id">canonic_exp</span> <span class="kwd">in</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rabs_right</span> (<span class="id">bpow</span> (<span class="id">fexp1</span> <span class="id">_</span>))) <span class="tactic">at</span> 1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rle_ge</span>; <span class="tactic">apply</span> <span class="id">bpow_ge_0</span>].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Rabs_mult</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_minus_distr_r</span>.<br/>
&nbsp;&nbsp;<span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rabs_lt</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">Rlt_le_trans</span> <span class="kwd">with</span> 0.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> &lt;- <span class="id">Ropp_0</span>; <span class="tactic">apply</span> <span class="id">Ropp_lt_contravar</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rmult_0_r</span> (/ 2)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rmult_lt_compat_l</span>; [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bpow_gt_0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">Rle_0_minus</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">round_UP_pt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">Vfexp1</span>.<br/>
&nbsp;&nbsp;-  <span class="tactic">rewrite</span> <span class="id">ulp_neq_0</span> <span class="kwd">in</span> <span class="id">Hx</span>;[<span class="tactic">exact</span> <span class="id">Hx</span>|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>]. }<br/>
<span class="tactic">unfold</span> <span class="id">double_round_eq</span>, <span class="id">round</span> <span class="tactic">at</span> 2.<br/>
<span class="tactic">unfold</span> <span class="id">F2R</span>, <span class="id">scaled_mantissa</span>, <span class="id">canonic_exp</span>; <span class="tactic">simpl</span>.<br/>
<span class="tactic">rewrite</span> <span class="id">Hf2f1</span>.<br/>
<span class="tactic">rewrite</span> (<span class="id">Znearest_imp</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">Zceil</span> (<span class="id">scaled_mantissa</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span>))).<br/>
- <span class="tactic">rewrite</span> <span class="id">round_generic</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">unfold</span> <span class="id">round</span>, <span class="id">F2R</span>, <span class="id">scaled_mantissa</span>, <span class="id">canonic_exp</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">rewrite</span> (<span class="id">Znearest_imp</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">Zceil</span> (<span class="id">x</span> * <span class="id">bpow</span> (- <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>)))));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="tactic">rewrite</span> <span class="id">Rabs_minus_sym</span>].<br/>
&nbsp;&nbsp;+ <span class="id">now</span> <span class="tactic">apply</span> <span class="id">valid_rnd_N</span>.<br/>
&nbsp;&nbsp;+ <span class="id">fold</span> (<span class="id">canonic_exp</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id">Z2R</span> <span class="id">_</span> * <span class="id">bpow</span> <span class="id">_</span>) <span class="kwd">with</span> (<span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zceil</span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">generic_format_round</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">Vfexp1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">valid_rnd_UP</span>.<br/>
- <span class="id">now</span> <span class="tactic">rewrite</span> <span class="id">Rabs_minus_sym</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_gt_mid</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>),<br/>
&nbsp;&nbsp;<span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt; <span class="id">Valid_exp</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">choice1</span> <span class="id">choice2</span> : <span class="id">Z</span> -&gt; <span class="id">bool</span>),<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;0 &lt; <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">fexp2</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt;= <span class="id">ln_beta</span> <span class="id">x</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">midp</span>' <span class="id">fexp1</span> <span class="id">x</span> &lt; <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;((<span class="id">fexp2</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - 1)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id">midp</span>' <span class="id">fexp1</span> <span class="id">x</span> + / 2 * <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp2</span> <span class="id">x</span> &lt; <span class="id">x</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5435')">Proof.</div>
<div class="proofscript" id="proof5435">
<span class="tactic">intros</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Vfexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">x</span> <span class="id">Px</span> <span class="id">Hf2f1</span> <span class="id">Hf1</span> <span class="id">Hx</span> <span class="id">Hx</span>'.<br/>
<span class="tactic">destruct</span> (<span class="id">Zle_or_lt</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>)) (<span class="id">fexp2</span> (<span class="id">ln_beta</span> <span class="id">x</span>))) <span class="kwd">as</span> [<span class="id">Hf2</span>'|<span class="id">Hf2</span>'].<br/>
- <span class="comment">(*&nbsp;fexp1&nbsp;(ln_beta&nbsp;x)&nbsp;&lt;=&nbsp;fexp2&nbsp;(ln_beta&nbsp;x)&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hf2</span>'' : (<span class="id">fexp2</span> (<span class="id">ln_beta</span> <span class="id">x</span>) = <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) :&gt; <span class="id">Z</span>)%<span class="id">Z</span>); [<span class="tactic">omega</span>|].<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">double_round_gt_mid_same_place</span>.<br/>
- <span class="comment">(*&nbsp;fexp2&nbsp;(ln_beta&nbsp;x)&nbsp;&lt;&nbsp;fexp1&nbsp;(ln_beta&nbsp;x)&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hf2</span>'' : (<span class="id">fexp2</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - 1)%<span class="id">Z</span>); [<span class="tactic">omega</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Hx</span>' <span class="id">Hf2</span>''); <span class="tactic">intro</span> <span class="id">Hx</span>''.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">double_round_gt_mid_further_place</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Section</span> <span class="id">Double_round_mult</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">ln_beta_mult_disj</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;<span class="id">x</span> &lt;&gt; 0 -&gt; <span class="id">y</span> &lt;&gt; 0 -&gt;<br/>
&nbsp;&nbsp;((<span class="id">ln_beta</span> (<span class="id">x</span> * <span class="id">y</span>) = (<span class="id">ln_beta</span> <span class="id">x</span> + <span class="id">ln_beta</span> <span class="id">y</span> - 1)%<span class="id">Z</span> :&gt; <span class="id">Z</span>)<br/>
&nbsp;&nbsp;&nbsp;\/ (<span class="id">ln_beta</span> (<span class="id">x</span> * <span class="id">y</span>) = (<span class="id">ln_beta</span> <span class="id">x</span> + <span class="id">ln_beta</span> <span class="id">y</span>)%<span class="id">Z</span> :&gt; <span class="id">Z</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5436')">Proof.</div>
<div class="proofscript" id="proof5436">
<span class="tactic">intros</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Zx</span> <span class="id">Zy</span>.<br/>
<span class="tactic">destruct</span> (<span class="id">ln_beta_mult</span> <span class="id">beta</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Zx</span> <span class="id">Zy</span>).<br/>
<span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">double_round_mult_hyp</span> <span class="id">fexp1</span> <span class="id">fexp2</span> :=<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">ex</span> <span class="id">ey</span>, (<span class="id">fexp2</span> (<span class="id">ex</span> + <span class="id">ey</span>) &lt;= <span class="id">fexp1</span> <span class="id">ex</span> + <span class="id">fexp1</span> <span class="id">ey</span>)%<span class="id">Z</span>)<br/>
&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">ex</span> <span class="id">ey</span>, (<span class="id">fexp2</span> (<span class="id">ex</span> + <span class="id">ey</span> - 1) &lt;= <span class="id">fexp1</span> <span class="id">ex</span> + <span class="id">fexp1</span> <span class="id">ey</span>)%<span class="id">Z</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_mult_aux</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>),<br/>
&nbsp;&nbsp;<span class="id">double_round_mult_hyp</span> <span class="id">fexp1</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> -&gt; <span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp2</span> (<span class="id">x</span> * <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5437')">Proof.</div>
<div class="proofscript" id="proof5437">
<span class="tactic">intros</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Hfexp</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">destruct</span> (<span class="id">Req_dec</span> <span class="id">x</span> 0) <span class="kwd">as</span> [<span class="id">Zx</span>|<span class="id">Zx</span>].<br/>
- <span class="comment">(*&nbsp;x&nbsp;=&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Zx</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_0_l</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_0</span>.<br/>
- <span class="comment">(*&nbsp;x&nbsp;&lt;&gt;&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Req_dec</span> <span class="id">y</span> 0) <span class="kwd">as</span> [<span class="id">Zy</span>|<span class="id">Zy</span>].<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;y&nbsp;=&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Zy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_0_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_0</span>.<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;y&nbsp;&lt;&gt;&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">generic_format</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">canonic_exp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">mx</span> := <span class="id">Ztrunc</span> (<span class="id">scaled_mantissa</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">my</span> := <span class="id">Ztrunc</span> (<span class="id">scaled_mantissa</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">y</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">F2R</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">fxy</span> := <span class="id">Float</span> <span class="id">beta</span> (<span class="id">mx</span> * <span class="id">my</span>) (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) + <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">y</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hxy</span> : <span class="id">x</span> * <span class="id">y</span> = <span class="id">F2R</span> <span class="id">fxy</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id">fxy</span>, <span class="id">F2R</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">bpow_plus</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Z2R_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Fx</span>, <span class="id">Fy</span> <span class="tactic">at</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">ring</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">generic_format_F2R</span>' <span class="kwd">with</span> (<span class="id">f</span> := <span class="id">fxy</span>); [<span class="id">now</span> <span class="tactic">rewrite</span> <span class="id">Hxy</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">_</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">canonic_exp</span>, <span class="id">fxy</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hfexp</span> <span class="kwd">as</span> (<span class="id">Hfexp1</span>, <span class="id">Hfexp2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">destruct</span> (<span class="id">ln_beta_mult_disj</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Zx</span> <span class="id">Zy</span>) <span class="kwd">as</span> [<span class="id">Lxy</span>|<span class="id">Lxy</span>]; <span class="tactic">rewrite</span> <span class="id">Lxy</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Variable</span> <span class="id">rnd</span> : <span class="id">R</span> -&gt; <span class="id">Z</span>.<br/>
<span class="kwd">Context</span> { <span class="id">valid_rnd</span> : <span class="id">Valid_rnd</span> <span class="id">rnd</span> }.<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id">double_round_mult</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>),<br/>
&nbsp;&nbsp;<span class="id">double_round_mult_hyp</span> <span class="id">fexp1</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> -&gt; <span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">rnd</span> (<span class="id">round</span> <span class="id">beta</span> <span class="id">fexp2</span> <span class="id">rnd</span> (<span class="id">x</span> * <span class="id">y</span>))<br/>
&nbsp;&nbsp;= <span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">rnd</span> (<span class="id">x</span> * <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5438')">Proof.</div>
<div class="proofscript" id="proof5438">
<span class="tactic">intros</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Hfexp</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">assert</span> (<span class="id">Hxy</span> : <span class="id">round</span> <span class="id">beta</span> <span class="id">fexp2</span> <span class="id">rnd</span> (<span class="id">x</span> * <span class="id">y</span>) = <span class="id">x</span> * <span class="id">y</span>).<br/>
{ <span class="tactic">apply</span> <span class="id">round_generic</span>; [<span class="tactic">assumption</span>|].<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> (<span class="id">double_round_mult_aux</span> <span class="id">fexp1</span> <span class="id">fexp2</span>). }<br/>
<span class="id">now</span> <span class="tactic">rewrite</span> <span class="id">Hxy</span> <span class="tactic">at</span> 1.<br/>
Qed.</div>
<br/>
<span class="kwd">Section</span> <span class="id">Double_round_mult_FLX</span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Fcore_FLX</span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id">prec</span> : <span class="id">Z</span>.<br/>
<span class="kwd">Variable</span> <span class="id">prec</span>' : <span class="id">Z</span>.<br/>
<br/>
<span class="kwd">Context</span> { <span class="id">prec_gt_0_</span> : <span class="id">Prec_gt_0</span> <span class="id">prec</span> }.<br/>
<span class="kwd">Context</span> { <span class="id">prec_gt_0_</span>' : <span class="id">Prec_gt_0</span> <span class="id">prec</span>' }.<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id">double_round_mult_FLX</span> :<br/>
&nbsp;&nbsp;(2 * <span class="id">prec</span> &lt;= <span class="id">prec</span>')%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;<span class="id">FLX_format</span> <span class="id">beta</span> <span class="id">prec</span> <span class="id">x</span> -&gt; <span class="id">FLX_format</span> <span class="id">beta</span> <span class="id">prec</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">round</span> <span class="id">beta</span> (<span class="id">FLX_exp</span> <span class="id">prec</span>) <span class="id">rnd</span> (<span class="id">round</span> <span class="id">beta</span> (<span class="id">FLX_exp</span> <span class="id">prec</span>') <span class="id">rnd</span> (<span class="id">x</span> * <span class="id">y</span>))<br/>
&nbsp;&nbsp;= <span class="id">round</span> <span class="id">beta</span> (<span class="id">FLX_exp</span> <span class="id">prec</span>) <span class="id">rnd</span> (<span class="id">x</span> * <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5439')">Proof.</div>
<div class="proofscript" id="proof5439">
<span class="tactic">intros</span> <span class="id">Hprec</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">apply</span> <span class="id">double_round_mult</span>;<br/>
&nbsp;&nbsp;[|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FLX</span>|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FLX</span>].<br/>
<span class="tactic">unfold</span> <span class="id">double_round_mult_hyp</span>; <span class="tactic">split</span>; <span class="tactic">intros</span> <span class="id">ex</span> <span class="id">ey</span>; <span class="tactic">unfold</span> <span class="id">FLX_exp</span>;<br/>
<span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">Double_round_mult_FLX</span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id">Double_round_mult_FLT</span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Fcore_FLX</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Fcore_FLT</span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id">emin</span> <span class="id">prec</span> : <span class="id">Z</span>.<br/>
<span class="kwd">Variable</span> <span class="id">emin</span>' <span class="id">prec</span>' : <span class="id">Z</span>.<br/>
<br/>
<span class="kwd">Context</span> { <span class="id">prec_gt_0_</span> : <span class="id">Prec_gt_0</span> <span class="id">prec</span> }.<br/>
<span class="kwd">Context</span> { <span class="id">prec_gt_0_</span>' : <span class="id">Prec_gt_0</span> <span class="id">prec</span>' }.<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id">double_round_mult_FLT</span> :<br/>
&nbsp;&nbsp;(<span class="id">emin</span>' &lt;= 2 * <span class="id">emin</span>)%<span class="id">Z</span> -&gt; (2 * <span class="id">prec</span> &lt;= <span class="id">prec</span>')%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;<span class="id">FLT_format</span> <span class="id">beta</span> <span class="id">emin</span> <span class="id">prec</span> <span class="id">x</span> -&gt; <span class="id">FLT_format</span> <span class="id">beta</span> <span class="id">emin</span> <span class="id">prec</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">round</span> <span class="id">beta</span> (<span class="id">FLT_exp</span> <span class="id">emin</span> <span class="id">prec</span>) <span class="id">rnd</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">round</span> <span class="id">beta</span> (<span class="id">FLT_exp</span> <span class="id">emin</span>' <span class="id">prec</span>') <span class="id">rnd</span> (<span class="id">x</span> * <span class="id">y</span>))<br/>
&nbsp;&nbsp;= <span class="id">round</span> <span class="id">beta</span> (<span class="id">FLT_exp</span> <span class="id">emin</span> <span class="id">prec</span>) <span class="id">rnd</span> (<span class="id">x</span> * <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5440')">Proof.</div>
<div class="proofscript" id="proof5440">
<span class="tactic">intros</span> <span class="id">Hemin</span> <span class="id">Hprec</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">apply</span> <span class="id">double_round_mult</span>;<br/>
&nbsp;&nbsp;[|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FLT</span>|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FLT</span>].<br/>
<span class="tactic">unfold</span> <span class="id">double_round_mult_hyp</span>; <span class="tactic">split</span>; <span class="tactic">intros</span> <span class="id">ex</span> <span class="id">ey</span>;<br/>
<span class="tactic">unfold</span> <span class="id">FLT_exp</span>;<br/>
<span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ex</span> + <span class="id">ey</span> - <span class="id">prec</span>') <span class="id">emin</span>');<br/>
<span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ex</span> + <span class="id">ey</span> - 1 - <span class="id">prec</span>') <span class="id">emin</span>');<br/>
<span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>) <span class="id">emin</span>);<br/>
<span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ey</span> - <span class="id">prec</span>) <span class="id">emin</span>);<br/>
<span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">Double_round_mult_FLT</span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id">Double_round_mult_FTZ</span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Fcore_FTZ</span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id">emin</span> <span class="id">prec</span> : <span class="id">Z</span>.<br/>
<span class="kwd">Variable</span> <span class="id">emin</span>' <span class="id">prec</span>' : <span class="id">Z</span>.<br/>
<br/>
<span class="kwd">Context</span> { <span class="id">prec_gt_0_</span> : <span class="id">Prec_gt_0</span> <span class="id">prec</span> }.<br/>
<span class="kwd">Context</span> { <span class="id">prec_gt_0_</span>' : <span class="id">Prec_gt_0</span> <span class="id">prec</span>' }.<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id">double_round_mult_FTZ</span> :<br/>
&nbsp;&nbsp;(<span class="id">emin</span>' + <span class="id">prec</span>' &lt;= 2 * <span class="id">emin</span> + <span class="id">prec</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;(2 * <span class="id">prec</span> &lt;= <span class="id">prec</span>')%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;<span class="id">FTZ_format</span> <span class="id">beta</span> <span class="id">emin</span> <span class="id">prec</span> <span class="id">x</span> -&gt; <span class="id">FTZ_format</span> <span class="id">beta</span> <span class="id">emin</span> <span class="id">prec</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">round</span> <span class="id">beta</span> (<span class="id">FTZ_exp</span> <span class="id">emin</span> <span class="id">prec</span>) <span class="id">rnd</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">round</span> <span class="id">beta</span> (<span class="id">FTZ_exp</span> <span class="id">emin</span>' <span class="id">prec</span>') <span class="id">rnd</span> (<span class="id">x</span> * <span class="id">y</span>))<br/>
&nbsp;&nbsp;= <span class="id">round</span> <span class="id">beta</span> (<span class="id">FTZ_exp</span> <span class="id">emin</span> <span class="id">prec</span>) <span class="id">rnd</span> (<span class="id">x</span> * <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5441')">Proof.</div>
<div class="proofscript" id="proof5441">
<span class="tactic">intros</span> <span class="id">Hemin</span> <span class="id">Hprec</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">apply</span> <span class="id">double_round_mult</span>;<br/>
&nbsp;&nbsp;[|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FTZ</span>|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FTZ</span>].<br/>
<span class="tactic">unfold</span> <span class="id">double_round_mult_hyp</span>; <span class="tactic">split</span>; <span class="tactic">intros</span> <span class="id">ex</span> <span class="id">ey</span>;<br/>
<span class="tactic">unfold</span> <span class="id">FTZ_exp</span>;<br/>
<span class="tactic">unfold</span> <span class="id">Prec_gt_0</span> <span class="kwd">in</span> *;<br/>
<span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ex</span> + <span class="id">ey</span> - <span class="id">prec</span>') <span class="id">emin</span>');<br/>
<span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>) <span class="id">emin</span>);<br/>
<span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ey</span> - <span class="id">prec</span>) <span class="id">emin</span>);<br/>
<span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ex</span> + <span class="id">ey</span> - 1 - <span class="id">prec</span>') <span class="id">emin</span>');<br/>
<span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">Double_round_mult_FTZ</span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id">Double_round_mult</span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id">Double_round_plus</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">ln_beta_plus_disj</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;0 &lt; <span class="id">y</span> -&gt; <span class="id">y</span> &lt;= <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;((<span class="id">ln_beta</span> (<span class="id">x</span> + <span class="id">y</span>) = <span class="id">ln_beta</span> <span class="id">x</span> :&gt; <span class="id">Z</span>)<br/>
&nbsp;&nbsp;&nbsp;\/ (<span class="id">ln_beta</span> (<span class="id">x</span> + <span class="id">y</span>) = (<span class="id">ln_beta</span> <span class="id">x</span> + 1)%<span class="id">Z</span> :&gt; <span class="id">Z</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5442')">Proof.</div>
<div class="proofscript" id="proof5442">
<span class="tactic">intros</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Py</span> <span class="id">Hxy</span>.<br/>
<span class="tactic">destruct</span> (<span class="id">ln_beta_plus</span> <span class="id">beta</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Py</span> <span class="id">Hxy</span>).<br/>
<span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">ln_beta_plus_separated</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fexp</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>,<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;0 &lt; <span class="id">x</span> -&gt; 0 &lt;= <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">ln_beta</span> <span class="id">y</span> &lt;= <span class="id">fexp</span> (<span class="id">ln_beta</span> <span class="id">x</span>))%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">ln_beta</span> (<span class="id">x</span> + <span class="id">y</span>) = <span class="id">ln_beta</span> <span class="id">x</span> :&gt; <span class="id">Z</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5443')">Proof.</div>
<div class="proofscript" id="proof5443">
<span class="tactic">intros</span> <span class="id">fexp</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Px</span> <span class="id">Nny</span> <span class="id">Fx</span> <span class="id">Hsep</span>.<br/>
<span class="tactic">destruct</span> (<span class="id">Req_dec</span> <span class="id">y</span> 0) <span class="kwd">as</span> [<span class="id">Zy</span>|<span class="id">Nzy</span>].<br/>
- <span class="comment">(*&nbsp;y&nbsp;=&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">rewrite</span> <span class="id">Zy</span>; <span class="tactic">rewrite</span> <span class="id">Rplus_0_r</span>.<br/>
- <span class="comment">(*&nbsp;y&nbsp;&lt;&gt;&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">ln_beta_plus_eps</span> <span class="id">beta</span> <span class="id">fexp</span>); [<span class="tactic">assumption</span>|<span class="tactic">assumption</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; [<span class="tactic">assumption</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">ulp_neq_0</span>;[<span class="id">idtac</span>|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>].<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">canonic_exp</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">ln_beta</span> <span class="id">y</span>) <span class="kwd">as</span> (<span class="id">ey</span>, <span class="id">Hey</span>); <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rlt_le_trans</span> <span class="kwd">with</span> (<span class="id">bpow</span> <span class="id">ey</span>).<br/>
&nbsp;&nbsp;+ <span class="id">now</span> <span class="tactic">rewrite</span> &lt;- (<span class="id">Rabs_right</span> <span class="id">y</span>); [<span class="tactic">apply</span> <span class="id">Hey</span>|<span class="tactic">apply</span> <span class="id">Rle_ge</span>].<br/>
&nbsp;&nbsp;+ <span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_le</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">ln_beta_minus_disj</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;0 &lt; <span class="id">x</span> -&gt; 0 &lt; <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">ln_beta</span> <span class="id">y</span> &lt;= <span class="id">ln_beta</span> <span class="id">x</span> - 2)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;((<span class="id">ln_beta</span> (<span class="id">x</span> - <span class="id">y</span>) = <span class="id">ln_beta</span> <span class="id">x</span> :&gt; <span class="id">Z</span>)<br/>
&nbsp;&nbsp;&nbsp;\/ (<span class="id">ln_beta</span> (<span class="id">x</span> - <span class="id">y</span>) = (<span class="id">ln_beta</span> <span class="id">x</span> - 1)%<span class="id">Z</span> :&gt; <span class="id">Z</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5444')">Proof.</div>
<div class="proofscript" id="proof5444">
<span class="tactic">intros</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Px</span> <span class="id">Py</span> <span class="id">Hln</span>.<br/>
<span class="tactic">assert</span> (<span class="id">Hxy</span> : <span class="id">y</span> &lt; <span class="id">x</span>); [<span class="id">now</span> <span class="tactic">apply</span> (<span class="id">ln_beta_lt_pos</span> <span class="id">beta</span>); [| |<span class="tactic">omega</span>]|].<br/>
<span class="tactic">generalize</span> (<span class="id">ln_beta_minus</span> <span class="id">beta</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Py</span> <span class="id">Hxy</span>); <span class="tactic">intro</span> <span class="id">Hln2</span>.<br/>
<span class="tactic">generalize</span> (<span class="id">ln_beta_minus_lb</span> <span class="id">beta</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Px</span> <span class="id">Py</span> <span class="id">Hln</span>); <span class="tactic">intro</span> <span class="id">Hln3</span>.<br/>
<span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">ln_beta_minus_separated</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fexp</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>, <span class="id">Valid_exp</span> <span class="id">fexp</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;0 &lt; <span class="id">x</span> -&gt; 0 &lt; <span class="id">y</span> -&gt; <span class="id">y</span> &lt; <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">bpow</span> (<span class="id">ln_beta</span> <span class="id">x</span> - 1) &lt; <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp</span> <span class="id">x</span> -&gt; (<span class="id">ln_beta</span> <span class="id">y</span> &lt;= <span class="id">fexp</span> (<span class="id">ln_beta</span> <span class="id">x</span>))%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">ln_beta</span> (<span class="id">x</span> - <span class="id">y</span>) = <span class="id">ln_beta</span> <span class="id">x</span> :&gt; <span class="id">Z</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5445')">Proof.</div>
<div class="proofscript" id="proof5445">
<span class="tactic">intros</span> <span class="id">fexp</span> <span class="id">Vfexp</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Px</span> <span class="id">Py</span> <span class="id">Yltx</span> <span class="id">Xgtpow</span> <span class="id">Fx</span> <span class="id">Ly</span>.<br/>
<span class="tactic">apply</span> <span class="id">ln_beta_unique</span>.<br/>
<span class="tactic">split</span>.<br/>
- <span class="tactic">apply</span> <span class="id">Rabs_ge</span>; <span class="id">right</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hy</span> : <span class="id">y</span> &lt; <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp</span> (<span class="id">bpow</span> (<span class="id">ln_beta</span> <span class="id">x</span> - 1))).<br/>
&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">ulp_bpow</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">_</span> + <span class="id">_</span>)%<span class="id">Z</span> <span class="kwd">with</span> (<span class="id">ln_beta</span> <span class="id">x</span> : <span class="id">Z</span>) <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rabs_right</span> <span class="id">y</span>); [|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rle_ge</span>; <span class="tactic">apply</span> <span class="id">Rlt_le</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rlt_le_trans</span> <span class="kwd">with</span> (<span class="id">bpow</span> (<span class="id">ln_beta</span> <span class="id">y</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">bpow_ln_beta_gt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_le</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rplus_le_reg_r</span> <span class="id">y</span>); <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rle_trans</span> <span class="kwd">with</span> (<span class="id">bpow</span> (<span class="id">ln_beta</span> <span class="id">x</span> - 1)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp</span> (<span class="id">bpow</span> (<span class="id">ln_beta</span> <span class="id">x</span> - 1))).<br/>
&nbsp;&nbsp;+ <span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rplus_le_compat_l</span>; <span class="tactic">apply</span> <span class="id">Rlt_le</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> &lt;- <span class="id">succ_eq_pos</span>;[<span class="id">idtac</span>|<span class="tactic">apply</span> <span class="id">bpow_ge_0</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">succ_le_lt</span>; [<span class="tactic">apply</span> <span class="id">Vfexp</span>|<span class="id">idtac</span>|<span class="tactic">exact</span> <span class="id">Fx</span>|<span class="tactic">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">generic_format_bpow</span> <span class="id">beta</span> <span class="id">fexp</span> (<span class="id">ln_beta</span> <span class="id">x</span> - 1)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">_</span> + <span class="id">_</span>)%<span class="id">Z</span> <span class="kwd">with</span> (<span class="id">ln_beta</span> <span class="id">x</span> : <span class="id">Z</span>) <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">fexp</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt; <span class="id">ln_beta</span> <span class="id">x</span>)%<span class="id">Z</span>; [|<span class="tactic">omega</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_generic_gt</span>; [|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>|].<br/>
- <span class="tactic">rewrite</span> <span class="id">Rabs_right</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">Rlt_trans</span> <span class="kwd">with</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> &lt;- (<span class="id">Rplus_0_r</span> <span class="id">x</span>) <span class="tactic">at</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rplus_lt_compat_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Ropp_0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Ropp_lt_contravar</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">Rabs_lt_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bpow_ln_beta_gt</span>.<br/>
&nbsp;&nbsp;+ <span class="id">lra</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">double_round_plus_hyp</span> <span class="id">fexp1</span> <span class="id">fexp2</span> :=<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">ex</span> <span class="id">ey</span>, (<span class="id">fexp1</span> (<span class="id">ex</span> + 1) - 1 &lt;= <span class="id">ey</span>)%<span class="id">Z</span> -&gt; (<span class="id">fexp2</span> <span class="id">ex</span> &lt;= <span class="id">fexp1</span> <span class="id">ey</span>)%<span class="id">Z</span>)<br/>
&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">ex</span> <span class="id">ey</span>, (<span class="id">fexp1</span> (<span class="id">ex</span> - 1) + 1 &lt;= <span class="id">ey</span>)%<span class="id">Z</span> -&gt; (<span class="id">fexp2</span> <span class="id">ex</span> &lt;= <span class="id">fexp1</span> <span class="id">ey</span>)%<span class="id">Z</span>)<br/>
&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">ex</span> <span class="id">ey</span>, (<span class="id">fexp1</span> <span class="id">ex</span> - 1 &lt;= <span class="id">ey</span>)%<span class="id">Z</span> -&gt; (<span class="id">fexp2</span> <span class="id">ex</span> &lt;= <span class="id">fexp1</span> <span class="id">ey</span>)%<span class="id">Z</span>)<br/>
&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">ex</span> <span class="id">ey</span>, (<span class="id">ex</span> - 1 &lt;= <span class="id">ey</span>)%<span class="id">Z</span> -&gt; (<span class="id">fexp2</span> <span class="id">ex</span> &lt;= <span class="id">fexp1</span> <span class="id">ey</span>)%<span class="id">Z</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_plus_aux0_aux_aux</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>),<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;(<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">y</span>))%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">fexp2</span> (<span class="id">ln_beta</span> (<span class="id">x</span> + <span class="id">y</span>))%<span class="id">Z</span> &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">fexp2</span> (<span class="id">ln_beta</span> (<span class="id">x</span> + <span class="id">y</span>))%<span class="id">Z</span> &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">y</span>))%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> -&gt; <span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp2</span> (<span class="id">x</span> + <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5446')">Proof.</div>
<div class="proofscript" id="proof5446">
<span class="tactic">intros</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Oxy</span> <span class="id">Hlnx</span> <span class="id">Hlny</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">destruct</span> (<span class="id">Req_dec</span> <span class="id">x</span> 0) <span class="kwd">as</span> [<span class="id">Zx</span>|<span class="id">Nzx</span>].<br/>
- <span class="comment">(*&nbsp;x&nbsp;=&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Zx</span>, <span class="id">Rplus_0_l</span> <span class="kwd">in</span> <span class="id">Hlny</span> |- *.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> (<span class="id">generic_inclusion_ln_beta</span> <span class="id">beta</span> <span class="id">fexp1</span>).<br/>
- <span class="comment">(*&nbsp;x&nbsp;&lt;&gt;&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Req_dec</span> <span class="id">y</span> 0) <span class="kwd">as</span> [<span class="id">Zy</span>|<span class="id">Nzy</span>].<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;y&nbsp;=&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Zy</span>, <span class="id">Rplus_0_r</span> <span class="kwd">in</span> <span class="id">Hlnx</span> |- *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> (<span class="id">generic_inclusion_ln_beta</span> <span class="id">beta</span> <span class="id">fexp1</span>).<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;y&nbsp;&lt;&gt;&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">generic_format</span> <span class="tactic">at</span> -3, <span class="id">canonic_exp</span>, <span class="id">F2R</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">mx</span> := <span class="id">Ztrunc</span> (<span class="id">scaled_mantissa</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">my</span> := <span class="id">Ztrunc</span> (<span class="id">scaled_mantissa</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">y</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">fxy</span> := <span class="id">Float</span> <span class="id">beta</span> (<span class="id">mx</span> + <span class="id">my</span> * (<span class="id">beta</span> ^ (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">y</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hxy</span> : <span class="id">x</span> + <span class="id">y</span> = <span class="id">F2R</span> <span class="id">fxy</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id">fxy</span>, <span class="id">F2R</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Z2R_plus</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_plus_distr_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Fx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Z2R_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Z2R_Zpower</span>; [|<span class="tactic">omega</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">rewrite</span> &lt;- <span class="id">Fy</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">generic_format_F2R</span>' <span class="kwd">with</span> (<span class="id">f</span> := <span class="id">fxy</span>); [<span class="id">now</span> <span class="tactic">rewrite</span> <span class="id">Hxy</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">_</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">unfold</span> <span class="id">canonic_exp</span>, <span class="id">fxy</span>; <span class="tactic">simpl</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_plus_aux0_aux</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>),<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;(<span class="id">fexp2</span> (<span class="id">ln_beta</span> (<span class="id">x</span> + <span class="id">y</span>))%<span class="id">Z</span> &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">fexp2</span> (<span class="id">ln_beta</span> (<span class="id">x</span> + <span class="id">y</span>))%<span class="id">Z</span> &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">y</span>))%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> -&gt; <span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp2</span> (<span class="id">x</span> + <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5447')">Proof.</div>
<div class="proofscript" id="proof5447">
<span class="tactic">intros</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Hlnx</span> <span class="id">Hlny</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">destruct</span> (<span class="id">Z.le_gt_cases</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>)) (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">y</span>))) <span class="kwd">as</span> [<span class="id">Hle</span>|<span class="id">Hgt</span>].<br/>
- <span class="id">now</span> <span class="tactic">apply</span> (<span class="id">double_round_plus_aux0_aux_aux</span> <span class="id">fexp1</span>).<br/>
- <span class="tactic">rewrite</span> <span class="id">Rplus_comm</span> <span class="kwd">in</span> <span class="id">Hlnx</span>, <span class="id">Hlny</span> |- *.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> (<span class="id">double_round_plus_aux0_aux_aux</span> <span class="id">fexp1</span>); [<span class="tactic">omega</span>| | | |].<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_plus_aux0</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>), <span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_plus_hyp</span> <span class="id">fexp1</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;(0 &lt; <span class="id">x</span>)%<span class="id">R</span> -&gt; (0 &lt; <span class="id">y</span>)%<span class="id">R</span> -&gt; (<span class="id">y</span> &lt;= <span class="id">x</span>)%<span class="id">R</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - 1 &lt;= <span class="id">ln_beta</span> <span class="id">y</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> -&gt; <span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp2</span> (<span class="id">x</span> + <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5448')">Proof.</div>
<div class="proofscript" id="proof5448">
<span class="tactic">intros</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Hexp</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Px</span> <span class="id">Py</span> <span class="id">Hyx</span> <span class="id">Hln</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">assert</span> (<span class="id">Nny</span> : (0 &lt;= <span class="id">y</span>)%<span class="id">R</span>); [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rlt_le</span>|].<br/>
<span class="tactic">destruct</span> <span class="id">Hexp</span> <span class="kwd">as</span> (<span class="id">_</span>,(<span class="id">Hexp2</span>,(<span class="id">Hexp3</span>,<span class="id">Hexp4</span>))).<br/>
<span class="tactic">destruct</span> (<span class="id">Z.le_gt_cases</span> (<span class="id">ln_beta</span> <span class="id">y</span>) (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))) <span class="kwd">as</span> [<span class="id">Hle</span>|<span class="id">Hgt</span>].<br/>
- <span class="comment">(*&nbsp;ln_beta&nbsp;y&nbsp;&lt;=&nbsp;fexp1&nbsp;(ln_beta&nbsp;x)&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Lxy</span> : <span class="id">ln_beta</span> (<span class="id">x</span> + <span class="id">y</span>) = <span class="id">ln_beta</span> <span class="id">x</span> :&gt; <span class="id">Z</span>);<br/>
&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> (<span class="id">ln_beta_plus_separated</span> <span class="id">fexp1</span>)|].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">double_round_plus_aux0_aux</span> <span class="id">fexp1</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[| |<span class="tactic">assumption</span>|<span class="tactic">assumption</span>]; <span class="tactic">rewrite</span> <span class="id">Lxy</span>.<br/>
&nbsp;&nbsp;+ <span class="id">now</span> <span class="tactic">apply</span> <span class="id">Hexp4</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;+ <span class="id">now</span> <span class="tactic">apply</span> <span class="id">Hexp3</span>; <span class="tactic">omega</span>.<br/>
- <span class="comment">(*&nbsp;fexp1&nbsp;(ln_beta&nbsp;x)&nbsp;&lt;&nbsp;ln_beta&nbsp;y&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">double_round_plus_aux0_aux</span> <span class="id">fexp1</span>); [| |<span class="tactic">assumption</span>|<span class="tactic">assumption</span>].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">ln_beta_plus_disj</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Py</span> <span class="id">Hyx</span>) <span class="kwd">as</span> [<span class="id">Lxy</span>|<span class="id">Lxy</span>]; <span class="tactic">rewrite</span> <span class="id">Lxy</span>.<br/>
&nbsp;&nbsp;+ <span class="id">now</span> <span class="tactic">apply</span> <span class="id">Hexp4</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">Hexp2</span>; <span class="tactic">apply</span> (<span class="id">ln_beta_le</span> <span class="id">beta</span> <span class="id">y</span> <span class="id">x</span> <span class="id">Py</span>) <span class="kwd">in</span> <span class="id">Hyx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">_</span> - <span class="id">_</span>)%<span class="id">Z</span> <span class="kwd">with</span> (<span class="id">ln_beta</span> <span class="id">x</span> : <span class="id">Z</span>) <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id">ln_beta_plus_disj</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Py</span> <span class="id">Hyx</span>) <span class="kwd">as</span> [<span class="id">Lxy</span>|<span class="id">Lxy</span>]; <span class="tactic">rewrite</span> <span class="id">Lxy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">now</span> <span class="tactic">apply</span> <span class="id">Hexp3</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">Hexp2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">_</span> - <span class="id">_</span>)%<span class="id">Z</span> <span class="kwd">with</span> (<span class="id">ln_beta</span> <span class="id">x</span> : <span class="id">Z</span>) <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_plus_aux1_aux</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">k</span>, (0 &lt; <span class="id">k</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fexp</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>),<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;0 &lt; <span class="id">x</span> -&gt; 0 &lt; <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">ln_beta</span> <span class="id">y</span> &lt;= <span class="id">fexp</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - <span class="id">k</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">ln_beta</span> (<span class="id">x</span> + <span class="id">y</span>) = <span class="id">ln_beta</span> <span class="id">x</span> :&gt; <span class="id">Z</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;0 &lt; (<span class="id">x</span> + <span class="id">y</span>) - <span class="id">round</span> <span class="id">beta</span> <span class="id">fexp</span> <span class="id">Zfloor</span> (<span class="id">x</span> + <span class="id">y</span>) &lt; <span class="id">bpow</span> (<span class="id">fexp</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - <span class="id">k</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5449')">Proof.</div>
<div class="proofscript" id="proof5449">
<span class="tactic">assert</span> (<span class="id">Hbeta</span> : (2 &lt;= <span class="id">beta</span>)%<span class="id">Z</span>).<br/>
{ <span class="tactic">destruct</span> <span class="id">beta</span> <span class="kwd">as</span> (<span class="id">beta_val</span>,<span class="id">beta_prop</span>).<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Zle_bool_imp_le</span>. }<br/>
<span class="tactic">intros</span> <span class="id">k</span> <span class="id">Hk</span> <span class="id">fexp</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Px</span> <span class="id">Py</span> <span class="id">Hln</span> <span class="id">Hlxy</span> <span class="id">Fx</span>.<br/>
<span class="id">revert</span> <span class="id">Fx</span>.<br/>
<span class="tactic">unfold</span> <span class="id">round</span>, <span class="id">generic_format</span>, <span class="id">F2R</span>, <span class="id">scaled_mantissa</span>, <span class="id">canonic_exp</span>; <span class="tactic">simpl</span>.<br/>
<span class="tactic">rewrite</span> <span class="id">Hlxy</span>.<br/>
<span class="tactic">set</span> (<span class="id">mx</span> := <span class="id">Ztrunc</span> (<span class="id">x</span> * <span class="id">bpow</span> (- <span class="id">fexp</span> (<span class="id">ln_beta</span> <span class="id">x</span>)))).<br/>
<span class="tactic">intros</span> <span class="id">Fx</span>.<br/>
<span class="tactic">assert</span> (<span class="id">R</span> : (<span class="id">x</span> + <span class="id">y</span>) * <span class="id">bpow</span> (- <span class="id">fexp</span> (<span class="id">ln_beta</span> <span class="id">x</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id">Z2R</span> <span class="id">mx</span> + <span class="id">y</span> * <span class="id">bpow</span> (- <span class="id">fexp</span> (<span class="id">ln_beta</span> <span class="id">x</span>))).<br/>
{ <span class="tactic">rewrite</span> <span class="id">Fx</span> <span class="tactic">at</span> 1.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_plus_distr_r</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="id">bpow_simplify</span>. }<br/>
<span class="tactic">rewrite</span> <span class="id">R</span>.<br/>
<span class="tactic">assert</span> (<span class="id">LB</span> : 0 &lt; <span class="id">y</span> * <span class="id">bpow</span> (- <span class="id">fexp</span> (<span class="id">ln_beta</span> <span class="id">x</span>))).<br/>
{ <span class="tactic">rewrite</span> &lt;- (<span class="id">Rmult_0_r</span> <span class="id">y</span>).<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rmult_lt_compat_l</span>; [|<span class="tactic">apply</span> <span class="id">bpow_gt_0</span>]. }<br/>
<span class="tactic">assert</span> (<span class="id">UB</span> : <span class="id">y</span> * <span class="id">bpow</span> (- <span class="id">fexp</span> (<span class="id">ln_beta</span> <span class="id">x</span>)) &lt; / <span class="id">Z2R</span> (<span class="id">beta</span> ^ <span class="id">k</span>)).<br/>
{ <span class="tactic">apply</span> <span class="id">Rlt_le_trans</span> <span class="kwd">with</span> (<span class="id">bpow</span> (<span class="id">ln_beta</span> <span class="id">y</span>) * <span class="id">bpow</span> (- <span class="id">fexp</span> (<span class="id">ln_beta</span> <span class="id">x</span>))).<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">Rmult_lt_compat_r</span>; [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rabs_right</span> <span class="id">y</span>) <span class="tactic">at</span> 1; [|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rle_ge</span>; <span class="tactic">apply</span> <span class="id">Rlt_le</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bpow_ln_beta_gt</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">Rle_trans</span> <span class="kwd">with</span> (<span class="id">bpow</span> (<span class="id">fexp</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - <span class="id">k</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">bpow</span> (- <span class="id">fexp</span> (<span class="id">ln_beta</span> <span class="id">x</span>)))%<span class="id">R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">Rmult_le_compat_r</span>; [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_ge_0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_le</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">bpow_opp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">k</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">simpl</span>; <span class="tactic">unfold</span> <span class="id">Fcore_Raux.bpow</span>, <span class="id">Z.pow_pos</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rle_refl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">casetype</span> <span class="id">False</span>; <span class="tactic">apply</span> (<span class="id">Zlt_irrefl</span> 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Zlt_trans</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hk</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Zlt_neg_0</span>. }<br/>
<span class="tactic">rewrite</span> (<span class="id">Zfloor_imp</span> <span class="id">mx</span>).<br/>
{ <span class="tactic">split</span>; <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_r</span> (<span class="id">bpow</span> (- <span class="id">fexp</span> (<span class="id">ln_beta</span> <span class="id">x</span>)))); [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_minus_distr_r</span>, <span class="id">Rmult_0_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">R</span>; <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rmult_lt_0_compat</span>; [|<span class="tactic">apply</span> <span class="id">bpow_gt_0</span>].<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_r</span> (<span class="id">bpow</span> (- <span class="id">fexp</span> (<span class="id">ln_beta</span> <span class="id">x</span>)))); [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_minus_distr_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">R</span>; <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rlt_le_trans</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">UB</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">bpow_opp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rinv_le</span>; [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">rewrite</span> <span class="id">Z2R_Zpower</span>; [<span class="id">right</span>|<span class="tactic">omega</span>]. }<br/>
<span class="tactic">split</span>.<br/>
- <span class="tactic">rewrite</span> &lt;- <span class="id">Rplus_0_r</span> <span class="tactic">at</span> 1; <span class="tactic">apply</span> <span class="id">Rplus_le_compat_l</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rlt_le</span>.<br/>
- <span class="tactic">rewrite</span> <span class="id">Z2R_plus</span>; <span class="tactic">apply</span> <span class="id">Rplus_lt_compat_l</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_r</span> (<span class="id">bpow</span> (<span class="id">fexp</span> (<span class="id">ln_beta</span> <span class="id">x</span>)))); [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_1_l</span>.<br/>
&nbsp;&nbsp;<span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rlt_trans</span> <span class="kwd">with</span> (<span class="id">bpow</span> (<span class="id">ln_beta</span> <span class="id">y</span>)).<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> &lt;- <span class="id">Rabs_right</span> <span class="tactic">at</span> 1; [|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rle_ge</span>; <span class="tactic">apply</span> <span class="id">Rlt_le</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bpow_ln_beta_gt</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">bpow_lt</span>; <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_plus_aux1</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>),<br/>
&nbsp;&nbsp;<span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt; <span class="id">Valid_exp</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">choice1</span> <span class="id">choice2</span> : <span class="id">Z</span> -&gt; <span class="id">bool</span>),<br/>
&nbsp;&nbsp;<span class="id">double_round_plus_hyp</span> <span class="id">fexp1</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;0 &lt; <span class="id">x</span> -&gt; 0 &lt; <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">ln_beta</span> <span class="id">y</span> &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - 2)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> (<span class="id">x</span> + <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5450')">Proof.</div>
<div class="proofscript" id="proof5450">
<span class="tactic">assert</span> (<span class="id">Hbeta</span> : (2 &lt;= <span class="id">beta</span>)%<span class="id">Z</span>).<br/>
{ <span class="tactic">destruct</span> <span class="id">beta</span> <span class="kwd">as</span> (<span class="id">beta_val</span>,<span class="id">beta_prop</span>).<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Zle_bool_imp_le</span>. }<br/>
<span class="tactic">intros</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Vfexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hexp</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Px</span> <span class="id">Py</span> <span class="id">Hly</span> <span class="id">Fx</span>.<br/>
<span class="tactic">assert</span> (<span class="id">Lxy</span> : <span class="id">ln_beta</span> (<span class="id">x</span> + <span class="id">y</span>) = <span class="id">ln_beta</span> <span class="id">x</span> :&gt; <span class="id">Z</span>);<br/>
&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> (<span class="id">ln_beta_plus_separated</span> <span class="id">fexp1</span>); [|<span class="tactic">apply</span> <span class="id">Rlt_le</span>| |<span class="tactic">omega</span>]|].<br/>
<span class="tactic">destruct</span> <span class="id">Hexp</span> <span class="kwd">as</span> (<span class="id">_</span>,(<span class="id">_</span>,(<span class="id">_</span>,<span class="id">Hexp4</span>))).<br/>
<span class="tactic">assert</span> (<span class="id">Hf2</span> : (<span class="id">fexp2</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))%<span class="id">Z</span>);<br/>
&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Hexp4</span>; <span class="tactic">omega</span>|].<br/>
<span class="tactic">assert</span> (<span class="id">Bpow2</span> : <span class="id">bpow</span> (- 2) &lt;= / 2 * / 2).<br/>
{ <span class="tactic">unfold</span> <span class="id">Fcore_Raux.bpow</span>, <span class="id">Z.pow_pos</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Rinv_mult_distr</span>; [|<span class="id">lra</span>|<span class="id">lra</span>].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rinv_le</span>; [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;<span class="id">change</span> 4 <span class="kwd">with</span> (<span class="id">Z2R</span> (2 * 2)); <span class="tactic">apply</span> <span class="id">Z2R_le</span>; <span class="tactic">rewrite</span> <span class="id">Zmult_1_r</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Zmult_le_compat</span>; <span class="tactic">omega</span>. }<br/>
<span class="tactic">assert</span> (<span class="id">P2</span> : (0 &lt; 2)%<span class="id">Z</span>) <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
<span class="tactic">unfold</span> <span class="id">double_round_eq</span>.<br/>
<span class="tactic">apply</span> <span class="id">double_round_lt_mid</span>.<br/>
- <span class="tactic">exact</span> <span class="id">Vfexp1</span>.<br/>
- <span class="tactic">exact</span> <span class="id">Vfexp2</span>.<br/>
- <span class="id">lra</span>.<br/>
- <span class="id">now</span> <span class="tactic">rewrite</span> <span class="id">Lxy</span>.<br/>
- <span class="tactic">rewrite</span> <span class="id">Lxy</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt; <span class="id">ln_beta</span> <span class="id">x</span>)%<span class="id">Z</span>; [|<span class="tactic">omega</span>].<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_generic_gt</span>; [|<span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>|].<br/>
- <span class="tactic">unfold</span> <span class="id">midp</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rplus_lt_reg_r</span> (- <span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zfloor</span> (<span class="id">x</span> + <span class="id">y</span>))).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rlt_le_trans</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">proj2</span> (<span class="id">double_round_plus_aux1_aux</span> 2 <span class="id">P2</span> <span class="id">fexp1</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Px</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Py</span> <span class="id">Hly</span> <span class="id">Lxy</span> <span class="id">Fx</span>))).<br/>
&nbsp;&nbsp;<span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">ulp_neq_0</span>;[<span class="id">idtac</span>|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>, <span class="id">Rplus_lt_0_compat</span>].<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">canonic_exp</span>; <span class="tactic">rewrite</span> <span class="id">Lxy</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_le_reg_r</span> (<span class="id">bpow</span> (- <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>)))); [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;<span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rle_trans</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Bpow2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rmult_1_r</span> (/ 2)) <span class="tactic">at</span> 3.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rmult_le_compat_l</span>; <span class="id">lra</span>.<br/>
- <span class="tactic">rewrite</span> <span class="id">ulp_neq_0</span>;[<span class="id">idtac</span>|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>, <span class="id">Rplus_lt_0_compat</span>].<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">round</span>, <span class="id">F2R</span>, <span class="id">scaled_mantissa</span>, <span class="id">canonic_exp</span>; <span class="tactic">simpl</span>; <span class="tactic">rewrite</span> <span class="id">Lxy</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hf2</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_r</span> (<span class="id">bpow</span> (- <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_r</span> (<span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>)))); [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;<span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rplus_lt_reg_r</span> (- <span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zfloor</span> (<span class="id">x</span> + <span class="id">y</span>))).<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">midp</span>; <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rlt_le_trans</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">proj2</span> (<span class="id">double_round_plus_aux1_aux</span> 2 <span class="id">P2</span> <span class="id">fexp1</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Px</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Py</span> <span class="id">Hly</span> <span class="id">Lxy</span> <span class="id">Fx</span>))).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_le_reg_r</span> (<span class="id">bpow</span> (- <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>)))); [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">ulp_neq_0</span>;[<span class="id">idtac</span>|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>, <span class="id">Rplus_lt_0_compat</span>].<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">canonic_exp</span>; <span class="tactic">rewrite</span> <span class="id">Lxy</span>, <span class="id">Rmult_minus_distr_r</span>; <span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rle_trans</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Bpow2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rmult_1_r</span> (/ 2)) <span class="tactic">at</span> 3; <span class="tactic">rewrite</span> &lt;- <span class="id">Rmult_minus_distr_l</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rmult_le_compat_l</span>; [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rplus_le_reg_r</span> (- 1)); <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">_</span> - <span class="id">_</span>) <span class="kwd">with</span> (- (/ 2)) <span class="tactic">by</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Ropp_le_contravar</span>.<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">Rle_trans</span> <span class="kwd">with</span> (<span class="id">bpow</span> (- 1)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">bpow_le</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">Fcore_Raux.bpow</span>, <span class="id">Z.pow_pos</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rinv_le</span>; [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> 2 <span class="kwd">with</span> (<span class="id">Z2R</span> 2); <span class="tactic">apply</span> <span class="id">Z2R_le</span>; <span class="tactic">omega</span>. }<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_plus_aux2</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>),<br/>
&nbsp;&nbsp;<span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt; <span class="id">Valid_exp</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">choice1</span> <span class="id">choice2</span> : <span class="id">Z</span> -&gt; <span class="id">bool</span>),<br/>
&nbsp;&nbsp;<span class="id">double_round_plus_hyp</span> <span class="id">fexp1</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;0 &lt; <span class="id">x</span> -&gt; 0 &lt; <span class="id">y</span> -&gt; <span class="id">y</span> &lt;= <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> (<span class="id">x</span> + <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5451')">Proof.</div>
<div class="proofscript" id="proof5451">
<span class="tactic">intros</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Vfexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hexp</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Px</span> <span class="id">Py</span> <span class="id">Hyx</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">unfold</span> <span class="id">double_round_eq</span>.<br/>
<span class="tactic">destruct</span> (<span class="id">Zle_or_lt</span> (<span class="id">ln_beta</span> <span class="id">y</span>) (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - 2)) <span class="kwd">as</span> [<span class="id">Hly</span>|<span class="id">Hly</span>].<br/>
- <span class="comment">(*&nbsp;ln_beta&nbsp;y&nbsp;&lt;=&nbsp;fexp1&nbsp;(ln_beta&nbsp;x)&nbsp;-&nbsp;2&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">double_round_plus_aux1</span>.<br/>
- <span class="comment">(*&nbsp;fexp1&nbsp;(ln_beta&nbsp;x)&nbsp;-&nbsp;2&nbsp;&lt;&nbsp;ln_beta&nbsp;y&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">round_generic</span> <span class="id">beta</span> <span class="id">fexp2</span>).<br/>
&nbsp;&nbsp;+ <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;+ <span class="id">now</span> <span class="tactic">apply</span> <span class="id">valid_rnd_N</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">assert</span> (<span class="id">Hf1</span> : (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - 1 &lt;= <span class="id">ln_beta</span> <span class="id">y</span>)%<span class="id">Z</span>); [<span class="tactic">omega</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> (<span class="id">double_round_plus_aux0</span> <span class="id">fexp1</span>).<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_plus_aux</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>),<br/>
&nbsp;&nbsp;<span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt; <span class="id">Valid_exp</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">choice1</span> <span class="id">choice2</span> : <span class="id">Z</span> -&gt; <span class="id">bool</span>),<br/>
&nbsp;&nbsp;<span class="id">double_round_plus_hyp</span> <span class="id">fexp1</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;0 &lt;= <span class="id">x</span> -&gt; 0 &lt;= <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> (<span class="id">x</span> + <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5452')">Proof.</div>
<div class="proofscript" id="proof5452">
<span class="tactic">intros</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Vfexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hexp</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Nnx</span> <span class="id">Nny</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">unfold</span> <span class="id">double_round_eq</span>.<br/>
<span class="tactic">destruct</span> (<span class="id">Req_dec</span> <span class="id">x</span> 0) <span class="kwd">as</span> [<span class="id">Zx</span>|<span class="id">Nzx</span>].<br/>
- <span class="comment">(*&nbsp;x&nbsp;=&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hexp</span> <span class="kwd">as</span> (<span class="id">_</span>,(<span class="id">_</span>,(<span class="id">_</span>,<span class="id">Hexp4</span>))).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Zx</span>; <span class="tactic">rewrite</span> <span class="id">Rplus_0_l</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">round_generic</span> <span class="id">beta</span> <span class="id">fexp2</span>).<br/>
&nbsp;&nbsp;+ <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;+ <span class="id">now</span> <span class="tactic">apply</span> <span class="id">valid_rnd_N</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">apply</span> (<span class="id">generic_inclusion_ln_beta</span> <span class="id">beta</span> <span class="id">fexp1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">intros</span> <span class="id">_</span>; <span class="tactic">apply</span> <span class="id">Hexp4</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">Fy</span>.<br/>
- <span class="comment">(*&nbsp;x&nbsp;&lt;&gt;&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Req_dec</span> <span class="id">y</span> 0) <span class="kwd">as</span> [<span class="id">Zy</span>|<span class="id">Nzy</span>].<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;y&nbsp;=&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hexp</span> <span class="kwd">as</span> (<span class="id">_</span>,(<span class="id">_</span>,(<span class="id">_</span>,<span class="id">Hexp4</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Zy</span>; <span class="tactic">rewrite</span> <span class="id">Rplus_0_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">round_generic</span> <span class="id">beta</span> <span class="id">fexp2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">now</span> <span class="tactic">apply</span> <span class="id">valid_rnd_N</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> (<span class="id">generic_inclusion_ln_beta</span> <span class="id">beta</span> <span class="id">fexp1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">intros</span> <span class="id">_</span>; <span class="tactic">apply</span> <span class="id">Hexp4</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">Fx</span>.<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;y&nbsp;&lt;&gt;&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Px</span> : 0 &lt; <span class="id">x</span>); [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Py</span> : 0 &lt; <span class="id">y</span>); [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Rlt_or_le</span> <span class="id">x</span> <span class="id">y</span>) <span class="kwd">as</span> [<span class="id">H</span>|<span class="id">H</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;x&nbsp;&lt;&nbsp;y&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rlt_le</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rplus_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">double_round_plus_aux2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">now</span> <span class="tactic">apply</span> <span class="id">double_round_plus_aux2</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_minus_aux0_aux</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>),<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;(<span class="id">fexp2</span> (<span class="id">ln_beta</span> (<span class="id">x</span> - <span class="id">y</span>))%<span class="id">Z</span> &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">fexp2</span> (<span class="id">ln_beta</span> (<span class="id">x</span> - <span class="id">y</span>))%<span class="id">Z</span> &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">y</span>))%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> -&gt; <span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp2</span> (<span class="id">x</span> - <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5453')">Proof.</div>
<div class="proofscript" id="proof5453">
<span class="tactic">intros</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">x</span> <span class="id">y</span>.<br/>
<span class="tactic">replace</span> (<span class="id">x</span> - <span class="id">y</span>)%<span class="id">R</span> <span class="kwd">with</span> (<span class="id">x</span> + (- <span class="id">y</span>))%<span class="id">R</span>; [|<span class="tactic">ring</span>].<br/>
<span class="tactic">intros</span> <span class="id">Hlnx</span> <span class="id">Hlny</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">rewrite</span> &lt;- (<span class="id">ln_beta_opp</span> <span class="id">beta</span> <span class="id">y</span>) <span class="kwd">in</span> <span class="id">Hlny</span>.<br/>
<span class="tactic">apply</span> <span class="id">generic_format_opp</span> <span class="kwd">in</span> <span class="id">Fy</span>.<br/>
<span class="id">now</span> <span class="tactic">apply</span> (<span class="id">double_round_plus_aux0_aux</span> <span class="id">fexp1</span>).<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_minus_aux0</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>),<br/>
&nbsp;&nbsp;<span class="id">double_round_plus_hyp</span> <span class="id">fexp1</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;0 &lt; <span class="id">y</span> -&gt; <span class="id">y</span> &lt; <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - 1 &lt;= <span class="id">ln_beta</span> <span class="id">y</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> -&gt; <span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp2</span> (<span class="id">x</span> - <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5454')">Proof.</div>
<div class="proofscript" id="proof5454">
<span class="tactic">intros</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Hexp</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Py</span> <span class="id">Hyx</span> <span class="id">Hln</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">assert</span> (<span class="id">Px</span> := <span class="id">Rlt_trans</span> 0 <span class="id">y</span> <span class="id">x</span> <span class="id">Py</span> <span class="id">Hyx</span>).<br/>
<span class="tactic">destruct</span> <span class="id">Hexp</span> <span class="kwd">as</span> (<span class="id">Hexp1</span>,(<span class="id">_</span>,(<span class="id">Hexp3</span>,<span class="id">Hexp4</span>))).<br/>
<span class="tactic">assert</span> (<span class="id">Lyx</span> : (<span class="id">ln_beta</span> <span class="id">y</span> &lt;= <span class="id">ln_beta</span> <span class="id">x</span>)%<span class="id">Z</span>);<br/>
&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_le</span>; [|<span class="tactic">apply</span> <span class="id">Rlt_le</span>]|].<br/>
<span class="tactic">destruct</span> (<span class="id">Z.lt_ge_cases</span> (<span class="id">ln_beta</span> <span class="id">x</span> - 2) (<span class="id">ln_beta</span> <span class="id">y</span>)) <span class="kwd">as</span> [<span class="id">Hlt</span>|<span class="id">Hge</span>].<br/>
- <span class="comment">(*&nbsp;ln_beta&nbsp;x&nbsp;-&nbsp;2&nbsp;&lt;&nbsp;ln_beta&nbsp;y&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hor</span> : (<span class="id">ln_beta</span> <span class="id">y</span> = <span class="id">ln_beta</span> <span class="id">x</span> :&gt; <span class="id">Z</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\/ (<span class="id">ln_beta</span> <span class="id">y</span> = <span class="id">ln_beta</span> <span class="id">x</span> - 1 :&gt; <span class="id">Z</span>)%<span class="id">Z</span>); [<span class="tactic">omega</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hor</span> <span class="kwd">as</span> [<span class="id">Heq</span>|<span class="id">Heqm1</span>].<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;ln_beta&nbsp;y&nbsp;=&nbsp;ln_beta&nbsp;x&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">double_round_minus_aux0_aux</span> <span class="id">fexp1</span>); [| |<span class="tactic">exact</span> <span class="id">Fx</span>|<span class="tactic">exact</span> <span class="id">Fy</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">Hexp4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Zle_trans</span> <span class="kwd">with</span> (<span class="id">ln_beta</span> (<span class="id">x</span> - <span class="id">y</span>)); [<span class="tactic">omega</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_minus</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hexp4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Zle_trans</span> <span class="kwd">with</span> (<span class="id">ln_beta</span> (<span class="id">x</span> - <span class="id">y</span>)); [<span class="tactic">omega</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_minus</span>.<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;ln_beta&nbsp;y&nbsp;=&nbsp;ln_beta&nbsp;x&nbsp;-&nbsp;1&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">double_round_minus_aux0_aux</span> <span class="id">fexp1</span>); [| |<span class="tactic">exact</span> <span class="id">Fx</span>|<span class="tactic">exact</span> <span class="id">Fy</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">Hexp4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Zle_trans</span> <span class="kwd">with</span> (<span class="id">ln_beta</span> (<span class="id">x</span> - <span class="id">y</span>)); [<span class="tactic">omega</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_minus</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id">Heqm1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hexp4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Zplus_le_compat_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_minus</span>.<br/>
- <span class="comment">(*&nbsp;ln_beta&nbsp;y&nbsp;&lt;=&nbsp;ln_beta&nbsp;x&nbsp;-&nbsp;2&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">ln_beta_minus_disj</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Px</span> <span class="id">Py</span> <span class="id">Hge</span>) <span class="kwd">as</span> [<span class="id">Lxmy</span>|<span class="id">Lxmy</span>].<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;ln_beta&nbsp;(x&nbsp;-&nbsp;y)&nbsp;=&nbsp;ln_beta&nbsp;x&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">double_round_minus_aux0_aux</span> <span class="id">fexp1</span>); [| |<span class="tactic">exact</span> <span class="id">Fx</span>|<span class="tactic">exact</span> <span class="id">Fy</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">Hexp4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">now</span> <span class="tactic">rewrite</span> <span class="id">Lxmy</span>; <span class="tactic">apply</span> <span class="id">Hexp3</span>.<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;ln_beta&nbsp;(x&nbsp;-&nbsp;y)&nbsp;=&nbsp;ln_beta&nbsp;x&nbsp;-&nbsp;1&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">double_round_minus_aux0_aux</span> <span class="id">fexp1</span>); [| |<span class="tactic">exact</span> <span class="id">Fx</span>|<span class="tactic">exact</span> <span class="id">Fy</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Lxmy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">Hexp1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">_</span> + <span class="id">_</span>)%<span class="id">Z</span> <span class="kwd">with</span> (<span class="id">ln_beta</span> <span class="id">x</span> : <span class="id">Z</span>); [|<span class="tactic">ring</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Zle_trans</span> <span class="kwd">with</span> (<span class="id">ln_beta</span> <span class="id">y</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">Hexp1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">replace</span> (<span class="id">_</span> + <span class="id">_</span>)%<span class="id">Z</span> <span class="kwd">with</span> (<span class="id">ln_beta</span> <span class="id">x</span> : <span class="id">Z</span>); [|<span class="tactic">ring</span>].<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_minus_aux1</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>),<br/>
&nbsp;&nbsp;<span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt; <span class="id">Valid_exp</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_plus_hyp</span> <span class="id">fexp1</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;0 &lt; <span class="id">y</span> -&gt; <span class="id">y</span> &lt; <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">ln_beta</span> <span class="id">y</span> &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - 2)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">x</span> - <span class="id">y</span>)) - 1 &lt;= <span class="id">ln_beta</span> <span class="id">y</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> -&gt; <span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp2</span> (<span class="id">x</span> - <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5455')">Proof.</div>
<div class="proofscript" id="proof5455">
<span class="tactic">intros</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Vfexp2</span>  <span class="id">Hexp</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Py</span> <span class="id">Hyx</span> <span class="id">Hln</span> <span class="id">Hln</span>' <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">assert</span> (<span class="id">Px</span> := <span class="id">Rlt_trans</span> 0 <span class="id">y</span> <span class="id">x</span> <span class="id">Py</span> <span class="id">Hyx</span>).<br/>
<span class="tactic">destruct</span> <span class="id">Hexp</span> <span class="kwd">as</span> (<span class="id">Hexp1</span>,(<span class="id">Hexp2</span>,(<span class="id">Hexp3</span>,<span class="id">Hexp4</span>))).<br/>
<span class="tactic">assert</span> (<span class="id">Lyx</span> : (<span class="id">ln_beta</span> <span class="id">y</span> &lt;= <span class="id">ln_beta</span> <span class="id">x</span>)%<span class="id">Z</span>);<br/>
&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_le</span>; [|<span class="tactic">apply</span> <span class="id">Rlt_le</span>]|].<br/>
<span class="tactic">assert</span> (<span class="id">Hfx</span> : (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt; <span class="id">ln_beta</span> <span class="id">x</span>)%<span class="id">Z</span>);<br/>
&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_generic_gt</span>; [|<span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>|]|].<br/>
<span class="tactic">assert</span> (<span class="id">Hfy</span> : (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">y</span>) &lt; <span class="id">ln_beta</span> <span class="id">y</span>)%<span class="id">Z</span>);<br/>
&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_generic_gt</span>; [|<span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>|]|].<br/>
<span class="tactic">apply</span> (<span class="id">double_round_minus_aux0_aux</span> <span class="id">fexp1</span>); [| |<span class="tactic">exact</span> <span class="id">Fx</span>|<span class="tactic">exact</span> <span class="id">Fy</span>].<br/>
- <span class="tactic">apply</span> <span class="id">Zle_trans</span> <span class="kwd">with</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">x</span> - <span class="id">y</span>))).<br/>
&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">Hexp4</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">omega</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">Hexp3</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_minus_aux2_aux</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fexp</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>),<br/>
&nbsp;&nbsp;<span class="id">Valid_exp</span> <span class="id">fexp</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;0 &lt; <span class="id">y</span> -&gt; <span class="id">y</span> &lt; <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">ln_beta</span> <span class="id">y</span> &lt;= <span class="id">fexp</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - 1)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">round</span> <span class="id">beta</span> <span class="id">fexp</span> <span class="id">Zceil</span> (<span class="id">x</span> - <span class="id">y</span>) - (<span class="id">x</span> - <span class="id">y</span>) &lt;= <span class="id">y</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5456')">Proof.</div>
<div class="proofscript" id="proof5456">
<span class="tactic">intros</span> <span class="id">fexp</span> <span class="id">Vfexp</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Py</span> <span class="id">Hxy</span> <span class="id">Hly</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">assert</span> (<span class="id">Px</span> := <span class="id">Rlt_trans</span> 0 <span class="id">y</span> <span class="id">x</span> <span class="id">Py</span> <span class="id">Hxy</span>).<br/>
<span class="id">revert</span> <span class="id">Fx</span>.<br/>
<span class="tactic">unfold</span> <span class="id">generic_format</span>, <span class="id">F2R</span>, <span class="id">scaled_mantissa</span>, <span class="id">canonic_exp</span>; <span class="tactic">simpl</span>.<br/>
<span class="tactic">set</span> (<span class="id">mx</span> := <span class="id">Ztrunc</span> (<span class="id">x</span> * <span class="id">bpow</span> (- <span class="id">fexp</span> (<span class="id">ln_beta</span> <span class="id">x</span>)))).<br/>
<span class="tactic">intro</span> <span class="id">Fx</span>.<br/>
<span class="tactic">assert</span> (<span class="id">Hfx</span> : (<span class="id">fexp</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt; <span class="id">ln_beta</span> <span class="id">x</span>)%<span class="id">Z</span>);<br/>
&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_generic_gt</span>; [|<span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>|]|].<br/>
<span class="tactic">assert</span> (<span class="id">Hfy</span> : (<span class="id">fexp</span> (<span class="id">ln_beta</span> <span class="id">y</span>) &lt; <span class="id">ln_beta</span> <span class="id">y</span>)%<span class="id">Z</span>);<br/>
&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_generic_gt</span>; [|<span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>|]|].<br/>
<span class="tactic">destruct</span> (<span class="id">Rlt_or_le</span> (<span class="id">bpow</span> (<span class="id">ln_beta</span> <span class="id">x</span> - 1)) <span class="id">x</span>) <span class="kwd">as</span> [<span class="id">Hx</span>|<span class="id">Hx</span>].<br/>
- <span class="comment">(*&nbsp;bpow&nbsp;(ln_beta&nbsp;x&nbsp;-&nbsp;1)&nbsp;&lt;&nbsp;x&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Lxy</span> : <span class="id">ln_beta</span> (<span class="id">x</span> - <span class="id">y</span>) = <span class="id">ln_beta</span> <span class="id">x</span> :&gt; <span class="id">Z</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> (<span class="id">ln_beta_minus_separated</span> <span class="id">fexp</span>); [| | | | | |<span class="tactic">omega</span>]|].<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Rxy</span> : <span class="id">round</span> <span class="id">beta</span> <span class="id">fexp</span> <span class="id">Zceil</span> (<span class="id">x</span> - <span class="id">y</span>) = <span class="id">x</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id">round</span>, <span class="id">F2R</span>, <span class="id">scaled_mantissa</span>, <span class="id">canonic_exp</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Lxy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">eq_sym</span>; <span class="tactic">rewrite</span> <span class="id">Fx</span> <span class="tactic">at</span> 1; <span class="tactic">apply</span> <span class="id">eq_sym</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rmult_eq_compat_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Fx</span> <span class="tactic">at</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_minus_distr_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Zceil_imp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">Zminus</span>; <span class="tactic">rewrite</span> <span class="id">Z2R_plus</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rplus_lt_compat_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Ropp_lt_contravar</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_r</span> (<span class="id">bpow</span> (<span class="id">fexp</span> (<span class="id">ln_beta</span> <span class="id">x</span>))));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_1_l</span>; <span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rlt_le_trans</span> <span class="kwd">with</span> (<span class="id">bpow</span> (<span class="id">ln_beta</span> <span class="id">y</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> &lt;- <span class="id">Rabs_right</span> <span class="tactic">at</span> 1; [|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rle_ge</span>; <span class="tactic">apply</span> <span class="id">Rlt_le</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bpow_ln_beta_gt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">bpow_le</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> &lt;- (<span class="id">Rplus_0_r</span> (<span class="id">Z2R</span> <span class="id">_</span>)) <span class="tactic">at</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rplus_le_compat_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Ropp_0</span>; <span class="tactic">apply</span> <span class="id">Ropp_le_contravar</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rmult_0_r</span> <span class="id">y</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rmult_le_compat_l</span>; [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rlt_le</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_ge_0</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rxy</span>; <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rle_refl</span>.<br/>
- <span class="comment">(*&nbsp;x&nbsp;&lt;=&nbsp;bpow&nbsp;(ln_beta&nbsp;x&nbsp;-&nbsp;1)&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Xpow</span> : <span class="id">x</span> = <span class="id">bpow</span> (<span class="id">ln_beta</span> <span class="id">x</span> - 1)).<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">Rle_antisym</span>; [<span class="tactic">exact</span> <span class="id">Hx</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">ln_beta</span> <span class="id">x</span>) <span class="kwd">as</span> (<span class="id">ex</span>, <span class="id">Hex</span>); <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rabs_right</span> <span class="id">x</span>); [|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rle_ge</span>; <span class="tactic">apply</span> <span class="id">Rlt_le</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hex</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Lxy</span> : (<span class="id">ln_beta</span> (<span class="id">x</span> - <span class="id">y</span>) = <span class="id">ln_beta</span> <span class="id">x</span> - 1 :&gt; <span class="id">Z</span>)%<span class="id">Z</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">Zle_antisym</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">ln_beta_le_bpow</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">Rminus_eq_contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">intro</span> <span class="id">Hx</span>'; <span class="tactic">rewrite</span> <span class="id">Hx</span>' <span class="kwd">in</span> <span class="id">Hxy</span>; <span class="tactic">apply</span> (<span class="id">Rlt_irrefl</span> <span class="id">y</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">Rabs_right</span>; <span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id">ln_beta_minus_lb</span> <span class="id">beta</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Px</span> <span class="id">Py</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hfx1</span> : (<span class="id">fexp</span> (<span class="id">ln_beta</span> <span class="id">x</span> - 1) &lt; <span class="id">ln_beta</span> <span class="id">x</span> - 1)%<span class="id">Z</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> (<span class="id">valid_exp_large</span> <span class="id">fexp</span> (<span class="id">ln_beta</span> <span class="id">y</span>)); [|<span class="tactic">omega</span>]|].<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Rxy</span> : <span class="id">round</span> <span class="id">beta</span> <span class="id">fexp</span> <span class="id">Zceil</span> (<span class="id">x</span> - <span class="id">y</span>) &lt;= <span class="id">x</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">Xpow</span> <span class="tactic">at</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">round</span>, <span class="id">F2R</span>, <span class="id">scaled_mantissa</span>, <span class="id">canonic_exp</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Lxy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_le_reg_r</span> (<span class="id">bpow</span> (- <span class="id">fexp</span> (<span class="id">ln_beta</span> <span class="id">x</span> - 1)%<span class="id">Z</span>)));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Z2R_Zpower</span> <span class="id">beta</span> (<span class="id">_</span> - <span class="id">_</span> - <span class="id">_</span>)); [|<span class="tactic">omega</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Z2R_le</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Zceil_glb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Z2R_Zpower</span>; [|<span class="tactic">omega</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Xpow</span> <span class="tactic">at</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_minus_distr_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rplus_0_r</span> (<span class="id">bpow</span> <span class="id">_</span>)) <span class="tactic">at</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rplus_le_compat_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Ropp_0</span>; <span class="tactic">apply</span> <span class="id">Ropp_le_contravar</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rmult_0_r</span> <span class="id">y</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rmult_le_compat_l</span>; [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rlt_le</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_ge_0</span>. }<br/>
&nbsp;&nbsp;<span class="id">lra</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_minus_aux2</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>),<br/>
&nbsp;&nbsp;<span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt; <span class="id">Valid_exp</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">choice1</span> <span class="id">choice2</span> : <span class="id">Z</span> -&gt; <span class="id">bool</span>),<br/>
&nbsp;&nbsp;<span class="id">double_round_plus_hyp</span> <span class="id">fexp1</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;0 &lt; <span class="id">y</span> -&gt; <span class="id">y</span> &lt; <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">ln_beta</span> <span class="id">y</span> &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - 2)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">ln_beta</span> <span class="id">y</span> &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">x</span> - <span class="id">y</span>)) - 2)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> (<span class="id">x</span> - <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5457')">Proof.</div>
<div class="proofscript" id="proof5457">
<span class="tactic">assert</span> (<span class="id">Hbeta</span> : (2 &lt;= <span class="id">beta</span>)%<span class="id">Z</span>).<br/>
{ <span class="tactic">destruct</span> <span class="id">beta</span> <span class="kwd">as</span> (<span class="id">beta_val</span>,<span class="id">beta_prop</span>).<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Zle_bool_imp_le</span>. }<br/>
<span class="tactic">intros</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Vfexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hexp</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Py</span> <span class="id">Hxy</span> <span class="id">Hly</span> <span class="id">Hly</span>' <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">assert</span> (<span class="id">Px</span> := <span class="id">Rlt_trans</span> 0 <span class="id">y</span> <span class="id">x</span> <span class="id">Py</span> <span class="id">Hxy</span>).<br/>
<span class="tactic">destruct</span> <span class="id">Hexp</span> <span class="kwd">as</span> (<span class="id">_</span>,(<span class="id">_</span>,(<span class="id">_</span>,<span class="id">Hexp4</span>))).<br/>
<span class="tactic">assert</span> (<span class="id">Hf2</span> : (<span class="id">fexp2</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))%<span class="id">Z</span>);<br/>
&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Hexp4</span>; <span class="tactic">omega</span>|].<br/>
<span class="tactic">assert</span> (<span class="id">Hfx</span> : (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt; <span class="id">ln_beta</span> <span class="id">x</span>)%<span class="id">Z</span>);<br/>
&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_generic_gt</span>; [|<span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>|]|].<br/>
<span class="tactic">assert</span> (<span class="id">Bpow2</span> : <span class="id">bpow</span> (- 2) &lt;= / 2 * / 2).<br/>
{ <span class="tactic">unfold</span> <span class="id">Fcore_Raux.bpow</span>, <span class="id">Z.pow_pos</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Rinv_mult_distr</span>; [|<span class="id">lra</span>|<span class="id">lra</span>].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rinv_le</span>; [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;<span class="id">change</span> 4 <span class="kwd">with</span> (<span class="id">Z2R</span> (2 * 2)); <span class="tactic">apply</span> <span class="id">Z2R_le</span>; <span class="tactic">rewrite</span> <span class="id">Zmult_1_r</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Zmult_le_compat</span>; <span class="tactic">omega</span>. }<br/>
<span class="tactic">assert</span> (<span class="id">Ly</span> : <span class="id">y</span> &lt; <span class="id">bpow</span> (<span class="id">ln_beta</span> <span class="id">y</span>)).<br/>
{ <span class="tactic">apply</span> <span class="id">Rabs_lt_inv</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bpow_ln_beta_gt</span>. }<br/>
<span class="tactic">unfold</span> <span class="id">double_round_eq</span>.<br/>
<span class="tactic">apply</span> <span class="id">double_round_gt_mid</span>.<br/>
- <span class="tactic">exact</span> <span class="id">Vfexp1</span>.<br/>
- <span class="tactic">exact</span> <span class="id">Vfexp2</span>.<br/>
- <span class="id">lra</span>.<br/>
- <span class="tactic">apply</span> <span class="id">Hexp4</span>; <span class="tactic">omega</span>.<br/>
- <span class="tactic">assert</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">x</span> - <span class="id">y</span>)) &lt; <span class="id">ln_beta</span> (<span class="id">x</span> - <span class="id">y</span>))%<span class="id">Z</span>; [|<span class="tactic">omega</span>].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">valid_exp_large</span> <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span> - 1)).<br/>
&nbsp;&nbsp;+ <span class="tactic">apply</span> (<span class="id">valid_exp_large</span> <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">y</span>)); [|<span class="tactic">omega</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_generic_gt</span>; [|<span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>|].<br/>
&nbsp;&nbsp;+ <span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_minus_lb</span>; [| |<span class="tactic">omega</span>].<br/>
- <span class="tactic">unfold</span> <span class="id">midp</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rplus_lt_reg_r</span> (/ 2 * <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp1</span> (<span class="id">x</span> - <span class="id">y</span>) - (<span class="id">x</span> - <span class="id">y</span>))).<br/>
&nbsp;&nbsp;<span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">_</span> + <span class="id">_</span>) <span class="kwd">with</span> (<span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zceil</span> (<span class="id">x</span> - <span class="id">y</span>) - (<span class="id">x</span> - <span class="id">y</span>)) <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rlt_le_trans</span> <span class="kwd">with</span> (<span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">x</span> - <span class="id">y</span>)) - 2)).<br/>
&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">Rle_lt_trans</span> <span class="kwd">with</span> <span class="id">y</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">double_round_minus_aux2_aux</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">omega</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rlt_le_trans</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Ly</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_le</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">ulp_neq_0</span>;[<span class="id">idtac</span>|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">sym_not_eq</span>, <span class="id">Rlt_not_eq</span>, <span class="id">Rgt_minus</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">canonic_exp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">_</span> - 2)%<span class="id">Z</span> <span class="kwd">with</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">x</span> - <span class="id">y</span>)) - 1 - 1)%<span class="id">Z</span> <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Zminus</span> <span class="tactic">at</span> 1; <span class="tactic">rewrite</span> <span class="id">bpow_plus</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rmult_le_compat</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_ge_0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_ge_0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">unfold</span> <span class="id">Fcore_Raux.bpow</span>, <span class="id">Z.pow_pos</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Zmult_1_r</span>; <span class="tactic">apply</span> <span class="id">Rinv_le</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">change</span> 2 <span class="kwd">with</span> (<span class="id">Z2R</span> 2); <span class="tactic">apply</span> <span class="id">Z2R_le</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">bpow_le</span>; <span class="tactic">omega</span>.<br/>
- <span class="tactic">intro</span> <span class="id">Hf2</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">midp</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rplus_lt_reg_r</span> (/ 2 * <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp1</span> (<span class="id">x</span> - <span class="id">y</span>) - (<span class="id">x</span> - <span class="id">y</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- / 2 * <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp2</span> (<span class="id">x</span> - <span class="id">y</span>))).<br/>
&nbsp;&nbsp;<span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">_</span> + <span class="id">_</span>) <span class="kwd">with</span> (<span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zceil</span> (<span class="id">x</span> - <span class="id">y</span>) - (<span class="id">x</span> - <span class="id">y</span>)) <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rle_lt_trans</span> <span class="kwd">with</span> <span class="id">y</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">double_round_minus_aux2_aux</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">omega</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rlt_le_trans</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Ly</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rle_trans</span> <span class="kwd">with</span> (<span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">x</span> - <span class="id">y</span>)) - 2));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_le</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">_</span> - 2)%<span class="id">Z</span> <span class="kwd">with</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">x</span> - <span class="id">y</span>)) - 1 - 1)%<span class="id">Z</span> <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Zminus</span> <span class="tactic">at</span> 1; <span class="tactic">rewrite</span> <span class="id">bpow_plus</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Rmult_minus_distr_l</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_comm</span>; <span class="tactic">apply</span> <span class="id">Rmult_le_compat</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">bpow_ge_0</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">bpow_ge_0</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">unfold</span> <span class="id">Fcore_Raux.bpow</span>, <span class="id">Z.pow_pos</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Zmult_1_r</span>; <span class="tactic">apply</span> <span class="id">Rinv_le</span>; [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">change</span> 2 <span class="kwd">with</span> (<span class="id">Z2R</span> 2); <span class="tactic">apply</span> <span class="id">Z2R_le</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> 2!<span class="id">ulp_neq_0</span>; <span class="tactic">try</span> <span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>, <span class="id">Rgt_minus</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">canonic_exp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rplus_le_reg_r</span> (<span class="id">bpow</span> (<span class="id">fexp2</span> (<span class="id">ln_beta</span> (<span class="id">x</span> - <span class="id">y</span>))))); <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rle_trans</span> <span class="kwd">with</span> (2 * <span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">x</span> - <span class="id">y</span>)) - 1)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id">Rmult_plus_distr_r</span>; <span class="tactic">rewrite</span> <span class="id">Rmult_1_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rplus_le_compat_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_le</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">unfold</span> <span class="id">Zminus</span>; <span class="tactic">rewrite</span> <span class="id">bpow_plus</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_comm</span>; <span class="tactic">rewrite</span> <span class="id">Rmult_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Rmult_1_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rmult_le_compat_l</span>; [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_ge_0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Fcore_Raux.bpow</span>, <span class="id">Z.pow_pos</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Zmult_1_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rinv_r</span> 2) <span class="tactic">at</span> 3; [|<span class="id">lra</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_comm</span>; <span class="tactic">apply</span> <span class="id">Rmult_le_compat_l</span>; [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rinv_le</span>; [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">change</span> 2 <span class="kwd">with</span> (<span class="id">Z2R</span> 2); <span class="tactic">apply</span> <span class="id">Z2R_le</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_minus_aux3</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>),<br/>
&nbsp;&nbsp;<span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt; <span class="id">Valid_exp</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">choice1</span> <span class="id">choice2</span> : <span class="id">Z</span> -&gt; <span class="id">bool</span>),<br/>
&nbsp;&nbsp;<span class="id">double_round_plus_hyp</span> <span class="id">fexp1</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;0 &lt; <span class="id">y</span> -&gt; <span class="id">y</span> &lt;= <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> (<span class="id">x</span> - <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5458')">Proof.</div>
<div class="proofscript" id="proof5458">
<span class="tactic">intros</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Vfexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hexp</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Py</span> <span class="id">Hyx</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">assert</span> (<span class="id">Px</span> := <span class="id">Rlt_le_trans</span> 0 <span class="id">y</span> <span class="id">x</span> <span class="id">Py</span> <span class="id">Hyx</span>).<br/>
<span class="tactic">unfold</span> <span class="id">double_round_eq</span>.<br/>
<span class="tactic">destruct</span> (<span class="id">Req_dec</span> <span class="id">y</span> <span class="id">x</span>) <span class="kwd">as</span> [<span class="id">Hy</span>|<span class="id">Hy</span>].<br/>
- <span class="comment">(*&nbsp;y&nbsp;=&nbsp;x&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hy</span>; <span class="tactic">replace</span> (<span class="id">x</span> - <span class="id">x</span>) <span class="kwd">with</span> 0 <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">round_0</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;+ <span class="id">now</span> <span class="tactic">apply</span> <span class="id">valid_rnd_N</span>.<br/>
- <span class="comment">(*&nbsp;y&nbsp;&lt;&nbsp;x&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hyx</span>' : <span class="id">y</span> &lt; <span class="id">x</span>); [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Zle_or_lt</span> (<span class="id">ln_beta</span> <span class="id">y</span>) (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - 2)) <span class="kwd">as</span> [<span class="id">Hly</span>|<span class="id">Hly</span>].<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;ln_beta&nbsp;y&nbsp;&lt;=&nbsp;fexp1&nbsp;(ln_beta&nbsp;x)&nbsp;-&nbsp;2&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Zle_or_lt</span> (<span class="id">ln_beta</span> <span class="id">y</span>) (<span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">x</span> - <span class="id">y</span>)) - 2))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> [<span class="id">Hly</span>'|<span class="id">Hly</span>'].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;ln_beta&nbsp;y&nbsp;&lt;=&nbsp;fexp1&nbsp;(ln_beta&nbsp;(x&nbsp;-&nbsp;y))&nbsp;-&nbsp;2&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">double_round_minus_aux2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;fexp1&nbsp;(ln_beta&nbsp;(x&nbsp;-&nbsp;y))&nbsp;-&nbsp;2&nbsp;&lt;&nbsp;ln_beta&nbsp;y&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> (<span class="id">round_generic</span> <span class="id">beta</span> <span class="id">fexp2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">valid_rnd_N</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">assert</span> (<span class="id">Hf1</span> : (<span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">x</span> - <span class="id">y</span>)) - 1 &lt;= <span class="id">ln_beta</span> <span class="id">y</span>)%<span class="id">Z</span>); [<span class="tactic">omega</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> (<span class="id">double_round_minus_aux1</span> <span class="id">fexp1</span>). }<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> (<span class="id">round_generic</span> <span class="id">beta</span> <span class="id">fexp2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">now</span> <span class="tactic">apply</span> <span class="id">valid_rnd_N</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">assert</span> (<span class="id">Hf1</span> : (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - 1 &lt;= <span class="id">ln_beta</span> <span class="id">y</span>)%<span class="id">Z</span>); [<span class="tactic">omega</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> (<span class="id">double_round_minus_aux0</span> <span class="id">fexp1</span>).<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_minus_aux</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>),<br/>
&nbsp;&nbsp;<span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt; <span class="id">Valid_exp</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">choice1</span> <span class="id">choice2</span> : <span class="id">Z</span> -&gt; <span class="id">bool</span>),<br/>
&nbsp;&nbsp;<span class="id">double_round_plus_hyp</span> <span class="id">fexp1</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;0 &lt;= <span class="id">x</span> -&gt; 0 &lt;= <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> (<span class="id">x</span> - <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5459')">Proof.</div>
<div class="proofscript" id="proof5459">
<span class="tactic">intros</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Vfexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hexp</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Nnx</span> <span class="id">Nny</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">unfold</span> <span class="id">double_round_eq</span>.<br/>
<span class="tactic">destruct</span> (<span class="id">Req_dec</span> <span class="id">x</span> 0) <span class="kwd">as</span> [<span class="id">Zx</span>|<span class="id">Nzx</span>].<br/>
- <span class="comment">(*&nbsp;x&nbsp;=&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Zx</span>; <span class="tactic">unfold</span> <span class="id">Rminus</span>; <span class="tactic">rewrite</span> <span class="id">Rplus_0_l</span>.<br/>
&nbsp;&nbsp;<span class="tactic">do</span> 3 <span class="tactic">rewrite</span> <span class="id">round_N_opp</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">round_generic</span> <span class="id">beta</span> <span class="id">fexp2</span>).<br/>
&nbsp;&nbsp;* <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;* <span class="id">now</span> <span class="tactic">apply</span> <span class="id">valid_rnd_N</span>.<br/>
&nbsp;&nbsp;* <span class="tactic">apply</span> (<span class="id">generic_inclusion_ln_beta</span> <span class="id">beta</span> <span class="id">fexp1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hexp</span> <span class="kwd">as</span> (<span class="id">_</span>,(<span class="id">_</span>,(<span class="id">_</span>,<span class="id">Hexp4</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">intros</span> <span class="id">_</span>; <span class="tactic">apply</span> <span class="id">Hexp4</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">Fy</span>.<br/>
- <span class="comment">(*&nbsp;x&nbsp;&lt;&gt;&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Req_dec</span> <span class="id">y</span> 0) <span class="kwd">as</span> [<span class="id">Zy</span>|<span class="id">Nzy</span>].<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;y&nbsp;=&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Zy</span>; <span class="tactic">unfold</span> <span class="id">Rminus</span>; <span class="tactic">rewrite</span> <span class="id">Ropp_0</span>; <span class="tactic">rewrite</span> <span class="id">Rplus_0_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">round_generic</span> <span class="id">beta</span> <span class="id">fexp2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">now</span> <span class="tactic">apply</span> <span class="id">valid_rnd_N</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> (<span class="id">generic_inclusion_ln_beta</span> <span class="id">beta</span> <span class="id">fexp1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hexp</span> <span class="kwd">as</span> (<span class="id">_</span>,(<span class="id">_</span>,(<span class="id">_</span>,<span class="id">Hexp4</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">intros</span> <span class="id">_</span>; <span class="tactic">apply</span> <span class="id">Hexp4</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">Fx</span>.<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;y&nbsp;&lt;&gt;&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Px</span> : 0 &lt; <span class="id">x</span>); [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Py</span> : 0 &lt; <span class="id">y</span>); [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Rlt_or_le</span> <span class="id">x</span> <span class="id">y</span>) <span class="kwd">as</span> [<span class="id">H</span>|<span class="id">H</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;x&nbsp;&lt;&nbsp;y&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rlt_le</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">x</span> - <span class="id">y</span>) <span class="kwd">with</span> (- (<span class="id">y</span> - <span class="id">x</span>)) <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 <span class="tactic">rewrite</span> <span class="id">round_N_opp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Ropp_eq_compat</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">double_round_minus_aux3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;y&nbsp;&lt;=&nbsp;x&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">double_round_minus_aux3</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_plus</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>),<br/>
&nbsp;&nbsp;<span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt; <span class="id">Valid_exp</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">choice1</span> <span class="id">choice2</span> : <span class="id">Z</span> -&gt; <span class="id">bool</span>),<br/>
&nbsp;&nbsp;<span class="id">double_round_plus_hyp</span> <span class="id">fexp1</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> (<span class="id">x</span> + <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5460')">Proof.</div>
<div class="proofscript" id="proof5460">
<span class="tactic">intros</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Vfexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hexp</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">unfold</span> <span class="id">double_round_eq</span>.<br/>
<span class="tactic">destruct</span> (<span class="id">Rlt_or_le</span> <span class="id">x</span> 0) <span class="kwd">as</span> [<span class="id">Sx</span>|<span class="id">Sx</span>]; <span class="tactic">destruct</span> (<span class="id">Rlt_or_le</span> <span class="id">y</span> 0) <span class="kwd">as</span> [<span class="id">Sy</span>|<span class="id">Sy</span>].<br/>
- <span class="comment">(*&nbsp;x&nbsp;&lt;&nbsp;0,&nbsp;y&nbsp;&lt;&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">x</span> + <span class="id">y</span>) <span class="kwd">with</span> (- (- <span class="id">x</span> - <span class="id">y</span>)); [|<span class="tactic">ring</span>].<br/>
&nbsp;&nbsp;<span class="tactic">do</span> 3 <span class="tactic">rewrite</span> <span class="id">round_N_opp</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Ropp_eq_compat</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Px</span> : 0 &lt;= - <span class="id">x</span>); [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Py</span> : 0 &lt;= - <span class="id">y</span>); [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">generic_format_opp</span> <span class="kwd">in</span> <span class="id">Fx</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">generic_format_opp</span> <span class="kwd">in</span> <span class="id">Fy</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">double_round_plus_aux</span>.<br/>
- <span class="comment">(*&nbsp;x&nbsp;&lt;&nbsp;0,&nbsp;0&nbsp;&lt;=&nbsp;y&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">x</span> + <span class="id">y</span>) <span class="kwd">with</span> (<span class="id">y</span> - (- <span class="id">x</span>)); [|<span class="tactic">ring</span>].<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Px</span> : 0 &lt;= - <span class="id">x</span>); [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">generic_format_opp</span> <span class="kwd">in</span> <span class="id">Fx</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">double_round_minus_aux</span>.<br/>
- <span class="comment">(*&nbsp;0&nbsp;&lt;=&nbsp;x,&nbsp;y&nbsp;&lt;&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">x</span> + <span class="id">y</span>) <span class="kwd">with</span> (<span class="id">x</span> - (- <span class="id">y</span>)); [|<span class="tactic">ring</span>].<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Py</span> : 0 &lt;= - <span class="id">y</span>); [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">generic_format_opp</span> <span class="kwd">in</span> <span class="id">Fy</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">double_round_minus_aux</span>.<br/>
- <span class="comment">(*&nbsp;0&nbsp;&lt;=&nbsp;x,&nbsp;0&nbsp;&lt;=&nbsp;y&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">double_round_plus_aux</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_minus</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>),<br/>
&nbsp;&nbsp;<span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt; <span class="id">Valid_exp</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">choice1</span> <span class="id">choice2</span> : <span class="id">Z</span> -&gt; <span class="id">bool</span>),<br/>
&nbsp;&nbsp;<span class="id">double_round_plus_hyp</span> <span class="id">fexp1</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> (<span class="id">x</span> - <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5461')">Proof.</div>
<div class="proofscript" id="proof5461">
<span class="tactic">intros</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Vfexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hexp</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">unfold</span> <span class="id">Rminus</span>.<br/>
<span class="tactic">apply</span> <span class="id">generic_format_opp</span> <span class="kwd">in</span> <span class="id">Fy</span>.<br/>
<span class="id">now</span> <span class="tactic">apply</span> <span class="id">double_round_plus</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Section</span> <span class="id">Double_round_plus_FLX</span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Fcore_FLX</span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id">prec</span> : <span class="id">Z</span>.<br/>
<span class="kwd">Variable</span> <span class="id">prec</span>' : <span class="id">Z</span>.<br/>
<br/>
<span class="kwd">Context</span> { <span class="id">prec_gt_0_</span> : <span class="id">Prec_gt_0</span> <span class="id">prec</span> }.<br/>
<span class="kwd">Context</span> { <span class="id">prec_gt_0_</span>' : <span class="id">Prec_gt_0</span> <span class="id">prec</span>' }.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">FLX_double_round_plus_hyp</span> :<br/>
&nbsp;&nbsp;(2 * <span class="id">prec</span> + 1 &lt;= <span class="id">prec</span>')%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_plus_hyp</span> (<span class="id">FLX_exp</span> <span class="id">prec</span>) (<span class="id">FLX_exp</span> <span class="id">prec</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5462')">Proof.</div>
<div class="proofscript" id="proof5462">
<span class="tactic">intros</span> <span class="id">Hprec</span>.<br/>
<span class="tactic">unfold</span> <span class="id">FLX_exp</span>.<br/>
<span class="tactic">unfold</span> <span class="id">double_round_plus_hyp</span>; <span class="tactic">split</span>; [|<span class="tactic">split</span>; [|<span class="tactic">split</span>]];<br/>
<span class="tactic">intros</span> <span class="id">ex</span> <span class="id">ey</span>; <span class="tactic">try</span> <span class="tactic">omega</span>.<br/>
<span class="tactic">unfold</span> <span class="id">Prec_gt_0</span> <span class="kwd">in</span> <span class="id">prec_gt_0_</span>.<br/>
<span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id">double_round_plus_FLX</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">choice1</span> <span class="id">choice2</span>,<br/>
&nbsp;&nbsp;(2 * <span class="id">prec</span> + 1 &lt;= <span class="id">prec</span>')%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;<span class="id">FLX_format</span> <span class="id">beta</span> <span class="id">prec</span> <span class="id">x</span> -&gt; <span class="id">FLX_format</span> <span class="id">beta</span> <span class="id">prec</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> (<span class="id">FLX_exp</span> <span class="id">prec</span>) (<span class="id">FLX_exp</span> <span class="id">prec</span>') <span class="id">choice1</span> <span class="id">choice2</span> (<span class="id">x</span> + <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5463')">Proof.</div>
<div class="proofscript" id="proof5463">
<span class="tactic">intros</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hprec</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">apply</span> <span class="id">double_round_plus</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLX_exp_valid</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLX_exp_valid</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLX_double_round_plus_hyp</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FLX</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FLX</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id">double_round_minus_FLX</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">choice1</span> <span class="id">choice2</span>,<br/>
&nbsp;&nbsp;(2 * <span class="id">prec</span> + 1 &lt;= <span class="id">prec</span>')%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;<span class="id">FLX_format</span> <span class="id">beta</span> <span class="id">prec</span> <span class="id">x</span> -&gt; <span class="id">FLX_format</span> <span class="id">beta</span> <span class="id">prec</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> (<span class="id">FLX_exp</span> <span class="id">prec</span>) (<span class="id">FLX_exp</span> <span class="id">prec</span>') <span class="id">choice1</span> <span class="id">choice2</span> (<span class="id">x</span> - <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5464')">Proof.</div>
<div class="proofscript" id="proof5464">
<span class="tactic">intros</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hprec</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">apply</span> <span class="id">double_round_minus</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLX_exp_valid</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLX_exp_valid</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLX_double_round_plus_hyp</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FLX</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FLX</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">Double_round_plus_FLX</span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id">Double_round_plus_FLT</span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Fcore_FLX</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Fcore_FLT</span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id">emin</span> <span class="id">prec</span> : <span class="id">Z</span>.<br/>
<span class="kwd">Variable</span> <span class="id">emin</span>' <span class="id">prec</span>' : <span class="id">Z</span>.<br/>
<br/>
<span class="kwd">Context</span> { <span class="id">prec_gt_0_</span> : <span class="id">Prec_gt_0</span> <span class="id">prec</span> }.<br/>
<span class="kwd">Context</span> { <span class="id">prec_gt_0_</span>' : <span class="id">Prec_gt_0</span> <span class="id">prec</span>' }.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">FLT_double_round_plus_hyp</span> :<br/>
&nbsp;&nbsp;(<span class="id">emin</span>' &lt;= <span class="id">emin</span>)%<span class="id">Z</span> -&gt; (2 * <span class="id">prec</span> + 1 &lt;= <span class="id">prec</span>')%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_plus_hyp</span> (<span class="id">FLT_exp</span> <span class="id">emin</span> <span class="id">prec</span>) (<span class="id">FLT_exp</span> <span class="id">emin</span>' <span class="id">prec</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5465')">Proof.</div>
<div class="proofscript" id="proof5465">
<span class="tactic">intros</span> <span class="id">Hemin</span> <span class="id">Hprec</span>.<br/>
<span class="tactic">unfold</span> <span class="id">FLT_exp</span>.<br/>
<span class="tactic">unfold</span> <span class="id">double_round_plus_hyp</span>; <span class="tactic">split</span>; [|<span class="tactic">split</span>; [|<span class="tactic">split</span>]]; <span class="tactic">intros</span> <span class="id">ex</span> <span class="id">ey</span>.<br/>
- <span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ex</span> + 1 - <span class="id">prec</span>) <span class="id">emin</span>).<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>') <span class="id">emin</span>').<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ey</span> - <span class="id">prec</span>) <span class="id">emin</span>).<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
- <span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ex</span> - 1 - <span class="id">prec</span>) <span class="id">emin</span>).<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>') <span class="id">emin</span>').<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ey</span> - <span class="id">prec</span>) <span class="id">emin</span>).<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
- <span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>) <span class="id">emin</span>).<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>') <span class="id">emin</span>').<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ey</span> - <span class="id">prec</span>) <span class="id">emin</span>).<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
- <span class="tactic">unfold</span> <span class="id">Prec_gt_0</span> <span class="kwd">in</span> <span class="id">prec_gt_0_</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>') <span class="id">emin</span>').<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ey</span> - <span class="id">prec</span>) <span class="id">emin</span>).<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id">double_round_plus_FLT</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">choice1</span> <span class="id">choice2</span>,<br/>
&nbsp;&nbsp;(<span class="id">emin</span>' &lt;= <span class="id">emin</span>)%<span class="id">Z</span> -&gt; (2 * <span class="id">prec</span> + 1 &lt;= <span class="id">prec</span>')%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;<span class="id">FLT_format</span> <span class="id">beta</span> <span class="id">emin</span> <span class="id">prec</span> <span class="id">x</span> -&gt; <span class="id">FLT_format</span> <span class="id">beta</span> <span class="id">emin</span> <span class="id">prec</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> (<span class="id">FLT_exp</span> <span class="id">emin</span> <span class="id">prec</span>) (<span class="id">FLT_exp</span> <span class="id">emin</span>' <span class="id">prec</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">choice1</span> <span class="id">choice2</span> (<span class="id">x</span> + <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5466')">Proof.</div>
<div class="proofscript" id="proof5466">
<span class="tactic">intros</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hemin</span> <span class="id">Hprec</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">apply</span> <span class="id">double_round_plus</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLT_exp_valid</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLT_exp_valid</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLT_double_round_plus_hyp</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FLT</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FLT</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id">double_round_minus_FLT</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">choice1</span> <span class="id">choice2</span>,<br/>
&nbsp;&nbsp;(<span class="id">emin</span>' &lt;= <span class="id">emin</span>)%<span class="id">Z</span> -&gt; (2 * <span class="id">prec</span> + 1 &lt;= <span class="id">prec</span>')%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;<span class="id">FLT_format</span> <span class="id">beta</span> <span class="id">emin</span> <span class="id">prec</span> <span class="id">x</span> -&gt; <span class="id">FLT_format</span> <span class="id">beta</span> <span class="id">emin</span> <span class="id">prec</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> (<span class="id">FLT_exp</span> <span class="id">emin</span> <span class="id">prec</span>) (<span class="id">FLT_exp</span> <span class="id">emin</span>' <span class="id">prec</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">choice1</span> <span class="id">choice2</span> (<span class="id">x</span> - <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5467')">Proof.</div>
<div class="proofscript" id="proof5467">
<span class="tactic">intros</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hemin</span> <span class="id">Hprec</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">apply</span> <span class="id">double_round_minus</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLT_exp_valid</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLT_exp_valid</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLT_double_round_plus_hyp</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FLT</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FLT</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">Double_round_plus_FLT</span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id">Double_round_plus_FTZ</span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Fcore_FLX</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Fcore_FTZ</span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id">emin</span> <span class="id">prec</span> : <span class="id">Z</span>.<br/>
<span class="kwd">Variable</span> <span class="id">emin</span>' <span class="id">prec</span>' : <span class="id">Z</span>.<br/>
<br/>
<span class="kwd">Context</span> { <span class="id">prec_gt_0_</span> : <span class="id">Prec_gt_0</span> <span class="id">prec</span> }.<br/>
<span class="kwd">Context</span> { <span class="id">prec_gt_0_</span>' : <span class="id">Prec_gt_0</span> <span class="id">prec</span>' }.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">FTZ_double_round_plus_hyp</span> :<br/>
&nbsp;&nbsp;(<span class="id">emin</span>' + <span class="id">prec</span>' &lt;= <span class="id">emin</span> + 1)%<span class="id">Z</span> -&gt; (2 * <span class="id">prec</span> + 1 &lt;= <span class="id">prec</span>')%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_plus_hyp</span> (<span class="id">FTZ_exp</span> <span class="id">emin</span> <span class="id">prec</span>) (<span class="id">FTZ_exp</span> <span class="id">emin</span>' <span class="id">prec</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5468')">Proof.</div>
<div class="proofscript" id="proof5468">
<span class="tactic">intros</span> <span class="id">Hemin</span> <span class="id">Hprec</span>.<br/>
<span class="tactic">unfold</span> <span class="id">FTZ_exp</span>.<br/>
<span class="tactic">unfold</span> <span class="id">Prec_gt_0</span> <span class="kwd">in</span> *.<br/>
<span class="tactic">unfold</span> <span class="id">double_round_plus_hyp</span>; <span class="tactic">split</span>; [|<span class="tactic">split</span>; [|<span class="tactic">split</span>]]; <span class="tactic">intros</span> <span class="id">ex</span> <span class="id">ey</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ex</span> + 1 - <span class="id">prec</span>) <span class="id">emin</span>);<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>') <span class="id">emin</span>');<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ey</span> - <span class="id">prec</span>) <span class="id">emin</span>);<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ex</span> - 1 - <span class="id">prec</span>) <span class="id">emin</span>);<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>') <span class="id">emin</span>');<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ey</span> - <span class="id">prec</span>) <span class="id">emin</span>);<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>) <span class="id">emin</span>);<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>') <span class="id">emin</span>');<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ey</span> - <span class="id">prec</span>) <span class="id">emin</span>);<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>') <span class="id">emin</span>');<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ey</span> - <span class="id">prec</span>) <span class="id">emin</span>);<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id">double_round_plus_FTZ</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">choice1</span> <span class="id">choice2</span>,<br/>
&nbsp;&nbsp;(<span class="id">emin</span>' + <span class="id">prec</span>' &lt;= <span class="id">emin</span> + 1)%<span class="id">Z</span> -&gt; (2 * <span class="id">prec</span> + 1 &lt;= <span class="id">prec</span>')%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;<span class="id">FTZ_format</span> <span class="id">beta</span> <span class="id">emin</span> <span class="id">prec</span> <span class="id">x</span> -&gt; <span class="id">FTZ_format</span> <span class="id">beta</span> <span class="id">emin</span> <span class="id">prec</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> (<span class="id">FTZ_exp</span> <span class="id">emin</span> <span class="id">prec</span>) (<span class="id">FTZ_exp</span> <span class="id">emin</span>' <span class="id">prec</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">choice1</span> <span class="id">choice2</span> (<span class="id">x</span> + <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5469')">Proof.</div>
<div class="proofscript" id="proof5469">
<span class="tactic">intros</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hemin</span> <span class="id">Hprec</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">apply</span> <span class="id">double_round_plus</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FTZ_exp_valid</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FTZ_exp_valid</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FTZ_double_round_plus_hyp</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FTZ</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FTZ</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id">double_round_minus_FTZ</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">choice1</span> <span class="id">choice2</span>,<br/>
&nbsp;&nbsp;(<span class="id">emin</span>' + <span class="id">prec</span>' &lt;= <span class="id">emin</span> + 1)%<span class="id">Z</span> -&gt; (2 * <span class="id">prec</span> + 1 &lt;= <span class="id">prec</span>')%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;<span class="id">FTZ_format</span> <span class="id">beta</span> <span class="id">emin</span> <span class="id">prec</span> <span class="id">x</span> -&gt; <span class="id">FTZ_format</span> <span class="id">beta</span> <span class="id">emin</span> <span class="id">prec</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> (<span class="id">FTZ_exp</span> <span class="id">emin</span> <span class="id">prec</span>) (<span class="id">FTZ_exp</span> <span class="id">emin</span>' <span class="id">prec</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">choice1</span> <span class="id">choice2</span> (<span class="id">x</span> - <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5470')">Proof.</div>
<div class="proofscript" id="proof5470">
<span class="tactic">intros</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hemin</span> <span class="id">Hprec</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">apply</span> <span class="id">double_round_minus</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FTZ_exp_valid</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FTZ_exp_valid</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FTZ_double_round_plus_hyp</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FTZ</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FTZ</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">Double_round_plus_FTZ</span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id">Double_round_plus_beta_ge_3</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">double_round_plus_beta_ge_3_hyp</span> <span class="id">fexp1</span> <span class="id">fexp2</span> :=<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">ex</span> <span class="id">ey</span>, (<span class="id">fexp1</span> (<span class="id">ex</span> + 1) &lt;= <span class="id">ey</span>)%<span class="id">Z</span> -&gt; (<span class="id">fexp2</span> <span class="id">ex</span> &lt;= <span class="id">fexp1</span> <span class="id">ey</span>)%<span class="id">Z</span>)<br/>
&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">ex</span> <span class="id">ey</span>, (<span class="id">fexp1</span> (<span class="id">ex</span> - 1) + 1 &lt;= <span class="id">ey</span>)%<span class="id">Z</span> -&gt; (<span class="id">fexp2</span> <span class="id">ex</span> &lt;= <span class="id">fexp1</span> <span class="id">ey</span>)%<span class="id">Z</span>)<br/>
&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">ex</span> <span class="id">ey</span>, (<span class="id">fexp1</span> <span class="id">ex</span> &lt;= <span class="id">ey</span>)%<span class="id">Z</span> -&gt; (<span class="id">fexp2</span> <span class="id">ex</span> &lt;= <span class="id">fexp1</span> <span class="id">ey</span>)%<span class="id">Z</span>)<br/>
&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">ex</span> <span class="id">ey</span>, (<span class="id">ex</span> - 1 &lt;= <span class="id">ey</span>)%<span class="id">Z</span> -&gt; (<span class="id">fexp2</span> <span class="id">ex</span> &lt;= <span class="id">fexp1</span> <span class="id">ey</span>)%<span class="id">Z</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_plus_beta_ge_3_aux0</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>), <span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_plus_beta_ge_3_hyp</span> <span class="id">fexp1</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;(0 &lt; <span class="id">y</span>)%<span class="id">R</span> -&gt; (<span class="id">y</span> &lt;= <span class="id">x</span>)%<span class="id">R</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt;= <span class="id">ln_beta</span> <span class="id">y</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> -&gt; <span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp2</span> (<span class="id">x</span> + <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5471')">Proof.</div>
<div class="proofscript" id="proof5471">
<span class="tactic">intros</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Hexp</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Py</span> <span class="id">Hyx</span> <span class="id">Hln</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">assert</span> (<span class="id">Px</span> := <span class="id">Rlt_le_trans</span> 0 <span class="id">y</span> <span class="id">x</span> <span class="id">Py</span> <span class="id">Hyx</span>).<br/>
<span class="tactic">assert</span> (<span class="id">Nny</span> : (0 &lt;= <span class="id">y</span>)%<span class="id">R</span>); [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rlt_le</span>|].<br/>
<span class="tactic">destruct</span> <span class="id">Hexp</span> <span class="kwd">as</span> (<span class="id">_</span>,(<span class="id">Hexp2</span>,(<span class="id">Hexp3</span>,<span class="id">Hexp4</span>))).<br/>
<span class="tactic">destruct</span> (<span class="id">Z.le_gt_cases</span> (<span class="id">ln_beta</span> <span class="id">y</span>) (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))) <span class="kwd">as</span> [<span class="id">Hle</span>|<span class="id">Hgt</span>].<br/>
- <span class="comment">(*&nbsp;ln_beta&nbsp;y&nbsp;&lt;=&nbsp;fexp1&nbsp;(ln_beta&nbsp;x)&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Lxy</span> : <span class="id">ln_beta</span> (<span class="id">x</span> + <span class="id">y</span>) = <span class="id">ln_beta</span> <span class="id">x</span> :&gt; <span class="id">Z</span>);<br/>
&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> (<span class="id">ln_beta_plus_separated</span> <span class="id">fexp1</span>)|].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">double_round_plus_aux0_aux</span> <span class="id">fexp1</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[| |<span class="tactic">assumption</span>|<span class="tactic">assumption</span>]; <span class="tactic">rewrite</span> <span class="id">Lxy</span>.<br/>
&nbsp;&nbsp;+ <span class="id">now</span> <span class="tactic">apply</span> <span class="id">Hexp4</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;+ <span class="id">now</span> <span class="tactic">apply</span> <span class="id">Hexp3</span>; <span class="tactic">omega</span>.<br/>
- <span class="comment">(*&nbsp;fexp1&nbsp;(ln_beta&nbsp;x)&nbsp;&lt;&nbsp;ln_beta&nbsp;y&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">double_round_plus_aux0_aux</span> <span class="id">fexp1</span>); [| |<span class="tactic">assumption</span>|<span class="tactic">assumption</span>].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">ln_beta_plus_disj</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Py</span> <span class="id">Hyx</span>) <span class="kwd">as</span> [<span class="id">Lxy</span>|<span class="id">Lxy</span>]; <span class="tactic">rewrite</span> <span class="id">Lxy</span>.<br/>
&nbsp;&nbsp;+ <span class="id">now</span> <span class="tactic">apply</span> <span class="id">Hexp4</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">Hexp2</span>; <span class="tactic">apply</span> (<span class="id">ln_beta_le</span> <span class="id">beta</span> <span class="id">y</span> <span class="id">x</span> <span class="id">Py</span>) <span class="kwd">in</span> <span class="id">Hyx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">_</span> - <span class="id">_</span>)%<span class="id">Z</span> <span class="kwd">with</span> (<span class="id">ln_beta</span> <span class="id">x</span> : <span class="id">Z</span>) <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id">ln_beta_plus_disj</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Py</span> <span class="id">Hyx</span>) <span class="kwd">as</span> [<span class="id">Lxy</span>|<span class="id">Lxy</span>]; <span class="tactic">rewrite</span> <span class="id">Lxy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">now</span> <span class="tactic">apply</span> <span class="id">Hexp3</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">Hexp2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">_</span> - <span class="id">_</span>)%<span class="id">Z</span> <span class="kwd">with</span> (<span class="id">ln_beta</span> <span class="id">x</span> : <span class="id">Z</span>) <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_plus_beta_ge_3_aux1</span> :<br/>
&nbsp;&nbsp;(3 &lt;= <span class="id">beta</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>),<br/>
&nbsp;&nbsp;<span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt; <span class="id">Valid_exp</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">choice1</span> <span class="id">choice2</span> : <span class="id">Z</span> -&gt; <span class="id">bool</span>),<br/>
&nbsp;&nbsp;<span class="id">double_round_plus_beta_ge_3_hyp</span> <span class="id">fexp1</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;0 &lt; <span class="id">x</span> -&gt; 0 &lt; <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">ln_beta</span> <span class="id">y</span> &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - 1)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> (<span class="id">x</span> + <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5472')">Proof.</div>
<div class="proofscript" id="proof5472">
<span class="tactic">intros</span> <span class="id">Hbeta</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Vfexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hexp</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Px</span> <span class="id">Py</span> <span class="id">Hly</span> <span class="id">Fx</span>.<br/>
<span class="tactic">assert</span> (<span class="id">Lxy</span> : <span class="id">ln_beta</span> (<span class="id">x</span> + <span class="id">y</span>) = <span class="id">ln_beta</span> <span class="id">x</span> :&gt; <span class="id">Z</span>);<br/>
&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> (<span class="id">ln_beta_plus_separated</span> <span class="id">fexp1</span>); [|<span class="tactic">apply</span> <span class="id">Rlt_le</span>| |<span class="tactic">omega</span>]|].<br/>
<span class="tactic">destruct</span> <span class="id">Hexp</span> <span class="kwd">as</span> (<span class="id">_</span>,(<span class="id">_</span>,(<span class="id">_</span>,<span class="id">Hexp4</span>))).<br/>
<span class="tactic">assert</span> (<span class="id">Hf2</span> : (<span class="id">fexp2</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))%<span class="id">Z</span>);<br/>
&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Hexp4</span>; <span class="tactic">omega</span>|].<br/>
<span class="tactic">assert</span> (<span class="id">Bpow3</span> : <span class="id">bpow</span> (- 1) &lt;= / 3).<br/>
{ <span class="tactic">unfold</span> <span class="id">Fcore_Raux.bpow</span>, <span class="id">Z.pow_pos</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Zmult_1_r</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rinv_le</span>; [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="id">change</span> 3 <span class="kwd">with</span> (<span class="id">Z2R</span> 3); <span class="tactic">apply</span> <span class="id">Z2R_le</span>. }<br/>
<span class="tactic">assert</span> (<span class="id">P1</span> : (0 &lt; 1)%<span class="id">Z</span>) <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
<span class="tactic">unfold</span> <span class="id">double_round_eq</span>.<br/>
<span class="tactic">apply</span> <span class="id">double_round_lt_mid</span>.<br/>
- <span class="tactic">exact</span> <span class="id">Vfexp1</span>.<br/>
- <span class="tactic">exact</span> <span class="id">Vfexp2</span>.<br/>
- <span class="id">lra</span>.<br/>
- <span class="id">now</span> <span class="tactic">rewrite</span> <span class="id">Lxy</span>.<br/>
- <span class="tactic">rewrite</span> <span class="id">Lxy</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt; <span class="id">ln_beta</span> <span class="id">x</span>)%<span class="id">Z</span>; [|<span class="tactic">omega</span>].<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_generic_gt</span>; [|<span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>|].<br/>
- <span class="tactic">unfold</span> <span class="id">midp</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rplus_lt_reg_r</span> (- <span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zfloor</span> (<span class="id">x</span> + <span class="id">y</span>))).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rlt_le_trans</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">proj2</span> (<span class="id">double_round_plus_aux1_aux</span> 1 <span class="id">P1</span> <span class="id">fexp1</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Px</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Py</span> <span class="id">Hly</span> <span class="id">Lxy</span> <span class="id">Fx</span>))).<br/>
&nbsp;&nbsp;<span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">ulp_neq_0</span>;[<span class="id">idtac</span>|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>, <span class="id">Rplus_lt_0_compat</span>].<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">canonic_exp</span>; <span class="tactic">rewrite</span> <span class="id">Lxy</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_le_reg_r</span> (<span class="id">bpow</span> (- <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;<span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rle_trans</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Bpow3</span>); <span class="id">lra</span>.<br/>
- <span class="tactic">rewrite</span> <span class="id">ulp_neq_0</span>;[<span class="id">idtac</span>|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>, <span class="id">Rplus_lt_0_compat</span>].<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">round</span>, <span class="id">F2R</span>, <span class="id">scaled_mantissa</span>, <span class="id">canonic_exp</span>; <span class="tactic">simpl</span>; <span class="tactic">rewrite</span> <span class="id">Lxy</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hf2</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">midp</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rplus_lt_reg_r</span> (- <span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zfloor</span> (<span class="id">x</span> + <span class="id">y</span>))); <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Rmult_minus_distr_l</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rlt_le_trans</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">proj2</span> (<span class="id">double_round_plus_aux1_aux</span> 1 <span class="id">P1</span> <span class="id">fexp1</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Px</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Py</span> <span class="id">Hly</span> <span class="id">Lxy</span> <span class="id">Fx</span>))).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">ulp_neq_0</span>;[<span class="id">idtac</span>|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>, <span class="id">Rplus_lt_0_compat</span>].<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">canonic_exp</span>; <span class="tactic">rewrite</span> <span class="id">Lxy</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_le_reg_r</span> (<span class="id">bpow</span> (- <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Rmult_assoc</span> (/ 2)).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_minus_distr_r</span>.<br/>
&nbsp;&nbsp;<span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rle_trans</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Bpow3</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rle_trans</span> <span class="kwd">with</span> (/ 2 * (2 / 3)); [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rmult_le_compat_l</span>; [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rplus_le_reg_r</span> (- 1)); <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">_</span> - <span class="id">_</span>) <span class="kwd">with</span> (- (/ 3)) <span class="tactic">by</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Ropp_le_contravar</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rle_trans</span> <span class="kwd">with</span> (<span class="id">bpow</span> (- 1)); [<span class="tactic">apply</span> <span class="id">bpow_le</span>; <span class="tactic">omega</span>|].<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_plus_beta_ge_3_aux2</span> :<br/>
&nbsp;&nbsp;(3 &lt;= <span class="id">beta</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>),<br/>
&nbsp;&nbsp;<span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt; <span class="id">Valid_exp</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">choice1</span> <span class="id">choice2</span> : <span class="id">Z</span> -&gt; <span class="id">bool</span>),<br/>
&nbsp;&nbsp;<span class="id">double_round_plus_beta_ge_3_hyp</span> <span class="id">fexp1</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;0 &lt; <span class="id">y</span> -&gt; <span class="id">y</span> &lt;= <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> (<span class="id">x</span> + <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5473')">Proof.</div>
<div class="proofscript" id="proof5473">
<span class="tactic">intros</span> <span class="id">Hbeta</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Vfexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hexp</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Py</span> <span class="id">Hyx</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">assert</span> (<span class="id">Px</span> := <span class="id">Rlt_le_trans</span> 0 <span class="id">y</span> <span class="id">x</span> <span class="id">Py</span> <span class="id">Hyx</span>).<br/>
<span class="tactic">unfold</span> <span class="id">double_round_eq</span>.<br/>
<span class="tactic">destruct</span> (<span class="id">Zle_or_lt</span> (<span class="id">ln_beta</span> <span class="id">y</span>) (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - 1)) <span class="kwd">as</span> [<span class="id">Hly</span>|<span class="id">Hly</span>].<br/>
- <span class="comment">(*&nbsp;ln_beta&nbsp;y&nbsp;&lt;=&nbsp;fexp1&nbsp;(ln_beta&nbsp;x)&nbsp;-&nbsp;1&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">double_round_plus_beta_ge_3_aux1</span>.<br/>
- <span class="comment">(*&nbsp;fexp1&nbsp;(ln_beta&nbsp;x)&nbsp;-&nbsp;1&nbsp;&lt;&nbsp;ln_beta&nbsp;y&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">round_generic</span> <span class="id">beta</span> <span class="id">fexp2</span>).<br/>
&nbsp;&nbsp;+ <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;+ <span class="id">now</span> <span class="tactic">apply</span> <span class="id">valid_rnd_N</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">assert</span> (<span class="id">Hf1</span> : (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt;= <span class="id">ln_beta</span> <span class="id">y</span>)%<span class="id">Z</span>); [<span class="tactic">omega</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> (<span class="id">double_round_plus_beta_ge_3_aux0</span> <span class="id">fexp1</span>).<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_plus_beta_ge_3_aux</span> :<br/>
&nbsp;&nbsp;(3 &lt;= <span class="id">beta</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>),<br/>
&nbsp;&nbsp;<span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt; <span class="id">Valid_exp</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">choice1</span> <span class="id">choice2</span> : <span class="id">Z</span> -&gt; <span class="id">bool</span>),<br/>
&nbsp;&nbsp;<span class="id">double_round_plus_beta_ge_3_hyp</span> <span class="id">fexp1</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;0 &lt;= <span class="id">x</span> -&gt; 0 &lt;= <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> (<span class="id">x</span> + <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5474')">Proof.</div>
<div class="proofscript" id="proof5474">
<span class="tactic">intros</span> <span class="id">Hbeta</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Vfexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hexp</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Nnx</span> <span class="id">Nny</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">unfold</span> <span class="id">double_round_eq</span>.<br/>
<span class="tactic">destruct</span> (<span class="id">Req_dec</span> <span class="id">x</span> 0) <span class="kwd">as</span> [<span class="id">Zx</span>|<span class="id">Nzx</span>].<br/>
- <span class="comment">(*&nbsp;x&nbsp;=&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hexp</span> <span class="kwd">as</span> (<span class="id">_</span>,(<span class="id">_</span>,(<span class="id">_</span>,<span class="id">Hexp4</span>))).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Zx</span>; <span class="tactic">rewrite</span> <span class="id">Rplus_0_l</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">round_generic</span> <span class="id">beta</span> <span class="id">fexp2</span>).<br/>
&nbsp;&nbsp;+ <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;+ <span class="id">now</span> <span class="tactic">apply</span> <span class="id">valid_rnd_N</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">apply</span> (<span class="id">generic_inclusion_ln_beta</span> <span class="id">beta</span> <span class="id">fexp1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">intros</span> <span class="id">_</span>; <span class="tactic">apply</span> <span class="id">Hexp4</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">Fy</span>.<br/>
- <span class="comment">(*&nbsp;x&nbsp;&lt;&gt;&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Req_dec</span> <span class="id">y</span> 0) <span class="kwd">as</span> [<span class="id">Zy</span>|<span class="id">Nzy</span>].<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;y&nbsp;=&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hexp</span> <span class="kwd">as</span> (<span class="id">_</span>,(<span class="id">_</span>,(<span class="id">_</span>,<span class="id">Hexp4</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Zy</span>; <span class="tactic">rewrite</span> <span class="id">Rplus_0_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">round_generic</span> <span class="id">beta</span> <span class="id">fexp2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">now</span> <span class="tactic">apply</span> <span class="id">valid_rnd_N</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> (<span class="id">generic_inclusion_ln_beta</span> <span class="id">beta</span> <span class="id">fexp1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">intros</span> <span class="id">_</span>; <span class="tactic">apply</span> <span class="id">Hexp4</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">Fx</span>.<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;y&nbsp;&lt;&gt;&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Px</span> : 0 &lt; <span class="id">x</span>); [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Py</span> : 0 &lt; <span class="id">y</span>); [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Rlt_or_le</span> <span class="id">x</span> <span class="id">y</span>) <span class="kwd">as</span> [<span class="id">H</span>|<span class="id">H</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;x&nbsp;&lt;&nbsp;y&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rlt_le</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rplus_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">double_round_plus_beta_ge_3_aux2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">now</span> <span class="tactic">apply</span> <span class="id">double_round_plus_beta_ge_3_aux2</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_minus_beta_ge_3_aux0</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>),<br/>
&nbsp;&nbsp;<span class="id">double_round_plus_beta_ge_3_hyp</span> <span class="id">fexp1</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;0 &lt; <span class="id">y</span> -&gt; <span class="id">y</span> &lt; <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt;= <span class="id">ln_beta</span> <span class="id">y</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> -&gt; <span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp2</span> (<span class="id">x</span> - <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5475')">Proof.</div>
<div class="proofscript" id="proof5475">
<span class="tactic">intros</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Hexp</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Py</span> <span class="id">Hyx</span> <span class="id">Hln</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">assert</span> (<span class="id">Px</span> := <span class="id">Rlt_trans</span> 0 <span class="id">y</span> <span class="id">x</span> <span class="id">Py</span> <span class="id">Hyx</span>).<br/>
<span class="tactic">destruct</span> <span class="id">Hexp</span> <span class="kwd">as</span> (<span class="id">Hexp1</span>,(<span class="id">_</span>,(<span class="id">Hexp3</span>,<span class="id">Hexp4</span>))).<br/>
<span class="tactic">assert</span> (<span class="id">Lyx</span> : (<span class="id">ln_beta</span> <span class="id">y</span> &lt;= <span class="id">ln_beta</span> <span class="id">x</span>)%<span class="id">Z</span>);<br/>
&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_le</span>; [|<span class="tactic">apply</span> <span class="id">Rlt_le</span>]|].<br/>
<span class="tactic">destruct</span> (<span class="id">Z.lt_ge_cases</span> (<span class="id">ln_beta</span> <span class="id">x</span> - 2) (<span class="id">ln_beta</span> <span class="id">y</span>)) <span class="kwd">as</span> [<span class="id">Hlt</span>|<span class="id">Hge</span>].<br/>
- <span class="comment">(*&nbsp;ln_beta&nbsp;x&nbsp;-&nbsp;2&nbsp;&lt;&nbsp;ln_beta&nbsp;y&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hor</span> : (<span class="id">ln_beta</span> <span class="id">y</span> = <span class="id">ln_beta</span> <span class="id">x</span> :&gt; <span class="id">Z</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\/ (<span class="id">ln_beta</span> <span class="id">y</span> = <span class="id">ln_beta</span> <span class="id">x</span> - 1 :&gt; <span class="id">Z</span>)%<span class="id">Z</span>); [<span class="tactic">omega</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hor</span> <span class="kwd">as</span> [<span class="id">Heq</span>|<span class="id">Heqm1</span>].<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;ln_beta&nbsp;y&nbsp;=&nbsp;ln_beta&nbsp;x&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">double_round_minus_aux0_aux</span> <span class="id">fexp1</span>); [| |<span class="tactic">exact</span> <span class="id">Fx</span>|<span class="tactic">exact</span> <span class="id">Fy</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">Hexp4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Zle_trans</span> <span class="kwd">with</span> (<span class="id">ln_beta</span> (<span class="id">x</span> - <span class="id">y</span>)); [<span class="tactic">omega</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_minus</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hexp4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Zle_trans</span> <span class="kwd">with</span> (<span class="id">ln_beta</span> (<span class="id">x</span> - <span class="id">y</span>)); [<span class="tactic">omega</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_minus</span>.<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;ln_beta&nbsp;y&nbsp;=&nbsp;ln_beta&nbsp;x&nbsp;-&nbsp;1&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">double_round_minus_aux0_aux</span> <span class="id">fexp1</span>); [| |<span class="tactic">exact</span> <span class="id">Fx</span>|<span class="tactic">exact</span> <span class="id">Fy</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">Hexp4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Zle_trans</span> <span class="kwd">with</span> (<span class="id">ln_beta</span> (<span class="id">x</span> - <span class="id">y</span>)); [<span class="tactic">omega</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_minus</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id">Heqm1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hexp4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Zplus_le_compat_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_minus</span>.<br/>
- <span class="comment">(*&nbsp;ln_beta&nbsp;y&nbsp;&lt;=&nbsp;ln_beta&nbsp;x&nbsp;-&nbsp;2&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">ln_beta_minus_disj</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Px</span> <span class="id">Py</span> <span class="id">Hge</span>) <span class="kwd">as</span> [<span class="id">Lxmy</span>|<span class="id">Lxmy</span>].<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;ln_beta&nbsp;(x&nbsp;-&nbsp;y)&nbsp;=&nbsp;ln_beta&nbsp;x&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">double_round_minus_aux0_aux</span> <span class="id">fexp1</span>); [| |<span class="tactic">exact</span> <span class="id">Fx</span>|<span class="tactic">exact</span> <span class="id">Fy</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">Hexp4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">now</span> <span class="tactic">rewrite</span> <span class="id">Lxmy</span>; <span class="tactic">apply</span> <span class="id">Hexp3</span>.<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;ln_beta&nbsp;(x&nbsp;-&nbsp;y)&nbsp;=&nbsp;ln_beta&nbsp;x&nbsp;-&nbsp;1&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">double_round_minus_aux0_aux</span> <span class="id">fexp1</span>); [| |<span class="tactic">exact</span> <span class="id">Fx</span>|<span class="tactic">exact</span> <span class="id">Fy</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Lxmy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">Hexp1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">_</span> + <span class="id">_</span>)%<span class="id">Z</span> <span class="kwd">with</span> (<span class="id">ln_beta</span> <span class="id">x</span> : <span class="id">Z</span>); [|<span class="tactic">ring</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Zle_trans</span> <span class="kwd">with</span> (<span class="id">ln_beta</span> <span class="id">y</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">Hexp1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">replace</span> (<span class="id">_</span> + <span class="id">_</span>)%<span class="id">Z</span> <span class="kwd">with</span> (<span class="id">ln_beta</span> <span class="id">x</span> : <span class="id">Z</span>); [|<span class="tactic">ring</span>].<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_minus_beta_ge_3_aux1</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>),<br/>
&nbsp;&nbsp;<span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt; <span class="id">Valid_exp</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_plus_beta_ge_3_hyp</span> <span class="id">fexp1</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;0 &lt; <span class="id">y</span> -&gt; <span class="id">y</span> &lt; <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">ln_beta</span> <span class="id">y</span> &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - 1)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">x</span> - <span class="id">y</span>)) &lt;= <span class="id">ln_beta</span> <span class="id">y</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> -&gt; <span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp2</span> (<span class="id">x</span> - <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5476')">Proof.</div>
<div class="proofscript" id="proof5476">
<span class="tactic">intros</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Vfexp2</span>  <span class="id">Hexp</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Py</span> <span class="id">Hyx</span> <span class="id">Hln</span> <span class="id">Hln</span>' <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">assert</span> (<span class="id">Px</span> := <span class="id">Rlt_trans</span> 0 <span class="id">y</span> <span class="id">x</span> <span class="id">Py</span> <span class="id">Hyx</span>).<br/>
<span class="tactic">destruct</span> <span class="id">Hexp</span> <span class="kwd">as</span> (<span class="id">Hexp1</span>,(<span class="id">Hexp2</span>,(<span class="id">Hexp3</span>,<span class="id">Hexp4</span>))).<br/>
<span class="tactic">assert</span> (<span class="id">Lyx</span> : (<span class="id">ln_beta</span> <span class="id">y</span> &lt;= <span class="id">ln_beta</span> <span class="id">x</span>)%<span class="id">Z</span>);<br/>
&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_le</span>; [|<span class="tactic">apply</span> <span class="id">Rlt_le</span>]|].<br/>
<span class="tactic">assert</span> (<span class="id">Hfx</span> : (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt; <span class="id">ln_beta</span> <span class="id">x</span>)%<span class="id">Z</span>);<br/>
&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_generic_gt</span>; [|<span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>|]|].<br/>
<span class="tactic">assert</span> (<span class="id">Hfy</span> : (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">y</span>) &lt; <span class="id">ln_beta</span> <span class="id">y</span>)%<span class="id">Z</span>);<br/>
&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_generic_gt</span>; [|<span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>|]|].<br/>
<span class="tactic">apply</span> (<span class="id">double_round_minus_aux0_aux</span> <span class="id">fexp1</span>); [| |<span class="tactic">exact</span> <span class="id">Fx</span>|<span class="tactic">exact</span> <span class="id">Fy</span>].<br/>
- <span class="tactic">apply</span> <span class="id">Zle_trans</span> <span class="kwd">with</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">x</span> - <span class="id">y</span>))).<br/>
&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">Hexp4</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">omega</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">Hexp3</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_minus_beta_ge_3_aux2</span> :<br/>
&nbsp;&nbsp;(3 &lt;= <span class="id">beta</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>),<br/>
&nbsp;&nbsp;<span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt; <span class="id">Valid_exp</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">choice1</span> <span class="id">choice2</span> : <span class="id">Z</span> -&gt; <span class="id">bool</span>),<br/>
&nbsp;&nbsp;<span class="id">double_round_plus_beta_ge_3_hyp</span> <span class="id">fexp1</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;0 &lt; <span class="id">y</span> -&gt; <span class="id">y</span> &lt; <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">ln_beta</span> <span class="id">y</span> &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - 1)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">ln_beta</span> <span class="id">y</span> &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">x</span> - <span class="id">y</span>)) - 1)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> (<span class="id">x</span> - <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5477')">Proof.</div>
<div class="proofscript" id="proof5477">
<span class="tactic">intros</span> <span class="id">Hbeta</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Vfexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hexp</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Py</span> <span class="id">Hxy</span> <span class="id">Hly</span> <span class="id">Hly</span>' <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">assert</span> (<span class="id">Px</span> := <span class="id">Rlt_trans</span> 0 <span class="id">y</span> <span class="id">x</span> <span class="id">Py</span> <span class="id">Hxy</span>).<br/>
<span class="tactic">destruct</span> <span class="id">Hexp</span> <span class="kwd">as</span> (<span class="id">_</span>,(<span class="id">_</span>,(<span class="id">_</span>,<span class="id">Hexp4</span>))).<br/>
<span class="tactic">assert</span> (<span class="id">Hf2</span> : (<span class="id">fexp2</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))%<span class="id">Z</span>);<br/>
&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Hexp4</span>; <span class="tactic">omega</span>|].<br/>
<span class="tactic">assert</span> (<span class="id">Hfx</span> : (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt; <span class="id">ln_beta</span> <span class="id">x</span>)%<span class="id">Z</span>);<br/>
&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_generic_gt</span>; [|<span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>|]|].<br/>
<span class="tactic">assert</span> (<span class="id">Bpow3</span> : <span class="id">bpow</span> (- 1) &lt;= / 3).<br/>
{ <span class="tactic">unfold</span> <span class="id">Fcore_Raux.bpow</span>, <span class="id">Z.pow_pos</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Zmult_1_r</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rinv_le</span>; [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="id">change</span> 3 <span class="kwd">with</span> (<span class="id">Z2R</span> 3); <span class="tactic">apply</span> <span class="id">Z2R_le</span>. }<br/>
<span class="tactic">assert</span> (<span class="id">Ly</span> : <span class="id">y</span> &lt; <span class="id">bpow</span> (<span class="id">ln_beta</span> <span class="id">y</span>)).<br/>
{ <span class="tactic">apply</span> <span class="id">Rabs_lt_inv</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bpow_ln_beta_gt</span>. }<br/>
<span class="tactic">unfold</span> <span class="id">double_round_eq</span>.<br/>
<span class="tactic">apply</span> <span class="id">double_round_gt_mid</span>.<br/>
- <span class="tactic">exact</span> <span class="id">Vfexp1</span>.<br/>
- <span class="tactic">exact</span> <span class="id">Vfexp2</span>.<br/>
- <span class="id">lra</span>.<br/>
- <span class="tactic">apply</span> <span class="id">Hexp4</span>; <span class="tactic">omega</span>.<br/>
- <span class="tactic">assert</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">x</span> - <span class="id">y</span>)) &lt; <span class="id">ln_beta</span> (<span class="id">x</span> - <span class="id">y</span>))%<span class="id">Z</span>; [|<span class="tactic">omega</span>].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">valid_exp_large</span> <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span> - 1)).<br/>
&nbsp;&nbsp;+ <span class="tactic">apply</span> (<span class="id">valid_exp_large</span> <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">y</span>)); [|<span class="tactic">omega</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_generic_gt</span>; [|<span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>|].<br/>
&nbsp;&nbsp;+ <span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_minus_lb</span>; [| |<span class="tactic">omega</span>].<br/>
- <span class="tactic">unfold</span> <span class="id">midp</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rplus_lt_reg_r</span> (/ 2 * <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp1</span> (<span class="id">x</span> - <span class="id">y</span>) - (<span class="id">x</span> - <span class="id">y</span>))).<br/>
&nbsp;&nbsp;<span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">_</span> + <span class="id">_</span>) <span class="kwd">with</span> (<span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zceil</span> (<span class="id">x</span> - <span class="id">y</span>) - (<span class="id">x</span> - <span class="id">y</span>)) <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rlt_le_trans</span> <span class="kwd">with</span> (<span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">x</span> - <span class="id">y</span>)) - 1)).<br/>
&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">Rle_lt_trans</span> <span class="kwd">with</span> <span class="id">y</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">double_round_minus_aux2_aux</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rlt_le_trans</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Ly</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_le</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">ulp_neq_0</span>;[<span class="id">idtac</span>|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>, <span class="id">Rgt_minus</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">canonic_exp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Zminus</span> <span class="tactic">at</span> 1; <span class="tactic">rewrite</span> <span class="id">bpow_plus</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rmult_le_compat_r</span>; [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_ge_0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Fcore_Raux.bpow</span>, <span class="id">Z.pow_pos</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Zmult_1_r</span>; <span class="tactic">apply</span> <span class="id">Rinv_le</span>; [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">change</span> 2 <span class="kwd">with</span> (<span class="id">Z2R</span> 2); <span class="tactic">apply</span> <span class="id">Z2R_le</span>; <span class="tactic">omega</span>.<br/>
- <span class="tactic">intro</span> <span class="id">Hf2</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">midp</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rplus_lt_reg_r</span> (/ 2 * (<span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp1</span> (<span class="id">x</span> - <span class="id">y</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp2</span> (<span class="id">x</span> - <span class="id">y</span>)) - (<span class="id">x</span> - <span class="id">y</span>))).<br/>
&nbsp;&nbsp;<span class="id">ring_simplify</span>; <span class="tactic">rewrite</span> &lt;- <span class="id">Rmult_minus_distr_l</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">_</span> + <span class="id">_</span>) <span class="kwd">with</span> (<span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zceil</span> (<span class="id">x</span> - <span class="id">y</span>) - (<span class="id">x</span> - <span class="id">y</span>)) <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rle_lt_trans</span> <span class="kwd">with</span> <span class="id">y</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">double_round_minus_aux2_aux</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rlt_le_trans</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Ly</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rle_trans</span> <span class="kwd">with</span> (<span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">x</span> - <span class="id">y</span>)) - 1));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_le</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> 2!<span class="id">ulp_neq_0</span>; <span class="tactic">try</span> <span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>, <span class="id">Rgt_minus</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">canonic_exp</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_le_reg_r</span> (<span class="id">bpow</span> (- <span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">x</span> - <span class="id">y</span>)))));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_assoc</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_minus_distr_r</span>.<br/>
&nbsp;&nbsp;<span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rle_trans</span> <span class="kwd">with</span> (/ 3).<br/>
&nbsp;&nbsp;+ <span class="tactic">unfold</span> <span class="id">Fcore_Raux.bpow</span>, <span class="id">Z.pow_pos</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Zmult_1_r</span>; <span class="tactic">apply</span> <span class="id">Rinv_le</span>; [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">change</span> 3 <span class="kwd">with</span> (<span class="id">Z2R</span> 3); <span class="tactic">apply</span> <span class="id">Z2R_le</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">replace</span> (/ 3) <span class="kwd">with</span> (/ 2 * (2 / 3)) <span class="tactic">by</span> <span class="id">field</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rmult_le_compat_l</span>; [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rplus_le_reg_r</span> (- 1)); <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">_</span> - <span class="id">_</span>) <span class="kwd">with</span> (- / 3) <span class="tactic">by</span> <span class="id">field</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Ropp_le_contravar</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rle_trans</span> <span class="kwd">with</span> (<span class="id">bpow</span> (- 1)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">bpow_le</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">unfold</span> <span class="id">Fcore_Raux.bpow</span>, <span class="id">Z.pow_pos</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Zmult_1_r</span>; <span class="tactic">apply</span> <span class="id">Rinv_le</span>; [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">change</span> 3 <span class="kwd">with</span> (<span class="id">Z2R</span> 3); <span class="tactic">apply</span> <span class="id">Z2R_le</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_minus_beta_ge_3_aux3</span> :<br/>
&nbsp;&nbsp;(3 &lt;= <span class="id">beta</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>),<br/>
&nbsp;&nbsp;<span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt; <span class="id">Valid_exp</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">choice1</span> <span class="id">choice2</span> : <span class="id">Z</span> -&gt; <span class="id">bool</span>),<br/>
&nbsp;&nbsp;<span class="id">double_round_plus_beta_ge_3_hyp</span> <span class="id">fexp1</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;0 &lt; <span class="id">y</span> -&gt; <span class="id">y</span> &lt;= <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> (<span class="id">x</span> - <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5478')">Proof.</div>
<div class="proofscript" id="proof5478">
<span class="tactic">intros</span> <span class="id">Hbeta</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Vfexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hexp</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Py</span> <span class="id">Hyx</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">assert</span> (<span class="id">Px</span> := <span class="id">Rlt_le_trans</span> 0 <span class="id">y</span> <span class="id">x</span> <span class="id">Py</span> <span class="id">Hyx</span>).<br/>
<span class="tactic">unfold</span> <span class="id">double_round_eq</span>.<br/>
<span class="tactic">destruct</span> (<span class="id">Req_dec</span> <span class="id">y</span> <span class="id">x</span>) <span class="kwd">as</span> [<span class="id">Hy</span>|<span class="id">Hy</span>].<br/>
- <span class="comment">(*&nbsp;y&nbsp;=&nbsp;x&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hy</span>; <span class="tactic">replace</span> (<span class="id">x</span> - <span class="id">x</span>) <span class="kwd">with</span> 0 <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">round_0</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;+ <span class="id">now</span> <span class="tactic">apply</span> <span class="id">valid_rnd_N</span>.<br/>
- <span class="comment">(*&nbsp;y&nbsp;&lt;&nbsp;x&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hyx</span>' : <span class="id">y</span> &lt; <span class="id">x</span>); [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Zle_or_lt</span> (<span class="id">ln_beta</span> <span class="id">y</span>) (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - 1)) <span class="kwd">as</span> [<span class="id">Hly</span>|<span class="id">Hly</span>].<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;ln_beta&nbsp;y&nbsp;&lt;=&nbsp;fexp1&nbsp;(ln_beta&nbsp;x)&nbsp;-&nbsp;1&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Zle_or_lt</span> (<span class="id">ln_beta</span> <span class="id">y</span>) (<span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">x</span> - <span class="id">y</span>)) - 1))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> [<span class="id">Hly</span>'|<span class="id">Hly</span>'].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;ln_beta&nbsp;y&nbsp;&lt;=&nbsp;fexp1&nbsp;(ln_beta&nbsp;(x&nbsp;-&nbsp;y))&nbsp;-&nbsp;1&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">double_round_minus_beta_ge_3_aux2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;fexp1&nbsp;(ln_beta&nbsp;(x&nbsp;-&nbsp;y))&nbsp;-&nbsp;1&nbsp;&lt;&nbsp;ln_beta&nbsp;y&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> (<span class="id">round_generic</span> <span class="id">beta</span> <span class="id">fexp2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">valid_rnd_N</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">assert</span> (<span class="id">Hf1</span> : (<span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">x</span> - <span class="id">y</span>)) &lt;= <span class="id">ln_beta</span> <span class="id">y</span>)%<span class="id">Z</span>); [<span class="tactic">omega</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> (<span class="id">double_round_minus_beta_ge_3_aux1</span> <span class="id">fexp1</span>). }<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> (<span class="id">round_generic</span> <span class="id">beta</span> <span class="id">fexp2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">now</span> <span class="tactic">apply</span> <span class="id">valid_rnd_N</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">assert</span> (<span class="id">Hf1</span> : (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt;= <span class="id">ln_beta</span> <span class="id">y</span>)%<span class="id">Z</span>); [<span class="tactic">omega</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> (<span class="id">double_round_minus_beta_ge_3_aux0</span> <span class="id">fexp1</span>).<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_minus_beta_ge_3_aux</span> :<br/>
&nbsp;&nbsp;(3 &lt;= <span class="id">beta</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>),<br/>
&nbsp;&nbsp;<span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt; <span class="id">Valid_exp</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">choice1</span> <span class="id">choice2</span> : <span class="id">Z</span> -&gt; <span class="id">bool</span>),<br/>
&nbsp;&nbsp;<span class="id">double_round_plus_beta_ge_3_hyp</span> <span class="id">fexp1</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;0 &lt;= <span class="id">x</span> -&gt; 0 &lt;= <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> (<span class="id">x</span> - <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5479')">Proof.</div>
<div class="proofscript" id="proof5479">
<span class="tactic">intros</span> <span class="id">Hbeta</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Vfexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hexp</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Nnx</span> <span class="id">Nny</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">unfold</span> <span class="id">double_round_eq</span>.<br/>
<span class="tactic">destruct</span> (<span class="id">Req_dec</span> <span class="id">x</span> 0) <span class="kwd">as</span> [<span class="id">Zx</span>|<span class="id">Nzx</span>].<br/>
- <span class="comment">(*&nbsp;x&nbsp;=&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Zx</span>; <span class="tactic">unfold</span> <span class="id">Rminus</span>; <span class="tactic">rewrite</span> <span class="id">Rplus_0_l</span>.<br/>
&nbsp;&nbsp;<span class="tactic">do</span> 3 <span class="tactic">rewrite</span> <span class="id">round_N_opp</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">round_generic</span> <span class="id">beta</span> <span class="id">fexp2</span>).<br/>
&nbsp;&nbsp;* <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;* <span class="id">now</span> <span class="tactic">apply</span> <span class="id">valid_rnd_N</span>.<br/>
&nbsp;&nbsp;* <span class="tactic">apply</span> (<span class="id">generic_inclusion_ln_beta</span> <span class="id">beta</span> <span class="id">fexp1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hexp</span> <span class="kwd">as</span> (<span class="id">_</span>,(<span class="id">_</span>,(<span class="id">_</span>,<span class="id">Hexp4</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">intros</span> <span class="id">_</span>; <span class="tactic">apply</span> <span class="id">Hexp4</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">Fy</span>.<br/>
- <span class="comment">(*&nbsp;x&nbsp;&lt;&gt;&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Req_dec</span> <span class="id">y</span> 0) <span class="kwd">as</span> [<span class="id">Zy</span>|<span class="id">Nzy</span>].<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;y&nbsp;=&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Zy</span>; <span class="tactic">unfold</span> <span class="id">Rminus</span>; <span class="tactic">rewrite</span> <span class="id">Ropp_0</span>; <span class="tactic">rewrite</span> <span class="id">Rplus_0_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">round_generic</span> <span class="id">beta</span> <span class="id">fexp2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">now</span> <span class="tactic">apply</span> <span class="id">valid_rnd_N</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> (<span class="id">generic_inclusion_ln_beta</span> <span class="id">beta</span> <span class="id">fexp1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hexp</span> <span class="kwd">as</span> (<span class="id">_</span>,(<span class="id">_</span>,(<span class="id">_</span>,<span class="id">Hexp4</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">intros</span> <span class="id">_</span>; <span class="tactic">apply</span> <span class="id">Hexp4</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">Fx</span>.<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;y&nbsp;&lt;&gt;&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Px</span> : 0 &lt; <span class="id">x</span>); [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Py</span> : 0 &lt; <span class="id">y</span>); [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Rlt_or_le</span> <span class="id">x</span> <span class="id">y</span>) <span class="kwd">as</span> [<span class="id">H</span>|<span class="id">H</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;x&nbsp;&lt;&nbsp;y&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rlt_le</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">x</span> - <span class="id">y</span>) <span class="kwd">with</span> (- (<span class="id">y</span> - <span class="id">x</span>)) <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 <span class="tactic">rewrite</span> <span class="id">round_N_opp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Ropp_eq_compat</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">double_round_minus_beta_ge_3_aux3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;y&nbsp;&lt;=&nbsp;x&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">double_round_minus_beta_ge_3_aux3</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_plus_beta_ge_3</span> :<br/>
&nbsp;&nbsp;(3 &lt;= <span class="id">beta</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>),<br/>
&nbsp;&nbsp;<span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt; <span class="id">Valid_exp</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">choice1</span> <span class="id">choice2</span> : <span class="id">Z</span> -&gt; <span class="id">bool</span>),<br/>
&nbsp;&nbsp;<span class="id">double_round_plus_beta_ge_3_hyp</span> <span class="id">fexp1</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> (<span class="id">x</span> + <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5480')">Proof.</div>
<div class="proofscript" id="proof5480">
<span class="tactic">intros</span> <span class="id">Hbeta</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Vfexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hexp</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">unfold</span> <span class="id">double_round_eq</span>.<br/>
<span class="tactic">destruct</span> (<span class="id">Rlt_or_le</span> <span class="id">x</span> 0) <span class="kwd">as</span> [<span class="id">Sx</span>|<span class="id">Sx</span>]; <span class="tactic">destruct</span> (<span class="id">Rlt_or_le</span> <span class="id">y</span> 0) <span class="kwd">as</span> [<span class="id">Sy</span>|<span class="id">Sy</span>].<br/>
- <span class="comment">(*&nbsp;x&nbsp;&lt;&nbsp;0,&nbsp;y&nbsp;&lt;&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">x</span> + <span class="id">y</span>) <span class="kwd">with</span> (- (- <span class="id">x</span> - <span class="id">y</span>)); [|<span class="tactic">ring</span>].<br/>
&nbsp;&nbsp;<span class="tactic">do</span> 3 <span class="tactic">rewrite</span> <span class="id">round_N_opp</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Ropp_eq_compat</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Px</span> : 0 &lt;= - <span class="id">x</span>); [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Py</span> : 0 &lt;= - <span class="id">y</span>); [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">generic_format_opp</span> <span class="kwd">in</span> <span class="id">Fx</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">generic_format_opp</span> <span class="kwd">in</span> <span class="id">Fy</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">double_round_plus_beta_ge_3_aux</span>.<br/>
- <span class="comment">(*&nbsp;x&nbsp;&lt;&nbsp;0,&nbsp;0&nbsp;&lt;=&nbsp;y&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">x</span> + <span class="id">y</span>) <span class="kwd">with</span> (<span class="id">y</span> - (- <span class="id">x</span>)); [|<span class="tactic">ring</span>].<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Px</span> : 0 &lt;= - <span class="id">x</span>); [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">generic_format_opp</span> <span class="kwd">in</span> <span class="id">Fx</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">double_round_minus_beta_ge_3_aux</span>.<br/>
- <span class="comment">(*&nbsp;0&nbsp;&lt;=&nbsp;x,&nbsp;y&nbsp;&lt;&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">x</span> + <span class="id">y</span>) <span class="kwd">with</span> (<span class="id">x</span> - (- <span class="id">y</span>)); [|<span class="tactic">ring</span>].<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Py</span> : 0 &lt;= - <span class="id">y</span>); [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">generic_format_opp</span> <span class="kwd">in</span> <span class="id">Fy</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">double_round_minus_beta_ge_3_aux</span>.<br/>
- <span class="comment">(*&nbsp;0&nbsp;&lt;=&nbsp;x,&nbsp;0&nbsp;&lt;=&nbsp;y&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">double_round_plus_beta_ge_3_aux</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_minus_beta_ge_3</span> :<br/>
&nbsp;&nbsp;(3 &lt;= <span class="id">beta</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>),<br/>
&nbsp;&nbsp;<span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt; <span class="id">Valid_exp</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">choice1</span> <span class="id">choice2</span> : <span class="id">Z</span> -&gt; <span class="id">bool</span>),<br/>
&nbsp;&nbsp;<span class="id">double_round_plus_beta_ge_3_hyp</span> <span class="id">fexp1</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> (<span class="id">x</span> - <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5481')">Proof.</div>
<div class="proofscript" id="proof5481">
<span class="tactic">intros</span> <span class="id">Hbeta</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Vfexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hexp</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">unfold</span> <span class="id">Rminus</span>.<br/>
<span class="tactic">apply</span> <span class="id">generic_format_opp</span> <span class="kwd">in</span> <span class="id">Fy</span>.<br/>
<span class="id">now</span> <span class="tactic">apply</span> <span class="id">double_round_plus_beta_ge_3</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Section</span> <span class="id">Double_round_plus_beta_ge_3_FLX</span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Fcore_FLX</span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id">prec</span> : <span class="id">Z</span>.<br/>
<span class="kwd">Variable</span> <span class="id">prec</span>' : <span class="id">Z</span>.<br/>
<br/>
<span class="kwd">Context</span> { <span class="id">prec_gt_0_</span> : <span class="id">Prec_gt_0</span> <span class="id">prec</span> }.<br/>
<span class="kwd">Context</span> { <span class="id">prec_gt_0_</span>' : <span class="id">Prec_gt_0</span> <span class="id">prec</span>' }.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">FLX_double_round_plus_beta_ge_3_hyp</span> :<br/>
&nbsp;&nbsp;(2 * <span class="id">prec</span> &lt;= <span class="id">prec</span>')%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_plus_beta_ge_3_hyp</span> (<span class="id">FLX_exp</span> <span class="id">prec</span>) (<span class="id">FLX_exp</span> <span class="id">prec</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5482')">Proof.</div>
<div class="proofscript" id="proof5482">
<span class="tactic">intros</span> <span class="id">Hprec</span>.<br/>
<span class="tactic">unfold</span> <span class="id">FLX_exp</span>.<br/>
<span class="tactic">unfold</span> <span class="id">double_round_plus_beta_ge_3_hyp</span>; <span class="tactic">split</span>; [|<span class="tactic">split</span>; [|<span class="tactic">split</span>]];<br/>
<span class="tactic">intros</span> <span class="id">ex</span> <span class="id">ey</span>; <span class="tactic">try</span> <span class="tactic">omega</span>.<br/>
<span class="tactic">unfold</span> <span class="id">Prec_gt_0</span> <span class="kwd">in</span> <span class="id">prec_gt_0_</span>.<br/>
<span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id">double_round_plus_beta_ge_3_FLX</span> :<br/>
&nbsp;&nbsp;(3 &lt;= <span class="id">beta</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">choice1</span> <span class="id">choice2</span>,<br/>
&nbsp;&nbsp;(2 * <span class="id">prec</span> &lt;= <span class="id">prec</span>')%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;<span class="id">FLX_format</span> <span class="id">beta</span> <span class="id">prec</span> <span class="id">x</span> -&gt; <span class="id">FLX_format</span> <span class="id">beta</span> <span class="id">prec</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> (<span class="id">FLX_exp</span> <span class="id">prec</span>) (<span class="id">FLX_exp</span> <span class="id">prec</span>') <span class="id">choice1</span> <span class="id">choice2</span> (<span class="id">x</span> + <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5483')">Proof.</div>
<div class="proofscript" id="proof5483">
<span class="tactic">intros</span> <span class="id">Hbeta</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hprec</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">apply</span> <span class="id">double_round_plus_beta_ge_3</span>.<br/>
- <span class="tactic">exact</span> <span class="id">Hbeta</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLX_exp_valid</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLX_exp_valid</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLX_double_round_plus_beta_ge_3_hyp</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FLX</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FLX</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id">double_round_minus_beta_ge_3_FLX</span> :<br/>
&nbsp;&nbsp;(3 &lt;= <span class="id">beta</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">choice1</span> <span class="id">choice2</span>,<br/>
&nbsp;&nbsp;(2 * <span class="id">prec</span> &lt;= <span class="id">prec</span>')%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;<span class="id">FLX_format</span> <span class="id">beta</span> <span class="id">prec</span> <span class="id">x</span> -&gt; <span class="id">FLX_format</span> <span class="id">beta</span> <span class="id">prec</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> (<span class="id">FLX_exp</span> <span class="id">prec</span>) (<span class="id">FLX_exp</span> <span class="id">prec</span>') <span class="id">choice1</span> <span class="id">choice2</span> (<span class="id">x</span> - <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5484')">Proof.</div>
<div class="proofscript" id="proof5484">
<span class="tactic">intros</span> <span class="id">Hbeta</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hprec</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">apply</span> <span class="id">double_round_minus_beta_ge_3</span>.<br/>
- <span class="tactic">exact</span> <span class="id">Hbeta</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLX_exp_valid</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLX_exp_valid</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLX_double_round_plus_beta_ge_3_hyp</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FLX</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FLX</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">Double_round_plus_beta_ge_3_FLX</span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id">Double_round_plus_beta_ge_3_FLT</span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Fcore_FLX</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Fcore_FLT</span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id">emin</span> <span class="id">prec</span> : <span class="id">Z</span>.<br/>
<span class="kwd">Variable</span> <span class="id">emin</span>' <span class="id">prec</span>' : <span class="id">Z</span>.<br/>
<br/>
<span class="kwd">Context</span> { <span class="id">prec_gt_0_</span> : <span class="id">Prec_gt_0</span> <span class="id">prec</span> }.<br/>
<span class="kwd">Context</span> { <span class="id">prec_gt_0_</span>' : <span class="id">Prec_gt_0</span> <span class="id">prec</span>' }.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">FLT_double_round_plus_beta_ge_3_hyp</span> :<br/>
&nbsp;&nbsp;(<span class="id">emin</span>' &lt;= <span class="id">emin</span>)%<span class="id">Z</span> -&gt; (2 * <span class="id">prec</span> &lt;= <span class="id">prec</span>')%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_plus_beta_ge_3_hyp</span> (<span class="id">FLT_exp</span> <span class="id">emin</span> <span class="id">prec</span>) (<span class="id">FLT_exp</span> <span class="id">emin</span>' <span class="id">prec</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5485')">Proof.</div>
<div class="proofscript" id="proof5485">
<span class="tactic">intros</span> <span class="id">Hemin</span> <span class="id">Hprec</span>.<br/>
<span class="tactic">unfold</span> <span class="id">FLT_exp</span>.<br/>
<span class="tactic">unfold</span> <span class="id">double_round_plus_beta_ge_3_hyp</span>; <span class="tactic">split</span>; [|<span class="tactic">split</span>; [|<span class="tactic">split</span>]]; <span class="tactic">intros</span> <span class="id">ex</span> <span class="id">ey</span>.<br/>
- <span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ex</span> + 1 - <span class="id">prec</span>) <span class="id">emin</span>).<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>') <span class="id">emin</span>').<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ey</span> - <span class="id">prec</span>) <span class="id">emin</span>).<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
- <span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ex</span> - 1 - <span class="id">prec</span>) <span class="id">emin</span>).<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>') <span class="id">emin</span>').<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ey</span> - <span class="id">prec</span>) <span class="id">emin</span>).<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
- <span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>) <span class="id">emin</span>).<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>') <span class="id">emin</span>').<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ey</span> - <span class="id">prec</span>) <span class="id">emin</span>).<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
- <span class="tactic">unfold</span> <span class="id">Prec_gt_0</span> <span class="kwd">in</span> <span class="id">prec_gt_0_</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>') <span class="id">emin</span>').<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ey</span> - <span class="id">prec</span>) <span class="id">emin</span>).<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id">double_round_plus_beta_ge_3_FLT</span> :<br/>
&nbsp;&nbsp;(3 &lt;= <span class="id">beta</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">choice1</span> <span class="id">choice2</span>,<br/>
&nbsp;&nbsp;(<span class="id">emin</span>' &lt;= <span class="id">emin</span>)%<span class="id">Z</span> -&gt; (2 * <span class="id">prec</span> &lt;= <span class="id">prec</span>')%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;<span class="id">FLT_format</span> <span class="id">beta</span> <span class="id">emin</span> <span class="id">prec</span> <span class="id">x</span> -&gt; <span class="id">FLT_format</span> <span class="id">beta</span> <span class="id">emin</span> <span class="id">prec</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> (<span class="id">FLT_exp</span> <span class="id">emin</span> <span class="id">prec</span>) (<span class="id">FLT_exp</span> <span class="id">emin</span>' <span class="id">prec</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">choice1</span> <span class="id">choice2</span> (<span class="id">x</span> + <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5486')">Proof.</div>
<div class="proofscript" id="proof5486">
<span class="tactic">intros</span> <span class="id">Hbeta</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hemin</span> <span class="id">Hprec</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">apply</span> <span class="id">double_round_plus_beta_ge_3</span>.<br/>
- <span class="tactic">exact</span> <span class="id">Hbeta</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLT_exp_valid</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLT_exp_valid</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLT_double_round_plus_beta_ge_3_hyp</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FLT</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FLT</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id">double_round_minus_beta_ge_3_FLT</span> :<br/>
&nbsp;&nbsp;(3 &lt;= <span class="id">beta</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">choice1</span> <span class="id">choice2</span>,<br/>
&nbsp;&nbsp;(<span class="id">emin</span>' &lt;= <span class="id">emin</span>)%<span class="id">Z</span> -&gt; (2 * <span class="id">prec</span> &lt;= <span class="id">prec</span>')%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;<span class="id">FLT_format</span> <span class="id">beta</span> <span class="id">emin</span> <span class="id">prec</span> <span class="id">x</span> -&gt; <span class="id">FLT_format</span> <span class="id">beta</span> <span class="id">emin</span> <span class="id">prec</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> (<span class="id">FLT_exp</span> <span class="id">emin</span> <span class="id">prec</span>) (<span class="id">FLT_exp</span> <span class="id">emin</span>' <span class="id">prec</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">choice1</span> <span class="id">choice2</span> (<span class="id">x</span> - <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5487')">Proof.</div>
<div class="proofscript" id="proof5487">
<span class="tactic">intros</span> <span class="id">Hbeta</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hemin</span> <span class="id">Hprec</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">apply</span> <span class="id">double_round_minus_beta_ge_3</span>.<br/>
- <span class="tactic">exact</span> <span class="id">Hbeta</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLT_exp_valid</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLT_exp_valid</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLT_double_round_plus_beta_ge_3_hyp</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FLT</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FLT</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">Double_round_plus_beta_ge_3_FLT</span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id">Double_round_plus_beta_ge_3_FTZ</span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Fcore_FLX</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Fcore_FTZ</span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id">emin</span> <span class="id">prec</span> : <span class="id">Z</span>.<br/>
<span class="kwd">Variable</span> <span class="id">emin</span>' <span class="id">prec</span>' : <span class="id">Z</span>.<br/>
<br/>
<span class="kwd">Context</span> { <span class="id">prec_gt_0_</span> : <span class="id">Prec_gt_0</span> <span class="id">prec</span> }.<br/>
<span class="kwd">Context</span> { <span class="id">prec_gt_0_</span>' : <span class="id">Prec_gt_0</span> <span class="id">prec</span>' }.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">FTZ_double_round_plus_beta_ge_3_hyp</span> :<br/>
&nbsp;&nbsp;(<span class="id">emin</span>' + <span class="id">prec</span>' &lt;= <span class="id">emin</span> + 1)%<span class="id">Z</span> -&gt; (2 * <span class="id">prec</span> &lt;= <span class="id">prec</span>')%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_plus_beta_ge_3_hyp</span> (<span class="id">FTZ_exp</span> <span class="id">emin</span> <span class="id">prec</span>) (<span class="id">FTZ_exp</span> <span class="id">emin</span>' <span class="id">prec</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5488')">Proof.</div>
<div class="proofscript" id="proof5488">
<span class="tactic">intros</span> <span class="id">Hemin</span> <span class="id">Hprec</span>.<br/>
<span class="tactic">unfold</span> <span class="id">FTZ_exp</span>.<br/>
<span class="tactic">unfold</span> <span class="id">Prec_gt_0</span> <span class="kwd">in</span> *.<br/>
<span class="tactic">unfold</span> <span class="id">double_round_plus_beta_ge_3_hyp</span>; <span class="tactic">split</span>; [|<span class="tactic">split</span>; [|<span class="tactic">split</span>]]; <span class="tactic">intros</span> <span class="id">ex</span> <span class="id">ey</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ex</span> + 1 - <span class="id">prec</span>) <span class="id">emin</span>);<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>') <span class="id">emin</span>');<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ey</span> - <span class="id">prec</span>) <span class="id">emin</span>);<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ex</span> - 1 - <span class="id">prec</span>) <span class="id">emin</span>);<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>') <span class="id">emin</span>');<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ey</span> - <span class="id">prec</span>) <span class="id">emin</span>);<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>) <span class="id">emin</span>);<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>') <span class="id">emin</span>');<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ey</span> - <span class="id">prec</span>) <span class="id">emin</span>);<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>') <span class="id">emin</span>');<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ey</span> - <span class="id">prec</span>) <span class="id">emin</span>);<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id">double_round_plus_beta_ge_3_FTZ</span> :<br/>
&nbsp;&nbsp;(3 &lt;= <span class="id">beta</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">choice1</span> <span class="id">choice2</span>,<br/>
&nbsp;&nbsp;(<span class="id">emin</span>' + <span class="id">prec</span>' &lt;= <span class="id">emin</span> + 1)%<span class="id">Z</span> -&gt; (2 * <span class="id">prec</span> &lt;= <span class="id">prec</span>')%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;<span class="id">FTZ_format</span> <span class="id">beta</span> <span class="id">emin</span> <span class="id">prec</span> <span class="id">x</span> -&gt; <span class="id">FTZ_format</span> <span class="id">beta</span> <span class="id">emin</span> <span class="id">prec</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> (<span class="id">FTZ_exp</span> <span class="id">emin</span> <span class="id">prec</span>) (<span class="id">FTZ_exp</span> <span class="id">emin</span>' <span class="id">prec</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">choice1</span> <span class="id">choice2</span> (<span class="id">x</span> + <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5489')">Proof.</div>
<div class="proofscript" id="proof5489">
<span class="tactic">intros</span> <span class="id">Hbeta</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hemin</span> <span class="id">Hprec</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">apply</span> <span class="id">double_round_plus_beta_ge_3</span>.<br/>
- <span class="tactic">exact</span> <span class="id">Hbeta</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FTZ_exp_valid</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FTZ_exp_valid</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FTZ_double_round_plus_beta_ge_3_hyp</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FTZ</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FTZ</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id">double_round_minus_beta_ge_3_FTZ</span> :<br/>
&nbsp;&nbsp;(3 &lt;= <span class="id">beta</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">choice1</span> <span class="id">choice2</span>,<br/>
&nbsp;&nbsp;(<span class="id">emin</span>' + <span class="id">prec</span>' &lt;= <span class="id">emin</span> + 1)%<span class="id">Z</span> -&gt; (2 * <span class="id">prec</span> &lt;= <span class="id">prec</span>')%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;<span class="id">FTZ_format</span> <span class="id">beta</span> <span class="id">emin</span> <span class="id">prec</span> <span class="id">x</span> -&gt; <span class="id">FTZ_format</span> <span class="id">beta</span> <span class="id">emin</span> <span class="id">prec</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> (<span class="id">FTZ_exp</span> <span class="id">emin</span> <span class="id">prec</span>) (<span class="id">FTZ_exp</span> <span class="id">emin</span>' <span class="id">prec</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">choice1</span> <span class="id">choice2</span> (<span class="id">x</span> - <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5490')">Proof.</div>
<div class="proofscript" id="proof5490">
<span class="tactic">intros</span> <span class="id">Hbeta</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hemin</span> <span class="id">Hprec</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">apply</span> <span class="id">double_round_minus_beta_ge_3</span>.<br/>
- <span class="tactic">exact</span> <span class="id">Hbeta</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FTZ_exp_valid</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FTZ_exp_valid</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FTZ_double_round_plus_beta_ge_3_hyp</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FTZ</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FTZ</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">Double_round_plus_beta_ge_3_FTZ</span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id">Double_round_plus_beta_ge_3</span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id">Double_round_plus</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_mid_cases</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>),<br/>
&nbsp;&nbsp;<span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt; <span class="id">Valid_exp</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">choice1</span> <span class="id">choice2</span> : <span class="id">Z</span> -&gt; <span class="id">bool</span>),<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;0 &lt; <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">fexp2</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - 1)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt;= <span class="id">ln_beta</span> <span class="id">x</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">Rabs</span> (<span class="id">x</span> - <span class="id">midp</span> <span class="id">fexp1</span> <span class="id">x</span>) &lt;= / 2 * (<span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp2</span> <span class="id">x</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id">double_round_eq</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">x</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5491')">Proof.</div>
<div class="proofscript" id="proof5491">
<span class="tactic">intros</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Vfexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">x</span> <span class="id">Px</span> <span class="id">Hf2f1</span> <span class="id">Hf1</span>.<br/>
<span class="tactic">unfold</span> <span class="id">double_round_eq</span>, <span class="id">midp</span>.<br/>
<span class="tactic">set</span> (<span class="id">rd</span> := <span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zfloor</span> <span class="id">x</span>).<br/>
<span class="tactic">set</span> (<span class="id">u1</span> := <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span>).<br/>
<span class="tactic">set</span> (<span class="id">u2</span> := <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp2</span> <span class="id">x</span>).<br/>
<span class="tactic">intros</span> <span class="id">Cmid</span>.<br/>
<span class="tactic">destruct</span> (<span class="id">generic_format_EM</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span>) <span class="kwd">as</span> [<span class="id">Fx</span>|<span class="id">Nfx</span>].<br/>
- <span class="comment">(*&nbsp;generic_format&nbsp;beta&nbsp;fexp1&nbsp;x&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">round_generic</span> <span class="id">beta</span> <span class="id">fexp2</span>); [<span class="tactic">reflexivity</span>|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">valid_rnd_N</span>|].<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> (<span class="id">generic_inclusion_ln_beta</span> <span class="id">beta</span> <span class="id">fexp1</span>); [<span class="tactic">omega</span>|].<br/>
- <span class="comment">(*&nbsp;~&nbsp;generic_format&nbsp;beta&nbsp;fexp1&nbsp;x&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hceil</span> : <span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zceil</span> <span class="id">x</span> = <span class="id">rd</span> + <span class="id">u1</span>);<br/>
&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">round_UP_DN_ulp</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hf2</span>' : (<span class="id">fexp2</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - 1)%<span class="id">Z</span>); [<span class="tactic">omega</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Rlt_or_le</span> (<span class="id">x</span> - <span class="id">rd</span>) (/ 2 * (<span class="id">u1</span> - <span class="id">u2</span>))).<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;x&nbsp;-&nbsp;rd&nbsp;&lt;&nbsp;/&nbsp;2&nbsp;*&nbsp;(u1&nbsp;-&nbsp;u2)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">double_round_lt_mid_further_place</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">midp</span>. <span class="id">fold</span> <span class="id">rd</span>; <span class="id">fold</span> <span class="id">u1</span>; <span class="id">fold</span> <span class="id">u2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rplus_lt_reg_r</span> (- <span class="id">rd</span>)); <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">rewrite</span> &lt;- <span class="id">Rmult_minus_distr_l</span>.<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;/&nbsp;2&nbsp;*&nbsp;(u1&nbsp;-&nbsp;u2)&nbsp;&lt;=&nbsp;x&nbsp;-&nbsp;rd&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> (<span class="id">Rlt_or_le</span> (/ 2 * (<span class="id">u1</span> + <span class="id">u2</span>)) (<span class="id">x</span> - <span class="id">rd</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;/&nbsp;2&nbsp;*&nbsp;(u1&nbsp;+&nbsp;u2)&nbsp;&lt;&nbsp;x&nbsp;-&nbsp;rd&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zceil</span> <span class="id">x</span> - <span class="id">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt; / 2 * (<span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> - <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp2</span> <span class="id">x</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">Hceil</span>; <span class="id">fold</span> <span class="id">u1</span>; <span class="id">fold</span> <span class="id">u2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lra</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">double_round_gt_mid_further_place</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">midp</span>'; <span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;x&nbsp;-&nbsp;rd&nbsp;&lt;=&nbsp;/&nbsp;2&nbsp;*&nbsp;(u1&nbsp;+&nbsp;u2)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Cmid</span>, <span class="id">Rabs_le</span>; <span class="tactic">split</span>; <span class="id">lra</span>. }<br/>
Qed.</div>
<br/>
<span class="kwd">Section</span> <span class="id">Double_round_sqrt</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">double_round_sqrt_hyp</span> <span class="id">fexp1</span> <span class="id">fexp2</span> :=<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">ex</span>, (2 * <span class="id">fexp1</span> <span class="id">ex</span> &lt;= <span class="id">fexp1</span> (2 * <span class="id">ex</span>))%<span class="id">Z</span>)<br/>
&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">ex</span>, (2 * <span class="id">fexp1</span> <span class="id">ex</span> &lt;= <span class="id">fexp1</span> (2 * <span class="id">ex</span> - 1))%<span class="id">Z</span>)<br/>
&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">ex</span>, (<span class="id">fexp1</span> (2 * <span class="id">ex</span>) &lt; 2 * <span class="id">ex</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">fexp2</span> <span class="id">ex</span> + <span class="id">ex</span> &lt;= 2 * <span class="id">fexp1</span> <span class="id">ex</span> - 2)%<span class="id">Z</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">ln_beta_sqrt_disj</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;0 &lt; <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">ln_beta</span> <span class="id">x</span> = 2 * <span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>) - 1 :&gt; <span class="id">Z</span>)%<span class="id">Z</span><br/>
&nbsp;&nbsp;\/ (<span class="id">ln_beta</span> <span class="id">x</span> = 2 * <span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>) :&gt; <span class="id">Z</span>)%<span class="id">Z</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5492')">Proof.</div>
<div class="proofscript" id="proof5492">
<span class="tactic">intros</span> <span class="id">x</span> <span class="id">Px</span>.<br/>
<span class="tactic">generalize</span> (<span class="id">ln_beta_sqrt</span> <span class="id">beta</span> <span class="id">x</span> <span class="id">Px</span>).<br/>
<span class="tactic">intro</span> <span class="id">H</span>.<br/>
<span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_sqrt_aux</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>,<br/>
&nbsp;&nbsp;<span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt; <span class="id">Valid_exp</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_sqrt_hyp</span> <span class="id">fexp1</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;0 &lt; <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">fexp2</span> (<span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>)) &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>)) - 1)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;/ 2 * <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp2</span> (<span class="id">sqrt</span> <span class="id">x</span>) &lt; <span class="id">Rabs</span> (<span class="id">sqrt</span> <span class="id">x</span> - <span class="id">midp</span> <span class="id">fexp1</span> (<span class="id">sqrt</span> <span class="id">x</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5493')">Proof.</div>
<div class="proofscript" id="proof5493">
<span class="tactic">intros</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Vfexp2</span> <span class="id">Hexp</span> <span class="id">x</span> <span class="id">Px</span> <span class="id">Hf2</span> <span class="id">Fx</span>.<br/>
<span class="tactic">assert</span> (<span class="id">Hbeta</span> : (2 &lt;= <span class="id">beta</span>)%<span class="id">Z</span>).<br/>
{ <span class="tactic">destruct</span> <span class="id">beta</span> <span class="kwd">as</span> (<span class="id">beta_val</span>,<span class="id">beta_prop</span>).<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Zle_bool_imp_le</span>. }<br/>
<span class="tactic">set</span> (<span class="id">a</span> := <span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zfloor</span> (<span class="id">sqrt</span> <span class="id">x</span>)).<br/>
<span class="tactic">set</span> (<span class="id">u1</span> := <span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>)))).<br/>
<span class="tactic">set</span> (<span class="id">u2</span> := <span class="id">bpow</span> (<span class="id">fexp2</span> (<span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>)))).<br/>
<span class="tactic">set</span> (<span class="id">b</span> := / 2 * (<span class="id">u1</span> - <span class="id">u2</span>)).<br/>
<span class="tactic">set</span> (<span class="id">b</span>' := / 2 * (<span class="id">u1</span> + <span class="id">u2</span>)).<br/>
<span class="tactic">unfold</span> <span class="id">midp</span>; <span class="tactic">rewrite</span> 2!<span class="id">ulp_neq_0</span>; <span class="tactic">try</span> <span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>, <span class="id">sqrt_lt_R0</span>.<br/>
<span class="tactic">apply</span> <span class="id">Rnot_ge_lt</span>; <span class="tactic">intro</span> <span class="id">H</span>; <span class="tactic">apply</span> <span class="id">Rge_le</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
<span class="tactic">assert</span> (<span class="id">Fa</span> : <span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">a</span>).<br/>
{ <span class="tactic">unfold</span> <span class="id">a</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">generic_format_round</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">exact</span> <span class="id">Vfexp1</span>.<br/>
&nbsp;&nbsp;- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">valid_rnd_DN</span>. }<br/>
<span class="id">revert</span> <span class="id">Fa</span>; <span class="id">revert</span> <span class="id">Fx</span>.<br/>
<span class="tactic">unfold</span> <span class="id">generic_format</span>, <span class="id">F2R</span>, <span class="id">scaled_mantissa</span>, <span class="id">canonic_exp</span>; <span class="tactic">simpl</span>.<br/>
<span class="tactic">set</span> (<span class="id">mx</span> := <span class="id">Ztrunc</span> (<span class="id">x</span> * <span class="id">bpow</span> (- <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>)))).<br/>
<span class="tactic">set</span> (<span class="id">ma</span> := <span class="id">Ztrunc</span> (<span class="id">a</span> * <span class="id">bpow</span> (- <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">a</span>)))).<br/>
<span class="tactic">intros</span> <span class="id">Fx</span> <span class="id">Fa</span>.<br/>
<span class="tactic">assert</span> (<span class="id">Nna</span> : 0 &lt;= <span class="id">a</span>).<br/>
{ <span class="tactic">rewrite</span> &lt;- (<span class="id">round_0</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zfloor</span>).<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">a</span>; <span class="tactic">apply</span> <span class="id">round_le</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">exact</span> <span class="id">Vfexp1</span>.<br/>
&nbsp;&nbsp;- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">valid_rnd_DN</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">sqrt_pos</span>. }<br/>
<span class="tactic">assert</span> (<span class="id">Phu1</span> : 0 &lt; / 2 * <span class="id">u1</span>).<br/>
{ <span class="tactic">apply</span> <span class="id">Rmult_lt_0_compat</span>; [<span class="id">lra</span>|<span class="tactic">apply</span> <span class="id">bpow_gt_0</span>]. }<br/>
<span class="tactic">assert</span> (<span class="id">Phu2</span> : 0 &lt; / 2 * <span class="id">u2</span>).<br/>
{ <span class="tactic">apply</span> <span class="id">Rmult_lt_0_compat</span>; [<span class="id">lra</span>|<span class="tactic">apply</span> <span class="id">bpow_gt_0</span>]. }<br/>
<span class="tactic">assert</span> (<span class="id">Pb</span> : 0 &lt; <span class="id">b</span>).<br/>
{ <span class="tactic">unfold</span> <span class="id">b</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rmult_0_r</span> (/ 2)).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rmult_lt_compat_l</span>; [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rlt_Rminus</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">u2</span>, <span class="id">u1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bpow_lt</span>.<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>. }<br/>
<span class="tactic">assert</span> (<span class="id">Pb</span>' : 0 &lt; <span class="id">b</span>').<br/>
{ <span class="id">now</span> <span class="tactic">unfold</span> <span class="id">b</span>'; <span class="tactic">rewrite</span> <span class="id">Rmult_plus_distr_l</span>; <span class="tactic">apply</span> <span class="id">Rplus_lt_0_compat</span>. }<br/>
<span class="tactic">assert</span> (<span class="id">Hr</span> : <span class="id">sqrt</span> <span class="id">x</span> &lt;= <span class="id">a</span> + <span class="id">b</span>').<br/>
{ <span class="tactic">unfold</span> <span class="id">b</span>'; <span class="tactic">apply</span> (<span class="id">Rplus_le_reg_r</span> (- / 2 * <span class="id">u1</span> - <span class="id">a</span>)); <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">_</span> - <span class="id">_</span>) <span class="kwd">with</span> (<span class="id">sqrt</span> <span class="id">x</span> - (<span class="id">a</span> + / 2 * <span class="id">u1</span>)) <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rabs_le_inv</span>. }<br/>
<span class="tactic">assert</span> (<span class="id">Hl</span> : <span class="id">a</span> + <span class="id">b</span> &lt;= <span class="id">sqrt</span> <span class="id">x</span>).<br/>
{ <span class="tactic">unfold</span> <span class="id">b</span>; <span class="tactic">apply</span> (<span class="id">Rplus_le_reg_r</span> (- / 2 * <span class="id">u1</span> - <span class="id">a</span>)); <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">_</span> + <span class="id">sqrt</span> <span class="id">_</span>) <span class="kwd">with</span> (<span class="id">sqrt</span> <span class="id">x</span> - (<span class="id">a</span> + / 2 * <span class="id">u1</span>)) <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ropp_mult_distr_l_reverse</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rabs_le_inv</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">destruct</span> <span class="id">H</span>. }<br/>
<span class="tactic">assert</span> (<span class="id">Hf1</span> : (2 * <span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>)) &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">x</span>)))%<span class="id">Z</span>);<br/>
&nbsp;&nbsp;[<span class="tactic">destruct</span> (<span class="id">ln_beta_sqrt_disj</span> <span class="id">x</span> <span class="id">Px</span>) <span class="kwd">as</span> [<span class="id">H</span>'|<span class="id">H</span>']; <span class="tactic">rewrite</span> <span class="id">H</span>'; <span class="tactic">apply</span> <span class="id">Hexp</span>|].<br/>
<span class="tactic">assert</span> (<span class="id">Hlx</span> : (<span class="id">fexp1</span> (2 * <span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>)) &lt; 2 * <span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>))%<span class="id">Z</span>).<br/>
{ <span class="tactic">destruct</span> (<span class="id">ln_beta_sqrt_disj</span> <span class="id">x</span> <span class="id">Px</span>) <span class="kwd">as</span> [<span class="id">Hlx</span>|<span class="id">Hlx</span>].<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id">valid_exp_large</span> <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>)); [|<span class="tactic">omega</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_generic_gt</span>; [|<span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>|].<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> &lt;- <span class="id">Hlx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_generic_gt</span>; [|<span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>|]. }<br/>
<span class="tactic">assert</span> (<span class="id">Hsl</span> : <span class="id">a</span> * <span class="id">a</span> + <span class="id">u1</span> * <span class="id">a</span> - <span class="id">u2</span> * <span class="id">a</span> + <span class="id">b</span> * <span class="id">b</span> &lt;= <span class="id">x</span>).<br/>
{ <span class="tactic">replace</span> (<span class="id">_</span> + <span class="id">_</span>) <span class="kwd">with</span> ((<span class="id">a</span> + <span class="id">b</span>) * (<span class="id">a</span> + <span class="id">b</span>)); [|<span class="id">now</span> <span class="tactic">unfold</span> <span class="id">b</span>; <span class="id">field</span>].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">sqrt_def</span>; [|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rlt_le</span>].<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H</span>' : 0 &lt;= <span class="id">a</span> + <span class="id">b</span>); [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rlt_le</span>, <span class="id">Rplus_le_lt_0_compat</span>|].<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rmult_le_compat</span>. }<br/>
<span class="tactic">assert</span> (<span class="id">Hsr</span> : <span class="id">x</span> &lt;= <span class="id">a</span> * <span class="id">a</span> + <span class="id">u1</span> * <span class="id">a</span> + <span class="id">u2</span> * <span class="id">a</span> + <span class="id">b</span>' * <span class="id">b</span>').<br/>
{ <span class="tactic">replace</span> (<span class="id">_</span> + <span class="id">_</span>) <span class="kwd">with</span> ((<span class="id">a</span> + <span class="id">b</span>') * (<span class="id">a</span> + <span class="id">b</span>')); [|<span class="id">now</span> <span class="tactic">unfold</span> <span class="id">b</span>'; <span class="id">field</span>].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">sqrt_def</span> <span class="id">x</span>); [|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rlt_le</span>].<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H</span>' : 0 &lt;= <span class="id">sqrt</span> <span class="id">x</span>); [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">sqrt_pos</span>|].<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rmult_le_compat</span>. }<br/>
<span class="tactic">destruct</span> (<span class="id">Req_dec</span> <span class="id">a</span> 0) <span class="kwd">as</span> [<span class="id">Za</span>|<span class="id">Nza</span>].<br/>
- <span class="comment">(*&nbsp;a&nbsp;=&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rlt_irrefl</span> 0).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rlt_le_trans</span> <span class="kwd">with</span> (<span class="id">b</span> * <span class="id">b</span>); [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rmult_lt_0_compat</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rle_trans</span> <span class="kwd">with</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;+ <span class="id">revert</span> <span class="id">Hsl</span>; <span class="tactic">unfold</span> <span class="id">Rminus</span>; <span class="tactic">rewrite</span> <span class="id">Za</span>; <span class="tactic">do</span> 3 <span class="tactic">rewrite</span> <span class="id">Rmult_0_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">rewrite</span> <span class="id">Ropp_0</span>; <span class="tactic">do</span> 3 <span class="tactic">rewrite</span> <span class="id">Rplus_0_l</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">Fx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_le_reg_r</span> (<span class="id">bpow</span> (- <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_0_l</span>; <span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">mx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ztrunc_floor</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rmult_le_pos</span>; [<span class="tactic">apply</span> <span class="id">Rlt_le</span>|<span class="tactic">apply</span> <span class="id">bpow_ge_0</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Req_le</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> 0 <span class="kwd">with</span> (<span class="id">Z2R</span> 0); <span class="tactic">apply</span> <span class="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Zfloor_imp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rmult_le_pos</span>; [<span class="tactic">apply</span> <span class="id">Rlt_le</span>|<span class="tactic">apply</span> <span class="id">bpow_ge_0</span>]|<span class="tactic">simpl</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_r</span> (<span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>)))); [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_1_l</span>; <span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rlt_le_trans</span> <span class="kwd">with</span> (<span class="id">bpow</span> (2 * <span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>))));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_le</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> 2%<span class="id">Z</span> <span class="kwd">with</span> (1 + 1)%<span class="id">Z</span>; <span class="tactic">rewrite</span> <span class="id">Zmult_plus_distr_l</span>; <span class="tactic">rewrite</span> <span class="id">Zmult_1_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">bpow_plus</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">sqrt_def</span> <span class="id">x</span>) <span class="tactic">at</span> 1; [|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rlt_le</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">sqrt</span> <span class="id">x</span> &lt; <span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>))));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rmult_lt_compat</span>; [<span class="tactic">apply</span> <span class="id">sqrt_pos</span>|<span class="tactic">apply</span> <span class="id">sqrt_pos</span>| |]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rle_lt_trans</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hr</span>); <span class="tactic">rewrite</span> <span class="id">Za</span>; <span class="tactic">rewrite</span> <span class="id">Rplus_0_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">b</span>'; <span class="id">change</span> (<span class="id">bpow</span> <span class="id">_</span>) <span class="kwd">with</span> <span class="id">u1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rlt_le_trans</span> <span class="kwd">with</span> (/ 2 * (<span class="id">u1</span> + <span class="id">u1</span>)); [|<span class="id">lra</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rmult_lt_compat_l</span>; [<span class="id">lra</span>|]; <span class="tactic">apply</span> <span class="id">Rplus_lt_compat_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">u2</span>, <span class="id">u1</span>, <span class="id">ulp</span>, <span class="id">canonic_exp</span>; <span class="tactic">apply</span> <span class="id">bpow_lt</span>; <span class="tactic">omega</span>.<br/>
- <span class="comment">(*&nbsp;a&nbsp;&lt;&gt;&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Pa</span> : 0 &lt; <span class="id">a</span>); [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hla</span> : (<span class="id">ln_beta</span> <span class="id">a</span> = <span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>) :&gt; <span class="id">Z</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id">a</span>; <span class="tactic">apply</span> <span class="id">ln_beta_DN</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">exact</span> <span class="id">Vfexp1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">now</span> <span class="id">fold</span> <span class="id">a</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hl</span>' : 0 &lt; - (<span class="id">u2</span> * <span class="id">a</span>) + <span class="id">b</span> * <span class="id">b</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> (<span class="id">Rplus_lt_reg_r</span> (<span class="id">u2</span> * <span class="id">a</span>)); <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">b</span>; <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rplus_lt_reg_r</span> (/ 2 * <span class="id">u2</span> * <span class="id">u1</span>)); <span class="id">field_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">_</span> / 2) <span class="kwd">with</span> (<span class="id">u2</span> * (<span class="id">a</span> + / 2 * <span class="id">u1</span>)) <span class="tactic">by</span> <span class="id">field</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">_</span> / 8) <span class="kwd">with</span> (/ 4 * (<span class="id">u2</span> ^ 2 + <span class="id">u1</span> ^ 2)) <span class="tactic">by</span> <span class="id">field</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rlt_le_trans</span> <span class="kwd">with</span> (<span class="id">u2</span> * <span class="id">bpow</span> (<span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">Rmult_lt_compat_l</span>; [<span class="id">now</span> <span class="tactic">unfold</span> <span class="id">u2</span>, <span class="id">ulp</span>; <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">u1</span>; <span class="tactic">rewrite</span> &lt;- <span class="id">Hla</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rlt_le_trans</span> <span class="kwd">with</span> (<span class="id">a</span> + <span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">a</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">Rplus_lt_compat_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rmult_1_l</span> (<span class="id">bpow</span> <span class="id">_</span>)) <span class="tactic">at</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rmult_lt_compat_r</span>; [<span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|<span class="id">lra</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">Rle_trans</span> <span class="kwd">with</span> (<span class="id">a</span>+ <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="id">now</span> <span class="tactic">rewrite</span> <span class="id">ulp_neq_0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">id_p_ulp_le_bpow</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Pa</span> <span class="id">Fa</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rabs_lt_inv</span>, <span class="id">bpow_ln_beta_gt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">Rle_trans</span> <span class="kwd">with</span> (<span class="id">bpow</span> (- 2) * <span class="id">u1</span> ^ 2).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">unfold</span> <span class="id">pow</span>; <span class="tactic">rewrite</span> <span class="id">Rmult_1_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">u1</span>, <span class="id">u2</span>, <span class="id">ulp</span>, <span class="id">canonic_exp</span>; <span class="id">bpow_simplify</span>; <span class="tactic">apply</span> <span class="id">bpow_le</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Hexp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">Rmult_le_compat</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">bpow_ge_0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">pow2_ge_0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">unfold</span> <span class="id">Fcore_Raux.bpow</span>, <span class="id">Z.pow_pos</span>; <span class="tactic">simpl</span>; <span class="tactic">rewrite</span> <span class="id">Zmult_1_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rinv_le</span>; [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> 4 <span class="kwd">with</span> (<span class="id">Z2R</span> (2 * 2)%<span class="id">Z</span>); <span class="tactic">apply</span> <span class="id">Z2R_le</span>, <span class="id">Zmult_le_compat</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> &lt;- (<span class="id">Rplus_0_l</span> (<span class="id">u1</span> ^ 2)) <span class="tactic">at</span> 1; <span class="tactic">apply</span> <span class="id">Rplus_le_compat_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">pow2_ge_0</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hr</span>' : <span class="id">x</span> &lt;= <span class="id">a</span> * <span class="id">a</span> + <span class="id">u1</span> * <span class="id">a</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">Hla</span> <span class="kwd">in</span> <span class="id">Fa</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Rmult_plus_distr_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">u1</span>, <span class="id">ulp</span>, <span class="id">canonic_exp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rmult_1_l</span> (<span class="id">bpow</span> <span class="id">_</span>)); <span class="tactic">rewrite</span> <span class="id">Fa</span>; <span class="tactic">rewrite</span> &lt;- <span class="id">Rmult_plus_distr_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Rmult_assoc</span>; <span class="tactic">rewrite</span> (<span class="id">Rmult_comm</span> <span class="id">_</span> (<span class="id">Z2R</span> <span class="id">ma</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rmult_assoc</span> (<span class="id">Z2R</span> <span class="id">ma</span>)); <span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_le_reg_r</span> (<span class="id">bpow</span> (- 2 * <span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>)))));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|<span class="id">bpow_simplify</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Fx</span> <span class="tactic">at</span> 1; <span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Z2R_Zpower</span>; [|<span class="tactic">omega</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> 1 <span class="kwd">with</span> (<span class="id">Z2R</span> 1); <span class="tactic">rewrite</span> &lt;- <span class="id">Z2R_plus</span>; <span class="tactic">do</span> 2 <span class="tactic">rewrite</span> &lt;- <span class="id">Z2R_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Z2R_le</span>, <span class="id">Zlt_succ_le</span>, <span class="id">lt_Z2R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Z.succ</span>; <span class="tactic">rewrite</span> <span class="id">Z2R_plus</span>; <span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id">Z2R_mult</span>; <span class="tactic">rewrite</span> <span class="id">Z2R_plus</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Z2R_Zpower</span>; [|<span class="tactic">omega</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_r</span> (<span class="id">bpow</span> (2 * <span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>)))));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|<span class="id">bpow_simplify</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Fx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> 2%<span class="id">Z</span> <span class="kwd">with</span> (1 + 1)%<span class="id">Z</span>; <span class="tactic">rewrite</span> <span class="id">Zmult_plus_distr_l</span>; <span class="tactic">rewrite</span> <span class="id">Zmult_1_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">bpow_plus</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">_</span> * <span class="id">_</span>) <span class="kwd">with</span> (<span class="id">a</span> * <span class="id">a</span> + <span class="id">u1</span> * <span class="id">a</span> + <span class="id">u1</span> * <span class="id">u1</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="tactic">unfold</span> <span class="id">u1</span>, <span class="id">ulp</span>, <span class="id">canonic_exp</span>; <span class="tactic">rewrite</span> <span class="id">Fa</span>; <span class="tactic">ring</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rle_lt_trans</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hsr</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rplus_assoc</span>; <span class="tactic">apply</span> <span class="id">Rplus_lt_compat_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rplus_lt_reg_r</span> (- <span class="id">b</span>' * <span class="id">b</span>' + / 2 * <span class="id">u1</span> * <span class="id">u2</span>)); <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">_</span> + <span class="id">_</span>) <span class="kwd">with</span> ((<span class="id">a</span> + / 2 * <span class="id">u1</span>) * <span class="id">u2</span>) <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rlt_le_trans</span> <span class="kwd">with</span> (<span class="id">bpow</span> (<span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>)) * <span class="id">u2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">Rmult_lt_compat_r</span>; [<span class="id">now</span> <span class="tactic">unfold</span> <span class="id">u2</span>, <span class="id">ulp</span>; <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rlt_le_trans</span> <span class="kwd">with</span> (<span class="id">a</span> + <span class="id">u1</span>); [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">u1</span>; <span class="id">fold</span> (<span class="id">canonic_exp</span> <span class="id">beta</span> <span class="id">fexp1</span> (<span class="id">sqrt</span> <span class="id">x</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">canonic_exp_DN</span>; [|<span class="tactic">exact</span> <span class="id">Vfexp1</span>|<span class="tactic">exact</span> <span class="id">Pa</span>]; <span class="id">fold</span> <span class="id">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">ulp_neq_0</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">id_p_ulp_le_bpow</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">exact</span> <span class="id">Pa</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">now</span> <span class="tactic">apply</span> <span class="id">round_DN_pt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">Rle_lt_trans</span> <span class="kwd">with</span> (<span class="id">sqrt</span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">now</span> <span class="tactic">apply</span> <span class="id">round_DN_pt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">Rabs_lt_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bpow_ln_beta_gt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">Rle_trans</span> <span class="kwd">with</span> (/ 2 * <span class="id">u1</span> ^ 2).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">Rle_trans</span> <span class="kwd">with</span> (<span class="id">bpow</span> (- 2) * <span class="id">u1</span> ^ 2).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">unfold</span> <span class="id">pow</span>; <span class="tactic">rewrite</span> <span class="id">Rmult_1_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">u2</span>, <span class="id">u1</span>, <span class="id">ulp</span>, <span class="id">canonic_exp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bpow_le</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Zplus_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Hexp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">Rmult_le_compat_r</span>; [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">pow2_ge_0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Fcore_Raux.bpow</span>; <span class="tactic">simpl</span>; <span class="tactic">unfold</span> <span class="id">Z.pow_pos</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Zmult_1_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rinv_le</span>; [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> 2 <span class="kwd">with</span> (<span class="id">Z2R</span> 2); <span class="tactic">apply</span> <span class="id">Z2R_le</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Zmult_1_l</span> 2).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Zmult_le_compat</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">assert</span> (<span class="id">u2</span> ^ 2 &lt; <span class="id">u1</span> ^ 2); [|<span class="tactic">unfold</span> <span class="id">b</span>'; <span class="id">lra</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">pow</span>; <span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id">Rmult_1_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H</span>' : 0 &lt;= <span class="id">u2</span>); [<span class="tactic">unfold</span> <span class="id">u2</span>, <span class="id">ulp</span>; <span class="tactic">apply</span> <span class="id">bpow_ge_0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">u2</span> &lt; <span class="id">u1</span>); [|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rmult_lt_compat</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">u1</span>, <span class="id">u2</span>, <span class="id">ulp</span>, <span class="id">canonic_exp</span>; <span class="tactic">apply</span> <span class="id">bpow_lt</span>; <span class="tactic">omega</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rlt_irrefl</span> (<span class="id">a</span> * <span class="id">a</span> + <span class="id">u1</span> * <span class="id">a</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rlt_le_trans</span> <span class="kwd">with</span> (<span class="id">a</span> * <span class="id">a</span> + <span class="id">u1</span> * <span class="id">a</span> - <span class="id">u2</span> * <span class="id">a</span> + <span class="id">b</span> * <span class="id">b</span>).<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> &lt;- (<span class="id">Rplus_0_r</span> (<span class="id">a</span> * <span class="id">a</span> + <span class="id">_</span>)) <span class="tactic">at</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Rminus</span>; <span class="tactic">rewrite</span> (<span class="id">Rplus_assoc</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">b</span> * <span class="id">b</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rplus_lt_compat_l</span>.<br/>
&nbsp;&nbsp;+ <span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rle_trans</span> <span class="kwd">with</span> <span class="id">x</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_sqrt</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>,<br/>
&nbsp;&nbsp;<span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt; <span class="id">Valid_exp</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">choice1</span> <span class="id">choice2</span> : <span class="id">Z</span> -&gt; <span class="id">bool</span>),<br/>
&nbsp;&nbsp;<span class="id">double_round_sqrt_hyp</span> <span class="id">fexp1</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> (<span class="id">sqrt</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5494')">Proof.</div>
<div class="proofscript" id="proof5494">
<span class="tactic">intros</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Vfexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hexp</span> <span class="id">x</span> <span class="id">Fx</span>.<br/>
<span class="tactic">unfold</span> <span class="id">double_round_eq</span>.<br/>
<span class="tactic">destruct</span> (<span class="id">Rle_or_lt</span> <span class="id">x</span> 0) <span class="kwd">as</span> [<span class="id">Npx</span>|<span class="id">Px</span>].<br/>
- <span class="comment">(*&nbsp;x&nbsp;&lt;=&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">sqrt_neg</span> <span class="id">_</span> <span class="id">Npx</span>).<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">rewrite</span> <span class="id">round_0</span>; [|<span class="tactic">apply</span> <span class="id">valid_rnd_N</span>].<br/>
- <span class="comment">(*&nbsp;0&nbsp;&lt;&nbsp;x&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hfx</span> : (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt; <span class="id">ln_beta</span> <span class="id">x</span>)%<span class="id">Z</span>);<br/>
&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_generic_gt</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="id">lra</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hfsx</span> : (<span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>)) &lt; <span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>))%<span class="id">Z</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">destruct</span> (<span class="id">Rle_or_lt</span> <span class="id">x</span> 1) <span class="kwd">as</span> [<span class="id">Hx</span>|<span class="id">Hx</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;x&nbsp;&lt;=&nbsp;1&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">valid_exp_large</span> <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>)); [<span class="tactic">exact</span> <span class="id">Hfx</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">ln_beta_le</span>; [<span class="tactic">exact</span> <span class="id">Px</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">sqrt_def</span> <span class="id">x</span>) <span class="tactic">at</span> 1; [|<span class="id">lra</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Rmult_1_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rmult_le_compat_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">sqrt_pos</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> &lt;- <span class="id">sqrt_1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">sqrt_le_1_alt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;1&nbsp;&lt;&nbsp;x&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> ((<span class="id">proj1</span> (<span class="id">proj2</span> <span class="id">Hexp</span>)) 1%<span class="id">Z</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">_</span> - 1)%<span class="id">Z</span> <span class="kwd">with</span> 1%<span class="id">Z</span> <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hexp10</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hf0</span> : (<span class="id">fexp1</span> 1 &lt; 1)%<span class="id">Z</span>); [<span class="tactic">omega</span>|<span class="tactic">clear</span> <span class="id">Hexp10</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">valid_exp_large</span> <span class="id">fexp1</span> 1); [<span class="tactic">exact</span> <span class="id">Hf0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">ln_beta_ge_bpow</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Zeq_minus</span>; [|<span class="tactic">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Fcore_Raux.bpow</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rabs_ge</span>; <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">sqrt_1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">sqrt_le_1_alt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rlt_le</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hf2</span> : (<span class="id">fexp2</span> (<span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>)) &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>)) - 1)%<span class="id">Z</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">assert</span> (<span class="id">H</span> : (<span class="id">fexp1</span> (2 * <span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>)) &lt; 2 * <span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>))%<span class="id">Z</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> (<span class="id">ln_beta_sqrt_disj</span> <span class="id">x</span> <span class="id">Px</span>) <span class="kwd">as</span> [<span class="id">Hlx</span>|<span class="id">Hlx</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id">valid_exp_large</span> <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>)); [|<span class="tactic">omega</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_generic_gt</span>; [|<span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> &lt;- <span class="id">Hlx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_generic_gt</span>; [|<span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>|]. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> ((<span class="id">proj2</span> (<span class="id">proj2</span> <span class="id">Hexp</span>)) (<span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>)) <span class="id">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">double_round_mid_cases</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">exact</span> <span class="id">Vfexp1</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">exact</span> <span class="id">Vfexp2</span>.<br/>
&nbsp;&nbsp;+ <span class="id">now</span> <span class="tactic">apply</span> <span class="id">sqrt_lt_R0</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">Hmid</span>; <span class="id">casetype</span> <span class="id">False</span>; <span class="tactic">apply</span> (<span class="id">Rle_not_lt</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hmid</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">double_round_sqrt_aux</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Vfexp2</span> <span class="id">Hexp</span> <span class="id">x</span> <span class="id">Px</span> <span class="id">Hf2</span> <span class="id">Fx</span>).<br/>
Qed.</div>
<br/>
<span class="kwd">Section</span> <span class="id">Double_round_sqrt_FLX</span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Fcore_FLX</span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id">prec</span> : <span class="id">Z</span>.<br/>
<span class="kwd">Variable</span> <span class="id">prec</span>' : <span class="id">Z</span>.<br/>
<br/>
<span class="kwd">Context</span> { <span class="id">prec_gt_0_</span> : <span class="id">Prec_gt_0</span> <span class="id">prec</span> }.<br/>
<span class="kwd">Context</span> { <span class="id">prec_gt_0_</span>' : <span class="id">Prec_gt_0</span> <span class="id">prec</span>' }.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">FLX_double_round_sqrt_hyp</span> :<br/>
&nbsp;&nbsp;(2 * <span class="id">prec</span> + 2 &lt;= <span class="id">prec</span>')%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_sqrt_hyp</span> (<span class="id">FLX_exp</span> <span class="id">prec</span>) (<span class="id">FLX_exp</span> <span class="id">prec</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5495')">Proof.</div>
<div class="proofscript" id="proof5495">
<span class="tactic">intros</span> <span class="id">Hprec</span>.<br/>
<span class="tactic">unfold</span> <span class="id">FLX_exp</span>.<br/>
<span class="tactic">unfold</span> <span class="id">Prec_gt_0</span> <span class="kwd">in</span> <span class="id">prec_gt_0_</span>.<br/>
<span class="tactic">unfold</span> <span class="id">double_round_sqrt_hyp</span>; <span class="tactic">split</span>; [|<span class="tactic">split</span>]; <span class="tactic">intro</span> <span class="id">ex</span>; <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id">double_round_sqrt_FLX</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">choice1</span> <span class="id">choice2</span>,<br/>
&nbsp;&nbsp;(2 * <span class="id">prec</span> + 2 &lt;= <span class="id">prec</span>')%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;<span class="id">FLX_format</span> <span class="id">beta</span> <span class="id">prec</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> (<span class="id">FLX_exp</span> <span class="id">prec</span>) (<span class="id">FLX_exp</span> <span class="id">prec</span>') <span class="id">choice1</span> <span class="id">choice2</span> (<span class="id">sqrt</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5496')">Proof.</div>
<div class="proofscript" id="proof5496">
<span class="tactic">intros</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hprec</span> <span class="id">x</span> <span class="id">Fx</span>.<br/>
<span class="tactic">apply</span> <span class="id">double_round_sqrt</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLX_exp_valid</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLX_exp_valid</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLX_double_round_sqrt_hyp</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FLX</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">Double_round_sqrt_FLX</span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id">Double_round_sqrt_FLT</span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Fcore_FLX</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Fcore_FLT</span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id">emin</span> <span class="id">prec</span> : <span class="id">Z</span>.<br/>
<span class="kwd">Variable</span> <span class="id">emin</span>' <span class="id">prec</span>' : <span class="id">Z</span>.<br/>
<br/>
<span class="kwd">Context</span> { <span class="id">prec_gt_0_</span> : <span class="id">Prec_gt_0</span> <span class="id">prec</span> }.<br/>
<span class="kwd">Context</span> { <span class="id">prec_gt_0_</span>' : <span class="id">Prec_gt_0</span> <span class="id">prec</span>' }.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">FLT_double_round_sqrt_hyp</span> :<br/>
&nbsp;&nbsp;(<span class="id">emin</span> &lt;= 0)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;((<span class="id">emin</span>' &lt;= <span class="id">emin</span> - <span class="id">prec</span> - 2)%<span class="id">Z</span><br/>
&nbsp;&nbsp;&nbsp;\/ (2 * <span class="id">emin</span>' &lt;= <span class="id">emin</span> - 4 * <span class="id">prec</span> - 2)%<span class="id">Z</span>) -&gt;<br/>
&nbsp;&nbsp;(2 * <span class="id">prec</span> + 2 &lt;= <span class="id">prec</span>')%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_sqrt_hyp</span> (<span class="id">FLT_exp</span> <span class="id">emin</span> <span class="id">prec</span>) (<span class="id">FLT_exp</span> <span class="id">emin</span>' <span class="id">prec</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5497')">Proof.</div>
<div class="proofscript" id="proof5497">
<span class="tactic">intros</span> <span class="id">Hemin</span> <span class="id">Heminprec</span> <span class="id">Hprec</span>.<br/>
<span class="tactic">unfold</span> <span class="id">FLT_exp</span>.<br/>
<span class="tactic">unfold</span> <span class="id">Prec_gt_0</span> <span class="kwd">in</span> <span class="id">prec_gt_0_</span>.<br/>
<span class="tactic">unfold</span> <span class="id">double_round_sqrt_hyp</span>; <span class="tactic">split</span>; [|<span class="tactic">split</span>]; <span class="tactic">intros</span> <span class="id">ex</span>.<br/>
- <span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>) <span class="id">emin</span>).<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (2 * <span class="id">ex</span> - <span class="id">prec</span>) <span class="id">emin</span>).<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
- <span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>) <span class="id">emin</span>).<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (2 * <span class="id">ex</span> - 1 - <span class="id">prec</span>) <span class="id">emin</span>).<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
- <span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (2 * <span class="id">ex</span> - <span class="id">prec</span>) <span class="id">emin</span>).<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>') <span class="id">emin</span>').<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>) <span class="id">emin</span>).<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id">double_round_sqrt_FLT</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">choice1</span> <span class="id">choice2</span>,<br/>
&nbsp;&nbsp;(<span class="id">emin</span> &lt;= 0)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;((<span class="id">emin</span>' &lt;= <span class="id">emin</span> - <span class="id">prec</span> - 2)%<span class="id">Z</span><br/>
&nbsp;&nbsp;&nbsp;\/ (2 * <span class="id">emin</span>' &lt;= <span class="id">emin</span> - 4 * <span class="id">prec</span> - 2)%<span class="id">Z</span>) -&gt;<br/>
&nbsp;&nbsp;(2 * <span class="id">prec</span> + 2 &lt;= <span class="id">prec</span>')%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;<span class="id">FLT_format</span> <span class="id">beta</span> <span class="id">emin</span> <span class="id">prec</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> (<span class="id">FLT_exp</span> <span class="id">emin</span> <span class="id">prec</span>) (<span class="id">FLT_exp</span> <span class="id">emin</span>' <span class="id">prec</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">choice1</span> <span class="id">choice2</span> (<span class="id">sqrt</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5498')">Proof.</div>
<div class="proofscript" id="proof5498">
<span class="tactic">intros</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hemin</span> <span class="id">Heminprec</span> <span class="id">Hprec</span> <span class="id">x</span> <span class="id">Fx</span>.<br/>
<span class="tactic">apply</span> <span class="id">double_round_sqrt</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLT_exp_valid</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLT_exp_valid</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLT_double_round_sqrt_hyp</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FLT</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">Double_round_sqrt_FLT</span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id">Double_round_sqrt_FTZ</span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Fcore_FLX</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Fcore_FTZ</span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id">emin</span> <span class="id">prec</span> : <span class="id">Z</span>.<br/>
<span class="kwd">Variable</span> <span class="id">emin</span>' <span class="id">prec</span>' : <span class="id">Z</span>.<br/>
<br/>
<span class="kwd">Context</span> { <span class="id">prec_gt_0_</span> : <span class="id">Prec_gt_0</span> <span class="id">prec</span> }.<br/>
<span class="kwd">Context</span> { <span class="id">prec_gt_0_</span>' : <span class="id">Prec_gt_0</span> <span class="id">prec</span>' }.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">FTZ_double_round_sqrt_hyp</span> :<br/>
&nbsp;&nbsp;(2 * (<span class="id">emin</span>' + <span class="id">prec</span>') &lt;= <span class="id">emin</span> + <span class="id">prec</span> &lt;= 1)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;(2 * <span class="id">prec</span> + 2 &lt;= <span class="id">prec</span>')%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_sqrt_hyp</span> (<span class="id">FTZ_exp</span> <span class="id">emin</span> <span class="id">prec</span>) (<span class="id">FTZ_exp</span> <span class="id">emin</span>' <span class="id">prec</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5499')">Proof.</div>
<div class="proofscript" id="proof5499">
<span class="tactic">intros</span> <span class="id">Hemin</span> <span class="id">Hprec</span>.<br/>
<span class="tactic">unfold</span> <span class="id">FTZ_exp</span>.<br/>
<span class="tactic">unfold</span> <span class="id">Prec_gt_0</span> <span class="kwd">in</span> *.<br/>
<span class="tactic">unfold</span> <span class="id">double_round_sqrt_hyp</span>; <span class="tactic">split</span>; [|<span class="tactic">split</span>]; <span class="tactic">intros</span> <span class="id">ex</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>) <span class="id">emin</span>);<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (2 * <span class="id">ex</span> - <span class="id">prec</span>) <span class="id">emin</span>);<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>) <span class="id">emin</span>);<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (2 * <span class="id">ex</span> - 1 - <span class="id">prec</span>) <span class="id">emin</span>);<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
- <span class="tactic">intro</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Zle_or_lt</span> <span class="id">emin</span> (2 * <span class="id">ex</span> - <span class="id">prec</span>)) <span class="kwd">as</span> [<span class="id">H</span>'|<span class="id">H</span>'].<br/>
&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>') <span class="id">emin</span>');<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>) <span class="id">emin</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;+ <span class="id">casetype</span> <span class="id">False</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Zlt_bool_true</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span>') <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id">double_round_sqrt_FTZ</span> :<br/>
&nbsp;&nbsp;(4 &lt;= <span class="id">beta</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">choice1</span> <span class="id">choice2</span>,<br/>
&nbsp;&nbsp;(2 * (<span class="id">emin</span>' + <span class="id">prec</span>') &lt;= <span class="id">emin</span> + <span class="id">prec</span> &lt;= 1)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;(2 * <span class="id">prec</span> + 2 &lt;= <span class="id">prec</span>')%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;<span class="id">FTZ_format</span> <span class="id">beta</span> <span class="id">emin</span> <span class="id">prec</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> (<span class="id">FTZ_exp</span> <span class="id">emin</span> <span class="id">prec</span>) (<span class="id">FTZ_exp</span> <span class="id">emin</span>' <span class="id">prec</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">choice1</span> <span class="id">choice2</span> (<span class="id">sqrt</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5500')">Proof.</div>
<div class="proofscript" id="proof5500">
<span class="tactic">intros</span> <span class="id">Hbeta</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hemin</span> <span class="id">Hprec</span> <span class="id">x</span> <span class="id">Fx</span>.<br/>
<span class="tactic">apply</span> <span class="id">double_round_sqrt</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FTZ_exp_valid</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FTZ_exp_valid</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FTZ_double_round_sqrt_hyp</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FTZ</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">Double_round_sqrt_FTZ</span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id">Double_round_sqrt_beta_ge_4</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">double_round_sqrt_beta_ge_4_hyp</span> <span class="id">fexp1</span> <span class="id">fexp2</span> :=<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">ex</span>, (2 * <span class="id">fexp1</span> <span class="id">ex</span> &lt;= <span class="id">fexp1</span> (2 * <span class="id">ex</span>))%<span class="id">Z</span>)<br/>
&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">ex</span>, (2 * <span class="id">fexp1</span> <span class="id">ex</span> &lt;= <span class="id">fexp1</span> (2 * <span class="id">ex</span> - 1))%<span class="id">Z</span>)<br/>
&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">ex</span>, (<span class="id">fexp1</span> (2 * <span class="id">ex</span>) &lt; 2 * <span class="id">ex</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">fexp2</span> <span class="id">ex</span> + <span class="id">ex</span> &lt;= 2 * <span class="id">fexp1</span> <span class="id">ex</span> - 1)%<span class="id">Z</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_sqrt_beta_ge_4_aux</span> :<br/>
&nbsp;&nbsp;(4 &lt;= <span class="id">beta</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>,<br/>
&nbsp;&nbsp;<span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt; <span class="id">Valid_exp</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_sqrt_beta_ge_4_hyp</span> <span class="id">fexp1</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;0 &lt; <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">fexp2</span> (<span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>)) &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>)) - 1)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;/ 2 * <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp2</span> (<span class="id">sqrt</span> <span class="id">x</span>) &lt; <span class="id">Rabs</span> (<span class="id">sqrt</span> <span class="id">x</span> - <span class="id">midp</span> <span class="id">fexp1</span> (<span class="id">sqrt</span> <span class="id">x</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5501')">Proof.</div>
<div class="proofscript" id="proof5501">
<span class="tactic">intros</span> <span class="id">Hbeta</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Vfexp2</span> <span class="id">Hexp</span> <span class="id">x</span> <span class="id">Px</span> <span class="id">Hf2</span> <span class="id">Fx</span>.<br/>
<span class="tactic">set</span> (<span class="id">a</span> := <span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zfloor</span> (<span class="id">sqrt</span> <span class="id">x</span>)).<br/>
<span class="tactic">set</span> (<span class="id">u1</span> := <span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>)))).<br/>
<span class="tactic">set</span> (<span class="id">u2</span> := <span class="id">bpow</span> (<span class="id">fexp2</span> (<span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>)))).<br/>
<span class="tactic">set</span> (<span class="id">b</span> := / 2 * (<span class="id">u1</span> - <span class="id">u2</span>)).<br/>
<span class="tactic">set</span> (<span class="id">b</span>' := / 2 * (<span class="id">u1</span> + <span class="id">u2</span>)).<br/>
<span class="tactic">unfold</span> <span class="id">midp</span>; <span class="tactic">rewrite</span> 2!<span class="id">ulp_neq_0</span>; <span class="tactic">try</span> <span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>, <span class="id">sqrt_lt_R0</span>.<br/>
<span class="tactic">apply</span> <span class="id">Rnot_ge_lt</span>; <span class="tactic">intro</span> <span class="id">H</span>; <span class="tactic">apply</span> <span class="id">Rge_le</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
<span class="tactic">assert</span> (<span class="id">Fa</span> : <span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">a</span>).<br/>
{ <span class="tactic">unfold</span> <span class="id">a</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">generic_format_round</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">exact</span> <span class="id">Vfexp1</span>.<br/>
&nbsp;&nbsp;- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">valid_rnd_DN</span>. }<br/>
<span class="id">revert</span> <span class="id">Fa</span>; <span class="id">revert</span> <span class="id">Fx</span>.<br/>
<span class="tactic">unfold</span> <span class="id">generic_format</span>, <span class="id">F2R</span>, <span class="id">scaled_mantissa</span>, <span class="id">canonic_exp</span>; <span class="tactic">simpl</span>.<br/>
<span class="tactic">set</span> (<span class="id">mx</span> := <span class="id">Ztrunc</span> (<span class="id">x</span> * <span class="id">bpow</span> (- <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>)))).<br/>
<span class="tactic">set</span> (<span class="id">ma</span> := <span class="id">Ztrunc</span> (<span class="id">a</span> * <span class="id">bpow</span> (- <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">a</span>)))).<br/>
<span class="tactic">intros</span> <span class="id">Fx</span> <span class="id">Fa</span>.<br/>
<span class="tactic">assert</span> (<span class="id">Nna</span> : 0 &lt;= <span class="id">a</span>).<br/>
{ <span class="tactic">rewrite</span> &lt;- (<span class="id">round_0</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zfloor</span>).<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">a</span>; <span class="tactic">apply</span> <span class="id">round_le</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">exact</span> <span class="id">Vfexp1</span>.<br/>
&nbsp;&nbsp;- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">valid_rnd_DN</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">sqrt_pos</span>. }<br/>
<span class="tactic">assert</span> (<span class="id">Phu1</span> : 0 &lt; / 2 * <span class="id">u1</span>).<br/>
{ <span class="tactic">apply</span> <span class="id">Rmult_lt_0_compat</span>; [<span class="id">lra</span>|<span class="tactic">apply</span> <span class="id">bpow_gt_0</span>]. }<br/>
<span class="tactic">assert</span> (<span class="id">Phu2</span> : 0 &lt; / 2 * <span class="id">u2</span>).<br/>
{ <span class="tactic">apply</span> <span class="id">Rmult_lt_0_compat</span>; [<span class="id">lra</span>|<span class="tactic">apply</span> <span class="id">bpow_gt_0</span>]. }<br/>
<span class="tactic">assert</span> (<span class="id">Pb</span> : 0 &lt; <span class="id">b</span>).<br/>
{ <span class="tactic">unfold</span> <span class="id">b</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rmult_0_r</span> (/ 2)).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rmult_lt_compat_l</span>; [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rlt_Rminus</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">u2</span>, <span class="id">u1</span>, <span class="id">ulp</span>, <span class="id">canonic_exp</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bpow_lt</span>.<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>. }<br/>
<span class="tactic">assert</span> (<span class="id">Pb</span>' : 0 &lt; <span class="id">b</span>').<br/>
{ <span class="id">now</span> <span class="tactic">unfold</span> <span class="id">b</span>'; <span class="tactic">rewrite</span> <span class="id">Rmult_plus_distr_l</span>; <span class="tactic">apply</span> <span class="id">Rplus_lt_0_compat</span>. }<br/>
<span class="tactic">assert</span> (<span class="id">Hr</span> : <span class="id">sqrt</span> <span class="id">x</span> &lt;= <span class="id">a</span> + <span class="id">b</span>').<br/>
{ <span class="tactic">unfold</span> <span class="id">b</span>'; <span class="tactic">apply</span> (<span class="id">Rplus_le_reg_r</span> (- / 2 * <span class="id">u1</span> - <span class="id">a</span>)); <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">_</span> - <span class="id">_</span>) <span class="kwd">with</span> (<span class="id">sqrt</span> <span class="id">x</span> - (<span class="id">a</span> + / 2 * <span class="id">u1</span>)) <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rabs_le_inv</span>. }<br/>
<span class="tactic">assert</span> (<span class="id">Hl</span> : <span class="id">a</span> + <span class="id">b</span> &lt;= <span class="id">sqrt</span> <span class="id">x</span>).<br/>
{ <span class="tactic">unfold</span> <span class="id">b</span>; <span class="tactic">apply</span> (<span class="id">Rplus_le_reg_r</span> (- / 2 * <span class="id">u1</span> - <span class="id">a</span>)); <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">_</span> + <span class="id">sqrt</span> <span class="id">_</span>) <span class="kwd">with</span> (<span class="id">sqrt</span> <span class="id">x</span> - (<span class="id">a</span> + / 2 * <span class="id">u1</span>)) <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ropp_mult_distr_l_reverse</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rabs_le_inv</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">destruct</span> <span class="id">H</span>. }<br/>
<span class="tactic">assert</span> (<span class="id">Hf1</span> : (2 * <span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>)) &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">x</span>)))%<span class="id">Z</span>);<br/>
&nbsp;&nbsp;[<span class="tactic">destruct</span> (<span class="id">ln_beta_sqrt_disj</span> <span class="id">x</span> <span class="id">Px</span>) <span class="kwd">as</span> [<span class="id">H</span>'|<span class="id">H</span>']; <span class="tactic">rewrite</span> <span class="id">H</span>'; <span class="tactic">apply</span> <span class="id">Hexp</span>|].<br/>
<span class="tactic">assert</span> (<span class="id">Hlx</span> : (<span class="id">fexp1</span> (2 * <span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>)) &lt; 2 * <span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>))%<span class="id">Z</span>).<br/>
{ <span class="tactic">destruct</span> (<span class="id">ln_beta_sqrt_disj</span> <span class="id">x</span> <span class="id">Px</span>) <span class="kwd">as</span> [<span class="id">Hlx</span>|<span class="id">Hlx</span>].<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id">valid_exp_large</span> <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>)); [|<span class="tactic">omega</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_generic_gt</span>; [|<span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>|].<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> &lt;- <span class="id">Hlx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_generic_gt</span>; [|<span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>|]. }<br/>
<span class="tactic">assert</span> (<span class="id">Hsl</span> : <span class="id">a</span> * <span class="id">a</span> + <span class="id">u1</span> * <span class="id">a</span> - <span class="id">u2</span> * <span class="id">a</span> + <span class="id">b</span> * <span class="id">b</span> &lt;= <span class="id">x</span>).<br/>
{ <span class="tactic">replace</span> (<span class="id">_</span> + <span class="id">_</span>) <span class="kwd">with</span> ((<span class="id">a</span> + <span class="id">b</span>) * (<span class="id">a</span> + <span class="id">b</span>)); [|<span class="id">now</span> <span class="tactic">unfold</span> <span class="id">b</span>; <span class="id">field</span>].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">sqrt_def</span>; [|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rlt_le</span>].<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H</span>' : 0 &lt;= <span class="id">a</span> + <span class="id">b</span>); [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rlt_le</span>, <span class="id">Rplus_le_lt_0_compat</span>|].<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rmult_le_compat</span>. }<br/>
<span class="tactic">assert</span> (<span class="id">Hsr</span> : <span class="id">x</span> &lt;= <span class="id">a</span> * <span class="id">a</span> + <span class="id">u1</span> * <span class="id">a</span> + <span class="id">u2</span> * <span class="id">a</span> + <span class="id">b</span>' * <span class="id">b</span>').<br/>
{ <span class="tactic">replace</span> (<span class="id">_</span> + <span class="id">_</span>) <span class="kwd">with</span> ((<span class="id">a</span> + <span class="id">b</span>') * (<span class="id">a</span> + <span class="id">b</span>')); [|<span class="id">now</span> <span class="tactic">unfold</span> <span class="id">b</span>'; <span class="id">field</span>].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">sqrt_def</span> <span class="id">x</span>); [|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rlt_le</span>].<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H</span>' : 0 &lt;= <span class="id">sqrt</span> <span class="id">x</span>); [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">sqrt_pos</span>|].<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rmult_le_compat</span>. }<br/>
<span class="tactic">destruct</span> (<span class="id">Req_dec</span> <span class="id">a</span> 0) <span class="kwd">as</span> [<span class="id">Za</span>|<span class="id">Nza</span>].<br/>
- <span class="comment">(*&nbsp;a&nbsp;=&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rlt_irrefl</span> 0).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rlt_le_trans</span> <span class="kwd">with</span> (<span class="id">b</span> * <span class="id">b</span>); [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rmult_lt_0_compat</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rle_trans</span> <span class="kwd">with</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;+ <span class="id">revert</span> <span class="id">Hsl</span>; <span class="tactic">unfold</span> <span class="id">Rminus</span>; <span class="tactic">rewrite</span> <span class="id">Za</span>; <span class="tactic">do</span> 3 <span class="tactic">rewrite</span> <span class="id">Rmult_0_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">rewrite</span> <span class="id">Ropp_0</span>; <span class="tactic">do</span> 3 <span class="tactic">rewrite</span> <span class="id">Rplus_0_l</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">Fx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_le_reg_r</span> (<span class="id">bpow</span> (- <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_0_l</span>; <span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">mx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ztrunc_floor</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rmult_le_pos</span>; [<span class="tactic">apply</span> <span class="id">Rlt_le</span>|<span class="tactic">apply</span> <span class="id">bpow_ge_0</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Req_le</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> 0 <span class="kwd">with</span> (<span class="id">Z2R</span> 0); <span class="tactic">apply</span> <span class="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Zfloor_imp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rmult_le_pos</span>; [<span class="tactic">apply</span> <span class="id">Rlt_le</span>|<span class="tactic">apply</span> <span class="id">bpow_ge_0</span>]|<span class="tactic">simpl</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_r</span> (<span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>)))); [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_1_l</span>; <span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rlt_le_trans</span> <span class="kwd">with</span> (<span class="id">bpow</span> (2 * <span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>))));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_le</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> 2%<span class="id">Z</span> <span class="kwd">with</span> (1 + 1)%<span class="id">Z</span>; <span class="tactic">rewrite</span> <span class="id">Zmult_plus_distr_l</span>; <span class="tactic">rewrite</span> <span class="id">Zmult_1_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">bpow_plus</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">sqrt_def</span> <span class="id">x</span>) <span class="tactic">at</span> 1; [|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rlt_le</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">sqrt</span> <span class="id">x</span> &lt; <span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>))));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rmult_lt_compat</span>; [<span class="tactic">apply</span> <span class="id">sqrt_pos</span>|<span class="tactic">apply</span> <span class="id">sqrt_pos</span>| |]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rle_lt_trans</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hr</span>); <span class="tactic">rewrite</span> <span class="id">Za</span>; <span class="tactic">rewrite</span> <span class="id">Rplus_0_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">b</span>'; <span class="id">change</span> (<span class="id">bpow</span> <span class="id">_</span>) <span class="kwd">with</span> <span class="id">u1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rlt_le_trans</span> <span class="kwd">with</span> (/ 2 * (<span class="id">u1</span> + <span class="id">u1</span>)); [|<span class="id">lra</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rmult_lt_compat_l</span>; [<span class="id">lra</span>|]; <span class="tactic">apply</span> <span class="id">Rplus_lt_compat_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">u2</span>, <span class="id">u1</span>, <span class="id">ulp</span>, <span class="id">canonic_exp</span>; <span class="tactic">apply</span> <span class="id">bpow_lt</span>; <span class="tactic">omega</span>.<br/>
- <span class="comment">(*&nbsp;a&nbsp;&lt;&gt;&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Pa</span> : 0 &lt; <span class="id">a</span>); [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hla</span> : (<span class="id">ln_beta</span> <span class="id">a</span> = <span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>) :&gt; <span class="id">Z</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id">a</span>; <span class="tactic">apply</span> <span class="id">ln_beta_DN</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">exact</span> <span class="id">Vfexp1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">now</span> <span class="id">fold</span> <span class="id">a</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hl</span>' : 0 &lt; - (<span class="id">u2</span> * <span class="id">a</span>) + <span class="id">b</span> * <span class="id">b</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> (<span class="id">Rplus_lt_reg_r</span> (<span class="id">u2</span> * <span class="id">a</span>)); <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">b</span>; <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rplus_lt_reg_r</span> (/ 2 * <span class="id">u2</span> * <span class="id">u1</span>)); <span class="id">field_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">_</span> / 2) <span class="kwd">with</span> (<span class="id">u2</span> * (<span class="id">a</span> + / 2 * <span class="id">u1</span>)) <span class="tactic">by</span> <span class="id">field</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">_</span> / 8) <span class="kwd">with</span> (/ 4 * (<span class="id">u2</span> ^ 2 + <span class="id">u1</span> ^ 2)) <span class="tactic">by</span> <span class="id">field</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rlt_le_trans</span> <span class="kwd">with</span> (<span class="id">u2</span> * <span class="id">bpow</span> (<span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">Rmult_lt_compat_l</span>; [<span class="id">now</span> <span class="tactic">unfold</span> <span class="id">u2</span>, <span class="id">ulp</span>; <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">u1</span>; <span class="tactic">rewrite</span> &lt;- <span class="id">Hla</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rlt_le_trans</span> <span class="kwd">with</span> (<span class="id">a</span> + <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">Rplus_lt_compat_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rmult_1_l</span> (<span class="id">ulp</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">ulp_neq_0</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rmult_lt_compat_r</span>; [<span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|<span class="id">lra</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> (<span class="id">id_p_ulp_le_bpow</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Pa</span> <span class="id">Fa</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rabs_lt_inv</span>, <span class="id">bpow_ln_beta_gt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">Rle_trans</span> <span class="kwd">with</span> (<span class="id">bpow</span> (- 1) * <span class="id">u1</span> ^ 2).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">unfold</span> <span class="id">pow</span>; <span class="tactic">rewrite</span> <span class="id">Rmult_1_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">u1</span>, <span class="id">u2</span>, <span class="id">ulp</span>, <span class="id">canonic_exp</span>; <span class="id">bpow_simplify</span>; <span class="tactic">apply</span> <span class="id">bpow_le</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Hexp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">Rmult_le_compat</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">bpow_ge_0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">pow2_ge_0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">unfold</span> <span class="id">Fcore_Raux.bpow</span>, <span class="id">Z.pow_pos</span>; <span class="tactic">simpl</span>; <span class="tactic">rewrite</span> <span class="id">Zmult_1_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rinv_le</span>; [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">change</span> 4 <span class="kwd">with</span> (<span class="id">Z2R</span> 4); <span class="tactic">apply</span> <span class="id">Z2R_le</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> &lt;- (<span class="id">Rplus_0_l</span> (<span class="id">u1</span> ^ 2)) <span class="tactic">at</span> 1; <span class="tactic">apply</span> <span class="id">Rplus_le_compat_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">pow2_ge_0</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hr</span>' : <span class="id">x</span> &lt;= <span class="id">a</span> * <span class="id">a</span> + <span class="id">u1</span> * <span class="id">a</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">Hla</span> <span class="kwd">in</span> <span class="id">Fa</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Rmult_plus_distr_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">u1</span>, <span class="id">ulp</span>, <span class="id">canonic_exp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rmult_1_l</span> (<span class="id">bpow</span> <span class="id">_</span>)); <span class="tactic">rewrite</span> <span class="id">Fa</span>; <span class="tactic">rewrite</span> &lt;- <span class="id">Rmult_plus_distr_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Rmult_assoc</span>; <span class="tactic">rewrite</span> (<span class="id">Rmult_comm</span> <span class="id">_</span> (<span class="id">Z2R</span> <span class="id">ma</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rmult_assoc</span> (<span class="id">Z2R</span> <span class="id">ma</span>)); <span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_le_reg_r</span> (<span class="id">bpow</span> (- 2 * <span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>)))));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|<span class="id">bpow_simplify</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Fx</span> <span class="tactic">at</span> 1; <span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Z2R_Zpower</span>; [|<span class="tactic">omega</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> 1 <span class="kwd">with</span> (<span class="id">Z2R</span> 1); <span class="tactic">rewrite</span> &lt;- <span class="id">Z2R_plus</span>; <span class="tactic">do</span> 2 <span class="tactic">rewrite</span> &lt;- <span class="id">Z2R_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Z2R_le</span>, <span class="id">Zlt_succ_le</span>, <span class="id">lt_Z2R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Z.succ</span>; <span class="tactic">rewrite</span> <span class="id">Z2R_plus</span>; <span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id">Z2R_mult</span>; <span class="tactic">rewrite</span> <span class="id">Z2R_plus</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Z2R_Zpower</span>; [|<span class="tactic">omega</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_r</span> (<span class="id">bpow</span> (2 * <span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>)))));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|<span class="id">bpow_simplify</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Fx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> 2%<span class="id">Z</span> <span class="kwd">with</span> (1 + 1)%<span class="id">Z</span>; <span class="tactic">rewrite</span> <span class="id">Zmult_plus_distr_l</span>; <span class="tactic">rewrite</span> <span class="id">Zmult_1_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">bpow_plus</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">_</span> * <span class="id">_</span>) <span class="kwd">with</span> (<span class="id">a</span> * <span class="id">a</span> + <span class="id">u1</span> * <span class="id">a</span> + <span class="id">u1</span> * <span class="id">u1</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="tactic">unfold</span> <span class="id">u1</span>, <span class="id">ulp</span>, <span class="id">canonic_exp</span>; <span class="tactic">rewrite</span> <span class="id">Fa</span>; <span class="tactic">ring</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rle_lt_trans</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hsr</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rplus_assoc</span>; <span class="tactic">apply</span> <span class="id">Rplus_lt_compat_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rplus_lt_reg_r</span> (- <span class="id">b</span>' * <span class="id">b</span>' + / 2 * <span class="id">u1</span> * <span class="id">u2</span>)); <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">_</span> + <span class="id">_</span>) <span class="kwd">with</span> ((<span class="id">a</span> + / 2 * <span class="id">u1</span>) * <span class="id">u2</span>) <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rlt_le_trans</span> <span class="kwd">with</span> (<span class="id">bpow</span> (<span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>)) * <span class="id">u2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">Rmult_lt_compat_r</span>; [<span class="id">now</span> <span class="tactic">unfold</span> <span class="id">u2</span>, <span class="id">ulp</span>; <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rlt_le_trans</span> <span class="kwd">with</span> (<span class="id">a</span> + <span class="id">u1</span>); [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">u1</span>; <span class="id">fold</span> (<span class="id">canonic_exp</span> <span class="id">beta</span> <span class="id">fexp1</span> (<span class="id">sqrt</span> <span class="id">x</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">canonic_exp_DN</span>; [|<span class="tactic">exact</span> <span class="id">Vfexp1</span>|<span class="tactic">exact</span> <span class="id">Pa</span>]; <span class="id">fold</span> <span class="id">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">ulp_neq_0</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">id_p_ulp_le_bpow</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">exact</span> <span class="id">Pa</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">now</span> <span class="tactic">apply</span> <span class="id">round_DN_pt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">Rle_lt_trans</span> <span class="kwd">with</span> (<span class="id">sqrt</span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">now</span> <span class="tactic">apply</span> <span class="id">round_DN_pt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">Rabs_lt_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bpow_ln_beta_gt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">Rle_trans</span> <span class="kwd">with</span> (/ 2 * <span class="id">u1</span> ^ 2).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">Rle_trans</span> <span class="kwd">with</span> (<span class="id">bpow</span> (- 1) * <span class="id">u1</span> ^ 2).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">unfold</span> <span class="id">pow</span>; <span class="tactic">rewrite</span> <span class="id">Rmult_1_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">u2</span>, <span class="id">u1</span>, <span class="id">ulp</span>, <span class="id">canonic_exp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bpow_le</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Zplus_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Hexp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">Rmult_le_compat_r</span>; [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">pow2_ge_0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Fcore_Raux.bpow</span>; <span class="tactic">simpl</span>; <span class="tactic">unfold</span> <span class="id">Z.pow_pos</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Zmult_1_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rinv_le</span>; [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> 2 <span class="kwd">with</span> (<span class="id">Z2R</span> 2); <span class="tactic">apply</span> <span class="id">Z2R_le</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">assert</span> (<span class="id">u2</span> ^ 2 &lt; <span class="id">u1</span> ^ 2); [|<span class="tactic">unfold</span> <span class="id">b</span>'; <span class="id">lra</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">pow</span>; <span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id">Rmult_1_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H</span>' : 0 &lt;= <span class="id">u2</span>); [<span class="tactic">unfold</span> <span class="id">u2</span>, <span class="id">ulp</span>; <span class="tactic">apply</span> <span class="id">bpow_ge_0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">u2</span> &lt; <span class="id">u1</span>); [|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rmult_lt_compat</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">u1</span>, <span class="id">u2</span>, <span class="id">ulp</span>, <span class="id">canonic_exp</span>; <span class="tactic">apply</span> <span class="id">bpow_lt</span>; <span class="tactic">omega</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rlt_irrefl</span> (<span class="id">a</span> * <span class="id">a</span> + <span class="id">u1</span> * <span class="id">a</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rlt_le_trans</span> <span class="kwd">with</span> (<span class="id">a</span> * <span class="id">a</span> + <span class="id">u1</span> * <span class="id">a</span> - <span class="id">u2</span> * <span class="id">a</span> + <span class="id">b</span> * <span class="id">b</span>).<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> &lt;- (<span class="id">Rplus_0_r</span> (<span class="id">a</span> * <span class="id">a</span> + <span class="id">_</span>)) <span class="tactic">at</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Rminus</span>; <span class="tactic">rewrite</span> (<span class="id">Rplus_assoc</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">b</span> * <span class="id">b</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rplus_lt_compat_l</span>.<br/>
&nbsp;&nbsp;+ <span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rle_trans</span> <span class="kwd">with</span> <span class="id">x</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_sqrt_beta_ge_4</span> :<br/>
&nbsp;&nbsp;(4 &lt;= <span class="id">beta</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>,<br/>
&nbsp;&nbsp;<span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt; <span class="id">Valid_exp</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">choice1</span> <span class="id">choice2</span> : <span class="id">Z</span> -&gt; <span class="id">bool</span>),<br/>
&nbsp;&nbsp;<span class="id">double_round_sqrt_beta_ge_4_hyp</span> <span class="id">fexp1</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> (<span class="id">sqrt</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5502')">Proof.</div>
<div class="proofscript" id="proof5502">
<span class="tactic">intros</span> <span class="id">Hbeta</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Vfexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hexp</span> <span class="id">x</span> <span class="id">Fx</span>.<br/>
<span class="tactic">unfold</span> <span class="id">double_round_eq</span>.<br/>
<span class="tactic">destruct</span> (<span class="id">Rle_or_lt</span> <span class="id">x</span> 0) <span class="kwd">as</span> [<span class="id">Npx</span>|<span class="id">Px</span>].<br/>
- <span class="comment">(*&nbsp;x&nbsp;&lt;=&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hs</span> : <span class="id">sqrt</span> <span class="id">x</span> = 0).<br/>
&nbsp;&nbsp;{ <span class="tactic">destruct</span> (<span class="id">Req_dec</span> <span class="id">x</span> 0) <span class="kwd">as</span> [<span class="id">Zx</span>|<span class="id">Nzx</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;x&nbsp;=&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Zx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">sqrt_0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;x&nbsp;&lt;&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">sqrt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Rcase_abs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">casetype</span> <span class="id">False</span>; <span class="id">lra</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hs</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">round_0</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;+ <span class="id">now</span> <span class="tactic">apply</span> <span class="id">valid_rnd_N</span>.<br/>
- <span class="comment">(*&nbsp;0&nbsp;&lt;&nbsp;x&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hfx</span> : (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt; <span class="id">ln_beta</span> <span class="id">x</span>)%<span class="id">Z</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_generic_gt</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="id">lra</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hfsx</span> : (<span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>)) &lt; <span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>))%<span class="id">Z</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">destruct</span> (<span class="id">Rle_or_lt</span> <span class="id">x</span> 1) <span class="kwd">as</span> [<span class="id">Hx</span>|<span class="id">Hx</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;x&nbsp;&lt;=&nbsp;1&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">valid_exp_large</span> <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>)); [<span class="tactic">exact</span> <span class="id">Hfx</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">ln_beta_le</span>; [<span class="tactic">exact</span> <span class="id">Px</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">sqrt_def</span> <span class="id">x</span>) <span class="tactic">at</span> 1; [|<span class="id">lra</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Rmult_1_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rmult_le_compat_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">sqrt_pos</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> &lt;- <span class="id">sqrt_1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">sqrt_le_1_alt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;1&nbsp;&lt;&nbsp;x&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> ((<span class="id">proj1</span> (<span class="id">proj2</span> <span class="id">Hexp</span>)) 1%<span class="id">Z</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">_</span> - 1)%<span class="id">Z</span> <span class="kwd">with</span> 1%<span class="id">Z</span> <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hexp10</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hf0</span> : (<span class="id">fexp1</span> 1 &lt; 1)%<span class="id">Z</span>); [<span class="tactic">omega</span>|<span class="tactic">clear</span> <span class="id">Hexp10</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">valid_exp_large</span> <span class="id">fexp1</span> 1); [<span class="tactic">exact</span> <span class="id">Hf0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">ln_beta_ge_bpow</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Zeq_minus</span>; [|<span class="tactic">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Fcore_Raux.bpow</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rabs_ge</span>; <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">sqrt_1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">sqrt_le_1_alt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rlt_le</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hf2</span> : (<span class="id">fexp2</span> (<span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>)) &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>)) - 1)%<span class="id">Z</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">assert</span> (<span class="id">H</span> : (<span class="id">fexp1</span> (2 * <span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>)) &lt; 2 * <span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>))%<span class="id">Z</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> (<span class="id">ln_beta_sqrt_disj</span> <span class="id">x</span> <span class="id">Px</span>) <span class="kwd">as</span> [<span class="id">Hlx</span>|<span class="id">Hlx</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id">valid_exp_large</span> <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>)); [|<span class="tactic">omega</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_generic_gt</span>; [|<span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> &lt;- <span class="id">Hlx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_generic_gt</span>; [|<span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>|]. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> ((<span class="id">proj2</span> (<span class="id">proj2</span> <span class="id">Hexp</span>)) (<span class="id">ln_beta</span> (<span class="id">sqrt</span> <span class="id">x</span>)) <span class="id">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">double_round_mid_cases</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">exact</span> <span class="id">Vfexp1</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">exact</span> <span class="id">Vfexp2</span>.<br/>
&nbsp;&nbsp;+ <span class="id">now</span> <span class="tactic">apply</span> <span class="id">sqrt_lt_R0</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">Hmid</span>; <span class="id">casetype</span> <span class="id">False</span>; <span class="tactic">apply</span> (<span class="id">Rle_not_lt</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hmid</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">double_round_sqrt_beta_ge_4_aux</span> <span class="id">Hbeta</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Vfexp2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hexp</span> <span class="id">x</span> <span class="id">Px</span> <span class="id">Hf2</span> <span class="id">Fx</span>).<br/>
Qed.</div>
<br/>
<span class="kwd">Section</span> <span class="id">Double_round_sqrt_beta_ge_4_FLX</span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Fcore_FLX</span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id">prec</span> : <span class="id">Z</span>.<br/>
<span class="kwd">Variable</span> <span class="id">prec</span>' : <span class="id">Z</span>.<br/>
<br/>
<span class="kwd">Context</span> { <span class="id">prec_gt_0_</span> : <span class="id">Prec_gt_0</span> <span class="id">prec</span> }.<br/>
<span class="kwd">Context</span> { <span class="id">prec_gt_0_</span>' : <span class="id">Prec_gt_0</span> <span class="id">prec</span>' }.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">FLX_double_round_sqrt_beta_ge_4_hyp</span> :<br/>
&nbsp;&nbsp;(2 * <span class="id">prec</span> + 1 &lt;= <span class="id">prec</span>')%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_sqrt_beta_ge_4_hyp</span> (<span class="id">FLX_exp</span> <span class="id">prec</span>) (<span class="id">FLX_exp</span> <span class="id">prec</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5503')">Proof.</div>
<div class="proofscript" id="proof5503">
<span class="tactic">intros</span> <span class="id">Hprec</span>.<br/>
<span class="tactic">unfold</span> <span class="id">FLX_exp</span>.<br/>
<span class="tactic">unfold</span> <span class="id">Prec_gt_0</span> <span class="kwd">in</span> <span class="id">prec_gt_0_</span>.<br/>
<span class="tactic">unfold</span> <span class="id">double_round_sqrt_beta_ge_4_hyp</span>; <span class="tactic">split</span>; [|<span class="tactic">split</span>]; <span class="tactic">intro</span> <span class="id">ex</span>; <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id">double_round_sqrt_beta_ge_4_FLX</span> :<br/>
&nbsp;&nbsp;(4 &lt;= <span class="id">beta</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">choice1</span> <span class="id">choice2</span>,<br/>
&nbsp;&nbsp;(2 * <span class="id">prec</span> + 1 &lt;= <span class="id">prec</span>')%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;<span class="id">FLX_format</span> <span class="id">beta</span> <span class="id">prec</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> (<span class="id">FLX_exp</span> <span class="id">prec</span>) (<span class="id">FLX_exp</span> <span class="id">prec</span>') <span class="id">choice1</span> <span class="id">choice2</span> (<span class="id">sqrt</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5504')">Proof.</div>
<div class="proofscript" id="proof5504">
<span class="tactic">intros</span> <span class="id">Hbeta</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hprec</span> <span class="id">x</span> <span class="id">Fx</span>.<br/>
<span class="tactic">apply</span> <span class="id">double_round_sqrt_beta_ge_4</span>.<br/>
- <span class="tactic">exact</span> <span class="id">Hbeta</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLX_exp_valid</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLX_exp_valid</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLX_double_round_sqrt_beta_ge_4_hyp</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FLX</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">Double_round_sqrt_beta_ge_4_FLX</span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id">Double_round_sqrt_beta_ge_4_FLT</span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Fcore_FLX</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Fcore_FLT</span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id">emin</span> <span class="id">prec</span> : <span class="id">Z</span>.<br/>
<span class="kwd">Variable</span> <span class="id">emin</span>' <span class="id">prec</span>' : <span class="id">Z</span>.<br/>
<br/>
<span class="kwd">Context</span> { <span class="id">prec_gt_0_</span> : <span class="id">Prec_gt_0</span> <span class="id">prec</span> }.<br/>
<span class="kwd">Context</span> { <span class="id">prec_gt_0_</span>' : <span class="id">Prec_gt_0</span> <span class="id">prec</span>' }.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">FLT_double_round_sqrt_beta_ge_4_hyp</span> :<br/>
&nbsp;&nbsp;(<span class="id">emin</span> &lt;= 0)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;((<span class="id">emin</span>' &lt;= <span class="id">emin</span> - <span class="id">prec</span> - 1)%<span class="id">Z</span><br/>
&nbsp;&nbsp;&nbsp;\/ (2 * <span class="id">emin</span>' &lt;= <span class="id">emin</span> - 4 * <span class="id">prec</span>)%<span class="id">Z</span>) -&gt;<br/>
&nbsp;&nbsp;(2 * <span class="id">prec</span> + 1 &lt;= <span class="id">prec</span>')%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_sqrt_beta_ge_4_hyp</span> (<span class="id">FLT_exp</span> <span class="id">emin</span> <span class="id">prec</span>) (<span class="id">FLT_exp</span> <span class="id">emin</span>' <span class="id">prec</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5505')">Proof.</div>
<div class="proofscript" id="proof5505">
<span class="tactic">intros</span> <span class="id">Hemin</span> <span class="id">Heminprec</span> <span class="id">Hprec</span>.<br/>
<span class="tactic">unfold</span> <span class="id">FLT_exp</span>.<br/>
<span class="tactic">unfold</span> <span class="id">Prec_gt_0</span> <span class="kwd">in</span> <span class="id">prec_gt_0_</span>.<br/>
<span class="tactic">unfold</span> <span class="id">double_round_sqrt_beta_ge_4_hyp</span>; <span class="tactic">split</span>; [|<span class="tactic">split</span>]; <span class="tactic">intros</span> <span class="id">ex</span>.<br/>
- <span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>) <span class="id">emin</span>).<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (2 * <span class="id">ex</span> - <span class="id">prec</span>) <span class="id">emin</span>).<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
- <span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>) <span class="id">emin</span>).<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (2 * <span class="id">ex</span> - 1 - <span class="id">prec</span>) <span class="id">emin</span>).<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
- <span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (2 * <span class="id">ex</span> - <span class="id">prec</span>) <span class="id">emin</span>).<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>') <span class="id">emin</span>').<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>) <span class="id">emin</span>).<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id">double_round_sqrt_beta_ge_4_FLT</span> :<br/>
&nbsp;&nbsp;(4 &lt;= <span class="id">beta</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">choice1</span> <span class="id">choice2</span>,<br/>
&nbsp;&nbsp;(<span class="id">emin</span> &lt;= 0)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;((<span class="id">emin</span>' &lt;= <span class="id">emin</span> - <span class="id">prec</span> - 1)%<span class="id">Z</span><br/>
&nbsp;&nbsp;&nbsp;\/ (2 * <span class="id">emin</span>' &lt;= <span class="id">emin</span> - 4 * <span class="id">prec</span>)%<span class="id">Z</span>) -&gt;<br/>
&nbsp;&nbsp;(2 * <span class="id">prec</span> + 1 &lt;= <span class="id">prec</span>')%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;<span class="id">FLT_format</span> <span class="id">beta</span> <span class="id">emin</span> <span class="id">prec</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> (<span class="id">FLT_exp</span> <span class="id">emin</span> <span class="id">prec</span>) (<span class="id">FLT_exp</span> <span class="id">emin</span>' <span class="id">prec</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">choice1</span> <span class="id">choice2</span> (<span class="id">sqrt</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5506')">Proof.</div>
<div class="proofscript" id="proof5506">
<span class="tactic">intros</span> <span class="id">Hbeta</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hemin</span> <span class="id">Heminprec</span> <span class="id">Hprec</span> <span class="id">x</span> <span class="id">Fx</span>.<br/>
<span class="tactic">apply</span> <span class="id">double_round_sqrt_beta_ge_4</span>.<br/>
- <span class="tactic">exact</span> <span class="id">Hbeta</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLT_exp_valid</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLT_exp_valid</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLT_double_round_sqrt_beta_ge_4_hyp</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FLT</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">Double_round_sqrt_beta_ge_4_FLT</span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id">Double_round_sqrt_beta_ge_4_FTZ</span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Fcore_FLX</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Fcore_FTZ</span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id">emin</span> <span class="id">prec</span> : <span class="id">Z</span>.<br/>
<span class="kwd">Variable</span> <span class="id">emin</span>' <span class="id">prec</span>' : <span class="id">Z</span>.<br/>
<br/>
<span class="kwd">Context</span> { <span class="id">prec_gt_0_</span> : <span class="id">Prec_gt_0</span> <span class="id">prec</span> }.<br/>
<span class="kwd">Context</span> { <span class="id">prec_gt_0_</span>' : <span class="id">Prec_gt_0</span> <span class="id">prec</span>' }.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">FTZ_double_round_sqrt_beta_ge_4_hyp</span> :<br/>
&nbsp;&nbsp;(2 * (<span class="id">emin</span>' + <span class="id">prec</span>') &lt;= <span class="id">emin</span> + <span class="id">prec</span> &lt;= 1)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;(2 * <span class="id">prec</span> + 1 &lt;= <span class="id">prec</span>')%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_sqrt_beta_ge_4_hyp</span> (<span class="id">FTZ_exp</span> <span class="id">emin</span> <span class="id">prec</span>) (<span class="id">FTZ_exp</span> <span class="id">emin</span>' <span class="id">prec</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5507')">Proof.</div>
<div class="proofscript" id="proof5507">
<span class="tactic">intros</span> <span class="id">Hemin</span> <span class="id">Hprec</span>.<br/>
<span class="tactic">unfold</span> <span class="id">FTZ_exp</span>.<br/>
<span class="tactic">unfold</span> <span class="id">Prec_gt_0</span> <span class="kwd">in</span> *.<br/>
<span class="tactic">unfold</span> <span class="id">double_round_sqrt_beta_ge_4_hyp</span>; <span class="tactic">split</span>; [|<span class="tactic">split</span>]; <span class="tactic">intros</span> <span class="id">ex</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>) <span class="id">emin</span>);<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (2 * <span class="id">ex</span> - <span class="id">prec</span>) <span class="id">emin</span>);<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>) <span class="id">emin</span>);<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (2 * <span class="id">ex</span> - 1 - <span class="id">prec</span>) <span class="id">emin</span>);<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
- <span class="tactic">intro</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Zle_or_lt</span> <span class="id">emin</span> (2 * <span class="id">ex</span> - <span class="id">prec</span>)) <span class="kwd">as</span> [<span class="id">H</span>'|<span class="id">H</span>'].<br/>
&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>') <span class="id">emin</span>');<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>) <span class="id">emin</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;+ <span class="id">casetype</span> <span class="id">False</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Zlt_bool_true</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span>') <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id">double_round_sqrt_beta_ge_4_FTZ</span> :<br/>
&nbsp;&nbsp;(4 &lt;= <span class="id">beta</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">choice1</span> <span class="id">choice2</span>,<br/>
&nbsp;&nbsp;(2 * (<span class="id">emin</span>' + <span class="id">prec</span>') &lt;= <span class="id">emin</span> + <span class="id">prec</span> &lt;= 1)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;(2 * <span class="id">prec</span> + 1 &lt;= <span class="id">prec</span>')%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;<span class="id">FTZ_format</span> <span class="id">beta</span> <span class="id">emin</span> <span class="id">prec</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> (<span class="id">FTZ_exp</span> <span class="id">emin</span> <span class="id">prec</span>) (<span class="id">FTZ_exp</span> <span class="id">emin</span>' <span class="id">prec</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">choice1</span> <span class="id">choice2</span> (<span class="id">sqrt</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5508')">Proof.</div>
<div class="proofscript" id="proof5508">
<span class="tactic">intros</span> <span class="id">Hbeta</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hemin</span> <span class="id">Hprec</span> <span class="id">x</span> <span class="id">Fx</span>.<br/>
<span class="tactic">apply</span> <span class="id">double_round_sqrt_beta_ge_4</span>.<br/>
- <span class="tactic">exact</span> <span class="id">Hbeta</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FTZ_exp_valid</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FTZ_exp_valid</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FTZ_double_round_sqrt_beta_ge_4_hyp</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FTZ</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">Double_round_sqrt_beta_ge_4_FTZ</span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id">Double_round_sqrt_beta_ge_4</span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id">Double_round_sqrt</span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id">Double_round_div</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_eq_mid_beta_even</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>),<br/>
&nbsp;&nbsp;<span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt; <span class="id">Valid_exp</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">choice1</span> <span class="id">choice2</span> : <span class="id">Z</span> -&gt; <span class="id">bool</span>),<br/>
&nbsp;&nbsp;(<span class="id">exists</span> <span class="id">n</span>, (<span class="id">beta</span> = 2 * <span class="id">n</span> :&gt; <span class="id">Z</span>)%<span class="id">Z</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;0 &lt; <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">fexp2</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - 1)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt;= <span class="id">ln_beta</span> <span class="id">x</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">x</span> = <span class="id">midp</span> <span class="id">fexp1</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5509')">Proof.</div>
<div class="proofscript" id="proof5509">
<span class="tactic">intros</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Vfexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Ebeta</span> <span class="id">x</span> <span class="id">Px</span> <span class="id">Hf2</span> <span class="id">Hf1</span>.<br/>
<span class="tactic">unfold</span> <span class="id">double_round_eq</span>.<br/>
<span class="tactic">unfold</span> <span class="id">midp</span>.<br/>
<span class="tactic">set</span> (<span class="id">rd</span> := <span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zfloor</span> <span class="id">x</span>).<br/>
<span class="tactic">set</span> (<span class="id">u</span> := <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span>).<br/>
<span class="tactic">intro</span> <span class="id">H</span>; <span class="tactic">apply</span> (<span class="id">Rplus_eq_compat_l</span> (- <span class="id">rd</span>)) <span class="kwd">in</span> <span class="id">H</span>.<br/>
<span class="id">ring_simplify</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">revert</span> <span class="id">H</span>.<br/>
<span class="tactic">rewrite</span> <span class="id">Rplus_comm</span>; <span class="id">fold</span> (<span class="id">Rminus</span> <span class="id">x</span> <span class="id">rd</span>).<br/>
<span class="tactic">intro</span> <span class="id">Xmid</span>.<br/>
<span class="tactic">destruct</span> <span class="id">Ebeta</span> <span class="kwd">as</span> (<span class="id">n</span>,<span class="id">Ebeta</span>).<br/>
<span class="tactic">assert</span> (<span class="id">Hbeta</span> : (2 &lt;= <span class="id">beta</span>)%<span class="id">Z</span>).<br/>
{ <span class="tactic">destruct</span> <span class="id">beta</span> <span class="kwd">as</span> (<span class="id">beta_val</span>,<span class="id">beta_prop</span>).<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Zle_bool_imp_le</span>. }<br/>
<span class="tactic">apply</span> (<span class="id">Rplus_eq_compat_l</span> <span class="id">rd</span>) <span class="kwd">in</span> <span class="id">Xmid</span>; <span class="id">ring_simplify</span> <span class="kwd">in</span> <span class="id">Xmid</span>.<br/>
<span class="tactic">rewrite</span> (<span class="id">round_generic</span> <span class="id">beta</span> <span class="id">fexp2</span>); [<span class="tactic">reflexivity</span>|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">valid_rnd_N</span>|].<br/>
<span class="tactic">set</span> (<span class="id">f</span> := <span class="id">Float</span> <span class="id">beta</span> (<span class="id">Zfloor</span> (<span class="id">scaled_mantissa</span> <span class="id">beta</span> <span class="id">fexp2</span> <span class="id">rd</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">n</span> * <span class="id">beta</span> ^ (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">fexp2</span> (<span class="id">ln_beta</span> <span class="id">x</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">canonic_exp</span> <span class="id">beta</span> <span class="id">fexp2</span> <span class="id">x</span>)).<br/>
<span class="tactic">assert</span> (<span class="id">Hf</span> : <span class="id">F2R</span> <span class="id">f</span> = <span class="id">x</span>).<br/>
{ <span class="tactic">unfold</span> <span class="id">f</span>, <span class="id">F2R</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Z2R_plus</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_plus_distr_r</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Z2R_mult</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Z2R_Zpower</span>; [|<span class="tactic">omega</span>].<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">canonic_exp</span> <span class="tactic">at</span> 2; <span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Zminus</span>; <span class="tactic">rewrite</span> <span class="id">bpow_plus</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Rmult_comm</span> <span class="id">_</span> (<span class="id">bpow</span> (- 1))).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rmult_assoc</span> (<span class="id">Z2R</span> <span class="id">n</span>)).<br/>
&nbsp;&nbsp;<span class="id">change</span> (<span class="id">bpow</span> (- 1)) <span class="kwd">with</span> (/ <span class="id">Z2R</span> (<span class="id">beta</span> * 1)).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Zmult_1_r</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ebeta</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Z2R_mult</span> 2).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rinv_mult_distr</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="tactic">simpl</span>; <span class="id">lra</span>|<span class="id">change</span> 0 <span class="kwd">with</span> (<span class="id">Z2R</span> 0); <span class="tactic">apply</span> <span class="id">Z2R_neq</span>; <span class="tactic">omega</span>].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Rmult_assoc</span>; <span class="tactic">rewrite</span> (<span class="id">Rmult_comm</span> (<span class="id">Z2R</span> <span class="id">n</span>));<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Rmult_assoc</span> <span class="id">_</span> (<span class="id">Z2R</span> <span class="id">n</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rinv_r</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">rewrite</span> <span class="id">Rmult_1_r</span>|<span class="id">change</span> 0 <span class="kwd">with</span> (<span class="id">Z2R</span> 0); <span class="tactic">apply</span> <span class="id">Z2R_neq</span>; <span class="tactic">omega</span>].<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="id">fold</span> (<span class="id">canonic_exp</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- 2!<span class="id">ulp_neq_0</span>; <span class="tactic">try</span> <span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>.<br/>
&nbsp;&nbsp;<span class="id">fold</span> <span class="id">u</span>; <span class="tactic">rewrite</span> <span class="id">Xmid</span> <span class="tactic">at</span> 2.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">f_equal2</span>; [|<span class="tactic">reflexivity</span>].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">ulp_neq_0</span>; <span class="tactic">try</span> <span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Req_dec</span> <span class="id">rd</span> 0) <span class="kwd">as</span> [<span class="id">Zrd</span>|<span class="id">Nzrd</span>].<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;rd&nbsp;=&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Zrd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">scaled_mantissa_0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> 0 <span class="kwd">with</span> (<span class="id">Z2R</span> 0) <span class="tactic">at</span> 1; <span class="tactic">rewrite</span> <span class="id">Zfloor_Z2R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">rewrite</span> <span class="id">Rmult_0_l</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;rd&nbsp;&lt;&gt;&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Nnrd</span> : 0 &lt;= <span class="id">rd</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">round_DN_pt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">exact</span> <span class="id">Vfexp1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">generic_format_0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rlt_le</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Prd</span> : 0 &lt; <span class="id">rd</span>); [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Lrd</span> : (<span class="id">ln_beta</span> <span class="id">rd</span> = <span class="id">ln_beta</span> <span class="id">x</span> :&gt; <span class="id">Z</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">Zle_antisym</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">ln_beta_le</span>; [<span class="tactic">exact</span> <span class="id">Prd</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">round_DN_pt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">ln_beta_round_ge</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">exact</span> <span class="id">Vfexp1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">now</span> <span class="tactic">apply</span> <span class="id">valid_rnd_DN</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">exact</span> <span class="id">Nzrd</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">scaled_mantissa</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rd</span> <span class="tactic">at</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">round</span>, <span class="id">F2R</span>, <span class="id">scaled_mantissa</span>, <span class="id">canonic_exp</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Lrd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Z2R_Zpower</span> <span class="id">_</span> (<span class="id">_</span> - <span class="id">_</span>)); [|<span class="tactic">omega</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Z2R_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Zfloor_imp</span> (<span class="id">Zfloor</span> (<span class="id">x</span> * <span class="id">bpow</span> (- <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))) *<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">beta</span> ^ (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - <span class="id">fexp2</span> (<span class="id">ln_beta</span> <span class="id">x</span>)))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">Z2R_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Z2R_Zpower</span>; [|<span class="tactic">omega</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">unfold</span> <span class="id">rd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">split</span>; [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rle_refl</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Z2R_plus</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="id">lra</span>. }<br/>
<span class="tactic">apply</span> (<span class="id">generic_format_F2R</span>' <span class="id">_</span> <span class="id">_</span> <span class="id">x</span> <span class="id">f</span> <span class="id">Hf</span>).<br/>
<span class="tactic">intros</span> <span class="id">_</span>.<br/>
<span class="tactic">apply</span> <span class="id">Zle_refl</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_really_zero</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>),<br/>
&nbsp;&nbsp;<span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt; <span class="id">Valid_exp</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">choice1</span> <span class="id">choice2</span> : <span class="id">Z</span> -&gt; <span class="id">bool</span>),<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;0 &lt; <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">ln_beta</span> <span class="id">x</span> &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - 2)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5510')">Proof.</div>
<div class="proofscript" id="proof5510">
<span class="tactic">intros</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Vfexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">x</span> <span class="id">Px</span> <span class="id">Hf1</span>.<br/>
<span class="tactic">assert</span> (<span class="id">Hlx</span> : <span class="id">bpow</span> (<span class="id">ln_beta</span> <span class="id">x</span> - 1) &lt;= <span class="id">x</span> &lt; <span class="id">bpow</span> (<span class="id">ln_beta</span> <span class="id">x</span>)).<br/>
{ <span class="tactic">destruct</span> (<span class="id">ln_beta</span> <span class="id">x</span>) <span class="kwd">as</span> (<span class="id">ex</span>,<span class="id">Hex</span>); <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rabs_right</span> <span class="id">x</span>); [|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rle_ge</span>; <span class="tactic">apply</span> <span class="id">Rlt_le</span>].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hex</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>. }<br/>
<span class="tactic">unfold</span> <span class="id">double_round_eq</span>.<br/>
<span class="tactic">rewrite</span> (<span class="id">round_N_really_small_pos</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">_</span> <span class="id">x</span> (<span class="id">ln_beta</span> <span class="id">x</span>)); [|<span class="tactic">exact</span> <span class="id">Hlx</span>|<span class="tactic">omega</span>].<br/>
<span class="tactic">set</span> (<span class="id">x</span>'' := <span class="id">round</span> <span class="id">beta</span> <span class="id">fexp2</span> (<span class="id">Znearest</span> <span class="id">choice2</span>) <span class="id">x</span>).<br/>
<span class="tactic">destruct</span> (<span class="id">Req_dec</span> <span class="id">x</span>'' 0) <span class="kwd">as</span> [<span class="id">Zx</span>''|<span class="id">Nzx</span>''];<br/>
&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">rewrite</span> <span class="id">Zx</span>''; <span class="tactic">rewrite</span> <span class="id">round_0</span>; [|<span class="tactic">apply</span> <span class="id">valid_rnd_N</span>]|].<br/>
<span class="tactic">destruct</span> (<span class="id">Zle_or_lt</span> (<span class="id">fexp2</span> (<span class="id">ln_beta</span> <span class="id">x</span>)) (<span class="id">ln_beta</span> <span class="id">x</span>)).<br/>
- <span class="comment">(*&nbsp;fexp2&nbsp;(ln_beta&nbsp;x)&nbsp;&lt;=&nbsp;ln_beta&nbsp;x&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Rlt_or_le</span> <span class="id">x</span>'' (<span class="id">bpow</span> (<span class="id">ln_beta</span> <span class="id">x</span>))).<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;x''&nbsp;&lt;&nbsp;bpow&nbsp;(ln_beta&nbsp;x)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">round_N_really_small_pos</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">ln_beta</span> <span class="id">x</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">reflexivity</span>|<span class="tactic">split</span>; [|<span class="tactic">exact</span> <span class="id">H0</span>]|<span class="tactic">omega</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">round_large_pos_ge_pow</span>; [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">valid_rnd_N</span>| |<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Hlx</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fold</span> <span class="id">x</span>''; <span class="tactic">assert</span> (0 &lt;= <span class="id">x</span>''); [|<span class="id">lra</span>]; <span class="tactic">unfold</span> <span class="id">x</span>''.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">round_0</span> <span class="id">beta</span> <span class="id">fexp2</span> (<span class="id">Znearest</span> <span class="id">choice2</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">round_le</span>; [|<span class="tactic">apply</span> <span class="id">valid_rnd_N</span>|<span class="tactic">apply</span> <span class="id">Rlt_le</span>].<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;bpow&nbsp;(ln_beta&nbsp;x)&nbsp;&lt;=&nbsp;x''&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hx</span>'' : <span class="id">x</span>'' = <span class="id">bpow</span> (<span class="id">ln_beta</span> <span class="id">x</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">Rle_antisym</span>; [|<span class="tactic">exact</span> <span class="id">H0</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">round_generic</span> <span class="id">beta</span> <span class="id">fexp2</span> (<span class="id">Znearest</span> <span class="id">choice2</span>) (<span class="id">bpow</span> <span class="id">_</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">round_le</span>; [|<span class="tactic">apply</span> <span class="id">valid_rnd_N</span>|<span class="tactic">apply</span> <span class="id">Rlt_le</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_bpow</span>'. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hx</span>''.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">round</span>, <span class="id">F2R</span>, <span class="id">scaled_mantissa</span>, <span class="id">canonic_exp</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">ln_beta_bpow</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hf11</span> : (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span> + 1) = <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) :&gt; <span class="id">Z</span>)%<span class="id">Z</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">apply</span> <span class="id">Vfexp1</span>; <span class="tactic">omega</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hf11</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_eq_reg_r</span> (<span class="id">bpow</span> (- <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>; <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_0_l</span>; <span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> 0 <span class="kwd">with</span> (<span class="id">Z2R</span> 0); <span class="tactic">apply</span> <span class="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Znearest_imp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">unfold</span> <span class="id">Rminus</span>; <span class="tactic">rewrite</span> <span class="id">Ropp_0</span>; <span class="tactic">rewrite</span> <span class="id">Rplus_0_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rabs_right</span>; [|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rle_ge</span>; <span class="tactic">apply</span> <span class="id">bpow_ge_0</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rle_lt_trans</span> <span class="kwd">with</span> (<span class="id">bpow</span> (- 2)); [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_le</span>; <span class="tactic">omega</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Fcore_Raux.bpow</span>, <span class="id">Z.pow_pos</span>; <span class="tactic">simpl</span>; <span class="tactic">rewrite</span> <span class="id">Zmult_1_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hbeta</span> : (2 &lt;= <span class="id">beta</span>)%<span class="id">Z</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">beta</span> <span class="kwd">as</span> (<span class="id">beta_val</span>,<span class="id">beta_prop</span>); <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Zle_bool_imp_le</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rinv_lt_contravar</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">Rmult_lt_0_compat</span>; [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Z2R_mult</span>; <span class="tactic">apply</span> <span class="id">Rmult_lt_0_compat</span>; <span class="id">change</span> 0 <span class="kwd">with</span> (<span class="id">Z2R</span> 0);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Z2R_lt</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">change</span> 2 <span class="kwd">with</span> (<span class="id">Z2R</span> 2); <span class="tactic">apply</span> <span class="id">Z2R_lt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Zle_lt_trans</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hbeta</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Zmult_1_r</span> <span class="id">beta</span>) <span class="tactic">at</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Zmult_lt_compat_l</span>; <span class="tactic">omega</span>.<br/>
- <span class="comment">(*&nbsp;ln_beta&nbsp;x&nbsp;&lt;&nbsp;fexp2&nbsp;(ln_beta&nbsp;x)&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">casetype</span> <span class="id">False</span>; <span class="tactic">apply</span> <span class="id">Nzx</span>''.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> (<span class="id">round_N_really_small_pos</span> <span class="id">beta</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">ln_beta</span> <span class="id">x</span>)).<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_zero</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>,<br/>
&nbsp;&nbsp;<span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt; <span class="id">Valid_exp</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">choice1</span> <span class="id">choice2</span> : <span class="id">Z</span> -&gt; <span class="id">bool</span>),<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;0 &lt; <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) = <span class="id">ln_beta</span> <span class="id">x</span> + 1 :&gt; <span class="id">Z</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">x</span> &lt; <span class="id">bpow</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - / 2 * <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp2</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5511')">Proof.</div>
<div class="proofscript" id="proof5511">
<span class="tactic">intros</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Vfexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">x</span> <span class="id">Px</span> <span class="id">Hf1</span>.<br/>
<span class="tactic">unfold</span> <span class="id">double_round_eq</span>.<br/>
<span class="tactic">set</span> (<span class="id">x</span>'' := <span class="id">round</span> <span class="id">beta</span> <span class="id">fexp2</span> (<span class="id">Znearest</span> <span class="id">choice2</span>) <span class="id">x</span>).<br/>
<span class="tactic">set</span> (<span class="id">u1</span> := <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span>).<br/>
<span class="tactic">set</span> (<span class="id">u2</span> := <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp2</span> <span class="id">x</span>).<br/>
<span class="tactic">intro</span> <span class="id">Hx</span>.<br/>
<span class="tactic">assert</span> (<span class="id">Hlx</span> : <span class="id">bpow</span> (<span class="id">ln_beta</span> <span class="id">x</span> - 1) &lt;= <span class="id">x</span> &lt; <span class="id">bpow</span> (<span class="id">ln_beta</span> <span class="id">x</span>)).<br/>
{ <span class="tactic">destruct</span> (<span class="id">ln_beta</span> <span class="id">x</span>) <span class="kwd">as</span> (<span class="id">ex</span>,<span class="id">Hex</span>); <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rabs_right</span> <span class="id">x</span>); [|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rle_ge</span>; <span class="tactic">apply</span> <span class="id">Rlt_le</span>].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hex</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>. }<br/>
<span class="tactic">rewrite</span> (<span class="id">round_N_really_small_pos</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">choice1</span> <span class="id">x</span> (<span class="id">ln_beta</span> <span class="id">x</span>));<br/>
&nbsp;&nbsp;[|<span class="tactic">exact</span> <span class="id">Hlx</span>|<span class="tactic">omega</span>].<br/>
<span class="tactic">destruct</span> (<span class="id">Req_dec</span> <span class="id">x</span>'' 0) <span class="kwd">as</span> [<span class="id">Zx</span>''|<span class="id">Nzx</span>''];<br/>
&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">rewrite</span> <span class="id">Zx</span>''; <span class="tactic">rewrite</span> <span class="id">round_0</span>; [<span class="tactic">reflexivity</span>|<span class="tactic">apply</span> <span class="id">valid_rnd_N</span>]|].<br/>
<span class="tactic">rewrite</span> (<span class="id">round_N_really_small_pos</span> <span class="id">beta</span> <span class="id">_</span> <span class="id">_</span> <span class="id">x</span>'' (<span class="id">ln_beta</span> <span class="id">x</span>));<br/>
&nbsp;&nbsp;[<span class="tactic">reflexivity</span>| |<span class="tactic">omega</span>].<br/>
<span class="tactic">split</span>.<br/>
- <span class="tactic">apply</span> <span class="id">round_large_pos_ge_pow</span>.<br/>
&nbsp;&nbsp;+ <span class="id">now</span> <span class="tactic">apply</span> <span class="id">valid_rnd_N</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">assert</span> (0 &lt;= <span class="id">x</span>''); [|<span class="id">now</span> <span class="id">fold</span> <span class="id">x</span>''; <span class="id">lra</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">round_0</span> <span class="id">beta</span> <span class="id">fexp2</span> (<span class="id">Znearest</span> <span class="id">choice2</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">round_le</span>; [|<span class="tactic">apply</span> <span class="id">valid_rnd_N</span>|<span class="tactic">apply</span> <span class="id">Rlt_le</span>].<br/>
&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">Rle_trans</span> <span class="kwd">with</span> (<span class="id">Rabs</span> <span class="id">x</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="id">now</span> <span class="tactic">rewrite</span> <span class="id">Rabs_right</span>; [<span class="tactic">apply</span> <span class="id">Rle_refl</span>|<span class="tactic">apply</span> <span class="id">Rle_ge</span>; <span class="tactic">apply</span> <span class="id">Rlt_le</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">ln_beta</span> <span class="id">x</span>) <span class="kwd">as</span> (<span class="id">ex</span>,<span class="id">Hex</span>); <span class="tactic">simpl</span>; <span class="tactic">apply</span> <span class="id">Hex</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>.<br/>
- <span class="tactic">replace</span> <span class="id">x</span>'' <span class="kwd">with</span> (<span class="id">x</span> + (<span class="id">x</span>'' - <span class="id">x</span>)) <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">bpow</span> <span class="id">_</span>) <span class="kwd">with</span> (<span class="id">bpow</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - / 2 * <span class="id">u2</span> + / 2 * <span class="id">u2</span>) <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rplus_lt_le_compat</span>; [<span class="tactic">exact</span> <span class="id">Hx</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rabs_le_inv</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">error_le_half_ulp</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_all_mid_cases</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>,<br/>
&nbsp;&nbsp;<span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt; <span class="id">Valid_exp</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">choice1</span> <span class="id">choice2</span> : <span class="id">Z</span> -&gt; <span class="id">bool</span>),<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;0 &lt; <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">fexp2</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - 1)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;((<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) = <span class="id">ln_beta</span> <span class="id">x</span> + 1 :&gt; <span class="id">Z</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id">bpow</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - / 2 * <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp2</span> <span class="id">x</span> &lt;= <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id">double_round_eq</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">x</span>) -&gt;<br/>
&nbsp;&nbsp;((<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt;= <span class="id">ln_beta</span> <span class="id">x</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id">midp</span> <span class="id">fexp1</span> <span class="id">x</span> - / 2 * <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp2</span> <span class="id">x</span> &lt;= <span class="id">x</span> &lt; <span class="id">midp</span> <span class="id">fexp1</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id">double_round_eq</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">x</span>) -&gt;<br/>
&nbsp;&nbsp;((<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt;= <span class="id">ln_beta</span> <span class="id">x</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id">x</span> = <span class="id">midp</span> <span class="id">fexp1</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id">double_round_eq</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">x</span>) -&gt;<br/>
&nbsp;&nbsp;((<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt;= <span class="id">ln_beta</span> <span class="id">x</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id">midp</span> <span class="id">fexp1</span> <span class="id">x</span> &lt; <span class="id">x</span> &lt;= <span class="id">midp</span> <span class="id">fexp1</span> <span class="id">x</span> + / 2 * <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp2</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id">double_round_eq</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">x</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5512')">Proof.</div>
<div class="proofscript" id="proof5512">
<span class="tactic">intros</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Vfexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">x</span> <span class="id">Px</span> <span class="id">Hf2</span>.<br/>
<span class="tactic">set</span> (<span class="id">x</span>' := <span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zfloor</span> <span class="id">x</span>).<br/>
<span class="tactic">set</span> (<span class="id">u1</span> := <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span>).<br/>
<span class="tactic">set</span> (<span class="id">u2</span> := <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp2</span> <span class="id">x</span>).<br/>
<span class="tactic">intros</span> <span class="id">Cz</span> <span class="id">Clt</span> <span class="id">Ceq</span> <span class="id">Cgt</span>.<br/>
<span class="tactic">destruct</span> (<span class="id">Ztrichotomy</span> (<span class="id">ln_beta</span> <span class="id">x</span>) (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - 1)) <span class="kwd">as</span> [<span class="id">Hlt</span>|[<span class="id">Heq</span>|<span class="id">Hgt</span>]].<br/>
- <span class="comment">(*&nbsp;ln_beta&nbsp;x&nbsp;&lt;&nbsp;fexp1&nbsp;(ln_beta&nbsp;x)&nbsp;-&nbsp;1&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H</span> : (<span class="id">ln_beta</span> <span class="id">x</span> &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - 2)%<span class="id">Z</span>) <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">double_round_really_zero</span>.<br/>
- <span class="comment">(*&nbsp;ln_beta&nbsp;x&nbsp;=&nbsp;fexp1&nbsp;(ln_beta&nbsp;x)&nbsp;-&nbsp;1&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H</span> : (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) = (<span class="id">ln_beta</span> <span class="id">x</span> + 1))%<span class="id">Z</span>) <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Rlt_or_le</span> <span class="id">x</span> (<span class="id">bpow</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - / 2 * <span class="id">u2</span>)) <span class="kwd">as</span> [<span class="id">Hlt</span>'|<span class="id">Hge</span>'].<br/>
&nbsp;&nbsp;+ <span class="id">now</span> <span class="tactic">apply</span> <span class="id">double_round_zero</span>.<br/>
&nbsp;&nbsp;+ <span class="id">now</span> <span class="tactic">apply</span> <span class="id">Cz</span>.<br/>
- <span class="comment">(*&nbsp;ln_beta&nbsp;x&nbsp;&gt;&nbsp;fexp1&nbsp;(ln_beta&nbsp;x)&nbsp;-&nbsp;1&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H</span> : (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt;= <span class="id">ln_beta</span> <span class="id">x</span>)%<span class="id">Z</span>) <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Rtotal_order</span> <span class="id">x</span> (<span class="id">midp</span> <span class="id">fexp1</span> <span class="id">x</span>)) <span class="kwd">as</span> [<span class="id">Hlt</span>'|[<span class="id">Heq</span>'|<span class="id">Hgt</span>']].<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;x&nbsp;&lt;&nbsp;midp&nbsp;fexp1&nbsp;x&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Rlt_or_le</span> <span class="id">x</span> (<span class="id">midp</span> <span class="id">fexp1</span> <span class="id">x</span> - / 2 * <span class="id">u2</span>)) <span class="kwd">as</span> [<span class="id">Hlt</span>''|<span class="id">Hle</span>''].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">now</span> <span class="tactic">apply</span> <span class="id">double_round_lt_mid_further_place</span>; [| | |<span class="tactic">omega</span>| |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">now</span> <span class="tactic">apply</span> <span class="id">Clt</span>; [|<span class="tactic">split</span>].<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;x&nbsp;=&nbsp;midp&nbsp;fexp1&nbsp;x&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Ceq</span>.<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;x&nbsp;&gt;&nbsp;midp&nbsp;fexp1&nbsp;x&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Rle_or_lt</span> <span class="id">x</span> (<span class="id">midp</span> <span class="id">fexp1</span> <span class="id">x</span> + / 2 * <span class="id">u2</span>)) <span class="kwd">as</span> [<span class="id">Hlt</span>''|<span class="id">Hle</span>''].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">now</span> <span class="tactic">apply</span> <span class="id">Cgt</span>; [|<span class="tactic">split</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* { <span class="tactic">destruct</span> (<span class="id">generic_format_EM</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span>) <span class="kwd">as</span> [<span class="id">Fx</span>|<span class="id">Nfx</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;generic_format&nbsp;beta&nbsp;fexp1&nbsp;x&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">double_round_eq</span>; <span class="tactic">rewrite</span> (<span class="id">round_generic</span> <span class="id">beta</span> <span class="id">fexp2</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">reflexivity</span>|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">valid_rnd_N</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> (<span class="id">generic_inclusion_ln_beta</span> <span class="id">beta</span> <span class="id">fexp1</span>); [<span class="tactic">omega</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;~&nbsp;generic_format&nbsp;beta&nbsp;fexp1&nbsp;x&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hceil</span> : <span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zceil</span> <span class="id">x</span> = <span class="id">x</span>' + <span class="id">u1</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">round_UP_DN_ulp</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hf2</span>' : (<span class="id">fexp2</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt;= <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - 1)%<span class="id">Z</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">omega</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">midp</span>' <span class="id">fexp1</span> <span class="id">x</span> + / 2 * <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp2</span> <span class="id">x</span> &lt; <span class="id">x</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">double_round_gt_mid_further_place</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Hle</span>''; <span class="tactic">unfold</span> <span class="id">midp</span>, <span class="id">midp</span>'; <span class="id">fold</span> <span class="id">x</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hceil</span>; <span class="id">fold</span> <span class="id">u1</span>; <span class="id">fold</span> <span class="id">u2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lra</span>. }<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">ln_beta_div_disj</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> : <span class="id">R</span>,<br/>
&nbsp;&nbsp;0 &lt; <span class="id">x</span> -&gt; 0 &lt; <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;((<span class="id">ln_beta</span> (<span class="id">x</span> / <span class="id">y</span>) = <span class="id">ln_beta</span> <span class="id">x</span> - <span class="id">ln_beta</span> <span class="id">y</span> :&gt; <span class="id">Z</span>)%<span class="id">Z</span><br/>
&nbsp;&nbsp;&nbsp;\/ (<span class="id">ln_beta</span> (<span class="id">x</span> / <span class="id">y</span>) = <span class="id">ln_beta</span> <span class="id">x</span> - <span class="id">ln_beta</span> <span class="id">y</span> + 1 :&gt; <span class="id">Z</span>)%<span class="id">Z</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5513')">Proof.</div>
<div class="proofscript" id="proof5513">
<span class="tactic">intros</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Px</span> <span class="id">Py</span>.<br/>
<span class="tactic">generalize</span> (<span class="id">ln_beta_div</span> <span class="id">beta</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Px</span> <span class="id">Py</span>).<br/>
<span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">double_round_div_hyp</span> <span class="id">fexp1</span> <span class="id">fexp2</span> :=<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">ex</span>, (<span class="id">fexp2</span> <span class="id">ex</span> &lt;= <span class="id">fexp1</span> <span class="id">ex</span> - 1)%<span class="id">Z</span>)<br/>
&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">ex</span> <span class="id">ey</span>, (<span class="id">fexp1</span> <span class="id">ex</span> &lt; <span class="id">ex</span>)%<span class="id">Z</span> -&gt; (<span class="id">fexp1</span> <span class="id">ey</span> &lt; <span class="id">ey</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">fexp1</span> (<span class="id">ex</span> - <span class="id">ey</span>) &lt;= <span class="id">ex</span> - <span class="id">ey</span> + 1)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">fexp2</span> (<span class="id">ex</span> - <span class="id">ey</span>) &lt;= <span class="id">fexp1</span> <span class="id">ex</span> - <span class="id">ey</span>)%<span class="id">Z</span>)<br/>
&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">ex</span> <span class="id">ey</span>, (<span class="id">fexp1</span> <span class="id">ex</span> &lt; <span class="id">ex</span>)%<span class="id">Z</span> -&gt; (<span class="id">fexp1</span> <span class="id">ey</span> &lt; <span class="id">ey</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">fexp1</span> (<span class="id">ex</span> - <span class="id">ey</span> + 1) &lt;= <span class="id">ex</span> - <span class="id">ey</span> + 1 + 1)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">fexp2</span> (<span class="id">ex</span> - <span class="id">ey</span> + 1) &lt;= <span class="id">fexp1</span> <span class="id">ex</span> - <span class="id">ey</span>)%<span class="id">Z</span>)<br/>
&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">ex</span> <span class="id">ey</span>, (<span class="id">fexp1</span> <span class="id">ex</span> &lt; <span class="id">ex</span>)%<span class="id">Z</span> -&gt; (<span class="id">fexp1</span> <span class="id">ey</span> &lt; <span class="id">ey</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">fexp1</span> (<span class="id">ex</span> - <span class="id">ey</span>) &lt;= <span class="id">ex</span> - <span class="id">ey</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">fexp2</span> (<span class="id">ex</span> - <span class="id">ey</span>) &lt;= <span class="id">fexp1</span> (<span class="id">ex</span> - <span class="id">ey</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">fexp1</span> <span class="id">ey</span> - <span class="id">ey</span>)%<span class="id">Z</span>)<br/>
&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">ex</span> <span class="id">ey</span>, (<span class="id">fexp1</span> <span class="id">ex</span> &lt; <span class="id">ex</span>)%<span class="id">Z</span> -&gt; (<span class="id">fexp1</span> <span class="id">ey</span> &lt; <span class="id">ey</span>)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">fexp1</span> (<span class="id">ex</span> - <span class="id">ey</span>) = <span class="id">ex</span> - <span class="id">ey</span> + 1)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">fexp2</span> (<span class="id">ex</span> - <span class="id">ey</span>) &lt;= <span class="id">ex</span> - <span class="id">ey</span> - <span class="id">ey</span> + <span class="id">fexp1</span> <span class="id">ey</span>)%<span class="id">Z</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_div_aux0</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>,<br/>
&nbsp;&nbsp;<span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt; <span class="id">Valid_exp</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">choice1</span> <span class="id">choice2</span> : <span class="id">Z</span> -&gt; <span class="id">bool</span>),<br/>
&nbsp;&nbsp;<span class="id">double_round_div_hyp</span> <span class="id">fexp1</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;0 &lt; <span class="id">x</span> -&gt; 0 &lt; <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">x</span> / <span class="id">y</span>)) = (<span class="id">ln_beta</span> (<span class="id">x</span> / <span class="id">y</span>) + 1)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;~ (<span class="id">bpow</span> (<span class="id">ln_beta</span> (<span class="id">x</span> / <span class="id">y</span>)) - / 2 * <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp2</span> (<span class="id">x</span> / <span class="id">y</span>) &lt;= <span class="id">x</span> / <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5514')">Proof.</div>
<div class="proofscript" id="proof5514">
<span class="tactic">intros</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Vfexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hexp</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Px</span> <span class="id">Py</span> <span class="id">Fx</span> <span class="id">Fy</span> <span class="id">Hf1</span>.<br/>
<span class="tactic">assert</span> (<span class="id">Hfx</span> : (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt; <span class="id">ln_beta</span> <span class="id">x</span>)%<span class="id">Z</span>);<br/>
&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_generic_gt</span>; [|<span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>|]|].<br/>
<span class="tactic">assert</span> (<span class="id">Hfy</span> : (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">y</span>) &lt; <span class="id">ln_beta</span> <span class="id">y</span>)%<span class="id">Z</span>);<br/>
&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_generic_gt</span>; [|<span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>|]|].<br/>
<span class="tactic">set</span> (<span class="id">p</span> := <span class="id">bpow</span> (<span class="id">ln_beta</span> (<span class="id">x</span> / <span class="id">y</span>))).<br/>
<span class="tactic">set</span> (<span class="id">u2</span> := <span class="id">bpow</span> (<span class="id">fexp2</span> (<span class="id">ln_beta</span> (<span class="id">x</span> / <span class="id">y</span>)))).<br/>
<span class="id">revert</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">unfold</span> <span class="id">generic_format</span>, <span class="id">F2R</span>, <span class="id">scaled_mantissa</span>, <span class="id">canonic_exp</span>; <span class="tactic">simpl</span>.<br/>
<span class="tactic">set</span> (<span class="id">mx</span> := <span class="id">Ztrunc</span> (<span class="id">x</span> * <span class="id">bpow</span> (- <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>)))).<br/>
<span class="tactic">set</span> (<span class="id">my</span> := <span class="id">Ztrunc</span> (<span class="id">y</span> * <span class="id">bpow</span> (- <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">y</span>)))).<br/>
<span class="tactic">intros</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">rewrite</span> <span class="id">ulp_neq_0</span>.<br/>
2: <span class="tactic">apply</span> <span class="id">Rmult_integral_contrapositive_currified</span>; [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>|<span class="id">idtac</span>].<br/>
2: <span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rinv_neq_0_compat</span>, <span class="id">Rgt_not_eq</span>.<br/>
<span class="tactic">intro</span> <span class="id">Hl</span>.<br/>
<span class="tactic">assert</span> (<span class="id">Hr</span> : <span class="id">x</span> / <span class="id">y</span> &lt; <span class="id">p</span>);<br/>
&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rabs_lt_inv</span>; <span class="tactic">apply</span> <span class="id">bpow_ln_beta_gt</span>|].<br/>
<span class="tactic">apply</span> (<span class="id">Rlt_irrefl</span> (<span class="id">p</span> - / 2 * <span class="id">u2</span>)).<br/>
<span class="tactic">apply</span> (<span class="id">Rle_lt_trans</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hl</span>).<br/>
<span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_r</span> <span class="id">y</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Py</span>).<br/>
<span class="tactic">unfold</span> <span class="id">Rdiv</span>; <span class="tactic">rewrite</span> <span class="id">Rmult_assoc</span>.<br/>
<span class="tactic">rewrite</span> <span class="id">Rinv_l</span>; [|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>]; <span class="tactic">rewrite</span> <span class="id">Rmult_1_r</span>.<br/>
<span class="tactic">destruct</span> (<span class="id">Zle_or_lt</span> <span class="id">Z0</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - <span class="id">ln_beta</span> (<span class="id">x</span> / <span class="id">y</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">y</span>))%<span class="id">Z</span>) <span class="kwd">as</span> [<span class="id">He</span>|<span class="id">He</span>].<br/>
- <span class="comment">(*&nbsp;ln_beta&nbsp;(x&nbsp;/&nbsp;y)&nbsp;+&nbsp;fexp1&nbsp;(ln_beta&nbsp;y)&nbsp;&lt;=&nbsp;fexp1&nbsp;(ln_beta&nbsp;x)&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rle_lt_trans</span> <span class="kwd">with</span> (<span class="id">p</span> * <span class="id">y</span> - <span class="id">p</span> * <span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">y</span>))).<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">Fx</span>; <span class="tactic">rewrite</span> <span class="id">Fy</span> <span class="tactic">at</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Rmult_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Rmult_comm</span> <span class="id">p</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">p</span>; <span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_le_reg_r</span> (<span class="id">bpow</span> (- <span class="id">ln_beta</span> (<span class="id">x</span> / <span class="id">y</span>) - <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">y</span>))));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_minus_distr_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Z2R_Zpower</span>; [|<span class="tactic">exact</span> <span class="id">He</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Z2R_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> 1 <span class="kwd">with</span> (<span class="id">Z2R</span> 1); <span class="tactic">rewrite</span> &lt;- <span class="id">Z2R_minus</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Z2R_le</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Zplus_le_reg_r</span> <span class="id">_</span> <span class="id">_</span> 1); <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Zlt_le_succ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">lt_Z2R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Z2R_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Z2R_Zpower</span>; [|<span class="tactic">exact</span> <span class="id">He</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_r</span> (<span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">y</span>) + <span class="id">ln_beta</span> (<span class="id">x</span> / <span class="id">y</span>))));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Fx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">bpow_plus</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Rmult_assoc</span>; <span class="tactic">rewrite</span> &lt;- <span class="id">Fy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fold</span> <span class="id">p</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_r</span> (/ <span class="id">y</span>)); [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rinv_0_lt_compat</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">field_simplify</span>; <span class="id">lra</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">Rmult_minus_distr_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Rminus</span>; <span class="tactic">apply</span> <span class="id">Rplus_lt_compat_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Ropp_lt_contravar</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rlt_le_trans</span> <span class="kwd">with</span> (<span class="id">u2</span> * <span class="id">bpow</span> (<span class="id">ln_beta</span> <span class="id">y</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> &lt;- (<span class="id">Rmult_1_l</span> (<span class="id">u2</span> * <span class="id">_</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">Rmult_lt_compat</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rmult_le_pos</span>; [<span class="tactic">apply</span> <span class="id">bpow_ge_0</span>|<span class="tactic">apply</span> <span class="id">Rlt_le</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">Rmult_lt_compat_l</span>; [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rabs_lt_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bpow_ln_beta_gt</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">unfold</span> <span class="id">u2</span>, <span class="id">p</span>, <span class="id">ulp</span>, <span class="id">canonic_exp</span>; <span class="id">bpow_simplify</span>; <span class="tactic">apply</span> <span class="id">bpow_le</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Zplus_le_reg_r</span> <span class="id">_</span> <span class="id">_</span> (- <span class="id">ln_beta</span> <span class="id">y</span>)); <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Zplus_comm</span> (- <span class="id">_</span>)); <span class="id">fold</span> (<span class="id">Zminus</span> (<span class="id">ln_beta</span> (<span class="id">x</span> / <span class="id">y</span>)) (<span class="id">ln_beta</span> <span class="id">y</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">ln_beta_div_disj</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Px</span> <span class="id">Py</span>) <span class="kwd">as</span> [<span class="id">Hxy</span>|<span class="id">Hxy</span>]; <span class="tactic">rewrite</span> <span class="id">Hxy</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Hexp</span>; [| |<span class="tactic">rewrite</span> &lt;- <span class="id">Hxy</span>]|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">_</span> - <span class="id">_</span> + 1)%<span class="id">Z</span> <span class="kwd">with</span> ((<span class="id">ln_beta</span> <span class="id">x</span> + 1) - <span class="id">ln_beta</span> <span class="id">y</span>)%<span class="id">Z</span> <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hexp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">now</span> <span class="tactic">assert</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span> + 1) &lt;= <span class="id">ln_beta</span> <span class="id">x</span>)%<span class="id">Z</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">apply</span> <span class="id">valid_exp</span>|<span class="tactic">omega</span>]. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">_</span> + 1 - <span class="id">_</span>)%<span class="id">Z</span> <span class="kwd">with</span> (<span class="id">ln_beta</span> <span class="id">x</span> - <span class="id">ln_beta</span> <span class="id">y</span> + 1)%<span class="id">Z</span> <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">rewrite</span> &lt;- <span class="id">Hxy</span>.<br/>
- <span class="comment">(*&nbsp;fexp1&nbsp;(ln_beta&nbsp;x)&nbsp;&lt;&nbsp;ln_beta&nbsp;(x&nbsp;/&nbsp;y)&nbsp;+&nbsp;fexp1&nbsp;(ln_beta&nbsp;y)&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rle_lt_trans</span> <span class="kwd">with</span> (<span class="id">p</span> * <span class="id">y</span> - <span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))).<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">Fx</span> <span class="tactic">at</span> 1; <span class="tactic">rewrite</span> <span class="id">Fy</span> <span class="tactic">at</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_le_reg_r</span> (<span class="id">bpow</span> (- <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_minus_distr_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Rmult_comm</span> <span class="id">p</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">p</span>; <span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Z2R_Zpower</span>; [|<span class="tactic">omega</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Z2R_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> 1 <span class="kwd">with</span> (<span class="id">Z2R</span> 1); <span class="tactic">rewrite</span> &lt;- <span class="id">Z2R_minus</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Z2R_le</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Zplus_le_reg_r</span> <span class="id">_</span> <span class="id">_</span> 1); <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Zlt_le_succ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">lt_Z2R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Z2R_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Z2R_Zpower</span>; [|<span class="tactic">omega</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_r</span> (<span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|<span class="id">bpow_simplify</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Fx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Zplus_comm</span>; <span class="tactic">rewrite</span> <span class="id">bpow_plus</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Rmult_assoc</span>; <span class="tactic">rewrite</span> &lt;- <span class="id">Fy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fold</span> <span class="id">p</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_r</span> (/ <span class="id">y</span>)); [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rinv_0_lt_compat</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">field_simplify</span>; <span class="id">lra</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">Rmult_minus_distr_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Rminus</span>; <span class="tactic">apply</span> <span class="id">Rplus_lt_compat_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Ropp_lt_contravar</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rlt_le_trans</span> <span class="kwd">with</span> (<span class="id">u2</span> * <span class="id">bpow</span> (<span class="id">ln_beta</span> <span class="id">y</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> &lt;- (<span class="id">Rmult_1_l</span> (<span class="id">u2</span> * <span class="id">_</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">Rmult_lt_compat</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rmult_le_pos</span>; [<span class="tactic">apply</span> <span class="id">bpow_ge_0</span>|<span class="tactic">apply</span> <span class="id">Rlt_le</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">Rmult_lt_compat_l</span>; [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rabs_lt_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bpow_ln_beta_gt</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">unfold</span> <span class="id">u2</span>, <span class="id">p</span>, <span class="id">ulp</span>, <span class="id">canonic_exp</span>; <span class="id">bpow_simplify</span>; <span class="tactic">apply</span> <span class="id">bpow_le</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Zplus_le_reg_r</span> <span class="id">_</span> <span class="id">_</span> (- <span class="id">ln_beta</span> <span class="id">y</span>)); <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Zplus_comm</span> (- <span class="id">_</span>)); <span class="id">fold</span> (<span class="id">Zminus</span> (<span class="id">ln_beta</span> (<span class="id">x</span> / <span class="id">y</span>)) (<span class="id">ln_beta</span> <span class="id">y</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">ln_beta_div_disj</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Px</span> <span class="id">Py</span>) <span class="kwd">as</span> [<span class="id">Hxy</span>|<span class="id">Hxy</span>]; <span class="tactic">rewrite</span> <span class="id">Hxy</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hexp</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">rewrite</span> &lt;- <span class="id">Hxy</span>; <span class="tactic">rewrite</span> <span class="id">Hf1</span>; <span class="tactic">apply</span> <span class="id">Zle_refl</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_div_aux1</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>,<br/>
&nbsp;&nbsp;<span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt; <span class="id">Valid_exp</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">choice1</span> <span class="id">choice2</span> : <span class="id">Z</span> -&gt; <span class="id">bool</span>),<br/>
&nbsp;&nbsp;<span class="id">double_round_div_hyp</span> <span class="id">fexp1</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;0 &lt; <span class="id">x</span> -&gt; 0 &lt; <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">x</span> / <span class="id">y</span>)) &lt;= <span class="id">ln_beta</span> (<span class="id">x</span> / <span class="id">y</span>))%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;~ (<span class="id">midp</span> <span class="id">fexp1</span> (<span class="id">x</span> / <span class="id">y</span>) - / 2 * <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp2</span> (<span class="id">x</span> / <span class="id">y</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;= <span class="id">x</span> / <span class="id">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt; <span class="id">midp</span> <span class="id">fexp1</span> (<span class="id">x</span> / <span class="id">y</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5515')">Proof.</div>
<div class="proofscript" id="proof5515">
<span class="tactic">intros</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Vfexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hexp</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Px</span> <span class="id">Py</span> <span class="id">Fx</span> <span class="id">Fy</span> <span class="id">Hf1</span>.<br/>
<span class="tactic">assert</span> (<span class="id">Hfx</span> : (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt; <span class="id">ln_beta</span> <span class="id">x</span>)%<span class="id">Z</span>);<br/>
&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_generic_gt</span>; [|<span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>|]|].<br/>
<span class="tactic">assert</span> (<span class="id">Hfy</span> : (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">y</span>) &lt; <span class="id">ln_beta</span> <span class="id">y</span>)%<span class="id">Z</span>);<br/>
&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_generic_gt</span>; [|<span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>|]|].<br/>
<span class="tactic">assert</span> (<span class="id">S</span> : (<span class="id">x</span> / <span class="id">y</span> &lt;&gt; 0)%<span class="id">R</span>).<br/>
<span class="tactic">apply</span> <span class="id">Rmult_integral_contrapositive_currified</span>; [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>|<span class="id">idtac</span>].<br/>
<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rinv_neq_0_compat</span>, <span class="id">Rgt_not_eq</span>.<br/>
<span class="tactic">cut</span> (~ (/ 2 * (<span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp1</span> (<span class="id">x</span> / <span class="id">y</span>) - <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp2</span> (<span class="id">x</span> / <span class="id">y</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;= <span class="id">x</span> / <span class="id">y</span> - <span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zfloor</span> (<span class="id">x</span> / <span class="id">y</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt; / 2 * <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp1</span> (<span class="id">x</span> / <span class="id">y</span>))).<br/>
{ <span class="tactic">intro</span> <span class="id">H</span>; <span class="tactic">intro</span> <span class="id">H</span>'; <span class="tactic">apply</span> <span class="id">H</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id">Rplus_le_reg_l</span> (<span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zfloor</span> (<span class="id">x</span> / <span class="id">y</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H</span>'.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id">Rplus_lt_reg_l</span> (<span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zfloor</span> (<span class="id">x</span> / <span class="id">y</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H</span>'. }<br/>
<span class="tactic">set</span> (<span class="id">u1</span> := <span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">x</span> / <span class="id">y</span>)))).<br/>
<span class="tactic">set</span> (<span class="id">u2</span> := <span class="id">bpow</span> (<span class="id">fexp2</span> (<span class="id">ln_beta</span> (<span class="id">x</span> / <span class="id">y</span>)))).<br/>
<span class="tactic">set</span> (<span class="id">x</span>' := <span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zfloor</span> (<span class="id">x</span> / <span class="id">y</span>)).<br/>
<span class="tactic">rewrite</span> 2!<span class="id">ulp_neq_0</span>; <span class="tactic">trivial</span>.<br/>
<span class="id">revert</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">unfold</span> <span class="id">generic_format</span>, <span class="id">F2R</span>, <span class="id">scaled_mantissa</span>, <span class="id">canonic_exp</span>; <span class="tactic">simpl</span>.<br/>
<span class="tactic">set</span> (<span class="id">mx</span> := <span class="id">Ztrunc</span> (<span class="id">x</span> * <span class="id">bpow</span> (- <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>)))).<br/>
<span class="tactic">set</span> (<span class="id">my</span> := <span class="id">Ztrunc</span> (<span class="id">y</span> * <span class="id">bpow</span> (- <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">y</span>)))).<br/>
<span class="tactic">intros</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">intro</span> <span class="id">Hlr</span>.<br/>
<span class="tactic">apply</span> (<span class="id">Rlt_irrefl</span> (/ 2 * (<span class="id">u1</span> - <span class="id">u2</span>))).<br/>
<span class="tactic">apply</span> (<span class="id">Rle_lt_trans</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">proj1</span> <span class="id">Hlr</span>)).<br/>
<span class="tactic">apply</span> (<span class="id">Rplus_lt_reg_r</span> <span class="id">x</span>'); <span class="id">ring_simplify</span>.<br/>
<span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_r</span> <span class="id">y</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Py</span>).<br/>
<span class="tactic">unfold</span> <span class="id">Rdiv</span>; <span class="tactic">rewrite</span> <span class="id">Rmult_assoc</span>.<br/>
<span class="tactic">rewrite</span> <span class="id">Rinv_l</span>; [|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>]; <span class="tactic">rewrite</span> <span class="id">Rmult_1_r</span>.<br/>
<span class="tactic">rewrite</span> <span class="id">Rmult_minus_distr_r</span>; <span class="tactic">rewrite</span> <span class="id">Rmult_plus_distr_r</span>.<br/>
<span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_l</span> 2); [<span class="id">lra</span>|].<br/>
<span class="tactic">rewrite</span> <span class="id">Rmult_minus_distr_l</span>; <span class="tactic">rewrite</span> <span class="id">Rmult_plus_distr_l</span>.<br/>
<span class="tactic">do</span> 5 <span class="tactic">rewrite</span> &lt;- <span class="id">Rmult_assoc</span>.<br/>
<span class="tactic">rewrite</span> <span class="id">Rinv_r</span>; [|<span class="id">lra</span>]; <span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id">Rmult_1_l</span>.<br/>
<span class="tactic">destruct</span> (<span class="id">Zle_or_lt</span> <span class="id">Z0</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - <span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">x</span> / <span class="id">y</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">y</span>))%<span class="id">Z</span>) <span class="kwd">as</span> [<span class="id">He</span>|<span class="id">He</span>].<br/>
- <span class="comment">(*&nbsp;fexp1&nbsp;(ln_beta&nbsp;(x&nbsp;/&nbsp;y))&nbsp;+&nbsp;fexp1&nbsp;(ln_beta&nbsp;y))&nbsp;&lt;=&nbsp;fexp1&nbsp;(ln_beta&nbsp;x)&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rle_lt_trans</span> <span class="kwd">with</span> (2 * <span class="id">x</span>' * <span class="id">y</span> + <span class="id">u1</span> * <span class="id">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">x</span> / <span class="id">y</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">y</span>))).<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">Fx</span> <span class="tactic">at</span> 1; <span class="tactic">rewrite</span> <span class="id">Fy</span> <span class="tactic">at</span> 1 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_le_reg_r</span> (<span class="id">bpow</span> (- <span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">x</span> / <span class="id">y</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">y</span>))));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_minus_distr_r</span>; <span class="tactic">rewrite</span> (<span class="id">Rmult_plus_distr_r</span> (<span class="id">_</span> * <span class="id">_</span> * <span class="id">_</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (2 * <span class="id">x</span>' * <span class="id">_</span> * <span class="id">_</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> (2 * <span class="id">Z2R</span> <span class="id">my</span> * <span class="id">x</span>' * <span class="id">bpow</span> (- <span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">x</span> / <span class="id">y</span>)))) <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Rmult_comm</span> <span class="id">u1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">x</span>', <span class="id">u1</span>, <span class="id">round</span>, <span class="id">F2R</span>, <span class="id">ulp</span>, <span class="id">scaled_mantissa</span>, <span class="id">canonic_exp</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Z2R_Zpower</span>; [|<span class="tactic">exact</span> <span class="id">He</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> 2 <span class="kwd">with</span> (<span class="id">Z2R</span> 2).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 4 <span class="tactic">rewrite</span> &lt;- <span class="id">Z2R_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Z2R_plus</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> 1 <span class="kwd">with</span> (<span class="id">Z2R</span> 1); <span class="tactic">rewrite</span> &lt;- <span class="id">Z2R_minus</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Z2R_le</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Zplus_le_reg_r</span> <span class="id">_</span> <span class="id">_</span> 1); <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Zlt_le_succ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">lt_Z2R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Z2R_plus</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 4 <span class="tactic">rewrite</span> <span class="id">Z2R_mult</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Z2R_Zpower</span>; [|<span class="tactic">exact</span> <span class="id">He</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_r</span> (<span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">x</span> / <span class="id">y</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">y</span>))));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|<span class="id">bpow_simplify</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Fx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Rmult_plus_distr_r</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">Fcore_Raux.bpow</span> <span class="id">_</span> <span class="id">_</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">bpow_plus</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rmult_assoc</span> (<span class="id">Z2R</span> (<span class="id">Zfloor</span> <span class="id">_</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id">Z2R</span> (<span class="id">Zfloor</span> <span class="id">_</span>) * <span class="id">_</span>) <span class="kwd">with</span> <span class="id">x</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="tactic">rewrite</span> (<span class="id">Rmult_comm</span> <span class="id">_</span> (<span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">y</span>)))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="tactic">rewrite</span> &lt;- (<span class="id">Rmult_assoc</span> (<span class="id">Z2R</span> <span class="id">my</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Fy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id">bpow</span> <span class="id">_</span>) <span class="kwd">with</span> <span class="id">u1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_l</span> (/ 2)); [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_plus_distr_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 4 <span class="tactic">rewrite</span> &lt;- <span class="id">Rmult_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rinv_l</span>; [|<span class="id">lra</span>]; <span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id">Rmult_1_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rplus_lt_reg_r</span> (- <span class="id">y</span> * <span class="id">x</span>')); <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_l</span> (/ <span class="id">y</span>)); [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rinv_0_lt_compat</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_minus_distr_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 <span class="tactic">rewrite</span> &lt;- <span class="id">Rmult_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rinv_l</span>; [|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>]; <span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id">Rmult_1_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">rewrite</span> <span class="id">Rmult_comm</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">Rplus_lt_compat_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Ropp_lt_contravar</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rlt_le_trans</span> <span class="kwd">with</span> (<span class="id">u2</span> * <span class="id">bpow</span> (<span class="id">ln_beta</span> <span class="id">y</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* { <span class="tactic">apply</span> <span class="id">Rmult_lt_compat_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">Rabs_lt_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bpow_ln_beta_gt</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">unfold</span> <span class="id">u2</span>, <span class="id">ulp</span>, <span class="id">canonic_exp</span>; <span class="id">bpow_simplify</span>; <span class="tactic">apply</span> <span class="id">bpow_le</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Zplus_le_reg_r</span> <span class="id">_</span> <span class="id">_</span> (- <span class="id">ln_beta</span> <span class="id">y</span>)); <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Zplus_assoc</span>; <span class="tactic">rewrite</span> (<span class="id">Zplus_comm</span> (- <span class="id">_</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">ln_beta_div_disj</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Px</span> <span class="id">Py</span>) <span class="kwd">as</span> [<span class="id">Hxy</span>|<span class="id">Hxy</span>]; <span class="tactic">rewrite</span> <span class="id">Hxy</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Hexp</span>; [| |<span class="tactic">rewrite</span> &lt;- <span class="id">Hxy</span>]|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">_</span> - <span class="id">_</span> + 1)%<span class="id">Z</span> <span class="kwd">with</span> ((<span class="id">ln_beta</span> <span class="id">x</span> + 1) - <span class="id">ln_beta</span> <span class="id">y</span>)%<span class="id">Z</span> <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hexp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">now</span> <span class="tactic">assert</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span> + 1) &lt;= <span class="id">ln_beta</span> <span class="id">x</span>)%<span class="id">Z</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">apply</span> <span class="id">valid_exp</span>|<span class="tactic">omega</span>]. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">_</span> + 1 - <span class="id">_</span>)%<span class="id">Z</span> <span class="kwd">with</span> (<span class="id">ln_beta</span> <span class="id">x</span> - <span class="id">ln_beta</span> <span class="id">y</span> + 1)%<span class="id">Z</span> <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">rewrite</span> &lt;- <span class="id">Hxy</span>.<br/>
- <span class="comment">(*&nbsp;fexp1&nbsp;(ln_beta&nbsp;x)&nbsp;&lt;&nbsp;fexp1&nbsp;(ln_beta&nbsp;(x&nbsp;/&nbsp;y))&nbsp;+&nbsp;fexp1&nbsp;(ln_beta&nbsp;y)&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rle_lt_trans</span> <span class="kwd">with</span> (2 * <span class="id">x</span>' * <span class="id">y</span> + <span class="id">u1</span> * <span class="id">y</span> - <span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))).<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">Fx</span> <span class="tactic">at</span> 1; <span class="tactic">rewrite</span> <span class="id">Fy</span> <span class="tactic">at</span> 1 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_le_reg_r</span> (<span class="id">bpow</span> (- <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_minus_distr_r</span>; <span class="tactic">rewrite</span> (<span class="id">Rmult_plus_distr_r</span> (<span class="id">_</span> * <span class="id">_</span> * <span class="id">_</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (2 * <span class="id">x</span>' * <span class="id">_</span> * <span class="id">_</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> (2 * <span class="id">Z2R</span> <span class="id">my</span> * <span class="id">x</span>' * <span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">y</span>) - <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))) <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Rmult_comm</span> <span class="id">u1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">x</span>', <span class="id">u1</span>, <span class="id">round</span>, <span class="id">F2R</span>, <span class="id">ulp</span>, <span class="id">scaled_mantissa</span>, <span class="id">canonic_exp</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Z2R_Zpower</span> <span class="id">_</span> (<span class="id">_</span> - <span class="id">_</span>)%<span class="id">Z</span>); [|<span class="tactic">omega</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> 2 <span class="kwd">with</span> (<span class="id">Z2R</span> 2).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 5 <span class="tactic">rewrite</span> &lt;- <span class="id">Z2R_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Z2R_plus</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> 1 <span class="kwd">with</span> (<span class="id">Z2R</span> 1); <span class="tactic">rewrite</span> &lt;- <span class="id">Z2R_minus</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Z2R_le</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Zplus_le_reg_r</span> <span class="id">_</span> <span class="id">_</span> 1); <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Zlt_le_succ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">lt_Z2R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Z2R_plus</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 5 <span class="tactic">rewrite</span> <span class="id">Z2R_mult</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Z2R_Zpower</span>; [|<span class="tactic">omega</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_r</span> (<span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Fx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Rmult_plus_distr_r</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">Fcore_Raux.bpow</span> <span class="id">_</span> <span class="id">_</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">bpow_plus</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rmult_assoc</span> (<span class="id">Z2R</span> (<span class="id">Zfloor</span> <span class="id">_</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id">Z2R</span> (<span class="id">Zfloor</span> <span class="id">_</span>) * <span class="id">_</span>) <span class="kwd">with</span> <span class="id">x</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="tactic">rewrite</span> (<span class="id">Rmult_comm</span> <span class="id">_</span> (<span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">y</span>)))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="tactic">rewrite</span> &lt;- (<span class="id">Rmult_assoc</span> (<span class="id">Z2R</span> <span class="id">my</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Fy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id">bpow</span> <span class="id">_</span>) <span class="kwd">with</span> <span class="id">u1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_l</span> (/ 2)); [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_plus_distr_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 4 <span class="tactic">rewrite</span> &lt;- <span class="id">Rmult_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rinv_l</span>; [|<span class="id">lra</span>]; <span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id">Rmult_1_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rplus_lt_reg_r</span> (- <span class="id">y</span> * <span class="id">x</span>')); <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_l</span> (/ <span class="id">y</span>)); [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rinv_0_lt_compat</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_minus_distr_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 <span class="tactic">rewrite</span> &lt;- <span class="id">Rmult_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rinv_l</span>; [|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>]; <span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id">Rmult_1_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">rewrite</span> <span class="id">Rmult_comm</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">Rplus_lt_compat_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Ropp_lt_contravar</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rlt_le_trans</span> <span class="kwd">with</span> (<span class="id">u2</span> * <span class="id">bpow</span> (<span class="id">ln_beta</span> <span class="id">y</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* { <span class="tactic">apply</span> <span class="id">Rmult_lt_compat_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">Rabs_lt_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bpow_ln_beta_gt</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">unfold</span> <span class="id">u2</span>, <span class="id">ulp</span>, <span class="id">canonic_exp</span>; <span class="id">bpow_simplify</span>; <span class="tactic">apply</span> <span class="id">bpow_le</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Zplus_le_reg_r</span> <span class="id">_</span> <span class="id">_</span> (- <span class="id">ln_beta</span> <span class="id">y</span>)); <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Zplus_comm</span> (- <span class="id">_</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">ln_beta_div_disj</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Px</span> <span class="id">Py</span>) <span class="kwd">as</span> [<span class="id">Hxy</span>|<span class="id">Hxy</span>]; <span class="tactic">rewrite</span> <span class="id">Hxy</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hexp</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">rewrite</span> &lt;- <span class="id">Hxy</span>; <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_div_aux2</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>,<br/>
&nbsp;&nbsp;<span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt; <span class="id">Valid_exp</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">choice1</span> <span class="id">choice2</span> : <span class="id">Z</span> -&gt; <span class="id">bool</span>),<br/>
&nbsp;&nbsp;<span class="id">double_round_div_hyp</span> <span class="id">fexp1</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;0 &lt; <span class="id">x</span> -&gt; 0 &lt; <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">x</span> / <span class="id">y</span>)) &lt;= <span class="id">ln_beta</span> (<span class="id">x</span> / <span class="id">y</span>))%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;~ (<span class="id">midp</span> <span class="id">fexp1</span> (<span class="id">x</span> / <span class="id">y</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt; <span class="id">x</span> / <span class="id">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;= <span class="id">midp</span> <span class="id">fexp1</span> (<span class="id">x</span> / <span class="id">y</span>) + / 2 * <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp2</span> (<span class="id">x</span> / <span class="id">y</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5516')">Proof.</div>
<div class="proofscript" id="proof5516">
<span class="tactic">intros</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Vfexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hexp</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Px</span> <span class="id">Py</span> <span class="id">Fx</span> <span class="id">Fy</span> <span class="id">Hf1</span>.<br/>
<span class="tactic">assert</span> (<span class="id">Hfx</span> : (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) &lt; <span class="id">ln_beta</span> <span class="id">x</span>)%<span class="id">Z</span>);<br/>
&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_generic_gt</span>; [|<span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>|]|].<br/>
<span class="tactic">assert</span> (<span class="id">Hfy</span> : (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">y</span>) &lt; <span class="id">ln_beta</span> <span class="id">y</span>)%<span class="id">Z</span>);<br/>
&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">ln_beta_generic_gt</span>; [|<span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>|]|].<br/>
<span class="tactic">cut</span> (~ (/ 2 * <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp1</span> (<span class="id">x</span> / <span class="id">y</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt; <span class="id">x</span> / <span class="id">y</span> - <span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zfloor</span> (<span class="id">x</span> / <span class="id">y</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;= / 2 * (<span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp1</span> (<span class="id">x</span> / <span class="id">y</span>) + <span class="id">ulp</span> <span class="id">beta</span> <span class="id">fexp2</span> (<span class="id">x</span> / <span class="id">y</span>)))).<br/>
{ <span class="tactic">intro</span> <span class="id">H</span>; <span class="tactic">intro</span> <span class="id">H</span>'; <span class="tactic">apply</span> <span class="id">H</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id">Rplus_lt_reg_l</span> (<span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zfloor</span> (<span class="id">x</span> / <span class="id">y</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H</span>'.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id">Rplus_le_reg_l</span> (<span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zfloor</span> (<span class="id">x</span> / <span class="id">y</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H</span>'. }<br/>
<span class="tactic">set</span> (<span class="id">u1</span> := <span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">x</span> / <span class="id">y</span>)))).<br/>
<span class="tactic">set</span> (<span class="id">u2</span> := <span class="id">bpow</span> (<span class="id">fexp2</span> (<span class="id">ln_beta</span> (<span class="id">x</span> / <span class="id">y</span>)))).<br/>
<span class="tactic">set</span> (<span class="id">x</span>' := <span class="id">round</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">Zfloor</span> (<span class="id">x</span> / <span class="id">y</span>)).<br/>
<span class="tactic">assert</span> (<span class="id">S</span> : (<span class="id">x</span> / <span class="id">y</span> &lt;&gt; 0)%<span class="id">R</span>).<br/>
<span class="tactic">apply</span> <span class="id">Rmult_integral_contrapositive_currified</span>; [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>|<span class="id">idtac</span>].<br/>
<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rinv_neq_0_compat</span>, <span class="id">Rgt_not_eq</span>.<br/>
<span class="tactic">rewrite</span> 2!<span class="id">ulp_neq_0</span>; <span class="tactic">trivial</span>.<br/>
<span class="id">revert</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">unfold</span> <span class="id">generic_format</span>, <span class="id">F2R</span>, <span class="id">scaled_mantissa</span>, <span class="id">canonic_exp</span>; <span class="tactic">simpl</span>.<br/>
<span class="tactic">set</span> (<span class="id">mx</span> := <span class="id">Ztrunc</span> (<span class="id">x</span> * <span class="id">bpow</span> (- <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>)))).<br/>
<span class="tactic">set</span> (<span class="id">my</span> := <span class="id">Ztrunc</span> (<span class="id">y</span> * <span class="id">bpow</span> (- <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">y</span>)))).<br/>
<span class="tactic">intros</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">intro</span> <span class="id">Hlr</span>.<br/>
<span class="tactic">apply</span> (<span class="id">Rlt_irrefl</span> (/ 2 * (<span class="id">u1</span> + <span class="id">u2</span>))).<br/>
<span class="tactic">apply</span> <span class="id">Rlt_le_trans</span> <span class="kwd">with</span> (<span class="id">x</span> / <span class="id">y</span> - <span class="id">x</span>'); [|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Hlr</span>].<br/>
<span class="tactic">apply</span> (<span class="id">Rplus_lt_reg_r</span> <span class="id">x</span>'); <span class="id">ring_simplify</span>.<br/>
<span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_r</span> <span class="id">y</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Py</span>).<br/>
<span class="tactic">unfold</span> <span class="id">Rdiv</span>; <span class="tactic">rewrite</span> <span class="id">Rmult_assoc</span>.<br/>
<span class="tactic">rewrite</span> <span class="id">Rinv_l</span>; [|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>]; <span class="tactic">rewrite</span> <span class="id">Rmult_1_r</span>.<br/>
<span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id">Rmult_plus_distr_r</span>.<br/>
<span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_l</span> 2); [<span class="id">lra</span>|].<br/>
<span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id">Rmult_plus_distr_l</span>.<br/>
<span class="tactic">do</span> 5 <span class="tactic">rewrite</span> &lt;- <span class="id">Rmult_assoc</span>.<br/>
<span class="tactic">rewrite</span> <span class="id">Rinv_r</span>; [|<span class="id">lra</span>]; <span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id">Rmult_1_l</span>.<br/>
<span class="tactic">destruct</span> (<span class="id">Zle_or_lt</span> <span class="id">Z0</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>) - <span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">x</span> / <span class="id">y</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">y</span>))%<span class="id">Z</span>) <span class="kwd">as</span> [<span class="id">He</span>|<span class="id">He</span>].<br/>
- <span class="comment">(*&nbsp;fexp1&nbsp;(ln_beta&nbsp;(x&nbsp;/&nbsp;y))&nbsp;+&nbsp;fexp1&nbsp;(ln_beta&nbsp;y)&nbsp;&lt;=&nbsp;fexp1&nbsp;(ln_beta&nbsp;x)&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rlt_le_trans</span> <span class="kwd">with</span> (<span class="id">u1</span> * <span class="id">y</span> + <span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">x</span> / <span class="id">y</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">y</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ 2 * <span class="id">x</span>' * <span class="id">y</span>).<br/>
&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">Rplus_lt_compat_r</span>, <span class="id">Rplus_lt_compat_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rlt_le_trans</span> <span class="kwd">with</span> (<span class="id">u2</span> * <span class="id">bpow</span> (<span class="id">ln_beta</span> <span class="id">y</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* { <span class="tactic">apply</span> <span class="id">Rmult_lt_compat_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">Rabs_lt_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bpow_ln_beta_gt</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">unfold</span> <span class="id">u2</span>, <span class="id">ulp</span>, <span class="id">canonic_exp</span>; <span class="id">bpow_simplify</span>; <span class="tactic">apply</span> <span class="id">bpow_le</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Zplus_le_reg_r</span> <span class="id">_</span> <span class="id">_</span> (- <span class="id">ln_beta</span> <span class="id">y</span>)); <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Zplus_assoc</span>; <span class="tactic">rewrite</span> (<span class="id">Zplus_comm</span> (- <span class="id">_</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">ln_beta_div_disj</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Px</span> <span class="id">Py</span>) <span class="kwd">as</span> [<span class="id">Hxy</span>|<span class="id">Hxy</span>]; <span class="tactic">rewrite</span> <span class="id">Hxy</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Hexp</span>; [| |<span class="tactic">rewrite</span> &lt;- <span class="id">Hxy</span>]|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">_</span> - <span class="id">_</span> + 1)%<span class="id">Z</span> <span class="kwd">with</span> ((<span class="id">ln_beta</span> <span class="id">x</span> + 1) - <span class="id">ln_beta</span> <span class="id">y</span>)%<span class="id">Z</span> <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hexp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">now</span> <span class="tactic">assert</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span> + 1) &lt;= <span class="id">ln_beta</span> <span class="id">x</span>)%<span class="id">Z</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">apply</span> <span class="id">valid_exp</span>|<span class="tactic">omega</span>]. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">_</span> + 1 - <span class="id">_</span>)%<span class="id">Z</span> <span class="kwd">with</span> (<span class="id">ln_beta</span> <span class="id">x</span> - <span class="id">ln_beta</span> <span class="id">y</span> + 1)%<span class="id">Z</span> <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">rewrite</span> &lt;- <span class="id">Hxy</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">Rge_le</span>; <span class="tactic">rewrite</span> <span class="id">Fx</span> <span class="tactic">at</span> 1; <span class="tactic">apply</span> <span class="id">Rle_ge</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">u1</span> * <span class="id">y</span>) <span class="kwd">with</span> (<span class="id">u1</span> * (<span class="id">Z2R</span> <span class="id">my</span> * <span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">y</span>))));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">eq_sym</span>; <span class="tactic">rewrite</span> <span class="id">Fy</span> <span class="tactic">at</span> 1].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (2 * <span class="id">x</span>' * <span class="id">y</span>) <span class="kwd">with</span> (2 * <span class="id">x</span>' * (<span class="id">Z2R</span> <span class="id">my</span> * <span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">y</span>))));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">eq_sym</span>; <span class="tactic">rewrite</span> <span class="id">Fy</span> <span class="tactic">at</span> 1].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_le_reg_r</span> (<span class="id">bpow</span> (- <span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">x</span> / <span class="id">y</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">y</span>))));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id">Rmult_plus_distr_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Rmult_comm</span> <span class="id">u1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">u1</span>, <span class="id">ulp</span>, <span class="id">canonic_exp</span>; <span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Rmult_assoc</span> 2).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Rmult_comm</span> <span class="id">x</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Rmult_assoc</span> 2).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">x</span>', <span class="id">round</span>, <span class="id">F2R</span>, <span class="id">scaled_mantissa</span>, <span class="id">canonic_exp</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Z2R_Zpower</span> <span class="id">_</span> (<span class="id">_</span> - <span class="id">_</span>)%<span class="id">Z</span>); [|<span class="tactic">exact</span> <span class="id">He</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> 2 <span class="kwd">with</span> (<span class="id">Z2R</span> 2).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 4 <span class="tactic">rewrite</span> &lt;- <span class="id">Z2R_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> 1 <span class="kwd">with</span> (<span class="id">Z2R</span> 1); <span class="tactic">do</span> 2 <span class="tactic">rewrite</span> &lt;- <span class="id">Z2R_plus</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Z2R_le</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Zplus_comm</span>, <span class="id">Zplus_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Zlt_le_succ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">lt_Z2R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Z2R_plus</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 4 <span class="tactic">rewrite</span> <span class="id">Z2R_mult</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Z2R_Zpower</span>; [|<span class="tactic">exact</span> <span class="id">He</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_r</span> (<span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">y</span>))));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_plus_distr_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Rmult_comm</span> <span class="id">_</span> (<span class="id">Z2R</span> <span class="id">_</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id">Rmult_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Fy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Zminus</span>; <span class="tactic">rewrite</span> <span class="id">bpow_plus</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Rmult_assoc</span> <span class="id">_</span> (<span class="id">Z2R</span> <span class="id">mx</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rmult_assoc</span> (<span class="id">Z2R</span> <span class="id">mx</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Fx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_r</span> (<span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> (<span class="id">x</span> / <span class="id">y</span>)))));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_plus_distr_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Rmult_comm</span> <span class="id">_</span> <span class="id">y</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id">Rmult_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id">Z2R</span> <span class="id">_</span> * <span class="id">_</span>) <span class="kwd">with</span> <span class="id">x</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id">bpow</span> <span class="id">_</span>) <span class="kwd">with</span> <span class="id">u1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_l</span> (/ 2)); [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_plus_distr_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 4 <span class="tactic">rewrite</span> &lt;- <span class="id">Rmult_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rinv_l</span>; [|<span class="id">lra</span>]; <span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id">Rmult_1_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rplus_lt_reg_r</span> (- <span class="id">y</span> * <span class="id">x</span>')); <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_l</span> (/ <span class="id">y</span>)); [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rinv_0_lt_compat</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_plus_distr_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 <span class="tactic">rewrite</span> &lt;- <span class="id">Rmult_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ropp_mult_distr_r_reverse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ropp_mult_distr_l_reverse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rinv_l</span>; [|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>]; <span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id">Rmult_1_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Rmult_comm</span> (/ <span class="id">y</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">rewrite</span> (<span class="id">Rplus_comm</span> (- <span class="id">x</span>')).<br/>
- <span class="comment">(*&nbsp;fexp1&nbsp;(ln_beta&nbsp;x)&nbsp;&lt;&nbsp;fexp1&nbsp;(ln_beta&nbsp;(x&nbsp;/&nbsp;y))&nbsp;+&nbsp;fexp1&nbsp;(ln_beta&nbsp;y)&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rlt_le_trans</span> <span class="kwd">with</span> (2 * <span class="id">x</span>' * <span class="id">y</span> + <span class="id">u1</span> * <span class="id">y</span> + <span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))).<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">Rplus_comm</span>, <span class="id">Rplus_assoc</span>; <span class="tactic">do</span> 2 <span class="tactic">apply</span> <span class="id">Rplus_lt_compat_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Rlt_le_trans</span> <span class="kwd">with</span> (<span class="id">u2</span> * <span class="id">bpow</span> (<span class="id">ln_beta</span> <span class="id">y</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">Rmult_lt_compat_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rabs_lt_inv</span>; <span class="tactic">apply</span> <span class="id">bpow_ln_beta_gt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">unfold</span> <span class="id">u2</span>, <span class="id">ulp</span>, <span class="id">canonic_exp</span>; <span class="id">bpow_simplify</span>; <span class="tactic">apply</span> <span class="id">bpow_le</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Zplus_le_reg_r</span> <span class="id">_</span> <span class="id">_</span> (- <span class="id">ln_beta</span> <span class="id">y</span>)); <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Zplus_comm</span> (- <span class="id">_</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">ln_beta_div_disj</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Px</span> <span class="id">Py</span>) <span class="kwd">as</span> [<span class="id">Hxy</span>|<span class="id">Hxy</span>]; <span class="tactic">rewrite</span> <span class="id">Hxy</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hexp</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">rewrite</span> &lt;- <span class="id">Hxy</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">Rge_le</span>; <span class="tactic">rewrite</span> <span class="id">Fx</span> <span class="tactic">at</span> 1; <span class="tactic">apply</span> <span class="id">Rle_ge</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Fy</span> <span class="tactic">at</span> 1 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_le_reg_r</span> (<span class="id">bpow</span> (- <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id">Rmult_plus_distr_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (2 * <span class="id">x</span>' * <span class="id">_</span> * <span class="id">_</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> (2 * <span class="id">Z2R</span> <span class="id">my</span> * <span class="id">x</span>' * <span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">y</span>) - <span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))) <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Rmult_comm</span> <span class="id">u1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">x</span>', <span class="id">u1</span>, <span class="id">round</span>, <span class="id">F2R</span>, <span class="id">ulp</span>, <span class="id">scaled_mantissa</span>, <span class="id">canonic_exp</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Z2R_Zpower</span> <span class="id">_</span> (<span class="id">_</span> - <span class="id">_</span>)%<span class="id">Z</span>); [|<span class="tactic">omega</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> 2 <span class="kwd">with</span> (<span class="id">Z2R</span> 2).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 5 <span class="tactic">rewrite</span> &lt;- <span class="id">Z2R_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> 1 <span class="kwd">with</span> (<span class="id">Z2R</span> 1); <span class="tactic">do</span> 2 <span class="tactic">rewrite</span> &lt;- <span class="id">Z2R_plus</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Z2R_le</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Zlt_le_succ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">lt_Z2R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Z2R_plus</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 5 <span class="tactic">rewrite</span> <span class="id">Z2R_mult</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Z2R_Zpower</span>; [|<span class="tactic">omega</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_r</span> (<span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">x</span>))));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">now</span> <span class="tactic">apply</span> <span class="id">bpow_gt_0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Rmult_assoc</span> <span class="id">_</span> (<span class="id">Z2R</span> <span class="id">mx</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Fx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_plus_distr_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bpow_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">bpow_plus</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Rmult_assoc</span> (<span class="id">Z2R</span> <span class="id">_</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id">Z2R</span> <span class="id">_</span> * <span class="id">bpow</span> <span class="id">_</span>) <span class="kwd">with</span> <span class="id">x</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="tactic">rewrite</span> (<span class="id">Rmult_comm</span> <span class="id">_</span> (<span class="id">bpow</span> (<span class="id">fexp1</span> (<span class="id">ln_beta</span> <span class="id">y</span>)))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="tactic">rewrite</span> &lt;- (<span class="id">Rmult_assoc</span> (<span class="id">Z2R</span> <span class="id">my</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Fy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id">bpow</span> <span class="id">_</span>) <span class="kwd">with</span> <span class="id">u1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_l</span> (/ 2)); [<span class="id">lra</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_plus_distr_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 4 <span class="tactic">rewrite</span> &lt;- <span class="id">Rmult_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rinv_l</span>; [|<span class="id">lra</span>]; <span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id">Rmult_1_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rplus_lt_reg_r</span> (- <span class="id">y</span> * <span class="id">x</span>')); <span class="id">ring_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Rmult_lt_reg_l</span> (/ <span class="id">y</span>)); [<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rinv_0_lt_compat</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rmult_plus_distr_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 <span class="tactic">rewrite</span> &lt;- <span class="id">Rmult_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ropp_mult_distr_r_reverse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ropp_mult_distr_l_reverse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Rinv_l</span>; [|<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rgt_not_eq</span>]; <span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id">Rmult_1_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Rmult_comm</span> (/ <span class="id">y</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">rewrite</span> (<span class="id">Rplus_comm</span> (- <span class="id">x</span>')).<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_div_aux</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>,<br/>
&nbsp;&nbsp;<span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt; <span class="id">Valid_exp</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">choice1</span> <span class="id">choice2</span> : <span class="id">Z</span> -&gt; <span class="id">bool</span>),<br/>
&nbsp;&nbsp;(<span class="id">exists</span> <span class="id">n</span>, (<span class="id">beta</span> = 2 * <span class="id">n</span> :&gt; <span class="id">Z</span>)%<span class="id">Z</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_div_hyp</span> <span class="id">fexp1</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;0 &lt; <span class="id">x</span> -&gt; 0 &lt; <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> (<span class="id">x</span> / <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5517')">Proof.</div>
<div class="proofscript" id="proof5517">
<span class="tactic">intros</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Vfexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Ebeta</span> <span class="id">Hexp</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Px</span> <span class="id">Py</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">assert</span> (<span class="id">Pxy</span> : 0 &lt; <span class="id">x</span> / <span class="id">y</span>).<br/>
{ <span class="tactic">apply</span> <span class="id">Rmult_lt_0_compat</span>; [<span class="tactic">exact</span> <span class="id">Px</span>|].<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Rinv_0_lt_compat</span>. }<br/>
<span class="tactic">apply</span> <span class="id">double_round_all_mid_cases</span>.<br/>
- <span class="tactic">exact</span> <span class="id">Vfexp1</span>.<br/>
- <span class="tactic">exact</span> <span class="id">Vfexp2</span>.<br/>
- <span class="tactic">exact</span> <span class="id">Pxy</span>.<br/>
- <span class="tactic">apply</span> <span class="id">Hexp</span>.<br/>
- <span class="tactic">intros</span> <span class="id">Hf1</span> <span class="id">Hlxy</span>.<br/>
&nbsp;&nbsp;<span class="id">casetype</span> <span class="id">False</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> (<span class="id">double_round_div_aux0</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">_</span> <span class="id">_</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hexp</span> <span class="id">x</span> <span class="id">y</span>).<br/>
- <span class="tactic">intros</span> <span class="id">Hf1</span> <span class="id">Hlxy</span>.<br/>
&nbsp;&nbsp;<span class="id">casetype</span> <span class="id">False</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> (<span class="id">double_round_div_aux1</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">_</span> <span class="id">_</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hexp</span> <span class="id">x</span> <span class="id">y</span>).<br/>
- <span class="tactic">intro</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">double_round_eq_mid_beta_even</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hexp</span>.<br/>
- <span class="tactic">intros</span> <span class="id">Hf1</span> <span class="id">Hlxy</span>.<br/>
&nbsp;&nbsp;<span class="id">casetype</span> <span class="id">False</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> (<span class="id">double_round_div_aux2</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">_</span> <span class="id">_</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Hexp</span> <span class="id">x</span> <span class="id">y</span>).<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">double_round_div</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fexp1</span> <span class="id">fexp2</span> : <span class="id">Z</span> -&gt; <span class="id">Z</span>,<br/>
&nbsp;&nbsp;<span class="id">Valid_exp</span> <span class="id">fexp1</span> -&gt; <span class="id">Valid_exp</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">choice1</span> <span class="id">choice2</span> : <span class="id">Z</span> -&gt; <span class="id">bool</span>),<br/>
&nbsp;&nbsp;(<span class="id">exists</span> <span class="id">n</span>, (<span class="id">beta</span> = 2 * <span class="id">n</span> :&gt; <span class="id">Z</span>)%<span class="id">Z</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_div_hyp</span> <span class="id">fexp1</span> <span class="id">fexp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;<span class="id">y</span> &lt;&gt; 0 -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">generic_format</span> <span class="id">beta</span> <span class="id">fexp1</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> (<span class="id">x</span> / <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5518')">Proof.</div>
<div class="proofscript" id="proof5518">
<span class="tactic">intros</span> <span class="id">fexp1</span> <span class="id">fexp2</span> <span class="id">Vfexp1</span> <span class="id">Vfexp2</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Ebeta</span> <span class="id">Hexp</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Nzy</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">unfold</span> <span class="id">double_round_eq</span>.<br/>
<span class="tactic">destruct</span> (<span class="id">Rtotal_order</span> <span class="id">x</span> 0) <span class="kwd">as</span> [<span class="id">Nx</span>|[<span class="id">Zx</span>|<span class="id">Px</span>]].<br/>
- <span class="comment">(*&nbsp;x&nbsp;&lt;&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Rtotal_order</span> <span class="id">y</span> 0) <span class="kwd">as</span> [<span class="id">Ny</span>|[<span class="id">Zy</span>|<span class="id">Py</span>]].<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;y&nbsp;&lt;&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Ropp_involutive</span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Ropp_involutive</span> <span class="id">y</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ropp_div</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Rdiv</span>; <span class="tactic">rewrite</span> &lt;- <span class="id">Ropp_inv_permute</span>; [|<span class="id">lra</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ropp_mult_distr_r_reverse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ropp_involutive</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fold</span> ((- <span class="id">x</span>) / (- <span class="id">y</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Ropp_lt_contravar</span> <span class="kwd">in</span> <span class="id">Nx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Ropp_lt_contravar</span> <span class="kwd">in</span> <span class="id">Ny</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ropp_0</span> <span class="kwd">in</span> <span class="id">Nx</span>, <span class="id">Ny</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">generic_format_opp</span> <span class="kwd">in</span> <span class="id">Fx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">generic_format_opp</span> <span class="kwd">in</span> <span class="id">Fy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">double_round_div_aux</span>.<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;y&nbsp;=&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">casetype</span> <span class="id">False</span>; <span class="tactic">apply</span> <span class="id">Nzy</span>.<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;y&nbsp;&gt;&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Ropp_involutive</span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ropp_div</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 <span class="tactic">rewrite</span> <span class="id">round_N_opp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Ropp_eq_compat</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Ropp_lt_contravar</span> <span class="kwd">in</span> <span class="id">Nx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ropp_0</span> <span class="kwd">in</span> <span class="id">Nx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">generic_format_opp</span> <span class="kwd">in</span> <span class="id">Fx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">double_round_div_aux</span>.<br/>
- <span class="comment">(*&nbsp;x&nbsp;=&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Zx</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Rdiv</span>; <span class="tactic">rewrite</span> <span class="id">Rmult_0_l</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">rewrite</span> <span class="id">round_0</span>; [|<span class="tactic">apply</span> <span class="id">valid_rnd_N</span>].<br/>
- <span class="comment">(*&nbsp;x&nbsp;&gt;&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Rtotal_order</span> <span class="id">y</span> 0) <span class="kwd">as</span> [<span class="id">Ny</span>|[<span class="id">Zy</span>|<span class="id">Py</span>]].<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;y&nbsp;&lt;&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">Ropp_involutive</span> <span class="id">y</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Rdiv</span>; <span class="tactic">rewrite</span> &lt;- <span class="id">Ropp_inv_permute</span>; [|<span class="id">lra</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ropp_mult_distr_r_reverse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 <span class="tactic">rewrite</span> <span class="id">round_N_opp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Ropp_eq_compat</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Ropp_lt_contravar</span> <span class="kwd">in</span> <span class="id">Ny</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ropp_0</span> <span class="kwd">in</span> <span class="id">Ny</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">generic_format_opp</span> <span class="kwd">in</span> <span class="id">Fy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">double_round_div_aux</span>.<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;y&nbsp;=&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">casetype</span> <span class="id">False</span>; <span class="tactic">apply</span> <span class="id">Nzy</span>.<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;y&nbsp;&gt;&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">double_round_div_aux</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Section</span> <span class="id">Double_round_div_FLX</span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Fcore_FLX</span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id">prec</span> : <span class="id">Z</span>.<br/>
<span class="kwd">Variable</span> <span class="id">prec</span>' : <span class="id">Z</span>.<br/>
<br/>
<span class="kwd">Context</span> { <span class="id">prec_gt_0_</span> : <span class="id">Prec_gt_0</span> <span class="id">prec</span> }.<br/>
<span class="kwd">Context</span> { <span class="id">prec_gt_0_</span>' : <span class="id">Prec_gt_0</span> <span class="id">prec</span>' }.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">FLX_double_round_div_hyp</span> :<br/>
&nbsp;&nbsp;(2 * <span class="id">prec</span> &lt;= <span class="id">prec</span>')%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_div_hyp</span> (<span class="id">FLX_exp</span> <span class="id">prec</span>) (<span class="id">FLX_exp</span> <span class="id">prec</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5519')">Proof.</div>
<div class="proofscript" id="proof5519">
<span class="tactic">intros</span> <span class="id">Hprec</span>.<br/>
<span class="tactic">unfold</span> <span class="id">Prec_gt_0</span> <span class="kwd">in</span> <span class="id">prec_gt_0_</span>.<br/>
<span class="tactic">unfold</span> <span class="id">FLX_exp</span>.<br/>
<span class="tactic">unfold</span> <span class="id">double_round_div_hyp</span>.<br/>
<span class="tactic">split</span>; [<span class="id">now</span> <span class="tactic">intro</span> <span class="id">ex</span>; <span class="tactic">omega</span>|].<br/>
<span class="tactic">split</span>; [|<span class="tactic">split</span>; [|<span class="tactic">split</span>]]; <span class="tactic">intros</span> <span class="id">ex</span> <span class="id">ey</span>; <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id">double_round_div_FLX</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">choice1</span> <span class="id">choice2</span>,<br/>
&nbsp;&nbsp;(<span class="id">exists</span> <span class="id">n</span>, (<span class="id">beta</span> = 2 * <span class="id">n</span> :&gt; <span class="id">Z</span>)%<span class="id">Z</span>) -&gt;<br/>
&nbsp;&nbsp;(2 * <span class="id">prec</span> &lt;= <span class="id">prec</span>')%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;<span class="id">y</span> &lt;&gt; 0 -&gt;<br/>
&nbsp;&nbsp;<span class="id">FLX_format</span> <span class="id">beta</span> <span class="id">prec</span> <span class="id">x</span> -&gt; <span class="id">FLX_format</span> <span class="id">beta</span> <span class="id">prec</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> (<span class="id">FLX_exp</span> <span class="id">prec</span>) (<span class="id">FLX_exp</span> <span class="id">prec</span>') <span class="id">choice1</span> <span class="id">choice2</span> (<span class="id">x</span> / <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5520')">Proof.</div>
<div class="proofscript" id="proof5520">
<span class="tactic">intros</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Ebeta</span> <span class="id">Hprec</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Nzy</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">apply</span> <span class="id">double_round_div</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLX_exp_valid</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLX_exp_valid</span>.<br/>
- <span class="tactic">exact</span> <span class="id">Ebeta</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLX_double_round_div_hyp</span>.<br/>
- <span class="tactic">exact</span> <span class="id">Nzy</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FLX</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FLX</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">Double_round_div_FLX</span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id">Double_round_div_FLT</span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Fcore_FLX</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Fcore_FLT</span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id">emin</span> <span class="id">prec</span> : <span class="id">Z</span>.<br/>
<span class="kwd">Variable</span> <span class="id">emin</span>' <span class="id">prec</span>' : <span class="id">Z</span>.<br/>
<br/>
<span class="kwd">Context</span> { <span class="id">prec_gt_0_</span> : <span class="id">Prec_gt_0</span> <span class="id">prec</span> }.<br/>
<span class="kwd">Context</span> { <span class="id">prec_gt_0_</span>' : <span class="id">Prec_gt_0</span> <span class="id">prec</span>' }.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">FLT_double_round_div_hyp</span> :<br/>
&nbsp;&nbsp;(<span class="id">emin</span>' &lt;= <span class="id">emin</span> - <span class="id">prec</span> - 2)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;(2 * <span class="id">prec</span> &lt;= <span class="id">prec</span>')%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_div_hyp</span> (<span class="id">FLT_exp</span> <span class="id">emin</span> <span class="id">prec</span>) (<span class="id">FLT_exp</span> <span class="id">emin</span>' <span class="id">prec</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5521')">Proof.</div>
<div class="proofscript" id="proof5521">
<span class="tactic">intros</span> <span class="id">Hemin</span> <span class="id">Hprec</span>.<br/>
<span class="tactic">unfold</span> <span class="id">FLT_exp</span>.<br/>
<span class="tactic">unfold</span> <span class="id">Prec_gt_0</span> <span class="kwd">in</span> <span class="id">prec_gt_0_</span>.<br/>
<span class="tactic">unfold</span> <span class="id">double_round_div_hyp</span>.<br/>
<span class="tactic">split</span>; [<span class="tactic">intro</span> <span class="id">ex</span>|<span class="tactic">split</span>; [|<span class="tactic">split</span>; [|<span class="tactic">split</span>]]; <span class="tactic">intros</span> <span class="id">ex</span> <span class="id">ey</span>].<br/>
- <span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>') <span class="id">emin</span>').<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>) <span class="id">emin</span>).<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
- <span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>) <span class="id">emin</span>).<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ey</span> - <span class="id">prec</span>) <span class="id">emin</span>).<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ex</span> - <span class="id">ey</span> - <span class="id">prec</span>) <span class="id">emin</span>).<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ex</span> - <span class="id">ey</span> - <span class="id">prec</span>') <span class="id">emin</span>').<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
- <span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>) <span class="id">emin</span>).<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ey</span> - <span class="id">prec</span>) <span class="id">emin</span>).<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ex</span> - <span class="id">ey</span> + 1 - <span class="id">prec</span>) <span class="id">emin</span>).<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ex</span> - <span class="id">ey</span> + 1 - <span class="id">prec</span>') <span class="id">emin</span>').<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
- <span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>) <span class="id">emin</span>).<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ey</span> - <span class="id">prec</span>) <span class="id">emin</span>).<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ex</span> - <span class="id">ey</span> - <span class="id">prec</span>) <span class="id">emin</span>).<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ex</span> - <span class="id">ey</span> - <span class="id">prec</span>') <span class="id">emin</span>').<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
- <span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>) <span class="id">emin</span>).<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ey</span> - <span class="id">prec</span>) <span class="id">emin</span>).<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ex</span> - <span class="id">ey</span> - <span class="id">prec</span>) <span class="id">emin</span>).<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Zmax_spec</span> (<span class="id">ex</span> - <span class="id">ey</span> - <span class="id">prec</span>') <span class="id">emin</span>').<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id">double_round_div_FLT</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">choice1</span> <span class="id">choice2</span>,<br/>
&nbsp;&nbsp;(<span class="id">exists</span> <span class="id">n</span>, (<span class="id">beta</span> = 2 * <span class="id">n</span> :&gt; <span class="id">Z</span>)%<span class="id">Z</span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="id">emin</span>' &lt;= <span class="id">emin</span> - <span class="id">prec</span> - 2)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;(2 * <span class="id">prec</span> &lt;= <span class="id">prec</span>')%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;<span class="id">y</span> &lt;&gt; 0 -&gt;<br/>
&nbsp;&nbsp;<span class="id">FLT_format</span> <span class="id">beta</span> <span class="id">emin</span> <span class="id">prec</span> <span class="id">x</span> -&gt; <span class="id">FLT_format</span> <span class="id">beta</span> <span class="id">emin</span> <span class="id">prec</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> (<span class="id">FLT_exp</span> <span class="id">emin</span> <span class="id">prec</span>) (<span class="id">FLT_exp</span> <span class="id">emin</span>' <span class="id">prec</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">choice1</span> <span class="id">choice2</span> (<span class="id">x</span> / <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5522')">Proof.</div>
<div class="proofscript" id="proof5522">
<span class="tactic">intros</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Ebeta</span> <span class="id">Hemin</span> <span class="id">Hprec</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Nzy</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">apply</span> <span class="id">double_round_div</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLT_exp_valid</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLT_exp_valid</span>.<br/>
- <span class="tactic">exact</span> <span class="id">Ebeta</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FLT_double_round_div_hyp</span>.<br/>
- <span class="tactic">exact</span> <span class="id">Nzy</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FLT</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FLT</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">Double_round_div_FLT</span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id">Double_round_div_FTZ</span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Fcore_FLX</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Fcore_FTZ</span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id">emin</span> <span class="id">prec</span> : <span class="id">Z</span>.<br/>
<span class="kwd">Variable</span> <span class="id">emin</span>' <span class="id">prec</span>' : <span class="id">Z</span>.<br/>
<br/>
<span class="kwd">Context</span> { <span class="id">prec_gt_0_</span> : <span class="id">Prec_gt_0</span> <span class="id">prec</span> }.<br/>
<span class="kwd">Context</span> { <span class="id">prec_gt_0_</span>' : <span class="id">Prec_gt_0</span> <span class="id">prec</span>' }.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">FTZ_double_round_div_hyp</span> :<br/>
&nbsp;&nbsp;(<span class="id">emin</span>' + <span class="id">prec</span>' &lt;= <span class="id">emin</span> - 1)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;(2 * <span class="id">prec</span> &lt;= <span class="id">prec</span>')%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_div_hyp</span> (<span class="id">FTZ_exp</span> <span class="id">emin</span> <span class="id">prec</span>) (<span class="id">FTZ_exp</span> <span class="id">emin</span>' <span class="id">prec</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5523')">Proof.</div>
<div class="proofscript" id="proof5523">
<span class="tactic">intros</span> <span class="id">Hemin</span> <span class="id">Hprec</span>.<br/>
<span class="tactic">unfold</span> <span class="id">FTZ_exp</span>.<br/>
<span class="tactic">unfold</span> <span class="id">Prec_gt_0</span> <span class="kwd">in</span> <span class="id">prec_gt_0_</span>.<br/>
<span class="tactic">unfold</span> <span class="id">Prec_gt_0</span> <span class="kwd">in</span> <span class="id">prec_gt_0_</span>.<br/>
<span class="tactic">unfold</span> <span class="id">double_round_div_hyp</span>.<br/>
<span class="tactic">split</span>; [<span class="tactic">intro</span> <span class="id">ex</span>|<span class="tactic">split</span>; [|<span class="tactic">split</span>; [|<span class="tactic">split</span>]]; <span class="tactic">intros</span> <span class="id">ex</span> <span class="id">ey</span>].<br/>
- <span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>') <span class="id">emin</span>');<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>) <span class="id">emin</span>);<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>) <span class="id">emin</span>);<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ey</span> - <span class="id">prec</span>) <span class="id">emin</span>);<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ex</span> - <span class="id">ey</span> - <span class="id">prec</span>) <span class="id">emin</span>);<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ex</span> - <span class="id">ey</span> - <span class="id">prec</span>') <span class="id">emin</span>');<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>) <span class="id">emin</span>);<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ey</span> - <span class="id">prec</span>) <span class="id">emin</span>);<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ex</span> - <span class="id">ey</span> + 1 - <span class="id">prec</span>) <span class="id">emin</span>);<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ex</span> - <span class="id">ey</span> + 1 - <span class="id">prec</span>') <span class="id">emin</span>');<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>) <span class="id">emin</span>);<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ey</span> - <span class="id">prec</span>) <span class="id">emin</span>);<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ex</span> - <span class="id">ey</span> - <span class="id">prec</span>) <span class="id">emin</span>);<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ex</span> - <span class="id">ey</span> - <span class="id">prec</span>') <span class="id">emin</span>');<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ex</span> - <span class="id">prec</span>) <span class="id">emin</span>);<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ey</span> - <span class="id">prec</span>) <span class="id">emin</span>);<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ex</span> - <span class="id">ey</span> - <span class="id">prec</span>) <span class="id">emin</span>);<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Z.ltb_spec</span> (<span class="id">ex</span> - <span class="id">ey</span> - <span class="id">prec</span>') <span class="id">emin</span>');<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id">double_round_div_FTZ</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">choice1</span> <span class="id">choice2</span>,<br/>
&nbsp;&nbsp;(<span class="id">exists</span> <span class="id">n</span>, (<span class="id">beta</span> = 2 * <span class="id">n</span> :&gt; <span class="id">Z</span>)%<span class="id">Z</span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="id">emin</span>' + <span class="id">prec</span>' &lt;= <span class="id">emin</span> - 1)%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;(2 * <span class="id">prec</span> &lt;= <span class="id">prec</span>')%<span class="id">Z</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;<span class="id">y</span> &lt;&gt; 0 -&gt;<br/>
&nbsp;&nbsp;<span class="id">FTZ_format</span> <span class="id">beta</span> <span class="id">emin</span> <span class="id">prec</span> <span class="id">x</span> -&gt; <span class="id">FTZ_format</span> <span class="id">beta</span> <span class="id">emin</span> <span class="id">prec</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">double_round_eq</span> (<span class="id">FTZ_exp</span> <span class="id">emin</span> <span class="id">prec</span>) (<span class="id">FTZ_exp</span> <span class="id">emin</span>' <span class="id">prec</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">choice1</span> <span class="id">choice2</span> (<span class="id">x</span> / <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5524')">Proof.</div>
<div class="proofscript" id="proof5524">
<span class="tactic">intros</span> <span class="id">choice1</span> <span class="id">choice2</span> <span class="id">Ebeta</span> <span class="id">Hemin</span> <span class="id">Hprec</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Nzy</span> <span class="id">Fx</span> <span class="id">Fy</span>.<br/>
<span class="tactic">apply</span> <span class="id">double_round_div</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FTZ_exp_valid</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FTZ_exp_valid</span>.<br/>
- <span class="tactic">exact</span> <span class="id">Ebeta</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">FTZ_double_round_div_hyp</span>.<br/>
- <span class="tactic">exact</span> <span class="id">Nzy</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FTZ</span>.<br/>
- <span class="id">now</span> <span class="tactic">apply</span> <span class="id">generic_format_FTZ</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">Double_round_div_FTZ</span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id">Double_round_div</span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id">Double_round</span>.<br/>
</div>
<div class="footer"><hr/>Generated by coq2html</div>
</body>
</html>
