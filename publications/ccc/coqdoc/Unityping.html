<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module Unityping</title>
<meta name="description" content="Documentation of Coq module Unityping" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module Unityping</h1>
<div class="coq">
<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.funind.Recdef.html">Recdef</a></span> <span class="id"><a href="Coqlib.html">Coqlib</a></span> <span class="id"><a href="Maps.html">Maps</a></span> <span class="id"><a href="Errors.html">Errors</a></span>.<br/>
<br/>
<span class="kwd">Local</span> <span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">nat_scope</span>.<br/>
<span class="kwd">Local</span> <span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">error_monad_scope</span>.<br/>
<br/>
<div class="doc">This module provides a solver for sets of unification constraints of the
  following kinds: <span class="bracket"><span class="id">T</span>(<span class="id">x</span>) = <span class="id">base</span>-<span class="id">type</span></span> or <span class="bracket"><span class="id">T</span>(<span class="id">x</span>) = <span class="id">T</span>(<span class="id">y</span>)</span>.
  The unknowns are the types <span class="bracket"><span class="id">T</span>(<span class="id">x</span>)</span> of every identifier <span class="bracket"><span class="id">x</span></span>. </div>
<br/>
<div class="doc">The interface for base types. </div>
<br/>
<span class="kwd">Module</span> <span class="kwd">Type</span> <span class="id"><a name="TYPE_ALGEBRA">TYPE_ALGEBRA</a></span>.<br/>
<br/>
<span class="kwd">Parameter</span> <span class="id"><a name="TYPE_ALGEBRA.t">t</a></span>: <span class="kwd">Type</span>.<br/>
<span class="kwd">Parameter</span> <span class="id"><a name="TYPE_ALGEBRA.eq">eq</a></span>: <span class="kwd">forall</span> (<span class="id">x</span> <span class="id">y</span>: <span class="id"><a href="Unityping.html#TYPE_ALGEBRA.t">t</a></span>), {<span class="id"><a href="Unityping.html#x">x</a></span>=<span class="id"><a href="Unityping.html#y">y</a></span>} + {<span class="id"><a href="Unityping.html#x">x</a></span>&lt;&gt;<span class="id"><a href="Unityping.html#y">y</a></span>}.<br/>
<span class="kwd">Parameter</span> <span class="id"><a name="TYPE_ALGEBRA.default">default</a></span>: <span class="id"><a href="Unityping.html#TYPE_ALGEBRA.t">t</a></span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="Unityping.html#TYPE_ALGEBRA">TYPE_ALGEBRA</a></span>.<br/>
<br/>
<div class="doc">The constraint solver. </div>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="UniSolver">UniSolver</a></span> (<span class="id">T</span>: <span class="id"><a href="Unityping.html#TYPE_ALGEBRA">TYPE_ALGEBRA</a></span>).<br/>
<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="UniSolver.constraint">constraint</a></span> : <span class="kwd">Type</span> := (<span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>)%<span class="id">type</span>.<br/>
<br/>
<span class="kwd">Record</span> <span class="id"><a name="UniSolver.typenv">typenv</a></span> : <span class="kwd">Type</span> := <span class="id"><a name="UniSolver.Typenv">Typenv</a></span> {<br/>
&nbsp;&nbsp;<span class="id"><a name="UniSolver.te_typ">te_typ</a></span>: <span class="id"><a href="Maps.html#PTree.t">PTree.t</a></span> <span class="id"><a href="Unityping.html#T.t">T.t</a></span>;       <span class="docright">(* mapping var -&gt; typ  *)</span><br/>
&nbsp;&nbsp;<span class="id"><a name="UniSolver.te_equ">te_equ</a></span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Unityping.html#UniSolver.constraint">constraint</a></span>    <span class="docright">(* additional equality constraints  *)</span><br/>
}.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="UniSolver.initial">initial</a></span> : <span class="id"><a href="Unityping.html#UniSolver.typenv">typenv</a></span> := {| <span class="id"><a href="Unityping.html#UniSolver.Typenv">te_typ</a></span> := <span class="id"><a href="Maps.html#PTree.empty">PTree.empty</a></span> <span class="id">_</span>; <span class="id">te_equ</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> |}.<br/>
<br/>
<div class="doc">Add the constraint <span class="bracket"><span class="id">T</span>(<span class="id">x</span>) = <span class="id">ty</span></span>. </div>
<br/>
<span class="kwd">Definition</span> <span class="tactic">set</span> (<span class="id">e</span>: <span class="id"><a href="Unityping.html#UniSolver.typenv">typenv</a></span>) (<span class="id">x</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>) (<span class="id">ty</span>: <span class="id"><a href="Unityping.html#T.t">T.t</a></span>) : <span class="id"><a href="Errors.html#res">res</a></span> <span class="id"><a href="Unityping.html#UniSolver.typenv">typenv</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Unityping.html#e">e</a></span>.(<span class="id"><a href="Unityping.html#UniSolver.te_typ">te_typ</a></span>)!<span class="id"><a href="Unityping.html#x">x</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Errors.html#OK">OK</a></span> {| <span class="id"><a href="Unityping.html#UniSolver.Typenv">te_typ</a></span> := <span class="id"><a href="Maps.html#PTree.set">PTree.set</a></span> <span class="id"><a href="Unityping.html#x">x</a></span> <span class="id"><a href="Unityping.html#ty">ty</a></span> <span class="id"><a href="Unityping.html#e">e</a></span>.(<span class="id"><a href="Unityping.html#UniSolver.te_typ">te_typ</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">te_equ</span> := <span class="id"><a href="Unityping.html#e">e</a></span>.(<span class="id"><a href="Unityping.html#UniSolver.te_equ">te_equ</a></span>) |}<br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">ty</span>' =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="Unityping.html#T.eq">T.eq</a></span> <span class="id"><a href="Unityping.html#ty">ty</a></span> <span class="id">ty</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id"><a href="Unityping.html#e">e</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="Errors.html#Error">Error</a></span> (<span class="id"><a href="Errors.html#MSG">MSG</a></span> "<span class="id">bad</span> <span class="id">definition</span>/<span class="id">use</span> <span class="id">of</span> <span class="id">variable</span> " :: <span class="id"><a href="Errors.html#POS">POS</a></span> <span class="id"><a href="Unityping.html#x">x</a></span> :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="UniSolver.set_list">set_list</a></span> (<span class="id">e</span>: <span class="id"><a href="Unityping.html#UniSolver.typenv">typenv</a></span>) (<span class="id">rl</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>) (<span class="id">tyl</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Unityping.html#T.t">T.t</a></span>) {<span class="kwd">struct</span> <span class="id">rl</span>}: <span class="id"><a href="Errors.html#res">res</a></span> <span class="id"><a href="Unityping.html#UniSolver.typenv">typenv</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Unityping.html#rl">rl</a></span>, <span class="id"><a href="Unityping.html#tyl">tyl</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id"><a href="Unityping.html#e">e</a></span><br/>
&nbsp;&nbsp;| <span class="id">r1</span>::<span class="id">rs</span>, <span class="id">ty1</span>::<span class="id">tys</span> =&gt; <span class="tactic">do</span> <span class="id">e1</span> &lt;- <span class="tactic">set</span> <span class="id"><a href="Unityping.html#e">e</a></span> <span class="id">r1</span> <span class="id">ty1</span>; <span class="id"><a href="Unityping.html#set_list">set_list</a></span> <span class="id">e1</span> <span class="id">rs</span> <span class="id">tys</span><br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id"><a href="Errors.html#Error">Error</a></span> (<span class="id"><a href="Errors.html#msg">msg</a></span> "<span class="id">arity</span> <span class="id">mismatch</span>")<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">Add the constraint <span class="bracket"><span class="id">T</span>(<span class="id">x</span>) = <span class="id">T</span>(<span class="id">y</span>)</span>.
    The boolean result is <span class="bracket"><span class="id">true</span></span> if the types of <span class="bracket"><span class="id">x</span></span> or <span class="bracket"><span class="id">y</span></span> could be
    made more precise.  Otherwise, <span class="bracket"><span class="id">te_typ</span></span> does not change and
    <span class="bracket"><span class="id">false</span></span> is returned. </div>
<br/>
<span class="kwd">Definition</span> <span class="tactic">move</span> (<span class="id">e</span>: <span class="id"><a href="Unityping.html#UniSolver.typenv">typenv</a></span>) (<span class="id">r1</span> <span class="id">r2</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>) : <span class="id"><a href="Errors.html#res">res</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> * <span class="id"><a href="Unityping.html#UniSolver.typenv">typenv</a></span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id"><a href="Unityping.html#r1">r1</a></span> <span class="id"><a href="Unityping.html#r2">r2</a></span> <span class="kwd">then</span> <span class="id"><a href="Errors.html#OK">OK</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>, <span class="id"><a href="Unityping.html#e">e</a></span>) <span class="kwd">else</span><br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Unityping.html#e">e</a></span>.(<span class="id"><a href="Unityping.html#UniSolver.te_typ">te_typ</a></span>)!<span class="id"><a href="Unityping.html#r1">r1</a></span>, <span class="id"><a href="Unityping.html#e">e</a></span>.(<span class="id"><a href="Unityping.html#UniSolver.te_typ">te_typ</a></span>)!<span class="id"><a href="Unityping.html#r2">r2</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Errors.html#OK">OK</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>, {| <span class="id"><a href="Unityping.html#UniSolver.Typenv">te_typ</a></span> := <span class="id"><a href="Unityping.html#e">e</a></span>.(<span class="id"><a href="Unityping.html#UniSolver.te_typ">te_typ</a></span>); <span class="id">te_equ</span> := (<span class="id"><a href="Unityping.html#r1">r1</a></span>, <span class="id"><a href="Unityping.html#r2">r2</a></span>) :: <span class="id"><a href="Unityping.html#e">e</a></span>.(<span class="id"><a href="Unityping.html#UniSolver.te_equ">te_equ</a></span>) |})<br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">ty1</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Errors.html#OK">OK</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>, {| <span class="id"><a href="Unityping.html#UniSolver.Typenv">te_typ</a></span> := <span class="id"><a href="Maps.html#PTree.set">PTree.set</a></span> <span class="id"><a href="Unityping.html#r2">r2</a></span> <span class="id">ty1</span> <span class="id"><a href="Unityping.html#e">e</a></span>.(<span class="id"><a href="Unityping.html#UniSolver.te_typ">te_typ</a></span>); <span class="id">te_equ</span> := <span class="id"><a href="Unityping.html#e">e</a></span>.(<span class="id"><a href="Unityping.html#UniSolver.te_equ">te_equ</a></span>) |})<br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">ty2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Errors.html#OK">OK</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>, {| <span class="id"><a href="Unityping.html#UniSolver.Typenv">te_typ</a></span> := <span class="id"><a href="Maps.html#PTree.set">PTree.set</a></span> <span class="id"><a href="Unityping.html#r1">r1</a></span> <span class="id">ty2</span> <span class="id"><a href="Unityping.html#e">e</a></span>.(<span class="id"><a href="Unityping.html#UniSolver.te_typ">te_typ</a></span>); <span class="id">te_equ</span> := <span class="id"><a href="Unityping.html#e">e</a></span>.(<span class="id"><a href="Unityping.html#UniSolver.te_equ">te_equ</a></span>) |})<br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">ty1</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">ty2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="Unityping.html#T.eq">T.eq</a></span> <span class="id">ty1</span> <span class="id">ty2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id"><a href="Errors.html#OK">OK</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>, <span class="id"><a href="Unityping.html#e">e</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="Errors.html#Error">Error</a></span>(<span class="id"><a href="Errors.html#MSG">MSG</a></span> "<span class="id">ill</span>-<span class="id">typed</span> <span class="tactic">move</span> <span class="id">from</span> " :: <span class="id"><a href="Errors.html#POS">POS</a></span> <span class="id"><a href="Unityping.html#r1">r1</a></span> :: <span class="id"><a href="Errors.html#MSG">MSG</a></span> " <span class="id">to</span> " :: <span class="id"><a href="Errors.html#POS">POS</a></span> <span class="id"><a href="Unityping.html#r2">r2</a></span> :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">Solve the remaining subtyping constraints by iteration. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="UniSolver.solve_rec">solve_rec</a></span> (<span class="id">e</span>: <span class="id"><a href="Unityping.html#UniSolver.typenv">typenv</a></span>) (<span class="id">changed</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>) (<span class="id">q</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Unityping.html#UniSolver.constraint">constraint</a></span>) : <span class="id"><a href="Errors.html#res">res</a></span> (<span class="id"><a href="Unityping.html#UniSolver.typenv">typenv</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Unityping.html#q">q</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Errors.html#OK">OK</a></span> (<span class="id"><a href="Unityping.html#e">e</a></span>, <span class="id"><a href="Unityping.html#changed">changed</a></span>)<br/>
&nbsp;&nbsp;| (<span class="id">r1</span>, <span class="id">r2</span>) :: <span class="id">q</span>' =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">changed1</span>, <span class="id">e1</span>) &lt;- <span class="tactic">move</span> <span class="id"><a href="Unityping.html#e">e</a></span> <span class="id">r1</span> <span class="id">r2</span>; <span class="id"><a href="Unityping.html#solve_rec">solve_rec</a></span> <span class="id">e1</span> (<span class="id"><a href="Unityping.html#changed">changed</a></span> || <span class="id">changed1</span>) <span class="id">q</span>'<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">Measuring the state </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="UniSolver.move_shape">move_shape</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">e</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">changed</span> <span class="id">e</span>',<br/>
&nbsp;&nbsp;<span class="tactic">move</span> <span class="id"><a href="Unityping.html#e">e</a></span> <span class="id"><a href="Unityping.html#r1">r1</a></span> <span class="id"><a href="Unityping.html#r2">r2</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span> (<span class="id"><a href="Unityping.html#changed">changed</a></span>, <span class="id">e</span>') -&gt;<br/>
&nbsp;&nbsp;(<span class="id">e</span>'.(<span class="id"><a href="Unityping.html#UniSolver.te_equ">te_equ</a></span>) = <span class="id"><a href="Unityping.html#e">e</a></span>.(<span class="id"><a href="Unityping.html#UniSolver.te_equ">te_equ</a></span>) \/ <span class="id">e</span>'.(<span class="id"><a href="Unityping.html#UniSolver.te_equ">te_equ</a></span>) = (<span class="id"><a href="Unityping.html#r1">r1</a></span>, <span class="id"><a href="Unityping.html#r2">r2</a></span>) :: <span class="id"><a href="Unityping.html#e">e</a></span>.(<span class="id"><a href="Unityping.html#UniSolver.te_equ">te_equ</a></span>))<br/>
&nbsp;&nbsp;/\ (<span class="id"><a href="Unityping.html#changed">changed</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt; <span class="id">e</span>'.(<span class="id"><a href="Unityping.html#UniSolver.te_equ">te_equ</a></span>) = <span class="id"><a href="Unityping.html#e">e</a></span>.(<span class="id"><a href="Unityping.html#UniSolver.te_equ">te_equ</a></span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2043')">Proof.</div>
<div class="proofscript" id="proof2043">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="tactic">move</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">r1</span> <span class="id">r2</span>). <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">e</span>.(<span class="id"><a href="Unityping.html#UniSolver.te_typ">te_typ</a></span>)!<span class="id">r1</span> <span class="kwd">as</span> [<span class="id">ty1</span>|]; <span class="tactic">destruct</span> <span class="id">e</span>.(<span class="id"><a href="Unityping.html#UniSolver.te_typ">te_typ</a></span>)!<span class="id">r2</span> <span class="kwd">as</span> [<span class="id">ty2</span>|]; <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Unityping.html#T.eq">T.eq</a></span> <span class="id">ty1</span> <span class="id">ty2</span>); <span class="id">inv</span> <span class="id">H1</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">auto</span>. <span class="tactic">intros</span>. <span class="tactic">discriminate</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="UniSolver.length_move">length_move</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">e</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">changed</span> <span class="id">e</span>',<br/>
&nbsp;&nbsp;<span class="tactic">move</span> <span class="id"><a href="Unityping.html#e">e</a></span> <span class="id"><a href="Unityping.html#r1">r1</a></span> <span class="id"><a href="Unityping.html#r2">r2</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span> (<span class="id"><a href="Unityping.html#changed">changed</a></span>, <span class="id">e</span>') -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">e</span>'.(<span class="id"><a href="Unityping.html#UniSolver.te_equ">te_equ</a></span>) + (<span class="kwd">if</span> <span class="id"><a href="Unityping.html#changed">changed</a></span> <span class="kwd">then</span> 1 <span class="kwd">else</span> 0) &lt;= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span>(<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Unityping.html#e">e</a></span>.(<span class="id"><a href="Unityping.html#UniSolver.te_equ">te_equ</a></span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2044')">Proof.</div>
<div class="proofscript" id="proof2044">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="tactic">move</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">r1</span> <span class="id">r2</span>). <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">e</span>.(<span class="id"><a href="Unityping.html#UniSolver.te_typ">te_typ</a></span>)!<span class="id">r1</span> <span class="kwd">as</span> [<span class="id">ty1</span>|]; <span class="tactic">destruct</span> <span class="id">e</span>.(<span class="id"><a href="Unityping.html#UniSolver.te_typ">te_typ</a></span>)!<span class="id">r2</span> <span class="kwd">as</span> [<span class="id">ty2</span>|]; <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Unityping.html#T.eq">T.eq</a></span> <span class="id">ty1</span> <span class="id">ty2</span>); <span class="id">inv</span> <span class="id">H1</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="UniSolver.length_solve_rec">length_solve_rec</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">q</span> <span class="id">e</span> <span class="id">ch</span> <span class="id">e</span>' <span class="id">ch</span>',<br/>
&nbsp;&nbsp;<span class="id"><a href="Unityping.html#UniSolver.solve_rec">solve_rec</a></span> <span class="id"><a href="Unityping.html#e">e</a></span> <span class="id"><a href="Unityping.html#ch">ch</a></span> <span class="id"><a href="Unityping.html#q">q</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span> (<span class="id">e</span>', <span class="id">ch</span>') -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">e</span>'.(<span class="id"><a href="Unityping.html#UniSolver.te_equ">te_equ</a></span>) + (<span class="kwd">if</span> <span class="id">ch</span>' &amp;&amp; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#negb">negb</a></span> <span class="id"><a href="Unityping.html#ch">ch</a></span> <span class="kwd">then</span> 1 <span class="kwd">else</span> 0) &lt;= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Unityping.html#e">e</a></span>.(<span class="id"><a href="Unityping.html#UniSolver.te_equ">te_equ</a></span>) + <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Unityping.html#q">q</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2045')">Proof.</div>
<div class="proofscript" id="proof2045">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">q</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
- <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">replace</span> (<span class="id">ch</span>' &amp;&amp; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#negb">negb</a></span> <span class="id">ch</span>') <span class="kwd">with</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>. <span class="tactic">omega</span>. <span class="tactic">destruct</span> <span class="id">ch</span>'; <span class="tactic">auto</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">a</span> <span class="kwd">as</span> [<span class="id">r1</span> <span class="id">r2</span>]; <span class="id">monadInv</span> <span class="id">H</span>. <span class="tactic">rename</span> <span class="id">x0</span> <span class="id">into</span> <span class="id">e0</span>. <span class="tactic">rename</span> <span class="id">x</span> <span class="id">into</span> <span class="id">ch0</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">IHq</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> <span class="id">A</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="Unityping.html#UniSolver.length_move">length_move</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> <span class="id">B</span>.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">X</span> := (<span class="kwd">if</span> <span class="id">ch</span>' &amp;&amp; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#negb">negb</a></span> (<span class="id">ch</span> || <span class="id">ch0</span>) <span class="kwd">then</span> 1 <span class="kwd">else</span> 0)) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">Y</span> := (<span class="kwd">if</span> <span class="id">ch0</span> <span class="kwd">then</span> 1 <span class="kwd">else</span> 0)) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">Z</span> := (<span class="kwd">if</span> <span class="id">ch</span>' &amp;&amp; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#negb">negb</a></span> <span class="id">ch</span> <span class="kwd">then</span> 1 <span class="kwd">else</span> 0)) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">cut</span> (<span class="id">Z</span> &lt;= <span class="id">X</span> + <span class="id">Y</span>). <span class="tactic">intros</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">X</span>, <span class="id">Y</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>. <span class="tactic">destruct</span> <span class="id">ch</span>'; <span class="tactic">destruct</span> <span class="id">ch</span>; <span class="tactic">destruct</span> <span class="id">ch0</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="UniSolver.weight_typenv">weight_typenv</a></span> (<span class="id">e</span>: <span class="id"><a href="Unityping.html#UniSolver.typenv">typenv</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Unityping.html#e">e</a></span>.(<span class="id"><a href="Unityping.html#UniSolver.te_equ">te_equ</a></span>).<br/>
<br/>
<br/>
<div class="doc">Iterative solving of the remaining constraints </div>
<br/>
<span class="id">Function</span> <span class="id">solve_constraints</span> (<span class="id">e</span>: <span class="id"><a href="Unityping.html#UniSolver.typenv">typenv</a></span>) {<span class="kwd">measure</span> <span class="id"><a href="Unityping.html#UniSolver.weight_typenv">weight_typenv</a></span> <span class="id">e</span>}: <span class="id"><a href="Errors.html#res">res</a></span> <span class="id"><a href="Unityping.html#UniSolver.typenv">typenv</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Unityping.html#UniSolver.solve_rec">solve_rec</a></span> {| <span class="id"><a href="Unityping.html#UniSolver.Typenv">te_typ</a></span> := <span class="id"><a href="Unityping.html#e">e</a></span>.(<span class="id"><a href="Unityping.html#UniSolver.te_typ">te_typ</a></span>); <span class="id">te_equ</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> |} <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> <span class="id"><a href="Unityping.html#e">e</a></span>.(<span class="id"><a href="Unityping.html#UniSolver.te_equ">te_equ</a></span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Errors.html#OK">OK</a></span>(<span class="id">e</span>', <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>) =&gt; <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id"><a href="Unityping.html#e">e</a></span>                   <span class="docright">(* no more changes, fixpoint reached  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Errors.html#OK">OK</a></span>(<span class="id">e</span>', <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>)  =&gt; <span class="id"><a href="Unityping.html#solve_constraints">solve_constraints</a></span> <span class="id">e</span>'   <span class="docright">(* one more iteration  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Errors.html#Error">Error</a></span> <span class="id">msg</span> =&gt; <span class="id"><a href="Errors.html#Error">Error</a></span> <span class="id">msg</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2046')">Proof.</div>
<div class="proofscript" id="proof2046">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id"><a href="Unityping.html#UniSolver.length_solve_rec">length_solve_rec</a></span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Unityping.html#UniSolver.weight_typenv">weight_typenv</a></span>. <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="UniSolver.typassign">typassign</a></span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span> -&gt; <span class="id"><a href="Unityping.html#T.t">T.t</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="UniSolver.makeassign">makeassign</a></span> (<span class="id">e</span>: <span class="id"><a href="Unityping.html#UniSolver.typenv">typenv</a></span>) : <span class="id"><a href="Unityping.html#UniSolver.typassign">typassign</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="kwd">match</span> <span class="id"><a href="Unityping.html#e">e</a></span>.(<span class="id"><a href="Unityping.html#UniSolver.te_typ">te_typ</a></span>)!<span class="id"><a href="Unityping.html#x">x</a></span> <span class="kwd">with</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">ty</span> =&gt; <span class="id">ty</span> | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="Unityping.html#T.default">T.default</a></span> <span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="UniSolver.solve">solve</a></span> (<span class="id">e</span>: <span class="id"><a href="Unityping.html#UniSolver.typenv">typenv</a></span>) : <span class="id"><a href="Errors.html#res">res</a></span> <span class="id"><a href="Unityping.html#UniSolver.typassign">typassign</a></span> :=<br/>
&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">e</span>' &lt;- <span class="id"><a href="Unityping.html#UniSolver.solve_constraints">solve_constraints</a></span> <span class="id"><a href="Unityping.html#e">e</a></span>; <span class="id"><a href="Errors.html#OK">OK</a></span>(<span class="id"><a href="Unityping.html#UniSolver.makeassign">makeassign</a></span> <span class="id">e</span>').<br/>
<br/>
<div class="doc">What it means to be a solution </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="UniSolver.satisf">satisf</a></span> (<span class="id">te</span>: <span class="id"><a href="Unityping.html#UniSolver.typassign">typassign</a></span>) (<span class="id">e</span>: <span class="id"><a href="Unityping.html#UniSolver.typenv">typenv</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span> <span class="id">ty</span>, <span class="id"><a href="Unityping.html#e">e</a></span>.(<span class="id"><a href="Unityping.html#UniSolver.te_typ">te_typ</a></span>)!<span class="id"><a href="Unityping.html#x">x</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="Unityping.html#ty">ty</a></span> -&gt; <span class="id"><a href="Unityping.html#te">te</a></span> <span class="id"><a href="Unityping.html#x">x</a></span> = <span class="id"><a href="Unityping.html#ty">ty</a></span>)<br/>
/\ (<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="Unityping.html#x">x</a></span>, <span class="id"><a href="Unityping.html#y">y</a></span>) <span class="id"><a href="Unityping.html#e">e</a></span>.(<span class="id"><a href="Unityping.html#UniSolver.te_equ">te_equ</a></span>) -&gt; <span class="id"><a href="Unityping.html#te">te</a></span> <span class="id"><a href="Unityping.html#x">x</a></span> = <span class="id"><a href="Unityping.html#te">te</a></span> <span class="id"><a href="Unityping.html#y">y</a></span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="UniSolver.satisf_initial">satisf_initial</a></span>: <span class="kwd">forall</span> <span class="id">te</span>, <span class="id"><a href="Unityping.html#UniSolver.satisf">satisf</a></span> <span class="id"><a href="Unityping.html#te">te</a></span> <span class="id"><a href="Unityping.html#UniSolver.initial">initial</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2047')">Proof.</div>
<div class="proofscript" id="proof2047">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Unityping.html#UniSolver.initial">initial</a></span>; <span class="tactic">intros</span>; <span class="tactic">split</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PTree.gempty">PTree.gempty</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Soundness proof </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="UniSolver.set_incr">set_incr</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">te</span> <span class="id">x</span> <span class="id">ty</span> <span class="id">e</span> <span class="id">e</span>', <span class="tactic">set</span> <span class="id"><a href="Unityping.html#e">e</a></span> <span class="id"><a href="Unityping.html#x">x</a></span> <span class="id"><a href="Unityping.html#ty">ty</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id">e</span>' -&gt; <span class="id"><a href="Unityping.html#UniSolver.satisf">satisf</a></span> <span class="id"><a href="Unityping.html#te">te</a></span> <span class="id">e</span>' -&gt; <span class="id"><a href="Unityping.html#UniSolver.satisf">satisf</a></span> <span class="id"><a href="Unityping.html#te">te</a></span> <span class="id"><a href="Unityping.html#e">e</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2048')">Proof.</div>
<div class="proofscript" id="proof2048">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="tactic">set</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> (<span class="id"><a href="Unityping.html#UniSolver.te_typ">te_typ</a></span> <span class="id">e</span>)!<span class="id">x</span> <span class="kwd">as</span> [<span class="id">ty</span>'|] <span class="id">eqn</span>:<span class="id">E</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id"><a href="Unityping.html#T.eq">T.eq</a></span> <span class="id">ty</span> <span class="id">ty</span>'); <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">auto</span>.<br/>
- <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">A</span> <span class="id">B</span>]; <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">red</span>; <span class="tactic">split</span>; <span class="tactic">intros</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">A</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PTree.gso">PTree.gso</a></span> <span class="tactic">by</span> <span class="tactic">congruence</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">set_incr</span>: <span class="id">ty</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="UniSolver.set_sound">set_sound</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">te</span> <span class="id">x</span> <span class="id">ty</span> <span class="id">e</span> <span class="id">e</span>', <span class="tactic">set</span> <span class="id"><a href="Unityping.html#e">e</a></span> <span class="id"><a href="Unityping.html#x">x</a></span> <span class="id"><a href="Unityping.html#ty">ty</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id">e</span>' -&gt; <span class="id"><a href="Unityping.html#UniSolver.satisf">satisf</a></span> <span class="id"><a href="Unityping.html#te">te</a></span> <span class="id">e</span>' -&gt; <span class="id"><a href="Unityping.html#te">te</a></span> <span class="id"><a href="Unityping.html#x">x</a></span> = <span class="id"><a href="Unityping.html#ty">ty</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2049')">Proof.</div>
<div class="proofscript" id="proof2049">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="tactic">set</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">P</span> <span class="id">Q</span>].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Unityping.html#UniSolver.te_typ">te_typ</a></span> <span class="id">e</span>)!<span class="id">x</span> <span class="kwd">as</span> [<span class="id">ty</span>'|] <span class="id">eqn</span>:<span class="id">E</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id"><a href="Unityping.html#T.eq">T.eq</a></span> <span class="id">ty</span> <span class="id">ty</span>'); <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">eauto</span>.<br/>
- <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">P</span>. <span class="tactic">apply</span> <span class="id">P</span>. <span class="tactic">apply</span> <span class="id"><a href="Maps.html#PTree.gss">PTree.gss</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="UniSolver.set_list_incr">set_list_incr</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">te</span> <span class="id">xl</span> <span class="id">tyl</span> <span class="id">e</span> <span class="id">e</span>', <span class="id"><a href="Unityping.html#UniSolver.set_list">set_list</a></span> <span class="id"><a href="Unityping.html#e">e</a></span> <span class="id"><a href="Unityping.html#xl">xl</a></span> <span class="id"><a href="Unityping.html#tyl">tyl</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id">e</span>' -&gt; <span class="id"><a href="Unityping.html#UniSolver.satisf">satisf</a></span> <span class="id"><a href="Unityping.html#te">te</a></span> <span class="id">e</span>' -&gt; <span class="id"><a href="Unityping.html#UniSolver.satisf">satisf</a></span> <span class="id"><a href="Unityping.html#te">te</a></span> <span class="id"><a href="Unityping.html#e">e</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2050')">Proof.</div>
<div class="proofscript" id="proof2050">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">xl</span>; <span class="tactic">destruct</span> <span class="id">tyl</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="id">monadInv</span> <span class="id">H</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">set_list_incr</span>: <span class="id">ty</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="UniSolver.set_list_sound">set_list_sound</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">te</span> <span class="id">xl</span> <span class="id">tyl</span> <span class="id">e</span> <span class="id">e</span>', <span class="id"><a href="Unityping.html#UniSolver.set_list">set_list</a></span> <span class="id"><a href="Unityping.html#e">e</a></span> <span class="id"><a href="Unityping.html#xl">xl</a></span> <span class="id"><a href="Unityping.html#tyl">tyl</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id">e</span>' -&gt; <span class="id"><a href="Unityping.html#UniSolver.satisf">satisf</a></span> <span class="id"><a href="Unityping.html#te">te</a></span> <span class="id">e</span>' -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="Unityping.html#te">te</a></span> <span class="id"><a href="Unityping.html#xl">xl</a></span> = <span class="id"><a href="Unityping.html#tyl">tyl</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2051')">Proof.</div>
<div class="proofscript" id="proof2051">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">xl</span>; <span class="tactic">destruct</span> <span class="id">tyl</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="id">monadInv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">f_equal</span>. <span class="tactic">eapply</span> <span class="id"><a href="Unityping.html#UniSolver.set_sound">set_sound</a></span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>. <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="UniSolver.move_incr">move_incr</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">te</span> <span class="id">e</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">e</span>' <span class="id">changed</span>,<br/>
&nbsp;&nbsp;<span class="tactic">move</span> <span class="id"><a href="Unityping.html#e">e</a></span> <span class="id"><a href="Unityping.html#r1">r1</a></span> <span class="id"><a href="Unityping.html#r2">r2</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span>(<span class="id"><a href="Unityping.html#changed">changed</a></span>, <span class="id">e</span>') -&gt; <span class="id"><a href="Unityping.html#UniSolver.satisf">satisf</a></span> <span class="id"><a href="Unityping.html#te">te</a></span> <span class="id">e</span>' -&gt; <span class="id"><a href="Unityping.html#UniSolver.satisf">satisf</a></span> <span class="id"><a href="Unityping.html#te">te</a></span> <span class="id"><a href="Unityping.html#e">e</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2052')">Proof.</div>
<div class="proofscript" id="proof2052">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="tactic">move</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">P</span> <span class="id">Q</span>].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">r1</span> <span class="id">r2</span>). <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Unityping.html#UniSolver.te_typ">te_typ</a></span> <span class="id">e</span>)!<span class="id">r1</span> <span class="kwd">as</span> [<span class="id">ty1</span>|] <span class="id">eqn</span>:<span class="id">E1</span>;<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Unityping.html#UniSolver.te_typ">te_typ</a></span> <span class="id">e</span>)!<span class="id">r2</span> <span class="kwd">as</span> [<span class="id">ty2</span>|] <span class="id">eqn</span>:<span class="id">E2</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id"><a href="Unityping.html#T.eq">T.eq</a></span> <span class="id">ty1</span> <span class="id">ty2</span>); <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
- <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">P</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PTree.gso">PTree.gso</a></span> <span class="tactic">by</span> <span class="tactic">congruence</span>. <span class="tactic">auto</span>.<br/>
- <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">P</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PTree.gso">PTree.gso</a></span> <span class="tactic">by</span> <span class="tactic">congruence</span>. <span class="tactic">auto</span>.<br/>
- <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">move_incr</span>: <span class="id">ty</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="UniSolver.move_sound">move_sound</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">te</span> <span class="id">e</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">e</span>' <span class="id">changed</span>,<br/>
&nbsp;&nbsp;<span class="tactic">move</span> <span class="id"><a href="Unityping.html#e">e</a></span> <span class="id"><a href="Unityping.html#r1">r1</a></span> <span class="id"><a href="Unityping.html#r2">r2</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span>(<span class="id"><a href="Unityping.html#changed">changed</a></span>, <span class="id">e</span>') -&gt; <span class="id"><a href="Unityping.html#UniSolver.satisf">satisf</a></span> <span class="id"><a href="Unityping.html#te">te</a></span> <span class="id">e</span>' -&gt; <span class="id"><a href="Unityping.html#te">te</a></span> <span class="id"><a href="Unityping.html#r1">r1</a></span> = <span class="id"><a href="Unityping.html#te">te</a></span> <span class="id"><a href="Unityping.html#r2">r2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2053')">Proof.</div>
<div class="proofscript" id="proof2053">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="tactic">move</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">P</span> <span class="id">Q</span>].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">r1</span> <span class="id">r2</span>). <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Unityping.html#UniSolver.te_typ">te_typ</a></span> <span class="id">e</span>)!<span class="id">r1</span> <span class="kwd">as</span> [<span class="id">ty1</span>|] <span class="id">eqn</span>:<span class="id">E1</span>;<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Unityping.html#UniSolver.te_typ">te_typ</a></span> <span class="id">e</span>)!<span class="id">r2</span> <span class="kwd">as</span> [<span class="id">ty2</span>|] <span class="id">eqn</span>:<span class="id">E2</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id"><a href="Unityping.html#T.eq">T.eq</a></span> <span class="id">ty1</span> <span class="id">ty2</span>); <span class="id">inv</span> <span class="id">H</span>. <span class="id">erewrite</span> ! <span class="id">P</span> <span class="tactic">by</span> <span class="tactic">eauto</span>. <span class="tactic">auto</span>.<br/>
- <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> (<span class="id">P</span> <span class="id">r1</span> <span class="id">ty1</span>). <span class="tactic">rewrite</span> (<span class="id">P</span> <span class="id">r2</span> <span class="id">ty1</span>). <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Maps.html#PTree.gss">PTree.gss</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PTree.gso">PTree.gso</a></span> <span class="tactic">by</span> <span class="tactic">congruence</span>. <span class="tactic">auto</span>.<br/>
- <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> (<span class="id">P</span> <span class="id">r1</span> <span class="id">ty2</span>). <span class="tactic">rewrite</span> (<span class="id">P</span> <span class="id">r2</span> <span class="id">ty2</span>). <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PTree.gso">PTree.gso</a></span> <span class="tactic">by</span> <span class="tactic">congruence</span>. <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="Maps.html#PTree.gss">PTree.gss</a></span>.<br/>
- <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">apply</span> <span class="id">Q</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="UniSolver.solve_rec_incr">solve_rec_incr</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">te</span> <span class="id">q</span> <span class="id">e</span> <span class="id">changed</span> <span class="id">e</span>' <span class="id">changed</span>',<br/>
&nbsp;&nbsp;<span class="id"><a href="Unityping.html#UniSolver.solve_rec">solve_rec</a></span> <span class="id"><a href="Unityping.html#e">e</a></span> <span class="id"><a href="Unityping.html#changed">changed</a></span> <span class="id"><a href="Unityping.html#q">q</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span>(<span class="id">e</span>', <span class="id">changed</span>') -&gt; <span class="id"><a href="Unityping.html#UniSolver.satisf">satisf</a></span> <span class="id"><a href="Unityping.html#te">te</a></span> <span class="id">e</span>' -&gt; <span class="id"><a href="Unityping.html#UniSolver.satisf">satisf</a></span> <span class="id"><a href="Unityping.html#te">te</a></span> <span class="id"><a href="Unityping.html#e">e</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2054')">Proof.</div>
<div class="proofscript" id="proof2054">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">q</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
- <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">auto</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">a</span> <span class="kwd">as</span> [<span class="id">r1</span> <span class="id">r2</span>]; <span class="id">monadInv</span> <span class="id">H</span>. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="UniSolver.solve_rec_sound">solve_rec_sound</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">te</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">q</span> <span class="id">e</span> <span class="id">changed</span> <span class="id">e</span>' <span class="id">changed</span>',<br/>
&nbsp;&nbsp;<span class="id"><a href="Unityping.html#UniSolver.solve_rec">solve_rec</a></span> <span class="id"><a href="Unityping.html#e">e</a></span> <span class="id"><a href="Unityping.html#changed">changed</a></span> <span class="id"><a href="Unityping.html#q">q</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span>(<span class="id">e</span>', <span class="id">changed</span>') -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="Unityping.html#r1">r1</a></span>, <span class="id"><a href="Unityping.html#r2">r2</a></span>) <span class="id"><a href="Unityping.html#q">q</a></span> -&gt; <span class="id"><a href="Unityping.html#UniSolver.satisf">satisf</a></span> <span class="id"><a href="Unityping.html#te">te</a></span> <span class="id">e</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="Unityping.html#te">te</a></span> <span class="id"><a href="Unityping.html#r1">r1</a></span> = <span class="id"><a href="Unityping.html#te">te</a></span> <span class="id"><a href="Unityping.html#r2">r2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2055')">Proof.</div>
<div class="proofscript" id="proof2055">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">q</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
- <span class="id">contradiction</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">a</span> <span class="kwd">as</span> [<span class="id">r3</span> <span class="id">r4</span>]; <span class="id">monadInv</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;+ <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">eapply</span> <span class="id"><a href="Unityping.html#UniSolver.move_sound">move_sound</a></span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="Unityping.html#UniSolver.solve_rec_incr">solve_rec_incr</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">IHq</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="UniSolver.move_false">move_false</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">e</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">e</span>',<br/>
&nbsp;&nbsp;<span class="tactic">move</span> <span class="id"><a href="Unityping.html#e">e</a></span> <span class="id"><a href="Unityping.html#r1">r1</a></span> <span class="id"><a href="Unityping.html#r2">r2</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span>(<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>, <span class="id">e</span>') -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="Unityping.html#UniSolver.te_typ">te_typ</a></span> <span class="id">e</span>' = <span class="id"><a href="Unityping.html#UniSolver.te_typ">te_typ</a></span> <span class="id"><a href="Unityping.html#e">e</a></span> /\ <span class="id"><a href="Unityping.html#UniSolver.makeassign">makeassign</a></span> <span class="id"><a href="Unityping.html#e">e</a></span> <span class="id"><a href="Unityping.html#r1">r1</a></span> = <span class="id"><a href="Unityping.html#UniSolver.makeassign">makeassign</a></span> <span class="id"><a href="Unityping.html#e">e</a></span> <span class="id"><a href="Unityping.html#r2">r2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2056')">Proof.</div>
<div class="proofscript" id="proof2056">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="tactic">move</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">r1</span> <span class="id">r2</span>). <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Unityping.html#UniSolver.makeassign">makeassign</a></span>;<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Unityping.html#UniSolver.te_typ">te_typ</a></span> <span class="id">e</span>)!<span class="id">r1</span> <span class="kwd">as</span> [<span class="id">ty1</span>|] <span class="id">eqn</span>:<span class="id">E1</span>;<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Unityping.html#UniSolver.te_typ">te_typ</a></span> <span class="id">e</span>)!<span class="id">r2</span> <span class="kwd">as</span> [<span class="id">ty2</span>|] <span class="id">eqn</span>:<span class="id">E2</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id"><a href="Unityping.html#T.eq">T.eq</a></span> <span class="id">ty1</span> <span class="id">ty2</span>); <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">auto</span>.<br/>
- <span class="tactic">discriminate</span>.<br/>
- <span class="tactic">discriminate</span>.<br/>
- <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="UniSolver.solve_rec_false">solve_rec_false</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">q</span> <span class="id">e</span> <span class="id">changed</span> <span class="id">e</span>',<br/>
&nbsp;&nbsp;<span class="id"><a href="Unityping.html#UniSolver.solve_rec">solve_rec</a></span> <span class="id"><a href="Unityping.html#e">e</a></span> <span class="id"><a href="Unityping.html#changed">changed</a></span> <span class="id"><a href="Unityping.html#q">q</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span>(<span class="id">e</span>', <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="Unityping.html#changed">changed</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> /\<br/>
&nbsp;&nbsp;(<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="Unityping.html#r1">r1</a></span>, <span class="id"><a href="Unityping.html#r2">r2</a></span>) <span class="id"><a href="Unityping.html#q">q</a></span> -&gt; <span class="id"><a href="Unityping.html#UniSolver.makeassign">makeassign</a></span> <span class="id"><a href="Unityping.html#e">e</a></span> <span class="id"><a href="Unityping.html#r1">r1</a></span> = <span class="id"><a href="Unityping.html#UniSolver.makeassign">makeassign</a></span> <span class="id"><a href="Unityping.html#e">e</a></span> <span class="id"><a href="Unityping.html#r2">r2</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2057')">Proof.</div>
<div class="proofscript" id="proof2057">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">q</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
- <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">tauto</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">a</span> <span class="kwd">as</span> [<span class="id">r3</span> <span class="id">r4</span>]; <span class="id">monadInv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">IHq</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">P</span> <span class="id">Q</span>].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">changed</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>. <span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="Unityping.html#UniSolver.move_false">move_false</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">U</span> <span class="id">V</span>].<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">auto</span>. <span class="tactic">intros</span> [<span class="id">A</span>|<span class="id">A</span>]. <span class="id">inv</span> <span class="id">A</span>. <span class="tactic">auto</span>. <span class="id">exploit</span> <span class="id">Q</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Unityping.html#UniSolver.makeassign">makeassign</a></span>; <span class="tactic">rewrite</span> <span class="id">U</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="UniSolver.solve_constraints_incr">solve_constraints_incr</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">te</span> <span class="id">e</span> <span class="id">e</span>', <span class="id"><a href="Unityping.html#UniSolver.solve_constraints">solve_constraints</a></span> <span class="id"><a href="Unityping.html#e">e</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id">e</span>' -&gt; <span class="id"><a href="Unityping.html#UniSolver.satisf">satisf</a></span> <span class="id"><a href="Unityping.html#te">te</a></span> <span class="id">e</span>' -&gt; <span class="id"><a href="Unityping.html#UniSolver.satisf">satisf</a></span> <span class="id"><a href="Unityping.html#te">te</a></span> <span class="id"><a href="Unityping.html#e">e</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2058')">Proof.</div>
<div class="proofscript" id="proof2058">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">te</span> <span class="id">e</span>; <span class="id">functional</span> <span class="tactic">induction</span> (<span class="id"><a href="Unityping.html#UniSolver.solve_constraints">solve_constraints</a></span> <span class="id">e</span>); <span class="tactic">intros</span>.<br/>
- <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">auto</span>.<br/>
- <span class="id">exploit</span> <span class="id"><a href="Unityping.html#UniSolver.solve_rec_incr">solve_rec_incr</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">A</span> <span class="id">B</span>].<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">intros</span>; <span class="tactic">eapply</span> <span class="id"><a href="Unityping.html#UniSolver.solve_rec_sound">solve_rec_sound</a></span>; <span class="tactic">eauto</span>.<br/>
- <span class="tactic">discriminate</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="UniSolver.solve_constraints_sound">solve_constraints_sound</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">e</span> <span class="id">e</span>', <span class="id"><a href="Unityping.html#UniSolver.solve_constraints">solve_constraints</a></span> <span class="id"><a href="Unityping.html#e">e</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id">e</span>' -&gt; <span class="id"><a href="Unityping.html#UniSolver.satisf">satisf</a></span> (<span class="id"><a href="Unityping.html#UniSolver.makeassign">makeassign</a></span> <span class="id">e</span>') <span class="id">e</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2059')">Proof.</div>
<div class="proofscript" id="proof2059">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">e0</span>; <span class="id">functional</span> <span class="tactic">induction</span> (<span class="id"><a href="Unityping.html#UniSolver.solve_constraints">solve_constraints</a></span> <span class="id">e0</span>); <span class="tactic">intros</span>.<br/>
- <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Unityping.html#UniSolver.makeassign">makeassign</a></span>; <span class="tactic">rewrite</span> <span class="id">H</span>. <span class="tactic">split</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="Unityping.html#UniSolver.solve_rec_false">solve_rec_false</a></span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">A</span> <span class="id">B</span>]. <span class="tactic">eapply</span> <span class="id">B</span>; <span class="tactic">eauto</span>.<br/>
- <span class="tactic">eauto</span>.<br/>
- <span class="tactic">discriminate</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="UniSolver.solve_sound">solve_sound</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">e</span> <span class="id">te</span>, <span class="id"><a href="Unityping.html#UniSolver.solve">solve</a></span> <span class="id"><a href="Unityping.html#e">e</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id"><a href="Unityping.html#te">te</a></span> -&gt; <span class="id"><a href="Unityping.html#UniSolver.satisf">satisf</a></span> <span class="id"><a href="Unityping.html#te">te</a></span> <span class="id"><a href="Unityping.html#e">e</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2060')">Proof.</div>
<div class="proofscript" id="proof2060">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Unityping.html#UniSolver.solve">solve</a></span>; <span class="tactic">intros</span>. <span class="id">monadInv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Unityping.html#UniSolver.solve_constraints_incr">solve_constraints_incr</a></span>. <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="Unityping.html#UniSolver.solve_constraints_sound">solve_constraints_sound</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Completeness proof </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="UniSolver.set_complete">set_complete</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">te</span> <span class="id">e</span> <span class="id">x</span> <span class="id">ty</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="Unityping.html#UniSolver.satisf">satisf</a></span> <span class="id"><a href="Unityping.html#te">te</a></span> <span class="id"><a href="Unityping.html#e">e</a></span> -&gt; <span class="id"><a href="Unityping.html#te">te</a></span> <span class="id"><a href="Unityping.html#x">x</a></span> = <span class="id"><a href="Unityping.html#ty">ty</a></span> -&gt; <span class="id">exists</span> <span class="id">e</span>', <span class="tactic">set</span> <span class="id"><a href="Unityping.html#e">e</a></span> <span class="id"><a href="Unityping.html#x">x</a></span> <span class="id"><a href="Unityping.html#ty">ty</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id">e</span>' /\ <span class="id"><a href="Unityping.html#UniSolver.satisf">satisf</a></span> <span class="id"><a href="Unityping.html#te">te</a></span> <span class="id">e</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2061')">Proof.</div>
<div class="proofscript" id="proof2061">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="tactic">set</span>; <span class="tactic">intros</span>. <span class="tactic">generalize</span> <span class="id">H</span>; <span class="tactic">intros</span> [<span class="id">P</span> <span class="id">Q</span>].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Unityping.html#UniSolver.te_typ">te_typ</a></span> <span class="id">e</span>)!<span class="id">x</span> <span class="kwd">as</span> [<span class="id">ty1</span>|] <span class="id">eqn</span>:<span class="id">E</span>.<br/>
- <span class="tactic">replace</span> <span class="id">ty1</span> <span class="kwd">with</span> <span class="id">ty</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Coqlib.html#dec_eq_true">dec_eq_true</a></span>. <span class="id">exists</span> <span class="id">e</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">P</span>; <span class="tactic">eauto</span>. <span class="tactic">congruence</span>.<br/>
- <span class="id">econstructor</span>; <span class="tactic">split</span>; <span class="tactic">eauto</span>. <span class="tactic">split</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PTree.gsspec">PTree.gsspec</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">x0</span> <span class="id">x</span>). <span class="tactic">congruence</span>. <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="UniSolver.set_list_complete">set_list_complete</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">te</span> <span class="id">xl</span> <span class="id">tyl</span> <span class="id">e</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="Unityping.html#UniSolver.satisf">satisf</a></span> <span class="id"><a href="Unityping.html#te">te</a></span> <span class="id"><a href="Unityping.html#e">e</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="Unityping.html#te">te</a></span> <span class="id"><a href="Unityping.html#xl">xl</a></span> = <span class="id"><a href="Unityping.html#tyl">tyl</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">e</span>', <span class="id"><a href="Unityping.html#UniSolver.set_list">set_list</a></span> <span class="id"><a href="Unityping.html#e">e</a></span> <span class="id"><a href="Unityping.html#xl">xl</a></span> <span class="id"><a href="Unityping.html#tyl">tyl</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id">e</span>' /\ <span class="id"><a href="Unityping.html#UniSolver.satisf">satisf</a></span> <span class="id"><a href="Unityping.html#te">te</a></span> <span class="id">e</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2062')">Proof.</div>
<div class="proofscript" id="proof2062">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">xl</span>; <span class="tactic">intros</span>; <span class="id">inv</span> <span class="id">H0</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id"><a href="Unityping.html#UniSolver.set_complete">set_complete</a></span> <span class="id">te</span> <span class="id">e</span> <span class="id">a</span> (<span class="id">te</span> <span class="id">a</span>)); <span class="tactic">auto</span>. <span class="tactic">intros</span> (<span class="id">e1</span> &amp; <span class="id">P</span> &amp; <span class="id">Q</span>).<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">IHxl</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id">te</span> <span class="id">xl</span>) <span class="id">e1</span>); <span class="tactic">auto</span>. <span class="tactic">intros</span> (<span class="id">e2</span> &amp; <span class="id">U</span> &amp; <span class="id">V</span>).<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">e2</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">rewrite</span> <span class="id">P</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="UniSolver.move_complete">move_complete</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">te</span> <span class="id">e</span> <span class="id">r1</span> <span class="id">r2</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="Unityping.html#UniSolver.satisf">satisf</a></span> <span class="id"><a href="Unityping.html#te">te</a></span> <span class="id"><a href="Unityping.html#e">e</a></span> -&gt; <span class="id"><a href="Unityping.html#te">te</a></span> <span class="id"><a href="Unityping.html#r1">r1</a></span> = <span class="id"><a href="Unityping.html#te">te</a></span> <span class="id"><a href="Unityping.html#r2">r2</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">changed</span> <span class="id">e</span>', <span class="tactic">move</span> <span class="id"><a href="Unityping.html#e">e</a></span> <span class="id"><a href="Unityping.html#r1">r1</a></span> <span class="id"><a href="Unityping.html#r2">r2</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span>(<span class="id"><a href="Unityping.html#changed">changed</a></span>, <span class="id">e</span>') /\ <span class="id"><a href="Unityping.html#UniSolver.satisf">satisf</a></span> <span class="id"><a href="Unityping.html#te">te</a></span> <span class="id">e</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2063')">Proof.</div>
<div class="proofscript" id="proof2063">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="tactic">move</span>; <span class="tactic">intros</span>. <span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">intros</span> <span class="id">P</span> <span class="id">Q</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Q</span>': <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="Unityping.html#x">x</a></span>, <span class="id"><a href="Unityping.html#y">y</a></span>) ((<span class="id">r1</span>, <span class="id">r2</span>) :: <span class="id"><a href="Unityping.html#UniSolver.te_equ">te_equ</a></span> <span class="id">e</span>) -&gt; <span class="id">te</span> <span class="id"><a href="Unityping.html#x">x</a></span> = <span class="id">te</span> <span class="id"><a href="Unityping.html#y">y</a></span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H1</span>; <span class="tactic">auto</span>. <span class="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">r1</span> <span class="id">r2</span>). <span class="id">econstructor</span>; <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Unityping.html#UniSolver.te_typ">te_typ</a></span> <span class="id">e</span>)!<span class="id">r1</span> <span class="kwd">as</span> [<span class="id">ty1</span>|] <span class="id">eqn</span>:<span class="id">E1</span>;<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Unityping.html#UniSolver.te_typ">te_typ</a></span> <span class="id">e</span>)!<span class="id">r2</span> <span class="kwd">as</span> [<span class="id">ty2</span>|] <span class="id">eqn</span>:<span class="id">E2</span>.<br/>
- <span class="tactic">replace</span> <span class="id">ty2</span> <span class="kwd">with</span> <span class="id">ty1</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Coqlib.html#dec_eq_true">dec_eq_true</a></span>. <span class="id">econstructor</span>; <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">P</span> <span class="id">r1</span>); <span class="tactic">eauto</span>. <span class="id">exploit</span> (<span class="id">P</span> <span class="id">r2</span>); <span class="tactic">eauto</span>. <span class="tactic">congruence</span>.<br/>
- <span class="id">econstructor</span>; <span class="id">econstructor</span>; <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="tactic">auto</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PTree.gsspec">PTree.gsspec</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">x</span> <span class="id">r2</span>).<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H0</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
- <span class="id">econstructor</span>; <span class="id">econstructor</span>; <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="tactic">auto</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Maps.html#PTree.gsspec">PTree.gsspec</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">destruct</span> (<span class="id"><a href="Coqlib.html#peq">peq</a></span> <span class="id">x</span> <span class="id">r1</span>).<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H1</span>. <span class="tactic">rewrite</span> <span class="id">H0</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
- <span class="id">econstructor</span>; <span class="id">econstructor</span>; <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="UniSolver.solve_rec_complete">solve_rec_complete</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">te</span> <span class="id">q</span> <span class="id">e</span> <span class="id">changed</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="Unityping.html#UniSolver.satisf">satisf</a></span> <span class="id"><a href="Unityping.html#te">te</a></span> <span class="id"><a href="Unityping.html#e">e</a></span> -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">r1</span> <span class="id">r2</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="Unityping.html#r1">r1</a></span>, <span class="id"><a href="Unityping.html#r2">r2</a></span>) <span class="id"><a href="Unityping.html#q">q</a></span> -&gt; <span class="id"><a href="Unityping.html#te">te</a></span> <span class="id"><a href="Unityping.html#r1">r1</a></span> = <span class="id"><a href="Unityping.html#te">te</a></span> <span class="id"><a href="Unityping.html#r2">r2</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">e</span>' <span class="id">changed</span>', <span class="id"><a href="Unityping.html#UniSolver.solve_rec">solve_rec</a></span> <span class="id"><a href="Unityping.html#e">e</a></span> <span class="id"><a href="Unityping.html#changed">changed</a></span> <span class="id"><a href="Unityping.html#q">q</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span>(<span class="id">e</span>', <span class="id">changed</span>') /\ <span class="id"><a href="Unityping.html#UniSolver.satisf">satisf</a></span> <span class="id"><a href="Unityping.html#te">te</a></span> <span class="id">e</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2064')">Proof.</div>
<div class="proofscript" id="proof2064">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">q</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
- <span class="id">econstructor</span>; <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">a</span> <span class="kwd">as</span> [<span class="id">r1</span> <span class="id">r2</span>].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id"><a href="Unityping.html#UniSolver.move_complete">move_complete</a></span> <span class="id">te</span> <span class="id">e</span> <span class="id">r1</span> <span class="id">r2</span>); <span class="tactic">auto</span>. <span class="tactic">intros</span> (<span class="id">changed1</span> &amp; <span class="id">e1</span> &amp; <span class="id">A</span> &amp; <span class="id">B</span>).<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">IHq</span> <span class="id">e1</span> (<span class="id">changed</span> || <span class="id">changed1</span>)); <span class="tactic">auto</span>. <span class="tactic">intros</span> (<span class="id">e</span>' &amp; <span class="id">changed</span>' &amp; <span class="id">C</span> &amp; <span class="id">D</span>).<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">e</span>'; <span class="id">exists</span> <span class="id">changed</span>'. <span class="tactic">rewrite</span> <span class="id">A</span>; <span class="tactic">simpl</span>; <span class="tactic">rewrite</span> <span class="id">C</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="UniSolver.solve_constraints_complete">solve_constraints_complete</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">te</span> <span class="id">e</span>, <span class="id"><a href="Unityping.html#UniSolver.satisf">satisf</a></span> <span class="id"><a href="Unityping.html#te">te</a></span> <span class="id"><a href="Unityping.html#e">e</a></span> -&gt; <span class="id">exists</span> <span class="id">e</span>', <span class="id"><a href="Unityping.html#UniSolver.solve_constraints">solve_constraints</a></span> <span class="id"><a href="Unityping.html#e">e</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id">e</span>' /\ <span class="id"><a href="Unityping.html#UniSolver.satisf">satisf</a></span> <span class="id"><a href="Unityping.html#te">te</a></span> <span class="id">e</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2065')">Proof.</div>
<div class="proofscript" id="proof2065">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">te</span> <span class="id">e</span>. <span class="id">functional</span> <span class="tactic">induction</span> (<span class="id"><a href="Unityping.html#UniSolver.solve_constraints">solve_constraints</a></span> <span class="id">e</span>); <span class="tactic">intros</span>.<br/>
- <span class="id">exists</span> <span class="id">e</span>; <span class="tactic">auto</span>.<br/>
- <span class="id">exploit</span> (<span class="id"><a href="Unityping.html#UniSolver.solve_rec_complete">solve_rec_complete</a></span> <span class="id">te</span> (<span class="id"><a href="Unityping.html#UniSolver.te_equ">te_equ</a></span> <span class="id">e</span>) {| <span class="id"><a href="Unityping.html#UniSolver.Typenv">te_typ</a></span> := <span class="id"><a href="Unityping.html#UniSolver.te_typ">te_typ</a></span> <span class="id">e</span>; <span class="id">te_equ</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> |} <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">simpl</span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">e1</span> &amp; <span class="id">changed1</span> &amp; <span class="id">P</span> &amp; <span class="id">Q</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHr</span>. <span class="tactic">congruence</span>.<br/>
- <span class="id">exploit</span> (<span class="id"><a href="Unityping.html#UniSolver.solve_rec_complete">solve_rec_complete</a></span> <span class="id">te</span> (<span class="id"><a href="Unityping.html#UniSolver.te_equ">te_equ</a></span> <span class="id">e</span>) {| <span class="id"><a href="Unityping.html#UniSolver.Typenv">te_typ</a></span> := <span class="id"><a href="Unityping.html#UniSolver.te_typ">te_typ</a></span> <span class="id">e</span>; <span class="id">te_equ</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> |} <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">simpl</span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">e1</span> &amp; <span class="id">changed1</span> &amp; <span class="id">P</span> &amp; <span class="id">Q</span>).<br/>
&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="UniSolver.solve_complete">solve_complete</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">te</span> <span class="id">e</span>, <span class="id"><a href="Unityping.html#UniSolver.satisf">satisf</a></span> <span class="id"><a href="Unityping.html#te">te</a></span> <span class="id"><a href="Unityping.html#e">e</a></span> -&gt; <span class="id">exists</span> <span class="id">te</span>', <span class="id"><a href="Unityping.html#UniSolver.solve">solve</a></span> <span class="id"><a href="Unityping.html#e">e</a></span> = <span class="id"><a href="Errors.html#OK">OK</a></span> <span class="id">te</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2066')">Proof.</div>
<div class="proofscript" id="proof2066">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="Unityping.html#UniSolver.solve">solve</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Unityping.html#UniSolver.solve_constraints_complete">solve_constraints_complete</a></span> <span class="id">te</span> <span class="id">e</span> <span class="id">H</span>) <span class="kwd">as</span> (<span class="id">e</span>' &amp; <span class="id">P</span> &amp; <span class="id">Q</span>).<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="tactic">rewrite</span> <span class="id">P</span>. <span class="tactic">simpl</span>. <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="Unityping.html#UniSolver">UniSolver</a></span>.<br/>
<br/>
</div>
<div class="footer"><hr/>Generated by coq2html</div>
</body>
</html>
